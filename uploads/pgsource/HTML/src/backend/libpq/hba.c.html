<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\libpq\hba.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\libpq\hba.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:40 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * hba.c 
 *    Routines to handle host based authentication (that's the scheme 
 *    wherein you authenticate a user by seeing what IP address the system 
 *    says he comes from and choosing authentication method based on it). 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/libpq/hba.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;ctype.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;pwd.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;fcntl.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;sys/param.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;sys/socket.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;netinet/in.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;arpa/inet.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;unistd.h&GT;</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_collation.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"common/ip.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"funcapi.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"libpq/ifaddr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"libpq/libpq.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"postmaster/postmaster.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"regex/regex.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"replication/walsender.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/fd.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/acl.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/varlena.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/guc.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/memutils.h"</span> 
 
<span class='Directive'>#ifdef</span> USE_LDAP 
<span class='Directive'>#ifdef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
<span class='Keyword'>#include </span><span class='String'>&LT;winldap.h&GT;</span> 
<span class='Directive'>#else</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;ldap.h&GT;</span> 
<span class='Directive'>#endif</span> 
<span class='Directive'>#endif</span> 
 
 
<a name="LN55"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>MAX_TOKEN</span>   <span class='Number'>256</span> 
<a name="LN56"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>MAX_LINE</span>    <span class='Number'>8192</span> 
 
<span class='Comment_Multi_Line'>/* callback data for check_network_callback */ 
</span><a name="LN59"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>check_network_data</span> 
<span class='Delimiter'>{ 
</span><a name="LN61"></a>    <a href="../../include/libpq/hba.h.html#LN44"><span class='Ref_to_Enum'>IPCompareMethod</span></a> <span class='Declare_Member'>method</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* test method */ 
</span><a name="LN62"></a>    <a href="../../include/libpq/pqcomm.h.html#LN61"><span class='Ref_to_Typedef'>SockAddr</span></a>   <span class='Operator'>*</span><span class='Declare_Member'>raddr</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* client's actual address */ 
</span><a name="LN63"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>result</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* set to true if match */ 
</span><a name="LN64"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>check_network_data</span><span class='Delimiter'>; 
</span> 
 
<a name="LN67"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>token_is_keyword</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>t</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>k</span><span class='Parentheses'>)</span>  <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="hba.c.html#LN67"><span class='Ref_to_Parameter'>t</span></a><span class='Operator'>-&GT;</span>quoted <span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN67"><span class='Ref_to_Parameter'>t</span></a><span class='Operator'>-&GT;</span>string<span class='Delimiter'>, </span><a href="hba.c.html#LN67"><span class='Ref_to_Parameter'>k</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
<a name="LN68"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>token_matches</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>t</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>k</span><span class='Parentheses'>)</span>  <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN68"><span class='Ref_to_Parameter'>t</span></a><span class='Operator'>-&GT;</span>string<span class='Delimiter'>, </span><a href="hba.c.html#LN68"><span class='Ref_to_Parameter'>k</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
 
<span class='Comment_Multi_Line'>/* 
 * A single string token lexed from a config file, together with whether 
 * the token had been quoted. 
 */ 
</span><a name="LN74"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>HbaToken</span> 
<span class='Delimiter'>{ 
</span><a name="LN76"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>string</span><span class='Delimiter'>; 
</span><a name="LN77"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>quoted</span><span class='Delimiter'>; 
</span><a name="LN78"></a>} <span class='Declare_Typedef'>HbaToken</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * TokenizedLine represents one line lexed from a config file. 
 * Each item in the "fields" list is a sub-list of HbaTokens. 
 * We don't emit a TokenizedLine for empty or all-comment lines, 
 * so "fields" is never NIL (nor are any of its sub-lists). 
 * Exception: if an error occurs during tokenization, we might 
 * have fields == NIL, in which case err_msg != NULL. 
 */ 
</span><a name="LN88"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>TokenizedLine</span> 
<span class='Delimiter'>{ 
</span><a name="LN90"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>fields</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* List of lists of HbaTokens */ 
</span><a name="LN91"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>line_num</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* Line number */ 
</span><a name="LN92"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>raw_line</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* Raw line text */ 
</span><a name="LN93"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>err_msg</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* Error message if any */ 
</span><a name="LN94"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>TokenizedLine</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * pre-parsed content of HBA config file: list of HbaLine structs. 
 * parsed_hba_context is the memory context where it lives. 
 */ 
</span><a name="LN100"></a><span class='Keyword'>static </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Var'>parsed_hba_lines</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN101"></a><span class='Keyword'>static </span><a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Var'>parsed_hba_context</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * pre-parsed content of ident mapping file: list of IdentLine structs. 
 * parsed_ident_context is the memory context where it lives. 
 * 
 * NOTE: the IdentLine structs can contain pre-compiled regular expressions 
 * that live outside the memory context. Before destroying or resetting the 
 * memory context, they need to be explicitly free'd. 
 */ 
</span><a name="LN111"></a><span class='Keyword'>static </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Var'>parsed_ident_lines</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN112"></a><span class='Keyword'>static </span><a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Var'>parsed_ident_context</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * The following character array represents the names of the authentication 
 * methods that are supported by PostgreSQL. 
 * 
 * Note: keep this in sync with the UserAuth enum in hba.h. 
 */ 
</span><a name="LN120"></a><span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Keyword'>const </span><span class='Declare_Var'>UserAuthName</span><span class='Delimiter'>[] </span><span class='Operator'>= 
</span><span class='Delimiter'>{ 
</span>    <span class='String'>"reject"</span><span class='Delimiter'>, 
</span>    <span class='String'>"implicit reject"</span><span class='Delimiter'>,</span>          <span class='Comment_Single_Line'>/* Not a user-visible option */ 
</span>    <span class='String'>"trust"</span><span class='Delimiter'>, 
</span>    <span class='String'>"ident"</span><span class='Delimiter'>, 
</span>    <span class='String'>"password"</span><span class='Delimiter'>, 
</span>    <span class='String'>"md5"</span><span class='Delimiter'>, 
</span>    <span class='String'>"scram-sha256"</span><span class='Delimiter'>, 
</span>    <span class='String'>"gss"</span><span class='Delimiter'>, 
</span>    <span class='String'>"sspi"</span><span class='Delimiter'>, 
</span>    <span class='String'>"pam"</span><span class='Delimiter'>, 
</span>    <span class='String'>"bsd"</span><span class='Delimiter'>, 
</span>    <span class='String'>"ldap"</span><span class='Delimiter'>, 
</span>    <span class='String'>"cert"</span><span class='Delimiter'>, 
</span>    <span class='String'>"radius"</span><span class='Delimiter'>, 
</span>    <span class='String'>"peer"</span> 
<span class='Delimiter'>}; 
</span> 
 
<a name="LN140"></a><span class='Keyword'>static </span><a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Prototype'>tokenize_file</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>filename</span><span class='Delimiter'>, </span>FILE <span class='Operator'>*</span><span class='Declare_Parameter'>file</span><span class='Delimiter'>, 
</span><a name="LN141"></a>              <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>tok_lines</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>elevel</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN142"></a><span class='Keyword'>static </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>tokenize_inc_file</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tokens</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>outer_filename</span><span class='Delimiter'>, 
</span><a name="LN143"></a>                  <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>inc_filename</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>elevel</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>err_msg</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN144"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>parse_hba_auth_opt</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>name</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>val</span><span class='Delimiter'>, </span><a href="../../include/libpq/hba.h.html#LN60"><span class='Ref_to_Struct'>HbaLine</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>hbaline</span><span class='Delimiter'>, 
</span><a name="LN145"></a>                   <span class='Keyword'>int </span><span class='Declare_Parameter'>elevel</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>err_msg</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN146"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>verify_option_list_length</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>options</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>optionname</span><span class='Delimiter'>, 
</span><a name="LN147"></a>                          <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>masters</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>mastername</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>line_num</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN148"></a><span class='Keyword'>static </span><a href="../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>gethba_options</span><span class='Parentheses'>(</span><a href="../../include/libpq/hba.h.html#LN60"><span class='Ref_to_Struct'>HbaLine</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>hba</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN149"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>fill_hba_line</span><span class='Parentheses'>(</span><a href="../utils/sort/tuplestore.c.html#LN102"><span class='Ref_to_Struct'>Tuplestorestate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tuple_store</span><span class='Delimiter'>, </span><a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>tupdesc</span><span class='Delimiter'>, 
</span><a name="LN150"></a>              <span class='Keyword'>int </span><span class='Declare_Parameter'>lineno</span><span class='Delimiter'>, </span><a href="../../include/libpq/hba.h.html#LN60"><span class='Ref_to_Struct'>HbaLine</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>hba</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>err_msg</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN151"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>fill_hba_view</span><span class='Parentheses'>(</span><a href="../utils/sort/tuplestore.c.html#LN102"><span class='Ref_to_Struct'>Tuplestorestate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tuple_store</span><span class='Delimiter'>, </span><a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>tupdesc</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * isblank() exists in the ISO C99 spec, but it's not very portable yet, 
 * so provide our own version. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN159"></a><span class='Declare_Function'>pg_isblank</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Declare_Parameter'>c</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="hba.c.html#LN159"><span class='Ref_to_Parameter'>c</span></a> <span class='Operator'>== </span><span class='String'>' '</span> <span class='Operator'>|| </span><a href="hba.c.html#LN159"><span class='Ref_to_Parameter'>c</span></a> <span class='Operator'>== </span><span class='String'>'\t'</span> <span class='Operator'>|| </span><a href="hba.c.html#LN159"><span class='Ref_to_Parameter'>c</span></a> <span class='Operator'>== </span><span class='String'>'\r'</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Grab one token out of the string pointed to by *lineptr. 
 * 
 * Tokens are strings of non-blank 
 * characters bounded by blank characters, commas, beginning of line, and 
 * end of line. Blank means space or tab. Tokens can be delimited by 
 * double quotes (this allows the inclusion of blanks, but not newlines). 
 * Comments (started by an unquoted '#') are skipped. 
 * 
 * The token, if any, is returned at *buf (a buffer of size bufsz), and 
 * *lineptr is advanced past the token. 
 * 
 * Also, we set *initial_quote to indicate whether there was quoting before 
 * the first character.  (We use that to prevent "@x" from being treated 
 * as a file inclusion request.  Note that @"x" should be so treated; 
 * we want to allow that to support embedded spaces in file paths.) 
 * 
 * We set *terminating_comma to indicate whether the token is terminated by a 
 * comma (which is not returned). 
 * 
 * In event of an error, log a message at ereport level elevel, and also 
 * set *err_msg to a string describing the error.  Currently the only 
 * possible error is token too long for buf. 
 * 
 * If successful: store null-terminated token at *buf and return TRUE. 
 * If no more tokens on line: set *buf = '\0' and return FALSE. 
 * If error: fill buf with truncated or misformatted token and return FALSE. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN194"></a><span class='Declare_Function'>next_token</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>lineptr</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>bufsz</span><span class='Delimiter'>, 
</span><a name="LN195"></a>           <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>initial_quote</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>terminating_comma</span><span class='Delimiter'>, 
</span><a name="LN196"></a>           <span class='Keyword'>int </span><span class='Declare_Parameter'>elevel</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>err_msg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN198"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>c</span><span class='Delimiter'>; 
</span><a name="LN199"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>start_buf</span> <span class='Operator'>= </span><a href="hba.c.html#LN194"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>; 
</span><a name="LN200"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>end_buf</span> <span class='Operator'>= </span><a href="hba.c.html#LN194"><span class='Ref_to_Parameter'>buf</span></a> <span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="hba.c.html#LN194"><span class='Ref_to_Parameter'>bufsz</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN201"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>in_quote</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN202"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>was_quote</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN203"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>saw_quote</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="hba.c.html#LN200"><span class='Ref_To_Local'>end_buf</span></a> <span class='Operator'>&GT; </span><a href="hba.c.html#LN199"><span class='Ref_To_Local'>start_buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="hba.c.html#LN195"><span class='Ref_to_Parameter'>initial_quote</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="hba.c.html#LN195"><span class='Ref_to_Parameter'>terminating_comma</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Move over any whitespace and commas preceding the next token */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="hba.c.html#LN198"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Operator'>*</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="hba.c.html#LN194"><span class='Ref_to_Parameter'>lineptr</span></a><span class='Parentheses'>)</span><span class='Operator'>++</span><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='String'>'\0'</span> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="../../include/libpq/hba.h.html#LN120"><span class='Ref_to_Proto'>pg_isblank</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN198"><span class='Ref_To_Local'>c</span></a><span class='Parentheses'>)</span> <span class='Operator'>|| </span><a href="hba.c.html#LN198"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>== </span><span class='String'>','</span><span class='Parentheses'>))</span> 
        <span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Build a token in buf of next characters up to EOL, unquoted comma, or 
     * unquoted whitespace. 
     */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN198"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span> <span class='Operator'>&& 
</span>           <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/libpq/hba.h.html#LN120"><span class='Ref_to_Proto'>pg_isblank</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN198"><span class='Ref_To_Local'>c</span></a><span class='Parentheses'>) </span><span class='Operator'>|| </span><a href="hba.c.html#LN201"><span class='Ref_To_Local'>in_quote</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* skip comments to EOL */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN198"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>== </span><span class='String'>'#'</span> <span class='Operator'>&& !</span><a href="hba.c.html#LN201"><span class='Ref_To_Local'>in_quote</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="hba.c.html#LN198"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Operator'>*</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="hba.c.html#LN194"><span class='Ref_to_Parameter'>lineptr</span></a><span class='Parentheses'>)</span><span class='Operator'>++</span><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>)</span> 
                <span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN194"><span class='Ref_to_Parameter'>buf</span></a> <span class='Operator'>&GT;= </span><a href="hba.c.html#LN200"><span class='Ref_To_Local'>end_buf</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Operator'>*</span><a href="hba.c.html#LN194"><span class='Ref_to_Parameter'>buf</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN196"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONFIG_FILE_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>               <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"authentication file token too long, skipping: \"%s\""</span><span class='Delimiter'>, 
</span>                      <a href="hba.c.html#LN199"><span class='Ref_To_Local'>start_buf</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="hba.c.html#LN196"><span class='Ref_to_Parameter'>err_msg</span></a> <span class='Operator'>= </span><span class='String'>"authentication file token too long"</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Discard remainder of line */ 
</span>            <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="hba.c.html#LN198"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Operator'>*</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="hba.c.html#LN194"><span class='Ref_to_Parameter'>lineptr</span></a><span class='Parentheses'>)</span><span class='Operator'>++</span><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>)</span> 
                <span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Un-eat the '\0', in case we're called again */ 
</span>            <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="hba.c.html#LN194"><span class='Ref_to_Parameter'>lineptr</span></a><span class='Parentheses'>)</span><span class='Operator'>--</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* we do not pass back a terminating comma in the token */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN198"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>== </span><span class='String'>','</span> <span class='Operator'>&& !</span><a href="hba.c.html#LN201"><span class='Ref_To_Local'>in_quote</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Operator'>*</span><a href="hba.c.html#LN195"><span class='Ref_to_Parameter'>terminating_comma</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN198"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>!= </span><span class='String'>'"'</span> <span class='Operator'>|| </span><a href="hba.c.html#LN202"><span class='Ref_To_Local'>was_quote</span></a><span class='Parentheses'>) 
</span>            <span class='Operator'>*</span><a href="hba.c.html#LN194"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>++ = </span><a href="hba.c.html#LN198"><span class='Ref_To_Local'>c</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Literal double-quote is two double-quotes */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN201"><span class='Ref_To_Local'>in_quote</span></a> <span class='Operator'>&& </span><a href="hba.c.html#LN198"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>== </span><span class='String'>'"'</span><span class='Parentheses'>) 
</span>            <a href="hba.c.html#LN202"><span class='Ref_To_Local'>was_quote</span></a> <span class='Operator'>= !</span><a href="hba.c.html#LN202"><span class='Ref_To_Local'>was_quote</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="hba.c.html#LN202"><span class='Ref_To_Local'>was_quote</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN198"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>== </span><span class='String'>'"'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="hba.c.html#LN201"><span class='Ref_To_Local'>in_quote</span></a> <span class='Operator'>= !</span><a href="hba.c.html#LN201"><span class='Ref_To_Local'>in_quote</span></a><span class='Delimiter'>; 
</span>            <a href="hba.c.html#LN203"><span class='Ref_To_Local'>saw_quote</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN194"><span class='Ref_to_Parameter'>buf</span></a> <span class='Operator'>== </span><a href="hba.c.html#LN199"><span class='Ref_To_Local'>start_buf</span></a><span class='Parentheses'>) 
</span>                <span class='Operator'>*</span><a href="hba.c.html#LN195"><span class='Ref_to_Parameter'>initial_quote</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="hba.c.html#LN198"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= *</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="hba.c.html#LN194"><span class='Ref_to_Parameter'>lineptr</span></a><span class='Parentheses'>)</span><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while c!='\0'&&(!pg_isblank... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Un-eat the char right after the token (critical in case it is '\0', 
     * else next call will read past end of string). 
     */ 
</span>    <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="hba.c.html#LN194"><span class='Ref_to_Parameter'>lineptr</span></a><span class='Parentheses'>)</span><span class='Operator'>--</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="hba.c.html#LN194"><span class='Ref_to_Parameter'>buf</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN203"><span class='Ref_To_Local'>saw_quote</span></a> <span class='Operator'>|| </span><a href="hba.c.html#LN194"><span class='Ref_to_Parameter'>buf</span></a> <span class='Operator'>&GT; </span><a href="hba.c.html#LN199"><span class='Ref_To_Local'>start_buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end next_token &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Construct a palloc'd HbaToken struct, copying the given string. 
 */ 
</span><span class='Keyword'>static </span><a href="hba.c.html#LN74"><span class='Ref_to_Struct'>HbaToken</span></a> <span class='Operator'>* 
</span><a name="LN287"></a><span class='Declare_Function'>make_hba_token</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>token</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>quoted</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN289"></a>    <a href="hba.c.html#LN74"><span class='Ref_to_Struct'>HbaToken</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>hbatoken</span><span class='Delimiter'>; 
</span><a name="LN290"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>toklen</span><span class='Delimiter'>; 
</span> 
    <a href="hba.c.html#LN290"><span class='Ref_To_Local'>toklen</span></a> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="hba.c.html#LN287"><span class='Ref_to_Parameter'>token</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* we copy string into same palloc block as the struct */ 
</span>    <a href="hba.c.html#LN289"><span class='Ref_To_Local'>hbatoken</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="hba.c.html#LN74"><span class='Ref_to_Struct'>HbaToken</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="hba.c.html#LN74"><span class='Ref_to_Struct'>HbaToken</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="hba.c.html#LN290"><span class='Ref_To_Local'>toklen</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="hba.c.html#LN289"><span class='Ref_To_Local'>hbatoken</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN76"><span class='Ref_to_Member'>string</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="hba.c.html#LN289"><span class='Ref_To_Local'>hbatoken</span></a> <span class='Operator'>+ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="hba.c.html#LN74"><span class='Ref_to_Struct'>HbaToken</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="hba.c.html#LN289"><span class='Ref_To_Local'>hbatoken</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN77"><span class='Ref_to_Member'>quoted</span></a> <span class='Operator'>= </span><a href="hba.c.html#LN287"><span class='Ref_to_Parameter'>quoted</span></a><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="hba.c.html#LN289"><span class='Ref_To_Local'>hbatoken</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN76"><span class='Ref_to_Member'>string</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN287"><span class='Ref_to_Parameter'>token</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN290"><span class='Ref_To_Local'>toklen</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="hba.c.html#LN289"><span class='Ref_To_Local'>hbatoken</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Copy a HbaToken struct into freshly palloc'd memory. 
 */ 
</span><span class='Keyword'>static </span><a href="hba.c.html#LN74"><span class='Ref_to_Struct'>HbaToken</span></a> <span class='Operator'>* 
</span><a name="LN306"></a><span class='Declare_Function'>copy_hba_token</span><span class='Parentheses'>(</span><a href="hba.c.html#LN74"><span class='Ref_to_Struct'>HbaToken</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>in</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN308"></a>    <a href="hba.c.html#LN74"><span class='Ref_to_Struct'>HbaToken</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>out</span> <span class='Operator'>= </span><a href="hba.c.html#LN286"><span class='Ref_to_Func'>make_hba_token</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN306"><span class='Ref_to_Parameter'>in</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN76"><span class='Ref_to_Member'>string</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN306"><span class='Ref_to_Parameter'>in</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN77"><span class='Ref_to_Member'>quoted</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="hba.c.html#LN308"><span class='Ref_To_Local'>out</span></a><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Tokenize one HBA field from a line, handling file inclusion and comma lists. 
 * 
 * filename: current file's pathname (needed to resolve relative pathnames) 
 * *lineptr: current line pointer, which will be advanced past field 
 * 
 * In event of an error, log a message at ereport level elevel, and also 
 * set *err_msg to a string describing the error.  Note that the result 
 * may be non-NIL anyway, so *err_msg must be tested to determine whether 
 * there was an error. 
 * 
 * The result is a List of HbaToken structs, one for each token in the field, 
 * or NIL if we reached EOL. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN329"></a><span class='Declare_Function'>next_field_expand</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>filename</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>lineptr</span><span class='Delimiter'>, 
</span><a name="LN330"></a>                  <span class='Keyword'>int </span><span class='Declare_Parameter'>elevel</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>err_msg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN332"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>buf</span><span class='Delimiter'>[</span><a href="hba.c.html#LN55"><span class='Ref_to_Const'>MAX_TOKEN</span></a><span class='Delimiter'>]; 
</span><a name="LN333"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>trailing_comma</span><span class='Delimiter'>; 
</span><a name="LN334"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>initial_quote</span><span class='Delimiter'>; 
</span><a name="LN335"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>tokens</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>do</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="hba.c.html#LN193"><span class='Ref_to_Func'>next_token</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN329"><span class='Ref_to_Parameter'>lineptr</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN332"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="hba.c.html#LN332"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <span class='Operator'>&</span><a href="hba.c.html#LN334"><span class='Ref_To_Local'>initial_quote</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="hba.c.html#LN333"><span class='Ref_To_Local'>trailing_comma</span></a><span class='Delimiter'>, 
</span>                        <a href="hba.c.html#LN330"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN330"><span class='Ref_to_Parameter'>err_msg</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Is this referencing a file? */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="hba.c.html#LN334"><span class='Ref_To_Local'>initial_quote</span></a> <span class='Operator'>&& </span><a href="hba.c.html#LN332"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'@'</span> <span class='Operator'>&& </span><a href="hba.c.html#LN332"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>            <a href="hba.c.html#LN335"><span class='Ref_To_Local'>tokens</span></a> <span class='Operator'>= </span><a href="hba.c.html#LN142"><span class='Ref_to_Proto'>tokenize_inc_file</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN335"><span class='Ref_To_Local'>tokens</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN329"><span class='Ref_to_Parameter'>filename</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN332"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                       <a href="hba.c.html#LN330"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN330"><span class='Ref_to_Parameter'>err_msg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="hba.c.html#LN335"><span class='Ref_To_Local'>tokens</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN335"><span class='Ref_To_Local'>tokens</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN286"><span class='Ref_to_Func'>make_hba_token</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN332"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN334"><span class='Ref_To_Local'>initial_quote</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN333"><span class='Ref_To_Local'>trailing_comma</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="hba.c.html#LN330"><span class='Ref_to_Parameter'>err_msg</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="hba.c.html#LN335"><span class='Ref_To_Local'>tokens</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end next_field_expand &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * tokenize_inc_file 
 *      Expand a file included from another file into an hba "field" 
 * 
 * Opens and tokenises a file included from another HBA config file with @, 
 * and returns all values found therein as a flat list of HbaTokens.  If a 
 * @-token is found, recursively expand it.  The newly read tokens are 
 * appended to "tokens" (so that foo,bar,@baz does what you expect). 
 * All new tokens are allocated in caller's memory context. 
 * 
 * In event of an error, log a message at ereport level elevel, and also 
 * set *err_msg to a string describing the error.  Note that the result 
 * may be non-NIL anyway, so *err_msg must be tested to determine whether 
 * there was an error. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN371"></a><span class='Declare_Function'>tokenize_inc_file</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tokens</span><span class='Delimiter'>, 
</span><a name="LN372"></a>                  <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>outer_filename</span><span class='Delimiter'>, 
</span><a name="LN373"></a>                  <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>inc_filename</span><span class='Delimiter'>, 
</span><a name="LN374"></a>                  <span class='Keyword'>int </span><span class='Declare_Parameter'>elevel</span><span class='Delimiter'>, 
</span><a name="LN375"></a>                  <span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>err_msg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN377"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>inc_fullname</span><span class='Delimiter'>; 
</span><a name="LN378"></a>    FILE       <span class='Operator'>*</span><span class='Declare_Local'>inc_file</span><span class='Delimiter'>; 
</span><a name="LN379"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>inc_lines</span><span class='Delimiter'>; 
</span><a name="LN380"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>inc_line</span><span class='Delimiter'>; 
</span><a name="LN381"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>linecxt</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port.h.html#LN76"><span class='Ref_to_Macro'>is_absolute_path</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN373"><span class='Ref_to_Parameter'>inc_filename</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* absolute path is taken as-is */ 
</span>        <a href="hba.c.html#LN377"><span class='Ref_To_Local'>inc_fullname</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN373"><span class='Ref_to_Parameter'>inc_filename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* relative path is relative to dir of calling file */ 
</span>        <a href="hba.c.html#LN377"><span class='Ref_To_Local'>inc_fullname</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="hba.c.html#LN372"><span class='Ref_to_Parameter'>outer_filename</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>1</span> <span class='Operator'>+ 
</span>                                       strlen<span class='Parentheses'>(</span><a href="hba.c.html#LN373"><span class='Ref_to_Parameter'>inc_filename</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../contrib/cube/cubeparse.y.html#LN150"><span class='Ref_to_Proto'>strcpy</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN377"><span class='Ref_To_Local'>inc_fullname</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN372"><span class='Ref_to_Parameter'>outer_filename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/port.h.html#LN62"><span class='Ref_to_Proto'>get_parent_directory</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN377"><span class='Ref_To_Local'>inc_fullname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/port.h.html#LN40"><span class='Ref_to_Proto'>join_path_components</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN377"><span class='Ref_To_Local'>inc_fullname</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN377"><span class='Ref_To_Local'>inc_fullname</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN373"><span class='Ref_to_Parameter'>inc_filename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/port.h.html#LN42"><span class='Ref_to_Proto'>canonicalize_path</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN377"><span class='Ref_To_Local'>inc_fullname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="hba.c.html#LN378"><span class='Ref_To_Local'>inc_file</span></a> <span class='Operator'>= </span><a href="../../include/storage/fd.h.html#LN83"><span class='Ref_to_Proto'>AllocateFile</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN377"><span class='Ref_To_Local'>inc_fullname</span></a><span class='Delimiter'>, </span><span class='String'>"r"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN378"><span class='Ref_To_Local'>inc_file</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN402"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>save_errno</span> <span class='Operator'>= </span>errno<span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN374"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN132"><span class='Ref_to_Proto'>errcode_for_file_access</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not open secondary authentication file \"@%s\" as \"%s\": %m"</span><span class='Delimiter'>, 
</span>                        <a href="hba.c.html#LN373"><span class='Ref_to_Parameter'>inc_filename</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN377"><span class='Ref_To_Local'>inc_fullname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="hba.c.html#LN375"><span class='Ref_to_Parameter'>err_msg</span></a> <span class='Operator'>= </span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"could not open secondary authentication file \"@%s\" as \"%s\": %s"</span><span class='Delimiter'>, 
</span>                            <a href="hba.c.html#LN373"><span class='Ref_to_Parameter'>inc_filename</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN377"><span class='Ref_To_Local'>inc_fullname</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN402"><span class='Ref_To_Local'>save_errno</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN377"><span class='Ref_To_Local'>inc_fullname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="hba.c.html#LN371"><span class='Ref_to_Parameter'>tokens</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* There is possible recursion here if the file contains @ */ 
</span>    <a href="hba.c.html#LN381"><span class='Ref_To_Local'>linecxt</span></a> <span class='Operator'>= </span><a href="hba.c.html#LN140"><span class='Ref_to_Proto'>tokenize_file</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN377"><span class='Ref_To_Local'>inc_fullname</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN378"><span class='Ref_To_Local'>inc_file</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="hba.c.html#LN379"><span class='Ref_To_Local'>inc_lines</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN374"><span class='Ref_to_Parameter'>elevel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/storage/fd.h.html#LN84"><span class='Ref_to_Proto'>FreeFile</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN378"><span class='Ref_To_Local'>inc_file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN377"><span class='Ref_To_Local'>inc_fullname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Copy all tokens found in the file and append to the tokens list */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN380"><span class='Ref_To_Local'>inc_line</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN379"><span class='Ref_To_Local'>inc_lines</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN423"></a>        <a href="hba.c.html#LN88"><span class='Ref_to_Struct'>TokenizedLine</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tok_line</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="hba.c.html#LN88"><span class='Ref_to_Struct'>TokenizedLine</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN380"><span class='Ref_To_Local'>inc_line</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN424"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>inc_field</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* If any line has an error, propagate that up to caller */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN423"><span class='Ref_To_Local'>tok_line</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN93"><span class='Ref_to_Member'>err_msg</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Operator'>*</span><a href="hba.c.html#LN375"><span class='Ref_to_Parameter'>err_msg</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN423"><span class='Ref_To_Local'>tok_line</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN93"><span class='Ref_to_Member'>err_msg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN424"><span class='Ref_To_Local'>inc_field</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN423"><span class='Ref_To_Local'>tok_line</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN90"><span class='Ref_to_Member'>fields</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN435"></a>            <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>inc_tokens</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN424"><span class='Ref_To_Local'>inc_field</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN436"></a>            <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>inc_token</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN436"><span class='Ref_To_Local'>inc_token</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN435"><span class='Ref_To_Local'>inc_tokens</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN440"></a>                <a href="hba.c.html#LN74"><span class='Ref_to_Struct'>HbaToken</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>token</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN436"><span class='Ref_To_Local'>inc_token</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="hba.c.html#LN371"><span class='Ref_to_Parameter'>tokens</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN371"><span class='Ref_to_Parameter'>tokens</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN305"><span class='Ref_to_Func'>copy_hba_token</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN440"><span class='Ref_To_Local'>token</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/utils/memutils.h.html#LN74"><span class='Ref_to_Proto'>MemoryContextDelete</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN381"><span class='Ref_To_Local'>linecxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="hba.c.html#LN371"><span class='Ref_to_Parameter'>tokens</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end tokenize_inc_file &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Tokenize the given file. 
 * 
 * The output is a list of TokenizedLine structs; see struct definition above. 
 * 
 * filename: the absolute path to the target file 
 * file: the already-opened target file 
 * tok_lines: receives output list 
 * elevel: message logging level 
 * 
 * Errors are reported by logging messages at ereport level elevel and by 
 * adding TokenizedLine structs containing non-null err_msg fields to the 
 * output list. 
 * 
 * Return value is a memory context which contains all memory allocated by 
 * this function (it's a child of caller's context). 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> 
<a name="LN469"></a><span class='Declare_Function'>tokenize_file</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>filename</span><span class='Delimiter'>, </span>FILE <span class='Operator'>*</span><span class='Declare_Parameter'>file</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>tok_lines</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>elevel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN471"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>line_number</span> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span><a name="LN472"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>linecxt</span><span class='Delimiter'>; 
</span><a name="LN473"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span> 
    <a href="hba.c.html#LN472"><span class='Ref_To_Local'>linecxt</span></a> <span class='Operator'>= </span><a href="../../include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>, 
</span>                                    <span class='String'>"tokenize_file"</span><span class='Delimiter'>, 
</span>                                    <a href="../../include/utils/memutils.h.html#LN174"><span class='Ref_to_Const'>ALLOCSET_SMALL_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="hba.c.html#LN473"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN472"><span class='Ref_To_Local'>linecxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="hba.c.html#LN469"><span class='Ref_to_Parameter'>tok_lines</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>!</span>feof<span class='Parentheses'>(</span><a href="hba.c.html#LN469"><span class='Ref_to_Parameter'>file</span></a><span class='Parentheses'>) </span><span class='Operator'>&& !</span>ferror<span class='Parentheses'>(</span><a href="hba.c.html#LN469"><span class='Ref_to_Parameter'>file</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN484"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>rawline</span><span class='Delimiter'>[</span><a href="hba.c.html#LN56"><span class='Ref_to_Const'>MAX_LINE</span></a><span class='Delimiter'>]; 
</span><a name="LN485"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>lineptr</span><span class='Delimiter'>; 
</span><a name="LN486"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>current_line</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN487"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>err_msg</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span>fgets<span class='Parentheses'>(</span><a href="hba.c.html#LN484"><span class='Ref_To_Local'>rawline</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="hba.c.html#LN484"><span class='Ref_To_Local'>rawline</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="hba.c.html#LN469"><span class='Ref_to_Parameter'>file</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN491"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>save_errno</span> <span class='Operator'>= </span>errno<span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span>ferror<span class='Parentheses'>(</span><a href="hba.c.html#LN469"><span class='Ref_to_Parameter'>file</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>break</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* normal EOF */ 
</span>            <span class='Comment_Multi_Line'>/* I/O error! */ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN469"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN132"><span class='Ref_to_Proto'>errcode_for_file_access</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not read file \"%s\": %m"</span><span class='Delimiter'>, </span><a href="hba.c.html#LN469"><span class='Ref_to_Parameter'>filename</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="hba.c.html#LN487"><span class='Ref_To_Local'>err_msg</span></a> <span class='Operator'>= </span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"could not read file \"%s\": %s"</span><span class='Delimiter'>, 
</span>                               <a href="hba.c.html#LN469"><span class='Ref_to_Parameter'>filename</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN491"><span class='Ref_To_Local'>save_errno</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="hba.c.html#LN484"><span class='Ref_To_Local'>rawline</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="hba.c.html#LN484"><span class='Ref_To_Local'>rawline</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="hba.c.html#LN56"><span class='Ref_to_Const'>MAX_LINE</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Line too long! */ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN469"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONFIG_FILE_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"authentication file line too long"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     errcontext<span class='Parentheses'>(</span><span class='String'>"line %d of configuration file \"%s\""</span><span class='Delimiter'>, 
</span>                                <a href="hba.c.html#LN471"><span class='Ref_To_Local'>line_number</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN469"><span class='Ref_to_Parameter'>filename</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="hba.c.html#LN487"><span class='Ref_To_Local'>err_msg</span></a> <span class='Operator'>= </span><span class='String'>"authentication file line too long"</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Strip trailing linebreak from rawline */ 
</span>        <a href="hba.c.html#LN485"><span class='Ref_To_Local'>lineptr</span></a> <span class='Operator'>= </span><a href="hba.c.html#LN484"><span class='Ref_To_Local'>rawline</span></a> <span class='Operator'>+ </span>strlen<span class='Parentheses'>(</span><a href="hba.c.html#LN484"><span class='Ref_To_Local'>rawline</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN485"><span class='Ref_To_Local'>lineptr</span></a> <span class='Operator'>&GT;= </span><a href="hba.c.html#LN484"><span class='Ref_To_Local'>rawline</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="hba.c.html#LN485"><span class='Ref_To_Local'>lineptr</span></a> <span class='Operator'>== </span><span class='String'>'\n'</span> <span class='Operator'>|| *</span><a href="hba.c.html#LN485"><span class='Ref_To_Local'>lineptr</span></a> <span class='Operator'>== </span><span class='String'>'\r'</span><span class='Parentheses'>))</span> 
            <span class='Operator'>*</span><a href="hba.c.html#LN485"><span class='Ref_To_Local'>lineptr</span></a><span class='Operator'>-- = </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Parse fields */ 
</span>        <a href="hba.c.html#LN485"><span class='Ref_To_Local'>lineptr</span></a> <span class='Operator'>= </span><a href="hba.c.html#LN484"><span class='Ref_To_Local'>rawline</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="hba.c.html#LN485"><span class='Ref_To_Local'>lineptr</span></a> <span class='Operator'>&& </span><a href="hba.c.html#LN487"><span class='Ref_To_Local'>err_msg</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN523"></a>            <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>current_field</span><span class='Delimiter'>; 
</span> 
            <a href="hba.c.html#LN523"><span class='Ref_To_Local'>current_field</span></a> <span class='Operator'>= </span><a href="hba.c.html#LN328"><span class='Ref_to_Func'>next_field_expand</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN469"><span class='Ref_to_Parameter'>filename</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="hba.c.html#LN485"><span class='Ref_To_Local'>lineptr</span></a><span class='Delimiter'>, 
</span>                                              <a href="hba.c.html#LN469"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="hba.c.html#LN487"><span class='Ref_To_Local'>err_msg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* add field to line, unless we are at EOL or comment start */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN523"><span class='Ref_To_Local'>current_field</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>                <a href="hba.c.html#LN486"><span class='Ref_To_Local'>current_line</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN486"><span class='Ref_To_Local'>current_line</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN523"><span class='Ref_To_Local'>current_field</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Reached EOL; emit line to TokenizedLine list unless it's boring */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN486"><span class='Ref_To_Local'>current_line</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a> <span class='Operator'>|| </span><a href="hba.c.html#LN487"><span class='Ref_To_Local'>err_msg</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN535"></a>            <a href="hba.c.html#LN88"><span class='Ref_to_Struct'>TokenizedLine</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tok_line</span><span class='Delimiter'>; 
</span> 
            <a href="hba.c.html#LN535"><span class='Ref_To_Local'>tok_line</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="hba.c.html#LN88"><span class='Ref_to_Struct'>TokenizedLine</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="hba.c.html#LN88"><span class='Ref_to_Struct'>TokenizedLine</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="hba.c.html#LN535"><span class='Ref_To_Local'>tok_line</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN90"><span class='Ref_to_Member'>fields</span></a> <span class='Operator'>= </span><a href="hba.c.html#LN486"><span class='Ref_To_Local'>current_line</span></a><span class='Delimiter'>; 
</span>            <a href="hba.c.html#LN535"><span class='Ref_To_Local'>tok_line</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN91"><span class='Ref_to_Member'>line_num</span></a> <span class='Operator'>= </span><a href="hba.c.html#LN471"><span class='Ref_To_Local'>line_number</span></a><span class='Delimiter'>; 
</span>            <a href="hba.c.html#LN535"><span class='Ref_To_Local'>tok_line</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN92"><span class='Ref_to_Member'>raw_line</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN484"><span class='Ref_To_Local'>rawline</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="hba.c.html#LN535"><span class='Ref_To_Local'>tok_line</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN93"><span class='Ref_to_Member'>err_msg</span></a> <span class='Operator'>= </span><a href="hba.c.html#LN487"><span class='Ref_To_Local'>err_msg</span></a><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="hba.c.html#LN469"><span class='Ref_to_Parameter'>tok_lines</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="hba.c.html#LN469"><span class='Ref_to_Parameter'>tok_lines</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN535"><span class='Ref_To_Local'>tok_line</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="hba.c.html#LN471"><span class='Ref_To_Local'>line_number</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while !feof(file)&&!ferror(... &raquo; </span> 
 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN473"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="hba.c.html#LN472"><span class='Ref_To_Local'>linecxt</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end tokenize_file &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Does user belong to role? 
 * 
 * userid is the OID of the role given as the attempted login identifier. 
 * We check to see if it is a member of the specified role name. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN561"></a><span class='Declare_Function'>is_member</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>userid</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>role</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN563"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN561"><span class='Ref_to_Parameter'>userid</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* if user not exist, say "no" */ 
</span> 
    <a href="hba.c.html#LN563"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN234"><span class='Ref_to_Proto'>get_role_oid</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN561"><span class='Ref_to_Parameter'>role</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN563"><span class='Ref_To_Local'>roleid</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* if target role not exist, say "no" */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * See if user is directly or indirectly a member of role. For this 
     * purpose, a superuser is not considered to be automatically a member of 
     * the role, so group auth only applies to explicit membership. 
     */ 
</span>    <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN231"><span class='Ref_to_Proto'>is_member_of_role_nosuper</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN561"><span class='Ref_to_Parameter'>userid</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN563"><span class='Ref_To_Local'>roleid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end is_member &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Check HbaToken list for a match to role, allowing group names. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN585"></a><span class='Declare_Function'>check_role</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>role</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tokens</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN587"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cell</span><span class='Delimiter'>; 
</span><a name="LN588"></a>    <a href="hba.c.html#LN74"><span class='Ref_to_Struct'>HbaToken</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>tok</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN587"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN585"><span class='Ref_to_Parameter'>tokens</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="hba.c.html#LN588"><span class='Ref_To_Local'>tok</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN587"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="hba.c.html#LN588"><span class='Ref_To_Local'>tok</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN77"><span class='Ref_to_Member'>quoted</span></a> <span class='Operator'>&& </span><a href="hba.c.html#LN588"><span class='Ref_To_Local'>tok</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN76"><span class='Ref_to_Member'>string</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'+'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN560"><span class='Ref_to_Func'>is_member</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN585"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN588"><span class='Ref_To_Local'>tok</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN76"><span class='Ref_to_Member'>string</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN68"><span class='Ref_to_Macro'>token_matches</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN588"><span class='Ref_To_Local'>tok</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN585"><span class='Ref_to_Parameter'>role</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>                 <a href="hba.c.html#LN67"><span class='Ref_to_Macro'>token_is_keyword</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN588"><span class='Ref_To_Local'>tok</span></a><span class='Delimiter'>, </span><span class='String'>"all"</span><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end check_role &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Check to see if db/role combination matches HbaToken list. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN609"></a><span class='Declare_Function'>check_db</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>dbname</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>role</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tokens</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN611"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cell</span><span class='Delimiter'>; 
</span><a name="LN612"></a>    <a href="hba.c.html#LN74"><span class='Ref_to_Struct'>HbaToken</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>tok</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN611"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN609"><span class='Ref_to_Parameter'>tokens</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="hba.c.html#LN612"><span class='Ref_To_Local'>tok</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN611"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../replication/walsender.c.html#LN113"><span class='Ref_to_Global_Var'>am_walsender</span></a> <span class='Operator'>&& !</span><a href="../replication/walsender.c.html#LN116"><span class='Ref_to_Global_Var'>am_db_walsender</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * physical replication walsender connections can only match 
             * replication keyword 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN67"><span class='Ref_to_Macro'>token_is_keyword</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN612"><span class='Ref_To_Local'>tok</span></a><span class='Delimiter'>, </span><span class='String'>"replication"</span><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN67"><span class='Ref_to_Macro'>token_is_keyword</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN612"><span class='Ref_To_Local'>tok</span></a><span class='Delimiter'>, </span><span class='String'>"all"</span><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN67"><span class='Ref_to_Macro'>token_is_keyword</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN612"><span class='Ref_To_Local'>tok</span></a><span class='Delimiter'>, </span><span class='String'>"sameuser"</span><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN609"><span class='Ref_to_Parameter'>dbname</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN609"><span class='Ref_to_Parameter'>role</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN67"><span class='Ref_to_Macro'>token_is_keyword</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN612"><span class='Ref_To_Local'>tok</span></a><span class='Delimiter'>, </span><span class='String'>"samegroup"</span><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>                 <a href="hba.c.html#LN67"><span class='Ref_to_Macro'>token_is_keyword</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN612"><span class='Ref_To_Local'>tok</span></a><span class='Delimiter'>, </span><span class='String'>"samerole"</span><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN560"><span class='Ref_to_Func'>is_member</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN609"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN609"><span class='Ref_to_Parameter'>dbname</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN67"><span class='Ref_to_Macro'>token_is_keyword</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN612"><span class='Ref_To_Local'>tok</span></a><span class='Delimiter'>, </span><span class='String'>"replication"</span><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* never match this if not walsender */ 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN68"><span class='Ref_to_Macro'>token_matches</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN612"><span class='Ref_To_Local'>tok</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN609"><span class='Ref_to_Parameter'>dbname</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end check_db &raquo; </span> 
 
<span class='Keyword'>static bool 
</span><a name="LN648"></a><span class='Declare_Function'>ipv4eq</span><span class='Parentheses'>(</span><span class='Control'>struct</span> sockaddr_in <span class='Operator'>* </span><span class='Declare_Parameter'>a</span><span class='Delimiter'>, </span><span class='Control'>struct</span> sockaddr_in <span class='Operator'>* </span><span class='Declare_Parameter'>b</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN648"><span class='Ref_to_Parameter'>a</span></a><span class='Operator'>-&GT;</span>sin_addr<span class='Operator'>.</span>s_addr <span class='Operator'>== </span><a href="hba.c.html#LN648"><span class='Ref_to_Parameter'>b</span></a><span class='Operator'>-&GT;</span>sin_addr<span class='Operator'>.</span>s_addr<span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Directive'>#ifdef</span> HAVE_IPV6 
 
<span class='Keyword'>static bool 
</span><a name="LN656"></a><span class='Declare_Function'>ipv6eq</span><span class='Parentheses'>(</span><span class='Control'>struct</span> sockaddr_in6 <span class='Operator'>* </span><span class='Declare_Parameter'>a</span><span class='Delimiter'>, </span><span class='Control'>struct</span> sockaddr_in6 <span class='Operator'>* </span><span class='Declare_Parameter'>b</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN658"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN658"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="hba.c.html#LN658"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><span class='Number'>16</span><span class='Delimiter'>; </span><a href="hba.c.html#LN658"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN656"><span class='Ref_to_Parameter'>a</span></a><span class='Operator'>-&GT;</span>sin6_addr<span class='Operator'>.</span>s6_addr<span class='Delimiter'>[</span><a href="hba.c.html#LN658"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="hba.c.html#LN656"><span class='Ref_to_Parameter'>b</span></a><span class='Operator'>-&GT;</span>sin6_addr<span class='Operator'>.</span>s6_addr<span class='Delimiter'>[</span><a href="hba.c.html#LN658"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
} 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* HAVE_IPV6 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Check whether host name matches pattern. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN672"></a><span class='Declare_Function'>hostname_match</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>pattern</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>actual_hostname</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN672"><span class='Ref_to_Parameter'>pattern</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'.'</span><span class='Parentheses'>)</span>      <span class='Comment_Single_Line'>/* suffix match */ 
</span>    <span class='Delimiter'>{ 
</span><a name="LN676"></a>        size_t      <span class='Declare_Local'>plen</span> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="hba.c.html#LN672"><span class='Ref_to_Parameter'>pattern</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN677"></a>        size_t      <span class='Declare_Local'>hlen</span> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="hba.c.html#LN672"><span class='Ref_to_Parameter'>actual_hostname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN677"><span class='Ref_To_Local'>hlen</span></a> <span class='Operator'>&LT; </span><a href="hba.c.html#LN676"><span class='Ref_To_Local'>plen</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN672"><span class='Ref_to_Parameter'>pattern</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN672"><span class='Ref_to_Parameter'>actual_hostname</span></a> <span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="hba.c.html#LN677"><span class='Ref_To_Local'>hlen</span></a> <span class='Operator'>- </span><a href="hba.c.html#LN676"><span class='Ref_To_Local'>plen</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN672"><span class='Ref_to_Parameter'>pattern</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN672"><span class='Ref_to_Parameter'>actual_hostname</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Check to see if a connecting IP matches a given host name. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN692"></a><span class='Declare_Function'>check_hostname</span><span class='Parentheses'>(</span><a href="../../include/libpq/hba.h.html#LN112"><span class='Ref_to_Typedef'>hbaPort</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>port</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>hostname</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN694"></a>    <span class='Control'>struct</span> <a href="../../include/getaddrinfo.h.html#LN114"><span class='Ref_to_Struct'>addrinfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>gai_result</span><span class='Delimiter'>, 
</span><a name="LN695"></a>               <span class='Operator'>*</span><span class='Declare_Local'>gai</span><span class='Delimiter'>; 
</span><a name="LN696"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ret</span><span class='Delimiter'>; 
</span><a name="LN697"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>found</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Quick out if remote host name already known bad */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN692"><span class='Ref_to_Parameter'>port</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/libpq-be.h.html#LN125"><span class='Ref_to_Member'>remote_hostname_resolv</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Lookup remote host name if not already done */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="hba.c.html#LN692"><span class='Ref_to_Parameter'>port</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/libpq-be.h.html#LN123"><span class='Ref_to_Member'>remote_hostname</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN706"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>remote_hostname</span><span class='Delimiter'>[</span><a href="../../include/getaddrinfo.h.html#LN87"><span class='Ref_to_Const'>NI_MAXHOST</span></a><span class='Delimiter'>]; 
</span> 
        <a href="hba.c.html#LN696"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><a href="../../include/common/ip.h.html#LN31"><span class='Ref_to_Proto'>pg_getnameinfo_all</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hba.c.html#LN692"><span class='Ref_to_Parameter'>port</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/libpq-be.h.html#LN121"><span class='Ref_to_Member'>raddr</span></a><span class='Operator'>.</span><a href="../../include/libpq/pqcomm.h.html#LN63"><span class='Ref_to_Member'>addr</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN692"><span class='Ref_to_Parameter'>port</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/libpq-be.h.html#LN121"><span class='Ref_to_Member'>raddr</span></a><span class='Operator'>.</span><a href="../../include/libpq/pqcomm.h.html#LN64"><span class='Ref_to_Member'>salen</span></a><span class='Delimiter'>, 
</span>                                 <a href="hba.c.html#LN706"><span class='Ref_To_Local'>remote_hostname</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="hba.c.html#LN706"><span class='Ref_To_Local'>remote_hostname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                 <a href="../../include/getaddrinfo.h.html#LN83"><span class='Ref_to_Const'>NI_NAMEREQD</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN696"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* remember failure; don't complain in the postmaster log yet */ 
</span>            <a href="hba.c.html#LN692"><span class='Ref_to_Parameter'>port</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/libpq-be.h.html#LN125"><span class='Ref_to_Member'>remote_hostname_resolv</span></a> <span class='Operator'>= -</span><span class='Number'>2</span><span class='Delimiter'>; 
</span>            <a href="hba.c.html#LN692"><span class='Ref_to_Parameter'>port</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/libpq-be.h.html#LN126"><span class='Ref_to_Member'>remote_hostname_errcode</span></a> <span class='Operator'>= </span><a href="hba.c.html#LN696"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="hba.c.html#LN692"><span class='Ref_to_Parameter'>port</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/libpq-be.h.html#LN123"><span class='Ref_to_Member'>remote_hostname</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN706"><span class='Ref_To_Local'>remote_hostname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Now see if remote host name matches this pg_hba line */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="hba.c.html#LN671"><span class='Ref_to_Func'>hostname_match</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN692"><span class='Ref_to_Parameter'>hostname</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN692"><span class='Ref_to_Parameter'>port</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/libpq-be.h.html#LN123"><span class='Ref_to_Member'>remote_hostname</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If we already verified the forward lookup, we're done */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN692"><span class='Ref_to_Parameter'>port</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/libpq-be.h.html#LN125"><span class='Ref_to_Member'>remote_hostname_resolv</span></a> <span class='Operator'>== +</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Lookup IP from host name and check against original IP */ 
</span>    <a href="hba.c.html#LN696"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><a href="../../port/getaddrinfo.c.html#LN135"><span class='Ref_to_Func'>getaddrinfo</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN692"><span class='Ref_to_Parameter'>port</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/libpq-be.h.html#LN123"><span class='Ref_to_Member'>remote_hostname</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="hba.c.html#LN694"><span class='Ref_To_Local'>gai_result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN696"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* remember failure; don't complain in the postmaster log yet */ 
</span>        <a href="hba.c.html#LN692"><span class='Ref_to_Parameter'>port</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/libpq-be.h.html#LN125"><span class='Ref_to_Member'>remote_hostname_resolv</span></a> <span class='Operator'>= -</span><span class='Number'>2</span><span class='Delimiter'>; 
</span>        <a href="hba.c.html#LN692"><span class='Ref_to_Parameter'>port</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/libpq-be.h.html#LN126"><span class='Ref_to_Member'>remote_hostname_errcode</span></a> <span class='Operator'>= </span><a href="hba.c.html#LN696"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="hba.c.html#LN697"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN695"><span class='Ref_To_Local'>gai</span></a> <span class='Operator'>= </span><a href="hba.c.html#LN694"><span class='Ref_To_Local'>gai_result</span></a><span class='Delimiter'>; </span><a href="hba.c.html#LN695"><span class='Ref_To_Local'>gai</span></a><span class='Delimiter'>; </span><a href="hba.c.html#LN695"><span class='Ref_To_Local'>gai</span></a> <span class='Operator'>= </span><a href="hba.c.html#LN695"><span class='Ref_To_Local'>gai</span></a><span class='Operator'>-&GT;</span><a href="../../include/getaddrinfo.h.html#LN106"><span class='Ref_to_Member'>ai_next</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN695"><span class='Ref_To_Local'>gai</span></a><span class='Operator'>-&GT;</span><a href="../../include/getaddrinfo.h.html#LN104"><span class='Ref_to_Member'>ai_addr</span></a><span class='Operator'>-&GT;</span>sa_family <span class='Operator'>== </span><a href="hba.c.html#LN692"><span class='Ref_to_Parameter'>port</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/libpq-be.h.html#LN121"><span class='Ref_to_Member'>raddr</span></a><span class='Operator'>.</span><a href="../../include/libpq/pqcomm.h.html#LN63"><span class='Ref_to_Member'>addr</span></a><span class='Operator'>.</span>ss_family<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN695"><span class='Ref_To_Local'>gai</span></a><span class='Operator'>-&GT;</span><a href="../../include/getaddrinfo.h.html#LN104"><span class='Ref_to_Member'>ai_addr</span></a><span class='Operator'>-&GT;</span>sa_family <span class='Operator'>== </span>AF_INET<span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN647"><span class='Ref_to_Func'>ipv4eq</span></a><span class='Parentheses'>((</span><span class='Control'>struct</span> sockaddr_in <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="hba.c.html#LN695"><span class='Ref_To_Local'>gai</span></a><span class='Operator'>-&GT;</span><a href="../../include/getaddrinfo.h.html#LN104"><span class='Ref_to_Member'>ai_addr</span></a><span class='Delimiter'>, 
</span>                           <span class='Parentheses'>(</span><span class='Control'>struct</span> sockaddr_in <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>& </span><a href="hba.c.html#LN692"><span class='Ref_to_Parameter'>port</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/libpq-be.h.html#LN121"><span class='Ref_to_Member'>raddr</span></a><span class='Operator'>.</span><a href="../../include/libpq/pqcomm.h.html#LN63"><span class='Ref_to_Member'>addr</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="hba.c.html#LN697"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span><span class='Directive'>#ifdef</span> HAVE_IPV6 
            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN695"><span class='Ref_To_Local'>gai</span></a><span class='Operator'>-&GT;</span><a href="../../include/getaddrinfo.h.html#LN104"><span class='Ref_to_Member'>ai_addr</span></a><span class='Operator'>-&GT;</span>sa_family <span class='Operator'>== </span>AF_INET6<span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN655"><span class='Ref_to_Func'>ipv6eq</span></a><span class='Parentheses'>((</span><span class='Control'>struct</span> sockaddr_in6 <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="hba.c.html#LN695"><span class='Ref_To_Local'>gai</span></a><span class='Operator'>-&GT;</span><a href="../../include/getaddrinfo.h.html#LN104"><span class='Ref_to_Member'>ai_addr</span></a><span class='Delimiter'>, 
</span>                           <span class='Parentheses'>(</span><span class='Control'>struct</span> sockaddr_in6 <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>& </span><a href="hba.c.html#LN692"><span class='Ref_to_Parameter'>port</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/libpq-be.h.html#LN121"><span class='Ref_to_Member'>raddr</span></a><span class='Operator'>.</span><a href="../../include/libpq/pqcomm.h.html#LN63"><span class='Ref_to_Member'>addr</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="hba.c.html#LN697"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span><span class='Directive'>#endif</span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if gai-&GT;ai_addr-&GT;sa_fami... &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for gai=gai_result;gai;ga... &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN694"><span class='Ref_To_Local'>gai_result</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/getaddrinfo.h.html#LN154"><span class='Ref_to_Proto'>freeaddrinfo</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN694"><span class='Ref_To_Local'>gai_result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="hba.c.html#LN697"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>) 
</span>        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN23"><span class='Ref_to_Const'>DEBUG2</span></a><span class='Delimiter'>, </span><span class='String'>"pg_hba.conf host name \"%s\" rejected because address resolution did not return a match with IP address of client"</span><span class='Delimiter'>, 
</span>             <a href="hba.c.html#LN692"><span class='Ref_to_Parameter'>hostname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="hba.c.html#LN692"><span class='Ref_to_Parameter'>port</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/libpq-be.h.html#LN125"><span class='Ref_to_Member'>remote_hostname_resolv</span></a> <span class='Operator'>= </span><a href="hba.c.html#LN697"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>? +</span><span class='Number'>1</span> <span class='Operator'>: -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="hba.c.html#LN697"><span class='Ref_To_Local'>found</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end check_hostname &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Check to see if a connecting IP matches the given address and netmask. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN785"></a><span class='Declare_Function'>check_ip</span><span class='Parentheses'>(</span><a href="../../include/libpq/pqcomm.h.html#LN61"><span class='Ref_to_Typedef'>SockAddr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>raddr</span><span class='Delimiter'>, </span><span class='Control'>struct</span> sockaddr <span class='Operator'>* </span><span class='Declare_Parameter'>addr</span><span class='Delimiter'>, </span><span class='Control'>struct</span> sockaddr <span class='Operator'>* </span><span class='Declare_Parameter'>mask</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN785"><span class='Ref_to_Parameter'>raddr</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/pqcomm.h.html#LN63"><span class='Ref_to_Member'>addr</span></a><span class='Operator'>.</span>ss_family <span class='Operator'>== </span><a href="hba.c.html#LN785"><span class='Ref_to_Parameter'>addr</span></a><span class='Operator'>-&GT;</span>sa_family <span class='Operator'>&& 
</span>        <a href="../../include/libpq/ifaddr.h.html#LN20"><span class='Ref_to_Proto'>pg_range_sockaddr</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hba.c.html#LN785"><span class='Ref_to_Parameter'>raddr</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/pqcomm.h.html#LN63"><span class='Ref_to_Member'>addr</span></a><span class='Delimiter'>, 
</span>                          <span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="../../include/libpq/pqcomm.h.html#LN43"><span class='Ref_to_Struct'>sockaddr_storage</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="hba.c.html#LN785"><span class='Ref_to_Parameter'>addr</span></a><span class='Delimiter'>, 
</span>                          <span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="../../include/libpq/pqcomm.h.html#LN43"><span class='Ref_to_Struct'>sockaddr_storage</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="hba.c.html#LN785"><span class='Ref_to_Parameter'>mask</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * pg_foreach_ifaddr callback: does client addr match this machine interface? 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN799"></a><span class='Declare_Function'>check_network_callback</span><span class='Parentheses'>(</span><span class='Control'>struct</span> sockaddr <span class='Operator'>* </span><span class='Declare_Parameter'>addr</span><span class='Delimiter'>, </span><span class='Control'>struct</span> sockaddr <span class='Operator'>* </span><span class='Declare_Parameter'>netmask</span><span class='Delimiter'>, 
</span><a name="LN800"></a>                       <span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>cb_data</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN802"></a>    <a href="hba.c.html#LN59"><span class='Ref_to_Struct'>check_network_data</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cn</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="hba.c.html#LN59"><span class='Ref_to_Struct'>check_network_data</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="hba.c.html#LN800"><span class='Ref_to_Parameter'>cb_data</span></a><span class='Delimiter'>; 
</span><a name="LN803"></a>    <span class='Control'>struct</span> <a href="../../include/libpq/pqcomm.h.html#LN43"><span class='Ref_to_Struct'>sockaddr_storage</span></a> <span class='Declare_Local'>mask</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Already found a match? */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN802"><span class='Ref_To_Local'>cn</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN63"><span class='Ref_to_Member'>result</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN802"><span class='Ref_To_Local'>cn</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN61"><span class='Ref_to_Member'>method</span></a> <span class='Operator'>== </span><a href="../../include/libpq/hba.h.html#LN47"><span class='Ref_to_EnumConst'>ipCmpSameHost</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Make an all-ones netmask of appropriate length for family */ 
</span>        <a href="../../include/libpq/ifaddr.h.html#LN24"><span class='Ref_to_Proto'>pg_sockaddr_cidr_mask</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hba.c.html#LN803"><span class='Ref_To_Local'>mask</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="hba.c.html#LN799"><span class='Ref_to_Parameter'>addr</span></a><span class='Operator'>-&GT;</span>sa_family<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="hba.c.html#LN802"><span class='Ref_To_Local'>cn</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN63"><span class='Ref_to_Member'>result</span></a> <span class='Operator'>= </span><a href="hba.c.html#LN784"><span class='Ref_to_Func'>check_ip</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN802"><span class='Ref_To_Local'>cn</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN62"><span class='Ref_to_Member'>raddr</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN799"><span class='Ref_to_Parameter'>addr</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Control'>struct</span> sockaddr <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>& </span><a href="hba.c.html#LN803"><span class='Ref_To_Local'>mask</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Use the netmask of the interface itself */ 
</span>        <a href="hba.c.html#LN802"><span class='Ref_To_Local'>cn</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN63"><span class='Ref_to_Member'>result</span></a> <span class='Operator'>= </span><a href="hba.c.html#LN784"><span class='Ref_to_Func'>check_ip</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN802"><span class='Ref_To_Local'>cn</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN62"><span class='Ref_to_Member'>raddr</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN799"><span class='Ref_to_Parameter'>addr</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN799"><span class='Ref_to_Parameter'>netmask</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end check_network_callback &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Use pg_foreach_ifaddr to check a samehost or samenet match 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN826"></a><span class='Declare_Function'>check_same_host_or_net</span><span class='Parentheses'>(</span><a href="../../include/libpq/pqcomm.h.html#LN61"><span class='Ref_to_Typedef'>SockAddr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>raddr</span><span class='Delimiter'>, </span><a href="../../include/libpq/hba.h.html#LN44"><span class='Ref_to_Enum'>IPCompareMethod</span></a> <span class='Declare_Parameter'>method</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN828"></a>    <a href="hba.c.html#LN59"><span class='Ref_to_Struct'>check_network_data</span></a> <span class='Declare_Local'>cn</span><span class='Delimiter'>; 
</span> 
    <a href="hba.c.html#LN828"><span class='Ref_To_Local'>cn</span></a><span class='Operator'>.</span><a href="hba.c.html#LN61"><span class='Ref_to_Member'>method</span></a> <span class='Operator'>= </span><a href="hba.c.html#LN826"><span class='Ref_to_Parameter'>method</span></a><span class='Delimiter'>; 
</span>    <a href="hba.c.html#LN828"><span class='Ref_To_Local'>cn</span></a><span class='Operator'>.</span><a href="hba.c.html#LN62"><span class='Ref_to_Member'>raddr</span></a> <span class='Operator'>= </span><a href="hba.c.html#LN826"><span class='Ref_to_Parameter'>raddr</span></a><span class='Delimiter'>; 
</span>    <a href="hba.c.html#LN828"><span class='Ref_To_Local'>cn</span></a><span class='Operator'>.</span><a href="hba.c.html#LN63"><span class='Ref_to_Member'>result</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    errno <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/libpq/ifaddr.h.html#LN27"><span class='Ref_to_Proto'>pg_foreach_ifaddr</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN798"><span class='Ref_to_Func'>check_network_callback</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="hba.c.html#LN828"><span class='Ref_To_Local'>cn</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, </span><span class='String'>"error enumerating network interfaces: %m"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="hba.c.html#LN828"><span class='Ref_To_Local'>cn</span></a><span class='Operator'>.</span><a href="hba.c.html#LN63"><span class='Ref_to_Member'>result</span></a><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Macros used to check and report on invalid configuration options. 
 * On error: log a message at level elevel, set *err_msg, and exit the function. 
 * These macros are not as general-purpose as they look, because they know 
 * what the calling function's error-exit value is. 
 * 
 * INVALID_AUTH_OPTION = reports when an option is specified for a method where it's 
 *                       not supported. 
 * REQUIRE_AUTH_OPTION = same as INVALID_AUTH_OPTION, except it also checks if the 
 *                       method is actually the one specified. Used as a shortcut when 
 *                       the option is only valid for one authentication method. 
 * MANDATORY_AUTH_ARG  = check if a required option is set for an authentication method, 
 *                       reporting error if it's not. 
 */ 
</span><a name="LN859"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>INVALID_AUTH_OPTION</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>optname</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>validmethods</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span><span class='Control'>do</span> <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../commands/vacuumlazy.c.html#LN136"><span class='Ref_to_Global_Var'>elevel</span></a><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONFIG_FILE_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>             <span class='Comment_Multi_Line'>/* translator: the second %s is a list of auth methods */ </span><span class='Operator'>\ 
</span>             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"authentication option \"%s\" is only valid for authentication methods %s"</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>                    <a href="hba.c.html#LN859"><span class='Ref_to_Parameter'>optname</span></a><span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><a href="hba.c.html#LN859"><span class='Ref_to_Parameter'>validmethods</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>             errcontext<span class='Parentheses'>(</span><span class='String'>"line %d of configuration file \"%s\""</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>                    line_num<span class='Delimiter'>, </span><a href="../utils/misc/guc.c.html#LN462"><span class='Ref_to_Global_Var'>HbaFileName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>    <span class='Operator'>*</span>err_msg <span class='Operator'>= </span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"authentication option \"%s\" is only valid for authentication methods %s"</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>                        <a href="hba.c.html#LN859"><span class='Ref_to_Parameter'>optname</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN859"><span class='Ref_to_Parameter'>validmethods</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span><span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) 
</span> 
<a name="LN873"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>REQUIRE_AUTH_OPTION</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>methodval</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>optname</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>validmethods</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span><span class='Control'>do</span> <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>hbaline<span class='Operator'>-&GT;</span>auth_method <span class='Operator'>!= </span><a href="hba.c.html#LN873"><span class='Ref_to_Parameter'>methodval</span></a><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>        <a href="hba.c.html#LN859"><span class='Ref_to_Macro'>INVALID_AUTH_OPTION</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN873"><span class='Ref_to_Parameter'>optname</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN873"><span class='Ref_to_Parameter'>validmethods</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span><span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) 
</span> 
<a name="LN879"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>MANDATORY_AUTH_ARG</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>argvar</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>argname</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>authname</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span><span class='Control'>do</span> <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN879"><span class='Ref_to_Parameter'>argvar</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) </span><span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../commands/vacuumlazy.c.html#LN136"><span class='Ref_to_Global_Var'>elevel</span></a><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONFIG_FILE_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"authentication method \"%s\" requires argument \"%s\" to be set"</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>                        <a href="hba.c.html#LN879"><span class='Ref_to_Parameter'>authname</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN879"><span class='Ref_to_Parameter'>argname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>                 errcontext<span class='Parentheses'>(</span><span class='String'>"line %d of configuration file \"%s\""</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>                        line_num<span class='Delimiter'>, </span><a href="../utils/misc/guc.c.html#LN462"><span class='Ref_to_Global_Var'>HbaFileName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Operator'>*</span>err_msg <span class='Operator'>= </span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"authentication method \"%s\" requires argument \"%s\" to be set"</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>                            <a href="hba.c.html#LN879"><span class='Ref_to_Parameter'>authname</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN879"><span class='Ref_to_Parameter'>argname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>    <span class='Delimiter'>} </span><span class='Operator'>\ 
</span><span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Macros for handling pg_ident problems. 
 * Much as above, but currently the message level is hardwired as LOG 
 * and there is no provision for an err_msg string. 
 * 
 * IDENT_FIELD_ABSENT: 
 * Log a message and exit the function if the given ident field ListCell is 
 * not populated. 
 * 
 * IDENT_MULTI_VALUE: 
 * Log a message and exit the function if the given ident token List has more 
 * than one element. 
 */ 
</span><a name="LN907"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>IDENT_FIELD_ABSENT</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>field</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span><span class='Control'>do</span> <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="hba.c.html#LN907"><span class='Ref_to_Parameter'>field</span></a><span class='Parentheses'>) </span><span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONFIG_FILE_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"missing entry in file \"%s\" at end of line %d"</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>                        <a href="../utils/misc/guc.c.html#LN463"><span class='Ref_to_Global_Var'>IdentFileName</span></a><span class='Delimiter'>, </span>line_num<span class='Parentheses'>)))</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>    <span class='Delimiter'>} </span><span class='Operator'>\ 
</span><span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) 
</span> 
<a name="LN918"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>IDENT_MULTI_VALUE</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>tokens</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span><span class='Control'>do</span> <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN918"><span class='Ref_to_Parameter'>tokens</span></a><span class='Operator'>-&GT;</span>length <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONFIG_FILE_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"multiple values in ident field"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>                 errcontext<span class='Parentheses'>(</span><span class='String'>"line %d of configuration file \"%s\""</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>                            line_num<span class='Delimiter'>, </span><a href="../utils/misc/guc.c.html#LN463"><span class='Ref_to_Global_Var'>IdentFileName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>    <span class='Delimiter'>} </span><span class='Operator'>\ 
</span><span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Parse one tokenised line from the hba config file and store the result in a 
 * HbaLine structure. 
 * 
 * If parsing fails, log a message at ereport level elevel, store an error 
 * string in tok_line-&GT;err_msg, and return NULL.  (Some non-error conditions 
 * can also result in such messages.) 
 * 
 * Note: this function leaks memory when an error occurs.  Caller is expected 
 * to have set a memory context that will be reset if this function returns 
 * NULL. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/libpq/hba.h.html#LN60"><span class='Ref_to_Struct'>HbaLine</span></a> <span class='Operator'>* 
</span><a name="LN944"></a><span class='Declare_Function'>parse_hba_line</span><span class='Parentheses'>(</span><a href="hba.c.html#LN88"><span class='Ref_to_Struct'>TokenizedLine</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tok_line</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>elevel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN946"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>line_num</span> <span class='Operator'>= </span><a href="hba.c.html#LN944"><span class='Ref_to_Parameter'>tok_line</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN91"><span class='Ref_to_Member'>line_num</span></a><span class='Delimiter'>; 
</span><a name="LN947"></a>    <span class='Keyword'>char</span>      <span class='Operator'>**</span><span class='Declare_Local'>err_msg</span> <span class='Operator'>= &</span><a href="hba.c.html#LN944"><span class='Ref_to_Parameter'>tok_line</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN93"><span class='Ref_to_Member'>err_msg</span></a><span class='Delimiter'>; 
</span><a name="LN948"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>str</span><span class='Delimiter'>; 
</span><a name="LN949"></a>    <span class='Control'>struct</span> <a href="../../include/getaddrinfo.h.html#LN114"><span class='Ref_to_Struct'>addrinfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>gai_result</span><span class='Delimiter'>; 
</span><a name="LN950"></a>    <span class='Control'>struct</span> <a href="../../include/getaddrinfo.h.html#LN114"><span class='Ref_to_Struct'>addrinfo</span></a> <span class='Declare_Local'>hints</span><span class='Delimiter'>; 
</span><a name="LN951"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ret</span><span class='Delimiter'>; 
</span><a name="LN952"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>cidr_slash</span><span class='Delimiter'>; 
</span><a name="LN953"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>unsupauth</span><span class='Delimiter'>; 
</span><a name="LN954"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>field</span><span class='Delimiter'>; 
</span><a name="LN955"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>tokens</span><span class='Delimiter'>; 
</span><a name="LN956"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>tokencell</span><span class='Delimiter'>; 
</span><a name="LN957"></a>    <a href="hba.c.html#LN74"><span class='Ref_to_Struct'>HbaToken</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>token</span><span class='Delimiter'>; 
</span><a name="LN958"></a>    <a href="../../include/libpq/hba.h.html#LN60"><span class='Ref_to_Struct'>HbaLine</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>parsedline</span><span class='Delimiter'>; 
</span> 
    <a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/libpq/hba.h.html#LN60"><span class='Ref_to_Struct'>HbaLine</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN62"><span class='Ref_to_Member'>linenumber</span></a> <span class='Operator'>= </span><a href="hba.c.html#LN946"><span class='Ref_To_Local'>line_num</span></a><span class='Delimiter'>; 
</span>    <a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN63"><span class='Ref_to_Member'>rawline</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN944"><span class='Ref_to_Parameter'>tok_line</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN92"><span class='Ref_to_Member'>raw_line</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check the record type. */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="hba.c.html#LN944"><span class='Ref_to_Parameter'>tok_line</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN90"><span class='Ref_to_Member'>fields</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="hba.c.html#LN954"><span class='Ref_To_Local'>field</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN75"><span class='Ref_to_Func'>list_head</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN944"><span class='Ref_to_Parameter'>tok_line</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN90"><span class='Ref_to_Member'>fields</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="hba.c.html#LN955"><span class='Ref_To_Local'>tokens</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN954"><span class='Ref_To_Local'>field</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN955"><span class='Ref_To_Local'>tokens</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/pg_list.h.html#LN47"><span class='Ref_to_Member'>length</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN944"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONFIG_FILE_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"multiple values specified for connection type"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Specify exactly one connection type per line."</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 errcontext<span class='Parentheses'>(</span><span class='String'>"line %d of configuration file \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="hba.c.html#LN946"><span class='Ref_To_Local'>line_num</span></a><span class='Delimiter'>, </span><a href="../utils/misc/guc.c.html#LN462"><span class='Ref_to_Global_Var'>HbaFileName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="hba.c.html#LN947"><span class='Ref_To_Local'>err_msg</span></a> <span class='Operator'>= </span><span class='String'>"multiple values specified for connection type"</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="hba.c.html#LN957"><span class='Ref_To_Local'>token</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN955"><span class='Ref_To_Local'>tokens</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN957"><span class='Ref_To_Local'>token</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN76"><span class='Ref_to_Member'>string</span></a><span class='Delimiter'>, </span><span class='String'>"local"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> HAVE_UNIX_SOCKETS 
        <a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN64"><span class='Ref_to_Member'>conntype</span></a> <span class='Operator'>= </span><a href="../../include/libpq/hba.h.html#LN54"><span class='Ref_to_EnumConst'>ctLocal</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN944"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONFIG_FILE_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"local connections are not supported by this build"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 errcontext<span class='Parentheses'>(</span><span class='String'>"line %d of configuration file \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="hba.c.html#LN946"><span class='Ref_To_Local'>line_num</span></a><span class='Delimiter'>, </span><a href="../utils/misc/guc.c.html#LN462"><span class='Ref_to_Global_Var'>HbaFileName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="hba.c.html#LN947"><span class='Ref_To_Local'>err_msg</span></a> <span class='Operator'>= </span><span class='String'>"local connections are not supported by this build"</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN957"><span class='Ref_To_Local'>token</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN76"><span class='Ref_to_Member'>string</span></a><span class='Delimiter'>, </span><span class='String'>"host"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>             strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN957"><span class='Ref_To_Local'>token</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN76"><span class='Ref_to_Member'>string</span></a><span class='Delimiter'>, </span><span class='String'>"hostssl"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>             strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN957"><span class='Ref_To_Local'>token</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN76"><span class='Ref_to_Member'>string</span></a><span class='Delimiter'>, </span><span class='String'>"hostnossl"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN957"><span class='Ref_To_Local'>token</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN76"><span class='Ref_to_Member'>string</span></a><span class='Delimiter'>[</span><span class='Number'>4</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'s'</span><span class='Parentheses'>)</span>    <span class='Comment_Single_Line'>/* "hostssl" */ 
</span>        <span class='Delimiter'>{ 
</span>            <a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN64"><span class='Ref_to_Member'>conntype</span></a> <span class='Operator'>= </span><a href="../../include/libpq/hba.h.html#LN56"><span class='Ref_to_EnumConst'>ctHostSSL</span></a><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Log a warning if SSL support is not active */ 
</span><span class='Directive'>#ifdef</span> <a href="../../include/pg_config_manual.h.html#LN172"><span class='Ref_to_Const'>USE_SSL</span></a> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../postmaster/postmaster.c.html#LN232"><span class='Ref_to_Global_Var'>EnableSSL</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN944"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONFIG_FILE_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"hostssl record cannot match because SSL is disabled"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Set ssl = on in postgresql.conf."</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         errcontext<span class='Parentheses'>(</span><span class='String'>"line %d of configuration file \"%s\""</span><span class='Delimiter'>, 
</span>                                    <a href="hba.c.html#LN946"><span class='Ref_To_Local'>line_num</span></a><span class='Delimiter'>, </span><a href="../utils/misc/guc.c.html#LN462"><span class='Ref_to_Global_Var'>HbaFileName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><a href="hba.c.html#LN947"><span class='Ref_To_Local'>err_msg</span></a> <span class='Operator'>= </span><span class='String'>"hostssl record cannot match because SSL is disabled"</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span><span class='Directive'>#else</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN944"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONFIG_FILE_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"hostssl record cannot match because SSL is not supported by this build"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>              <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Compile with --with-openssl to use SSL connections."</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     errcontext<span class='Parentheses'>(</span><span class='String'>"line %d of configuration file \"%s\""</span><span class='Delimiter'>, 
</span>                                <a href="hba.c.html#LN946"><span class='Ref_To_Local'>line_num</span></a><span class='Delimiter'>, </span><a href="../utils/misc/guc.c.html#LN462"><span class='Ref_to_Global_Var'>HbaFileName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="hba.c.html#LN947"><span class='Ref_To_Local'>err_msg</span></a> <span class='Operator'>= </span><span class='String'>"hostssl record cannot match because SSL is not supported by this build"</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if token-&GT;string[4]=='s' &raquo; </span> 
        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN957"><span class='Ref_To_Local'>token</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN76"><span class='Ref_to_Member'>string</span></a><span class='Delimiter'>[</span><span class='Number'>4</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'n'</span><span class='Parentheses'>)</span>       <span class='Comment_Single_Line'>/* "hostnossl" */ 
</span>        <span class='Delimiter'>{ 
</span>            <a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN64"><span class='Ref_to_Member'>conntype</span></a> <span class='Operator'>= </span><a href="../../include/libpq/hba.h.html#LN57"><span class='Ref_to_EnumConst'>ctHostNoSSL</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* "host" */ 
</span>            <a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN64"><span class='Ref_to_Member'>conntype</span></a> <span class='Operator'>= </span><a href="../../include/libpq/hba.h.html#LN55"><span class='Ref_to_EnumConst'>ctHost</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if strcmp(token-&GT;string,... &raquo; </span>                           <span class='Comment_Single_Line'>/* record type */ 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN944"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONFIG_FILE_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid connection type \"%s\""</span><span class='Delimiter'>, 
</span>                        <a href="hba.c.html#LN957"><span class='Ref_To_Local'>token</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN76"><span class='Ref_to_Member'>string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 errcontext<span class='Parentheses'>(</span><span class='String'>"line %d of configuration file \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="hba.c.html#LN946"><span class='Ref_To_Local'>line_num</span></a><span class='Delimiter'>, </span><a href="../utils/misc/guc.c.html#LN462"><span class='Ref_to_Global_Var'>HbaFileName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="hba.c.html#LN947"><span class='Ref_To_Local'>err_msg</span></a> <span class='Operator'>= </span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"invalid connection type \"%s\""</span><span class='Delimiter'>, </span><a href="hba.c.html#LN957"><span class='Ref_To_Local'>token</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN76"><span class='Ref_to_Member'>string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Get the databases. */ 
</span>    <a href="hba.c.html#LN954"><span class='Ref_To_Local'>field</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN954"><span class='Ref_To_Local'>field</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="hba.c.html#LN954"><span class='Ref_To_Local'>field</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN944"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONFIG_FILE_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"end-of-line before database specification"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 errcontext<span class='Parentheses'>(</span><span class='String'>"line %d of configuration file \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="hba.c.html#LN946"><span class='Ref_To_Local'>line_num</span></a><span class='Delimiter'>, </span><a href="../utils/misc/guc.c.html#LN462"><span class='Ref_to_Global_Var'>HbaFileName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="hba.c.html#LN947"><span class='Ref_To_Local'>err_msg</span></a> <span class='Operator'>= </span><span class='String'>"end-of-line before database specification"</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN65"><span class='Ref_to_Member'>databases</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="hba.c.html#LN955"><span class='Ref_To_Local'>tokens</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN954"><span class='Ref_To_Local'>field</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN956"><span class='Ref_To_Local'>tokencell</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN955"><span class='Ref_To_Local'>tokens</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN65"><span class='Ref_to_Member'>databases</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN65"><span class='Ref_to_Member'>databases</span></a><span class='Delimiter'>, 
</span>                                        <a href="hba.c.html#LN305"><span class='Ref_to_Func'>copy_hba_token</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN956"><span class='Ref_To_Local'>tokencell</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Get the roles. */ 
</span>    <a href="hba.c.html#LN954"><span class='Ref_To_Local'>field</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN954"><span class='Ref_To_Local'>field</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="hba.c.html#LN954"><span class='Ref_To_Local'>field</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN944"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONFIG_FILE_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"end-of-line before role specification"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 errcontext<span class='Parentheses'>(</span><span class='String'>"line %d of configuration file \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="hba.c.html#LN946"><span class='Ref_To_Local'>line_num</span></a><span class='Delimiter'>, </span><a href="../utils/misc/guc.c.html#LN462"><span class='Ref_to_Global_Var'>HbaFileName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="hba.c.html#LN947"><span class='Ref_To_Local'>err_msg</span></a> <span class='Operator'>= </span><span class='String'>"end-of-line before role specification"</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN66"><span class='Ref_to_Member'>roles</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="hba.c.html#LN955"><span class='Ref_To_Local'>tokens</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN954"><span class='Ref_To_Local'>field</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN956"><span class='Ref_To_Local'>tokencell</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN955"><span class='Ref_To_Local'>tokens</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN66"><span class='Ref_to_Member'>roles</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN66"><span class='Ref_to_Member'>roles</span></a><span class='Delimiter'>, 
</span>                                    <a href="hba.c.html#LN305"><span class='Ref_to_Func'>copy_hba_token</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN956"><span class='Ref_To_Local'>tokencell</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN64"><span class='Ref_to_Member'>conntype</span></a> <span class='Operator'>!= </span><a href="../../include/libpq/hba.h.html#LN54"><span class='Ref_to_EnumConst'>ctLocal</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Read the IP address field. (with or without CIDR netmask) */ 
</span>        <a href="hba.c.html#LN954"><span class='Ref_To_Local'>field</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN954"><span class='Ref_To_Local'>field</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="hba.c.html#LN954"><span class='Ref_To_Local'>field</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN944"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONFIG_FILE_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"end-of-line before IP address specification"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     errcontext<span class='Parentheses'>(</span><span class='String'>"line %d of configuration file \"%s\""</span><span class='Delimiter'>, 
</span>                                <a href="hba.c.html#LN946"><span class='Ref_To_Local'>line_num</span></a><span class='Delimiter'>, </span><a href="../utils/misc/guc.c.html#LN462"><span class='Ref_to_Global_Var'>HbaFileName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="hba.c.html#LN947"><span class='Ref_To_Local'>err_msg</span></a> <span class='Operator'>= </span><span class='String'>"end-of-line before IP address specification"</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="hba.c.html#LN955"><span class='Ref_To_Local'>tokens</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN954"><span class='Ref_To_Local'>field</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN955"><span class='Ref_To_Local'>tokens</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/pg_list.h.html#LN47"><span class='Ref_to_Member'>length</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN944"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONFIG_FILE_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"multiple values specified for host address"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Specify one address range per line."</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     errcontext<span class='Parentheses'>(</span><span class='String'>"line %d of configuration file \"%s\""</span><span class='Delimiter'>, 
</span>                                <a href="hba.c.html#LN946"><span class='Ref_To_Local'>line_num</span></a><span class='Delimiter'>, </span><a href="../utils/misc/guc.c.html#LN462"><span class='Ref_to_Global_Var'>HbaFileName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="hba.c.html#LN947"><span class='Ref_To_Local'>err_msg</span></a> <span class='Operator'>= </span><span class='String'>"multiple values specified for host address"</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="hba.c.html#LN957"><span class='Ref_To_Local'>token</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN955"><span class='Ref_To_Local'>tokens</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN67"><span class='Ref_to_Macro'>token_is_keyword</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN957"><span class='Ref_To_Local'>token</span></a><span class='Delimiter'>, </span><span class='String'>"all"</span><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN69"><span class='Ref_to_Member'>ip_cmp_method</span></a> <span class='Operator'>= </span><a href="../../include/libpq/hba.h.html#LN49"><span class='Ref_to_EnumConst'>ipCmpAll</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN67"><span class='Ref_to_Macro'>token_is_keyword</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN957"><span class='Ref_To_Local'>token</span></a><span class='Delimiter'>, </span><span class='String'>"samehost"</span><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Any IP on this host is allowed to connect */ 
</span>            <a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN69"><span class='Ref_to_Member'>ip_cmp_method</span></a> <span class='Operator'>= </span><a href="../../include/libpq/hba.h.html#LN47"><span class='Ref_to_EnumConst'>ipCmpSameHost</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN67"><span class='Ref_to_Macro'>token_is_keyword</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN957"><span class='Ref_To_Local'>token</span></a><span class='Delimiter'>, </span><span class='String'>"samenet"</span><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Any IP on the host's subnets is allowed to connect */ 
</span>            <a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN69"><span class='Ref_to_Member'>ip_cmp_method</span></a> <span class='Operator'>= </span><a href="../../include/libpq/hba.h.html#LN48"><span class='Ref_to_EnumConst'>ipCmpSameNet</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* IP and netmask are specified */ 
</span>            <a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN69"><span class='Ref_to_Member'>ip_cmp_method</span></a> <span class='Operator'>= </span><a href="../../include/libpq/hba.h.html#LN46"><span class='Ref_to_EnumConst'>ipCmpMask</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* need a modifiable copy of token */ 
</span>            <a href="hba.c.html#LN948"><span class='Ref_To_Local'>str</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN957"><span class='Ref_To_Local'>token</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN76"><span class='Ref_to_Member'>string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Check if it has a CIDR suffix and if so isolate it */ 
</span>            <a href="hba.c.html#LN952"><span class='Ref_To_Local'>cidr_slash</span></a> <span class='Operator'>= </span>strchr<span class='Parentheses'>(</span><a href="hba.c.html#LN948"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, </span><span class='String'>'/'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN952"><span class='Ref_To_Local'>cidr_slash</span></a><span class='Parentheses'>) 
</span>                <span class='Operator'>*</span><a href="hba.c.html#LN952"><span class='Ref_To_Local'>cidr_slash</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Get the IP address either way */ 
</span>            <a href="hba.c.html#LN950"><span class='Ref_To_Local'>hints</span></a><span class='Operator'>.</span><a href="../../include/getaddrinfo.h.html#LN99"><span class='Ref_to_Member'>ai_flags</span></a> <span class='Operator'>= </span><a href="../../include/getaddrinfo.h.html#LN70"><span class='Ref_to_Const'>AI_NUMERICHOST</span></a><span class='Delimiter'>; 
</span>            <a href="hba.c.html#LN950"><span class='Ref_To_Local'>hints</span></a><span class='Operator'>.</span><a href="../../include/getaddrinfo.h.html#LN100"><span class='Ref_to_Member'>ai_family</span></a> <span class='Operator'>= </span>AF_UNSPEC<span class='Delimiter'>; 
</span>            <a href="hba.c.html#LN950"><span class='Ref_To_Local'>hints</span></a><span class='Operator'>.</span><a href="../../include/getaddrinfo.h.html#LN101"><span class='Ref_to_Member'>ai_socktype</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="hba.c.html#LN950"><span class='Ref_To_Local'>hints</span></a><span class='Operator'>.</span><a href="../../include/getaddrinfo.h.html#LN102"><span class='Ref_to_Member'>ai_protocol</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="hba.c.html#LN950"><span class='Ref_To_Local'>hints</span></a><span class='Operator'>.</span><a href="../../include/getaddrinfo.h.html#LN103"><span class='Ref_to_Member'>ai_addrlen</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="hba.c.html#LN950"><span class='Ref_To_Local'>hints</span></a><span class='Operator'>.</span><a href="../../include/getaddrinfo.h.html#LN105"><span class='Ref_to_Member'>ai_canonname</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <a href="hba.c.html#LN950"><span class='Ref_To_Local'>hints</span></a><span class='Operator'>.</span><a href="../../include/getaddrinfo.h.html#LN104"><span class='Ref_to_Member'>ai_addr</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <a href="hba.c.html#LN950"><span class='Ref_To_Local'>hints</span></a><span class='Operator'>.</span><a href="../../include/getaddrinfo.h.html#LN106"><span class='Ref_to_Member'>ai_next</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
            <a href="hba.c.html#LN951"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><a href="../../include/common/ip.h.html#LN26"><span class='Ref_to_Proto'>pg_getaddrinfo_all</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN948"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="hba.c.html#LN950"><span class='Ref_To_Local'>hints</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="hba.c.html#LN949"><span class='Ref_To_Local'>gai_result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN951"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="hba.c.html#LN949"><span class='Ref_To_Local'>gai_result</span></a><span class='Parentheses'>) 
</span>                memcpy<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN67"><span class='Ref_to_Member'>addr</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN949"><span class='Ref_To_Local'>gai_result</span></a><span class='Operator'>-&GT;</span><a href="../../include/getaddrinfo.h.html#LN104"><span class='Ref_to_Member'>ai_addr</span></a><span class='Delimiter'>, 
</span>                       <a href="hba.c.html#LN949"><span class='Ref_To_Local'>gai_result</span></a><span class='Operator'>-&GT;</span><a href="../../include/getaddrinfo.h.html#LN103"><span class='Ref_to_Member'>ai_addrlen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN951"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>== </span><a href="../../include/getaddrinfo.h.html#LN33"><span class='Ref_to_Const'>EAI_NONAME</span></a><span class='Parentheses'>) 
</span>                <a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN70"><span class='Ref_to_Member'>hostname</span></a> <span class='Operator'>= </span><a href="hba.c.html#LN948"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN944"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONFIG_FILE_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid IP address \"%s\": %s"</span><span class='Delimiter'>, 
</span>                                <a href="hba.c.html#LN948"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, </span><a href="../../include/getaddrinfo.h.html#LN155"><span class='Ref_to_Proto'>gai_strerror</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN951"><span class='Ref_To_Local'>ret</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                         errcontext<span class='Parentheses'>(</span><span class='String'>"line %d of configuration file \"%s\""</span><span class='Delimiter'>, 
</span>                                    <a href="hba.c.html#LN946"><span class='Ref_To_Local'>line_num</span></a><span class='Delimiter'>, </span><a href="../utils/misc/guc.c.html#LN462"><span class='Ref_to_Global_Var'>HbaFileName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><a href="hba.c.html#LN947"><span class='Ref_To_Local'>err_msg</span></a> <span class='Operator'>= </span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"invalid IP address \"%s\": %s"</span><span class='Delimiter'>, 
</span>                                    <a href="hba.c.html#LN948"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, </span><a href="../../include/getaddrinfo.h.html#LN155"><span class='Ref_to_Proto'>gai_strerror</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN951"><span class='Ref_To_Local'>ret</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN949"><span class='Ref_To_Local'>gai_result</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/common/ip.h.html#LN29"><span class='Ref_to_Proto'>pg_freeaddrinfo_all</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN950"><span class='Ref_To_Local'>hints</span></a><span class='Operator'>.</span><a href="../../include/getaddrinfo.h.html#LN100"><span class='Ref_to_Member'>ai_family</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN949"><span class='Ref_To_Local'>gai_result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="../../include/common/ip.h.html#LN29"><span class='Ref_to_Proto'>pg_freeaddrinfo_all</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN950"><span class='Ref_To_Local'>hints</span></a><span class='Operator'>.</span><a href="../../include/getaddrinfo.h.html#LN100"><span class='Ref_to_Member'>ai_family</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN949"><span class='Ref_To_Local'>gai_result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Get the netmask */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN952"><span class='Ref_To_Local'>cidr_slash</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN70"><span class='Ref_to_Member'>hostname</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN944"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONFIG_FILE_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"specifying both host name and CIDR mask is invalid: \"%s\""</span><span class='Delimiter'>, 
</span>                                    <a href="hba.c.html#LN957"><span class='Ref_To_Local'>token</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN76"><span class='Ref_to_Member'>string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           errcontext<span class='Parentheses'>(</span><span class='String'>"line %d of configuration file \"%s\""</span><span class='Delimiter'>, 
</span>                                      <a href="hba.c.html#LN946"><span class='Ref_To_Local'>line_num</span></a><span class='Delimiter'>, </span><a href="../utils/misc/guc.c.html#LN462"><span class='Ref_to_Global_Var'>HbaFileName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <span class='Operator'>*</span><a href="hba.c.html#LN947"><span class='Ref_To_Local'>err_msg</span></a> <span class='Operator'>= </span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"specifying both host name and CIDR mask is invalid: \"%s\""</span><span class='Delimiter'>, 
</span>                                        <a href="hba.c.html#LN957"><span class='Ref_To_Local'>token</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN76"><span class='Ref_to_Member'>string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/libpq/ifaddr.h.html#LN24"><span class='Ref_to_Proto'>pg_sockaddr_cidr_mask</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN68"><span class='Ref_to_Member'>mask</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN952"><span class='Ref_To_Local'>cidr_slash</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                          <a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN67"><span class='Ref_to_Member'>addr</span></a><span class='Operator'>.</span>ss_family<span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN944"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONFIG_FILE_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid CIDR mask in address \"%s\""</span><span class='Delimiter'>, 
</span>                                    <a href="hba.c.html#LN957"><span class='Ref_To_Local'>token</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN76"><span class='Ref_to_Member'>string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           errcontext<span class='Parentheses'>(</span><span class='String'>"line %d of configuration file \"%s\""</span><span class='Delimiter'>, 
</span>                                      <a href="hba.c.html#LN946"><span class='Ref_To_Local'>line_num</span></a><span class='Delimiter'>, </span><a href="../utils/misc/guc.c.html#LN462"><span class='Ref_to_Global_Var'>HbaFileName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <span class='Operator'>*</span><a href="hba.c.html#LN947"><span class='Ref_To_Local'>err_msg</span></a> <span class='Operator'>= </span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"invalid CIDR mask in address \"%s\""</span><span class='Delimiter'>, 
</span>                                        <a href="hba.c.html#LN957"><span class='Ref_To_Local'>token</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN76"><span class='Ref_to_Member'>string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN948"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if cidr_slash &raquo; </span> 
            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN70"><span class='Ref_to_Member'>hostname</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Read the mask field. */ 
</span>                <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN948"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="hba.c.html#LN954"><span class='Ref_To_Local'>field</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN954"><span class='Ref_To_Local'>field</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="hba.c.html#LN954"><span class='Ref_To_Local'>field</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN944"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONFIG_FILE_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                          <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"end-of-line before netmask specification"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Specify an address range in CIDR notation, or provide a separate netmask."</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           errcontext<span class='Parentheses'>(</span><span class='String'>"line %d of configuration file \"%s\""</span><span class='Delimiter'>, 
</span>                                      <a href="hba.c.html#LN946"><span class='Ref_To_Local'>line_num</span></a><span class='Delimiter'>, </span><a href="../utils/misc/guc.c.html#LN462"><span class='Ref_to_Global_Var'>HbaFileName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <span class='Operator'>*</span><a href="hba.c.html#LN947"><span class='Ref_To_Local'>err_msg</span></a> <span class='Operator'>= </span><span class='String'>"end-of-line before netmask specification"</span><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="hba.c.html#LN955"><span class='Ref_To_Local'>tokens</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN954"><span class='Ref_To_Local'>field</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN955"><span class='Ref_To_Local'>tokens</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/pg_list.h.html#LN47"><span class='Ref_to_Member'>length</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN944"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONFIG_FILE_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"multiple values specified for netmask"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           errcontext<span class='Parentheses'>(</span><span class='String'>"line %d of configuration file \"%s\""</span><span class='Delimiter'>, 
</span>                                      <a href="hba.c.html#LN946"><span class='Ref_To_Local'>line_num</span></a><span class='Delimiter'>, </span><a href="../utils/misc/guc.c.html#LN462"><span class='Ref_to_Global_Var'>HbaFileName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <span class='Operator'>*</span><a href="hba.c.html#LN947"><span class='Ref_To_Local'>err_msg</span></a> <span class='Operator'>= </span><span class='String'>"multiple values specified for netmask"</span><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="hba.c.html#LN957"><span class='Ref_To_Local'>token</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN955"><span class='Ref_To_Local'>tokens</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="hba.c.html#LN951"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><a href="../../include/common/ip.h.html#LN26"><span class='Ref_to_Proto'>pg_getaddrinfo_all</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN957"><span class='Ref_To_Local'>token</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN76"><span class='Ref_to_Member'>string</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                         <span class='Operator'>&</span><a href="hba.c.html#LN950"><span class='Ref_To_Local'>hints</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="hba.c.html#LN949"><span class='Ref_To_Local'>gai_result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN951"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>|| !</span><a href="hba.c.html#LN949"><span class='Ref_To_Local'>gai_result</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN944"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONFIG_FILE_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid IP mask \"%s\": %s"</span><span class='Delimiter'>, 
</span>                                    <a href="hba.c.html#LN957"><span class='Ref_To_Local'>token</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN76"><span class='Ref_to_Member'>string</span></a><span class='Delimiter'>, </span><a href="../../include/getaddrinfo.h.html#LN155"><span class='Ref_to_Proto'>gai_strerror</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN951"><span class='Ref_To_Local'>ret</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                           errcontext<span class='Parentheses'>(</span><span class='String'>"line %d of configuration file \"%s\""</span><span class='Delimiter'>, 
</span>                                      <a href="hba.c.html#LN946"><span class='Ref_To_Local'>line_num</span></a><span class='Delimiter'>, </span><a href="../utils/misc/guc.c.html#LN462"><span class='Ref_to_Global_Var'>HbaFileName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <span class='Operator'>*</span><a href="hba.c.html#LN947"><span class='Ref_To_Local'>err_msg</span></a> <span class='Operator'>= </span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"invalid IP mask \"%s\": %s"</span><span class='Delimiter'>, 
</span>                                        <a href="hba.c.html#LN957"><span class='Ref_To_Local'>token</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN76"><span class='Ref_to_Member'>string</span></a><span class='Delimiter'>, </span><a href="../../include/getaddrinfo.h.html#LN155"><span class='Ref_to_Proto'>gai_strerror</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN951"><span class='Ref_To_Local'>ret</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN949"><span class='Ref_To_Local'>gai_result</span></a><span class='Parentheses'>) 
</span>                        <a href="../../include/common/ip.h.html#LN29"><span class='Ref_to_Proto'>pg_freeaddrinfo_all</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN950"><span class='Ref_To_Local'>hints</span></a><span class='Operator'>.</span><a href="../../include/getaddrinfo.h.html#LN100"><span class='Ref_to_Member'>ai_family</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN949"><span class='Ref_To_Local'>gai_result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                memcpy<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN68"><span class='Ref_to_Member'>mask</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN949"><span class='Ref_To_Local'>gai_result</span></a><span class='Operator'>-&GT;</span><a href="../../include/getaddrinfo.h.html#LN104"><span class='Ref_to_Member'>ai_addr</span></a><span class='Delimiter'>, 
</span>                       <a href="hba.c.html#LN949"><span class='Ref_To_Local'>gai_result</span></a><span class='Operator'>-&GT;</span><a href="../../include/getaddrinfo.h.html#LN103"><span class='Ref_to_Member'>ai_addrlen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/common/ip.h.html#LN29"><span class='Ref_to_Proto'>pg_freeaddrinfo_all</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN950"><span class='Ref_To_Local'>hints</span></a><span class='Operator'>.</span><a href="../../include/getaddrinfo.h.html#LN100"><span class='Ref_to_Member'>ai_family</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN949"><span class='Ref_To_Local'>gai_result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN67"><span class='Ref_to_Member'>addr</span></a><span class='Operator'>.</span>ss_family <span class='Operator'>!= </span><a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN68"><span class='Ref_to_Member'>mask</span></a><span class='Operator'>.</span>ss_family<span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN944"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONFIG_FILE_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"IP address and mask do not match"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           errcontext<span class='Parentheses'>(</span><span class='String'>"line %d of configuration file \"%s\""</span><span class='Delimiter'>, 
</span>                                      <a href="hba.c.html#LN946"><span class='Ref_To_Local'>line_num</span></a><span class='Delimiter'>, </span><a href="../utils/misc/guc.c.html#LN462"><span class='Ref_to_Global_Var'>HbaFileName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <span class='Operator'>*</span><a href="hba.c.html#LN947"><span class='Ref_To_Local'>err_msg</span></a> <span class='Operator'>= </span><span class='String'>"IP address and mask do not match"</span><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !parsedline-&GT;hostname &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if parsedline-&GT;conntype!... &raquo; </span>                           <span class='Comment_Single_Line'>/* != ctLocal */ 
</span> 
    <span class='Comment_Multi_Line'>/* Get the authentication method */ 
</span>    <a href="hba.c.html#LN954"><span class='Ref_To_Local'>field</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN954"><span class='Ref_To_Local'>field</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="hba.c.html#LN954"><span class='Ref_To_Local'>field</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN944"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONFIG_FILE_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"end-of-line before authentication method"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 errcontext<span class='Parentheses'>(</span><span class='String'>"line %d of configuration file \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="hba.c.html#LN946"><span class='Ref_To_Local'>line_num</span></a><span class='Delimiter'>, </span><a href="../utils/misc/guc.c.html#LN462"><span class='Ref_to_Global_Var'>HbaFileName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="hba.c.html#LN947"><span class='Ref_To_Local'>err_msg</span></a> <span class='Operator'>= </span><span class='String'>"end-of-line before authentication method"</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="hba.c.html#LN955"><span class='Ref_To_Local'>tokens</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN954"><span class='Ref_To_Local'>field</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN955"><span class='Ref_To_Local'>tokens</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/pg_list.h.html#LN47"><span class='Ref_to_Member'>length</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN944"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONFIG_FILE_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"multiple values specified for authentication type"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Specify exactly one authentication type per line."</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 errcontext<span class='Parentheses'>(</span><span class='String'>"line %d of configuration file \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="hba.c.html#LN946"><span class='Ref_To_Local'>line_num</span></a><span class='Delimiter'>, </span><a href="../utils/misc/guc.c.html#LN462"><span class='Ref_to_Global_Var'>HbaFileName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="hba.c.html#LN947"><span class='Ref_To_Local'>err_msg</span></a> <span class='Operator'>= </span><span class='String'>"multiple values specified for authentication type"</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="hba.c.html#LN957"><span class='Ref_To_Local'>token</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN955"><span class='Ref_To_Local'>tokens</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="hba.c.html#LN953"><span class='Ref_To_Local'>unsupauth</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN957"><span class='Ref_To_Local'>token</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN76"><span class='Ref_to_Member'>string</span></a><span class='Delimiter'>, </span><span class='String'>"trust"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN71"><span class='Ref_to_Member'>auth_method</span></a> <span class='Operator'>= </span><a href="../../include/libpq/hba.h.html#LN28"><span class='Ref_to_EnumConst'>uaTrust</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN957"><span class='Ref_To_Local'>token</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN76"><span class='Ref_to_Member'>string</span></a><span class='Delimiter'>, </span><span class='String'>"ident"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN71"><span class='Ref_to_Member'>auth_method</span></a> <span class='Operator'>= </span><a href="../../include/libpq/hba.h.html#LN29"><span class='Ref_to_EnumConst'>uaIdent</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN957"><span class='Ref_To_Local'>token</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN76"><span class='Ref_to_Member'>string</span></a><span class='Delimiter'>, </span><span class='String'>"peer"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN71"><span class='Ref_to_Member'>auth_method</span></a> <span class='Operator'>= </span><a href="../../include/libpq/hba.h.html#LN40"><span class='Ref_to_EnumConst'>uaPeer</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN957"><span class='Ref_To_Local'>token</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN76"><span class='Ref_to_Member'>string</span></a><span class='Delimiter'>, </span><span class='String'>"password"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN71"><span class='Ref_to_Member'>auth_method</span></a> <span class='Operator'>= </span><a href="../../include/libpq/hba.h.html#LN30"><span class='Ref_to_EnumConst'>uaPassword</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN957"><span class='Ref_To_Local'>token</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN76"><span class='Ref_to_Member'>string</span></a><span class='Delimiter'>, </span><span class='String'>"gss"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
<span class='Directive'>#ifdef</span> ENABLE_GSS 
        <a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN71"><span class='Ref_to_Member'>auth_method</span></a> <span class='Operator'>= </span><a href="../../include/libpq/hba.h.html#LN33"><span class='Ref_to_EnumConst'>uaGSS</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
        <a href="hba.c.html#LN953"><span class='Ref_To_Local'>unsupauth</span></a> <span class='Operator'>= </span><span class='String'>"gss"</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN957"><span class='Ref_To_Local'>token</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN76"><span class='Ref_to_Member'>string</span></a><span class='Delimiter'>, </span><span class='String'>"sspi"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
<span class='Directive'>#ifdef</span> <a href="../../include/port/win32.h.html#LN30"><span class='Ref_to_Const'>ENABLE_SSPI</span></a> 
        <a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN71"><span class='Ref_to_Member'>auth_method</span></a> <span class='Operator'>= </span><a href="../../include/libpq/hba.h.html#LN34"><span class='Ref_to_EnumConst'>uaSSPI</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
        <a href="hba.c.html#LN953"><span class='Ref_To_Local'>unsupauth</span></a> <span class='Operator'>= </span><span class='String'>"sspi"</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN957"><span class='Ref_To_Local'>token</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN76"><span class='Ref_to_Member'>string</span></a><span class='Delimiter'>, </span><span class='String'>"reject"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN71"><span class='Ref_to_Member'>auth_method</span></a> <span class='Operator'>= </span><a href="../../include/libpq/hba.h.html#LN26"><span class='Ref_to_EnumConst'>uaReject</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN957"><span class='Ref_To_Local'>token</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN76"><span class='Ref_to_Member'>string</span></a><span class='Delimiter'>, </span><span class='String'>"md5"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../postmaster/postmaster.c.html#LN239"><span class='Ref_to_Global_Var'>Db_user_namespace</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN944"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONFIG_FILE_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"MD5 authentication is not supported when \"db_user_namespace\" is enabled"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     errcontext<span class='Parentheses'>(</span><span class='String'>"line %d of configuration file \"%s\""</span><span class='Delimiter'>, 
</span>                                <a href="hba.c.html#LN946"><span class='Ref_To_Local'>line_num</span></a><span class='Delimiter'>, </span><a href="../utils/misc/guc.c.html#LN462"><span class='Ref_to_Global_Var'>HbaFileName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="hba.c.html#LN947"><span class='Ref_To_Local'>err_msg</span></a> <span class='Operator'>= </span><span class='String'>"MD5 authentication is not supported when \"db_user_namespace\" is enabled"</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN71"><span class='Ref_to_Member'>auth_method</span></a> <span class='Operator'>= </span><a href="../../include/libpq/hba.h.html#LN31"><span class='Ref_to_EnumConst'>uaMD5</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN957"><span class='Ref_To_Local'>token</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN76"><span class='Ref_to_Member'>string</span></a><span class='Delimiter'>, </span><span class='String'>"scram-sha-256"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN71"><span class='Ref_to_Member'>auth_method</span></a> <span class='Operator'>= </span><a href="../../include/libpq/hba.h.html#LN32"><span class='Ref_to_EnumConst'>uaSCRAM</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN957"><span class='Ref_To_Local'>token</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN76"><span class='Ref_to_Member'>string</span></a><span class='Delimiter'>, </span><span class='String'>"pam"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
<span class='Directive'>#ifdef</span> USE_PAM 
        <a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN71"><span class='Ref_to_Member'>auth_method</span></a> <span class='Operator'>= </span><a href="../../include/libpq/hba.h.html#LN35"><span class='Ref_to_EnumConst'>uaPAM</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
        <a href="hba.c.html#LN953"><span class='Ref_To_Local'>unsupauth</span></a> <span class='Operator'>= </span><span class='String'>"pam"</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN957"><span class='Ref_To_Local'>token</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN76"><span class='Ref_to_Member'>string</span></a><span class='Delimiter'>, </span><span class='String'>"bsd"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
<span class='Directive'>#ifdef</span> USE_BSD_AUTH 
        <a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN71"><span class='Ref_to_Member'>auth_method</span></a> <span class='Operator'>= </span><a href="../../include/libpq/hba.h.html#LN36"><span class='Ref_to_EnumConst'>uaBSD</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
        <a href="hba.c.html#LN953"><span class='Ref_To_Local'>unsupauth</span></a> <span class='Operator'>= </span><span class='String'>"bsd"</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN957"><span class='Ref_To_Local'>token</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN76"><span class='Ref_to_Member'>string</span></a><span class='Delimiter'>, </span><span class='String'>"ldap"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
<span class='Directive'>#ifdef</span> USE_LDAP 
        <a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN71"><span class='Ref_to_Member'>auth_method</span></a> <span class='Operator'>= </span><a href="../../include/libpq/hba.h.html#LN37"><span class='Ref_to_EnumConst'>uaLDAP</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
        <a href="hba.c.html#LN953"><span class='Ref_To_Local'>unsupauth</span></a> <span class='Operator'>= </span><span class='String'>"ldap"</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN957"><span class='Ref_To_Local'>token</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN76"><span class='Ref_to_Member'>string</span></a><span class='Delimiter'>, </span><span class='String'>"cert"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
<span class='Directive'>#ifdef</span> <a href="../../include/pg_config_manual.h.html#LN172"><span class='Ref_to_Const'>USE_SSL</span></a> 
        <a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN71"><span class='Ref_to_Member'>auth_method</span></a> <span class='Operator'>= </span><a href="../../include/libpq/hba.h.html#LN38"><span class='Ref_to_EnumConst'>uaCert</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
        <a href="hba.c.html#LN953"><span class='Ref_To_Local'>unsupauth</span></a> <span class='Operator'>= </span><span class='String'>"cert"</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN957"><span class='Ref_To_Local'>token</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN76"><span class='Ref_to_Member'>string</span></a><span class='Delimiter'>, </span><span class='String'>"radius"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN71"><span class='Ref_to_Member'>auth_method</span></a> <span class='Operator'>= </span><a href="../../include/libpq/hba.h.html#LN39"><span class='Ref_to_EnumConst'>uaRADIUS</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN944"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONFIG_FILE_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid authentication method \"%s\""</span><span class='Delimiter'>, 
</span>                        <a href="hba.c.html#LN957"><span class='Ref_To_Local'>token</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN76"><span class='Ref_to_Member'>string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 errcontext<span class='Parentheses'>(</span><span class='String'>"line %d of configuration file \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="hba.c.html#LN946"><span class='Ref_To_Local'>line_num</span></a><span class='Delimiter'>, </span><a href="../utils/misc/guc.c.html#LN462"><span class='Ref_to_Global_Var'>HbaFileName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="hba.c.html#LN947"><span class='Ref_To_Local'>err_msg</span></a> <span class='Operator'>= </span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"invalid authentication method \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="hba.c.html#LN957"><span class='Ref_To_Local'>token</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN76"><span class='Ref_to_Member'>string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN953"><span class='Ref_To_Local'>unsupauth</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN944"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONFIG_FILE_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid authentication method \"%s\": not supported by this build"</span><span class='Delimiter'>, 
</span>                        <a href="hba.c.html#LN957"><span class='Ref_To_Local'>token</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN76"><span class='Ref_to_Member'>string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 errcontext<span class='Parentheses'>(</span><span class='String'>"line %d of configuration file \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="hba.c.html#LN946"><span class='Ref_To_Local'>line_num</span></a><span class='Delimiter'>, </span><a href="../utils/misc/guc.c.html#LN462"><span class='Ref_to_Global_Var'>HbaFileName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="hba.c.html#LN947"><span class='Ref_To_Local'>err_msg</span></a> <span class='Operator'>= </span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"invalid authentication method \"%s\": not supported by this build"</span><span class='Delimiter'>, 
</span>                            <a href="hba.c.html#LN957"><span class='Ref_To_Local'>token</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN76"><span class='Ref_to_Member'>string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * XXX: When using ident on local connections, change it to peer, for 
     * backwards compatibility. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN64"><span class='Ref_to_Member'>conntype</span></a> <span class='Operator'>== </span><a href="../../include/libpq/hba.h.html#LN54"><span class='Ref_to_EnumConst'>ctLocal</span></a> <span class='Operator'>&& 
</span>        <a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN71"><span class='Ref_to_Member'>auth_method</span></a> <span class='Operator'>== </span><a href="../../include/libpq/hba.h.html#LN29"><span class='Ref_to_EnumConst'>uaIdent</span></a><span class='Parentheses'>) 
</span>        <a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN71"><span class='Ref_to_Member'>auth_method</span></a> <span class='Operator'>= </span><a href="../../include/libpq/hba.h.html#LN40"><span class='Ref_to_EnumConst'>uaPeer</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Invalid authentication combinations */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN64"><span class='Ref_to_Member'>conntype</span></a> <span class='Operator'>== </span><a href="../../include/libpq/hba.h.html#LN54"><span class='Ref_to_EnumConst'>ctLocal</span></a> <span class='Operator'>&& 
</span>        <a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN71"><span class='Ref_to_Member'>auth_method</span></a> <span class='Operator'>== </span><a href="../../include/libpq/hba.h.html#LN33"><span class='Ref_to_EnumConst'>uaGSS</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN944"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONFIG_FILE_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>           <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"gssapi authentication is not supported on local sockets"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 errcontext<span class='Parentheses'>(</span><span class='String'>"line %d of configuration file \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="hba.c.html#LN946"><span class='Ref_To_Local'>line_num</span></a><span class='Delimiter'>, </span><a href="../utils/misc/guc.c.html#LN462"><span class='Ref_to_Global_Var'>HbaFileName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="hba.c.html#LN947"><span class='Ref_To_Local'>err_msg</span></a> <span class='Operator'>= </span><span class='String'>"gssapi authentication is not supported on local sockets"</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN64"><span class='Ref_to_Member'>conntype</span></a> <span class='Operator'>!= </span><a href="../../include/libpq/hba.h.html#LN54"><span class='Ref_to_EnumConst'>ctLocal</span></a> <span class='Operator'>&& 
</span>        <a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN71"><span class='Ref_to_Member'>auth_method</span></a> <span class='Operator'>== </span><a href="../../include/libpq/hba.h.html#LN40"><span class='Ref_to_EnumConst'>uaPeer</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN944"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONFIG_FILE_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>            <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"peer authentication is only supported on local sockets"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 errcontext<span class='Parentheses'>(</span><span class='String'>"line %d of configuration file \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="hba.c.html#LN946"><span class='Ref_To_Local'>line_num</span></a><span class='Delimiter'>, </span><a href="../utils/misc/guc.c.html#LN462"><span class='Ref_to_Global_Var'>HbaFileName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="hba.c.html#LN947"><span class='Ref_To_Local'>err_msg</span></a> <span class='Operator'>= </span><span class='String'>"peer authentication is only supported on local sockets"</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * SSPI authentication can never be enabled on ctLocal connections, 
     * because it's only supported on Windows, where ctLocal isn't supported. 
     */ 
</span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN64"><span class='Ref_to_Member'>conntype</span></a> <span class='Operator'>!= </span><a href="../../include/libpq/hba.h.html#LN56"><span class='Ref_to_EnumConst'>ctHostSSL</span></a> <span class='Operator'>&& 
</span>        <a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN71"><span class='Ref_to_Member'>auth_method</span></a> <span class='Operator'>== </span><a href="../../include/libpq/hba.h.html#LN38"><span class='Ref_to_EnumConst'>uaCert</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN944"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONFIG_FILE_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cert authentication is only supported on hostssl connections"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 errcontext<span class='Parentheses'>(</span><span class='String'>"line %d of configuration file \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="hba.c.html#LN946"><span class='Ref_To_Local'>line_num</span></a><span class='Delimiter'>, </span><a href="../utils/misc/guc.c.html#LN462"><span class='Ref_to_Global_Var'>HbaFileName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="hba.c.html#LN947"><span class='Ref_To_Local'>err_msg</span></a> <span class='Operator'>= </span><span class='String'>"cert authentication is only supported on hostssl connections"</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * For GSS and SSPI, set the default value of include_realm to true. 
     * Having include_realm set to false is dangerous in multi-realm 
     * situations and is generally considered bad practice.  We keep the 
     * capability around for backwards compatibility, but we might want to 
     * remove it at some point in the future.  Users who still need to strip 
     * the realm off would be better served by using an appropriate regex in a 
     * pg_ident.conf mapping. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN71"><span class='Ref_to_Member'>auth_method</span></a> <span class='Operator'>== </span><a href="../../include/libpq/hba.h.html#LN33"><span class='Ref_to_EnumConst'>uaGSS</span></a> <span class='Operator'>|| 
</span>        <a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN71"><span class='Ref_to_Member'>auth_method</span></a> <span class='Operator'>== </span><a href="../../include/libpq/hba.h.html#LN34"><span class='Ref_to_EnumConst'>uaSSPI</span></a><span class='Parentheses'>) 
</span>        <a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN88"><span class='Ref_to_Member'>include_realm</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * For SSPI, include_realm defaults to the SAM-compatible domain (aka 
     * NetBIOS name) and user names instead of the Kerberos principal name for 
     * compatibility. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN71"><span class='Ref_to_Member'>auth_method</span></a> <span class='Operator'>== </span><a href="../../include/libpq/hba.h.html#LN34"><span class='Ref_to_EnumConst'>uaSSPI</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN89"><span class='Ref_to_Member'>compat_realm</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN90"><span class='Ref_to_Member'>upn_username</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Parse remaining arguments */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="hba.c.html#LN954"><span class='Ref_To_Local'>field</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN954"><span class='Ref_To_Local'>field</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="hba.c.html#LN955"><span class='Ref_To_Local'>tokens</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN954"><span class='Ref_To_Local'>field</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN956"><span class='Ref_To_Local'>tokencell</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN955"><span class='Ref_To_Local'>tokens</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1467"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span> 
            <a href="hba.c.html#LN957"><span class='Ref_To_Local'>token</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN956"><span class='Ref_To_Local'>tokencell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="hba.c.html#LN948"><span class='Ref_To_Local'>str</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN957"><span class='Ref_To_Local'>token</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN76"><span class='Ref_to_Member'>string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="hba.c.html#LN1467"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span>strchr<span class='Parentheses'>(</span><a href="hba.c.html#LN948"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, </span><span class='String'>'='</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN1467"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * Got something that's not a name=value pair. 
                 */ 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN944"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONFIG_FILE_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"authentication option not in name=value format: %s"</span><span class='Delimiter'>, </span><a href="hba.c.html#LN957"><span class='Ref_To_Local'>token</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN76"><span class='Ref_to_Member'>string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         errcontext<span class='Parentheses'>(</span><span class='String'>"line %d of configuration file \"%s\""</span><span class='Delimiter'>, 
</span>                                    <a href="hba.c.html#LN946"><span class='Ref_To_Local'>line_num</span></a><span class='Delimiter'>, </span><a href="../utils/misc/guc.c.html#LN462"><span class='Ref_to_Global_Var'>HbaFileName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><a href="hba.c.html#LN947"><span class='Ref_To_Local'>err_msg</span></a> <span class='Operator'>= </span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"authentication option not in name=value format: %s"</span><span class='Delimiter'>, 
</span>                                    <a href="hba.c.html#LN957"><span class='Ref_To_Local'>token</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN76"><span class='Ref_to_Member'>string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Operator'>*</span><a href="hba.c.html#LN1467"><span class='Ref_To_Local'>val</span></a><span class='Operator'>++ = </span><span class='String'>'\0'</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* str now holds "name", val holds "value" */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="hba.c.html#LN144"><span class='Ref_to_Proto'>parse_hba_auth_opt</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN948"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN1467"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN944"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN947"><span class='Ref_To_Local'>err_msg</span></a><span class='Parentheses'>))</span> 
                <span class='Comment_Multi_Line'>/* parse_hba_auth_opt already logged the error message */ 
</span>                <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN948"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while (field=lnext(field))!... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Check if the selected authentication method has any mandatory arguments 
     * that are not set. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN71"><span class='Ref_to_Member'>auth_method</span></a> <span class='Operator'>== </span><a href="../../include/libpq/hba.h.html#LN37"><span class='Ref_to_EnumConst'>uaLDAP</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="hba.c.html#LN879"><span class='Ref_to_Macro'>MANDATORY_AUTH_ARG</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN77"><span class='Ref_to_Member'>ldapserver</span></a><span class='Delimiter'>, </span><span class='String'>"ldapserver"</span><span class='Delimiter'>, </span><span class='String'>"ldap"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * LDAP can operate in two modes: either with a direct bind, using 
         * ldapprefix and ldapsuffix, or using a search+bind, using 
         * ldapbasedn, ldapbinddn, ldapbindpasswd and ldapsearchattribute. 
         * Disallow mixing these parameters. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN84"><span class='Ref_to_Member'>ldapprefix</span></a> <span class='Operator'>|| </span><a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN85"><span class='Ref_to_Member'>ldapsuffix</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN82"><span class='Ref_to_Member'>ldapbasedn</span></a> <span class='Operator'>|| 
</span>                <a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN79"><span class='Ref_to_Member'>ldapbinddn</span></a> <span class='Operator'>|| 
</span>                <a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN80"><span class='Ref_to_Member'>ldapbindpasswd</span></a> <span class='Operator'>|| 
</span>                <a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN81"><span class='Ref_to_Member'>ldapsearchattribute</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN944"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONFIG_FILE_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot use ldapbasedn, ldapbinddn, ldapbindpasswd, ldapsearchattribute, or ldapurl together with ldapprefix"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         errcontext<span class='Parentheses'>(</span><span class='String'>"line %d of configuration file \"%s\""</span><span class='Delimiter'>, 
</span>                                    <a href="hba.c.html#LN946"><span class='Ref_To_Local'>line_num</span></a><span class='Delimiter'>, </span><a href="../utils/misc/guc.c.html#LN462"><span class='Ref_to_Global_Var'>HbaFileName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><a href="hba.c.html#LN947"><span class='Ref_To_Local'>err_msg</span></a> <span class='Operator'>= </span><span class='String'>"cannot use ldapbasedn, ldapbinddn, ldapbindpasswd, ldapsearchattribute, or ldapurl together with ldapprefix"</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN82"><span class='Ref_to_Member'>ldapbasedn</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN944"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONFIG_FILE_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"authentication method \"ldap\" requires argument \"ldapbasedn\", \"ldapprefix\", or \"ldapsuffix\" to be set"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     errcontext<span class='Parentheses'>(</span><span class='String'>"line %d of configuration file \"%s\""</span><span class='Delimiter'>, 
</span>                                <a href="hba.c.html#LN946"><span class='Ref_To_Local'>line_num</span></a><span class='Delimiter'>, </span><a href="../utils/misc/guc.c.html#LN462"><span class='Ref_to_Global_Var'>HbaFileName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="hba.c.html#LN947"><span class='Ref_To_Local'>err_msg</span></a> <span class='Operator'>= </span><span class='String'>"authentication method \"ldap\" requires argument \"ldapbasedn\", \"ldapprefix\", or \"ldapsuffix\" to be set"</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if parsedline-&GT;auth_meth... &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN71"><span class='Ref_to_Member'>auth_method</span></a> <span class='Operator'>== </span><a href="../../include/libpq/hba.h.html#LN39"><span class='Ref_to_EnumConst'>uaRADIUS</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="hba.c.html#LN879"><span class='Ref_to_Macro'>MANDATORY_AUTH_ARG</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN91"><span class='Ref_to_Member'>radiusservers</span></a><span class='Delimiter'>, </span><span class='String'>"radiusservers"</span><span class='Delimiter'>, </span><span class='String'>"radius"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="hba.c.html#LN879"><span class='Ref_to_Macro'>MANDATORY_AUTH_ARG</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN93"><span class='Ref_to_Member'>radiussecrets</span></a><span class='Delimiter'>, </span><span class='String'>"radiussecrets"</span><span class='Delimiter'>, </span><span class='String'>"radius"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN91"><span class='Ref_to_Member'>radiusservers</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONFIG_FILE_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"list of RADIUS servers cannot be empty"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     errcontext<span class='Parentheses'>(</span><span class='String'>"line %d of configuration file \"%s\""</span><span class='Delimiter'>, 
</span>                                <a href="hba.c.html#LN946"><span class='Ref_To_Local'>line_num</span></a><span class='Delimiter'>, </span><a href="../utils/misc/guc.c.html#LN462"><span class='Ref_to_Global_Var'>HbaFileName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN93"><span class='Ref_to_Member'>radiussecrets</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONFIG_FILE_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"list of RADIUS secrets cannot be empty"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     errcontext<span class='Parentheses'>(</span><span class='String'>"line %d of configuration file \"%s\""</span><span class='Delimiter'>, 
</span>                                <a href="hba.c.html#LN946"><span class='Ref_To_Local'>line_num</span></a><span class='Delimiter'>, </span><a href="../utils/misc/guc.c.html#LN462"><span class='Ref_to_Global_Var'>HbaFileName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Verify length of option lists - each can be 0 (except for secrets, 
         * but that's already checked above), 1 (use the same value 
         * everywhere) or the same as the number of servers. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="hba.c.html#LN146"><span class='Ref_to_Proto'>verify_option_list_length</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN93"><span class='Ref_to_Member'>radiussecrets</span></a><span class='Delimiter'>, 
</span>                                       <span class='String'>"RADIUS secrets"</span><span class='Delimiter'>, 
</span>                                       <a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN91"><span class='Ref_to_Member'>radiusservers</span></a><span class='Delimiter'>, 
</span>                                       <span class='String'>"RADIUS servers"</span><span class='Delimiter'>, 
</span>                                       <a href="hba.c.html#LN946"><span class='Ref_To_Local'>line_num</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="hba.c.html#LN146"><span class='Ref_to_Proto'>verify_option_list_length</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN97"><span class='Ref_to_Member'>radiusports</span></a><span class='Delimiter'>, 
</span>                                       <span class='String'>"RADIUS ports"</span><span class='Delimiter'>, 
</span>                                       <a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN91"><span class='Ref_to_Member'>radiusservers</span></a><span class='Delimiter'>, 
</span>                                       <span class='String'>"RADIUS servers"</span><span class='Delimiter'>, 
</span>                                       <a href="hba.c.html#LN946"><span class='Ref_To_Local'>line_num</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="hba.c.html#LN146"><span class='Ref_to_Proto'>verify_option_list_length</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN95"><span class='Ref_to_Member'>radiusidentifiers</span></a><span class='Delimiter'>, 
</span>                                       <span class='String'>"RADIUS identifiers"</span><span class='Delimiter'>, 
</span>                                       <a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN91"><span class='Ref_to_Member'>radiusservers</span></a><span class='Delimiter'>, 
</span>                                       <span class='String'>"RADIUS servers"</span><span class='Delimiter'>, 
</span>                                       <a href="hba.c.html#LN946"><span class='Ref_To_Local'>line_num</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if parsedline-&GT;auth_meth... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Enforce any parameters implied by other settings. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN71"><span class='Ref_to_Member'>auth_method</span></a> <span class='Operator'>== </span><a href="../../include/libpq/hba.h.html#LN38"><span class='Ref_to_EnumConst'>uaCert</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN86"><span class='Ref_to_Member'>clientcert</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="hba.c.html#LN958"><span class='Ref_To_Local'>parsedline</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end parse_hba_line &raquo; </span> 
 
 
<span class='Keyword'>static bool 
</span><a name="LN1601"></a><span class='Declare_Function'>verify_option_list_length</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>options</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>optionname</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>masters</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>mastername</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>line_num</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1601"><span class='Ref_to_Parameter'>options</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        <a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1601"><span class='Ref_to_Parameter'>options</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>1</span> <span class='Operator'>|| 
</span>        <a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1601"><span class='Ref_to_Parameter'>options</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1601"><span class='Ref_to_Parameter'>masters</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, 
</span>            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONFIG_FILE_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"the number of %s (%i) must be 1 or the same as the number of %s (%i)"</span><span class='Delimiter'>, 
</span>                    <a href="hba.c.html#LN1601"><span class='Ref_to_Parameter'>optionname</span></a><span class='Delimiter'>, 
</span>                    <a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1601"><span class='Ref_to_Parameter'>options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="hba.c.html#LN1601"><span class='Ref_to_Parameter'>mastername</span></a><span class='Delimiter'>, 
</span>                    <a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1601"><span class='Ref_to_Parameter'>masters</span></a><span class='Parentheses'>) 
</span>                    <span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             errcontext<span class='Parentheses'>(</span><span class='String'>"line %d of configuration file \"%s\""</span><span class='Delimiter'>, 
</span>                        <a href="hba.c.html#LN1601"><span class='Ref_to_Parameter'>line_num</span></a><span class='Delimiter'>, </span><a href="../utils/misc/guc.c.html#LN462"><span class='Ref_to_Global_Var'>HbaFileName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end verify_option_list_length &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Parse one name-value pair as an authentication option into the given 
 * HbaLine.  Return true if we successfully parse the option, false if we 
 * encounter an error.  In the event of an error, also log a message at 
 * ereport level elevel, and store a message string into *err_msg. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1628"></a><span class='Declare_Function'>parse_hba_auth_opt</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>name</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>val</span><span class='Delimiter'>, </span><a href="../../include/libpq/hba.h.html#LN60"><span class='Ref_to_Struct'>HbaLine</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>hbaline</span><span class='Delimiter'>, 
</span><a name="LN1629"></a>                   <span class='Keyword'>int </span><span class='Declare_Parameter'>elevel</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>err_msg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1631"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>line_num</span> <span class='Operator'>= </span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>hbaline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN62"><span class='Ref_to_Member'>linenumber</span></a><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> USE_LDAP 
    <a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>hbaline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN83"><span class='Ref_to_Member'>ldapscope</span></a> <span class='Operator'>= </span>LDAP_SCOPE_SUBTREE<span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>, </span><span class='String'>"map"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>hbaline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN71"><span class='Ref_to_Member'>auth_method</span></a> <span class='Operator'>!= </span><a href="../../include/libpq/hba.h.html#LN29"><span class='Ref_to_EnumConst'>uaIdent</span></a> <span class='Operator'>&& 
</span>            <a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>hbaline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN71"><span class='Ref_to_Member'>auth_method</span></a> <span class='Operator'>!= </span><a href="../../include/libpq/hba.h.html#LN40"><span class='Ref_to_EnumConst'>uaPeer</span></a> <span class='Operator'>&& 
</span>            <a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>hbaline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN71"><span class='Ref_to_Member'>auth_method</span></a> <span class='Operator'>!= </span><a href="../../include/libpq/hba.h.html#LN33"><span class='Ref_to_EnumConst'>uaGSS</span></a> <span class='Operator'>&& 
</span>            <a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>hbaline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN71"><span class='Ref_to_Member'>auth_method</span></a> <span class='Operator'>!= </span><a href="../../include/libpq/hba.h.html#LN34"><span class='Ref_to_EnumConst'>uaSSPI</span></a> <span class='Operator'>&& 
</span>            <a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>hbaline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN71"><span class='Ref_to_Member'>auth_method</span></a> <span class='Operator'>!= </span><a href="../../include/libpq/hba.h.html#LN38"><span class='Ref_to_EnumConst'>uaCert</span></a><span class='Parentheses'>) 
</span>            <a href="hba.c.html#LN859"><span class='Ref_to_Macro'>INVALID_AUTH_OPTION</span></a><span class='Parentheses'>(</span><span class='String'>"map"</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"ident, peer, gssapi, sspi, and cert"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>hbaline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN73"><span class='Ref_to_Member'>usermap</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>, </span><span class='String'>"clientcert"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>hbaline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN64"><span class='Ref_to_Member'>conntype</span></a> <span class='Operator'>!= </span><a href="../../include/libpq/hba.h.html#LN56"><span class='Ref_to_EnumConst'>ctHostSSL</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1629"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONFIG_FILE_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>            <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"clientcert can only be configured for \"hostssl\" rows"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     errcontext<span class='Parentheses'>(</span><span class='String'>"line %d of configuration file \"%s\""</span><span class='Delimiter'>, 
</span>                                <a href="hba.c.html#LN1631"><span class='Ref_To_Local'>line_num</span></a><span class='Delimiter'>, </span><a href="../utils/misc/guc.c.html#LN462"><span class='Ref_to_Global_Var'>HbaFileName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="hba.c.html#LN1629"><span class='Ref_to_Parameter'>err_msg</span></a> <span class='Operator'>= </span><span class='String'>"clientcert can only be configured for \"hostssl\" rows"</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>val</span></a><span class='Delimiter'>, </span><span class='String'>"1"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>hbaline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN86"><span class='Ref_to_Member'>clientcert</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>hbaline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN71"><span class='Ref_to_Member'>auth_method</span></a> <span class='Operator'>== </span><a href="../../include/libpq/hba.h.html#LN38"><span class='Ref_to_EnumConst'>uaCert</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1629"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONFIG_FILE_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"clientcert can not be set to 0 when using \"cert\" authentication"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         errcontext<span class='Parentheses'>(</span><span class='String'>"line %d of configuration file \"%s\""</span><span class='Delimiter'>, 
</span>                                    <a href="hba.c.html#LN1631"><span class='Ref_To_Local'>line_num</span></a><span class='Delimiter'>, </span><a href="../utils/misc/guc.c.html#LN462"><span class='Ref_to_Global_Var'>HbaFileName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><a href="hba.c.html#LN1629"><span class='Ref_to_Parameter'>err_msg</span></a> <span class='Operator'>= </span><span class='String'>"clientcert can not be set to 0 when using \"cert\" authentication"</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>hbaline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN86"><span class='Ref_to_Member'>clientcert</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if strcmp(name,"clientce... &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>, </span><span class='String'>"pamservice"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="hba.c.html#LN873"><span class='Ref_to_Macro'>REQUIRE_AUTH_OPTION</span></a><span class='Parentheses'>(</span><a href="../../include/libpq/hba.h.html#LN35"><span class='Ref_to_EnumConst'>uaPAM</span></a><span class='Delimiter'>, </span><span class='String'>"pamservice"</span><span class='Delimiter'>, </span><span class='String'>"pam"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>hbaline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN74"><span class='Ref_to_Member'>pamservice</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>, </span><span class='String'>"pam_use_hostname"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="hba.c.html#LN873"><span class='Ref_to_Macro'>REQUIRE_AUTH_OPTION</span></a><span class='Parentheses'>(</span><a href="../../include/libpq/hba.h.html#LN35"><span class='Ref_to_EnumConst'>uaPAM</span></a><span class='Delimiter'>, </span><span class='String'>"pam_use_hostname"</span><span class='Delimiter'>, </span><span class='String'>"pam"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>val</span></a><span class='Delimiter'>, </span><span class='String'>"1"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>hbaline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN75"><span class='Ref_to_Member'>pam_use_hostname</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>hbaline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN75"><span class='Ref_to_Member'>pam_use_hostname</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>, </span><span class='String'>"ldapurl"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> LDAP_API_FEATURE_X_OPENLDAP 
<a name="LN1695"></a>        LDAPURLDesc <span class='Operator'>*</span><span class='Declare_Local'>urldata</span><span class='Delimiter'>; 
</span><a name="LN1696"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>rc</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
        <a href="hba.c.html#LN873"><span class='Ref_to_Macro'>REQUIRE_AUTH_OPTION</span></a><span class='Parentheses'>(</span><a href="../../include/libpq/hba.h.html#LN37"><span class='Ref_to_EnumConst'>uaLDAP</span></a><span class='Delimiter'>, </span><span class='String'>"ldapurl"</span><span class='Delimiter'>, </span><span class='String'>"ldap"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#ifdef</span> LDAP_API_FEATURE_X_OPENLDAP 
        <a href="hba.c.html#LN1696"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span>ldap_url_parse<span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>val</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="hba.c.html#LN1695"><span class='Ref_To_Local'>urldata</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN1696"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>!= </span>LDAP_SUCCESS<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1629"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONFIG_FILE_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not parse LDAP URL \"%s\": %s"</span><span class='Delimiter'>, </span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>val</span></a><span class='Delimiter'>, </span>ldap_err2string<span class='Parentheses'>(</span><a href="hba.c.html#LN1696"><span class='Ref_To_Local'>rc</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="hba.c.html#LN1629"><span class='Ref_to_Parameter'>err_msg</span></a> <span class='Operator'>= </span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"could not parse LDAP URL \"%s\": %s"</span><span class='Delimiter'>, 
</span>                                <a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>val</span></a><span class='Delimiter'>, </span>ldap_err2string<span class='Parentheses'>(</span><a href="hba.c.html#LN1696"><span class='Ref_To_Local'>rc</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN1695"><span class='Ref_To_Local'>urldata</span></a><span class='Operator'>-&GT;</span>lud_scheme<span class='Delimiter'>, </span><span class='String'>"ldap"</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1629"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONFIG_FILE_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>            <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"unsupported LDAP URL scheme: %s"</span><span class='Delimiter'>, </span><a href="hba.c.html#LN1695"><span class='Ref_To_Local'>urldata</span></a><span class='Operator'>-&GT;</span>lud_scheme<span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="hba.c.html#LN1629"><span class='Ref_to_Parameter'>err_msg</span></a> <span class='Operator'>= </span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"unsupported LDAP URL scheme: %s"</span><span class='Delimiter'>, 
</span>                                <a href="hba.c.html#LN1695"><span class='Ref_To_Local'>urldata</span></a><span class='Operator'>-&GT;</span>lud_scheme<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            ldap_free_urldesc<span class='Parentheses'>(</span><a href="hba.c.html#LN1695"><span class='Ref_To_Local'>urldata</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>hbaline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN77"><span class='Ref_to_Member'>ldapserver</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1695"><span class='Ref_To_Local'>urldata</span></a><span class='Operator'>-&GT;</span>lud_host<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>hbaline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN78"><span class='Ref_to_Member'>ldapport</span></a> <span class='Operator'>= </span><a href="hba.c.html#LN1695"><span class='Ref_To_Local'>urldata</span></a><span class='Operator'>-&GT;</span>lud_port<span class='Delimiter'>; 
</span>        <a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>hbaline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN82"><span class='Ref_to_Member'>ldapbasedn</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1695"><span class='Ref_To_Local'>urldata</span></a><span class='Operator'>-&GT;</span>lud_dn<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN1695"><span class='Ref_To_Local'>urldata</span></a><span class='Operator'>-&GT;</span>lud_attrs<span class='Parentheses'>) 
</span>            <a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>hbaline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN81"><span class='Ref_to_Member'>ldapsearchattribute</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1695"><span class='Ref_To_Local'>urldata</span></a><span class='Operator'>-&GT;</span>lud_attrs<span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* only use first one */ 
</span>        <a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>hbaline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN83"><span class='Ref_to_Member'>ldapscope</span></a> <span class='Operator'>= </span><a href="hba.c.html#LN1695"><span class='Ref_To_Local'>urldata</span></a><span class='Operator'>-&GT;</span>lud_scope<span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN1695"><span class='Ref_To_Local'>urldata</span></a><span class='Operator'>-&GT;</span>lud_filter<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1629"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONFIG_FILE_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"filters not supported in LDAP URLs"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="hba.c.html#LN1629"><span class='Ref_to_Parameter'>err_msg</span></a> <span class='Operator'>= </span><span class='String'>"filters not supported in LDAP URLs"</span><span class='Delimiter'>; 
</span>            ldap_free_urldesc<span class='Parentheses'>(</span><a href="hba.c.html#LN1695"><span class='Ref_To_Local'>urldata</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        ldap_free_urldesc<span class='Parentheses'>(</span><a href="hba.c.html#LN1695"><span class='Ref_To_Local'>urldata</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span>                           <span class='Comment_Single_Line'>/* not OpenLDAP */ 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1629"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"LDAP URLs not supported on this platform"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="hba.c.html#LN1629"><span class='Ref_to_Parameter'>err_msg</span></a> <span class='Operator'>= </span><span class='String'>"LDAP URLs not supported on this platform"</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* not OpenLDAP */ 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if strcmp(name,"ldapurl"... &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>, </span><span class='String'>"ldaptls"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="hba.c.html#LN873"><span class='Ref_to_Macro'>REQUIRE_AUTH_OPTION</span></a><span class='Parentheses'>(</span><a href="../../include/libpq/hba.h.html#LN37"><span class='Ref_to_EnumConst'>uaLDAP</span></a><span class='Delimiter'>, </span><span class='String'>"ldaptls"</span><span class='Delimiter'>, </span><span class='String'>"ldap"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>val</span></a><span class='Delimiter'>, </span><span class='String'>"1"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>hbaline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN76"><span class='Ref_to_Member'>ldaptls</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>hbaline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN76"><span class='Ref_to_Member'>ldaptls</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>, </span><span class='String'>"ldapserver"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="hba.c.html#LN873"><span class='Ref_to_Macro'>REQUIRE_AUTH_OPTION</span></a><span class='Parentheses'>(</span><a href="../../include/libpq/hba.h.html#LN37"><span class='Ref_to_EnumConst'>uaLDAP</span></a><span class='Delimiter'>, </span><span class='String'>"ldapserver"</span><span class='Delimiter'>, </span><span class='String'>"ldap"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>hbaline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN77"><span class='Ref_to_Member'>ldapserver</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>, </span><span class='String'>"ldapport"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="hba.c.html#LN873"><span class='Ref_to_Macro'>REQUIRE_AUTH_OPTION</span></a><span class='Parentheses'>(</span><a href="../../include/libpq/hba.h.html#LN37"><span class='Ref_to_EnumConst'>uaLDAP</span></a><span class='Delimiter'>, </span><span class='String'>"ldapport"</span><span class='Delimiter'>, </span><span class='String'>"ldap"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>hbaline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN78"><span class='Ref_to_Member'>ldapport</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>hbaline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN78"><span class='Ref_to_Member'>ldapport</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1629"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONFIG_FILE_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid LDAP port number: \"%s\""</span><span class='Delimiter'>, </span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     errcontext<span class='Parentheses'>(</span><span class='String'>"line %d of configuration file \"%s\""</span><span class='Delimiter'>, 
</span>                                <a href="hba.c.html#LN1631"><span class='Ref_To_Local'>line_num</span></a><span class='Delimiter'>, </span><a href="../utils/misc/guc.c.html#LN462"><span class='Ref_to_Global_Var'>HbaFileName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="hba.c.html#LN1629"><span class='Ref_to_Parameter'>err_msg</span></a> <span class='Operator'>= </span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"invalid LDAP port number: \"%s\""</span><span class='Delimiter'>, </span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>, </span><span class='String'>"ldapbinddn"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="hba.c.html#LN873"><span class='Ref_to_Macro'>REQUIRE_AUTH_OPTION</span></a><span class='Parentheses'>(</span><a href="../../include/libpq/hba.h.html#LN37"><span class='Ref_to_EnumConst'>uaLDAP</span></a><span class='Delimiter'>, </span><span class='String'>"ldapbinddn"</span><span class='Delimiter'>, </span><span class='String'>"ldap"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>hbaline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN79"><span class='Ref_to_Member'>ldapbinddn</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>, </span><span class='String'>"ldapbindpasswd"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="hba.c.html#LN873"><span class='Ref_to_Macro'>REQUIRE_AUTH_OPTION</span></a><span class='Parentheses'>(</span><a href="../../include/libpq/hba.h.html#LN37"><span class='Ref_to_EnumConst'>uaLDAP</span></a><span class='Delimiter'>, </span><span class='String'>"ldapbindpasswd"</span><span class='Delimiter'>, </span><span class='String'>"ldap"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>hbaline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN80"><span class='Ref_to_Member'>ldapbindpasswd</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>, </span><span class='String'>"ldapsearchattribute"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="hba.c.html#LN873"><span class='Ref_to_Macro'>REQUIRE_AUTH_OPTION</span></a><span class='Parentheses'>(</span><a href="../../include/libpq/hba.h.html#LN37"><span class='Ref_to_EnumConst'>uaLDAP</span></a><span class='Delimiter'>, </span><span class='String'>"ldapsearchattribute"</span><span class='Delimiter'>, </span><span class='String'>"ldap"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>hbaline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN81"><span class='Ref_to_Member'>ldapsearchattribute</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>, </span><span class='String'>"ldapbasedn"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="hba.c.html#LN873"><span class='Ref_to_Macro'>REQUIRE_AUTH_OPTION</span></a><span class='Parentheses'>(</span><a href="../../include/libpq/hba.h.html#LN37"><span class='Ref_to_EnumConst'>uaLDAP</span></a><span class='Delimiter'>, </span><span class='String'>"ldapbasedn"</span><span class='Delimiter'>, </span><span class='String'>"ldap"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>hbaline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN82"><span class='Ref_to_Member'>ldapbasedn</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>, </span><span class='String'>"ldapprefix"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="hba.c.html#LN873"><span class='Ref_to_Macro'>REQUIRE_AUTH_OPTION</span></a><span class='Parentheses'>(</span><a href="../../include/libpq/hba.h.html#LN37"><span class='Ref_to_EnumConst'>uaLDAP</span></a><span class='Delimiter'>, </span><span class='String'>"ldapprefix"</span><span class='Delimiter'>, </span><span class='String'>"ldap"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>hbaline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN84"><span class='Ref_to_Member'>ldapprefix</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>, </span><span class='String'>"ldapsuffix"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="hba.c.html#LN873"><span class='Ref_to_Macro'>REQUIRE_AUTH_OPTION</span></a><span class='Parentheses'>(</span><a href="../../include/libpq/hba.h.html#LN37"><span class='Ref_to_EnumConst'>uaLDAP</span></a><span class='Delimiter'>, </span><span class='String'>"ldapsuffix"</span><span class='Delimiter'>, </span><span class='String'>"ldap"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>hbaline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN85"><span class='Ref_to_Member'>ldapsuffix</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>, </span><span class='String'>"krb_realm"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>hbaline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN71"><span class='Ref_to_Member'>auth_method</span></a> <span class='Operator'>!= </span><a href="../../include/libpq/hba.h.html#LN33"><span class='Ref_to_EnumConst'>uaGSS</span></a> <span class='Operator'>&& 
</span>            <a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>hbaline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN71"><span class='Ref_to_Member'>auth_method</span></a> <span class='Operator'>!= </span><a href="../../include/libpq/hba.h.html#LN34"><span class='Ref_to_EnumConst'>uaSSPI</span></a><span class='Parentheses'>) 
</span>            <a href="hba.c.html#LN859"><span class='Ref_to_Macro'>INVALID_AUTH_OPTION</span></a><span class='Parentheses'>(</span><span class='String'>"krb_realm"</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"gssapi and sspi"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>hbaline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN87"><span class='Ref_to_Member'>krb_realm</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>, </span><span class='String'>"include_realm"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>hbaline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN71"><span class='Ref_to_Member'>auth_method</span></a> <span class='Operator'>!= </span><a href="../../include/libpq/hba.h.html#LN33"><span class='Ref_to_EnumConst'>uaGSS</span></a> <span class='Operator'>&& 
</span>            <a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>hbaline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN71"><span class='Ref_to_Member'>auth_method</span></a> <span class='Operator'>!= </span><a href="../../include/libpq/hba.h.html#LN34"><span class='Ref_to_EnumConst'>uaSSPI</span></a><span class='Parentheses'>) 
</span>            <a href="hba.c.html#LN859"><span class='Ref_to_Macro'>INVALID_AUTH_OPTION</span></a><span class='Parentheses'>(</span><span class='String'>"include_realm"</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"gssapi and sspi"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>val</span></a><span class='Delimiter'>, </span><span class='String'>"1"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>hbaline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN88"><span class='Ref_to_Member'>include_realm</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>hbaline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN88"><span class='Ref_to_Member'>include_realm</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>, </span><span class='String'>"compat_realm"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>hbaline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN71"><span class='Ref_to_Member'>auth_method</span></a> <span class='Operator'>!= </span><a href="../../include/libpq/hba.h.html#LN34"><span class='Ref_to_EnumConst'>uaSSPI</span></a><span class='Parentheses'>) 
</span>            <a href="hba.c.html#LN859"><span class='Ref_to_Macro'>INVALID_AUTH_OPTION</span></a><span class='Parentheses'>(</span><span class='String'>"compat_realm"</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"sspi"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>val</span></a><span class='Delimiter'>, </span><span class='String'>"1"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>hbaline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN89"><span class='Ref_to_Member'>compat_realm</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>hbaline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN89"><span class='Ref_to_Member'>compat_realm</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>, </span><span class='String'>"upn_username"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>hbaline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN71"><span class='Ref_to_Member'>auth_method</span></a> <span class='Operator'>!= </span><a href="../../include/libpq/hba.h.html#LN34"><span class='Ref_to_EnumConst'>uaSSPI</span></a><span class='Parentheses'>) 
</span>            <a href="hba.c.html#LN859"><span class='Ref_to_Macro'>INVALID_AUTH_OPTION</span></a><span class='Parentheses'>(</span><span class='String'>"upn_username"</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"sspi"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>val</span></a><span class='Delimiter'>, </span><span class='String'>"1"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>hbaline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN90"><span class='Ref_to_Member'>upn_username</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>hbaline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN90"><span class='Ref_to_Member'>upn_username</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>, </span><span class='String'>"radiusservers"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1842"></a>        <span class='Control'>struct</span> <a href="../../include/getaddrinfo.h.html#LN114"><span class='Ref_to_Struct'>addrinfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>gai_result</span><span class='Delimiter'>; 
</span><a name="LN1843"></a>        <span class='Control'>struct</span> <a href="../../include/getaddrinfo.h.html#LN114"><span class='Ref_to_Struct'>addrinfo</span></a> <span class='Declare_Local'>hints</span><span class='Delimiter'>; 
</span><a name="LN1844"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>ret</span><span class='Delimiter'>; 
</span><a name="LN1845"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>parsed_servers</span><span class='Delimiter'>; 
</span><a name="LN1846"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span><a name="LN1847"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>dupval</span> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="hba.c.html#LN873"><span class='Ref_to_Macro'>REQUIRE_AUTH_OPTION</span></a><span class='Parentheses'>(</span><a href="../../include/libpq/hba.h.html#LN39"><span class='Ref_to_EnumConst'>uaRADIUS</span></a><span class='Delimiter'>, </span><span class='String'>"radiusservers"</span><span class='Delimiter'>, </span><span class='String'>"radius"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/varlena.h.html#LN29"><span class='Ref_to_Proto'>SplitIdentifierString</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1847"><span class='Ref_To_Local'>dupval</span></a><span class='Delimiter'>, </span><span class='String'>','</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="hba.c.html#LN1845"><span class='Ref_To_Local'>parsed_servers</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* syntax error in list */ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1629"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONFIG_FILE_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not parse RADIUS server list \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     errcontext<span class='Parentheses'>(</span><span class='String'>"line %d of configuration file \"%s\""</span><span class='Delimiter'>, 
</span>                                <a href="hba.c.html#LN1631"><span class='Ref_To_Local'>line_num</span></a><span class='Delimiter'>, </span><a href="../utils/misc/guc.c.html#LN462"><span class='Ref_to_Global_Var'>HbaFileName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* For each entry in the list, translate it */ 
</span>        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1846"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN1845"><span class='Ref_To_Local'>parsed_servers</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hba.c.html#LN1843"><span class='Ref_To_Local'>hints</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="hba.c.html#LN1843"><span class='Ref_To_Local'>hints</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="hba.c.html#LN1843"><span class='Ref_To_Local'>hints</span></a><span class='Operator'>.</span><a href="../../include/getaddrinfo.h.html#LN101"><span class='Ref_to_Member'>ai_socktype</span></a> <span class='Operator'>= </span>SOCK_DGRAM<span class='Delimiter'>; 
</span>            <a href="hba.c.html#LN1843"><span class='Ref_To_Local'>hints</span></a><span class='Operator'>.</span><a href="../../include/getaddrinfo.h.html#LN100"><span class='Ref_to_Member'>ai_family</span></a> <span class='Operator'>= </span>AF_UNSPEC<span class='Delimiter'>; 
</span> 
            <a href="hba.c.html#LN1844"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><a href="../../include/common/ip.h.html#LN26"><span class='Ref_to_Proto'>pg_getaddrinfo_all</span></a><span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1846"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="hba.c.html#LN1843"><span class='Ref_To_Local'>hints</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="hba.c.html#LN1842"><span class='Ref_To_Local'>gai_result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN1844"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>|| !</span><a href="hba.c.html#LN1842"><span class='Ref_To_Local'>gai_result</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1629"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONFIG_FILE_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not translate RADIUS server name \"%s\" to address: %s"</span><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1846"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../include/getaddrinfo.h.html#LN155"><span class='Ref_to_Proto'>gai_strerror</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1844"><span class='Ref_To_Local'>ret</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                         errcontext<span class='Parentheses'>(</span><span class='String'>"line %d of configuration file \"%s\""</span><span class='Delimiter'>, 
</span>                                    <a href="hba.c.html#LN1631"><span class='Ref_To_Local'>line_num</span></a><span class='Delimiter'>, </span><a href="../utils/misc/guc.c.html#LN462"><span class='Ref_to_Global_Var'>HbaFileName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN1842"><span class='Ref_To_Local'>gai_result</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/common/ip.h.html#LN29"><span class='Ref_to_Proto'>pg_freeaddrinfo_all</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1843"><span class='Ref_To_Local'>hints</span></a><span class='Operator'>.</span><a href="../../include/getaddrinfo.h.html#LN100"><span class='Ref_to_Member'>ai_family</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN1842"><span class='Ref_To_Local'>gai_result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1845"><span class='Ref_To_Local'>parsed_servers</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="../../include/common/ip.h.html#LN29"><span class='Ref_to_Proto'>pg_freeaddrinfo_all</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1843"><span class='Ref_To_Local'>hints</span></a><span class='Operator'>.</span><a href="../../include/getaddrinfo.h.html#LN100"><span class='Ref_to_Member'>ai_family</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN1842"><span class='Ref_To_Local'>gai_result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* All entries are OK, so store them */ 
</span>        <a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>hbaline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN91"><span class='Ref_to_Member'>radiusservers</span></a> <span class='Operator'>= </span><a href="hba.c.html#LN1845"><span class='Ref_To_Local'>parsed_servers</span></a><span class='Delimiter'>; 
</span>        <a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>hbaline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN92"><span class='Ref_to_Member'>radiusservers_s</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if strcmp(name,"radiusse... &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>, </span><span class='String'>"radiusports"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1894"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>parsed_ports</span><span class='Delimiter'>; 
</span><a name="LN1895"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span><a name="LN1896"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>dupval</span> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="hba.c.html#LN873"><span class='Ref_to_Macro'>REQUIRE_AUTH_OPTION</span></a><span class='Parentheses'>(</span><a href="../../include/libpq/hba.h.html#LN39"><span class='Ref_to_EnumConst'>uaRADIUS</span></a><span class='Delimiter'>, </span><span class='String'>"radiusports"</span><span class='Delimiter'>, </span><span class='String'>"radius"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/varlena.h.html#LN29"><span class='Ref_to_Proto'>SplitIdentifierString</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1896"><span class='Ref_To_Local'>dupval</span></a><span class='Delimiter'>, </span><span class='String'>','</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="hba.c.html#LN1894"><span class='Ref_To_Local'>parsed_ports</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1629"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONFIG_FILE_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not parse RADIUS port list \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     errcontext<span class='Parentheses'>(</span><span class='String'>"line %d of configuration file \"%s\""</span><span class='Delimiter'>, 
</span>                                <a href="hba.c.html#LN1631"><span class='Ref_To_Local'>line_num</span></a><span class='Delimiter'>, </span><a href="../utils/misc/guc.c.html#LN462"><span class='Ref_to_Global_Var'>HbaFileName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="hba.c.html#LN1629"><span class='Ref_to_Parameter'>err_msg</span></a> <span class='Operator'>= </span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"invalid RADIUS port number: \"%s\""</span><span class='Delimiter'>, </span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1895"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN1894"><span class='Ref_To_Local'>parsed_ports</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>atoi<span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1895"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1629"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONFIG_FILE_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid RADIUS port number: \"%s\""</span><span class='Delimiter'>, </span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         errcontext<span class='Parentheses'>(</span><span class='String'>"line %d of configuration file \"%s\""</span><span class='Delimiter'>, 
</span>                                    <a href="hba.c.html#LN1631"><span class='Ref_To_Local'>line_num</span></a><span class='Delimiter'>, </span><a href="../utils/misc/guc.c.html#LN462"><span class='Ref_to_Global_Var'>HbaFileName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>hbaline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN97"><span class='Ref_to_Member'>radiusports</span></a> <span class='Operator'>= </span><a href="hba.c.html#LN1894"><span class='Ref_To_Local'>parsed_ports</span></a><span class='Delimiter'>; 
</span>        <a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>hbaline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN98"><span class='Ref_to_Member'>radiusports_s</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if strcmp(name,"radiuspo... &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>, </span><span class='String'>"radiussecrets"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1930"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>parsed_secrets</span><span class='Delimiter'>; 
</span><a name="LN1931"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>dupval</span> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="hba.c.html#LN873"><span class='Ref_to_Macro'>REQUIRE_AUTH_OPTION</span></a><span class='Parentheses'>(</span><a href="../../include/libpq/hba.h.html#LN39"><span class='Ref_to_EnumConst'>uaRADIUS</span></a><span class='Delimiter'>, </span><span class='String'>"radiussecrets"</span><span class='Delimiter'>, </span><span class='String'>"radius"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/varlena.h.html#LN29"><span class='Ref_to_Proto'>SplitIdentifierString</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1931"><span class='Ref_To_Local'>dupval</span></a><span class='Delimiter'>, </span><span class='String'>','</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="hba.c.html#LN1930"><span class='Ref_To_Local'>parsed_secrets</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* syntax error in list */ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1629"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONFIG_FILE_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not parse RADIUS secret list \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     errcontext<span class='Parentheses'>(</span><span class='String'>"line %d of configuration file \"%s\""</span><span class='Delimiter'>, 
</span>                                <a href="hba.c.html#LN1631"><span class='Ref_To_Local'>line_num</span></a><span class='Delimiter'>, </span><a href="../utils/misc/guc.c.html#LN462"><span class='Ref_to_Global_Var'>HbaFileName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>hbaline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN93"><span class='Ref_to_Member'>radiussecrets</span></a> <span class='Operator'>= </span><a href="hba.c.html#LN1930"><span class='Ref_To_Local'>parsed_secrets</span></a><span class='Delimiter'>; 
</span>        <a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>hbaline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN94"><span class='Ref_to_Member'>radiussecrets_s</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if strcmp(name,"radiusse... &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>, </span><span class='String'>"radiusidentifiers"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1952"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>parsed_identifiers</span><span class='Delimiter'>; 
</span><a name="LN1953"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>dupval</span> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="hba.c.html#LN873"><span class='Ref_to_Macro'>REQUIRE_AUTH_OPTION</span></a><span class='Parentheses'>(</span><a href="../../include/libpq/hba.h.html#LN39"><span class='Ref_to_EnumConst'>uaRADIUS</span></a><span class='Delimiter'>, </span><span class='String'>"radiusidentifiers"</span><span class='Delimiter'>, </span><span class='String'>"radius"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/varlena.h.html#LN29"><span class='Ref_to_Proto'>SplitIdentifierString</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1953"><span class='Ref_To_Local'>dupval</span></a><span class='Delimiter'>, </span><span class='String'>','</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="hba.c.html#LN1952"><span class='Ref_To_Local'>parsed_identifiers</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* syntax error in list */ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1629"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONFIG_FILE_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not parse RADIUS identifiers list \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     errcontext<span class='Parentheses'>(</span><span class='String'>"line %d of configuration file \"%s\""</span><span class='Delimiter'>, 
</span>                                <a href="hba.c.html#LN1631"><span class='Ref_To_Local'>line_num</span></a><span class='Delimiter'>, </span><a href="../utils/misc/guc.c.html#LN462"><span class='Ref_to_Global_Var'>HbaFileName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>hbaline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN95"><span class='Ref_to_Member'>radiusidentifiers</span></a> <span class='Operator'>= </span><a href="hba.c.html#LN1952"><span class='Ref_To_Local'>parsed_identifiers</span></a><span class='Delimiter'>; 
</span>        <a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>hbaline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN96"><span class='Ref_to_Member'>radiusidentifiers_s</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if strcmp(name,"radiusid... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1629"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONFIG_FILE_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"unrecognized authentication option name: \"%s\""</span><span class='Delimiter'>, 
</span>                        <a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 errcontext<span class='Parentheses'>(</span><span class='String'>"line %d of configuration file \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="hba.c.html#LN1631"><span class='Ref_To_Local'>line_num</span></a><span class='Delimiter'>, </span><a href="../utils/misc/guc.c.html#LN462"><span class='Ref_to_Global_Var'>HbaFileName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="hba.c.html#LN1629"><span class='Ref_to_Parameter'>err_msg</span></a> <span class='Operator'>= </span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"unrecognized authentication option name: \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="hba.c.html#LN1628"><span class='Ref_to_Parameter'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end parse_hba_auth_opt &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *  Scan the pre-parsed hba file, looking for a match to the port's connection 
 *  request. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1992"></a><span class='Declare_Function'>check_hba</span><span class='Parentheses'>(</span><a href="../../include/libpq/hba.h.html#LN112"><span class='Ref_to_Typedef'>hbaPort</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>port</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1994"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN1995"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>line</span><span class='Delimiter'>; 
</span><a name="LN1996"></a>    <a href="../../include/libpq/hba.h.html#LN60"><span class='Ref_to_Struct'>HbaLine</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>hba</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get the target role's OID.  Note we do not error out for bad role. */ 
</span>    <a href="hba.c.html#LN1994"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN234"><span class='Ref_to_Proto'>get_role_oid</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1992"><span class='Ref_to_Parameter'>port</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/libpq-be.h.html#LN136"><span class='Ref_to_Member'>user_name</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1995"><span class='Ref_To_Local'>line</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN100"><span class='Ref_to_Global_Var'>parsed_hba_lines</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="hba.c.html#LN1996"><span class='Ref_To_Local'>hba</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/libpq/hba.h.html#LN60"><span class='Ref_to_Struct'>HbaLine</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1995"><span class='Ref_To_Local'>line</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Check connection type */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN1996"><span class='Ref_To_Local'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN64"><span class='Ref_to_Member'>conntype</span></a> <span class='Operator'>== </span><a href="../../include/libpq/hba.h.html#LN54"><span class='Ref_to_EnumConst'>ctLocal</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/common/ip.h.html#LN21"><span class='Ref_to_Macro'>IS_AF_UNIX</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1992"><span class='Ref_to_Parameter'>port</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/libpq-be.h.html#LN121"><span class='Ref_to_Member'>raddr</span></a><span class='Operator'>.</span><a href="../../include/libpq/pqcomm.h.html#LN63"><span class='Ref_to_Member'>addr</span></a><span class='Operator'>.</span>ss_family<span class='Parentheses'>))</span> 
                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/common/ip.h.html#LN21"><span class='Ref_to_Macro'>IS_AF_UNIX</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1992"><span class='Ref_to_Parameter'>port</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/libpq-be.h.html#LN121"><span class='Ref_to_Member'>raddr</span></a><span class='Operator'>.</span><a href="../../include/libpq/pqcomm.h.html#LN63"><span class='Ref_to_Member'>addr</span></a><span class='Operator'>.</span>ss_family<span class='Parentheses'>))</span> 
                <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Check SSL state */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN1992"><span class='Ref_to_Parameter'>port</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/libpq-be.h.html#LN180"><span class='Ref_to_Member'>ssl_in_use</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Connection is SSL, match both "host" and "hostssl" */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN1996"><span class='Ref_To_Local'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN64"><span class='Ref_to_Member'>conntype</span></a> <span class='Operator'>== </span><a href="../../include/libpq/hba.h.html#LN57"><span class='Ref_to_EnumConst'>ctHostNoSSL</span></a><span class='Parentheses'>) 
</span>                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Connection is not SSL, match both "host" and "hostnossl" */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN1996"><span class='Ref_To_Local'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN64"><span class='Ref_to_Member'>conntype</span></a> <span class='Operator'>== </span><a href="../../include/libpq/hba.h.html#LN56"><span class='Ref_to_EnumConst'>ctHostSSL</span></a><span class='Parentheses'>) 
</span>                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* Check IP address */ 
</span>            <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN1996"><span class='Ref_To_Local'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN69"><span class='Ref_to_Member'>ip_cmp_method</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>case</span> <a href="../../include/libpq/hba.h.html#LN46"><span class='Ref_to_EnumConst'>ipCmpMask</span></a><span class='Operator'>: 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN1996"><span class='Ref_To_Local'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN70"><span class='Ref_to_Member'>hostname</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="hba.c.html#LN691"><span class='Ref_to_Func'>check_hostname</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1992"><span class='Ref_to_Parameter'>port</span></a><span class='Delimiter'>, 
</span>                                            <a href="hba.c.html#LN1996"><span class='Ref_To_Local'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN70"><span class='Ref_to_Member'>hostname</span></a><span class='Parentheses'>))</span> 
                            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="hba.c.html#LN784"><span class='Ref_to_Func'>check_ip</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hba.c.html#LN1992"><span class='Ref_to_Parameter'>port</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/libpq-be.h.html#LN121"><span class='Ref_to_Member'>raddr</span></a><span class='Delimiter'>, 
</span>                                      <span class='Parentheses'>(</span><span class='Control'>struct</span> sockaddr <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>& </span><a href="hba.c.html#LN1996"><span class='Ref_To_Local'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN67"><span class='Ref_to_Member'>addr</span></a><span class='Delimiter'>, 
</span>                                      <span class='Parentheses'>(</span><span class='Control'>struct</span> sockaddr <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>& </span><a href="hba.c.html#LN1996"><span class='Ref_To_Local'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN68"><span class='Ref_to_Member'>mask</span></a><span class='Parentheses'>))</span> 
                            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <a href="../../include/libpq/hba.h.html#LN49"><span class='Ref_to_EnumConst'>ipCmpAll</span></a><span class='Operator'>: 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <a href="../../include/libpq/hba.h.html#LN47"><span class='Ref_to_EnumConst'>ipCmpSameHost</span></a><span class='Operator'>: 
</span>                <span class='Control'>case</span> <a href="../../include/libpq/hba.h.html#LN48"><span class='Ref_to_EnumConst'>ipCmpSameNet</span></a><span class='Operator'>: 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="hba.c.html#LN825"><span class='Ref_to_Func'>check_same_host_or_net</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hba.c.html#LN1992"><span class='Ref_to_Parameter'>port</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/libpq-be.h.html#LN121"><span class='Ref_to_Member'>raddr</span></a><span class='Delimiter'>, 
</span>                                                <a href="hba.c.html#LN1996"><span class='Ref_To_Local'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN69"><span class='Ref_to_Member'>ip_cmp_method</span></a><span class='Parentheses'>))</span> 
                        <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>default</span><span class='Operator'>: 
</span>                    <span class='Comment_Multi_Line'>/* shouldn't get here, but deem it no-match if so */ 
</span>                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch hba-&GT;ip_cmp_method &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span>                       <span class='Comment_Single_Line'>/* != ctLocal */ 
</span> 
        <span class='Comment_Multi_Line'>/* Check database and role */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="hba.c.html#LN608"><span class='Ref_to_Func'>check_db</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1992"><span class='Ref_to_Parameter'>port</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/libpq-be.h.html#LN135"><span class='Ref_to_Member'>database_name</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN1992"><span class='Ref_to_Parameter'>port</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/libpq-be.h.html#LN136"><span class='Ref_to_Member'>user_name</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN1994"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, 
</span>                      <a href="hba.c.html#LN1996"><span class='Ref_To_Local'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN65"><span class='Ref_to_Member'>databases</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/commands/variable.h.html#LN35"><span class='Ref_to_Proto'>check_role</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN1992"><span class='Ref_to_Parameter'>port</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/libpq-be.h.html#LN136"><span class='Ref_to_Member'>user_name</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN1994"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN1996"><span class='Ref_To_Local'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN66"><span class='Ref_to_Member'>roles</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Found a record that matched! */ 
</span>        <a href="hba.c.html#LN1992"><span class='Ref_to_Parameter'>port</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/libpq-be.h.html#LN143"><span class='Ref_to_Member'>hba</span></a> <span class='Operator'>= </span><a href="hba.c.html#LN1996"><span class='Ref_To_Local'>hba</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* If no matching entry was found, then implicitly reject. */ 
</span>    <a href="hba.c.html#LN1996"><span class='Ref_To_Local'>hba</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/libpq/hba.h.html#LN60"><span class='Ref_to_Struct'>HbaLine</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="hba.c.html#LN1996"><span class='Ref_To_Local'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN71"><span class='Ref_to_Member'>auth_method</span></a> <span class='Operator'>= </span><a href="../../include/libpq/hba.h.html#LN27"><span class='Ref_to_EnumConst'>uaImplicitReject</span></a><span class='Delimiter'>; 
</span>    <a href="hba.c.html#LN1992"><span class='Ref_to_Parameter'>port</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/libpq-be.h.html#LN143"><span class='Ref_to_Member'>hba</span></a> <span class='Operator'>= </span><a href="hba.c.html#LN1996"><span class='Ref_To_Local'>hba</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end check_hba &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Read the config file and create a List of HbaLine records for the contents. 
 * 
 * The configuration is read into a temporary list, and if any parse error 
 * occurs the old list is kept in place and false is returned.  Only if the 
 * whole file parses OK is the list replaced, and the function returns true. 
 * 
 * On a false result, caller will take care of reporting a FATAL error in case 
 * this is the initial startup.  If it happens on reload, we just keep running 
 * with the old data. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN2093"></a><span class='Declare_Function'>load_hba</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2095"></a>    FILE       <span class='Operator'>*</span><span class='Declare_Local'>file</span><span class='Delimiter'>; 
</span><a name="LN2096"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>hba_lines</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN2097"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>line</span><span class='Delimiter'>; 
</span><a name="LN2098"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>new_parsed_lines</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN2099"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>ok</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span><a name="LN2100"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>linecxt</span><span class='Delimiter'>; 
</span><a name="LN2101"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span><a name="LN2102"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>hbacxt</span><span class='Delimiter'>; 
</span> 
    <a href="hba.c.html#LN2095"><span class='Ref_To_Local'>file</span></a> <span class='Operator'>= </span><a href="../../include/storage/fd.h.html#LN83"><span class='Ref_to_Proto'>AllocateFile</span></a><span class='Parentheses'>(</span><a href="../utils/misc/guc.c.html#LN462"><span class='Ref_to_Global_Var'>HbaFileName</span></a><span class='Delimiter'>, </span><span class='String'>"r"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2095"><span class='Ref_To_Local'>file</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN132"><span class='Ref_to_Proto'>errcode_for_file_access</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not open configuration file \"%s\": %m"</span><span class='Delimiter'>, 
</span>                        <a href="../utils/misc/guc.c.html#LN462"><span class='Ref_to_Global_Var'>HbaFileName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="hba.c.html#LN2100"><span class='Ref_To_Local'>linecxt</span></a> <span class='Operator'>= </span><a href="hba.c.html#LN140"><span class='Ref_to_Proto'>tokenize_file</span></a><span class='Parentheses'>(</span><a href="../utils/misc/guc.c.html#LN462"><span class='Ref_to_Global_Var'>HbaFileName</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN2095"><span class='Ref_To_Local'>file</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="hba.c.html#LN2096"><span class='Ref_To_Local'>hba_lines</span></a><span class='Delimiter'>, </span><a href="../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/storage/fd.h.html#LN84"><span class='Ref_to_Proto'>FreeFile</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2095"><span class='Ref_To_Local'>file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Now parse all the lines */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN44"><span class='Ref_to_Global_Var'>PostmasterContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="hba.c.html#LN2102"><span class='Ref_To_Local'>hbacxt</span></a> <span class='Operator'>= </span><a href="../../include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN44"><span class='Ref_to_Global_Var'>PostmasterContext</span></a><span class='Delimiter'>, 
</span>                                   <span class='String'>"hba parser context"</span><span class='Delimiter'>, 
</span>                                   <a href="../../include/utils/memutils.h.html#LN174"><span class='Ref_to_Const'>ALLOCSET_SMALL_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="hba.c.html#LN2101"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2102"><span class='Ref_To_Local'>hbacxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2097"><span class='Ref_To_Local'>line</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN2096"><span class='Ref_To_Local'>hba_lines</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2125"></a>        <a href="hba.c.html#LN88"><span class='Ref_to_Struct'>TokenizedLine</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tok_line</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="hba.c.html#LN88"><span class='Ref_to_Struct'>TokenizedLine</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2097"><span class='Ref_To_Local'>line</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2126"></a>        <a href="../../include/libpq/hba.h.html#LN60"><span class='Ref_to_Struct'>HbaLine</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>newline</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* don't parse lines that already have errors */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2125"><span class='Ref_To_Local'>tok_line</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN93"><span class='Ref_to_Member'>err_msg</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="hba.c.html#LN2099"><span class='Ref_To_Local'>ok</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="hba.c.html#LN2126"><span class='Ref_To_Local'>newline</span></a> <span class='Operator'>= </span><a href="hba.c.html#LN943"><span class='Ref_to_Func'>parse_hba_line</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2125"><span class='Ref_To_Local'>tok_line</span></a><span class='Delimiter'>, </span><a href="../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Parse error; remember there's trouble */ 
</span>            <a href="hba.c.html#LN2099"><span class='Ref_To_Local'>ok</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Keep parsing the rest of the file so we can report errors on 
             * more than the first line.  Error has already been logged, no 
             * need for more chatter here. 
             */ 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="hba.c.html#LN2098"><span class='Ref_To_Local'>new_parsed_lines</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2098"><span class='Ref_To_Local'>new_parsed_lines</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN2126"><span class='Ref_To_Local'>newline</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * A valid HBA file must have at least one entry; else there's no way to 
     * connect to the postmaster.  But only complain about this if we didn't 
     * already have parsing errors. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2099"><span class='Ref_To_Local'>ok</span></a> <span class='Operator'>&& </span><a href="hba.c.html#LN2098"><span class='Ref_To_Local'>new_parsed_lines</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONFIG_FILE_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"configuration file \"%s\" contains no entries"</span><span class='Delimiter'>, 
</span>                        <a href="../utils/misc/guc.c.html#LN462"><span class='Ref_to_Global_Var'>HbaFileName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="hba.c.html#LN2099"><span class='Ref_To_Local'>ok</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Free tokenizer memory */ 
</span>    <a href="../../include/utils/memutils.h.html#LN74"><span class='Ref_to_Proto'>MemoryContextDelete</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2100"><span class='Ref_To_Local'>linecxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2101"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="hba.c.html#LN2099"><span class='Ref_To_Local'>ok</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* File contained one or more errors, so bail out */ 
</span>        <a href="../../include/utils/memutils.h.html#LN74"><span class='Ref_to_Proto'>MemoryContextDelete</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2102"><span class='Ref_To_Local'>hbacxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Loaded new file successfully, replace the one we use */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN101"><span class='Ref_to_Global_Var'>parsed_hba_context</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/memutils.h.html#LN74"><span class='Ref_to_Proto'>MemoryContextDelete</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN101"><span class='Ref_to_Global_Var'>parsed_hba_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="hba.c.html#LN101"><span class='Ref_to_Global_Var'>parsed_hba_context</span></a> <span class='Operator'>= </span><a href="hba.c.html#LN2102"><span class='Ref_To_Local'>hbacxt</span></a><span class='Delimiter'>; 
</span>    <a href="hba.c.html#LN100"><span class='Ref_to_Global_Var'>parsed_hba_lines</span></a> <span class='Operator'>= </span><a href="hba.c.html#LN2098"><span class='Ref_To_Local'>new_parsed_lines</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end load_hba &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * This macro specifies the maximum number of authentication options 
 * that are possible with any given authentication method that is supported. 
 * Currently LDAP supports 10, so the macro value is well above the most any 
 * method needs. 
 */ 
</span><a name="LN2191"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>MAX_HBA_OPTIONS</span> <span class='Number'>12</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Create a text array listing the options specified in the HBA line. 
 * Return NULL if no options are specified. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>* 
</span><a name="LN2198"></a><span class='Declare_Function'>gethba_options</span><span class='Parentheses'>(</span><a href="../../include/libpq/hba.h.html#LN60"><span class='Ref_to_Struct'>HbaLine</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>hba</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2200"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>noptions</span><span class='Delimiter'>; 
</span><a name="LN2201"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>options</span><span class='Delimiter'>[</span><a href="hba.c.html#LN2191"><span class='Ref_to_Const'>MAX_HBA_OPTIONS</span></a><span class='Delimiter'>]; 
</span> 
    <a href="hba.c.html#LN2200"><span class='Ref_To_Local'>noptions</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2198"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN71"><span class='Ref_to_Member'>auth_method</span></a> <span class='Operator'>== </span><a href="../../include/libpq/hba.h.html#LN33"><span class='Ref_to_EnumConst'>uaGSS</span></a> <span class='Operator'>|| </span><a href="hba.c.html#LN2198"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN71"><span class='Ref_to_Member'>auth_method</span></a> <span class='Operator'>== </span><a href="../../include/libpq/hba.h.html#LN34"><span class='Ref_to_EnumConst'>uaSSPI</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2198"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN88"><span class='Ref_to_Member'>include_realm</span></a><span class='Parentheses'>) 
</span>            <a href="hba.c.html#LN2201"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>[</span><a href="hba.c.html#LN2200"><span class='Ref_To_Local'>noptions</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>                <a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><span class='String'>"include_realm=true"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2198"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN87"><span class='Ref_to_Member'>krb_realm</span></a><span class='Parentheses'>) 
</span>            <a href="hba.c.html#LN2201"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>[</span><a href="hba.c.html#LN2200"><span class='Ref_To_Local'>noptions</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>                <a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"krb_realm=%s"</span><span class='Delimiter'>, </span><a href="hba.c.html#LN2198"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN87"><span class='Ref_to_Member'>krb_realm</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2198"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN73"><span class='Ref_to_Member'>usermap</span></a><span class='Parentheses'>) 
</span>        <a href="hba.c.html#LN2201"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>[</span><a href="hba.c.html#LN2200"><span class='Ref_To_Local'>noptions</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>            <a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"map=%s"</span><span class='Delimiter'>, </span><a href="hba.c.html#LN2198"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN73"><span class='Ref_to_Member'>usermap</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2198"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN86"><span class='Ref_to_Member'>clientcert</span></a><span class='Parentheses'>) 
</span>        <a href="hba.c.html#LN2201"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>[</span><a href="hba.c.html#LN2200"><span class='Ref_To_Local'>noptions</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>            <a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><span class='String'>"clientcert=true"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2198"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN74"><span class='Ref_to_Member'>pamservice</span></a><span class='Parentheses'>) 
</span>        <a href="hba.c.html#LN2201"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>[</span><a href="hba.c.html#LN2200"><span class='Ref_To_Local'>noptions</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>            <a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"pamservice=%s"</span><span class='Delimiter'>, </span><a href="hba.c.html#LN2198"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN74"><span class='Ref_to_Member'>pamservice</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2198"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN71"><span class='Ref_to_Member'>auth_method</span></a> <span class='Operator'>== </span><a href="../../include/libpq/hba.h.html#LN37"><span class='Ref_to_EnumConst'>uaLDAP</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2198"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN77"><span class='Ref_to_Member'>ldapserver</span></a><span class='Parentheses'>) 
</span>            <a href="hba.c.html#LN2201"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>[</span><a href="hba.c.html#LN2200"><span class='Ref_To_Local'>noptions</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>                <a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"ldapserver=%s"</span><span class='Delimiter'>, </span><a href="hba.c.html#LN2198"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN77"><span class='Ref_to_Member'>ldapserver</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2198"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN78"><span class='Ref_to_Member'>ldapport</span></a><span class='Parentheses'>) 
</span>            <a href="hba.c.html#LN2201"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>[</span><a href="hba.c.html#LN2200"><span class='Ref_To_Local'>noptions</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>                <a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"ldapport=%d"</span><span class='Delimiter'>, </span><a href="hba.c.html#LN2198"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN78"><span class='Ref_to_Member'>ldapport</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2198"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN76"><span class='Ref_to_Member'>ldaptls</span></a><span class='Parentheses'>) 
</span>            <a href="hba.c.html#LN2201"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>[</span><a href="hba.c.html#LN2200"><span class='Ref_To_Local'>noptions</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>                <a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><span class='String'>"ldaptls=true"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2198"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN84"><span class='Ref_to_Member'>ldapprefix</span></a><span class='Parentheses'>) 
</span>            <a href="hba.c.html#LN2201"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>[</span><a href="hba.c.html#LN2200"><span class='Ref_To_Local'>noptions</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>                <a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"ldapprefix=%s"</span><span class='Delimiter'>, </span><a href="hba.c.html#LN2198"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN84"><span class='Ref_to_Member'>ldapprefix</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2198"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN85"><span class='Ref_to_Member'>ldapsuffix</span></a><span class='Parentheses'>) 
</span>            <a href="hba.c.html#LN2201"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>[</span><a href="hba.c.html#LN2200"><span class='Ref_To_Local'>noptions</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>                <a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"ldapsuffix=%s"</span><span class='Delimiter'>, </span><a href="hba.c.html#LN2198"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN85"><span class='Ref_to_Member'>ldapsuffix</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2198"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN82"><span class='Ref_to_Member'>ldapbasedn</span></a><span class='Parentheses'>) 
</span>            <a href="hba.c.html#LN2201"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>[</span><a href="hba.c.html#LN2200"><span class='Ref_To_Local'>noptions</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>                <a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"ldapbasedn=%s"</span><span class='Delimiter'>, </span><a href="hba.c.html#LN2198"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN82"><span class='Ref_to_Member'>ldapbasedn</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2198"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN79"><span class='Ref_to_Member'>ldapbinddn</span></a><span class='Parentheses'>) 
</span>            <a href="hba.c.html#LN2201"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>[</span><a href="hba.c.html#LN2200"><span class='Ref_To_Local'>noptions</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>                <a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"ldapbinddn=%s"</span><span class='Delimiter'>, </span><a href="hba.c.html#LN2198"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN79"><span class='Ref_to_Member'>ldapbinddn</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2198"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN80"><span class='Ref_to_Member'>ldapbindpasswd</span></a><span class='Parentheses'>) 
</span>            <a href="hba.c.html#LN2201"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>[</span><a href="hba.c.html#LN2200"><span class='Ref_To_Local'>noptions</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>                <a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"ldapbindpasswd=%s"</span><span class='Delimiter'>, 
</span>                                             <a href="hba.c.html#LN2198"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN80"><span class='Ref_to_Member'>ldapbindpasswd</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2198"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN81"><span class='Ref_to_Member'>ldapsearchattribute</span></a><span class='Parentheses'>) 
</span>            <a href="hba.c.html#LN2201"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>[</span><a href="hba.c.html#LN2200"><span class='Ref_To_Local'>noptions</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>                <a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"ldapsearchattribute=%s"</span><span class='Delimiter'>, 
</span>                                             <a href="hba.c.html#LN2198"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN81"><span class='Ref_to_Member'>ldapsearchattribute</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2198"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN83"><span class='Ref_to_Member'>ldapscope</span></a><span class='Parentheses'>) 
</span>            <a href="hba.c.html#LN2201"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>[</span><a href="hba.c.html#LN2200"><span class='Ref_To_Local'>noptions</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>                <a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"ldapscope=%d"</span><span class='Delimiter'>, </span><a href="hba.c.html#LN2198"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN83"><span class='Ref_to_Member'>ldapscope</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if hba-&GT;auth_method==uaL... &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2198"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN71"><span class='Ref_to_Member'>auth_method</span></a> <span class='Operator'>== </span><a href="../../include/libpq/hba.h.html#LN39"><span class='Ref_to_EnumConst'>uaRADIUS</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2198"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN92"><span class='Ref_to_Member'>radiusservers_s</span></a><span class='Parentheses'>) 
</span>            <a href="hba.c.html#LN2201"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>[</span><a href="hba.c.html#LN2200"><span class='Ref_To_Local'>noptions</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>                <a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"radiusservers=%s"</span><span class='Delimiter'>, </span><a href="hba.c.html#LN2198"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN92"><span class='Ref_to_Member'>radiusservers_s</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2198"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN94"><span class='Ref_to_Member'>radiussecrets_s</span></a><span class='Parentheses'>) 
</span>            <a href="hba.c.html#LN2201"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>[</span><a href="hba.c.html#LN2200"><span class='Ref_To_Local'>noptions</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>                <a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"radiussecrets=%s"</span><span class='Delimiter'>, </span><a href="hba.c.html#LN2198"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN94"><span class='Ref_to_Member'>radiussecrets_s</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2198"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN96"><span class='Ref_to_Member'>radiusidentifiers_s</span></a><span class='Parentheses'>) 
</span>            <a href="hba.c.html#LN2201"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>[</span><a href="hba.c.html#LN2200"><span class='Ref_To_Local'>noptions</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>                <a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"radiusidentifiers=%s"</span><span class='Delimiter'>, </span><a href="hba.c.html#LN2198"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN96"><span class='Ref_to_Member'>radiusidentifiers_s</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2198"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN98"><span class='Ref_to_Member'>radiusports_s</span></a><span class='Parentheses'>) 
</span>            <a href="hba.c.html#LN2201"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>[</span><a href="hba.c.html#LN2200"><span class='Ref_To_Local'>noptions</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>                <a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"radiusports=%s"</span><span class='Delimiter'>, </span><a href="hba.c.html#LN2198"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN98"><span class='Ref_to_Member'>radiusports_s</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="hba.c.html#LN2200"><span class='Ref_To_Local'>noptions</span></a> <span class='Operator'>&LT;= </span><a href="hba.c.html#LN2191"><span class='Ref_to_Const'>MAX_HBA_OPTIONS</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2200"><span class='Ref_To_Local'>noptions</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../include/utils/array.h.html#LN369"><span class='Ref_to_Proto'>construct_array</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2201"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN2200"><span class='Ref_To_Local'>noptions</span></a><span class='Delimiter'>, </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='String'>'i'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end gethba_options &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* Number of columns in pg_hba_file_rules view */ 
</span><a name="LN2301"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>NUM_PG_HBA_FILE_RULES_ATTS</span>   <span class='Number'>9</span> 
 
<span class='Comment_Multi_Line'>/* 
 * fill_hba_line: build one row of pg_hba_file_rules view, add it to tuplestore 
 * 
 * tuple_store: where to store data 
 * tupdesc: tuple descriptor for the view 
 * lineno: pg_hba.conf line number (must always be valid) 
 * hba: parsed line data (can be NULL, in which case err_msg should be set) 
 * err_msg: error message (NULL if none) 
 * 
 * Note: leaks memory, but we don't care since this is run in a short-lived 
 * memory context. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2316"></a><span class='Declare_Function'>fill_hba_line</span><span class='Parentheses'>(</span><a href="../utils/sort/tuplestore.c.html#LN102"><span class='Ref_to_Struct'>Tuplestorestate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tuple_store</span><span class='Delimiter'>, </span><a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>tupdesc</span><span class='Delimiter'>, 
</span><a name="LN2317"></a>              <span class='Keyword'>int </span><span class='Declare_Parameter'>lineno</span><span class='Delimiter'>, </span><a href="../../include/libpq/hba.h.html#LN60"><span class='Ref_to_Struct'>HbaLine</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>hba</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>err_msg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2319"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><a href="hba.c.html#LN2301"><span class='Ref_to_Const'>NUM_PG_HBA_FILE_RULES_ATTS</span></a><span class='Delimiter'>]; 
</span><a name="LN2320"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><a href="hba.c.html#LN2301"><span class='Ref_to_Const'>NUM_PG_HBA_FILE_RULES_ATTS</span></a><span class='Delimiter'>]; 
</span><a name="LN2321"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>buffer</span><span class='Delimiter'>[</span><a href="../../include/getaddrinfo.h.html#LN87"><span class='Ref_to_Const'>NI_MAXHOST</span></a><span class='Delimiter'>]; 
</span><a name="LN2322"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN2323"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>index</span><span class='Delimiter'>; 
</span><a name="LN2324"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span><a name="LN2325"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>typestr</span><span class='Delimiter'>; 
</span><a name="LN2326"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>addrstr</span><span class='Delimiter'>; 
</span><a name="LN2327"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>maskstr</span><span class='Delimiter'>; 
</span><a name="LN2328"></a>    <a href="../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>options</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="hba.c.html#LN2316"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a> <span class='Operator'>== </span><a href="hba.c.html#LN2301"><span class='Ref_to_Const'>NUM_PG_HBA_FILE_RULES_ATTS</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    memset<span class='Parentheses'>(</span><a href="hba.c.html#LN2319"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="hba.c.html#LN2319"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memset<span class='Parentheses'>(</span><a href="hba.c.html#LN2320"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="hba.c.html#LN2320"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="hba.c.html#LN2323"><span class='Ref_To_Local'>index</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* line_number */ 
</span>    <a href="hba.c.html#LN2319"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="hba.c.html#LN2323"><span class='Ref_To_Local'>index</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN484"><span class='Ref_to_Macro'>Int32GetDatum</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2317"><span class='Ref_to_Parameter'>lineno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2317"><span class='Ref_to_Parameter'>hba</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* type */ 
</span>        <span class='Comment_Multi_Line'>/* Avoid a default: case so compiler will warn about missing cases */ 
</span>        <a href="hba.c.html#LN2325"><span class='Ref_To_Local'>typestr</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2317"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN64"><span class='Ref_to_Member'>conntype</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../include/libpq/hba.h.html#LN54"><span class='Ref_to_EnumConst'>ctLocal</span></a><span class='Operator'>: 
</span>                <a href="hba.c.html#LN2325"><span class='Ref_To_Local'>typestr</span></a> <span class='Operator'>= </span><span class='String'>"local"</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/libpq/hba.h.html#LN55"><span class='Ref_to_EnumConst'>ctHost</span></a><span class='Operator'>: 
</span>                <a href="hba.c.html#LN2325"><span class='Ref_To_Local'>typestr</span></a> <span class='Operator'>= </span><span class='String'>"host"</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/libpq/hba.h.html#LN56"><span class='Ref_to_EnumConst'>ctHostSSL</span></a><span class='Operator'>: 
</span>                <a href="hba.c.html#LN2325"><span class='Ref_To_Local'>typestr</span></a> <span class='Operator'>= </span><span class='String'>"hostssl"</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/libpq/hba.h.html#LN57"><span class='Ref_to_EnumConst'>ctHostNoSSL</span></a><span class='Operator'>: 
</span>                <a href="hba.c.html#LN2325"><span class='Ref_To_Local'>typestr</span></a> <span class='Operator'>= </span><span class='String'>"hostnossl"</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2325"><span class='Ref_To_Local'>typestr</span></a><span class='Parentheses'>) 
</span>            <a href="hba.c.html#LN2319"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="hba.c.html#LN2323"><span class='Ref_To_Local'>index</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2325"><span class='Ref_To_Local'>typestr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="hba.c.html#LN2320"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="hba.c.html#LN2323"><span class='Ref_To_Local'>index</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* database */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2317"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN65"><span class='Ref_to_Member'>databases</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Flatten HbaToken list to string list.  It might seem that we 
             * should re-quote any quoted tokens, but that has been rejected 
             * on the grounds that it makes it harder to compare the array 
             * elements to other system catalogs.  That makes entries like 
             * "all" or "samerole" formally ambiguous ... but users who name 
             * databases/roles that way are inflicting their own pain. 
             */ 
</span><a name="LN2375"></a>            <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>names</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
            <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2324"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN2317"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN65"><span class='Ref_to_Member'>databases</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2379"></a>                <a href="hba.c.html#LN74"><span class='Ref_to_Struct'>HbaToken</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>tok</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2324"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="hba.c.html#LN2375"><span class='Ref_To_Local'>names</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2375"><span class='Ref_To_Local'>names</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN2379"><span class='Ref_To_Local'>tok</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN76"><span class='Ref_to_Member'>string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="hba.c.html#LN2319"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="hba.c.html#LN2323"><span class='Ref_To_Local'>index</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/objectaddress.h.html#LN78"><span class='Ref_to_Proto'>strlist_to_textarray</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2375"><span class='Ref_To_Local'>names</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if hba-&GT;databases &raquo; </span> 
        <span class='Control'>else</span> 
            <a href="hba.c.html#LN2320"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="hba.c.html#LN2323"><span class='Ref_To_Local'>index</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* user */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2317"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN66"><span class='Ref_to_Member'>roles</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Flatten HbaToken list to string list; see comment above */ 
</span><a name="LN2392"></a>            <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>roles</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
            <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2324"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN2317"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN66"><span class='Ref_to_Member'>roles</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2396"></a>                <a href="hba.c.html#LN74"><span class='Ref_to_Struct'>HbaToken</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>tok</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2324"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="hba.c.html#LN2392"><span class='Ref_To_Local'>roles</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2392"><span class='Ref_To_Local'>roles</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN2396"><span class='Ref_To_Local'>tok</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN76"><span class='Ref_to_Member'>string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="hba.c.html#LN2319"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="hba.c.html#LN2323"><span class='Ref_To_Local'>index</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/objectaddress.h.html#LN78"><span class='Ref_to_Proto'>strlist_to_textarray</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2392"><span class='Ref_To_Local'>roles</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="hba.c.html#LN2320"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="hba.c.html#LN2323"><span class='Ref_To_Local'>index</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* address and netmask */ 
</span>        <span class='Comment_Multi_Line'>/* Avoid a default: case so compiler will warn about missing cases */ 
</span>        <a href="hba.c.html#LN2326"><span class='Ref_To_Local'>addrstr</span></a> <span class='Operator'>= </span><a href="hba.c.html#LN2327"><span class='Ref_To_Local'>maskstr</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2317"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN69"><span class='Ref_to_Member'>ip_cmp_method</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../include/libpq/hba.h.html#LN46"><span class='Ref_to_EnumConst'>ipCmpMask</span></a><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2317"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN70"><span class='Ref_to_Member'>hostname</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="hba.c.html#LN2326"><span class='Ref_To_Local'>addrstr</span></a> <span class='Operator'>= </span><a href="hba.c.html#LN2317"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN70"><span class='Ref_to_Member'>hostname</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/common/ip.h.html#LN31"><span class='Ref_to_Proto'>pg_getnameinfo_all</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hba.c.html#LN2317"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN67"><span class='Ref_to_Member'>addr</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="hba.c.html#LN2317"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN67"><span class='Ref_to_Member'>addr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                           <a href="hba.c.html#LN2321"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="hba.c.html#LN2321"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                           <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                           <a href="../../include/getaddrinfo.h.html#LN77"><span class='Ref_to_Const'>NI_NUMERICHOST</span></a><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="../../include/utils/builtins.h.html#LN108"><span class='Ref_to_Proto'>clean_ipv6_addr</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2317"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN67"><span class='Ref_to_Member'>addr</span></a><span class='Operator'>.</span>ss_family<span class='Delimiter'>, </span><a href="hba.c.html#LN2321"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="hba.c.html#LN2326"><span class='Ref_To_Local'>addrstr</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2321"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/common/ip.h.html#LN31"><span class='Ref_to_Proto'>pg_getnameinfo_all</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hba.c.html#LN2317"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN68"><span class='Ref_to_Member'>mask</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="hba.c.html#LN2317"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN68"><span class='Ref_to_Member'>mask</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                           <a href="hba.c.html#LN2321"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="hba.c.html#LN2321"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                           <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                           <a href="../../include/getaddrinfo.h.html#LN77"><span class='Ref_to_Const'>NI_NUMERICHOST</span></a><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="../../include/utils/builtins.h.html#LN108"><span class='Ref_to_Proto'>clean_ipv6_addr</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2317"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN68"><span class='Ref_to_Member'>mask</span></a><span class='Operator'>.</span>ss_family<span class='Delimiter'>, </span><a href="hba.c.html#LN2321"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="hba.c.html#LN2327"><span class='Ref_To_Local'>maskstr</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2321"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/libpq/hba.h.html#LN49"><span class='Ref_to_EnumConst'>ipCmpAll</span></a><span class='Operator'>: 
</span>                <a href="hba.c.html#LN2326"><span class='Ref_To_Local'>addrstr</span></a> <span class='Operator'>= </span><span class='String'>"all"</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/libpq/hba.h.html#LN47"><span class='Ref_to_EnumConst'>ipCmpSameHost</span></a><span class='Operator'>: 
</span>                <a href="hba.c.html#LN2326"><span class='Ref_To_Local'>addrstr</span></a> <span class='Operator'>= </span><span class='String'>"samehost"</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/libpq/hba.h.html#LN48"><span class='Ref_to_EnumConst'>ipCmpSameNet</span></a><span class='Operator'>: 
</span>                <a href="hba.c.html#LN2326"><span class='Ref_To_Local'>addrstr</span></a> <span class='Operator'>= </span><span class='String'>"samenet"</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch hba-&GT;ip_cmp_method &raquo; </span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2326"><span class='Ref_To_Local'>addrstr</span></a><span class='Parentheses'>) 
</span>            <a href="hba.c.html#LN2319"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="hba.c.html#LN2323"><span class='Ref_To_Local'>index</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2326"><span class='Ref_To_Local'>addrstr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="hba.c.html#LN2320"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="hba.c.html#LN2323"><span class='Ref_To_Local'>index</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2327"><span class='Ref_To_Local'>maskstr</span></a><span class='Parentheses'>) 
</span>            <a href="hba.c.html#LN2319"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="hba.c.html#LN2323"><span class='Ref_To_Local'>index</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2327"><span class='Ref_To_Local'>maskstr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="hba.c.html#LN2320"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="hba.c.html#LN2323"><span class='Ref_To_Local'>index</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Make sure UserAuthName[] tracks additions to the UserAuth enum 
         */ 
</span>        <a href="../../include/c.h.html#LN751"><span class='Ref_to_Macro'>StaticAssertStmt</span></a><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN561"><span class='Ref_to_Macro'>lengthof</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN120"><span class='Ref_to_Global_Var'>UserAuthName</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span>USER_AUTH_LAST <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                         <span class='String'>"UserAuthName[] must match the UserAuth enum"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* auth_method */ 
</span>        <a href="hba.c.html#LN2319"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="hba.c.html#LN2323"><span class='Ref_To_Local'>index</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN120"><span class='Ref_to_Global_Var'>UserAuthName</span></a><span class='Delimiter'>[</span><a href="hba.c.html#LN2317"><span class='Ref_to_Parameter'>hba</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN71"><span class='Ref_to_Member'>auth_method</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* options */ 
</span>        <a href="hba.c.html#LN2328"><span class='Ref_To_Local'>options</span></a> <span class='Operator'>= </span><a href="hba.c.html#LN148"><span class='Ref_to_Proto'>gethba_options</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2317"><span class='Ref_to_Parameter'>hba</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2328"><span class='Ref_To_Local'>options</span></a><span class='Parentheses'>) 
</span>            <a href="hba.c.html#LN2319"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="hba.c.html#LN2323"><span class='Ref_To_Local'>index</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2328"><span class='Ref_To_Local'>options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="hba.c.html#LN2320"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="hba.c.html#LN2323"><span class='Ref_To_Local'>index</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if hba!=NULL &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* no parsing result, so set relevant fields to nulls */ 
</span>        memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hba.c.html#LN2320"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="hba.c.html#LN2301"><span class='Ref_to_Const'>NUM_PG_HBA_FILE_RULES_ATTS</span></a> <span class='Operator'>- </span><span class='Number'>2</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* error */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2317"><span class='Ref_to_Parameter'>err_msg</span></a><span class='Parentheses'>) 
</span>        <a href="hba.c.html#LN2319"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="hba.c.html#LN2301"><span class='Ref_to_Const'>NUM_PG_HBA_FILE_RULES_ATTS</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2317"><span class='Ref_to_Parameter'>err_msg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="hba.c.html#LN2320"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="hba.c.html#LN2301"><span class='Ref_to_Const'>NUM_PG_HBA_FILE_RULES_ATTS</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="hba.c.html#LN2322"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2316"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN2319"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN2320"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/utils/tuplestore.h.html#LN54"><span class='Ref_to_Proto'>tuplestore_puttuple</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2316"><span class='Ref_to_Parameter'>tuple_store</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN2322"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end fill_hba_line &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Read the pg_hba.conf file and fill the tuplestore with view records. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2490"></a><span class='Declare_Function'>fill_hba_view</span><span class='Parentheses'>(</span><a href="../utils/sort/tuplestore.c.html#LN102"><span class='Ref_to_Struct'>Tuplestorestate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tuple_store</span><span class='Delimiter'>, </span><a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>tupdesc</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2492"></a>    FILE       <span class='Operator'>*</span><span class='Declare_Local'>file</span><span class='Delimiter'>; 
</span><a name="LN2493"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>hba_lines</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN2494"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>line</span><span class='Delimiter'>; 
</span><a name="LN2495"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>linecxt</span><span class='Delimiter'>; 
</span><a name="LN2496"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>hbacxt</span><span class='Delimiter'>; 
</span><a name="LN2497"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * In the unlikely event that we can't open pg_hba.conf, we throw an 
     * error, rather than trying to report it via some sort of view entry. 
     * (Most other error conditions should result in a message in a view 
     * entry.) 
     */ 
</span>    <a href="hba.c.html#LN2492"><span class='Ref_To_Local'>file</span></a> <span class='Operator'>= </span><a href="../../include/storage/fd.h.html#LN83"><span class='Ref_to_Proto'>AllocateFile</span></a><span class='Parentheses'>(</span><a href="../utils/misc/guc.c.html#LN462"><span class='Ref_to_Global_Var'>HbaFileName</span></a><span class='Delimiter'>, </span><span class='String'>"r"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2492"><span class='Ref_To_Local'>file</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN132"><span class='Ref_to_Proto'>errcode_for_file_access</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not open configuration file \"%s\": %m"</span><span class='Delimiter'>, 
</span>                        <a href="../utils/misc/guc.c.html#LN462"><span class='Ref_to_Global_Var'>HbaFileName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="hba.c.html#LN2495"><span class='Ref_To_Local'>linecxt</span></a> <span class='Operator'>= </span><a href="hba.c.html#LN140"><span class='Ref_to_Proto'>tokenize_file</span></a><span class='Parentheses'>(</span><a href="../utils/misc/guc.c.html#LN462"><span class='Ref_to_Global_Var'>HbaFileName</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN2492"><span class='Ref_To_Local'>file</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="hba.c.html#LN2493"><span class='Ref_To_Local'>hba_lines</span></a><span class='Delimiter'>, </span><a href="../../include/utils/elog.h.html#LN22"><span class='Ref_to_Const'>DEBUG3</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/storage/fd.h.html#LN84"><span class='Ref_to_Proto'>FreeFile</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2492"><span class='Ref_To_Local'>file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Now parse all the lines */ 
</span>    <a href="hba.c.html#LN2496"><span class='Ref_To_Local'>hbacxt</span></a> <span class='Operator'>= </span><a href="../../include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>, 
</span>                                   <span class='String'>"hba parser context"</span><span class='Delimiter'>, 
</span>                                   <a href="../../include/utils/memutils.h.html#LN174"><span class='Ref_to_Const'>ALLOCSET_SMALL_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="hba.c.html#LN2497"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2496"><span class='Ref_To_Local'>hbacxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2494"><span class='Ref_To_Local'>line</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN2493"><span class='Ref_To_Local'>hba_lines</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2522"></a>        <a href="hba.c.html#LN88"><span class='Ref_to_Struct'>TokenizedLine</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tok_line</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="hba.c.html#LN88"><span class='Ref_to_Struct'>TokenizedLine</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2494"><span class='Ref_To_Local'>line</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2523"></a>        <a href="../../include/libpq/hba.h.html#LN60"><span class='Ref_to_Struct'>HbaLine</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>hbaline</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* don't parse lines that already have errors */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2522"><span class='Ref_To_Local'>tok_line</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN93"><span class='Ref_to_Member'>err_msg</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="hba.c.html#LN2523"><span class='Ref_To_Local'>hbaline</span></a> <span class='Operator'>= </span><a href="hba.c.html#LN943"><span class='Ref_to_Func'>parse_hba_line</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2522"><span class='Ref_To_Local'>tok_line</span></a><span class='Delimiter'>, </span><a href="../../include/utils/elog.h.html#LN22"><span class='Ref_to_Const'>DEBUG3</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="hba.c.html#LN149"><span class='Ref_to_Proto'>fill_hba_line</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2490"><span class='Ref_to_Parameter'>tuple_store</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN2490"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN2522"><span class='Ref_To_Local'>tok_line</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN91"><span class='Ref_to_Member'>line_num</span></a><span class='Delimiter'>, 
</span>                      <a href="hba.c.html#LN2523"><span class='Ref_To_Local'>hbaline</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN2522"><span class='Ref_To_Local'>tok_line</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN93"><span class='Ref_to_Member'>err_msg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Free tokenizer memory */ 
</span>    <a href="../../include/utils/memutils.h.html#LN74"><span class='Ref_to_Proto'>MemoryContextDelete</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2495"><span class='Ref_To_Local'>linecxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Free parse_hba_line memory */ 
</span>    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2497"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/utils/memutils.h.html#LN74"><span class='Ref_to_Proto'>MemoryContextDelete</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2496"><span class='Ref_To_Local'>hbacxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end fill_hba_view &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * SQL-accessible SRF to return all the entries in the pg_hba.conf file. 
 */ 
</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2544"></a><span class='Declare_Function'>pg_hba_file_rules</span><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2546"></a>    <a href="../utils/sort/tuplestore.c.html#LN102"><span class='Ref_to_Struct'>Tuplestorestate</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tuple_store</span><span class='Delimiter'>; 
</span><a name="LN2547"></a>    <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupdesc</span><span class='Delimiter'>; 
</span><a name="LN2548"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>old_cxt</span><span class='Delimiter'>; 
</span><a name="LN2549"></a>    <a href="../../include/nodes/execnodes.h.html#LN261"><span class='Ref_to_Struct'>ReturnSetInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rsi</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We must use the Materialize mode to be safe against HBA file changes 
     * while the cursor is open. It's also more efficient than having to look 
     * up our current position in the parsed list every time. 
     */ 
</span>    <a href="hba.c.html#LN2549"><span class='Ref_To_Local'>rsi</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN261"><span class='Ref_to_Struct'>ReturnSetInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span>fcinfo<span class='Operator'>-&GT;</span>resultinfo<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check to see if caller supports us returning a tuplestore */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2549"><span class='Ref_To_Local'>rsi</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| !</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2549"><span class='Ref_To_Local'>rsi</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN261"><span class='Ref_to_Struct'>ReturnSetInfo</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"set-valued function called in context that cannot accept a set"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="hba.c.html#LN2549"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN267"><span class='Ref_to_Member'>allowedModes</span></a> <span class='Operator'>& </span><a href="../../include/nodes/execnodes.h.html#LN250"><span class='Ref_to_EnumConst'>SFRM_Materialize</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"materialize mode required, but it is not "</span> <span class='Operator'>\ 
</span>                        <span class='String'>"allowed in this context"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="hba.c.html#LN2549"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN269"><span class='Ref_to_Member'>returnMode</span></a> <span class='Operator'>= </span><a href="../../include/nodes/execnodes.h.html#LN250"><span class='Ref_to_EnumConst'>SFRM_Materialize</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Build a tuple descriptor for our result type */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/funcapi.h.html#LN157"><span class='Ref_to_Proto'>get_call_result_type</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="hba.c.html#LN2547"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../include/funcapi.h.html#LN152"><span class='Ref_to_EnumConst'>TYPEFUNC_COMPOSITE</span></a><span class='Parentheses'>)</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"return type must be a row type"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Build tuplestore to hold the result rows */ 
</span>    <a href="hba.c.html#LN2548"><span class='Ref_To_Local'>old_cxt</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2549"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN265"><span class='Ref_to_Member'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN201"><span class='Ref_to_Member'>ecxt_per_query_memory</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="hba.c.html#LN2546"><span class='Ref_To_Local'>tuple_store</span></a> <span class='Operator'>= 
</span>        <a href="../../include/utils/tuplestore.h.html#LN46"><span class='Ref_to_Proto'>tuplestore_begin_heap</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2549"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN267"><span class='Ref_to_Member'>allowedModes</span></a> <span class='Operator'>& </span><a href="../../include/nodes/execnodes.h.html#LN251"><span class='Ref_to_EnumConst'>SFRM_Materialize_Random</span></a><span class='Delimiter'>, 
</span>                              <span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="../utils/init/globals.c.html#LN112"><span class='Ref_to_Global_Var'>work_mem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="hba.c.html#LN2549"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN273"><span class='Ref_to_Member'>setDesc</span></a> <span class='Operator'>= </span><a href="hba.c.html#LN2547"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>; 
</span>    <a href="hba.c.html#LN2549"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN272"><span class='Ref_to_Member'>setResult</span></a> <span class='Operator'>= </span><a href="hba.c.html#LN2546"><span class='Ref_To_Local'>tuple_store</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2548"><span class='Ref_To_Local'>old_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Fill the tuplestore */ 
</span>    <a href="hba.c.html#LN151"><span class='Ref_to_Proto'>fill_hba_view</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2546"><span class='Ref_To_Local'>tuple_store</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN2547"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_hba_file_rules &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Parse one tokenised line from the ident config file and store the result in 
 * an IdentLine structure. 
 * 
 * If parsing fails, log a message and return NULL. 
 * 
 * If ident_user is a regular expression (ie. begins with a slash), it is 
 * compiled and stored in IdentLine structure. 
 * 
 * Note: this function leaks memory when an error occurs.  Caller is expected 
 * to have set a memory context that will be reset if this function returns 
 * NULL. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/libpq/hba.h.html#LN101"><span class='Ref_to_Struct'>IdentLine</span></a> <span class='Operator'>* 
</span><a name="LN2607"></a><span class='Declare_Function'>parse_ident_line</span><span class='Parentheses'>(</span><a href="hba.c.html#LN88"><span class='Ref_to_Struct'>TokenizedLine</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tok_line</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2609"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>line_num</span> <span class='Operator'>= </span><a href="hba.c.html#LN2607"><span class='Ref_to_Parameter'>tok_line</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN91"><span class='Ref_to_Member'>line_num</span></a><span class='Delimiter'>; 
</span><a name="LN2610"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>field</span><span class='Delimiter'>; 
</span><a name="LN2611"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>tokens</span><span class='Delimiter'>; 
</span><a name="LN2612"></a>    <a href="hba.c.html#LN74"><span class='Ref_to_Struct'>HbaToken</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>token</span><span class='Delimiter'>; 
</span><a name="LN2613"></a>    <a href="../../include/libpq/hba.h.html#LN101"><span class='Ref_to_Struct'>IdentLine</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>parsedline</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="hba.c.html#LN2607"><span class='Ref_to_Parameter'>tok_line</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN90"><span class='Ref_to_Member'>fields</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="hba.c.html#LN2610"><span class='Ref_To_Local'>field</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN75"><span class='Ref_to_Func'>list_head</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2607"><span class='Ref_to_Parameter'>tok_line</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN90"><span class='Ref_to_Member'>fields</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="hba.c.html#LN2613"><span class='Ref_To_Local'>parsedline</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/libpq/hba.h.html#LN101"><span class='Ref_to_Struct'>IdentLine</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="hba.c.html#LN2613"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN103"><span class='Ref_to_Member'>linenumber</span></a> <span class='Operator'>= </span><a href="hba.c.html#LN2609"><span class='Ref_To_Local'>line_num</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get the map token (must exist) */ 
</span>    <a href="hba.c.html#LN2611"><span class='Ref_To_Local'>tokens</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2610"><span class='Ref_To_Local'>field</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="hba.c.html#LN918"><span class='Ref_to_Macro'>IDENT_MULTI_VALUE</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2611"><span class='Ref_To_Local'>tokens</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="hba.c.html#LN2612"><span class='Ref_To_Local'>token</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2611"><span class='Ref_To_Local'>tokens</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="hba.c.html#LN2613"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN105"><span class='Ref_to_Member'>usermap</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2612"><span class='Ref_To_Local'>token</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN76"><span class='Ref_to_Member'>string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get the ident user token */ 
</span>    <a href="hba.c.html#LN2610"><span class='Ref_To_Local'>field</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2610"><span class='Ref_To_Local'>field</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="hba.c.html#LN907"><span class='Ref_to_Macro'>IDENT_FIELD_ABSENT</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2610"><span class='Ref_To_Local'>field</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="hba.c.html#LN2611"><span class='Ref_To_Local'>tokens</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2610"><span class='Ref_To_Local'>field</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="hba.c.html#LN918"><span class='Ref_to_Macro'>IDENT_MULTI_VALUE</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2611"><span class='Ref_To_Local'>tokens</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="hba.c.html#LN2612"><span class='Ref_To_Local'>token</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2611"><span class='Ref_To_Local'>tokens</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="hba.c.html#LN2613"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN106"><span class='Ref_to_Member'>ident_user</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2612"><span class='Ref_To_Local'>token</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN76"><span class='Ref_to_Member'>string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get the PG rolename token */ 
</span>    <a href="hba.c.html#LN2610"><span class='Ref_To_Local'>field</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2610"><span class='Ref_To_Local'>field</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="hba.c.html#LN907"><span class='Ref_to_Macro'>IDENT_FIELD_ABSENT</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2610"><span class='Ref_To_Local'>field</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="hba.c.html#LN2611"><span class='Ref_To_Local'>tokens</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2610"><span class='Ref_To_Local'>field</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="hba.c.html#LN918"><span class='Ref_to_Macro'>IDENT_MULTI_VALUE</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2611"><span class='Ref_To_Local'>tokens</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="hba.c.html#LN2612"><span class='Ref_To_Local'>token</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2611"><span class='Ref_To_Local'>tokens</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="hba.c.html#LN2613"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN107"><span class='Ref_to_Member'>pg_role</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2612"><span class='Ref_To_Local'>token</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN76"><span class='Ref_to_Member'>string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2613"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN106"><span class='Ref_to_Member'>ident_user</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'/'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * When system username starts with a slash, treat it as a regular 
         * expression. Pre-compile it. 
         */ 
</span><a name="LN2649"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>r</span><span class='Delimiter'>; 
</span><a name="LN2650"></a>        <a href="../../include/mb/pg_wchar.h.html#LN24"><span class='Ref_to_Typedef'>pg_wchar</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>wstr</span><span class='Delimiter'>; 
</span><a name="LN2651"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>wlen</span><span class='Delimiter'>; 
</span> 
        <a href="hba.c.html#LN2650"><span class='Ref_To_Local'>wstr</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>((</span>strlen<span class='Parentheses'>(</span><a href="hba.c.html#LN2613"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN106"><span class='Ref_to_Member'>ident_user</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/mb/pg_wchar.h.html#LN24"><span class='Ref_to_Typedef'>pg_wchar</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="hba.c.html#LN2651"><span class='Ref_To_Local'>wlen</span></a> <span class='Operator'>= </span><a href="../../include/mb/pg_wchar.h.html#LN510"><span class='Ref_to_Proto'>pg_mb2wchar_with_len</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2613"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN106"><span class='Ref_to_Member'>ident_user</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                    <a href="hba.c.html#LN2650"><span class='Ref_To_Local'>wstr</span></a><span class='Delimiter'>, </span>strlen<span class='Parentheses'>(</span><a href="hba.c.html#LN2613"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN106"><span class='Ref_to_Member'>ident_user</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="hba.c.html#LN2649"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>= </span><a href="../../include/regex/regex.h.html#LN169"><span class='Ref_to_Proto'>pg_regcomp</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hba.c.html#LN2613"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN108"><span class='Ref_to_Member'>re</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN2650"><span class='Ref_To_Local'>wstr</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN2651"><span class='Ref_To_Local'>wlen</span></a><span class='Delimiter'>, </span><a href="../../include/regex/regex.h.html#LN102"><span class='Ref_to_Const'>REG_ADVANCED</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_collation.h.html#LN77"><span class='Ref_to_Const'>C_COLLATION_OID</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2649"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2660"></a>            <span class='Keyword'>char</span>        <span class='Declare_Local'>errstr</span><span class='Delimiter'>[</span><span class='Number'>100</span><span class='Delimiter'>]; 
</span> 
            <a href="../regex/regerror.c.html#LN58"><span class='Ref_to_Func'>pg_regerror</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2649"><span class='Ref_To_Local'>r</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="hba.c.html#LN2613"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN108"><span class='Ref_to_Member'>re</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN2660"><span class='Ref_To_Local'>errstr</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="hba.c.html#LN2660"><span class='Ref_To_Local'>errstr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_REGULAR_EXPRESSION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid regular expression \"%s\": %s"</span><span class='Delimiter'>, 
</span>                            <a href="hba.c.html#LN2613"><span class='Ref_To_Local'>parsedline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN106"><span class='Ref_to_Member'>ident_user</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="hba.c.html#LN2660"><span class='Ref_To_Local'>errstr</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2650"><span class='Ref_To_Local'>wstr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2650"><span class='Ref_To_Local'>wstr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if parsedline-&GT;ident_use... &raquo; </span> 
 
    <span class='Control'>return</span> <a href="hba.c.html#LN2613"><span class='Ref_To_Local'>parsedline</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end parse_ident_line &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *  Process one line from the parsed ident config lines. 
 * 
 *  Compare input parsed ident line to the needed map, pg_role and ident_user. 
 *  *found_p and *error_p are set according to our results. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2684"></a><span class='Declare_Function'>check_ident_usermap</span><span class='Parentheses'>(</span><a href="../../include/libpq/hba.h.html#LN101"><span class='Ref_to_Struct'>IdentLine</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>identLine</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>usermap_name</span><span class='Delimiter'>, 
</span><a name="LN2685"></a>                    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>pg_role</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>ident_user</span><span class='Delimiter'>, 
</span><a name="LN2686"></a>                    <span class='Keyword'>bool </span><span class='Declare_Parameter'>case_insensitive</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>found_p</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>error_p</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Operator'>*</span><a href="hba.c.html#LN2686"><span class='Ref_to_Parameter'>found_p</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="hba.c.html#LN2686"><span class='Ref_to_Parameter'>error_p</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN2684"><span class='Ref_to_Parameter'>identLine</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN105"><span class='Ref_to_Member'>usermap</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN2684"><span class='Ref_to_Parameter'>usermap_name</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Comment_Multi_Line'>/* Line does not match the map name we're looking for, so just abort */ 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Match? */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2684"><span class='Ref_to_Parameter'>identLine</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN106"><span class='Ref_to_Member'>ident_user</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'/'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * When system username starts with a slash, treat it as a regular 
         * expression. In this case, we process the system username as a 
         * regular expression that returns exactly one match. This is replaced 
         * for \1 in the database username string, if present. 
         */ 
</span><a name="LN2704"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>r</span><span class='Delimiter'>; 
</span><a name="LN2705"></a>        <a href="../../include/regex/regex.h.html#LN82"><span class='Ref_to_Typedef'>regmatch_t</span></a>  <span class='Declare_Local'>matches</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]; 
</span><a name="LN2706"></a>        <a href="../../include/mb/pg_wchar.h.html#LN24"><span class='Ref_to_Typedef'>pg_wchar</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>wstr</span><span class='Delimiter'>; 
</span><a name="LN2707"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>wlen</span><span class='Delimiter'>; 
</span><a name="LN2708"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>ofs</span><span class='Delimiter'>; 
</span><a name="LN2709"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>regexp_pgrole</span><span class='Delimiter'>; 
</span> 
        <a href="hba.c.html#LN2706"><span class='Ref_To_Local'>wstr</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>((</span>strlen<span class='Parentheses'>(</span><a href="hba.c.html#LN2685"><span class='Ref_to_Parameter'>ident_user</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/mb/pg_wchar.h.html#LN24"><span class='Ref_to_Typedef'>pg_wchar</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="hba.c.html#LN2707"><span class='Ref_To_Local'>wlen</span></a> <span class='Operator'>= </span><a href="../../include/mb/pg_wchar.h.html#LN510"><span class='Ref_to_Proto'>pg_mb2wchar_with_len</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2685"><span class='Ref_to_Parameter'>ident_user</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN2706"><span class='Ref_To_Local'>wstr</span></a><span class='Delimiter'>, </span>strlen<span class='Parentheses'>(</span><a href="hba.c.html#LN2685"><span class='Ref_to_Parameter'>ident_user</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="hba.c.html#LN2704"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>= </span><a href="../regex/regexec.c.html#LN170"><span class='Ref_to_Func'>pg_regexec</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hba.c.html#LN2684"><span class='Ref_to_Parameter'>identLine</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN108"><span class='Ref_to_Member'>re</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN2706"><span class='Ref_To_Local'>wstr</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN2707"><span class='Ref_To_Local'>wlen</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="hba.c.html#LN2705"><span class='Ref_To_Local'>matches</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2704"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2717"></a>            <span class='Keyword'>char</span>        <span class='Declare_Local'>errstr</span><span class='Delimiter'>[</span><span class='Number'>100</span><span class='Delimiter'>]; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2704"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>!= </span><a href="../../include/regex/regex.h.html#LN137"><span class='Ref_to_Const'>REG_NOMATCH</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* REG_NOMATCH is not an error, everything else is */ 
</span>                <a href="../regex/regerror.c.html#LN58"><span class='Ref_to_Func'>pg_regerror</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2704"><span class='Ref_To_Local'>r</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="hba.c.html#LN2684"><span class='Ref_to_Parameter'>identLine</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN108"><span class='Ref_to_Member'>re</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN2717"><span class='Ref_To_Local'>errstr</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="hba.c.html#LN2717"><span class='Ref_To_Local'>errstr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_REGULAR_EXPRESSION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"regular expression match for \"%s\" failed: %s"</span><span class='Delimiter'>, 
</span>                            <a href="hba.c.html#LN2684"><span class='Ref_to_Parameter'>identLine</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN106"><span class='Ref_to_Member'>ident_user</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="hba.c.html#LN2717"><span class='Ref_To_Local'>errstr</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><a href="hba.c.html#LN2686"><span class='Ref_to_Parameter'>error_p</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2706"><span class='Ref_To_Local'>wstr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2706"><span class='Ref_To_Local'>wstr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="hba.c.html#LN2708"><span class='Ref_To_Local'>ofs</span></a> <span class='Operator'>= </span>strstr<span class='Parentheses'>(</span><a href="hba.c.html#LN2684"><span class='Ref_to_Parameter'>identLine</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN107"><span class='Ref_to_Member'>pg_role</span></a><span class='Delimiter'>, </span><span class='String'>"\\1"</span><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><a name="LN2737"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>offset</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* substitution of the first argument requested */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2705"><span class='Ref_To_Local'>matches</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../include/regex/regex.h.html#LN84"><span class='Ref_to_Member'>rm_so</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_REGULAR_EXPRESSION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"regular expression \"%s\" has no subexpressions as requested by backreference in \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="hba.c.html#LN2684"><span class='Ref_to_Parameter'>identLine</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN106"><span class='Ref_to_Member'>ident_user</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="hba.c.html#LN2684"><span class='Ref_to_Parameter'>identLine</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN107"><span class='Ref_to_Member'>pg_role</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><a href="hba.c.html#LN2686"><span class='Ref_to_Parameter'>error_p</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * length: original length minus length of \1 plus length of match 
             * plus null terminator 
             */ 
</span>            <a href="hba.c.html#LN2709"><span class='Ref_To_Local'>regexp_pgrole</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="hba.c.html#LN2684"><span class='Ref_to_Parameter'>identLine</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN107"><span class='Ref_to_Member'>pg_role</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><span class='Number'>2</span> <span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="hba.c.html#LN2705"><span class='Ref_To_Local'>matches</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../include/regex/regex.h.html#LN85"><span class='Ref_to_Member'>rm_eo</span></a> <span class='Operator'>- </span><a href="hba.c.html#LN2705"><span class='Ref_To_Local'>matches</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../include/regex/regex.h.html#LN84"><span class='Ref_to_Member'>rm_so</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="hba.c.html#LN2737"><span class='Ref_To_Local'>offset</span></a> <span class='Operator'>= </span><a href="hba.c.html#LN2708"><span class='Ref_To_Local'>ofs</span></a> <span class='Operator'>- </span><a href="hba.c.html#LN2684"><span class='Ref_to_Parameter'>identLine</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN107"><span class='Ref_to_Member'>pg_role</span></a><span class='Delimiter'>; 
</span>            memcpy<span class='Parentheses'>(</span><a href="hba.c.html#LN2709"><span class='Ref_To_Local'>regexp_pgrole</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN2684"><span class='Ref_to_Parameter'>identLine</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN107"><span class='Ref_to_Member'>pg_role</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN2737"><span class='Ref_To_Local'>offset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            memcpy<span class='Parentheses'>(</span><a href="hba.c.html#LN2709"><span class='Ref_To_Local'>regexp_pgrole</span></a> <span class='Operator'>+ </span><a href="hba.c.html#LN2737"><span class='Ref_To_Local'>offset</span></a><span class='Delimiter'>, 
</span>                   <a href="hba.c.html#LN2685"><span class='Ref_to_Parameter'>ident_user</span></a> <span class='Operator'>+ </span><a href="hba.c.html#LN2705"><span class='Ref_To_Local'>matches</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../include/regex/regex.h.html#LN84"><span class='Ref_to_Member'>rm_so</span></a><span class='Delimiter'>, 
</span>                   <a href="hba.c.html#LN2705"><span class='Ref_To_Local'>matches</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../include/regex/regex.h.html#LN85"><span class='Ref_to_Member'>rm_eo</span></a> <span class='Operator'>- </span><a href="hba.c.html#LN2705"><span class='Ref_To_Local'>matches</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../include/regex/regex.h.html#LN84"><span class='Ref_to_Member'>rm_so</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            strcat<span class='Parentheses'>(</span><a href="hba.c.html#LN2709"><span class='Ref_To_Local'>regexp_pgrole</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN2708"><span class='Ref_To_Local'>ofs</span></a> <span class='Operator'>+ </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if (ofs=strstr(identLine... &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* no substitution, so copy the match */ 
</span>            <a href="hba.c.html#LN2709"><span class='Ref_To_Local'>regexp_pgrole</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2684"><span class='Ref_to_Parameter'>identLine</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN107"><span class='Ref_to_Member'>pg_role</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * now check if the username actually matched what the user is trying 
         * to connect as 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2686"><span class='Ref_to_Parameter'>case_insensitive</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2709"><span class='Ref_To_Local'>regexp_pgrole</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN2685"><span class='Ref_to_Parameter'>pg_role</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Operator'>*</span><a href="hba.c.html#LN2686"><span class='Ref_to_Parameter'>found_p</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN2709"><span class='Ref_To_Local'>regexp_pgrole</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN2685"><span class='Ref_to_Parameter'>pg_role</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Operator'>*</span><a href="hba.c.html#LN2686"><span class='Ref_to_Parameter'>found_p</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2709"><span class='Ref_To_Local'>regexp_pgrole</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if identLine-&GT;ident_user... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Not regular expression, so make complete match */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2686"><span class='Ref_to_Parameter'>case_insensitive</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2684"><span class='Ref_to_Parameter'>identLine</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN107"><span class='Ref_to_Member'>pg_role</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN2685"><span class='Ref_to_Parameter'>pg_role</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>                <a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2684"><span class='Ref_to_Parameter'>identLine</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN106"><span class='Ref_to_Member'>ident_user</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN2685"><span class='Ref_to_Parameter'>ident_user</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Operator'>*</span><a href="hba.c.html#LN2686"><span class='Ref_to_Parameter'>found_p</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN2684"><span class='Ref_to_Parameter'>identLine</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN107"><span class='Ref_to_Member'>pg_role</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN2685"><span class='Ref_to_Parameter'>pg_role</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>                strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN2684"><span class='Ref_to_Parameter'>identLine</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN106"><span class='Ref_to_Member'>ident_user</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN2685"><span class='Ref_to_Parameter'>ident_user</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Operator'>*</span><a href="hba.c.html#LN2686"><span class='Ref_to_Parameter'>found_p</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end check_ident_usermap &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 *  Scan the (pre-parsed) ident usermap file line by line, looking for a match 
 * 
 *  See if the user with ident username "auth_user" is allowed to act 
 *  as Postgres user "pg_role" according to usermap "usermap_name". 
 * 
 *  Special case: Usermap NULL, equivalent to what was previously called 
 *  "sameuser" or "samerole", means don't look in the usermap file. 
 *  That's an implied map wherein "pg_role" must be identical to 
 *  "auth_user" in order to be authorized. 
 * 
 *  Iff authorized, return STATUS_OK, otherwise return STATUS_ERROR. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN2820"></a><span class='Declare_Function'>check_usermap</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>usermap_name</span><span class='Delimiter'>, 
</span><a name="LN2821"></a>              <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>pg_role</span><span class='Delimiter'>, 
</span><a name="LN2822"></a>              <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>auth_user</span><span class='Delimiter'>, 
</span><a name="LN2823"></a>              <span class='Keyword'>bool </span><span class='Declare_Parameter'>case_insensitive</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2825"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>found_entry</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span><a name="LN2826"></a>                <span class='Declare_Local'>error</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2820"><span class='Ref_to_Parameter'>usermap_name</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="hba.c.html#LN2820"><span class='Ref_to_Parameter'>usermap_name</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2823"><span class='Ref_to_Parameter'>case_insensitive</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2821"><span class='Ref_to_Parameter'>pg_role</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN2822"><span class='Ref_to_Parameter'>auth_user</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Control'>return</span> <a href="../../include/c.h.html#LN974"><span class='Ref_to_Const'>STATUS_OK</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="hba.c.html#LN2821"><span class='Ref_to_Parameter'>pg_role</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN2822"><span class='Ref_to_Parameter'>auth_user</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Control'>return</span> <a href="../../include/c.h.html#LN974"><span class='Ref_to_Const'>STATUS_OK</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"provided user name (%s) and authenticated user name (%s) do not match"</span><span class='Delimiter'>, 
</span>                        <a href="hba.c.html#LN2821"><span class='Ref_to_Parameter'>pg_role</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN2822"><span class='Ref_to_Parameter'>auth_user</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="../../include/c.h.html#LN975"><span class='Ref_to_Const'>STATUS_ERROR</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2847"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>line_cell</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2847"><span class='Ref_To_Local'>line_cell</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN111"><span class='Ref_to_Global_Var'>parsed_ident_lines</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="hba.c.html#LN2683"><span class='Ref_to_Func'>check_ident_usermap</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2847"><span class='Ref_To_Local'>line_cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="hba.c.html#LN2820"><span class='Ref_to_Parameter'>usermap_name</span></a><span class='Delimiter'>, 
</span>                                <a href="hba.c.html#LN2821"><span class='Ref_to_Parameter'>pg_role</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN2822"><span class='Ref_to_Parameter'>auth_user</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN2823"><span class='Ref_to_Parameter'>case_insensitive</span></a><span class='Delimiter'>, 
</span>                                <span class='Operator'>&</span><a href="hba.c.html#LN2825"><span class='Ref_To_Local'>found_entry</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="hba.c.html#LN2826"><span class='Ref_To_Local'>error</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2825"><span class='Ref_To_Local'>found_entry</span></a> <span class='Operator'>|| </span><a href="hba.c.html#LN2826"><span class='Ref_To_Local'>error</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="hba.c.html#LN2825"><span class='Ref_To_Local'>found_entry</span></a> <span class='Operator'>&& !</span><a href="hba.c.html#LN2826"><span class='Ref_To_Local'>error</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"no match in usermap \"%s\" for user \"%s\" authenticated as \"%s\""</span><span class='Delimiter'>, 
</span>                        <a href="hba.c.html#LN2820"><span class='Ref_to_Parameter'>usermap_name</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN2821"><span class='Ref_to_Parameter'>pg_role</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN2822"><span class='Ref_to_Parameter'>auth_user</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="hba.c.html#LN2825"><span class='Ref_To_Local'>found_entry</span></a> <span class='Operator'>? </span><a href="../../include/c.h.html#LN974"><span class='Ref_to_Const'>STATUS_OK</span></a> <span class='Operator'>: </span><a href="../../include/c.h.html#LN975"><span class='Ref_to_Const'>STATUS_ERROR</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end check_usermap &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Read the ident config file and create a List of IdentLine records for 
 * the contents. 
 * 
 * This works the same as load_hba(), but for the user config file. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN2875"></a><span class='Declare_Function'>load_ident</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2877"></a>    FILE       <span class='Operator'>*</span><span class='Declare_Local'>file</span><span class='Delimiter'>; 
</span><a name="LN2878"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>ident_lines</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN2879"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>line_cell</span><span class='Delimiter'>, 
</span><a name="LN2880"></a>               <span class='Operator'>*</span><span class='Declare_Local'>parsed_line_cell</span><span class='Delimiter'>; 
</span><a name="LN2881"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>new_parsed_lines</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN2882"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>ok</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span><a name="LN2883"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>linecxt</span><span class='Delimiter'>; 
</span><a name="LN2884"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span><a name="LN2885"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>ident_context</span><span class='Delimiter'>; 
</span><a name="LN2886"></a>    <a href="../../include/libpq/hba.h.html#LN101"><span class='Ref_to_Struct'>IdentLine</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>newline</span><span class='Delimiter'>; 
</span> 
    <a href="hba.c.html#LN2877"><span class='Ref_To_Local'>file</span></a> <span class='Operator'>= </span><a href="../../include/storage/fd.h.html#LN83"><span class='Ref_to_Proto'>AllocateFile</span></a><span class='Parentheses'>(</span><a href="../utils/misc/guc.c.html#LN463"><span class='Ref_to_Global_Var'>IdentFileName</span></a><span class='Delimiter'>, </span><span class='String'>"r"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2877"><span class='Ref_To_Local'>file</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* not fatal ... we just won't do any special ident maps */ 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN132"><span class='Ref_to_Proto'>errcode_for_file_access</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not open usermap file \"%s\": %m"</span><span class='Delimiter'>, 
</span>                        <a href="../utils/misc/guc.c.html#LN463"><span class='Ref_to_Global_Var'>IdentFileName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="hba.c.html#LN2883"><span class='Ref_To_Local'>linecxt</span></a> <span class='Operator'>= </span><a href="hba.c.html#LN140"><span class='Ref_to_Proto'>tokenize_file</span></a><span class='Parentheses'>(</span><a href="../utils/misc/guc.c.html#LN463"><span class='Ref_to_Global_Var'>IdentFileName</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN2877"><span class='Ref_To_Local'>file</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="hba.c.html#LN2878"><span class='Ref_To_Local'>ident_lines</span></a><span class='Delimiter'>, </span><a href="../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/storage/fd.h.html#LN84"><span class='Ref_to_Proto'>FreeFile</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2877"><span class='Ref_To_Local'>file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Now parse all the lines */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN44"><span class='Ref_to_Global_Var'>PostmasterContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="hba.c.html#LN2885"><span class='Ref_To_Local'>ident_context</span></a> <span class='Operator'>= </span><a href="../../include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN44"><span class='Ref_to_Global_Var'>PostmasterContext</span></a><span class='Delimiter'>, 
</span>                                          <span class='String'>"ident parser context"</span><span class='Delimiter'>, 
</span>                                          <a href="../../include/utils/memutils.h.html#LN174"><span class='Ref_to_Const'>ALLOCSET_SMALL_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="hba.c.html#LN2884"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2885"><span class='Ref_To_Local'>ident_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2879"><span class='Ref_To_Local'>line_cell</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN2878"><span class='Ref_To_Local'>ident_lines</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2910"></a>        <a href="hba.c.html#LN88"><span class='Ref_to_Struct'>TokenizedLine</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tok_line</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="hba.c.html#LN88"><span class='Ref_to_Struct'>TokenizedLine</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2879"><span class='Ref_To_Local'>line_cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* don't parse lines that already have errors */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2910"><span class='Ref_To_Local'>tok_line</span></a><span class='Operator'>-&GT;</span><a href="hba.c.html#LN93"><span class='Ref_to_Member'>err_msg</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="hba.c.html#LN2882"><span class='Ref_To_Local'>ok</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="hba.c.html#LN2886"><span class='Ref_To_Local'>newline</span></a> <span class='Operator'>= </span><a href="hba.c.html#LN2606"><span class='Ref_to_Func'>parse_ident_line</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2910"><span class='Ref_To_Local'>tok_line</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Parse error; remember there's trouble */ 
</span>            <a href="hba.c.html#LN2882"><span class='Ref_To_Local'>ok</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Keep parsing the rest of the file so we can report errors on 
             * more than the first line.  Error has already been logged, no 
             * need for more chatter here. 
             */ 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="hba.c.html#LN2881"><span class='Ref_To_Local'>new_parsed_lines</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2881"><span class='Ref_To_Local'>new_parsed_lines</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN2886"><span class='Ref_To_Local'>newline</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Free tokenizer memory */ 
</span>    <a href="../../include/utils/memutils.h.html#LN74"><span class='Ref_to_Proto'>MemoryContextDelete</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2883"><span class='Ref_To_Local'>linecxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2884"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="hba.c.html#LN2882"><span class='Ref_To_Local'>ok</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * File contained one or more errors, so bail out, first being careful 
         * to clean up whatever we allocated.  Most stuff will go away via 
         * MemoryContextDelete, but we have to clean up regexes explicitly. 
         */ 
</span>        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2880"><span class='Ref_To_Local'>parsed_line_cell</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN2881"><span class='Ref_To_Local'>new_parsed_lines</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="hba.c.html#LN2886"><span class='Ref_To_Local'>newline</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/libpq/hba.h.html#LN101"><span class='Ref_to_Struct'>IdentLine</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2880"><span class='Ref_To_Local'>parsed_line_cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2886"><span class='Ref_To_Local'>newline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN106"><span class='Ref_to_Member'>ident_user</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'/'</span><span class='Parentheses'>) 
</span>                <a href="../regex/regfree.c.html#LN47"><span class='Ref_to_Func'>pg_regfree</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hba.c.html#LN2886"><span class='Ref_To_Local'>newline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN108"><span class='Ref_to_Member'>re</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../include/utils/memutils.h.html#LN74"><span class='Ref_to_Proto'>MemoryContextDelete</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2885"><span class='Ref_To_Local'>ident_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Loaded new file successfully, replace the one we use */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN111"><span class='Ref_to_Global_Var'>parsed_ident_lines</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2880"><span class='Ref_To_Local'>parsed_line_cell</span></a><span class='Delimiter'>, </span><a href="hba.c.html#LN111"><span class='Ref_to_Global_Var'>parsed_ident_lines</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="hba.c.html#LN2886"><span class='Ref_To_Local'>newline</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/libpq/hba.h.html#LN101"><span class='Ref_to_Struct'>IdentLine</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2880"><span class='Ref_To_Local'>parsed_line_cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN2886"><span class='Ref_To_Local'>newline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN106"><span class='Ref_to_Member'>ident_user</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'/'</span><span class='Parentheses'>) 
</span>                <a href="../regex/regfree.c.html#LN47"><span class='Ref_to_Func'>pg_regfree</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hba.c.html#LN2886"><span class='Ref_To_Local'>newline</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/hba.h.html#LN108"><span class='Ref_to_Member'>re</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hba.c.html#LN112"><span class='Ref_to_Global_Var'>parsed_ident_context</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/memutils.h.html#LN74"><span class='Ref_to_Proto'>MemoryContextDelete</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN112"><span class='Ref_to_Global_Var'>parsed_ident_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="hba.c.html#LN112"><span class='Ref_to_Global_Var'>parsed_ident_context</span></a> <span class='Operator'>= </span><a href="hba.c.html#LN2885"><span class='Ref_To_Local'>ident_context</span></a><span class='Delimiter'>; 
</span>    <a href="hba.c.html#LN111"><span class='Ref_to_Global_Var'>parsed_ident_lines</span></a> <span class='Operator'>= </span><a href="hba.c.html#LN2881"><span class='Ref_To_Local'>new_parsed_lines</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end load_ident &raquo; </span> 
 
 
 
<span class='Comment_Multi_Line'>/* 
 *  Determine what authentication method should be used when accessing database 
 *  "database" from frontend "raddr", user "user".  Return the method and 
 *  an optional argument (stored in fields of *port), and STATUS_OK. 
 * 
 *  If the file does not contain any entry matching the request, we return 
 *  method = uaImplicitReject. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN2986"></a><span class='Declare_Function'>hba_getauthmethod</span><span class='Parentheses'>(</span><a href="../../include/libpq/hba.h.html#LN112"><span class='Ref_to_Typedef'>hbaPort</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>port</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="hba.c.html#LN1991"><span class='Ref_to_Func'>check_hba</span></a><span class='Parentheses'>(</span><a href="hba.c.html#LN2986"><span class='Ref_to_Parameter'>port</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>