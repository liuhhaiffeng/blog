<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\libpq\ifaddr.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\libpq\ifaddr.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:40 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * ifaddr.c 
 *    IP netmask calculations, and enumerating network interfaces. 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/libpq/ifaddr.c 
 * 
 * This file and the IPV6 implementation were initially provided by 
 * Nigel Kukard &LT;nkukard@lbsd.net&GT;, Linux Based Systems Design 
 * http://www.lbsd.net. 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span> 
<span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;unistd.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;sys/stat.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;sys/socket.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;netdb.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;netinet/in.h&GT;</span> 
<span class='Directive'>#ifdef</span> HAVE_NETINET_TCP_H 
<span class='Keyword'>#include </span><span class='String'>&LT;netinet/tcp.h&GT;</span> 
<span class='Directive'>#endif</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;arpa/inet.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;sys/file.h&GT;</span> 
 
<span class='Keyword'>#include </span><span class='String'>"libpq/ifaddr.h"</span> 
 
<a name="LN34"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>range_sockaddr_AF_INET</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><span class='Control'>struct</span> sockaddr_in <span class='Operator'>* </span><span class='Declare_Parameter'>addr</span><span class='Delimiter'>, 
</span><a name="LN35"></a>                       <span class='Keyword'>const </span><span class='Control'>struct</span> sockaddr_in <span class='Operator'>* </span><span class='Declare_Parameter'>netaddr</span><span class='Delimiter'>, 
</span><a name="LN36"></a>                       <span class='Keyword'>const </span><span class='Control'>struct</span> sockaddr_in <span class='Operator'>* </span><span class='Declare_Parameter'>netmask</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> HAVE_IPV6 
<a name="LN39"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>range_sockaddr_AF_INET6</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><span class='Control'>struct</span> sockaddr_in6 <span class='Operator'>* </span><span class='Declare_Parameter'>addr</span><span class='Delimiter'>, 
</span><a name="LN40"></a>                        <span class='Keyword'>const </span><span class='Control'>struct</span> sockaddr_in6 <span class='Operator'>* </span><span class='Declare_Parameter'>netaddr</span><span class='Delimiter'>, 
</span><a name="LN41"></a>                        <span class='Keyword'>const </span><span class='Control'>struct</span> sockaddr_in6 <span class='Operator'>* </span><span class='Declare_Parameter'>netmask</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * pg_range_sockaddr - is addr within the subnet specified by netaddr/netmask ? 
 * 
 * Note: caller must already have verified that all three addresses are 
 * in the same address family; and AF_UNIX addresses are not supported. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN52"></a><span class='Declare_Function'>pg_range_sockaddr</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><span class='Control'>struct</span> <a href="../../include/libpq/pqcomm.h.html#LN43"><span class='Ref_to_Struct'>sockaddr_storage</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>addr</span><span class='Delimiter'>, 
</span><a name="LN53"></a>                  <span class='Keyword'>const </span><span class='Control'>struct</span> <a href="../../include/libpq/pqcomm.h.html#LN43"><span class='Ref_to_Struct'>sockaddr_storage</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>netaddr</span><span class='Delimiter'>, 
</span><a name="LN54"></a>                  <span class='Keyword'>const </span><span class='Control'>struct</span> <a href="../../include/libpq/pqcomm.h.html#LN43"><span class='Ref_to_Struct'>sockaddr_storage</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>netmask</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ifaddr.c.html#LN52"><span class='Ref_to_Parameter'>addr</span></a><span class='Operator'>-&GT;</span>ss_family <span class='Operator'>== </span>AF_INET<span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="ifaddr.c.html#LN34"><span class='Ref_to_Proto'>range_sockaddr_AF_INET</span></a><span class='Parentheses'>((</span><span class='Keyword'>const </span><span class='Control'>struct</span> sockaddr_in <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="ifaddr.c.html#LN52"><span class='Ref_to_Parameter'>addr</span></a><span class='Delimiter'>, 
</span>                                      <span class='Parentheses'>(</span><span class='Keyword'>const </span><span class='Control'>struct</span> sockaddr_in <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="ifaddr.c.html#LN53"><span class='Ref_to_Parameter'>netaddr</span></a><span class='Delimiter'>, 
</span>                                      <span class='Parentheses'>(</span><span class='Keyword'>const </span><span class='Control'>struct</span> sockaddr_in <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="ifaddr.c.html#LN54"><span class='Ref_to_Parameter'>netmask</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#ifdef</span> HAVE_IPV6 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ifaddr.c.html#LN52"><span class='Ref_to_Parameter'>addr</span></a><span class='Operator'>-&GT;</span>ss_family <span class='Operator'>== </span>AF_INET6<span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="ifaddr.c.html#LN39"><span class='Ref_to_Proto'>range_sockaddr_AF_INET6</span></a><span class='Parentheses'>((</span><span class='Keyword'>const </span><span class='Control'>struct</span> sockaddr_in6 <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="ifaddr.c.html#LN52"><span class='Ref_to_Parameter'>addr</span></a><span class='Delimiter'>, 
</span>                                       <span class='Parentheses'>(</span><span class='Keyword'>const </span><span class='Control'>struct</span> sockaddr_in6 <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="ifaddr.c.html#LN53"><span class='Ref_to_Parameter'>netaddr</span></a><span class='Delimiter'>, 
</span>                                       <span class='Parentheses'>(</span><span class='Keyword'>const </span><span class='Control'>struct</span> sockaddr_in6 <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="ifaddr.c.html#LN54"><span class='Ref_to_Parameter'>netmask</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
    <span class='Control'>else</span> 
        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static int 
</span><a name="LN71"></a><span class='Declare_Function'>range_sockaddr_AF_INET</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><span class='Control'>struct</span> sockaddr_in <span class='Operator'>* </span><span class='Declare_Parameter'>addr</span><span class='Delimiter'>, 
</span><a name="LN72"></a>                       <span class='Keyword'>const </span><span class='Control'>struct</span> sockaddr_in <span class='Operator'>* </span><span class='Declare_Parameter'>netaddr</span><span class='Delimiter'>, 
</span><a name="LN73"></a>                       <span class='Keyword'>const </span><span class='Control'>struct</span> sockaddr_in <span class='Operator'>* </span><span class='Declare_Parameter'>netmask</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(((</span><a href="ifaddr.c.html#LN71"><span class='Ref_to_Parameter'>addr</span></a><span class='Operator'>-&GT;</span>sin_addr<span class='Operator'>.</span>s_addr <span class='Operator'>^ </span><a href="ifaddr.c.html#LN72"><span class='Ref_to_Parameter'>netaddr</span></a><span class='Operator'>-&GT;</span>sin_addr<span class='Operator'>.</span>s_addr<span class='Parentheses'>) </span><span class='Operator'>& 
</span>         <a href="ifaddr.c.html#LN73"><span class='Ref_to_Parameter'>netmask</span></a><span class='Operator'>-&GT;</span>sin_addr<span class='Operator'>.</span>s_addr<span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Directive'>#ifdef</span> HAVE_IPV6 
 
<span class='Keyword'>static int 
</span><a name="LN86"></a><span class='Declare_Function'>range_sockaddr_AF_INET6</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><span class='Control'>struct</span> sockaddr_in6 <span class='Operator'>* </span><span class='Declare_Parameter'>addr</span><span class='Delimiter'>, 
</span><a name="LN87"></a>                        <span class='Keyword'>const </span><span class='Control'>struct</span> sockaddr_in6 <span class='Operator'>* </span><span class='Declare_Parameter'>netaddr</span><span class='Delimiter'>, 
</span><a name="LN88"></a>                        <span class='Keyword'>const </span><span class='Control'>struct</span> sockaddr_in6 <span class='Operator'>* </span><span class='Declare_Parameter'>netmask</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN90"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="ifaddr.c.html#LN90"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="ifaddr.c.html#LN90"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><span class='Number'>16</span><span class='Delimiter'>; </span><a href="ifaddr.c.html#LN90"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(((</span><a href="ifaddr.c.html#LN86"><span class='Ref_to_Parameter'>addr</span></a><span class='Operator'>-&GT;</span>sin6_addr<span class='Operator'>.</span>s6_addr<span class='Delimiter'>[</span><a href="ifaddr.c.html#LN90"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>^ </span><a href="ifaddr.c.html#LN87"><span class='Ref_to_Parameter'>netaddr</span></a><span class='Operator'>-&GT;</span>sin6_addr<span class='Operator'>.</span>s6_addr<span class='Delimiter'>[</span><a href="ifaddr.c.html#LN90"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) </span><span class='Operator'>& 
</span>             <a href="ifaddr.c.html#LN88"><span class='Ref_to_Parameter'>netmask</span></a><span class='Operator'>-&GT;</span>sin6_addr<span class='Operator'>.</span>s6_addr<span class='Delimiter'>[</span><a href="ifaddr.c.html#LN90"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
} 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* HAVE_IPV6 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 *  pg_sockaddr_cidr_mask - make a network mask of the appropriate family 
 *    and required number of significant bits 
 * 
 * numbits can be null, in which case the mask is fully set. 
 * 
 * The resulting mask is placed in *mask, which had better be big enough. 
 * 
 * Return value is 0 if okay, -1 if not. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN114"></a><span class='Declare_Function'>pg_sockaddr_cidr_mask</span><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="../../include/libpq/pqcomm.h.html#LN43"><span class='Ref_to_Struct'>sockaddr_storage</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>mask</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>numbits</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>family</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN116"></a>    <span class='Keyword'>long</span>        <span class='Declare_Local'>bits</span><span class='Delimiter'>; 
</span><a name="LN117"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>endptr</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ifaddr.c.html#LN114"><span class='Ref_to_Parameter'>numbits</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="ifaddr.c.html#LN116"><span class='Ref_To_Local'>bits</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="ifaddr.c.html#LN114"><span class='Ref_to_Parameter'>family</span></a> <span class='Operator'>== </span>AF_INET<span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Number'>32</span> <span class='Operator'>: </span><span class='Number'>128</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="ifaddr.c.html#LN116"><span class='Ref_To_Local'>bits</span></a> <span class='Operator'>= </span>strtol<span class='Parentheses'>(</span><a href="ifaddr.c.html#LN114"><span class='Ref_to_Parameter'>numbits</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="ifaddr.c.html#LN117"><span class='Ref_To_Local'>endptr</span></a><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="ifaddr.c.html#LN114"><span class='Ref_to_Parameter'>numbits</span></a> <span class='Operator'>== </span><span class='String'>'\0'</span> <span class='Operator'>|| *</span><a href="ifaddr.c.html#LN117"><span class='Ref_To_Local'>endptr</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="ifaddr.c.html#LN114"><span class='Ref_to_Parameter'>family</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> AF_INET<span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN134"></a>                <span class='Control'>struct</span> sockaddr_in <span class='Declare_Local'>mask4</span><span class='Delimiter'>; 
</span><a name="LN135"></a>                <span class='Keyword'>long</span>        <span class='Declare_Local'>maskl</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ifaddr.c.html#LN116"><span class='Ref_To_Local'>bits</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="ifaddr.c.html#LN116"><span class='Ref_To_Local'>bits</span></a> <span class='Operator'>&GT; </span><span class='Number'>32</span><span class='Parentheses'>) 
</span>                    <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ifaddr.c.html#LN134"><span class='Ref_To_Local'>mask4</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="ifaddr.c.html#LN134"><span class='Ref_To_Local'>mask4</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* avoid "x &LT;&LT; 32", which is not portable */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ifaddr.c.html#LN116"><span class='Ref_To_Local'>bits</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <a href="ifaddr.c.html#LN135"><span class='Ref_To_Local'>maskl</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Number'>0xffffffffUL</span> <span class='Operator'>&LT;&LT; </span><span class='Parentheses'>(</span><span class='Number'>32</span> <span class='Operator'>- </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="ifaddr.c.html#LN116"><span class='Ref_To_Local'>bits</span></a><span class='Parentheses'>))</span> 
                        <span class='Operator'>& </span><span class='Number'>0xffffffffUL</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="ifaddr.c.html#LN135"><span class='Ref_To_Local'>maskl</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <a href="ifaddr.c.html#LN134"><span class='Ref_To_Local'>mask4</span></a><span class='Operator'>.</span>sin_addr<span class='Operator'>.</span>s_addr <span class='Operator'>= </span>htonl<span class='Parentheses'>(</span><a href="ifaddr.c.html#LN135"><span class='Ref_To_Local'>maskl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                memcpy<span class='Parentheses'>(</span><a href="ifaddr.c.html#LN114"><span class='Ref_to_Parameter'>mask</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="ifaddr.c.html#LN134"><span class='Ref_To_Local'>mask4</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="ifaddr.c.html#LN134"><span class='Ref_To_Local'>mask4</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
<span class='Directive'>#ifdef</span> HAVE_IPV6 
        <span class='Control'>case</span> AF_INET6<span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN154"></a>                <span class='Control'>struct</span> sockaddr_in6 <span class='Declare_Local'>mask6</span><span class='Delimiter'>; 
</span><a name="LN155"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ifaddr.c.html#LN116"><span class='Ref_To_Local'>bits</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="ifaddr.c.html#LN116"><span class='Ref_To_Local'>bits</span></a> <span class='Operator'>&GT; </span><span class='Number'>128</span><span class='Parentheses'>) 
</span>                    <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ifaddr.c.html#LN154"><span class='Ref_To_Local'>mask6</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="ifaddr.c.html#LN154"><span class='Ref_To_Local'>mask6</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="ifaddr.c.html#LN155"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="ifaddr.c.html#LN155"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><span class='Number'>16</span><span class='Delimiter'>; </span><a href="ifaddr.c.html#LN155"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ifaddr.c.html#LN116"><span class='Ref_To_Local'>bits</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                        <a href="ifaddr.c.html#LN154"><span class='Ref_To_Local'>mask6</span></a><span class='Operator'>.</span>sin6_addr<span class='Operator'>.</span>s6_addr<span class='Delimiter'>[</span><a href="ifaddr.c.html#LN155"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ifaddr.c.html#LN116"><span class='Ref_To_Local'>bits</span></a> <span class='Operator'>&GT;= </span><span class='Number'>8</span><span class='Parentheses'>) 
</span>                        <a href="ifaddr.c.html#LN154"><span class='Ref_To_Local'>mask6</span></a><span class='Operator'>.</span>sin6_addr<span class='Operator'>.</span>s6_addr<span class='Delimiter'>[</span><a href="ifaddr.c.html#LN155"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>0xff</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="ifaddr.c.html#LN154"><span class='Ref_To_Local'>mask6</span></a><span class='Operator'>.</span>sin6_addr<span class='Operator'>.</span>s6_addr<span class='Delimiter'>[</span><a href="ifaddr.c.html#LN155"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= 
</span>                            <span class='Parentheses'>(</span><span class='Number'>0xff</span> <span class='Operator'>&LT;&LT; </span><span class='Parentheses'>(</span><span class='Number'>8</span> <span class='Operator'>- </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="ifaddr.c.html#LN116"><span class='Ref_To_Local'>bits</span></a><span class='Parentheses'>))</span> <span class='Operator'>& </span><span class='Number'>0xff</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <a href="ifaddr.c.html#LN116"><span class='Ref_To_Local'>bits</span></a> <span class='Operator'>-= </span><span class='Number'>8</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                memcpy<span class='Parentheses'>(</span><a href="ifaddr.c.html#LN114"><span class='Ref_to_Parameter'>mask</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="ifaddr.c.html#LN154"><span class='Ref_To_Local'>mask6</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="ifaddr.c.html#LN154"><span class='Ref_To_Local'>mask6</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span><span class='Directive'>#endif</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch family &raquo; </span> 
 
    <a href="ifaddr.c.html#LN114"><span class='Ref_to_Parameter'>mask</span></a><span class='Operator'>-&GT;</span>ss_family <span class='Operator'>= </span><a href="ifaddr.c.html#LN114"><span class='Ref_to_Parameter'>family</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_sockaddr_cidr_mask &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Run the callback function for the addr/mask, after making sure the 
 * mask is sane for the addr. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN191"></a><span class='Declare_Function'>run_ifaddr_callback</span><span class='Parentheses'>(</span><a href="../../include/libpq/ifaddr.h.html#LN16"><span class='Ref_to_Typedef'>PgIfAddrCallback</span></a> <span class='Declare_Parameter'>callback</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>cb_data</span><span class='Delimiter'>, 
</span><a name="LN192"></a>                    <span class='Control'>struct</span> sockaddr <span class='Operator'>* </span><span class='Declare_Parameter'>addr</span><span class='Delimiter'>, </span><span class='Control'>struct</span> sockaddr <span class='Operator'>* </span><span class='Declare_Parameter'>mask</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN194"></a>    <span class='Control'>struct</span> <a href="../../include/libpq/pqcomm.h.html#LN43"><span class='Ref_to_Struct'>sockaddr_storage</span></a> <span class='Declare_Local'>fullmask</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="ifaddr.c.html#LN192"><span class='Ref_to_Parameter'>addr</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check that the mask is valid */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ifaddr.c.html#LN192"><span class='Ref_to_Parameter'>mask</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ifaddr.c.html#LN192"><span class='Ref_to_Parameter'>mask</span></a><span class='Operator'>-&GT;</span>sa_family <span class='Operator'>!= </span><a href="ifaddr.c.html#LN192"><span class='Ref_to_Parameter'>addr</span></a><span class='Operator'>-&GT;</span>sa_family<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="ifaddr.c.html#LN192"><span class='Ref_to_Parameter'>mask</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ifaddr.c.html#LN192"><span class='Ref_to_Parameter'>mask</span></a><span class='Operator'>-&GT;</span>sa_family <span class='Operator'>== </span>AF_INET<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(((</span><span class='Control'>struct</span> sockaddr_in <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="ifaddr.c.html#LN192"><span class='Ref_to_Parameter'>mask</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>sin_addr<span class='Operator'>.</span>s_addr <span class='Operator'>== </span>INADDR_ANY<span class='Parentheses'>)</span> 
                <a href="ifaddr.c.html#LN192"><span class='Ref_to_Parameter'>mask</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span><span class='Directive'>#ifdef</span> HAVE_IPV6 
        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ifaddr.c.html#LN192"><span class='Ref_to_Parameter'>mask</span></a><span class='Operator'>-&GT;</span>sa_family <span class='Operator'>== </span>AF_INET6<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>IN6_IS_ADDR_UNSPECIFIED<span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>((</span><span class='Control'>struct</span> sockaddr_in6 <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="ifaddr.c.html#LN192"><span class='Ref_to_Parameter'>mask</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>sin6_addr<span class='Parentheses'>))</span> 
                <a href="ifaddr.c.html#LN192"><span class='Ref_to_Parameter'>mask</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span><span class='Directive'>#endif</span> 
    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* If mask is invalid, generate our own fully-set mask */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="ifaddr.c.html#LN192"><span class='Ref_to_Parameter'>mask</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/libpq/ifaddr.h.html#LN24"><span class='Ref_to_Proto'>pg_sockaddr_cidr_mask</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ifaddr.c.html#LN194"><span class='Ref_To_Local'>fullmask</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="ifaddr.c.html#LN192"><span class='Ref_to_Parameter'>addr</span></a><span class='Operator'>-&GT;</span>sa_family<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="ifaddr.c.html#LN192"><span class='Ref_to_Parameter'>mask</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Control'>struct</span> sockaddr <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>& </span><a href="ifaddr.c.html#LN194"><span class='Ref_To_Local'>fullmask</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="ifaddr.c.html#LN191"><span class='Ref_to_Parameter'>callback</span></a><span class='Parentheses'>) (</span><a href="ifaddr.c.html#LN192"><span class='Ref_to_Parameter'>addr</span></a><span class='Delimiter'>, </span><a href="ifaddr.c.html#LN192"><span class='Ref_to_Parameter'>mask</span></a><span class='Delimiter'>, </span><a href="ifaddr.c.html#LN191"><span class='Ref_to_Parameter'>cb_data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end run_ifaddr_callback &raquo; </span> 
 
<span class='Directive'>#ifdef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;winsock2.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;ws2tcpip.h&GT;</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Enumerate the system's network interface addresses and call the callback 
 * for each one.  Returns 0 if successful, -1 if trouble. 
 * 
 * This version is for Win32.  Uses the Winsock 2 functions (ie: ws2_32.dll) 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN242"></a><span class='Declare_Function'>pg_foreach_ifaddr</span><span class='Parentheses'>(</span><a href="../../include/libpq/ifaddr.h.html#LN16"><span class='Ref_to_Typedef'>PgIfAddrCallback</span></a> <span class='Declare_Parameter'>callback</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>cb_data</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN244"></a>    INTERFACE_INFO <span class='Operator'>*</span><span class='Declare_Local'>ptr</span><span class='Delimiter'>, 
</span><a name="LN245"></a>               <span class='Operator'>*</span><span class='Declare_Local'>ii</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN246"></a>    <span class='Keyword'>unsigned long </span><span class='Declare_Local'>length</span><span class='Delimiter'>, 
</span><a name="LN247"></a>                <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN248"></a>    <span class='Keyword'>unsigned long </span><span class='Declare_Local'>n_ii</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN249"></a>    SOCKET      <span class='Declare_Local'>sock</span><span class='Delimiter'>; 
</span><a name="LN250"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>error</span><span class='Delimiter'>; 
</span> 
    <a href="ifaddr.c.html#LN249"><span class='Ref_To_Local'>sock</span></a> <span class='Operator'>= </span>WSASocket<span class='Parentheses'>(</span>AF_INET<span class='Delimiter'>, </span>SOCK_DGRAM<span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ifaddr.c.html#LN249"><span class='Ref_To_Local'>sock</span></a> <span class='Operator'>== </span>INVALID_SOCKET<span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="ifaddr.c.html#LN248"><span class='Ref_To_Local'>n_ii</span></a> <span class='Operator'>&LT; </span><span class='Number'>1024</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="ifaddr.c.html#LN248"><span class='Ref_To_Local'>n_ii</span></a> <span class='Operator'>+= </span><span class='Number'>64</span><span class='Delimiter'>; 
</span>        <a href="ifaddr.c.html#LN244"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>= </span><a href="../../include/snowball/header.h.html#LN59"><span class='Ref_to_Macro'>realloc</span></a><span class='Parentheses'>(</span><a href="ifaddr.c.html#LN245"><span class='Ref_To_Local'>ii</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span>INTERFACE_INFO<span class='Parentheses'>) </span><span class='Operator'>* </span><a href="ifaddr.c.html#LN248"><span class='Ref_To_Local'>n_ii</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="ifaddr.c.html#LN244"><span class='Ref_To_Local'>ptr</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="ifaddr.c.html#LN245"><span class='Ref_To_Local'>ii</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../interfaces/libpq/win32.h.html#LN11"><span class='Ref_to_Macro'>closesocket</span></a><span class='Parentheses'>(</span><a href="ifaddr.c.html#LN249"><span class='Ref_To_Local'>sock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            errno <span class='Operator'>= </span>ENOMEM<span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="ifaddr.c.html#LN245"><span class='Ref_To_Local'>ii</span></a> <span class='Operator'>= </span><a href="ifaddr.c.html#LN244"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>WSAIoctl<span class='Parentheses'>(</span><a href="ifaddr.c.html#LN249"><span class='Ref_To_Local'>sock</span></a><span class='Delimiter'>, </span>SIO_GET_INTERFACE_LIST<span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                     <a href="ifaddr.c.html#LN245"><span class='Ref_To_Local'>ii</span></a><span class='Delimiter'>, </span><a href="ifaddr.c.html#LN248"><span class='Ref_To_Local'>n_ii</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span>INTERFACE_INFO<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <span class='Operator'>&</span><a href="ifaddr.c.html#LN246"><span class='Ref_To_Local'>length</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span> <span class='Operator'>== </span>SOCKET_ERROR<span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="ifaddr.c.html#LN250"><span class='Ref_To_Local'>error</span></a> <span class='Operator'>= </span>WSAGetLastError<span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ifaddr.c.html#LN250"><span class='Ref_To_Local'>error</span></a> <span class='Operator'>== </span>WSAEFAULT <span class='Operator'>|| </span><a href="ifaddr.c.html#LN250"><span class='Ref_To_Local'>error</span></a> <span class='Operator'>== </span>WSAENOBUFS<span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* need to make the buffer bigger */ 
</span>            <a href="../../interfaces/libpq/win32.h.html#LN11"><span class='Ref_to_Macro'>closesocket</span></a><span class='Parentheses'>(</span><a href="ifaddr.c.html#LN249"><span class='Ref_To_Local'>sock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="ifaddr.c.html#LN245"><span class='Ref_To_Local'>ii</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while n_ii&LT;1024 &raquo; </span> 
 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="ifaddr.c.html#LN247"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="ifaddr.c.html#LN247"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="ifaddr.c.html#LN246"><span class='Ref_To_Local'>length</span></a> <span class='Operator'>/ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span>INTERFACE_INFO<span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>++</span><a href="ifaddr.c.html#LN247"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span> 
        <a href="ifaddr.c.html#LN190"><span class='Ref_to_Func'>run_ifaddr_callback</span></a><span class='Parentheses'>(</span><a href="ifaddr.c.html#LN242"><span class='Ref_to_Parameter'>callback</span></a><span class='Delimiter'>, </span><a href="ifaddr.c.html#LN242"><span class='Ref_to_Parameter'>cb_data</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><span class='Control'>struct</span> sockaddr <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>& </span><a href="ifaddr.c.html#LN245"><span class='Ref_To_Local'>ii</span></a><span class='Delimiter'>[</span><a href="ifaddr.c.html#LN247"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span>iiAddress<span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><span class='Control'>struct</span> sockaddr <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>& </span><a href="ifaddr.c.html#LN245"><span class='Ref_To_Local'>ii</span></a><span class='Delimiter'>[</span><a href="ifaddr.c.html#LN247"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span>iiNetmask<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../interfaces/libpq/win32.h.html#LN11"><span class='Ref_to_Macro'>closesocket</span></a><span class='Parentheses'>(</span><a href="ifaddr.c.html#LN249"><span class='Ref_To_Local'>sock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="ifaddr.c.html#LN245"><span class='Ref_To_Local'>ii</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_foreach_ifaddr &raquo; </span> 
<span class='Directive'>#elif</span> HAVE_GETIFADDRS           <span class='Comment_Single_Line'>/* && !WIN32 */ 
</span> 
<span class='Directive'>#ifdef</span> HAVE_IFADDRS_H 
<span class='Keyword'>#include </span><span class='String'>&LT;ifaddrs.h&GT;</span> 
<span class='Directive'>#endif</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Enumerate the system's network interface addresses and call the callback 
 * for each one.  Returns 0 if successful, -1 if trouble. 
 * 
 * This version uses the getifaddrs() interface, which is available on 
 * BSDs, AIX, and modern Linux. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN307"></a><span class='Declare_Function'>pg_foreach_ifaddr</span><span class='Parentheses'>(</span><a href="../../include/libpq/ifaddr.h.html#LN16"><span class='Ref_to_Typedef'>PgIfAddrCallback</span></a> <span class='Declare_Parameter'>callback</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>cb_data</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN309"></a>    <span class='Control'>struct</span> ifaddrs <span class='Operator'>*</span><span class='Declare_Local'>ifa</span><span class='Delimiter'>, 
</span><a name="LN310"></a>               <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>getifaddrs<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ifaddr.c.html#LN309"><span class='Ref_To_Local'>ifa</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="ifaddr.c.html#LN310"><span class='Ref_To_Local'>l</span></a> <span class='Operator'>= </span><a href="ifaddr.c.html#LN309"><span class='Ref_To_Local'>ifa</span></a><span class='Delimiter'>; </span><a href="ifaddr.c.html#LN310"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>; </span><a href="ifaddr.c.html#LN310"><span class='Ref_To_Local'>l</span></a> <span class='Operator'>= </span><a href="ifaddr.c.html#LN310"><span class='Ref_To_Local'>l</span></a><span class='Operator'>-&GT;</span>ifa_next<span class='Parentheses'>) 
</span>        <a href="ifaddr.c.html#LN190"><span class='Ref_to_Func'>run_ifaddr_callback</span></a><span class='Parentheses'>(</span><a href="ifaddr.c.html#LN307"><span class='Ref_to_Parameter'>callback</span></a><span class='Delimiter'>, </span><a href="ifaddr.c.html#LN307"><span class='Ref_to_Parameter'>cb_data</span></a><span class='Delimiter'>, 
</span>                            <a href="ifaddr.c.html#LN310"><span class='Ref_To_Local'>l</span></a><span class='Operator'>-&GT;</span>ifa_addr<span class='Delimiter'>, </span><a href="ifaddr.c.html#LN310"><span class='Ref_To_Local'>l</span></a><span class='Operator'>-&GT;</span>ifa_netmask<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    freeifaddrs<span class='Parentheses'>(</span><a href="ifaddr.c.html#LN309"><span class='Ref_To_Local'>ifa</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
} 
</span><span class='Directive'>#else</span>                           <span class='Comment_Single_Line'>/* !HAVE_GETIFADDRS && !WIN32 */ 
</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;sys/ioctl.h&GT;</span> 
 
<span class='Directive'>#ifdef</span> HAVE_NET_IF_H 
<span class='Keyword'>#include </span><span class='String'>&LT;net/if.h&GT;</span> 
<span class='Directive'>#endif</span> 
 
<span class='Directive'>#ifdef</span> HAVE_SYS_SOCKIO_H 
<span class='Keyword'>#include </span><span class='String'>&LT;sys/sockio.h&GT;</span> 
<span class='Directive'>#endif</span> 
 
<span class='Comment_Multi_Line'>/* 
 * SIOCGIFCONF does not return IPv6 addresses on Solaris 
 * and HP/UX. So we prefer SIOCGLIFCONF if it's available. 
 * 
 * On HP/UX, however, it *only* returns IPv6 addresses, 
 * and the structs are named slightly differently too. 
 * We'd have to do another call with SIOCGIFCONF to get the 
 * IPv4 addresses as well. We don't currently bother, just 
 * fall back to SIOCGIFCONF on HP/UX. 
 */ 
</span> 
<span class='Directive'>#if</span> defined<span class='Parentheses'>(</span>SIOCGLIFCONF<span class='Parentheses'>) </span><span class='Operator'>&& !</span>defined<span class='Parentheses'>(</span>__hpux<span class='Parentheses'>) 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Enumerate the system's network interface addresses and call the callback 
 * for each one.  Returns 0 if successful, -1 if trouble. 
 * 
 * This version uses ioctl(SIOCGLIFCONF). 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN354"></a><span class='Declare_Function'>pg_foreach_ifaddr</span><span class='Parentheses'>(</span><a href="../../include/libpq/ifaddr.h.html#LN16"><span class='Ref_to_Typedef'>PgIfAddrCallback</span></a> <span class='Declare_Parameter'>callback</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>cb_data</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN356"></a>    <span class='Control'>struct</span> lifconf <span class='Declare_Local'>lifc</span><span class='Delimiter'>; 
</span><a name="LN357"></a>    <span class='Control'>struct</span> lifreq <span class='Operator'>*</span><span class='Declare_Local'>lifr</span><span class='Delimiter'>, 
</span><a name="LN358"></a>                <span class='Declare_Local'>lmask</span><span class='Delimiter'>; 
</span><a name="LN359"></a>    <span class='Control'>struct</span> sockaddr <span class='Operator'>*</span><span class='Declare_Local'>addr</span><span class='Delimiter'>, 
</span><a name="LN360"></a>               <span class='Operator'>*</span><span class='Declare_Local'>mask</span><span class='Delimiter'>; 
</span><a name="LN361"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>ptr</span><span class='Delimiter'>, 
</span><a name="LN362"></a>               <span class='Operator'>*</span><span class='Declare_Local'>buffer</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN363"></a>    size_t      <span class='Declare_Local'>n_buffer</span> <span class='Operator'>= </span><span class='Number'>1024</span><span class='Delimiter'>; 
</span><a name="LN364"></a>    <a href="../../include/port.h.html#LN25"><span class='Ref_to_Typedef'>pgsocket</span></a>    <span class='Declare_Local'>sock</span><span class='Delimiter'>, 
</span><a name="LN365"></a>                <span class='Declare_Local'>fd</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> HAVE_IPV6 
<a name="LN368"></a>    <a href="../../include/port.h.html#LN25"><span class='Ref_to_Typedef'>pgsocket</span></a>    <span class='Declare_Local'>sock6</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<a name="LN370"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN371"></a>                <span class='Declare_Local'>total</span><span class='Delimiter'>; 
</span> 
    <a href="ifaddr.c.html#LN364"><span class='Ref_To_Local'>sock</span></a> <span class='Operator'>= </span><a href="../../include/port/win32.h.html#LN368"><span class='Ref_to_Macro'>socket</span></a><span class='Parentheses'>(</span>AF_INET<span class='Delimiter'>, </span>SOCK_DGRAM<span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ifaddr.c.html#LN364"><span class='Ref_To_Local'>sock</span></a> <span class='Operator'>== </span><a href="../../include/port.h.html#LN23"><span class='Ref_to_Const'>PGINVALID_SOCKET</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="ifaddr.c.html#LN363"><span class='Ref_To_Local'>n_buffer</span></a> <span class='Operator'>&LT; </span><span class='Number'>1024</span> <span class='Operator'>* </span><span class='Number'>100</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="ifaddr.c.html#LN363"><span class='Ref_To_Local'>n_buffer</span></a> <span class='Operator'>+= </span><span class='Number'>1024</span><span class='Delimiter'>; 
</span>        <a href="ifaddr.c.html#LN361"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>= </span><a href="../../include/snowball/header.h.html#LN59"><span class='Ref_to_Macro'>realloc</span></a><span class='Parentheses'>(</span><a href="ifaddr.c.html#LN362"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>, </span><a href="ifaddr.c.html#LN363"><span class='Ref_To_Local'>n_buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="ifaddr.c.html#LN361"><span class='Ref_To_Local'>ptr</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="ifaddr.c.html#LN362"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../interfaces/libpq/win32.h.html#LN11"><span class='Ref_to_Macro'>close</span></a><span class='Parentheses'>(</span><a href="ifaddr.c.html#LN364"><span class='Ref_To_Local'>sock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            errno <span class='Operator'>= </span>ENOMEM<span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ifaddr.c.html#LN356"><span class='Ref_To_Local'>lifc</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="ifaddr.c.html#LN356"><span class='Ref_To_Local'>lifc</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="ifaddr.c.html#LN356"><span class='Ref_To_Local'>lifc</span></a><span class='Operator'>.</span>lifc_family <span class='Operator'>= </span>AF_UNSPEC<span class='Delimiter'>; 
</span>        <a href="ifaddr.c.html#LN356"><span class='Ref_To_Local'>lifc</span></a><span class='Operator'>.</span>lifc_buf <span class='Operator'>= </span><a href="ifaddr.c.html#LN362"><span class='Ref_To_Local'>buffer</span></a> <span class='Operator'>= </span><a href="ifaddr.c.html#LN361"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>; 
</span>        <a href="ifaddr.c.html#LN356"><span class='Ref_To_Local'>lifc</span></a><span class='Operator'>.</span>lifc_len <span class='Operator'>= </span><a href="ifaddr.c.html#LN363"><span class='Ref_To_Local'>n_buffer</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>ioctl<span class='Parentheses'>(</span><a href="ifaddr.c.html#LN364"><span class='Ref_To_Local'>sock</span></a><span class='Delimiter'>, </span>SIOCGLIFCONF<span class='Delimiter'>, </span><span class='Operator'>&</span><a href="ifaddr.c.html#LN356"><span class='Ref_To_Local'>lifc</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>errno <span class='Operator'>== </span>EINVAL<span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="ifaddr.c.html#LN362"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../interfaces/libpq/win32.h.html#LN11"><span class='Ref_to_Macro'>close</span></a><span class='Parentheses'>(</span><a href="ifaddr.c.html#LN364"><span class='Ref_To_Local'>sock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Some Unixes try to return as much data as possible, with no 
         * indication of whether enough space allocated. Don't believe we have 
         * it all unless there's lots of slop. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ifaddr.c.html#LN356"><span class='Ref_To_Local'>lifc</span></a><span class='Operator'>.</span>lifc_len <span class='Operator'>&LT; </span><a href="ifaddr.c.html#LN363"><span class='Ref_To_Local'>n_buffer</span></a> <span class='Operator'>- </span><span class='Number'>1024</span><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while n_buffer&LT;1024*100 &raquo; </span> 
 
<span class='Directive'>#ifdef</span> HAVE_IPV6 
    <span class='Comment_Multi_Line'>/* We'll need an IPv6 socket too for the SIOCGLIFNETMASK ioctls */ 
</span>    <a href="ifaddr.c.html#LN368"><span class='Ref_To_Local'>sock6</span></a> <span class='Operator'>= </span><a href="../../include/port/win32.h.html#LN368"><span class='Ref_to_Macro'>socket</span></a><span class='Parentheses'>(</span>AF_INET6<span class='Delimiter'>, </span>SOCK_DGRAM<span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ifaddr.c.html#LN368"><span class='Ref_To_Local'>sock6</span></a> <span class='Operator'>== </span><a href="../../include/port.h.html#LN23"><span class='Ref_to_Const'>PGINVALID_SOCKET</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="ifaddr.c.html#LN362"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../interfaces/libpq/win32.h.html#LN11"><span class='Ref_to_Macro'>close</span></a><span class='Parentheses'>(</span><a href="ifaddr.c.html#LN364"><span class='Ref_To_Local'>sock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span><span class='Directive'>#endif</span> 
 
    <a href="ifaddr.c.html#LN371"><span class='Ref_To_Local'>total</span></a> <span class='Operator'>= </span><a href="ifaddr.c.html#LN356"><span class='Ref_To_Local'>lifc</span></a><span class='Operator'>.</span>lifc_len <span class='Operator'>/ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Control'>struct</span> lifreq<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="ifaddr.c.html#LN357"><span class='Ref_To_Local'>lifr</span></a> <span class='Operator'>= </span><a href="ifaddr.c.html#LN356"><span class='Ref_To_Local'>lifc</span></a><span class='Operator'>.</span>lifc_req<span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="ifaddr.c.html#LN370"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="ifaddr.c.html#LN370"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="ifaddr.c.html#LN371"><span class='Ref_To_Local'>total</span></a><span class='Delimiter'>; </span><span class='Operator'>++</span><a href="ifaddr.c.html#LN370"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="ifaddr.c.html#LN359"><span class='Ref_To_Local'>addr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Control'>struct</span> sockaddr <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>& </span><a href="ifaddr.c.html#LN357"><span class='Ref_To_Local'>lifr</span></a><span class='Delimiter'>[</span><a href="ifaddr.c.html#LN370"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span>lifr_addr<span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ifaddr.c.html#LN358"><span class='Ref_To_Local'>lmask</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="ifaddr.c.html#LN357"><span class='Ref_To_Local'>lifr</span></a><span class='Delimiter'>[</span><a href="ifaddr.c.html#LN370"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Control'>struct</span> lifreq<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><span class='Directive'>#ifdef</span> HAVE_IPV6 
        <a href="ifaddr.c.html#LN365"><span class='Ref_To_Local'>fd</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="ifaddr.c.html#LN359"><span class='Ref_To_Local'>addr</span></a><span class='Operator'>-&GT;</span>sa_family <span class='Operator'>== </span>AF_INET6<span class='Parentheses'>) </span><span class='Operator'>? </span><a href="ifaddr.c.html#LN368"><span class='Ref_To_Local'>sock6</span></a> <span class='Operator'>: </span><a href="ifaddr.c.html#LN364"><span class='Ref_To_Local'>sock</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
        <a href="ifaddr.c.html#LN365"><span class='Ref_To_Local'>fd</span></a> <span class='Operator'>= </span><a href="ifaddr.c.html#LN364"><span class='Ref_To_Local'>sock</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>ioctl<span class='Parentheses'>(</span><a href="ifaddr.c.html#LN365"><span class='Ref_To_Local'>fd</span></a><span class='Delimiter'>, </span>SIOCGLIFNETMASK<span class='Delimiter'>, </span><span class='Operator'>&</span><a href="ifaddr.c.html#LN358"><span class='Ref_To_Local'>lmask</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="ifaddr.c.html#LN360"><span class='Ref_To_Local'>mask</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="ifaddr.c.html#LN360"><span class='Ref_To_Local'>mask</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Control'>struct</span> sockaddr <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>& </span><a href="ifaddr.c.html#LN358"><span class='Ref_To_Local'>lmask</span></a><span class='Operator'>.</span>lifr_addr<span class='Delimiter'>; 
</span>        <a href="ifaddr.c.html#LN190"><span class='Ref_to_Func'>run_ifaddr_callback</span></a><span class='Parentheses'>(</span><a href="ifaddr.c.html#LN354"><span class='Ref_to_Parameter'>callback</span></a><span class='Delimiter'>, </span><a href="ifaddr.c.html#LN354"><span class='Ref_to_Parameter'>cb_data</span></a><span class='Delimiter'>, </span><a href="ifaddr.c.html#LN359"><span class='Ref_To_Local'>addr</span></a><span class='Delimiter'>, </span><a href="ifaddr.c.html#LN360"><span class='Ref_To_Local'>mask</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="ifaddr.c.html#LN362"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../interfaces/libpq/win32.h.html#LN11"><span class='Ref_to_Macro'>close</span></a><span class='Parentheses'>(</span><a href="ifaddr.c.html#LN364"><span class='Ref_To_Local'>sock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#ifdef</span> HAVE_IPV6 
    <a href="../../interfaces/libpq/win32.h.html#LN11"><span class='Ref_to_Macro'>close</span></a><span class='Parentheses'>(</span><a href="ifaddr.c.html#LN368"><span class='Ref_To_Local'>sock6</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_foreach_ifaddr &raquo; </span> 
<span class='Directive'>#elif</span> defined<span class='Parentheses'>(</span>SIOCGIFCONF<span class='Parentheses'>) 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Remaining Unixes use SIOCGIFCONF. Some only return IPv4 information 
 * here, so this is the least preferred method. Note that there is no 
 * standard way to iterate the struct ifreq returned in the array. 
 * On some OSs the structures are padded large enough for any address, 
 * on others you have to calculate the size of the struct ifreq. 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* Some OSs have _SIZEOF_ADDR_IFREQ, so just use that */ 
</span><span class='Directive'>#ifndef</span> <a href="ifaddr.c.html#LN463"><span class='Ref_to_Macro'>_SIZEOF_ADDR_IFREQ</span></a> 
 
<span class='Comment_Multi_Line'>/* Calculate based on sockaddr.sa_len */ 
</span><span class='Directive'>#ifdef</span> HAVE_STRUCT_SOCKADDR_SA_LEN 
<a name="LN463"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>_SIZEOF_ADDR_IFREQ</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>ifr</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>        <span class='Parentheses'>((</span><a href="ifaddr.c.html#LN463"><span class='Ref_to_Parameter'>ifr</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>ifr_addr<span class='Operator'>.</span>sa_len <span class='Operator'>&GT; </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Control'>struct</span> sockaddr<span class='Parentheses'>)</span> <span class='Operator'>? \ 
</span>         <span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Control'>struct</span> ifreq<span class='Parentheses'>) </span><span class='Operator'>- </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Control'>struct</span> sockaddr<span class='Parentheses'>) </span><span class='Operator'>+ \ 
</span>          <span class='Parentheses'>(</span><a href="ifaddr.c.html#LN463"><span class='Ref_to_Parameter'>ifr</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>ifr_addr<span class='Operator'>.</span>sa_len<span class='Parentheses'>)</span> <span class='Operator'>: </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Control'>struct</span> ifreq<span class='Parentheses'>))</span> 
 
<span class='Comment_Multi_Line'>/* Padded ifreq structure, simple */ 
</span><span class='Directive'>#else</span> 
<a name="LN470"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>_SIZEOF_ADDR_IFREQ</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>ifr</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Keyword'>sizeof </span><span class='Parentheses'>(</span><span class='Control'>struct</span> ifreq<span class='Parentheses'>) 
</span><span class='Directive'>#endif</span> 
<span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* !_SIZEOF_ADDR_IFREQ */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Enumerate the system's network interface addresses and call the callback 
 * for each one.  Returns 0 if successful, -1 if trouble. 
 * 
 * This version uses ioctl(SIOCGIFCONF). 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN482"></a><span class='Declare_Function'>pg_foreach_ifaddr</span><span class='Parentheses'>(</span><a href="../../include/libpq/ifaddr.h.html#LN16"><span class='Ref_to_Typedef'>PgIfAddrCallback</span></a> <span class='Declare_Parameter'>callback</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>cb_data</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN484"></a>    <span class='Control'>struct</span> ifconf <span class='Declare_Local'>ifc</span><span class='Delimiter'>; 
</span><a name="LN485"></a>    <span class='Control'>struct</span> ifreq <span class='Operator'>*</span><span class='Declare_Local'>ifr</span><span class='Delimiter'>, 
</span><a name="LN486"></a>               <span class='Operator'>*</span><span class='Declare_Local'>end</span><span class='Delimiter'>, 
</span><a name="LN487"></a>                <span class='Declare_Local'>addr</span><span class='Delimiter'>, 
</span><a name="LN488"></a>                <span class='Declare_Local'>mask</span><span class='Delimiter'>; 
</span><a name="LN489"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>ptr</span><span class='Delimiter'>, 
</span><a name="LN490"></a>               <span class='Operator'>*</span><span class='Declare_Local'>buffer</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN491"></a>    size_t      <span class='Declare_Local'>n_buffer</span> <span class='Operator'>= </span><span class='Number'>1024</span><span class='Delimiter'>; 
</span><a name="LN492"></a>    <a href="../../include/port.h.html#LN25"><span class='Ref_to_Typedef'>pgsocket</span></a>    <span class='Declare_Local'>sock</span><span class='Delimiter'>; 
</span> 
    <a href="ifaddr.c.html#LN492"><span class='Ref_To_Local'>sock</span></a> <span class='Operator'>= </span><a href="../../include/port/win32.h.html#LN368"><span class='Ref_to_Macro'>socket</span></a><span class='Parentheses'>(</span>AF_INET<span class='Delimiter'>, </span>SOCK_DGRAM<span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ifaddr.c.html#LN492"><span class='Ref_To_Local'>sock</span></a> <span class='Operator'>== </span><a href="../../include/port.h.html#LN23"><span class='Ref_to_Const'>PGINVALID_SOCKET</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="ifaddr.c.html#LN491"><span class='Ref_To_Local'>n_buffer</span></a> <span class='Operator'>&LT; </span><span class='Number'>1024</span> <span class='Operator'>* </span><span class='Number'>100</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="ifaddr.c.html#LN491"><span class='Ref_To_Local'>n_buffer</span></a> <span class='Operator'>+= </span><span class='Number'>1024</span><span class='Delimiter'>; 
</span>        <a href="ifaddr.c.html#LN489"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>= </span><a href="../../include/snowball/header.h.html#LN59"><span class='Ref_to_Macro'>realloc</span></a><span class='Parentheses'>(</span><a href="ifaddr.c.html#LN490"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>, </span><a href="ifaddr.c.html#LN491"><span class='Ref_To_Local'>n_buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="ifaddr.c.html#LN489"><span class='Ref_To_Local'>ptr</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="ifaddr.c.html#LN490"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../interfaces/libpq/win32.h.html#LN11"><span class='Ref_to_Macro'>close</span></a><span class='Parentheses'>(</span><a href="ifaddr.c.html#LN492"><span class='Ref_To_Local'>sock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            errno <span class='Operator'>= </span>ENOMEM<span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ifaddr.c.html#LN484"><span class='Ref_To_Local'>ifc</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="ifaddr.c.html#LN484"><span class='Ref_To_Local'>ifc</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="ifaddr.c.html#LN484"><span class='Ref_To_Local'>ifc</span></a><span class='Operator'>.</span>ifc_buf <span class='Operator'>= </span><a href="ifaddr.c.html#LN490"><span class='Ref_To_Local'>buffer</span></a> <span class='Operator'>= </span><a href="ifaddr.c.html#LN489"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>; 
</span>        <a href="ifaddr.c.html#LN484"><span class='Ref_To_Local'>ifc</span></a><span class='Operator'>.</span>ifc_len <span class='Operator'>= </span><a href="ifaddr.c.html#LN491"><span class='Ref_To_Local'>n_buffer</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>ioctl<span class='Parentheses'>(</span><a href="ifaddr.c.html#LN492"><span class='Ref_To_Local'>sock</span></a><span class='Delimiter'>, </span>SIOCGIFCONF<span class='Delimiter'>, </span><span class='Operator'>&</span><a href="ifaddr.c.html#LN484"><span class='Ref_To_Local'>ifc</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>errno <span class='Operator'>== </span>EINVAL<span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="ifaddr.c.html#LN490"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../interfaces/libpq/win32.h.html#LN11"><span class='Ref_to_Macro'>close</span></a><span class='Parentheses'>(</span><a href="ifaddr.c.html#LN492"><span class='Ref_To_Local'>sock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Some Unixes try to return as much data as possible, with no 
         * indication of whether enough space allocated. Don't believe we have 
         * it all unless there's lots of slop. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ifaddr.c.html#LN484"><span class='Ref_To_Local'>ifc</span></a><span class='Operator'>.</span>ifc_len <span class='Operator'>&LT; </span><a href="ifaddr.c.html#LN491"><span class='Ref_To_Local'>n_buffer</span></a> <span class='Operator'>- </span><span class='Number'>1024</span><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while n_buffer&LT;1024*100 &raquo; </span> 
 
    <a href="ifaddr.c.html#LN486"><span class='Ref_To_Local'>end</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Control'>struct</span> ifreq <span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="ifaddr.c.html#LN490"><span class='Ref_To_Local'>buffer</span></a> <span class='Operator'>+ </span><a href="ifaddr.c.html#LN484"><span class='Ref_To_Local'>ifc</span></a><span class='Operator'>.</span>ifc_len<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="ifaddr.c.html#LN485"><span class='Ref_To_Local'>ifr</span></a> <span class='Operator'>= </span><a href="ifaddr.c.html#LN484"><span class='Ref_To_Local'>ifc</span></a><span class='Operator'>.</span>ifc_req<span class='Delimiter'>; </span><a href="ifaddr.c.html#LN485"><span class='Ref_To_Local'>ifr</span></a> <span class='Operator'>&LT; </span><a href="ifaddr.c.html#LN486"><span class='Ref_To_Local'>end</span></a><span class='Delimiter'>;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        memcpy<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ifaddr.c.html#LN487"><span class='Ref_To_Local'>addr</span></a><span class='Delimiter'>, </span><a href="ifaddr.c.html#LN485"><span class='Ref_To_Local'>ifr</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="ifaddr.c.html#LN487"><span class='Ref_To_Local'>addr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ifaddr.c.html#LN488"><span class='Ref_To_Local'>mask</span></a><span class='Delimiter'>, </span><a href="ifaddr.c.html#LN485"><span class='Ref_To_Local'>ifr</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="ifaddr.c.html#LN488"><span class='Ref_To_Local'>mask</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>ioctl<span class='Parentheses'>(</span><a href="ifaddr.c.html#LN492"><span class='Ref_To_Local'>sock</span></a><span class='Delimiter'>, </span>SIOCGIFADDR<span class='Delimiter'>, </span><span class='Operator'>&</span><a href="ifaddr.c.html#LN487"><span class='Ref_To_Local'>addr</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="ifaddr.c.html#LN487"><span class='Ref_To_Local'>addr</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>            ioctl<span class='Parentheses'>(</span><a href="ifaddr.c.html#LN492"><span class='Ref_To_Local'>sock</span></a><span class='Delimiter'>, </span>SIOCGIFNETMASK<span class='Delimiter'>, </span><span class='Operator'>&</span><a href="ifaddr.c.html#LN488"><span class='Ref_To_Local'>mask</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="ifaddr.c.html#LN488"><span class='Ref_To_Local'>mask</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="ifaddr.c.html#LN190"><span class='Ref_to_Func'>run_ifaddr_callback</span></a><span class='Parentheses'>(</span><a href="ifaddr.c.html#LN482"><span class='Ref_to_Parameter'>callback</span></a><span class='Delimiter'>, </span><a href="ifaddr.c.html#LN482"><span class='Ref_to_Parameter'>cb_data</span></a><span class='Delimiter'>, 
</span>                                <span class='Operator'>&</span><a href="ifaddr.c.html#LN487"><span class='Ref_To_Local'>addr</span></a><span class='Operator'>.</span>ifr_addr<span class='Delimiter'>, </span><span class='Operator'>&</span><a href="ifaddr.c.html#LN488"><span class='Ref_To_Local'>mask</span></a><span class='Operator'>.</span>ifr_addr<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="ifaddr.c.html#LN485"><span class='Ref_To_Local'>ifr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Control'>struct</span> ifreq <span class='Operator'>*</span><span class='Parentheses'>) ((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="ifaddr.c.html#LN485"><span class='Ref_To_Local'>ifr</span></a> <span class='Operator'>+ </span><a href="ifaddr.c.html#LN463"><span class='Ref_to_Macro'>_SIZEOF_ADDR_IFREQ</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="ifaddr.c.html#LN485"><span class='Ref_To_Local'>ifr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="ifaddr.c.html#LN490"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../interfaces/libpq/win32.h.html#LN11"><span class='Ref_to_Macro'>close</span></a><span class='Parentheses'>(</span><a href="ifaddr.c.html#LN492"><span class='Ref_To_Local'>sock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_foreach_ifaddr &raquo; </span> 
<span class='Directive'>#else</span>                           <span class='Comment_Single_Line'>/* !defined(SIOCGIFCONF) */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Enumerate the system's network interface addresses and call the callback 
 * for each one.  Returns 0 if successful, -1 if trouble. 
 * 
 * This version is our fallback if there's no known way to get the 
 * interface addresses.  Just return the standard loopback addresses. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN558"></a><span class='Declare_Function'>pg_foreach_ifaddr</span><span class='Parentheses'>(</span><a href="../../include/libpq/ifaddr.h.html#LN16"><span class='Ref_to_Typedef'>PgIfAddrCallback</span></a> <span class='Declare_Parameter'>callback</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>cb_data</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN560"></a>    <span class='Control'>struct</span> sockaddr_in <span class='Declare_Local'>addr</span><span class='Delimiter'>; 
</span><a name="LN561"></a>    <span class='Control'>struct</span> <a href="../../include/libpq/pqcomm.h.html#LN43"><span class='Ref_to_Struct'>sockaddr_storage</span></a> <span class='Declare_Local'>mask</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> HAVE_IPV6 
<a name="LN564"></a>    <span class='Control'>struct</span> sockaddr_in6 <span class='Declare_Local'>addr6</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <span class='Comment_Multi_Line'>/* addr 127.0.0.1/8 */ 
</span>    memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ifaddr.c.html#LN560"><span class='Ref_To_Local'>addr</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="ifaddr.c.html#LN560"><span class='Ref_To_Local'>addr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="ifaddr.c.html#LN560"><span class='Ref_To_Local'>addr</span></a><span class='Operator'>.</span>sin_family <span class='Operator'>= </span>AF_INET<span class='Delimiter'>; 
</span>    <a href="ifaddr.c.html#LN560"><span class='Ref_To_Local'>addr</span></a><span class='Operator'>.</span>sin_addr<span class='Operator'>.</span>s_addr <span class='Operator'>= </span>ntohl<span class='Parentheses'>(</span><span class='Number'>0x7f000001</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ifaddr.c.html#LN561"><span class='Ref_To_Local'>mask</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="ifaddr.c.html#LN561"><span class='Ref_To_Local'>mask</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/libpq/ifaddr.h.html#LN24"><span class='Ref_to_Proto'>pg_sockaddr_cidr_mask</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ifaddr.c.html#LN561"><span class='Ref_To_Local'>mask</span></a><span class='Delimiter'>, </span><span class='String'>"8"</span><span class='Delimiter'>, </span>AF_INET<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="ifaddr.c.html#LN190"><span class='Ref_to_Func'>run_ifaddr_callback</span></a><span class='Parentheses'>(</span><a href="ifaddr.c.html#LN558"><span class='Ref_to_Parameter'>callback</span></a><span class='Delimiter'>, </span><a href="ifaddr.c.html#LN558"><span class='Ref_to_Parameter'>cb_data</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><span class='Control'>struct</span> sockaddr <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>& </span><a href="ifaddr.c.html#LN560"><span class='Ref_To_Local'>addr</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><span class='Control'>struct</span> sockaddr <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>& </span><a href="ifaddr.c.html#LN561"><span class='Ref_To_Local'>mask</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> HAVE_IPV6 
    <span class='Comment_Multi_Line'>/* addr ::1/128 */ 
</span>    memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ifaddr.c.html#LN564"><span class='Ref_To_Local'>addr6</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="ifaddr.c.html#LN564"><span class='Ref_To_Local'>addr6</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="ifaddr.c.html#LN564"><span class='Ref_To_Local'>addr6</span></a><span class='Operator'>.</span>sin6_family <span class='Operator'>= </span>AF_INET6<span class='Delimiter'>; 
</span>    <a href="ifaddr.c.html#LN564"><span class='Ref_To_Local'>addr6</span></a><span class='Operator'>.</span>sin6_addr<span class='Operator'>.</span>s6_addr<span class='Delimiter'>[</span><span class='Number'>15</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ifaddr.c.html#LN561"><span class='Ref_To_Local'>mask</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="ifaddr.c.html#LN561"><span class='Ref_To_Local'>mask</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/libpq/ifaddr.h.html#LN24"><span class='Ref_to_Proto'>pg_sockaddr_cidr_mask</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ifaddr.c.html#LN561"><span class='Ref_To_Local'>mask</span></a><span class='Delimiter'>, </span><span class='String'>"128"</span><span class='Delimiter'>, </span>AF_INET6<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="ifaddr.c.html#LN190"><span class='Ref_to_Func'>run_ifaddr_callback</span></a><span class='Parentheses'>(</span><a href="ifaddr.c.html#LN558"><span class='Ref_to_Parameter'>callback</span></a><span class='Delimiter'>, </span><a href="ifaddr.c.html#LN558"><span class='Ref_to_Parameter'>cb_data</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><span class='Control'>struct</span> sockaddr <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>& </span><a href="ifaddr.c.html#LN564"><span class='Ref_To_Local'>addr6</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><span class='Control'>struct</span> sockaddr <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>& </span><a href="ifaddr.c.html#LN561"><span class='Ref_To_Local'>mask</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_foreach_ifaddr &raquo; </span> 
<span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* !defined(SIOCGIFCONF) */ 
</span> 
<span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* !HAVE_GETIFADDRS */ 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>