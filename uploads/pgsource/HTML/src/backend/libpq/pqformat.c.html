<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\libpq\pqformat.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\libpq\pqformat.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:40 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * pqformat.c 
 *      Routines for formatting and parsing frontend/backend messages 
 * 
 * Outgoing messages are built up in a StringInfo buffer (which is expansible) 
 * and then sent in a single call to pq_putmessage.  This module provides data 
 * formatting/conversion routines that are needed to produce valid messages. 
 * Note in particular the distinction between "raw data" and "text"; raw data 
 * is message protocol characters and binary values that are not subject to 
 * character set conversion, while text is converted by character encoding 
 * rules. 
 * 
 * Incoming messages are similarly read into a StringInfo buffer, via 
 * pq_getmessage, and then parsed and converted from that using the routines 
 * in this module. 
 * 
 * These same routines support reading and writing of external binary formats 
 * (typsend/typreceive routines).  The conversion routines for individual 
 * data types are exactly the same, only initialization and completion 
 * are different. 
 * 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 *  src/backend/libpq/pqformat.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
/* 
 * INTERFACE ROUTINES 
 * Message assembly and output: 
 *      pq_beginmessage - initialize StringInfo buffer 
 *      pq_sendbyte     - append a raw byte to a StringInfo buffer 
 *      pq_sendint      - append a binary integer to a StringInfo buffer 
 *      pq_sendint64    - append a binary 8-byte int to a StringInfo buffer 
 *      pq_sendfloat4   - append a float4 to a StringInfo buffer 
 *      pq_sendfloat8   - append a float8 to a StringInfo buffer 
 *      pq_sendbytes    - append raw data to a StringInfo buffer 
 *      pq_sendcountedtext - append a counted text string (with character set conversion) 
 *      pq_sendtext     - append a text string (with conversion) 
 *      pq_sendstring   - append a null-terminated text string (with conversion) 
 *      pq_send_ascii_string - append a null-terminated text string (without conversion) 
 *      pq_endmessage   - send the completed message to the frontend 
 * Note: it is also possible to append data to the StringInfo buffer using 
 * the regular StringInfo routines, but this is discouraged since required 
 * character set conversion may not occur. 
 * 
 * typsend support (construct a bytea value containing external binary data): 
 *      pq_begintypsend - initialize StringInfo buffer 
 *      pq_endtypsend   - return the completed string as a "bytea*" 
 * 
 * Special-case message output: 
 *      pq_puttextmessage - generate a character set-converted message in one step 
 *      pq_putemptymessage - convenience routine for message with empty body 
 * 
 * Message parsing after input: 
 *      pq_getmsgbyte   - get a raw byte from a message buffer 
 *      pq_getmsgint    - get a binary integer from a message buffer 
 *      pq_getmsgint64  - get a binary 8-byte int from a message buffer 
 *      pq_getmsgfloat4 - get a float4 from a message buffer 
 *      pq_getmsgfloat8 - get a float8 from a message buffer 
 *      pq_getmsgbytes  - get raw data from a message buffer 
 *      pq_copymsgbytes - copy raw data from a message buffer 
 *      pq_getmsgtext   - get a counted text string (with conversion) 
 *      pq_getmsgstring - get a null-terminated text string (with conversion) 
 *      pq_getmsgrawstring - get a null-terminated text string - NO conversion 
 *      pq_getmsgend    - verify message fully consumed 
 */ 
</span> 
<span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;sys/param.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;netinet/in.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;arpa/inet.h&GT;</span> 
 
<span class='Keyword'>#include </span><span class='String'>"libpq/libpq.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"libpq/pqformat.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"mb/pg_wchar.h"</span> 
 
 
<span class='Comment_Multi_Line'>/* -------------------------------- 
 *      pq_beginmessage     - initialize for sending a message 
 * -------------------------------- 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN87"></a><span class='Declare_Function'>pq_beginmessage</span><span class='Parentheses'>(</span><a href="../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>msgtype</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><a href="pqformat.c.html#LN87"><span class='Ref_to_Parameter'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We stash the message type into the buffer's cursor field, expecting 
     * that the pq_sendXXX routines won't touch it.  We could alternatively 
     * make it the first byte of the buffer contents, but this seems easier. 
     */ 
</span>    <a href="pqformat.c.html#LN87"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN39"><span class='Ref_to_Member'>cursor</span></a> <span class='Operator'>= </span><a href="pqformat.c.html#LN87"><span class='Ref_to_Parameter'>msgtype</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* -------------------------------- 
 *      pq_sendbyte     - append a raw byte to a StringInfo buffer 
 * -------------------------------- 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN104"></a><span class='Declare_Function'>pq_sendbyte</span><span class='Parentheses'>(</span><a href="../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>byt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../include/lib/stringinfo.h.html#LN126"><span class='Ref_to_Macro'>appendStringInfoCharMacro</span></a><span class='Parentheses'>(</span><a href="pqformat.c.html#LN104"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="pqformat.c.html#LN104"><span class='Ref_to_Parameter'>byt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* -------------------------------- 
 *      pq_sendbytes    - append raw data to a StringInfo buffer 
 * -------------------------------- 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN114"></a><span class='Declare_Function'>pq_sendbytes</span><span class='Parentheses'>(</span><a href="../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>data</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>datalen</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../include/lib/stringinfo.h.html#LN142"><span class='Ref_to_Proto'>appendBinaryStringInfo</span></a><span class='Parentheses'>(</span><a href="pqformat.c.html#LN114"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="pqformat.c.html#LN114"><span class='Ref_to_Parameter'>data</span></a><span class='Delimiter'>, </span><a href="pqformat.c.html#LN114"><span class='Ref_to_Parameter'>datalen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* -------------------------------- 
 *      pq_sendcountedtext - append a counted text string (with character set conversion) 
 * 
 * The data sent to the frontend by this routine is a 4-byte count field 
 * followed by the string.  The count includes itself or not, as per the 
 * countincludesself flag (pre-3.0 protocol requires it to include itself). 
 * The passed text string need not be null-terminated, and the data sent 
 * to the frontend isn't either. 
 * -------------------------------- 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN130"></a><span class='Declare_Function'>pq_sendcountedtext</span><span class='Parentheses'>(</span><a href="../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>slen</span><span class='Delimiter'>, 
</span><a name="LN131"></a>                   <span class='Keyword'>bool </span><span class='Declare_Parameter'>countincludesself</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN133"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>extra</span> <span class='Operator'>= </span><a href="pqformat.c.html#LN131"><span class='Ref_to_Parameter'>countincludesself</span></a> <span class='Operator'>? </span><span class='Number'>4</span> <span class='Operator'>: </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN134"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span> 
    <a href="pqformat.c.html#LN134"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="../../include/mb/pg_wchar.h.html#LN565"><span class='Ref_to_Proto'>pg_server_to_client</span></a><span class='Parentheses'>(</span><a href="pqformat.c.html#LN130"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="pqformat.c.html#LN130"><span class='Ref_to_Parameter'>slen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pqformat.c.html#LN134"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>!= </span><a href="pqformat.c.html#LN130"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span>               <span class='Comment_Single_Line'>/* actual conversion has been done? */ 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pqformat.c.html#LN130"><span class='Ref_to_Parameter'>slen</span></a> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="pqformat.c.html#LN134"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/libpq/pqformat.h.html#LN25"><span class='Ref_to_Proto'>pq_sendint</span></a><span class='Parentheses'>(</span><a href="pqformat.c.html#LN130"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="pqformat.c.html#LN130"><span class='Ref_to_Parameter'>slen</span></a> <span class='Operator'>+ </span><a href="pqformat.c.html#LN133"><span class='Ref_To_Local'>extra</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/lib/stringinfo.h.html#LN142"><span class='Ref_to_Proto'>appendBinaryStringInfo</span></a><span class='Parentheses'>(</span><a href="pqformat.c.html#LN130"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="pqformat.c.html#LN134"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="pqformat.c.html#LN130"><span class='Ref_to_Parameter'>slen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="pqformat.c.html#LN134"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../include/libpq/pqformat.h.html#LN25"><span class='Ref_to_Proto'>pq_sendint</span></a><span class='Parentheses'>(</span><a href="pqformat.c.html#LN130"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="pqformat.c.html#LN130"><span class='Ref_to_Parameter'>slen</span></a> <span class='Operator'>+ </span><a href="pqformat.c.html#LN133"><span class='Ref_To_Local'>extra</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/lib/stringinfo.h.html#LN142"><span class='Ref_to_Proto'>appendBinaryStringInfo</span></a><span class='Parentheses'>(</span><a href="pqformat.c.html#LN130"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="pqformat.c.html#LN130"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="pqformat.c.html#LN130"><span class='Ref_to_Parameter'>slen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end pq_sendcountedtext &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* -------------------------------- 
 *      pq_sendtext     - append a text string (with conversion) 
 * 
 * The passed text string need not be null-terminated, and the data sent 
 * to the frontend isn't either.  Note that this is not actually useful 
 * for direct frontend transmissions, since there'd be no way for the 
 * frontend to determine the string length.  But it is useful for binary 
 * format conversions. 
 * -------------------------------- 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN162"></a><span class='Declare_Function'>pq_sendtext</span><span class='Parentheses'>(</span><a href="../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>slen</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN164"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span> 
    <a href="pqformat.c.html#LN164"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="../../include/mb/pg_wchar.h.html#LN565"><span class='Ref_to_Proto'>pg_server_to_client</span></a><span class='Parentheses'>(</span><a href="pqformat.c.html#LN162"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="pqformat.c.html#LN162"><span class='Ref_to_Parameter'>slen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pqformat.c.html#LN164"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>!= </span><a href="pqformat.c.html#LN162"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span>               <span class='Comment_Single_Line'>/* actual conversion has been done? */ 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pqformat.c.html#LN162"><span class='Ref_to_Parameter'>slen</span></a> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="pqformat.c.html#LN164"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/lib/stringinfo.h.html#LN142"><span class='Ref_to_Proto'>appendBinaryStringInfo</span></a><span class='Parentheses'>(</span><a href="pqformat.c.html#LN162"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="pqformat.c.html#LN164"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="pqformat.c.html#LN162"><span class='Ref_to_Parameter'>slen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="pqformat.c.html#LN164"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="../../include/lib/stringinfo.h.html#LN142"><span class='Ref_to_Proto'>appendBinaryStringInfo</span></a><span class='Parentheses'>(</span><a href="pqformat.c.html#LN162"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="pqformat.c.html#LN162"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="pqformat.c.html#LN162"><span class='Ref_to_Parameter'>slen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* -------------------------------- 
 *      pq_sendstring   - append a null-terminated text string (with conversion) 
 * 
 * NB: passed text string must be null-terminated, and so is the data 
 * sent to the frontend. 
 * -------------------------------- 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN185"></a><span class='Declare_Function'>pq_sendstring</span><span class='Parentheses'>(</span><a href="../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN187"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>slen</span> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="pqformat.c.html#LN185"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN188"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span> 
    <a href="pqformat.c.html#LN188"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="../../include/mb/pg_wchar.h.html#LN565"><span class='Ref_to_Proto'>pg_server_to_client</span></a><span class='Parentheses'>(</span><a href="pqformat.c.html#LN185"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="pqformat.c.html#LN187"><span class='Ref_To_Local'>slen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pqformat.c.html#LN188"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>!= </span><a href="pqformat.c.html#LN185"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span>               <span class='Comment_Single_Line'>/* actual conversion has been done? */ 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pqformat.c.html#LN187"><span class='Ref_To_Local'>slen</span></a> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="pqformat.c.html#LN188"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/lib/stringinfo.h.html#LN142"><span class='Ref_to_Proto'>appendBinaryStringInfo</span></a><span class='Parentheses'>(</span><a href="pqformat.c.html#LN185"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="pqformat.c.html#LN188"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="pqformat.c.html#LN187"><span class='Ref_To_Local'>slen</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="pqformat.c.html#LN188"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="../../include/lib/stringinfo.h.html#LN142"><span class='Ref_to_Proto'>appendBinaryStringInfo</span></a><span class='Parentheses'>(</span><a href="pqformat.c.html#LN185"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="pqformat.c.html#LN185"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="pqformat.c.html#LN187"><span class='Ref_To_Local'>slen</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* -------------------------------- 
 *      pq_send_ascii_string    - append a null-terminated text string (without conversion) 
 * 
 * This function intentionally bypasses encoding conversion, instead just 
 * silently replacing any non-7-bit-ASCII characters with question marks. 
 * It is used only when we are having trouble sending an error message to 
 * the client with normal localization and encoding conversion.  The caller 
 * should already have taken measures to ensure the string is just ASCII; 
 * the extra work here is just to make certain we don't send a badly encoded 
 * string to the client (which might or might not be robust about that). 
 * 
 * NB: passed text string must be null-terminated, and so is the data 
 * sent to the frontend. 
 * -------------------------------- 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN217"></a><span class='Declare_Function'>pq_send_ascii_string</span><span class='Parentheses'>(</span><a href="../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pqformat.c.html#LN217"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN221"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>ch</span> <span class='Operator'>= *</span><a href="pqformat.c.html#LN217"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN972"><span class='Ref_to_Macro'>IS_HIGHBIT_SET</span></a><span class='Parentheses'>(</span><a href="pqformat.c.html#LN221"><span class='Ref_To_Local'>ch</span></a><span class='Parentheses'>))</span> 
            <a href="pqformat.c.html#LN221"><span class='Ref_To_Local'>ch</span></a> <span class='Operator'>= </span><span class='String'>'?'</span><span class='Delimiter'>; 
</span>        <a href="../../include/lib/stringinfo.h.html#LN126"><span class='Ref_to_Macro'>appendStringInfoCharMacro</span></a><span class='Parentheses'>(</span><a href="pqformat.c.html#LN217"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="pqformat.c.html#LN221"><span class='Ref_To_Local'>ch</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><a href="pqformat.c.html#LN217"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>'\0'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* -------------------------------- 
 *      pq_sendint      - append a binary integer to a StringInfo buffer 
 * -------------------------------- 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN235"></a><span class='Declare_Function'>pq_sendint</span><span class='Parentheses'>(</span><a href="../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>i</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>b</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN237"></a>    <span class='Keyword'>unsigned char </span><span class='Declare_Local'>n8</span><span class='Delimiter'>; 
</span><a name="LN238"></a>    <a href="../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a>      <span class='Declare_Local'>n16</span><span class='Delimiter'>; 
</span><a name="LN239"></a>    <a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>n32</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pqformat.c.html#LN235"><span class='Ref_to_Parameter'>b</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <span class='Number'>1</span><span class='Operator'>: 
</span>            <a href="pqformat.c.html#LN237"><span class='Ref_To_Local'>n8</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><a href="pqformat.c.html#LN235"><span class='Ref_to_Parameter'>i</span></a><span class='Delimiter'>; 
</span>            <a href="../../include/lib/stringinfo.h.html#LN142"><span class='Ref_to_Proto'>appendBinaryStringInfo</span></a><span class='Parentheses'>(</span><a href="pqformat.c.html#LN235"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="pqformat.c.html#LN237"><span class='Ref_To_Local'>n8</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <span class='Number'>2</span><span class='Operator'>: 
</span>            <a href="pqformat.c.html#LN238"><span class='Ref_To_Local'>n16</span></a> <span class='Operator'>= </span>htons<span class='Parentheses'>((</span><a href="../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a><span class='Parentheses'>) </span><a href="pqformat.c.html#LN235"><span class='Ref_to_Parameter'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/lib/stringinfo.h.html#LN142"><span class='Ref_to_Proto'>appendBinaryStringInfo</span></a><span class='Parentheses'>(</span><a href="pqformat.c.html#LN235"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="pqformat.c.html#LN238"><span class='Ref_To_Local'>n16</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <span class='Number'>4</span><span class='Operator'>: 
</span>            <a href="pqformat.c.html#LN239"><span class='Ref_To_Local'>n32</span></a> <span class='Operator'>= </span>htonl<span class='Parentheses'>((</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) </span><a href="pqformat.c.html#LN235"><span class='Ref_to_Parameter'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/lib/stringinfo.h.html#LN142"><span class='Ref_to_Proto'>appendBinaryStringInfo</span></a><span class='Parentheses'>(</span><a href="pqformat.c.html#LN235"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="pqformat.c.html#LN239"><span class='Ref_To_Local'>n32</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unsupported integer size %d"</span><span class='Delimiter'>, </span><a href="pqformat.c.html#LN235"><span class='Ref_to_Parameter'>b</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end pq_sendint &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* -------------------------------- 
 *      pq_sendint64    - append a binary 8-byte int to a StringInfo buffer 
 * 
 * It is tempting to merge this with pq_sendint, but we'd have to make the 
 * argument int64 for all data widths --- that could be a big performance 
 * hit on machines where int64 isn't efficient. 
 * -------------------------------- 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN270"></a><span class='Declare_Function'>pq_sendint64</span><span class='Parentheses'>(</span><a href="../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> <span class='Declare_Parameter'>i</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN272"></a>    <a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>n32</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* High order half first, since we're doing MSB-first */ 
</span>    <a href="pqformat.c.html#LN272"><span class='Ref_To_Local'>n32</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) (</span><a href="pqformat.c.html#LN270"><span class='Ref_to_Parameter'>i</span></a> <span class='Operator'>&GT;&GT; </span><span class='Number'>32</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pqformat.c.html#LN272"><span class='Ref_To_Local'>n32</span></a> <span class='Operator'>= </span>htonl<span class='Parentheses'>(</span><a href="pqformat.c.html#LN272"><span class='Ref_To_Local'>n32</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/lib/stringinfo.h.html#LN142"><span class='Ref_to_Proto'>appendBinaryStringInfo</span></a><span class='Parentheses'>(</span><a href="pqformat.c.html#LN270"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="pqformat.c.html#LN272"><span class='Ref_To_Local'>n32</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Now the low order half */ 
</span>    <a href="pqformat.c.html#LN272"><span class='Ref_To_Local'>n32</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) </span><a href="pqformat.c.html#LN270"><span class='Ref_to_Parameter'>i</span></a><span class='Delimiter'>; 
</span>    <a href="pqformat.c.html#LN272"><span class='Ref_To_Local'>n32</span></a> <span class='Operator'>= </span>htonl<span class='Parentheses'>(</span><a href="pqformat.c.html#LN272"><span class='Ref_To_Local'>n32</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/lib/stringinfo.h.html#LN142"><span class='Ref_to_Proto'>appendBinaryStringInfo</span></a><span class='Parentheses'>(</span><a href="pqformat.c.html#LN270"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="pqformat.c.html#LN272"><span class='Ref_To_Local'>n32</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* -------------------------------- 
 *      pq_sendfloat4   - append a float4 to a StringInfo buffer 
 * 
 * The point of this routine is to localize knowledge of the external binary 
 * representation of float4, which is a component of several datatypes. 
 * 
 * We currently assume that float4 should be byte-swapped in the same way 
 * as int4.  This rule is not perfect but it gives us portability across 
 * most IEEE-float-using architectures. 
 * -------------------------------- 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN297"></a><span class='Declare_Function'>pq_sendfloat4</span><span class='Parentheses'>(</span><a href="../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN379"><span class='Ref_to_Typedef'>float4</span></a> <span class='Declare_Parameter'>f</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>union</span> 
    <span class='Delimiter'>{ 
</span><a name="LN301"></a>        <a href="../../include/c.h.html#LN379"><span class='Ref_to_Typedef'>float4</span></a>      <span class='Declare_Member'>f</span><span class='Delimiter'>; 
</span><a name="LN302"></a>        <a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Member'>i</span><span class='Delimiter'>; 
</span><a name="LN303"></a>    <span class='Delimiter'>}</span>           <span class='Declare_Local'>swap</span><span class='Delimiter'>; 
</span> 
    <a href="pqformat.c.html#LN303"><span class='Ref_To_Local'>swap</span></a><span class='Operator'>.</span><a href="pqformat.c.html#LN301"><span class='Ref_to_Member'>f</span></a> <span class='Operator'>= </span><a href="pqformat.c.html#LN297"><span class='Ref_to_Parameter'>f</span></a><span class='Delimiter'>; 
</span>    <a href="pqformat.c.html#LN303"><span class='Ref_To_Local'>swap</span></a><span class='Operator'>.</span><a href="pqformat.c.html#LN302"><span class='Ref_to_Member'>i</span></a> <span class='Operator'>= </span>htonl<span class='Parentheses'>(</span><a href="pqformat.c.html#LN303"><span class='Ref_To_Local'>swap</span></a><span class='Operator'>.</span><a href="pqformat.c.html#LN302"><span class='Ref_to_Member'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/lib/stringinfo.h.html#LN142"><span class='Ref_to_Proto'>appendBinaryStringInfo</span></a><span class='Parentheses'>(</span><a href="pqformat.c.html#LN297"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="pqformat.c.html#LN303"><span class='Ref_To_Local'>swap</span></a><span class='Operator'>.</span><a href="pqformat.c.html#LN302"><span class='Ref_to_Member'>i</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* -------------------------------- 
 *      pq_sendfloat8   - append a float8 to a StringInfo buffer 
 * 
 * The point of this routine is to localize knowledge of the external binary 
 * representation of float8, which is a component of several datatypes. 
 * 
 * We currently assume that float8 should be byte-swapped in the same way 
 * as int8.  This rule is not perfect but it gives us portability across 
 * most IEEE-float-using architectures. 
 * -------------------------------- 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN323"></a><span class='Declare_Function'>pq_sendfloat8</span><span class='Parentheses'>(</span><a href="../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN380"><span class='Ref_to_Typedef'>float8</span></a> <span class='Declare_Parameter'>f</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>union</span> 
    <span class='Delimiter'>{ 
</span><a name="LN327"></a>        <a href="../../include/c.h.html#LN380"><span class='Ref_to_Typedef'>float8</span></a>      <span class='Declare_Member'>f</span><span class='Delimiter'>; 
</span><a name="LN328"></a>        <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Member'>i</span><span class='Delimiter'>; 
</span><a name="LN329"></a>    <span class='Delimiter'>}</span>           <span class='Declare_Local'>swap</span><span class='Delimiter'>; 
</span> 
    <a href="pqformat.c.html#LN329"><span class='Ref_To_Local'>swap</span></a><span class='Operator'>.</span><a href="pqformat.c.html#LN327"><span class='Ref_to_Member'>f</span></a> <span class='Operator'>= </span><a href="pqformat.c.html#LN323"><span class='Ref_to_Parameter'>f</span></a><span class='Delimiter'>; 
</span>    <a href="../../include/libpq/pqformat.h.html#LN26"><span class='Ref_to_Proto'>pq_sendint64</span></a><span class='Parentheses'>(</span><a href="pqformat.c.html#LN323"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="pqformat.c.html#LN329"><span class='Ref_To_Local'>swap</span></a><span class='Operator'>.</span><a href="pqformat.c.html#LN328"><span class='Ref_to_Member'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* -------------------------------- 
 *      pq_endmessage   - send the completed message to the frontend 
 * 
 * The data buffer is pfree()d, but if the StringInfo was allocated with 
 * makeStringInfo then the caller must still pfree it. 
 * -------------------------------- 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN343"></a><span class='Declare_Function'>pq_endmessage</span><span class='Parentheses'>(</span><a href="../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>buf</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* msgtype was saved in cursor field */ 
</span>    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../include/libpq/libpq.h.html#LN41"><span class='Ref_to_Macro'>pq_putmessage</span></a><span class='Parentheses'>(</span><a href="pqformat.c.html#LN343"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN39"><span class='Ref_to_Member'>cursor</span></a><span class='Delimiter'>, </span><a href="pqformat.c.html#LN343"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="pqformat.c.html#LN343"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* no need to complain about any failure, since pqcomm.c already did */ 
</span>    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="pqformat.c.html#LN343"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pqformat.c.html#LN343"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* -------------------------------- 
 *      pq_begintypsend     - initialize for constructing a bytea result 
 * -------------------------------- 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN358"></a><span class='Declare_Function'>pq_begintypsend</span><span class='Parentheses'>(</span><a href="../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>buf</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><a href="pqformat.c.html#LN358"><span class='Ref_to_Parameter'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Reserve four bytes for the bytea length word */ 
</span>    <a href="../../include/lib/stringinfo.h.html#LN126"><span class='Ref_to_Macro'>appendStringInfoCharMacro</span></a><span class='Parentheses'>(</span><a href="pqformat.c.html#LN358"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>'\0'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/lib/stringinfo.h.html#LN126"><span class='Ref_to_Macro'>appendStringInfoCharMacro</span></a><span class='Parentheses'>(</span><a href="pqformat.c.html#LN358"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>'\0'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/lib/stringinfo.h.html#LN126"><span class='Ref_to_Macro'>appendStringInfoCharMacro</span></a><span class='Parentheses'>(</span><a href="pqformat.c.html#LN358"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>'\0'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/lib/stringinfo.h.html#LN126"><span class='Ref_to_Macro'>appendStringInfoCharMacro</span></a><span class='Parentheses'>(</span><a href="pqformat.c.html#LN358"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>'\0'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* -------------------------------- 
 *      pq_endtypsend   - finish constructing a bytea result 
 * 
 * The data buffer is returned as the palloc'd bytea value.  (We expect 
 * that it will be suitably aligned for this because it has been palloc'd.) 
 * We assume the StringInfoData is just a local variable in the caller and 
 * need not be pfree'd. 
 * -------------------------------- 
 */ 
</span><a href="../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a> <span class='Operator'>* 
</span><a name="LN378"></a><span class='Declare_Function'>pq_endtypsend</span><span class='Parentheses'>(</span><a href="../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>buf</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN380"></a>    <a href="../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>result</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pqformat.c.html#LN378"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Insert correct length into bytea length word */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pqformat.c.html#LN378"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>&GT;= </span><a href="../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="pqformat.c.html#LN380"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="pqformat.c.html#LN378"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pqformat.c.html#LN380"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* -------------------------------- 
 *      pq_puttextmessage - generate a character set-converted message in one step 
 * 
 *      This is the same as the pqcomm.c routine pq_putmessage, except that 
 *      the message body is a null-terminated string to which encoding 
 *      conversion applies. 
 * -------------------------------- 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN399"></a><span class='Declare_Function'>pq_puttextmessage</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Declare_Parameter'>msgtype</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN401"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>slen</span> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="pqformat.c.html#LN399"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN402"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span> 
    <a href="pqformat.c.html#LN402"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="../../include/mb/pg_wchar.h.html#LN565"><span class='Ref_to_Proto'>pg_server_to_client</span></a><span class='Parentheses'>(</span><a href="pqformat.c.html#LN399"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="pqformat.c.html#LN401"><span class='Ref_To_Local'>slen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pqformat.c.html#LN402"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>!= </span><a href="pqformat.c.html#LN399"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span>               <span class='Comment_Single_Line'>/* actual conversion has been done? */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../include/libpq/libpq.h.html#LN41"><span class='Ref_to_Macro'>pq_putmessage</span></a><span class='Parentheses'>(</span><a href="pqformat.c.html#LN399"><span class='Ref_to_Parameter'>msgtype</span></a><span class='Delimiter'>, </span><a href="pqformat.c.html#LN402"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span>strlen<span class='Parentheses'>(</span><a href="pqformat.c.html#LN402"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="pqformat.c.html#LN402"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../include/libpq/libpq.h.html#LN41"><span class='Ref_to_Macro'>pq_putmessage</span></a><span class='Parentheses'>(</span><a href="pqformat.c.html#LN399"><span class='Ref_to_Parameter'>msgtype</span></a><span class='Delimiter'>, </span><a href="pqformat.c.html#LN399"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="pqformat.c.html#LN401"><span class='Ref_To_Local'>slen</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* -------------------------------- 
 *      pq_putemptymessage - convenience routine for message with empty body 
 * -------------------------------- 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN420"></a><span class='Declare_Function'>pq_putemptymessage</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Declare_Parameter'>msgtype</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../include/libpq/libpq.h.html#LN41"><span class='Ref_to_Macro'>pq_putmessage</span></a><span class='Parentheses'>(</span><a href="pqformat.c.html#LN420"><span class='Ref_to_Parameter'>msgtype</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* -------------------------------- 
 *      pq_getmsgbyte   - get a raw byte from a message buffer 
 * -------------------------------- 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN431"></a><span class='Declare_Function'>pq_getmsgbyte</span><span class='Parentheses'>(</span><a href="../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>msg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pqformat.c.html#LN431"><span class='Ref_to_Parameter'>msg</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN39"><span class='Ref_to_Member'>cursor</span></a> <span class='Operator'>&GT;= </span><a href="pqformat.c.html#LN431"><span class='Ref_to_Parameter'>msg</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_PROTOCOL_VIOLATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"no data left in message"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Parentheses'>(</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><a href="pqformat.c.html#LN431"><span class='Ref_to_Parameter'>msg</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>[</span><a href="pqformat.c.html#LN431"><span class='Ref_to_Parameter'>msg</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN39"><span class='Ref_to_Member'>cursor</span></a><span class='Operator'>++</span><span class='Delimiter'>]; 
} 
</span> 
<span class='Comment_Multi_Line'>/* -------------------------------- 
 *      pq_getmsgint    - get a binary integer from a message buffer 
 * 
 *      Values are treated as unsigned. 
 * -------------------------------- 
 */ 
</span><span class='Keyword'>unsigned int 
</span><a name="LN447"></a><span class='Declare_Function'>pq_getmsgint</span><span class='Parentheses'>(</span><a href="../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>msg</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>b</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN449"></a>    <span class='Keyword'>unsigned int </span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN450"></a>    <span class='Keyword'>unsigned char </span><span class='Declare_Local'>n8</span><span class='Delimiter'>; 
</span><a name="LN451"></a>    <a href="../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a>      <span class='Declare_Local'>n16</span><span class='Delimiter'>; 
</span><a name="LN452"></a>    <a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>n32</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pqformat.c.html#LN447"><span class='Ref_to_Parameter'>b</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <span class='Number'>1</span><span class='Operator'>: 
</span>            <a href="../../include/libpq/pqformat.h.html#LN43"><span class='Ref_to_Proto'>pq_copymsgbytes</span></a><span class='Parentheses'>(</span><a href="pqformat.c.html#LN447"><span class='Ref_to_Parameter'>msg</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="pqformat.c.html#LN450"><span class='Ref_To_Local'>n8</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pqformat.c.html#LN449"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="pqformat.c.html#LN450"><span class='Ref_To_Local'>n8</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <span class='Number'>2</span><span class='Operator'>: 
</span>            <a href="../../include/libpq/pqformat.h.html#LN43"><span class='Ref_to_Proto'>pq_copymsgbytes</span></a><span class='Parentheses'>(</span><a href="pqformat.c.html#LN447"><span class='Ref_to_Parameter'>msg</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="pqformat.c.html#LN451"><span class='Ref_To_Local'>n16</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pqformat.c.html#LN449"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span>ntohs<span class='Parentheses'>(</span><a href="pqformat.c.html#LN451"><span class='Ref_To_Local'>n16</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <span class='Number'>4</span><span class='Operator'>: 
</span>            <a href="../../include/libpq/pqformat.h.html#LN43"><span class='Ref_to_Proto'>pq_copymsgbytes</span></a><span class='Parentheses'>(</span><a href="pqformat.c.html#LN447"><span class='Ref_to_Parameter'>msg</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="pqformat.c.html#LN452"><span class='Ref_To_Local'>n32</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pqformat.c.html#LN449"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span>ntohl<span class='Parentheses'>(</span><a href="pqformat.c.html#LN452"><span class='Ref_To_Local'>n32</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unsupported integer size %d"</span><span class='Delimiter'>, </span><a href="pqformat.c.html#LN447"><span class='Ref_to_Parameter'>b</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pqformat.c.html#LN449"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="pqformat.c.html#LN449"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pq_getmsgint &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* -------------------------------- 
 *      pq_getmsgint64  - get a binary 8-byte int from a message buffer 
 * 
 * It is tempting to merge this with pq_getmsgint, but we'd have to make the 
 * result int64 for all data widths --- that could be a big performance 
 * hit on machines where int64 isn't efficient. 
 * -------------------------------- 
 */ 
</span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> 
<a name="LN485"></a><span class='Declare_Function'>pq_getmsgint64</span><span class='Parentheses'>(</span><a href="../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>msg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN487"></a>    <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN488"></a>    <a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>h32</span><span class='Delimiter'>; 
</span><a name="LN489"></a>    <a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>l32</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/libpq/pqformat.h.html#LN43"><span class='Ref_to_Proto'>pq_copymsgbytes</span></a><span class='Parentheses'>(</span><a href="pqformat.c.html#LN485"><span class='Ref_to_Parameter'>msg</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="pqformat.c.html#LN488"><span class='Ref_To_Local'>h32</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/libpq/pqformat.h.html#LN43"><span class='Ref_to_Proto'>pq_copymsgbytes</span></a><span class='Parentheses'>(</span><a href="pqformat.c.html#LN485"><span class='Ref_to_Parameter'>msg</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="pqformat.c.html#LN489"><span class='Ref_To_Local'>l32</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pqformat.c.html#LN488"><span class='Ref_To_Local'>h32</span></a> <span class='Operator'>= </span>ntohl<span class='Parentheses'>(</span><a href="pqformat.c.html#LN488"><span class='Ref_To_Local'>h32</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pqformat.c.html#LN489"><span class='Ref_To_Local'>l32</span></a> <span class='Operator'>= </span>ntohl<span class='Parentheses'>(</span><a href="pqformat.c.html#LN489"><span class='Ref_To_Local'>l32</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pqformat.c.html#LN487"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="pqformat.c.html#LN488"><span class='Ref_To_Local'>h32</span></a><span class='Delimiter'>; 
</span>    <a href="pqformat.c.html#LN487"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>&LT;&LT;= </span><span class='Number'>32</span><span class='Delimiter'>; 
</span>    <a href="pqformat.c.html#LN487"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>|= </span><a href="pqformat.c.html#LN489"><span class='Ref_To_Local'>l32</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pqformat.c.html#LN487"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* -------------------------------- 
 *      pq_getmsgfloat4 - get a float4 from a message buffer 
 * 
 * See notes for pq_sendfloat4. 
 * -------------------------------- 
 */ 
</span><a href="../../include/c.h.html#LN379"><span class='Ref_to_Typedef'>float4</span></a> 
<a name="LN510"></a><span class='Declare_Function'>pq_getmsgfloat4</span><span class='Parentheses'>(</span><a href="../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>msg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>union</span> 
    <span class='Delimiter'>{ 
</span><a name="LN514"></a>        <a href="../../include/c.h.html#LN379"><span class='Ref_to_Typedef'>float4</span></a>      <span class='Declare_Member'>f</span><span class='Delimiter'>; 
</span><a name="LN515"></a>        <a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Member'>i</span><span class='Delimiter'>; 
</span><a name="LN516"></a>    <span class='Delimiter'>}</span>           <span class='Declare_Local'>swap</span><span class='Delimiter'>; 
</span> 
    <a href="pqformat.c.html#LN516"><span class='Ref_To_Local'>swap</span></a><span class='Operator'>.</span><a href="pqformat.c.html#LN515"><span class='Ref_to_Member'>i</span></a> <span class='Operator'>= </span><a href="../../include/libpq/pqformat.h.html#LN38"><span class='Ref_to_Proto'>pq_getmsgint</span></a><span class='Parentheses'>(</span><a href="pqformat.c.html#LN510"><span class='Ref_to_Parameter'>msg</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="pqformat.c.html#LN516"><span class='Ref_To_Local'>swap</span></a><span class='Operator'>.</span><a href="pqformat.c.html#LN514"><span class='Ref_to_Member'>f</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* -------------------------------- 
 *      pq_getmsgfloat8 - get a float8 from a message buffer 
 * 
 * See notes for pq_sendfloat8. 
 * -------------------------------- 
 */ 
</span><a href="../../include/c.h.html#LN380"><span class='Ref_to_Typedef'>float8</span></a> 
<a name="LN529"></a><span class='Declare_Function'>pq_getmsgfloat8</span><span class='Parentheses'>(</span><a href="../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>msg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>union</span> 
    <span class='Delimiter'>{ 
</span><a name="LN533"></a>        <a href="../../include/c.h.html#LN380"><span class='Ref_to_Typedef'>float8</span></a>      <span class='Declare_Member'>f</span><span class='Delimiter'>; 
</span><a name="LN534"></a>        <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Member'>i</span><span class='Delimiter'>; 
</span><a name="LN535"></a>    <span class='Delimiter'>}</span>           <span class='Declare_Local'>swap</span><span class='Delimiter'>; 
</span> 
    <a href="pqformat.c.html#LN535"><span class='Ref_To_Local'>swap</span></a><span class='Operator'>.</span><a href="pqformat.c.html#LN534"><span class='Ref_to_Member'>i</span></a> <span class='Operator'>= </span><a href="../../include/libpq/pqformat.h.html#LN39"><span class='Ref_to_Proto'>pq_getmsgint64</span></a><span class='Parentheses'>(</span><a href="pqformat.c.html#LN529"><span class='Ref_to_Parameter'>msg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="pqformat.c.html#LN535"><span class='Ref_To_Local'>swap</span></a><span class='Operator'>.</span><a href="pqformat.c.html#LN533"><span class='Ref_to_Member'>f</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* -------------------------------- 
 *      pq_getmsgbytes  - get raw data from a message buffer 
 * 
 *      Returns a pointer directly into the message buffer; note this 
 *      may not have any particular alignment. 
 * -------------------------------- 
 */ 
</span><span class='Keyword'>const char </span><span class='Operator'>* 
</span><a name="LN549"></a><span class='Declare_Function'>pq_getmsgbytes</span><span class='Parentheses'>(</span><a href="../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>msg</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>datalen</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN551"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pqformat.c.html#LN549"><span class='Ref_to_Parameter'>datalen</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="pqformat.c.html#LN549"><span class='Ref_to_Parameter'>datalen</span></a> <span class='Operator'>&GT; </span><span class='Parentheses'>(</span><a href="pqformat.c.html#LN549"><span class='Ref_to_Parameter'>msg</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>- </span><a href="pqformat.c.html#LN549"><span class='Ref_to_Parameter'>msg</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN39"><span class='Ref_to_Member'>cursor</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_PROTOCOL_VIOLATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"insufficient data left in message"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="pqformat.c.html#LN551"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= &</span><a href="pqformat.c.html#LN549"><span class='Ref_to_Parameter'>msg</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>[</span><a href="pqformat.c.html#LN549"><span class='Ref_to_Parameter'>msg</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN39"><span class='Ref_to_Member'>cursor</span></a><span class='Delimiter'>]; 
</span>    <a href="pqformat.c.html#LN549"><span class='Ref_to_Parameter'>msg</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN39"><span class='Ref_to_Member'>cursor</span></a> <span class='Operator'>+= </span><a href="pqformat.c.html#LN549"><span class='Ref_to_Parameter'>datalen</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="pqformat.c.html#LN551"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* -------------------------------- 
 *      pq_copymsgbytes - copy raw data from a message buffer 
 * 
 *      Same as above, except data is copied to caller's buffer. 
 * -------------------------------- 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN569"></a><span class='Declare_Function'>pq_copymsgbytes</span><span class='Parentheses'>(</span><a href="../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>msg</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>datalen</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pqformat.c.html#LN569"><span class='Ref_to_Parameter'>datalen</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="pqformat.c.html#LN569"><span class='Ref_to_Parameter'>datalen</span></a> <span class='Operator'>&GT; </span><span class='Parentheses'>(</span><a href="pqformat.c.html#LN569"><span class='Ref_to_Parameter'>msg</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>- </span><a href="pqformat.c.html#LN569"><span class='Ref_to_Parameter'>msg</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN39"><span class='Ref_to_Member'>cursor</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_PROTOCOL_VIOLATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"insufficient data left in message"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="pqformat.c.html#LN569"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pqformat.c.html#LN569"><span class='Ref_to_Parameter'>msg</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>[</span><a href="pqformat.c.html#LN569"><span class='Ref_to_Parameter'>msg</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN39"><span class='Ref_to_Member'>cursor</span></a><span class='Delimiter'>], </span><a href="pqformat.c.html#LN569"><span class='Ref_to_Parameter'>datalen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pqformat.c.html#LN569"><span class='Ref_to_Parameter'>msg</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN39"><span class='Ref_to_Member'>cursor</span></a> <span class='Operator'>+= </span><a href="pqformat.c.html#LN569"><span class='Ref_to_Parameter'>datalen</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* -------------------------------- 
 *      pq_getmsgtext   - get a counted text string (with conversion) 
 * 
 *      Always returns a pointer to a freshly palloc'd result. 
 *      The result has a trailing null, *and* we return its strlen in *nbytes. 
 * -------------------------------- 
 */ 
</span><span class='Keyword'>char </span><span class='Operator'>* 
</span><a name="LN587"></a><span class='Declare_Function'>pq_getmsgtext</span><span class='Parentheses'>(</span><a href="../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>msg</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>rawbytes</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>nbytes</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN589"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>str</span><span class='Delimiter'>; 
</span><a name="LN590"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pqformat.c.html#LN587"><span class='Ref_to_Parameter'>rawbytes</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="pqformat.c.html#LN587"><span class='Ref_to_Parameter'>rawbytes</span></a> <span class='Operator'>&GT; </span><span class='Parentheses'>(</span><a href="pqformat.c.html#LN587"><span class='Ref_to_Parameter'>msg</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>- </span><a href="pqformat.c.html#LN587"><span class='Ref_to_Parameter'>msg</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN39"><span class='Ref_to_Member'>cursor</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_PROTOCOL_VIOLATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"insufficient data left in message"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="pqformat.c.html#LN589"><span class='Ref_To_Local'>str</span></a> <span class='Operator'>= &</span><a href="pqformat.c.html#LN587"><span class='Ref_to_Parameter'>msg</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>[</span><a href="pqformat.c.html#LN587"><span class='Ref_to_Parameter'>msg</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN39"><span class='Ref_to_Member'>cursor</span></a><span class='Delimiter'>]; 
</span>    <a href="pqformat.c.html#LN587"><span class='Ref_to_Parameter'>msg</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN39"><span class='Ref_to_Member'>cursor</span></a> <span class='Operator'>+= </span><a href="pqformat.c.html#LN587"><span class='Ref_to_Parameter'>rawbytes</span></a><span class='Delimiter'>; 
</span> 
    <a href="pqformat.c.html#LN590"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="../utils/mb/mbutils.c.html#LN554"><span class='Ref_to_Func'>pg_client_to_server</span></a><span class='Parentheses'>(</span><a href="pqformat.c.html#LN589"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, </span><a href="pqformat.c.html#LN587"><span class='Ref_to_Parameter'>rawbytes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pqformat.c.html#LN590"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>!= </span><a href="pqformat.c.html#LN589"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)</span>               <span class='Comment_Single_Line'>/* actual conversion has been done? */ 
</span>        <span class='Operator'>*</span><a href="pqformat.c.html#LN587"><span class='Ref_to_Parameter'>nbytes</span></a> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="pqformat.c.html#LN590"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pqformat.c.html#LN590"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="pqformat.c.html#LN587"><span class='Ref_to_Parameter'>rawbytes</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><a href="pqformat.c.html#LN590"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="pqformat.c.html#LN589"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, </span><a href="pqformat.c.html#LN587"><span class='Ref_to_Parameter'>rawbytes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pqformat.c.html#LN590"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>[</span><a href="pqformat.c.html#LN587"><span class='Ref_to_Parameter'>rawbytes</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="pqformat.c.html#LN587"><span class='Ref_to_Parameter'>nbytes</span></a> <span class='Operator'>= </span><a href="pqformat.c.html#LN587"><span class='Ref_to_Parameter'>rawbytes</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="pqformat.c.html#LN590"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pq_getmsgtext &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* -------------------------------- 
 *      pq_getmsgstring - get a null-terminated text string (with conversion) 
 * 
 *      May return a pointer directly into the message buffer, or a pointer 
 *      to a palloc'd conversion result. 
 * -------------------------------- 
 */ 
</span><span class='Keyword'>const char </span><span class='Operator'>* 
</span><a name="LN620"></a><span class='Declare_Function'>pq_getmsgstring</span><span class='Parentheses'>(</span><a href="../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>msg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN622"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>str</span><span class='Delimiter'>; 
</span><a name="LN623"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>slen</span><span class='Delimiter'>; 
</span> 
    <a href="pqformat.c.html#LN622"><span class='Ref_To_Local'>str</span></a> <span class='Operator'>= &</span><a href="pqformat.c.html#LN620"><span class='Ref_to_Parameter'>msg</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>[</span><a href="pqformat.c.html#LN620"><span class='Ref_to_Parameter'>msg</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN39"><span class='Ref_to_Member'>cursor</span></a><span class='Delimiter'>]; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * It's safe to use strlen() here because a StringInfo is guaranteed to 
     * have a trailing null byte.  But check we found a null inside the 
     * message. 
     */ 
</span>    <a href="pqformat.c.html#LN623"><span class='Ref_To_Local'>slen</span></a> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="pqformat.c.html#LN622"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pqformat.c.html#LN620"><span class='Ref_to_Parameter'>msg</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN39"><span class='Ref_to_Member'>cursor</span></a> <span class='Operator'>+ </span><a href="pqformat.c.html#LN623"><span class='Ref_To_Local'>slen</span></a> <span class='Operator'>&GT;= </span><a href="pqformat.c.html#LN620"><span class='Ref_to_Parameter'>msg</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_PROTOCOL_VIOLATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid string in message"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="pqformat.c.html#LN620"><span class='Ref_to_Parameter'>msg</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN39"><span class='Ref_to_Member'>cursor</span></a> <span class='Operator'>+= </span><a href="pqformat.c.html#LN623"><span class='Ref_To_Local'>slen</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../utils/mb/mbutils.c.html#LN554"><span class='Ref_to_Func'>pg_client_to_server</span></a><span class='Parentheses'>(</span><a href="pqformat.c.html#LN622"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, </span><a href="pqformat.c.html#LN623"><span class='Ref_To_Local'>slen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pq_getmsgstring &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* -------------------------------- 
 *      pq_getmsgrawstring - get a null-terminated text string - NO conversion 
 * 
 *      Returns a pointer directly into the message buffer. 
 * -------------------------------- 
 */ 
</span><span class='Keyword'>const char </span><span class='Operator'>* 
</span><a name="LN649"></a><span class='Declare_Function'>pq_getmsgrawstring</span><span class='Parentheses'>(</span><a href="../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>msg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN651"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>str</span><span class='Delimiter'>; 
</span><a name="LN652"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>slen</span><span class='Delimiter'>; 
</span> 
    <a href="pqformat.c.html#LN651"><span class='Ref_To_Local'>str</span></a> <span class='Operator'>= &</span><a href="pqformat.c.html#LN649"><span class='Ref_to_Parameter'>msg</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>[</span><a href="pqformat.c.html#LN649"><span class='Ref_to_Parameter'>msg</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN39"><span class='Ref_to_Member'>cursor</span></a><span class='Delimiter'>]; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * It's safe to use strlen() here because a StringInfo is guaranteed to 
     * have a trailing null byte.  But check we found a null inside the 
     * message. 
     */ 
</span>    <a href="pqformat.c.html#LN652"><span class='Ref_To_Local'>slen</span></a> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="pqformat.c.html#LN651"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pqformat.c.html#LN649"><span class='Ref_to_Parameter'>msg</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN39"><span class='Ref_to_Member'>cursor</span></a> <span class='Operator'>+ </span><a href="pqformat.c.html#LN652"><span class='Ref_To_Local'>slen</span></a> <span class='Operator'>&GT;= </span><a href="pqformat.c.html#LN649"><span class='Ref_to_Parameter'>msg</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_PROTOCOL_VIOLATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid string in message"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="pqformat.c.html#LN649"><span class='Ref_to_Parameter'>msg</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN39"><span class='Ref_to_Member'>cursor</span></a> <span class='Operator'>+= </span><a href="pqformat.c.html#LN652"><span class='Ref_To_Local'>slen</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pqformat.c.html#LN651"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pq_getmsgrawstring &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* -------------------------------- 
 *      pq_getmsgend    - verify message fully consumed 
 * -------------------------------- 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN676"></a><span class='Declare_Function'>pq_getmsgend</span><span class='Parentheses'>(</span><a href="../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>msg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pqformat.c.html#LN676"><span class='Ref_to_Parameter'>msg</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN39"><span class='Ref_to_Member'>cursor</span></a> <span class='Operator'>!= </span><a href="pqformat.c.html#LN676"><span class='Ref_to_Parameter'>msg</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_PROTOCOL_VIOLATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid message format"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
} 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>