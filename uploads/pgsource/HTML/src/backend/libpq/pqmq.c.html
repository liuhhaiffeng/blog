<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\libpq\pqmq.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\libpq\pqmq.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:40 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * pqmq.c 
 *    Use the frontend/backend protocol for communication over a shm_mq 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 *  src/backend/libpq/pqmq.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span> 
<span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"libpq/libpq.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"libpq/pqformat.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"libpq/pqmq.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"pgstat.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"tcop/tcopprot.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
 
<a name="LN23"></a><span class='Keyword'>static </span><a href="../storage/ipc/shm_mq.c.html#LN68"><span class='Ref_to_Struct'>shm_mq</span></a> <span class='Operator'>*</span><span class='Declare_Var'>pq_mq</span><span class='Delimiter'>; 
</span><a name="LN24"></a><span class='Keyword'>static </span><a href="../storage/ipc/shm_mq.c.html#LN126"><span class='Ref_to_Struct'>shm_mq_handle</span></a> <span class='Operator'>*</span><span class='Declare_Var'>pq_mq_handle</span><span class='Delimiter'>; 
</span><a name="LN25"></a><span class='Keyword'>static bool </span><span class='Declare_Var'>pq_mq_busy</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN26"></a><span class='Keyword'>static </span><a href="../../include/port/win32.h.html#LN255"><span class='Ref_to_Typedef'>pid_t</span></a> <span class='Declare_Var'>pq_mq_parallel_master_pid</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN27"></a><span class='Keyword'>static </span><a href="../../include/port/win32.h.html#LN255"><span class='Ref_to_Typedef'>pid_t</span></a> <span class='Declare_Var'>pq_mq_parallel_master_backend_id</span> <span class='Operator'>= </span><a href="../../include/storage/backendid.h.html#LN22"><span class='Ref_to_Const'>InvalidBackendId</span></a><span class='Delimiter'>; 
</span> 
<a name="LN29"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>pq_cleanup_redirect_to_shm_mq</span><span class='Parentheses'>(</span><a href="../storage/ipc/dsm.c.html#LN66"><span class='Ref_to_Struct'>dsm_segment</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>seg</span><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>arg</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN30"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>mq_comm_reset</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN31"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>mq_flush</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN32"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>mq_flush_if_writable</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN33"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>mq_is_send_pending</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN34"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>mq_putmessage</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Declare_Parameter'>msgtype</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>s</span><span class='Delimiter'>, </span>size_t <span class='Declare_Parameter'>len</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN35"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>mq_putmessage_noblock</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Declare_Parameter'>msgtype</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>s</span><span class='Delimiter'>, </span>size_t <span class='Declare_Parameter'>len</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN36"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>mq_startcopyout</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN37"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>mq_endcopyout</span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Declare_Parameter'>errorAbort</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN39"></a><span class='Keyword'>static </span><a href="../../include/libpq/libpq.h.html#LN23"><span class='Ref_to_Typedef'>PQcommMethods</span></a> <span class='Declare_Var'>PqCommMqMethods</span> <span class='Operator'>= </span><span class='Delimiter'>{ 
</span>    <a href="pqmq.c.html#LN30"><span class='Ref_to_Proto'>mq_comm_reset</span></a><span class='Delimiter'>, 
</span>    <a href="pqmq.c.html#LN31"><span class='Ref_to_Proto'>mq_flush</span></a><span class='Delimiter'>, 
</span>    <a href="pqmq.c.html#LN32"><span class='Ref_to_Proto'>mq_flush_if_writable</span></a><span class='Delimiter'>, 
</span>    <a href="pqmq.c.html#LN33"><span class='Ref_to_Proto'>mq_is_send_pending</span></a><span class='Delimiter'>, 
</span>    <a href="pqmq.c.html#LN34"><span class='Ref_to_Proto'>mq_putmessage</span></a><span class='Delimiter'>, 
</span>    <a href="pqmq.c.html#LN35"><span class='Ref_to_Proto'>mq_putmessage_noblock</span></a><span class='Delimiter'>, 
</span>    <a href="pqmq.c.html#LN36"><span class='Ref_to_Proto'>mq_startcopyout</span></a><span class='Delimiter'>, 
</span>    <a href="pqmq.c.html#LN37"><span class='Ref_to_Proto'>mq_endcopyout</span></a> 
<span class='Delimiter'>}; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Arrange to redirect frontend/backend protocol messages to a shared-memory 
 * message queue. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN55"></a><span class='Declare_Function'>pq_redirect_to_shm_mq</span><span class='Parentheses'>(</span><a href="../storage/ipc/dsm.c.html#LN66"><span class='Ref_to_Struct'>dsm_segment</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>seg</span><span class='Delimiter'>, </span><a href="../storage/ipc/shm_mq.c.html#LN126"><span class='Ref_to_Struct'>shm_mq_handle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>mqh</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="pqcomm.c.html#LN164"><span class='Ref_to_Global_Var'>PqCommMethods</span></a> <span class='Operator'>= &</span><a href="pqmq.c.html#LN39"><span class='Ref_to_Global_Var'>PqCommMqMethods</span></a><span class='Delimiter'>; 
</span>    <a href="pqmq.c.html#LN23"><span class='Ref_to_Global_Var'>pq_mq</span></a> <span class='Operator'>= </span><a href="../../include/storage/shm_mq.h.html#LN68"><span class='Ref_to_Proto'>shm_mq_get_queue</span></a><span class='Parentheses'>(</span><a href="pqmq.c.html#LN55"><span class='Ref_to_Parameter'>mqh</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pqmq.c.html#LN24"><span class='Ref_to_Global_Var'>pq_mq_handle</span></a> <span class='Operator'>= </span><a href="pqmq.c.html#LN55"><span class='Ref_to_Parameter'>mqh</span></a><span class='Delimiter'>; 
</span>    <a href="../tcop/postgres.c.html#LN87"><span class='Ref_to_Global_Var'>whereToSendOutput</span></a> <span class='Operator'>= </span><a href="../../include/tcop/dest.h.html#LN89"><span class='Ref_to_EnumConst'>DestRemote</span></a><span class='Delimiter'>; 
</span>    <a href="../utils/init/globals.c.html#LN26"><span class='Ref_to_Global_Var'>FrontendProtocol</span></a> <span class='Operator'>= </span><a href="../../include/libpq/pqcomm.h.html#LN110"><span class='Ref_to_Const'>PG_PROTOCOL_LATEST</span></a><span class='Delimiter'>; 
</span>    <a href="../../include/storage/dsm.h.html#LN56"><span class='Ref_to_Proto'>on_dsm_detach</span></a><span class='Parentheses'>(</span><a href="pqmq.c.html#LN55"><span class='Ref_to_Parameter'>seg</span></a><span class='Delimiter'>, </span><a href="pqmq.c.html#LN29"><span class='Ref_to_Proto'>pq_cleanup_redirect_to_shm_mq</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * When the DSM that contains our shm_mq goes away, we need to stop sending 
 * messages to it. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN70"></a><span class='Declare_Function'>pq_cleanup_redirect_to_shm_mq</span><span class='Parentheses'>(</span><a href="../storage/ipc/dsm.c.html#LN66"><span class='Ref_to_Struct'>dsm_segment</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>seg</span><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>arg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="pqmq.c.html#LN23"><span class='Ref_to_Global_Var'>pq_mq</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="pqmq.c.html#LN24"><span class='Ref_to_Global_Var'>pq_mq_handle</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="../tcop/postgres.c.html#LN87"><span class='Ref_to_Global_Var'>whereToSendOutput</span></a> <span class='Operator'>= </span><a href="../../include/tcop/dest.h.html#LN87"><span class='Ref_to_EnumConst'>DestNone</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Arrange to SendProcSignal() to the parallel master each time we transmit 
 * message data via the shm_mq. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN82"></a><span class='Declare_Function'>pq_set_parallel_master</span><span class='Parentheses'>(</span><a href="../../include/port/win32.h.html#LN255"><span class='Ref_to_Typedef'>pid_t</span></a> <span class='Declare_Parameter'>pid</span><span class='Delimiter'>, </span><a href="../../include/storage/backendid.h.html#LN20"><span class='Ref_to_Typedef'>BackendId</span></a> <span class='Declare_Parameter'>backend_id</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pqcomm.c.html#LN164"><span class='Ref_to_Global_Var'>PqCommMethods</span></a> <span class='Operator'>== &</span><a href="pqmq.c.html#LN39"><span class='Ref_to_Global_Var'>PqCommMqMethods</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pqmq.c.html#LN26"><span class='Ref_to_Global_Var'>pq_mq_parallel_master_pid</span></a> <span class='Operator'>= </span><a href="pqmq.c.html#LN82"><span class='Ref_to_Parameter'>pid</span></a><span class='Delimiter'>; 
</span>    <a href="pqmq.c.html#LN27"><span class='Ref_to_Global_Var'>pq_mq_parallel_master_backend_id</span></a> <span class='Operator'>= </span><a href="pqmq.c.html#LN82"><span class='Ref_to_Parameter'>backend_id</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN90"></a><span class='Declare_Function'>mq_comm_reset</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Nothing to do. */ 
</span><span class='Delimiter'>} 
</span> 
<span class='Keyword'>static int 
</span><a name="LN96"></a><span class='Declare_Function'>mq_flush</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Nothing to do. */ 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static int 
</span><a name="LN103"></a><span class='Declare_Function'>mq_flush_if_writable</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Nothing to do. */ 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static bool 
</span><a name="LN110"></a><span class='Declare_Function'>mq_is_send_pending</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* There's never anything pending. */ 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Transmit a libpq protocol message to the shared memory message queue 
 * selected via pq_mq_handle.  We don't include a length word, because the 
 * receiver will know the length of the message from shm_mq_receive(). 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN122"></a><span class='Declare_Function'>mq_putmessage</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Declare_Parameter'>msgtype</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>s</span><span class='Delimiter'>, </span>size_t <span class='Declare_Parameter'>len</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN124"></a>    <a href="../../include/storage/shm_mq.h.html#LN28"><span class='Ref_to_Typedef'>shm_mq_iovec</span></a> <span class='Declare_Local'>iov</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]; 
</span><a name="LN125"></a>    <a href="../../include/storage/shm_mq.h.html#LN35"><span class='Ref_to_Typedef'>shm_mq_result</span></a> <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we're sending a message, and we have to wait because the queue is 
     * full, and then we get interrupted, and that interrupt results in trying 
     * to send another message, we respond by detaching the queue.  There's no 
     * way to return to the original context, but even if there were, just 
     * queueing the message would amount to indefinitely postponing the 
     * response to the interrupt.  So we do this instead. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pqmq.c.html#LN25"><span class='Ref_to_Global_Var'>pq_mq_busy</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pqmq.c.html#LN23"><span class='Ref_to_Global_Var'>pq_mq</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="../../include/storage/shm_mq.h.html#LN65"><span class='Ref_to_Proto'>shm_mq_detach</span></a><span class='Parentheses'>(</span><a href="pqmq.c.html#LN23"><span class='Ref_to_Global_Var'>pq_mq</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pqmq.c.html#LN23"><span class='Ref_to_Global_Var'>pq_mq</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="pqmq.c.html#LN24"><span class='Ref_to_Global_Var'>pq_mq_handle</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> EOF<span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the message queue is already gone, just ignore the message. This 
     * doesn't necessarily indicate a problem; for example, DEBUG messages can 
     * be generated late in the shutdown sequence, after all DSMs have already 
     * been detached. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pqmq.c.html#LN23"><span class='Ref_to_Global_Var'>pq_mq</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="pqmq.c.html#LN25"><span class='Ref_to_Global_Var'>pq_mq_busy</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="pqmq.c.html#LN124"><span class='Ref_To_Local'>iov</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../include/storage/shm_mq.h.html#LN30"><span class='Ref_to_Member'>data</span></a> <span class='Operator'>= &</span><a href="pqmq.c.html#LN122"><span class='Ref_to_Parameter'>msgtype</span></a><span class='Delimiter'>; 
</span>    <a href="pqmq.c.html#LN124"><span class='Ref_To_Local'>iov</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../include/storage/shm_mq.h.html#LN31"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="pqmq.c.html#LN124"><span class='Ref_To_Local'>iov</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../include/storage/shm_mq.h.html#LN30"><span class='Ref_to_Member'>data</span></a> <span class='Operator'>= </span><a href="pqmq.c.html#LN122"><span class='Ref_to_Parameter'>s</span></a><span class='Delimiter'>; 
</span>    <a href="pqmq.c.html#LN124"><span class='Ref_To_Local'>iov</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../include/storage/shm_mq.h.html#LN31"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>= </span><a href="pqmq.c.html#LN122"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pqmq.c.html#LN24"><span class='Ref_to_Global_Var'>pq_mq_handle</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pqmq.c.html#LN125"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/storage/shm_mq.h.html#LN73"><span class='Ref_to_Proto'>shm_mq_sendv</span></a><span class='Parentheses'>(</span><a href="pqmq.c.html#LN24"><span class='Ref_to_Global_Var'>pq_mq_handle</span></a><span class='Delimiter'>, </span><a href="pqmq.c.html#LN124"><span class='Ref_To_Local'>iov</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pqmq.c.html#LN26"><span class='Ref_to_Global_Var'>pq_mq_parallel_master_pid</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="../../include/storage/procsignal.h.html#LN55"><span class='Ref_to_Proto'>SendProcSignal</span></a><span class='Parentheses'>(</span><a href="pqmq.c.html#LN26"><span class='Ref_to_Global_Var'>pq_mq_parallel_master_pid</span></a><span class='Delimiter'>, 
</span>                           <a href="../../include/storage/procsignal.h.html#LN33"><span class='Ref_to_EnumConst'>PROCSIG_PARALLEL_MESSAGE</span></a><span class='Delimiter'>, 
</span>                           <a href="pqmq.c.html#LN27"><span class='Ref_to_Global_Var'>pq_mq_parallel_master_backend_id</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pqmq.c.html#LN125"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>!= </span><a href="../../include/storage/shm_mq.h.html#LN38"><span class='Ref_to_EnumConst'>SHM_MQ_WOULD_BLOCK</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/storage/latch.h.html#LN163"><span class='Ref_to_Proto'>WaitLatch</span></a><span class='Parentheses'>(</span><a href="../utils/init/globals.c.html#LN51"><span class='Ref_to_Global_Var'>MyLatch</span></a><span class='Delimiter'>, </span><a href="../../include/storage/latch.h.html#LN123"><span class='Ref_to_Const'>WL_LATCH_SET</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                  <a href="../../include/pgstat.h.html#LN805"><span class='Ref_to_EnumConst'>WAIT_EVENT_MQ_PUT_MESSAGE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/storage/latch.h.html#LN152"><span class='Ref_to_Proto'>ResetLatch</span></a><span class='Parentheses'>(</span><a href="../utils/init/globals.c.html#LN51"><span class='Ref_to_Global_Var'>MyLatch</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/miscadmin.h.html#LN99"><span class='Ref_to_Macro'>CHECK_FOR_INTERRUPTS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pqmq.c.html#LN25"><span class='Ref_to_Global_Var'>pq_mq_busy</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pqmq.c.html#LN125"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>== </span><a href="../../include/storage/shm_mq.h.html#LN37"><span class='Ref_to_EnumConst'>SHM_MQ_SUCCESS</span></a> <span class='Operator'>|| </span><a href="pqmq.c.html#LN125"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>== </span><a href="../../include/storage/shm_mq.h.html#LN39"><span class='Ref_to_EnumConst'>SHM_MQ_DETACHED</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pqmq.c.html#LN125"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>!= </span><a href="../../include/storage/shm_mq.h.html#LN37"><span class='Ref_to_EnumConst'>SHM_MQ_SUCCESS</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> EOF<span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end mq_putmessage &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN189"></a><span class='Declare_Function'>mq_putmessage_noblock</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Declare_Parameter'>msgtype</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>s</span><span class='Delimiter'>, </span>size_t <span class='Declare_Parameter'>len</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * While the shm_mq machinery does support sending a message in 
     * non-blocking mode, there's currently no way to try sending beginning to 
     * send the message that doesn't also commit us to completing the 
     * transmission.  This could be improved in the future, but for now we 
     * don't need it. 
     */ 
</span>    <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"not currently supported"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN202"></a><span class='Declare_Function'>mq_startcopyout</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Nothing to do. */ 
</span><span class='Delimiter'>} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN208"></a><span class='Declare_Function'>mq_endcopyout</span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Declare_Parameter'>errorAbort</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Nothing to do. */ 
</span><span class='Delimiter'>} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Parse an ErrorResponse or NoticeResponse payload and populate an ErrorData 
 * structure with the results. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN218"></a><span class='Declare_Function'>pq_parse_errornotice</span><span class='Parentheses'>(</span><a href="../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>msg</span><span class='Delimiter'>, </span><a href="../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>edata</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Initialize edata with reasonable defaults. */ 
</span>    <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="pqmq.c.html#LN218"><span class='Ref_to_Parameter'>edata</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="pqmq.c.html#LN218"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/elog.h.html#LN330"><span class='Ref_to_Member'>elevel</span></a> <span class='Operator'>= </span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>; 
</span>    <a href="pqmq.c.html#LN218"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/elog.h.html#LN359"><span class='Ref_to_Member'>assoc_context</span></a> <span class='Operator'>= </span><a href="../utils/mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Loop over fields and extract each one. */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN228"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>code</span> <span class='Operator'>= </span><a href="../../include/libpq/pqformat.h.html#LN37"><span class='Ref_to_Proto'>pq_getmsgbyte</span></a><span class='Parentheses'>(</span><a href="pqmq.c.html#LN218"><span class='Ref_to_Parameter'>msg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN229"></a>        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>value</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pqmq.c.html#LN228"><span class='Ref_To_Local'>code</span></a> <span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/libpq/pqformat.h.html#LN47"><span class='Ref_to_Proto'>pq_getmsgend</span></a><span class='Parentheses'>(</span><a href="pqmq.c.html#LN218"><span class='Ref_to_Parameter'>msg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Keyword'>value </span><span class='Operator'>= </span><a href="../../include/libpq/pqformat.h.html#LN46"><span class='Ref_to_Proto'>pq_getmsgrawstring</span></a><span class='Parentheses'>(</span><a href="pqmq.c.html#LN218"><span class='Ref_to_Parameter'>msg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pqmq.c.html#LN228"><span class='Ref_To_Local'>code</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../include/postgres_ext.h.html#LN54"><span class='Ref_to_Const'>PG_DIAG_SEVERITY</span></a><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* ignore, trusting we'll get a nonlocalized version */ 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/postgres_ext.h.html#LN55"><span class='Ref_to_Const'>PG_DIAG_SEVERITY_NONLOCALIZED</span></a><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Delimiter'>, </span><span class='String'>"DEBUG"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* 
                     * We can't reconstruct the exact DEBUG level, but 
                     * presumably it was &GT;= client_min_messages, so select 
                     * DEBUG1 to ensure we'll pass it on to the client. 
                     */ 
</span>                    <a href="pqmq.c.html#LN218"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/elog.h.html#LN330"><span class='Ref_to_Member'>elevel</span></a> <span class='Operator'>= </span><a href="../../include/utils/elog.h.html#LN24"><span class='Ref_to_Const'>DEBUG1</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Delimiter'>, </span><span class='String'>"LOG"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* 
                     * It can't be LOG_SERVER_ONLY, or the worker wouldn't 
                     * have sent it to us; so LOG is the correct value. 
                     */ 
</span>                    <a href="pqmq.c.html#LN218"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/elog.h.html#LN330"><span class='Ref_to_Member'>elevel</span></a> <span class='Operator'>= </span><a href="../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Delimiter'>, </span><span class='String'>"INFO"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <a href="pqmq.c.html#LN218"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/elog.h.html#LN330"><span class='Ref_to_Member'>elevel</span></a> <span class='Operator'>= </span><a href="../../include/utils/elog.h.html#LN32"><span class='Ref_to_Const'>INFO</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Delimiter'>, </span><span class='String'>"NOTICE"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <a href="pqmq.c.html#LN218"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/elog.h.html#LN330"><span class='Ref_to_Member'>elevel</span></a> <span class='Operator'>= </span><a href="../../include/utils/elog.h.html#LN36"><span class='Ref_to_Const'>NOTICE</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Delimiter'>, </span><span class='String'>"WARNING"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <a href="pqmq.c.html#LN218"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/elog.h.html#LN330"><span class='Ref_to_Member'>elevel</span></a> <span class='Operator'>= </span><a href="../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Delimiter'>, </span><span class='String'>"ERROR"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <a href="pqmq.c.html#LN218"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/elog.h.html#LN330"><span class='Ref_to_Member'>elevel</span></a> <span class='Operator'>= </span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Delimiter'>, </span><span class='String'>"FATAL"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <a href="pqmq.c.html#LN218"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/elog.h.html#LN330"><span class='Ref_to_Member'>elevel</span></a> <span class='Operator'>= </span><a href="../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Delimiter'>, </span><span class='String'>"PANIC"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <a href="pqmq.c.html#LN218"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/elog.h.html#LN330"><span class='Ref_to_Member'>elevel</span></a> <span class='Operator'>= </span><a href="../../include/utils/elog.h.html#LN52"><span class='Ref_to_Const'>PANIC</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized error severity: \"%s\""</span><span class='Delimiter'>, </span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/postgres_ext.h.html#LN56"><span class='Ref_to_Const'>PG_DIAG_SQLSTATE</span></a><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>5</span><span class='Parentheses'>)</span> 
                    <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid SQLSTATE: \"%s\""</span><span class='Delimiter'>, </span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pqmq.c.html#LN218"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/elog.h.html#LN341"><span class='Ref_to_Member'>sqlerrcode</span></a> <span class='Operator'>= </span><a href="../../include/utils/elog.h.html#LN61"><span class='Ref_to_Macro'>MAKE_SQLSTATE</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><span class='Keyword'>value</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], </span><span class='Keyword'>value</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>], 
</span>                                                  <span class='Keyword'>value</span><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>], </span><span class='Keyword'>value</span><span class='Delimiter'>[</span><span class='Number'>4</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/postgres_ext.h.html#LN57"><span class='Ref_to_Const'>PG_DIAG_MESSAGE_PRIMARY</span></a><span class='Operator'>: 
</span>                <a href="pqmq.c.html#LN218"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/elog.h.html#LN342"><span class='Ref_to_Member'>message</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/postgres_ext.h.html#LN58"><span class='Ref_to_Const'>PG_DIAG_MESSAGE_DETAIL</span></a><span class='Operator'>: 
</span>                <a href="pqmq.c.html#LN218"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/elog.h.html#LN343"><span class='Ref_to_Member'>detail</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/postgres_ext.h.html#LN59"><span class='Ref_to_Const'>PG_DIAG_MESSAGE_HINT</span></a><span class='Operator'>: 
</span>                <a href="pqmq.c.html#LN218"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/elog.h.html#LN345"><span class='Ref_to_Member'>hint</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/postgres_ext.h.html#LN60"><span class='Ref_to_Const'>PG_DIAG_STATEMENT_POSITION</span></a><span class='Operator'>: 
</span>                <a href="pqmq.c.html#LN218"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/elog.h.html#LN353"><span class='Ref_to_Member'>cursorpos</span></a> <span class='Operator'>= </span><a href="../utils/adt/numutils.c.html#LN35"><span class='Ref_to_Func'>pg_atoi</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>'\0'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/postgres_ext.h.html#LN61"><span class='Ref_to_Const'>PG_DIAG_INTERNAL_POSITION</span></a><span class='Operator'>: 
</span>                <a href="pqmq.c.html#LN218"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/elog.h.html#LN354"><span class='Ref_to_Member'>internalpos</span></a> <span class='Operator'>= </span><a href="../utils/adt/numutils.c.html#LN35"><span class='Ref_to_Func'>pg_atoi</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>'\0'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/postgres_ext.h.html#LN62"><span class='Ref_to_Const'>PG_DIAG_INTERNAL_QUERY</span></a><span class='Operator'>: 
</span>                <a href="pqmq.c.html#LN218"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/elog.h.html#LN355"><span class='Ref_to_Member'>internalquery</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/postgres_ext.h.html#LN63"><span class='Ref_to_Const'>PG_DIAG_CONTEXT</span></a><span class='Operator'>: 
</span>                <a href="pqmq.c.html#LN218"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/elog.h.html#LN346"><span class='Ref_to_Member'>context</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/postgres_ext.h.html#LN64"><span class='Ref_to_Const'>PG_DIAG_SCHEMA_NAME</span></a><span class='Operator'>: 
</span>                <a href="pqmq.c.html#LN218"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/elog.h.html#LN348"><span class='Ref_to_Member'>schema_name</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/postgres_ext.h.html#LN65"><span class='Ref_to_Const'>PG_DIAG_TABLE_NAME</span></a><span class='Operator'>: 
</span>                <a href="pqmq.c.html#LN218"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/elog.h.html#LN349"><span class='Ref_to_Member'>table_name</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/postgres_ext.h.html#LN66"><span class='Ref_to_Const'>PG_DIAG_COLUMN_NAME</span></a><span class='Operator'>: 
</span>                <a href="pqmq.c.html#LN218"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/elog.h.html#LN350"><span class='Ref_to_Member'>column_name</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/postgres_ext.h.html#LN67"><span class='Ref_to_Const'>PG_DIAG_DATATYPE_NAME</span></a><span class='Operator'>: 
</span>                <a href="pqmq.c.html#LN218"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/elog.h.html#LN351"><span class='Ref_to_Member'>datatype_name</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/postgres_ext.h.html#LN68"><span class='Ref_to_Const'>PG_DIAG_CONSTRAINT_NAME</span></a><span class='Operator'>: 
</span>                <a href="pqmq.c.html#LN218"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/elog.h.html#LN352"><span class='Ref_to_Member'>constraint_name</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/postgres_ext.h.html#LN69"><span class='Ref_to_Const'>PG_DIAG_SOURCE_FILE</span></a><span class='Operator'>: 
</span>                <a href="pqmq.c.html#LN218"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/elog.h.html#LN336"><span class='Ref_to_Member'>filename</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/postgres_ext.h.html#LN70"><span class='Ref_to_Const'>PG_DIAG_SOURCE_LINE</span></a><span class='Operator'>: 
</span>                <a href="pqmq.c.html#LN218"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/elog.h.html#LN337"><span class='Ref_to_Member'>lineno</span></a> <span class='Operator'>= </span><a href="../utils/adt/numutils.c.html#LN35"><span class='Ref_to_Func'>pg_atoi</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>'\0'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/postgres_ext.h.html#LN71"><span class='Ref_to_Const'>PG_DIAG_SOURCE_FUNCTION</span></a><span class='Operator'>: 
</span>                <a href="pqmq.c.html#LN218"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/elog.h.html#LN338"><span class='Ref_to_Member'>funcname</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized error field code: %d"</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="pqmq.c.html#LN228"><span class='Ref_To_Local'>code</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch code &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end pq_parse_errornotice &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>