<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\optimizer\path\clausesel.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\optimizer\path\clausesel.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:41 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * clausesel.c 
 *    Routines to compute clause selectivities 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/optimizer/path/clausesel.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"nodes/makefuncs.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/clauses.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/cost.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/pathnode.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/plancat.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/fmgroids.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/selfuncs.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"statistics/statistics.h"</span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Data structure for accumulating info about possible range-query 
 * clause pairs in clauselist_selectivity. 
 */ 
</span><a name="LN31"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>RangeQueryClause</span> 
<span class='Delimiter'>{ 
</span><a name="LN33"></a>    <span class='Control'>struct</span> <a href="clausesel.c.html#LN31"><span class='Ref_to_Struct'>RangeQueryClause</span></a> <span class='Operator'>*</span><span class='Declare_Member'>next</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* next in linked list */ 
</span><a name="LN34"></a>    <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>var</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* The common variable of the clauses */ 
</span><a name="LN35"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>have_lobound</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* found a low-bound clause yet? */ 
</span><a name="LN36"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>have_hibound</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* found a high-bound clause yet? */ 
</span><a name="LN37"></a>    <a href="../../../include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a> <span class='Declare_Member'>lobound</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* Selectivity of a var &GT; something clause */ 
</span><a name="LN38"></a>    <a href="../../../include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a> <span class='Declare_Member'>hibound</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* Selectivity of a var &LT; something clause */ 
</span><a name="LN39"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>RangeQueryClause</span><span class='Delimiter'>; 
</span> 
<a name="LN41"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>addRangeClause</span><span class='Parentheses'>(</span><a href="clausesel.c.html#LN31"><span class='Ref_to_Struct'>RangeQueryClause</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>rqlist</span><span class='Delimiter'>, </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>clause</span><span class='Delimiter'>, 
</span><a name="LN42"></a>               <span class='Keyword'>bool </span><span class='Declare_Parameter'>varonleft</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isLTsel</span><span class='Delimiter'>, </span><a href="../../../include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a> <span class='Declare_Parameter'>s2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN43"></a><span class='Keyword'>static </span><a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>find_single_rel_for_clauses</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN44"></a>                            <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>clauses</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/**************************************************************************** 
 *      ROUTINES TO COMPUTE SELECTIVITIES 
 ****************************************************************************/ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * clauselist_selectivity - 
 *    Compute the selectivity of an implicitly-ANDed list of boolean 
 *    expression clauses.  The list can be empty, in which case 1.0 
 *    must be returned.  List elements may be either RestrictInfos 
 *    or bare expression clauses --- the former is preferred since 
 *    it allows caching of results. 
 * 
 * See clause_selectivity() for the meaning of the additional parameters. 
 * 
 * Our basic approach is to take the product of the selectivities of the 
 * subclauses.  However, that's only right if the subclauses have independent 
 * probabilities, and in reality they are often NOT independent.  So, 
 * we want to be smarter where we can. 
 * 
 * If the clauses taken together refer to just one relation, we'll try to 
 * apply selectivity estimates using any extended statistics for that rel. 
 * Currently we only have (soft) functional dependencies, so apply these in as 
 * many cases as possible, and fall back on normal estimates for remaining 
 * clauses. 
 * 
 * We also recognize "range queries", such as "x &GT; 34 AND x &LT; 42".  Clauses 
 * are recognized as possible range query components if they are restriction 
 * opclauses whose operators have scalarltsel() or scalargtsel() as their 
 * restriction selectivity estimator.  We pair up clauses of this form that 
 * refer to the same variable.  An unpairable clause of this kind is simply 
 * multiplied into the selectivity product in the normal way.  But when we 
 * find a pair, we know that the selectivities represent the relative 
 * positions of the low and high bounds within the column's range, so instead 
 * of figuring the selectivity as hisel * losel, we can figure it as hisel + 
 * losel - 1.  (To visualize this, see that hisel is the fraction of the range 
 * below the high bound, while losel is the fraction above the low bound; so 
 * hisel can be interpreted directly as a 0..1 value but we need to convert 
 * losel to 1-losel before interpreting it as a value.  Then the available 
 * range is 1-losel to hisel.  However, this calculation double-excludes 
 * nulls, so really we need hisel + losel + null_frac - 1.) 
 * 
 * If either selectivity is exactly DEFAULT_INEQ_SEL, we forget this equation 
 * and instead use DEFAULT_RANGE_INEQ_SEL.  The same applies if the equation 
 * yields an impossible (negative) result. 
 * 
 * A free side-effect is that we can recognize redundant inequalities such 
 * as "x &LT; 4 AND x &LT; 5"; only the tighter constraint will be counted. 
 * 
 * Of course this is all very dependent on the behavior of 
 * scalarltsel/scalargtsel; perhaps some day we can generalize the approach. 
 */ 
</span><a href="../../../include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a> 
<a name="LN98"></a><span class='Declare_Function'>clauselist_selectivity</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN99"></a>                       <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>clauses</span><span class='Delimiter'>, 
</span><a name="LN100"></a>                       <span class='Keyword'>int </span><span class='Declare_Parameter'>varRelid</span><span class='Delimiter'>, 
</span><a name="LN101"></a>                       <a href="../../../include/nodes/nodes.h.html#LN671"><span class='Ref_to_Enum'>JoinType</span></a> <span class='Declare_Parameter'>jointype</span><span class='Delimiter'>, 
</span><a name="LN102"></a>                       <a href="../../../include/nodes/relation.h.html#LN1913"><span class='Ref_to_Struct'>SpecialJoinInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>sjinfo</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN104"></a>    <a href="../../../include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a> <span class='Declare_Local'>s1</span> <span class='Operator'>= </span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN105"></a>    <a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN106"></a>    <a href="../../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>estimatedclauses</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN107"></a>    <a href="clausesel.c.html#LN31"><span class='Ref_to_Struct'>RangeQueryClause</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rqlist</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN108"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span><a name="LN109"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>listidx</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If there's exactly one clause, just go directly to 
     * clause_selectivity(). None of what we might do below is relevant. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN99"><span class='Ref_to_Parameter'>clauses</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="../../../include/optimizer/cost.h.html#LN202"><span class='Ref_to_Proto'>clause_selectivity</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN98"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN99"><span class='Ref_to_Parameter'>clauses</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                  <a href="clausesel.c.html#LN100"><span class='Ref_to_Parameter'>varRelid</span></a><span class='Delimiter'>, </span><a href="clausesel.c.html#LN101"><span class='Ref_to_Parameter'>jointype</span></a><span class='Delimiter'>, </span><a href="clausesel.c.html#LN102"><span class='Ref_to_Parameter'>sjinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Determine if these clauses reference a single relation.  If so, and if 
     * it has extended statistics, try to apply those. 
     */ 
</span>    <a href="clausesel.c.html#LN105"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="clausesel.c.html#LN43"><span class='Ref_to_Proto'>find_single_rel_for_clauses</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN98"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="clausesel.c.html#LN99"><span class='Ref_to_Parameter'>clauses</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="clausesel.c.html#LN105"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>&& </span><a href="clausesel.c.html#LN105"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN554"><span class='Ref_to_Member'>rtekind</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/parsenodes.h.html#LN922"><span class='Ref_to_EnumConst'>RTE_RELATION</span></a> <span class='Operator'>&& </span><a href="clausesel.c.html#LN105"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN562"><span class='Ref_to_Member'>statlist</span></a> <span class='Operator'>!= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Perform selectivity estimations on any clauses found applicable by 
         * dependencies_clauselist_selectivity.  'estimatedclauses' will be 
         * filled with the 0-based list positions of clauses used that way, so 
         * that we can ignore them below. 
         */ 
</span>        <a href="clausesel.c.html#LN104"><span class='Ref_To_Local'>s1</span></a> <span class='Operator'>*= </span><a href="../../../include/statistics/statistics.h.html#LN86"><span class='Ref_to_Proto'>dependencies_clauselist_selectivity</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN98"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="clausesel.c.html#LN99"><span class='Ref_to_Parameter'>clauses</span></a><span class='Delimiter'>, </span><a href="clausesel.c.html#LN100"><span class='Ref_to_Parameter'>varRelid</span></a><span class='Delimiter'>, 
</span>                                                  <a href="clausesel.c.html#LN101"><span class='Ref_to_Parameter'>jointype</span></a><span class='Delimiter'>, </span><a href="clausesel.c.html#LN102"><span class='Ref_to_Parameter'>sjinfo</span></a><span class='Delimiter'>, </span><a href="clausesel.c.html#LN105"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, 
</span>                                                  <span class='Operator'>&</span><a href="clausesel.c.html#LN106"><span class='Ref_To_Local'>estimatedclauses</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * This would be the place to apply any other types of extended 
         * statistics selectivity estimations for remaining clauses. 
         */ 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Apply normal selectivity estimates for remaining clauses. We'll be 
     * careful to skip any clauses which were already estimated above. 
     * 
     * Anything that doesn't look like a potential rangequery clause gets 
     * multiplied into s1 and forgotten. Anything that does gets inserted into 
     * an rqlist entry. 
     */ 
</span>    <a href="clausesel.c.html#LN109"><span class='Ref_To_Local'>listidx</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN108"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="clausesel.c.html#LN99"><span class='Ref_to_Parameter'>clauses</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN153"></a>        <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>clause</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN108"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN154"></a>        <a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rinfo</span><span class='Delimiter'>; 
</span><a name="LN155"></a>        <a href="../../../include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a> <span class='Declare_Local'>s2</span><span class='Delimiter'>; 
</span> 
        <a href="clausesel.c.html#LN109"><span class='Ref_To_Local'>listidx</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Skip this clause if it's already been estimated by some other 
         * statistics above. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/bitmapset.h.html#LN75"><span class='Ref_to_Proto'>bms_is_member</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN109"><span class='Ref_To_Local'>listidx</span></a><span class='Delimiter'>, </span><a href="clausesel.c.html#LN106"><span class='Ref_To_Local'>estimatedclauses</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Always compute the selectivity using clause_selectivity */ 
</span>        <a href="clausesel.c.html#LN155"><span class='Ref_To_Local'>s2</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/cost.h.html#LN202"><span class='Ref_to_Proto'>clause_selectivity</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN98"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="clausesel.c.html#LN153"><span class='Ref_To_Local'>clause</span></a><span class='Delimiter'>, </span><a href="clausesel.c.html#LN100"><span class='Ref_to_Parameter'>varRelid</span></a><span class='Delimiter'>, </span><a href="clausesel.c.html#LN101"><span class='Ref_to_Parameter'>jointype</span></a><span class='Delimiter'>, </span><a href="clausesel.c.html#LN102"><span class='Ref_to_Parameter'>sjinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Check for being passed a RestrictInfo. 
         * 
         * If it's a pseudoconstant RestrictInfo, then s2 is either 1.0 or 
         * 0.0; just use that rather than looking for range pairs. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN153"><span class='Ref_To_Local'>clause</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="clausesel.c.html#LN154"><span class='Ref_To_Local'>rinfo</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="clausesel.c.html#LN153"><span class='Ref_To_Local'>clause</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="clausesel.c.html#LN154"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1754"><span class='Ref_to_Member'>pseudoconstant</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="clausesel.c.html#LN104"><span class='Ref_To_Local'>s1</span></a> <span class='Operator'>= </span><a href="clausesel.c.html#LN104"><span class='Ref_To_Local'>s1</span></a> <span class='Operator'>* </span><a href="clausesel.c.html#LN155"><span class='Ref_To_Local'>s2</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="clausesel.c.html#LN153"><span class='Ref_To_Local'>clause</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="clausesel.c.html#LN154"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1746"><span class='Ref_to_Member'>clause</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="clausesel.c.html#LN154"><span class='Ref_To_Local'>rinfo</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * See if it looks like a restriction clause with a pseudoconstant on 
         * one side.  (Anything more complicated than that might not behave in 
         * the simple way we are expecting.)  Most of the tests here can be 
         * done more efficiently with rinfo than without. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/optimizer/clauses.h.html#LN19"><span class='Ref_to_Macro'>is_opclause</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN153"><span class='Ref_To_Local'>clause</span></a><span class='Parentheses'>)</span> <span class='Operator'>&& </span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(((</span><a href="../../../include/nodes/primnodes.h.html#LN491"><span class='Ref_to_Struct'>OpExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="clausesel.c.html#LN153"><span class='Ref_To_Local'>clause</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>args<span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Number'>2</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><a name="LN196"></a>            <a href="../../../include/nodes/primnodes.h.html#LN491"><span class='Ref_to_Struct'>OpExpr</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>expr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN491"><span class='Ref_to_Struct'>OpExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="clausesel.c.html#LN153"><span class='Ref_To_Local'>clause</span></a><span class='Delimiter'>; 
</span><a name="LN197"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>varonleft</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span><a name="LN198"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>ok</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="clausesel.c.html#LN154"><span class='Ref_To_Local'>rinfo</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="clausesel.c.html#LN198"><span class='Ref_To_Local'>ok</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/bitmapset.h.html#LN84"><span class='Ref_to_Proto'>bms_membership</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN154"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1761"><span class='Ref_to_Member'>clause_relids</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../../include/nodes/bitmapset.h.html#LN56"><span class='Ref_to_EnumConst'>BMS_SINGLETON</span></a><span class='Parentheses'>)</span> <span class='Operator'>&& 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/optimizer/clauses.h.html#LN73"><span class='Ref_to_Proto'>is_pseudo_constant_clause_relids</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN115"><span class='Ref_to_Macro'>lsecond</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN196"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN500"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                      <a href="clausesel.c.html#LN154"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1774"><span class='Ref_to_Member'>right_relids</span></a><span class='Parentheses'>)</span> <span class='Operator'>|| 
</span>                     <span class='Parentheses'>(</span><a href="clausesel.c.html#LN197"><span class='Ref_To_Local'>varonleft</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                      <a href="../../../include/optimizer/clauses.h.html#LN73"><span class='Ref_to_Proto'>is_pseudo_constant_clause_relids</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN196"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN500"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                       <a href="clausesel.c.html#LN154"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1773"><span class='Ref_to_Member'>left_relids</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="clausesel.c.html#LN198"><span class='Ref_To_Local'>ok</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/optimizer/clauses.h.html#LN75"><span class='Ref_to_Proto'>NumRelids</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN153"><span class='Ref_To_Local'>clause</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span> <span class='Operator'>&& 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/optimizer/clauses.h.html#LN72"><span class='Ref_to_Proto'>is_pseudo_constant_clause</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN115"><span class='Ref_to_Macro'>lsecond</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN196"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN500"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>))</span> <span class='Operator'>|| 
</span>                     <span class='Parentheses'>(</span><a href="clausesel.c.html#LN197"><span class='Ref_To_Local'>varonleft</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                      <a href="../../../include/optimizer/clauses.h.html#LN72"><span class='Ref_to_Proto'>is_pseudo_constant_clause</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN196"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN500"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="clausesel.c.html#LN198"><span class='Ref_To_Local'>ok</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * If it's not a "&LT;" or "&GT;" operator, just merge the 
                 * selectivity in generically.  But if it's the right oprrest, 
                 * add the clause to rqlist for later processing. 
                 */ 
</span>                <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="../../../include/utils/lsyscache.h.html#LN108"><span class='Ref_to_Proto'>get_oprrest</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN196"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN494"><span class='Ref_to_Member'>opno</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Control'>case</span> F_SCALARLTSEL<span class='Operator'>: 
</span>                        <a href="clausesel.c.html#LN41"><span class='Ref_to_Proto'>addRangeClause</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="clausesel.c.html#LN107"><span class='Ref_To_Local'>rqlist</span></a><span class='Delimiter'>, </span><a href="clausesel.c.html#LN153"><span class='Ref_To_Local'>clause</span></a><span class='Delimiter'>, 
</span>                                       <a href="clausesel.c.html#LN197"><span class='Ref_To_Local'>varonleft</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="clausesel.c.html#LN155"><span class='Ref_To_Local'>s2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Control'>case</span> F_SCALARGTSEL<span class='Operator'>: 
</span>                        <a href="clausesel.c.html#LN41"><span class='Ref_to_Proto'>addRangeClause</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="clausesel.c.html#LN107"><span class='Ref_To_Local'>rqlist</span></a><span class='Delimiter'>, </span><a href="clausesel.c.html#LN153"><span class='Ref_To_Local'>clause</span></a><span class='Delimiter'>, 
</span>                                       <a href="clausesel.c.html#LN197"><span class='Ref_To_Local'>varonleft</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="clausesel.c.html#LN155"><span class='Ref_To_Local'>s2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Control'>default</span><span class='Operator'>: 
</span>                        <span class='Comment_Multi_Line'>/* Just merge the selectivity in generically */ 
</span>                        <a href="clausesel.c.html#LN104"><span class='Ref_To_Local'>s1</span></a> <span class='Operator'>= </span><a href="clausesel.c.html#LN104"><span class='Ref_To_Local'>s1</span></a> <span class='Operator'>* </span><a href="clausesel.c.html#LN155"><span class='Ref_To_Local'>s2</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>continue</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* drop to loop bottom */ 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if ok &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if is_opclause(clause)&&... &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* Not the right form, so treat it generically. */ 
</span>        <a href="clausesel.c.html#LN104"><span class='Ref_To_Local'>s1</span></a> <span class='Operator'>= </span><a href="clausesel.c.html#LN104"><span class='Ref_To_Local'>s1</span></a> <span class='Operator'>* </span><a href="clausesel.c.html#LN155"><span class='Ref_To_Local'>s2</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now scan the rangequery pair list. 
     */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="clausesel.c.html#LN107"><span class='Ref_To_Local'>rqlist</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN252"></a>        <a href="clausesel.c.html#LN31"><span class='Ref_to_Struct'>RangeQueryClause</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rqnext</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="clausesel.c.html#LN107"><span class='Ref_To_Local'>rqlist</span></a><span class='Operator'>-&GT;</span><a href="clausesel.c.html#LN35"><span class='Ref_to_Member'>have_lobound</span></a> <span class='Operator'>&& </span><a href="clausesel.c.html#LN107"><span class='Ref_To_Local'>rqlist</span></a><span class='Operator'>-&GT;</span><a href="clausesel.c.html#LN36"><span class='Ref_to_Member'>have_hibound</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Successfully matched a pair of range clauses */ 
</span><a name="LN257"></a>            <a href="../../../include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a> <span class='Declare_Local'>s2</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Exact equality to the default value probably means the 
             * selectivity function punted.  This is not airtight but should 
             * be good enough. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="clausesel.c.html#LN107"><span class='Ref_To_Local'>rqlist</span></a><span class='Operator'>-&GT;</span><a href="clausesel.c.html#LN38"><span class='Ref_to_Member'>hibound</span></a> <span class='Operator'>== </span><a href="../../../include/utils/selfuncs.h.html#LN36"><span class='Ref_to_Const'>DEFAULT_INEQ_SEL</span></a> <span class='Operator'>|| 
</span>                <a href="clausesel.c.html#LN107"><span class='Ref_To_Local'>rqlist</span></a><span class='Operator'>-&GT;</span><a href="clausesel.c.html#LN37"><span class='Ref_to_Member'>lobound</span></a> <span class='Operator'>== </span><a href="../../../include/utils/selfuncs.h.html#LN36"><span class='Ref_to_Const'>DEFAULT_INEQ_SEL</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="clausesel.c.html#LN257"><span class='Ref_To_Local'>s2</span></a> <span class='Operator'>= </span><a href="../../../include/utils/selfuncs.h.html#LN39"><span class='Ref_to_Const'>DEFAULT_RANGE_INEQ_SEL</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="clausesel.c.html#LN257"><span class='Ref_To_Local'>s2</span></a> <span class='Operator'>= </span><a href="clausesel.c.html#LN107"><span class='Ref_To_Local'>rqlist</span></a><span class='Operator'>-&GT;</span><a href="clausesel.c.html#LN38"><span class='Ref_to_Member'>hibound</span></a> <span class='Operator'>+ </span><a href="clausesel.c.html#LN107"><span class='Ref_To_Local'>rqlist</span></a><span class='Operator'>-&GT;</span><a href="clausesel.c.html#LN37"><span class='Ref_to_Member'>lobound</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Adjust for double-exclusion of NULLs */ 
</span>                <a href="clausesel.c.html#LN257"><span class='Ref_To_Local'>s2</span></a> <span class='Operator'>+= </span><a href="../../../include/utils/selfuncs.h.html#LN188"><span class='Ref_to_Proto'>nulltestsel</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN98"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1172"><span class='Ref_to_EnumConst'>IS_NULL</span></a><span class='Delimiter'>, </span><a href="clausesel.c.html#LN107"><span class='Ref_To_Local'>rqlist</span></a><span class='Operator'>-&GT;</span><a href="clausesel.c.html#LN34"><span class='Ref_to_Member'>var</span></a><span class='Delimiter'>, 
</span>                                  <a href="clausesel.c.html#LN100"><span class='Ref_to_Parameter'>varRelid</span></a><span class='Delimiter'>, </span><a href="clausesel.c.html#LN101"><span class='Ref_to_Parameter'>jointype</span></a><span class='Delimiter'>, </span><a href="clausesel.c.html#LN102"><span class='Ref_to_Parameter'>sjinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * A zero or slightly negative s2 should be converted into a 
                 * small positive value; we probably are dealing with a very 
                 * tight range and got a bogus result due to roundoff errors. 
                 * However, if s2 is very negative, then we probably have 
                 * default selectivity estimates on one or both sides of the 
                 * range that we failed to recognize above for some reason. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="clausesel.c.html#LN257"><span class='Ref_To_Local'>s2</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="clausesel.c.html#LN257"><span class='Ref_To_Local'>s2</span></a> <span class='Operator'>&LT; -</span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>01</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* 
                         * No data available --- use a default estimate that 
                         * is small, but not real small. 
                         */ 
</span>                        <a href="clausesel.c.html#LN257"><span class='Ref_To_Local'>s2</span></a> <span class='Operator'>= </span><a href="../../../include/utils/selfuncs.h.html#LN39"><span class='Ref_to_Const'>DEFAULT_RANGE_INEQ_SEL</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* 
                         * It's just roundoff error; use a small positive 
                         * value 
                         */ 
</span>                        <a href="clausesel.c.html#LN257"><span class='Ref_To_Local'>s2</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0e</span><span class='Operator'>-</span><span class='Number'>10</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
            <span class='Comment_Multi_Line'>/* Merge in the selectivity of the pair of clauses */ 
</span>            <a href="clausesel.c.html#LN104"><span class='Ref_To_Local'>s1</span></a> <span class='Operator'>*= </span><a href="clausesel.c.html#LN257"><span class='Ref_To_Local'>s2</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if rqlist-&GT;have_lobound&... &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Only found one of a pair, merge it in generically */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="clausesel.c.html#LN107"><span class='Ref_To_Local'>rqlist</span></a><span class='Operator'>-&GT;</span><a href="clausesel.c.html#LN35"><span class='Ref_to_Member'>have_lobound</span></a><span class='Parentheses'>) 
</span>                <a href="clausesel.c.html#LN104"><span class='Ref_To_Local'>s1</span></a> <span class='Operator'>*= </span><a href="clausesel.c.html#LN107"><span class='Ref_To_Local'>rqlist</span></a><span class='Operator'>-&GT;</span><a href="clausesel.c.html#LN37"><span class='Ref_to_Member'>lobound</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="clausesel.c.html#LN104"><span class='Ref_To_Local'>s1</span></a> <span class='Operator'>*= </span><a href="clausesel.c.html#LN107"><span class='Ref_To_Local'>rqlist</span></a><span class='Operator'>-&GT;</span><a href="clausesel.c.html#LN38"><span class='Ref_to_Member'>hibound</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* release storage and advance */ 
</span>        <a href="clausesel.c.html#LN252"><span class='Ref_To_Local'>rqnext</span></a> <span class='Operator'>= </span><a href="clausesel.c.html#LN107"><span class='Ref_To_Local'>rqlist</span></a><span class='Operator'>-&GT;</span><a href="clausesel.c.html#LN33"><span class='Ref_to_Member'>next</span></a><span class='Delimiter'>; 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN107"><span class='Ref_To_Local'>rqlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="clausesel.c.html#LN107"><span class='Ref_To_Local'>rqlist</span></a> <span class='Operator'>= </span><a href="clausesel.c.html#LN252"><span class='Ref_To_Local'>rqnext</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while rqlist!=NULL &raquo; </span> 
 
    <span class='Control'>return</span> <a href="clausesel.c.html#LN104"><span class='Ref_To_Local'>s1</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end clauselist_selectivity &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * addRangeClause --- add a new range clause for clauselist_selectivity 
 * 
 * Here is where we try to match up pairs of range-query clauses 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN331"></a><span class='Declare_Function'>addRangeClause</span><span class='Parentheses'>(</span><a href="clausesel.c.html#LN31"><span class='Ref_to_Struct'>RangeQueryClause</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>rqlist</span><span class='Delimiter'>, </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>clause</span><span class='Delimiter'>, 
</span><a name="LN332"></a>               <span class='Keyword'>bool </span><span class='Declare_Parameter'>varonleft</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isLTsel</span><span class='Delimiter'>, </span><a href="../../../include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a> <span class='Declare_Parameter'>s2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN334"></a>    <a href="clausesel.c.html#LN31"><span class='Ref_to_Struct'>RangeQueryClause</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rqelem</span><span class='Delimiter'>; 
</span><a name="LN335"></a>    <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>var</span><span class='Delimiter'>; 
</span><a name="LN336"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>is_lobound</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="clausesel.c.html#LN332"><span class='Ref_to_Parameter'>varonleft</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="clausesel.c.html#LN335"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/clauses.h.html#LN32"><span class='Ref_to_Proto'>get_leftop</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="clausesel.c.html#LN331"><span class='Ref_to_Parameter'>clause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="clausesel.c.html#LN336"><span class='Ref_To_Local'>is_lobound</span></a> <span class='Operator'>= !</span><a href="clausesel.c.html#LN332"><span class='Ref_to_Parameter'>isLTsel</span></a><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* x &LT; something is high bound */ 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="clausesel.c.html#LN335"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/clauses.h.html#LN33"><span class='Ref_to_Proto'>get_rightop</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="clausesel.c.html#LN331"><span class='Ref_to_Parameter'>clause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="clausesel.c.html#LN336"><span class='Ref_To_Local'>is_lobound</span></a> <span class='Operator'>= </span><a href="clausesel.c.html#LN332"><span class='Ref_to_Parameter'>isLTsel</span></a><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* something &LT; x is low bound */ 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="clausesel.c.html#LN334"><span class='Ref_To_Local'>rqelem</span></a> <span class='Operator'>= *</span><a href="clausesel.c.html#LN331"><span class='Ref_to_Parameter'>rqlist</span></a><span class='Delimiter'>; </span><a href="clausesel.c.html#LN334"><span class='Ref_To_Local'>rqelem</span></a><span class='Delimiter'>; </span><a href="clausesel.c.html#LN334"><span class='Ref_To_Local'>rqelem</span></a> <span class='Operator'>= </span><a href="clausesel.c.html#LN334"><span class='Ref_To_Local'>rqelem</span></a><span class='Operator'>-&GT;</span><a href="clausesel.c.html#LN33"><span class='Ref_to_Member'>next</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * We use full equal() here because the "var" might be a function of 
         * one or more attributes of the same relation... 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/nodes.h.html#LN626"><span class='Ref_to_Proto'>equal</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN335"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><a href="clausesel.c.html#LN334"><span class='Ref_To_Local'>rqelem</span></a><span class='Operator'>-&GT;</span><a href="clausesel.c.html#LN34"><span class='Ref_to_Member'>var</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Found the right group to put this clause in */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="clausesel.c.html#LN336"><span class='Ref_To_Local'>is_lobound</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="clausesel.c.html#LN334"><span class='Ref_To_Local'>rqelem</span></a><span class='Operator'>-&GT;</span><a href="clausesel.c.html#LN35"><span class='Ref_to_Member'>have_lobound</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="clausesel.c.html#LN334"><span class='Ref_To_Local'>rqelem</span></a><span class='Operator'>-&GT;</span><a href="clausesel.c.html#LN35"><span class='Ref_to_Member'>have_lobound</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="clausesel.c.html#LN334"><span class='Ref_To_Local'>rqelem</span></a><span class='Operator'>-&GT;</span><a href="clausesel.c.html#LN37"><span class='Ref_to_Member'>lobound</span></a> <span class='Operator'>= </span><a href="clausesel.c.html#LN332"><span class='Ref_to_Parameter'>s2</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span> 
                <span class='Comment_Multi_Line'>/*------ 
                 * We have found two similar clauses, such as 
                 * x &LT; y AND x &LT; z. 
                 * Keep only the more restrictive one. 
                 *------ 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="clausesel.c.html#LN334"><span class='Ref_To_Local'>rqelem</span></a><span class='Operator'>-&GT;</span><a href="clausesel.c.html#LN37"><span class='Ref_to_Member'>lobound</span></a> <span class='Operator'>&GT; </span><a href="clausesel.c.html#LN332"><span class='Ref_to_Parameter'>s2</span></a><span class='Parentheses'>) 
</span>                    <a href="clausesel.c.html#LN334"><span class='Ref_To_Local'>rqelem</span></a><span class='Operator'>-&GT;</span><a href="clausesel.c.html#LN37"><span class='Ref_to_Member'>lobound</span></a> <span class='Operator'>= </span><a href="clausesel.c.html#LN332"><span class='Ref_to_Parameter'>s2</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if is_lobound &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="clausesel.c.html#LN334"><span class='Ref_To_Local'>rqelem</span></a><span class='Operator'>-&GT;</span><a href="clausesel.c.html#LN36"><span class='Ref_to_Member'>have_hibound</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="clausesel.c.html#LN334"><span class='Ref_To_Local'>rqelem</span></a><span class='Operator'>-&GT;</span><a href="clausesel.c.html#LN36"><span class='Ref_to_Member'>have_hibound</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="clausesel.c.html#LN334"><span class='Ref_To_Local'>rqelem</span></a><span class='Operator'>-&GT;</span><a href="clausesel.c.html#LN38"><span class='Ref_to_Member'>hibound</span></a> <span class='Operator'>= </span><a href="clausesel.c.html#LN332"><span class='Ref_to_Parameter'>s2</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span> 
                <span class='Comment_Multi_Line'>/*------ 
                 * We have found two similar clauses, such as 
                 * x &GT; y AND x &GT; z. 
                 * Keep only the more restrictive one. 
                 *------ 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="clausesel.c.html#LN334"><span class='Ref_To_Local'>rqelem</span></a><span class='Operator'>-&GT;</span><a href="clausesel.c.html#LN38"><span class='Ref_to_Member'>hibound</span></a> <span class='Operator'>&GT; </span><a href="clausesel.c.html#LN332"><span class='Ref_to_Parameter'>s2</span></a><span class='Parentheses'>) 
</span>                    <a href="clausesel.c.html#LN334"><span class='Ref_To_Local'>rqelem</span></a><span class='Operator'>-&GT;</span><a href="clausesel.c.html#LN38"><span class='Ref_to_Member'>hibound</span></a> <span class='Operator'>= </span><a href="clausesel.c.html#LN332"><span class='Ref_to_Parameter'>s2</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for rqelem=*rqlist;rqelem... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* No matching var found, so make a new clause-pair data structure */ 
</span>    <a href="clausesel.c.html#LN334"><span class='Ref_To_Local'>rqelem</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="clausesel.c.html#LN31"><span class='Ref_to_Struct'>RangeQueryClause</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="clausesel.c.html#LN31"><span class='Ref_to_Struct'>RangeQueryClause</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="clausesel.c.html#LN334"><span class='Ref_To_Local'>rqelem</span></a><span class='Operator'>-&GT;</span><a href="clausesel.c.html#LN34"><span class='Ref_to_Member'>var</span></a> <span class='Operator'>= </span><a href="clausesel.c.html#LN335"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="clausesel.c.html#LN336"><span class='Ref_To_Local'>is_lobound</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="clausesel.c.html#LN334"><span class='Ref_To_Local'>rqelem</span></a><span class='Operator'>-&GT;</span><a href="clausesel.c.html#LN35"><span class='Ref_to_Member'>have_lobound</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="clausesel.c.html#LN334"><span class='Ref_To_Local'>rqelem</span></a><span class='Operator'>-&GT;</span><a href="clausesel.c.html#LN36"><span class='Ref_to_Member'>have_hibound</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="clausesel.c.html#LN334"><span class='Ref_To_Local'>rqelem</span></a><span class='Operator'>-&GT;</span><a href="clausesel.c.html#LN37"><span class='Ref_to_Member'>lobound</span></a> <span class='Operator'>= </span><a href="clausesel.c.html#LN332"><span class='Ref_to_Parameter'>s2</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="clausesel.c.html#LN334"><span class='Ref_To_Local'>rqelem</span></a><span class='Operator'>-&GT;</span><a href="clausesel.c.html#LN35"><span class='Ref_to_Member'>have_lobound</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="clausesel.c.html#LN334"><span class='Ref_To_Local'>rqelem</span></a><span class='Operator'>-&GT;</span><a href="clausesel.c.html#LN36"><span class='Ref_to_Member'>have_hibound</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="clausesel.c.html#LN334"><span class='Ref_To_Local'>rqelem</span></a><span class='Operator'>-&GT;</span><a href="clausesel.c.html#LN38"><span class='Ref_to_Member'>hibound</span></a> <span class='Operator'>= </span><a href="clausesel.c.html#LN332"><span class='Ref_to_Parameter'>s2</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="clausesel.c.html#LN334"><span class='Ref_To_Local'>rqelem</span></a><span class='Operator'>-&GT;</span><a href="clausesel.c.html#LN33"><span class='Ref_to_Member'>next</span></a> <span class='Operator'>= *</span><a href="clausesel.c.html#LN331"><span class='Ref_to_Parameter'>rqlist</span></a><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="clausesel.c.html#LN331"><span class='Ref_to_Parameter'>rqlist</span></a> <span class='Operator'>= </span><a href="clausesel.c.html#LN334"><span class='Ref_To_Local'>rqelem</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end addRangeClause &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * find_single_rel_for_clauses 
 *      Examine each clause in 'clauses' and determine if all clauses 
 *      reference only a single relation.  If so return that relation, 
 *      otherwise return NULL. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>* 
</span><a name="LN427"></a><span class='Declare_Function'>find_single_rel_for_clauses</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>clauses</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN429"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>lastrelid</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN430"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN430"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="clausesel.c.html#LN427"><span class='Ref_to_Parameter'>clauses</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN434"></a>        <a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rinfo</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN430"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN435"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>relid</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If we have a list of bare clauses rather than RestrictInfos, we 
         * could pull out their relids the hard way with pull_varnos(). 
         * However, currently the extended-stats machinery won't do anything 
         * with non-RestrictInfo clauses anyway, so there's no point in 
         * spending extra cycles; just fail if that's what we have. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN434"><span class='Ref_To_Local'>rinfo</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/bitmapset.h.html#LN85"><span class='Ref_to_Proto'>bms_is_empty</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN434"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1761"><span class='Ref_to_Member'>clause_relids</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* we can ignore variable-free clauses */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/bitmapset.h.html#LN80"><span class='Ref_to_Proto'>bms_get_singleton_member</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN434"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1761"><span class='Ref_to_Member'>clause_relids</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="clausesel.c.html#LN435"><span class='Ref_To_Local'>relid</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* multiple relations in this clause */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="clausesel.c.html#LN429"><span class='Ref_To_Local'>lastrelid</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="clausesel.c.html#LN429"><span class='Ref_To_Local'>lastrelid</span></a> <span class='Operator'>= </span><a href="clausesel.c.html#LN435"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* first clause referencing a relation */ 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="clausesel.c.html#LN435"><span class='Ref_To_Local'>relid</span></a> <span class='Operator'>!= </span><a href="clausesel.c.html#LN429"><span class='Ref_To_Local'>lastrelid</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* relation not same as last one */ 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="clausesel.c.html#LN429"><span class='Ref_To_Local'>lastrelid</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../util/relnode.c.html#LN241"><span class='Ref_to_Func'>find_base_rel</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN427"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="clausesel.c.html#LN429"><span class='Ref_To_Local'>lastrelid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>                <span class='Comment_Single_Line'>/* no clauses */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end find_single_rel_for_clauses &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * bms_is_subset_singleton 
 * 
 * Same result as bms_is_subset(s, bms_make_singleton(x)), 
 * but a little faster and doesn't leak memory. 
 * 
 * Is this of use anywhere else?  If so move to bitmapset.c ... 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN472"></a><span class='Declare_Function'>bms_is_subset_singleton</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>s</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>x</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/bitmapset.h.html#LN84"><span class='Ref_to_Proto'>bms_membership</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN472"><span class='Ref_to_Parameter'>s</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/bitmapset.h.html#LN55"><span class='Ref_to_EnumConst'>BMS_EMPTY_SET</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/bitmapset.h.html#LN56"><span class='Ref_to_EnumConst'>BMS_SINGLETON</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <a href="../../../include/nodes/bitmapset.h.html#LN75"><span class='Ref_to_Proto'>bms_is_member</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN472"><span class='Ref_to_Parameter'>x</span></a><span class='Delimiter'>, </span><a href="clausesel.c.html#LN472"><span class='Ref_to_Parameter'>s</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/bitmapset.h.html#LN57"><span class='Ref_to_EnumConst'>BMS_MULTIPLE</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Comment_Multi_Line'>/* can't get here... */ 
</span>    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * treat_as_join_clause - 
 *    Decide whether an operator clause is to be handled by the 
 *    restriction or join estimator.  Subroutine for clause_selectivity(). 
 */ 
</span><span class='Keyword'>static inline bool 
</span><a name="LN493"></a><span class='Declare_Function'>treat_as_join_clause</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>clause</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rinfo</span><span class='Delimiter'>, 
</span><a name="LN494"></a>                     <span class='Keyword'>int </span><span class='Declare_Parameter'>varRelid</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN1913"><span class='Ref_to_Struct'>SpecialJoinInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>sjinfo</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="clausesel.c.html#LN494"><span class='Ref_to_Parameter'>varRelid</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Caller is forcing restriction mode (eg, because we are examining an 
         * inner indexscan qual). 
         */ 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="clausesel.c.html#LN494"><span class='Ref_to_Parameter'>sjinfo</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * It must be a restriction clause, since it's being evaluated at a 
         * scan node. 
         */ 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Otherwise, it's a join if there's more than one relation used. We 
         * can optimize this calculation if an rinfo was passed. 
         * 
         * XXX  Since we know the clause is being evaluated at a join, the 
         * only way it could be single-relation is if it was delayed by outer 
         * joins.  Although we can make use of the restriction qual estimators 
         * anyway, it seems likely that we ought to account for the 
         * probability of injected nulls somehow. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="clausesel.c.html#LN493"><span class='Ref_to_Parameter'>rinfo</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/bitmapset.h.html#LN84"><span class='Ref_to_Proto'>bms_membership</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN493"><span class='Ref_to_Parameter'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1761"><span class='Ref_to_Member'>clause_relids</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../../include/nodes/bitmapset.h.html#LN57"><span class='Ref_to_EnumConst'>BMS_MULTIPLE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/optimizer/clauses.h.html#LN75"><span class='Ref_to_Proto'>NumRelids</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN493"><span class='Ref_to_Parameter'>clause</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end treat_as_join_clause &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * clause_selectivity - 
 *    Compute the selectivity of a general boolean expression clause. 
 * 
 * The clause can be either a RestrictInfo or a plain expression.  If it's 
 * a RestrictInfo, we try to cache the selectivity for possible re-use, 
 * so passing RestrictInfos is preferred. 
 * 
 * varRelid is either 0 or a rangetable index. 
 * 
 * When varRelid is not 0, only variables belonging to that relation are 
 * considered in computing selectivity; other vars are treated as constants 
 * of unknown values.  This is appropriate for estimating the selectivity of 
 * a join clause that is being used as a restriction clause in a scan of a 
 * nestloop join's inner relation --- varRelid should then be the ID of the 
 * inner relation. 
 * 
 * When varRelid is 0, all variables are treated as variables.  This 
 * is appropriate for ordinary join clauses and restriction clauses. 
 * 
 * jointype is the join type, if the clause is a join clause.  Pass JOIN_INNER 
 * if the clause isn't a join clause. 
 * 
 * sjinfo is NULL for a non-join clause, otherwise it provides additional 
 * context information about the join being performed.  There are some 
 * special cases: 
 *  1. For a special (not INNER) join, sjinfo is always a member of 
 *     root-&GT;join_info_list. 
 *  2. For an INNER join, sjinfo is just a transient struct, and only the 
 *     relids and jointype fields in it can be trusted. 
 * It is possible for jointype to be different from sjinfo-&GT;jointype. 
 * This indicates we are considering a variant join: either with 
 * the LHS and RHS switched, or with one input unique-ified. 
 * 
 * Note: when passing nonzero varRelid, it's normally appropriate to set 
 * jointype == JOIN_INNER, sjinfo == NULL, even if the clause is really a 
 * join clause; because we aren't treating it as a join clause. 
 */ 
</span><a href="../../../include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a> 
<a name="LN571"></a><span class='Declare_Function'>clause_selectivity</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN572"></a>                   <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>clause</span><span class='Delimiter'>, 
</span><a name="LN573"></a>                   <span class='Keyword'>int </span><span class='Declare_Parameter'>varRelid</span><span class='Delimiter'>, 
</span><a name="LN574"></a>                   <a href="../../../include/nodes/nodes.h.html#LN671"><span class='Ref_to_Enum'>JoinType</span></a> <span class='Declare_Parameter'>jointype</span><span class='Delimiter'>, 
</span><a name="LN575"></a>                   <a href="../../../include/nodes/relation.h.html#LN1913"><span class='Ref_to_Struct'>SpecialJoinInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>sjinfo</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN577"></a>    <a href="../../../include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a> <span class='Declare_Local'>s1</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>5</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* default for any unhandled clause type */ 
</span><a name="LN578"></a>    <a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rinfo</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN579"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>cacheable</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="clausesel.c.html#LN572"><span class='Ref_to_Parameter'>clause</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span>         <span class='Comment_Single_Line'>/* can this still happen? */ 
</span>        <span class='Control'>return</span> <a href="clausesel.c.html#LN577"><span class='Ref_To_Local'>s1</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN572"><span class='Ref_to_Parameter'>clause</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="clausesel.c.html#LN578"><span class='Ref_To_Local'>rinfo</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="clausesel.c.html#LN572"><span class='Ref_to_Parameter'>clause</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If the clause is marked pseudoconstant, then it will be used as a 
         * gating qual and should not affect selectivity estimates; hence 
         * return 1.0.  The only exception is that a constant FALSE may be 
         * taken as having selectivity 0.0, since it will surely mean no rows 
         * out of the plan.  This case is simple enough that we need not 
         * bother caching the result. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="clausesel.c.html#LN578"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1754"><span class='Ref_to_Member'>pseudoconstant</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN578"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1746"><span class='Ref_to_Member'>clause</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a><span class='Parentheses'>) </span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If the clause is marked redundant, always return 1.0. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="clausesel.c.html#LN578"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1784"><span class='Ref_to_Member'>norm_selec</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a><span class='Parentheses'>) </span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If possible, cache the result of the selectivity calculation for 
         * the clause.  We can cache if varRelid is zero or the clause 
         * contains only vars of that relid --- otherwise varRelid will affect 
         * the result, so mustn't cache.  Outer join quals might be examined 
         * with either their join's actual jointype or JOIN_INNER, so we need 
         * two cache variables to remember both cases.  Note: we assume the 
         * result won't change if we are switching the input relations or 
         * considering a unique-ified case, so we only need one cache variable 
         * for all non-JOIN_INNER cases. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="clausesel.c.html#LN573"><span class='Ref_to_Parameter'>varRelid</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            <a href="clausesel.c.html#LN471"><span class='Ref_to_Func'>bms_is_subset_singleton</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN578"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1761"><span class='Ref_to_Member'>clause_relids</span></a><span class='Delimiter'>, </span><a href="clausesel.c.html#LN573"><span class='Ref_to_Parameter'>varRelid</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Cacheable --- do we already have the result? */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="clausesel.c.html#LN574"><span class='Ref_to_Parameter'>jointype</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/nodes.h.html#LN677"><span class='Ref_to_EnumConst'>JOIN_INNER</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="clausesel.c.html#LN578"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1784"><span class='Ref_to_Member'>norm_selec</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <span class='Control'>return</span> <a href="clausesel.c.html#LN578"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1784"><span class='Ref_to_Member'>norm_selec</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="clausesel.c.html#LN578"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1787"><span class='Ref_to_Member'>outer_selec</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <span class='Control'>return</span> <a href="clausesel.c.html#LN578"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1787"><span class='Ref_to_Member'>outer_selec</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="clausesel.c.html#LN579"><span class='Ref_To_Local'>cacheable</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Proceed with examination of contained clause.  If the clause is an 
         * OR-clause, we want to look at the variant with sub-RestrictInfos, 
         * so that per-subclause selectivities can be cached. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="clausesel.c.html#LN578"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1777"><span class='Ref_to_Member'>orclause</span></a><span class='Parentheses'>) 
</span>            <a href="clausesel.c.html#LN572"><span class='Ref_to_Parameter'>clause</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="clausesel.c.html#LN578"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1777"><span class='Ref_to_Member'>orclause</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="clausesel.c.html#LN572"><span class='Ref_to_Parameter'>clause</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="clausesel.c.html#LN578"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1746"><span class='Ref_to_Member'>clause</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IsA(clause,RestrictIn... &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN572"><span class='Ref_to_Parameter'>clause</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN649"></a>        <a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>var</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="clausesel.c.html#LN572"><span class='Ref_to_Parameter'>clause</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We probably shouldn't ever see an uplevel Var here, but if we do, 
         * return the default selectivity... 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="clausesel.c.html#LN649"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN172"><span class='Ref_to_Member'>varlevelsup</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>            <span class='Parentheses'>(</span><a href="clausesel.c.html#LN573"><span class='Ref_to_Parameter'>varRelid</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="clausesel.c.html#LN573"><span class='Ref_to_Parameter'>varRelid</span></a> <span class='Operator'>== </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="clausesel.c.html#LN649"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN165"><span class='Ref_to_Member'>varno</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Use the restriction selectivity function for a bool Var */ 
</span>            <a href="clausesel.c.html#LN577"><span class='Ref_To_Local'>s1</span></a> <span class='Operator'>= </span><a href="../../../include/utils/selfuncs.h.html#LN184"><span class='Ref_to_Proto'>boolvarsel</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN571"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="clausesel.c.html#LN649"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><a href="clausesel.c.html#LN573"><span class='Ref_to_Parameter'>varRelid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN572"><span class='Ref_to_Parameter'>clause</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* bool constant is pretty easy... */ 
</span><a name="LN665"></a>        <a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>con</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="clausesel.c.html#LN572"><span class='Ref_to_Parameter'>clause</span></a><span class='Delimiter'>; 
</span> 
        <a href="clausesel.c.html#LN577"><span class='Ref_To_Local'>s1</span></a> <span class='Operator'>= </span><a href="clausesel.c.html#LN665"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN196"><span class='Ref_to_Member'>constisnull</span></a> <span class='Operator'>? </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>: 
</span>            <a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN665"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN195"><span class='Ref_to_Member'>constvalue</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>: </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN572"><span class='Ref_to_Parameter'>clause</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN240"><span class='Ref_to_Struct'>Param</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* see if we can replace the Param */ 
</span><a name="LN673"></a>        <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>subst</span> <span class='Operator'>= </span><a href="../../../include/optimizer/clauses.h.html#LN82"><span class='Ref_to_Proto'>estimate_expression_value</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN571"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="clausesel.c.html#LN572"><span class='Ref_to_Parameter'>clause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN673"><span class='Ref_To_Local'>subst</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* bool constant is pretty easy... */ 
</span><a name="LN678"></a>            <a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>con</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="clausesel.c.html#LN673"><span class='Ref_To_Local'>subst</span></a><span class='Delimiter'>; 
</span> 
            <a href="clausesel.c.html#LN577"><span class='Ref_To_Local'>s1</span></a> <span class='Operator'>= </span><a href="clausesel.c.html#LN678"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN196"><span class='Ref_to_Member'>constisnull</span></a> <span class='Operator'>? </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>: 
</span>                <a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN678"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN195"><span class='Ref_to_Member'>constvalue</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>: </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* XXX any way to do better than default? */ 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/optimizer/clauses.h.html#LN35"><span class='Ref_to_Proto'>not_clause</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN572"><span class='Ref_to_Parameter'>clause</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* inverse of the selectivity of the underlying clause */ 
</span>        <a href="clausesel.c.html#LN577"><span class='Ref_To_Local'>s1</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>- </span><a href="../../../include/optimizer/cost.h.html#LN202"><span class='Ref_to_Proto'>clause_selectivity</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN571"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                  <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>)</span> <a href="../../../include/optimizer/clauses.h.html#LN37"><span class='Ref_to_Proto'>get_notclausearg</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="clausesel.c.html#LN572"><span class='Ref_to_Parameter'>clause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                      <a href="clausesel.c.html#LN573"><span class='Ref_to_Parameter'>varRelid</span></a><span class='Delimiter'>, 
</span>                                      <a href="clausesel.c.html#LN574"><span class='Ref_to_Parameter'>jointype</span></a><span class='Delimiter'>, 
</span>                                      <a href="clausesel.c.html#LN575"><span class='Ref_to_Parameter'>sjinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/optimizer/clauses.h.html#LN42"><span class='Ref_to_Proto'>and_clause</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN572"><span class='Ref_to_Parameter'>clause</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* share code with clauselist_selectivity() */ 
</span>        <a href="clausesel.c.html#LN577"><span class='Ref_To_Local'>s1</span></a> <span class='Operator'>= </span><a href="clausesel.c.html#LN97"><span class='Ref_to_Func'>clauselist_selectivity</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN571"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                    <span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN557"><span class='Ref_to_Struct'>BoolExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="clausesel.c.html#LN572"><span class='Ref_to_Parameter'>clause</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>args<span class='Delimiter'>, 
</span>                                    <a href="clausesel.c.html#LN573"><span class='Ref_to_Parameter'>varRelid</span></a><span class='Delimiter'>, 
</span>                                    <a href="clausesel.c.html#LN574"><span class='Ref_to_Parameter'>jointype</span></a><span class='Delimiter'>, 
</span>                                    <a href="clausesel.c.html#LN575"><span class='Ref_to_Parameter'>sjinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/optimizer/clauses.h.html#LN39"><span class='Ref_to_Proto'>or_clause</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN572"><span class='Ref_to_Parameter'>clause</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Selectivities for an OR clause are computed as s1+s2 - s1*s2 to 
         * account for the probable overlap of selected tuple sets. 
         * 
         * XXX is this too conservative? 
         */ 
</span><a name="LN714"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>arg</span><span class='Delimiter'>; 
</span> 
        <a href="clausesel.c.html#LN577"><span class='Ref_To_Local'>s1</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN714"><span class='Ref_To_Local'>arg</span></a><span class='Delimiter'>, </span><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN557"><span class='Ref_to_Struct'>BoolExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="clausesel.c.html#LN572"><span class='Ref_to_Parameter'>clause</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>args<span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><a name="LN719"></a>            <a href="../../../include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a> <span class='Declare_Local'>s2</span> <span class='Operator'>= </span><a href="../../../include/optimizer/cost.h.html#LN202"><span class='Ref_to_Proto'>clause_selectivity</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN571"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                                <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN714"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                <a href="clausesel.c.html#LN573"><span class='Ref_to_Parameter'>varRelid</span></a><span class='Delimiter'>, 
</span>                                                <a href="clausesel.c.html#LN574"><span class='Ref_to_Parameter'>jointype</span></a><span class='Delimiter'>, 
</span>                                                <a href="clausesel.c.html#LN575"><span class='Ref_to_Parameter'>sjinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="clausesel.c.html#LN577"><span class='Ref_To_Local'>s1</span></a> <span class='Operator'>= </span><a href="clausesel.c.html#LN577"><span class='Ref_To_Local'>s1</span></a> <span class='Operator'>+ </span><a href="clausesel.c.html#LN719"><span class='Ref_To_Local'>s2</span></a> <span class='Operator'>- </span><a href="clausesel.c.html#LN577"><span class='Ref_To_Local'>s1</span></a> <span class='Operator'>* </span><a href="clausesel.c.html#LN719"><span class='Ref_To_Local'>s2</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if or_clause(clause) &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/optimizer/clauses.h.html#LN19"><span class='Ref_to_Macro'>is_opclause</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN572"><span class='Ref_to_Parameter'>clause</span></a><span class='Parentheses'>) </span><span class='Operator'>|| </span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN572"><span class='Ref_to_Parameter'>clause</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN514"><span class='Ref_to_Typedef'>DistinctExpr</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN730"></a>        <a href="../../../include/nodes/primnodes.h.html#LN491"><span class='Ref_to_Struct'>OpExpr</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>opclause</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN491"><span class='Ref_to_Struct'>OpExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="clausesel.c.html#LN572"><span class='Ref_to_Parameter'>clause</span></a><span class='Delimiter'>; 
</span><a name="LN731"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>opno</span> <span class='Operator'>= </span><a href="clausesel.c.html#LN730"><span class='Ref_To_Local'>opclause</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN494"><span class='Ref_to_Member'>opno</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="clausesel.c.html#LN492"><span class='Ref_to_Func'>treat_as_join_clause</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN572"><span class='Ref_to_Parameter'>clause</span></a><span class='Delimiter'>, </span><a href="clausesel.c.html#LN578"><span class='Ref_To_Local'>rinfo</span></a><span class='Delimiter'>, </span><a href="clausesel.c.html#LN573"><span class='Ref_to_Parameter'>varRelid</span></a><span class='Delimiter'>, </span><a href="clausesel.c.html#LN575"><span class='Ref_to_Parameter'>sjinfo</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Estimate selectivity for a join clause. */ 
</span>            <a href="clausesel.c.html#LN577"><span class='Ref_To_Local'>s1</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/plancat.h.html#LN50"><span class='Ref_to_Proto'>join_selectivity</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN571"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="clausesel.c.html#LN731"><span class='Ref_To_Local'>opno</span></a><span class='Delimiter'>, 
</span>                                  <a href="clausesel.c.html#LN730"><span class='Ref_To_Local'>opclause</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN500"><span class='Ref_to_Member'>args</span></a><span class='Delimiter'>, 
</span>                                  <a href="clausesel.c.html#LN730"><span class='Ref_To_Local'>opclause</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN499"><span class='Ref_to_Member'>inputcollid</span></a><span class='Delimiter'>, 
</span>                                  <a href="clausesel.c.html#LN574"><span class='Ref_to_Parameter'>jointype</span></a><span class='Delimiter'>, 
</span>                                  <a href="clausesel.c.html#LN575"><span class='Ref_to_Parameter'>sjinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Estimate selectivity for a restriction clause. */ 
</span>            <a href="clausesel.c.html#LN577"><span class='Ref_To_Local'>s1</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/plancat.h.html#LN44"><span class='Ref_to_Proto'>restriction_selectivity</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN571"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="clausesel.c.html#LN731"><span class='Ref_To_Local'>opno</span></a><span class='Delimiter'>, 
</span>                                         <a href="clausesel.c.html#LN730"><span class='Ref_To_Local'>opclause</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN500"><span class='Ref_to_Member'>args</span></a><span class='Delimiter'>, 
</span>                                         <a href="clausesel.c.html#LN730"><span class='Ref_To_Local'>opclause</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN499"><span class='Ref_to_Member'>inputcollid</span></a><span class='Delimiter'>, 
</span>                                         <a href="clausesel.c.html#LN573"><span class='Ref_to_Parameter'>varRelid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * DistinctExpr has the same representation as OpExpr, but the 
         * contained operator is "=" not "&LT;&GT;", so we must negate the result. 
         * This estimation method doesn't give the right behavior for nulls, 
         * but it's better than doing nothing. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN572"><span class='Ref_to_Parameter'>clause</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN514"><span class='Ref_to_Typedef'>DistinctExpr</span></a><span class='Parentheses'>))</span> 
            <a href="clausesel.c.html#LN577"><span class='Ref_To_Local'>s1</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>- </span><a href="clausesel.c.html#LN577"><span class='Ref_To_Local'>s1</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if is_opclause(clause)||... &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN572"><span class='Ref_to_Parameter'>clause</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN534"><span class='Ref_to_Struct'>ScalarArrayOpExpr</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Use node specific selectivity calculation function */ 
</span>        <a href="clausesel.c.html#LN577"><span class='Ref_To_Local'>s1</span></a> <span class='Operator'>= </span><a href="../../../include/utils/selfuncs.h.html#LN191"><span class='Ref_to_Proto'>scalararraysel</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN571"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN534"><span class='Ref_to_Struct'>ScalarArrayOpExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="clausesel.c.html#LN572"><span class='Ref_to_Parameter'>clause</span></a><span class='Delimiter'>, 
</span>                            <a href="clausesel.c.html#LN492"><span class='Ref_to_Func'>treat_as_join_clause</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN572"><span class='Ref_to_Parameter'>clause</span></a><span class='Delimiter'>, </span><a href="clausesel.c.html#LN578"><span class='Ref_To_Local'>rinfo</span></a><span class='Delimiter'>, 
</span>                                                 <a href="clausesel.c.html#LN573"><span class='Ref_to_Parameter'>varRelid</span></a><span class='Delimiter'>, </span><a href="clausesel.c.html#LN575"><span class='Ref_to_Parameter'>sjinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="clausesel.c.html#LN573"><span class='Ref_to_Parameter'>varRelid</span></a><span class='Delimiter'>, 
</span>                            <a href="clausesel.c.html#LN574"><span class='Ref_to_Parameter'>jointype</span></a><span class='Delimiter'>, 
</span>                            <a href="clausesel.c.html#LN575"><span class='Ref_to_Parameter'>sjinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN572"><span class='Ref_to_Parameter'>clause</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1026"><span class='Ref_to_Struct'>RowCompareExpr</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Use node specific selectivity calculation function */ 
</span>        <a href="clausesel.c.html#LN577"><span class='Ref_To_Local'>s1</span></a> <span class='Operator'>= </span><a href="../../../include/utils/selfuncs.h.html#LN196"><span class='Ref_to_Proto'>rowcomparesel</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN571"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                           <span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1026"><span class='Ref_to_Struct'>RowCompareExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="clausesel.c.html#LN572"><span class='Ref_to_Parameter'>clause</span></a><span class='Delimiter'>, 
</span>                           <a href="clausesel.c.html#LN573"><span class='Ref_to_Parameter'>varRelid</span></a><span class='Delimiter'>, 
</span>                           <a href="clausesel.c.html#LN574"><span class='Ref_to_Parameter'>jointype</span></a><span class='Delimiter'>, 
</span>                           <a href="clausesel.c.html#LN575"><span class='Ref_to_Parameter'>sjinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN572"><span class='Ref_to_Parameter'>clause</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1175"><span class='Ref_to_Struct'>NullTest</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Use node specific selectivity calculation function */ 
</span>        <a href="clausesel.c.html#LN577"><span class='Ref_To_Local'>s1</span></a> <span class='Operator'>= </span><a href="../../../include/utils/selfuncs.h.html#LN188"><span class='Ref_to_Proto'>nulltestsel</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN571"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                         <span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN1175"><span class='Ref_to_Struct'>NullTest</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="clausesel.c.html#LN572"><span class='Ref_to_Parameter'>clause</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>nulltesttype<span class='Delimiter'>, 
</span>                         <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>)</span> <span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN1175"><span class='Ref_to_Struct'>NullTest</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="clausesel.c.html#LN572"><span class='Ref_to_Parameter'>clause</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>arg<span class='Delimiter'>, 
</span>                         <a href="clausesel.c.html#LN573"><span class='Ref_to_Parameter'>varRelid</span></a><span class='Delimiter'>, 
</span>                         <a href="clausesel.c.html#LN574"><span class='Ref_to_Parameter'>jointype</span></a><span class='Delimiter'>, 
</span>                         <a href="clausesel.c.html#LN575"><span class='Ref_to_Parameter'>sjinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN572"><span class='Ref_to_Parameter'>clause</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1198"><span class='Ref_to_Struct'>BooleanTest</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Use node specific selectivity calculation function */ 
</span>        <a href="clausesel.c.html#LN577"><span class='Ref_To_Local'>s1</span></a> <span class='Operator'>= </span><a href="../../../include/utils/selfuncs.h.html#LN185"><span class='Ref_to_Proto'>booltestsel</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN571"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                         <span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN1198"><span class='Ref_to_Struct'>BooleanTest</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="clausesel.c.html#LN572"><span class='Ref_to_Parameter'>clause</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>booltesttype<span class='Delimiter'>, 
</span>                         <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>)</span> <span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN1198"><span class='Ref_to_Struct'>BooleanTest</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="clausesel.c.html#LN572"><span class='Ref_to_Parameter'>clause</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>arg<span class='Delimiter'>, 
</span>                         <a href="clausesel.c.html#LN573"><span class='Ref_to_Parameter'>varRelid</span></a><span class='Delimiter'>, 
</span>                         <a href="clausesel.c.html#LN574"><span class='Ref_to_Parameter'>jointype</span></a><span class='Delimiter'>, 
</span>                         <a href="clausesel.c.html#LN575"><span class='Ref_to_Parameter'>sjinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN572"><span class='Ref_to_Parameter'>clause</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1272"><span class='Ref_to_Struct'>CurrentOfExpr</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* CURRENT OF selects at most one row of its table */ 
</span><a name="LN803"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1272"><span class='Ref_to_Struct'>CurrentOfExpr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cexpr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1272"><span class='Ref_to_Struct'>CurrentOfExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="clausesel.c.html#LN572"><span class='Ref_to_Parameter'>clause</span></a><span class='Delimiter'>; 
</span><a name="LN804"></a>        <a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>crel</span> <span class='Operator'>= </span><a href="../util/relnode.c.html#LN241"><span class='Ref_to_Func'>find_base_rel</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN571"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="clausesel.c.html#LN803"><span class='Ref_To_Local'>cexpr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1275"><span class='Ref_to_Member'>cvarno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="clausesel.c.html#LN804"><span class='Ref_To_Local'>crel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN564"><span class='Ref_to_Member'>tuples</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="clausesel.c.html#LN577"><span class='Ref_To_Local'>s1</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>/ </span><a href="clausesel.c.html#LN804"><span class='Ref_To_Local'>crel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN564"><span class='Ref_to_Member'>tuples</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN572"><span class='Ref_to_Parameter'>clause</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN786"><span class='Ref_to_Struct'>RelabelType</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Not sure this case is needed, but it can't hurt */ 
</span>        <a href="clausesel.c.html#LN577"><span class='Ref_To_Local'>s1</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/cost.h.html#LN202"><span class='Ref_to_Proto'>clause_selectivity</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN571"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>)</span> <span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN786"><span class='Ref_to_Struct'>RelabelType</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="clausesel.c.html#LN572"><span class='Ref_to_Parameter'>clause</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>arg<span class='Delimiter'>, 
</span>                                <a href="clausesel.c.html#LN573"><span class='Ref_to_Parameter'>varRelid</span></a><span class='Delimiter'>, 
</span>                                <a href="clausesel.c.html#LN574"><span class='Ref_to_Parameter'>jointype</span></a><span class='Delimiter'>, 
</span>                                <a href="clausesel.c.html#LN575"><span class='Ref_to_Parameter'>sjinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN572"><span class='Ref_to_Parameter'>clause</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1215"><span class='Ref_to_Struct'>CoerceToDomain</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Not sure this case is needed, but it can't hurt */ 
</span>        <a href="clausesel.c.html#LN577"><span class='Ref_To_Local'>s1</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/cost.h.html#LN202"><span class='Ref_to_Proto'>clause_selectivity</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN571"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>)</span> <span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN1215"><span class='Ref_to_Struct'>CoerceToDomain</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="clausesel.c.html#LN572"><span class='Ref_to_Parameter'>clause</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>arg<span class='Delimiter'>, 
</span>                                <a href="clausesel.c.html#LN573"><span class='Ref_to_Parameter'>varRelid</span></a><span class='Delimiter'>, 
</span>                                <a href="clausesel.c.html#LN574"><span class='Ref_to_Parameter'>jointype</span></a><span class='Delimiter'>, 
</span>                                <a href="clausesel.c.html#LN575"><span class='Ref_to_Parameter'>sjinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * For anything else, see if we can consider it as a boolean variable. 
         * This only works if it's an immutable expression in Vars of a single 
         * relation; but there's no point in us checking that here because 
         * boolvarsel() will do it internally, and return a suitable default 
         * selectivity if not. 
         */ 
</span>        <a href="clausesel.c.html#LN577"><span class='Ref_To_Local'>s1</span></a> <span class='Operator'>= </span><a href="../../../include/utils/selfuncs.h.html#LN184"><span class='Ref_to_Proto'>boolvarsel</span></a><span class='Parentheses'>(</span><a href="clausesel.c.html#LN571"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="clausesel.c.html#LN572"><span class='Ref_to_Parameter'>clause</span></a><span class='Delimiter'>, </span><a href="clausesel.c.html#LN573"><span class='Ref_to_Parameter'>varRelid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Cache the result if possible */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="clausesel.c.html#LN579"><span class='Ref_To_Local'>cacheable</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="clausesel.c.html#LN574"><span class='Ref_to_Parameter'>jointype</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/nodes.h.html#LN677"><span class='Ref_to_EnumConst'>JOIN_INNER</span></a><span class='Parentheses'>) 
</span>            <a href="clausesel.c.html#LN578"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1784"><span class='Ref_to_Member'>norm_selec</span></a> <span class='Operator'>= </span><a href="clausesel.c.html#LN577"><span class='Ref_To_Local'>s1</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="clausesel.c.html#LN578"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1787"><span class='Ref_to_Member'>outer_selec</span></a> <span class='Operator'>= </span><a href="clausesel.c.html#LN577"><span class='Ref_To_Local'>s1</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
<span class='Directive'>#ifdef</span> SELECTIVITY_DEBUG 
    <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN21"><span class='Ref_to_Const'>DEBUG4</span></a><span class='Delimiter'>, </span><span class='String'>"clause_selectivity: s1 %f"</span><span class='Delimiter'>, </span><a href="clausesel.c.html#LN577"><span class='Ref_To_Local'>s1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* SELECTIVITY_DEBUG */ 
</span> 
    <span class='Control'>return</span> <a href="clausesel.c.html#LN577"><span class='Ref_To_Local'>s1</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end clause_selectivity &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>