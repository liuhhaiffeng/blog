<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\optimizer\path\equivclass.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\optimizer\path\equivclass.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:41 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * equivclass.c 
 *    Routines for managing EquivalenceClasses 
 * 
 * See src/backend/optimizer/README for discussion of EquivalenceClasses. 
 * 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * IDENTIFICATION 
 *    src/backend/optimizer/path/equivclass.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;limits.h&GT;</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/stratnum.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"nodes/makefuncs.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"nodes/nodeFuncs.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/clauses.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/pathnode.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/paths.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/planmain.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/prep.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/var.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
 
 
<a name="LN33"></a><span class='Keyword'>static </span><a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>add_eq_member</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ec</span><span class='Delimiter'>, 
</span><a name="LN34"></a>              <a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>expr</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>relids</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>nullable_relids</span><span class='Delimiter'>, 
</span><a name="LN35"></a>              <span class='Keyword'>bool </span><span class='Declare_Parameter'>is_child</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>datatype</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN36"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>generate_base_implied_equalities_const</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN37"></a>                                       <a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ec</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN38"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>generate_base_implied_equalities_no_const</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN39"></a>                                          <a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ec</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN40"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>generate_base_implied_equalities_broken</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN41"></a>                                        <a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ec</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN42"></a><span class='Keyword'>static </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>generate_join_implied_equalities_normal</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN43"></a>                                        <a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ec</span><span class='Delimiter'>, 
</span><a name="LN44"></a>                                        <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>join_relids</span><span class='Delimiter'>, 
</span><a name="LN45"></a>                                        <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>outer_relids</span><span class='Delimiter'>, 
</span><a name="LN46"></a>                                        <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>inner_relids</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN47"></a><span class='Keyword'>static </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>generate_join_implied_equalities_broken</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN48"></a>                                        <a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ec</span><span class='Delimiter'>, 
</span><a name="LN49"></a>                                        <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>nominal_join_relids</span><span class='Delimiter'>, 
</span><a name="LN50"></a>                                        <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>outer_relids</span><span class='Delimiter'>, 
</span><a name="LN51"></a>                                        <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>nominal_inner_relids</span><span class='Delimiter'>, 
</span><a name="LN52"></a>                                        <a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>inner_rel</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN53"></a><span class='Keyword'>static </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Prototype'>select_equality_operator</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ec</span><span class='Delimiter'>, 
</span><a name="LN54"></a>                         <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>lefttype</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>righttype</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN55"></a><span class='Keyword'>static </span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>create_join_clause</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN56"></a>                   <a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ec</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>opno</span><span class='Delimiter'>, 
</span><a name="LN57"></a>                   <a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>leftem</span><span class='Delimiter'>, 
</span><a name="LN58"></a>                   <a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rightem</span><span class='Delimiter'>, 
</span><a name="LN59"></a>                   <a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>parent_ec</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN60"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>reconsider_outer_join_clause</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN61"></a>                             <a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rinfo</span><span class='Delimiter'>, 
</span><a name="LN62"></a>                             <span class='Keyword'>bool </span><span class='Declare_Parameter'>outer_on_left</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN63"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>reconsider_full_join_clause</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN64"></a>                            <a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rinfo</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * process_equivalence 
 *    The given clause has a mergejoinable operator and can be applied without 
 *    any delay by an outer join, so its two sides can be considered equal 
 *    anywhere they are both computable; moreover that equality can be 
 *    extended transitively.  Record this knowledge in the EquivalenceClass 
 *    data structure.  Returns TRUE if successful, FALSE if not (in which 
 *    case caller should treat the clause as ordinary, not an equivalence). 
 * 
 * If below_outer_join is true, then the clause was found below the nullable 
 * side of an outer join, so its sides might validly be both NULL rather than 
 * strictly equal.  We can still deduce equalities in such cases, but we take 
 * care to mark an EquivalenceClass if it came from any such clauses.  Also, 
 * we have to check that both sides are either pseudo-constants or strict 
 * functions of Vars, else they might not both go to NULL above the outer 
 * join.  (This is the main reason why we need a failure return.  It's more 
 * convenient to check this case here than at the call sites...) 
 * 
 * We also reject proposed equivalence clauses if they contain leaky functions 
 * and have security_level above zero.  The EC evaluation rules require us to 
 * apply certain tests at certain joining levels, and we can't tolerate 
 * delaying any test on security_level grounds.  By rejecting candidate clauses 
 * that might require security delays, we ensure it's safe to apply an EC 
 * clause as soon as it's supposed to be applied. 
 * 
 * On success return, we have also initialized the clause's left_ec/right_ec 
 * fields to point to the EquivalenceClass representing it.  This saves lookup 
 * effort later. 
 * 
 * Note: constructing merged EquivalenceClasses is a standard UNION-FIND 
 * problem, for which there exist better data structures than simple lists. 
 * If this code ever proves to be a bottleneck then it could be sped up --- 
 * but for now, simple is beautiful. 
 * 
 * Note: this is only called during planner startup, not during GEQO 
 * exploration, so we need not worry about whether we're in the right 
 * memory context. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN106"></a><span class='Declare_Function'>process_equivalence</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>restrictinfo</span><span class='Delimiter'>, 
</span><a name="LN107"></a>                    <span class='Keyword'>bool </span><span class='Declare_Parameter'>below_outer_join</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN109"></a>    <a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>clause</span> <span class='Operator'>= </span><a href="equivclass.c.html#LN106"><span class='Ref_to_Parameter'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1746"><span class='Ref_to_Member'>clause</span></a><span class='Delimiter'>; 
</span><a name="LN110"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>opno</span><span class='Delimiter'>, 
</span><a name="LN111"></a>                <span class='Declare_Local'>collation</span><span class='Delimiter'>, 
</span><a name="LN112"></a>                <span class='Declare_Local'>item1_type</span><span class='Delimiter'>, 
</span><a name="LN113"></a>                <span class='Declare_Local'>item2_type</span><span class='Delimiter'>; 
</span><a name="LN114"></a>    <a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>item1</span><span class='Delimiter'>; 
</span><a name="LN115"></a>    <a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>item2</span><span class='Delimiter'>; 
</span><a name="LN116"></a>    <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a>      <span class='Declare_Local'>item1_relids</span><span class='Delimiter'>, 
</span><a name="LN117"></a>                <span class='Declare_Local'>item2_relids</span><span class='Delimiter'>, 
</span><a name="LN118"></a>                <span class='Declare_Local'>item1_nullable_relids</span><span class='Delimiter'>, 
</span><a name="LN119"></a>                <span class='Declare_Local'>item2_nullable_relids</span><span class='Delimiter'>; 
</span><a name="LN120"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>opfamilies</span><span class='Delimiter'>; 
</span><a name="LN121"></a>    <a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ec1</span><span class='Delimiter'>, 
</span><a name="LN122"></a>               <span class='Operator'>*</span><span class='Declare_Local'>ec2</span><span class='Delimiter'>; 
</span><a name="LN123"></a>    <a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Declare_Local'>em1</span><span class='Delimiter'>, 
</span><a name="LN124"></a>               <span class='Operator'>*</span><span class='Declare_Local'>em2</span><span class='Delimiter'>; 
</span><a name="LN125"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Should not already be marked as having generated an eclass */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="equivclass.c.html#LN106"><span class='Ref_to_Parameter'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1794"><span class='Ref_to_Member'>left_ec</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="equivclass.c.html#LN106"><span class='Ref_to_Parameter'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1795"><span class='Ref_to_Member'>right_ec</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Reject if it is potentially postponable by security considerations */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN106"><span class='Ref_to_Parameter'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1758"><span class='Ref_to_Member'>security_level</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& !</span><a href="equivclass.c.html#LN106"><span class='Ref_to_Parameter'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1756"><span class='Ref_to_Member'>leakproof</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Extract info from given clause */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/optimizer/clauses.h.html#LN19"><span class='Ref_to_Macro'>is_opclause</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN109"><span class='Ref_To_Local'>clause</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="equivclass.c.html#LN110"><span class='Ref_To_Local'>opno</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN491"><span class='Ref_to_Struct'>OpExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="equivclass.c.html#LN109"><span class='Ref_To_Local'>clause</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>opno<span class='Delimiter'>; 
</span>    <a href="equivclass.c.html#LN111"><span class='Ref_To_Local'>collation</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN491"><span class='Ref_to_Struct'>OpExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="equivclass.c.html#LN109"><span class='Ref_To_Local'>clause</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>inputcollid<span class='Delimiter'>; 
</span>    <a href="equivclass.c.html#LN114"><span class='Ref_To_Local'>item1</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/optimizer/clauses.h.html#LN32"><span class='Ref_to_Proto'>get_leftop</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN109"><span class='Ref_To_Local'>clause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="equivclass.c.html#LN115"><span class='Ref_To_Local'>item2</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/optimizer/clauses.h.html#LN33"><span class='Ref_to_Proto'>get_rightop</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN109"><span class='Ref_To_Local'>clause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="equivclass.c.html#LN116"><span class='Ref_To_Local'>item1_relids</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN106"><span class='Ref_to_Parameter'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1773"><span class='Ref_to_Member'>left_relids</span></a><span class='Delimiter'>; 
</span>    <a href="equivclass.c.html#LN117"><span class='Ref_To_Local'>item2_relids</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN106"><span class='Ref_to_Parameter'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1774"><span class='Ref_to_Member'>right_relids</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Ensure both input expressions expose the desired collation (their types 
     * should be OK already); see comments for canonicalize_ec_expression. 
     */ 
</span>    <a href="equivclass.c.html#LN114"><span class='Ref_To_Local'>item1</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/paths.h.html#LN126"><span class='Ref_to_Proto'>canonicalize_ec_expression</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN114"><span class='Ref_To_Local'>item1</span></a><span class='Delimiter'>, 
</span>                                       <a href="../../../include/nodes/nodeFuncs.h.html#LN31"><span class='Ref_to_Proto'>exprType</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="equivclass.c.html#LN114"><span class='Ref_To_Local'>item1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                       <a href="equivclass.c.html#LN111"><span class='Ref_To_Local'>collation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="equivclass.c.html#LN115"><span class='Ref_To_Local'>item2</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/paths.h.html#LN126"><span class='Ref_to_Proto'>canonicalize_ec_expression</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN115"><span class='Ref_To_Local'>item2</span></a><span class='Delimiter'>, 
</span>                                       <a href="../../../include/nodes/nodeFuncs.h.html#LN31"><span class='Ref_to_Proto'>exprType</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="equivclass.c.html#LN115"><span class='Ref_To_Local'>item2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                       <a href="equivclass.c.html#LN111"><span class='Ref_To_Local'>collation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Reject clauses of the form X=X.  These are not as redundant as they 
     * might seem at first glance: assuming the operator is strict, this is 
     * really an expensive way to write X IS NOT NULL.  So we must not risk 
     * just losing the clause, which would be possible if there is already a 
     * single-element EquivalenceClass containing X.  The case is not common 
     * enough to be worth contorting the EC machinery for, so just reject the 
     * clause and let it be processed as a normal restriction clause. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN626"><span class='Ref_to_Proto'>equal</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN114"><span class='Ref_To_Local'>item1</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN115"><span class='Ref_To_Local'>item2</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* X=X is not a useful equivalence */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If below outer join, check for strictness, else reject. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN107"><span class='Ref_to_Parameter'>below_outer_join</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/bitmapset.h.html#LN85"><span class='Ref_to_Proto'>bms_is_empty</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN116"><span class='Ref_To_Local'>item1_relids</span></a><span class='Parentheses'>)</span> <span class='Operator'>&& 
</span>            <a href="../../../include/optimizer/clauses.h.html#LN64"><span class='Ref_to_Proto'>contain_nonstrict_functions</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="equivclass.c.html#LN114"><span class='Ref_To_Local'>item1</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* LHS is non-strict but not constant */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/bitmapset.h.html#LN85"><span class='Ref_to_Proto'>bms_is_empty</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN117"><span class='Ref_To_Local'>item2_relids</span></a><span class='Parentheses'>)</span> <span class='Operator'>&& 
</span>            <a href="../../../include/optimizer/clauses.h.html#LN64"><span class='Ref_to_Proto'>contain_nonstrict_functions</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="equivclass.c.html#LN115"><span class='Ref_To_Local'>item2</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* RHS is non-strict but not constant */ 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Calculate nullable-relid sets for each side of the clause */ 
</span>    <a href="equivclass.c.html#LN118"><span class='Ref_To_Local'>item1_nullable_relids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN71"><span class='Ref_to_Proto'>bms_intersect</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN116"><span class='Ref_To_Local'>item1_relids</span></a><span class='Delimiter'>, 
</span>                                          <a href="equivclass.c.html#LN106"><span class='Ref_to_Parameter'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1770"><span class='Ref_to_Member'>nullable_relids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="equivclass.c.html#LN119"><span class='Ref_To_Local'>item2_nullable_relids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN71"><span class='Ref_to_Proto'>bms_intersect</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN117"><span class='Ref_To_Local'>item2_relids</span></a><span class='Delimiter'>, 
</span>                                          <a href="equivclass.c.html#LN106"><span class='Ref_to_Parameter'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1770"><span class='Ref_to_Member'>nullable_relids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We use the declared input types of the operator, not exprType() of the 
     * inputs, as the nominal datatypes for opfamily lookup.  This presumes 
     * that btree operators are always registered with amoplefttype and 
     * amoprighttype equal to their declared input types.  We will need this 
     * info anyway to build EquivalenceMember nodes, and by extracting it now 
     * we can use type comparisons to short-circuit some equal() tests. 
     */ 
</span>    <a href="../../../include/utils/lsyscache.h.html#LN101"><span class='Ref_to_Proto'>op_input_types</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN110"><span class='Ref_To_Local'>opno</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="equivclass.c.html#LN112"><span class='Ref_To_Local'>item1_type</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="equivclass.c.html#LN113"><span class='Ref_To_Local'>item2_type</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="equivclass.c.html#LN120"><span class='Ref_To_Local'>opfamilies</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN106"><span class='Ref_to_Parameter'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1791"><span class='Ref_to_Member'>mergeopfamilies</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Sweep through the existing EquivalenceClasses looking for matches to 
     * item1 and item2.  These are the possible outcomes: 
     * 
     * 1. We find both in the same EC.  The equivalence is already known, so 
     * there's nothing to do. 
     * 
     * 2. We find both in different ECs.  Merge the two ECs together. 
     * 
     * 3. We find just one.  Add the other to its EC. 
     * 
     * 4. We find neither.  Make a new, two-entry EC. 
     * 
     * Note: since all ECs are built through this process or the similar 
     * search in get_eclass_for_sort_expr(), it's impossible that we'd match 
     * an item in more than one existing nonvolatile EC.  So it's okay to stop 
     * at the first match. 
     */ 
</span>    <a href="equivclass.c.html#LN121"><span class='Ref_To_Local'>ec1</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN122"><span class='Ref_To_Local'>ec2</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="equivclass.c.html#LN123"><span class='Ref_To_Local'>em1</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN124"><span class='Ref_To_Local'>em2</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN125"><span class='Ref_To_Local'>lc1</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN106"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN234"><span class='Ref_to_Member'>eq_classes</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN220"></a>        <a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cur_ec</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN125"><span class='Ref_To_Local'>lc1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN221"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc2</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Never match to a volatile EC */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN220"><span class='Ref_To_Local'>cur_ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN778"><span class='Ref_to_Member'>ec_has_volatile</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * The collation has to match; check this first since it's cheaper 
         * than the opfamily comparison. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN111"><span class='Ref_To_Local'>collation</span></a> <span class='Operator'>!= </span><a href="equivclass.c.html#LN220"><span class='Ref_To_Local'>cur_ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN771"><span class='Ref_to_Member'>ec_collation</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * A "match" requires matching sets of btree opfamilies.  Use of 
         * equal() for this test has implications discussed in the comments 
         * for get_mergejoin_opfamilies(). 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/nodes.h.html#LN626"><span class='Ref_to_Proto'>equal</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN120"><span class='Ref_To_Local'>opfamilies</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN220"><span class='Ref_To_Local'>cur_ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN770"><span class='Ref_to_Member'>ec_opfamilies</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN221"><span class='Ref_To_Local'>lc2</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN220"><span class='Ref_To_Local'>cur_ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN772"><span class='Ref_to_Member'>ec_members</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN244"></a>            <a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cur_em</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN221"><span class='Ref_To_Local'>lc2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="equivclass.c.html#LN244"><span class='Ref_To_Local'>cur_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN824"><span class='Ref_to_Member'>em_is_child</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* no children yet */ 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * If below an outer join, don't match constants: they're not as 
             * constant as they look. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="equivclass.c.html#LN107"><span class='Ref_to_Parameter'>below_outer_join</span></a> <span class='Operator'>|| </span><a href="equivclass.c.html#LN220"><span class='Ref_To_Local'>cur_ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN779"><span class='Ref_to_Member'>ec_below_outer_join</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>                <a href="equivclass.c.html#LN244"><span class='Ref_To_Local'>cur_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN823"><span class='Ref_to_Member'>em_is_const</span></a><span class='Parentheses'>)</span> 
                <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="equivclass.c.html#LN121"><span class='Ref_To_Local'>ec1</span></a> <span class='Operator'>&& 
</span>                <a href="equivclass.c.html#LN112"><span class='Ref_To_Local'>item1_type</span></a> <span class='Operator'>== </span><a href="equivclass.c.html#LN244"><span class='Ref_To_Local'>cur_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN825"><span class='Ref_to_Member'>em_datatype</span></a> <span class='Operator'>&& 
</span>                <a href="../../../include/nodes/nodes.h.html#LN626"><span class='Ref_to_Proto'>equal</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN114"><span class='Ref_To_Local'>item1</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN244"><span class='Ref_To_Local'>cur_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN820"><span class='Ref_to_Member'>em_expr</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="equivclass.c.html#LN121"><span class='Ref_To_Local'>ec1</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN220"><span class='Ref_To_Local'>cur_ec</span></a><span class='Delimiter'>; 
</span>                <a href="equivclass.c.html#LN123"><span class='Ref_To_Local'>em1</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN244"><span class='Ref_To_Local'>cur_em</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN122"><span class='Ref_To_Local'>ec2</span></a><span class='Parentheses'>) 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="equivclass.c.html#LN122"><span class='Ref_To_Local'>ec2</span></a> <span class='Operator'>&& 
</span>                <a href="equivclass.c.html#LN113"><span class='Ref_To_Local'>item2_type</span></a> <span class='Operator'>== </span><a href="equivclass.c.html#LN244"><span class='Ref_To_Local'>cur_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN825"><span class='Ref_to_Member'>em_datatype</span></a> <span class='Operator'>&& 
</span>                <a href="../../../include/nodes/nodes.h.html#LN626"><span class='Ref_to_Proto'>equal</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN115"><span class='Ref_To_Local'>item2</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN244"><span class='Ref_To_Local'>cur_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN820"><span class='Ref_to_Member'>em_expr</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="equivclass.c.html#LN122"><span class='Ref_To_Local'>ec2</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN220"><span class='Ref_To_Local'>cur_ec</span></a><span class='Delimiter'>; 
</span>                <a href="equivclass.c.html#LN124"><span class='Ref_To_Local'>em2</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN244"><span class='Ref_To_Local'>cur_em</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN121"><span class='Ref_To_Local'>ec1</span></a><span class='Parentheses'>) 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN121"><span class='Ref_To_Local'>ec1</span></a> <span class='Operator'>&& </span><a href="equivclass.c.html#LN122"><span class='Ref_To_Local'>ec2</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Sweep finished, what did we find? */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN121"><span class='Ref_To_Local'>ec1</span></a> <span class='Operator'>&& </span><a href="equivclass.c.html#LN122"><span class='Ref_To_Local'>ec2</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* If case 1, nothing to do, except add to sources */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN121"><span class='Ref_To_Local'>ec1</span></a> <span class='Operator'>== </span><a href="equivclass.c.html#LN122"><span class='Ref_To_Local'>ec2</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="equivclass.c.html#LN121"><span class='Ref_To_Local'>ec1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN773"><span class='Ref_to_Member'>ec_sources</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN121"><span class='Ref_To_Local'>ec1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN773"><span class='Ref_to_Member'>ec_sources</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN106"><span class='Ref_to_Parameter'>restrictinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="equivclass.c.html#LN121"><span class='Ref_To_Local'>ec1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN779"><span class='Ref_to_Member'>ec_below_outer_join</span></a> <span class='Operator'>|= </span><a href="equivclass.c.html#LN107"><span class='Ref_to_Parameter'>below_outer_join</span></a><span class='Delimiter'>; 
</span>            <a href="equivclass.c.html#LN121"><span class='Ref_To_Local'>ec1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN782"><span class='Ref_to_Member'>ec_min_security</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN121"><span class='Ref_To_Local'>ec1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN782"><span class='Ref_to_Member'>ec_min_security</span></a><span class='Delimiter'>, 
</span>                                       <a href="equivclass.c.html#LN106"><span class='Ref_to_Parameter'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1758"><span class='Ref_to_Member'>security_level</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="equivclass.c.html#LN121"><span class='Ref_To_Local'>ec1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN783"><span class='Ref_to_Member'>ec_max_security</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN121"><span class='Ref_To_Local'>ec1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN783"><span class='Ref_to_Member'>ec_max_security</span></a><span class='Delimiter'>, 
</span>                                       <a href="equivclass.c.html#LN106"><span class='Ref_to_Parameter'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1758"><span class='Ref_to_Member'>security_level</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* mark the RI as associated with this eclass */ 
</span>            <a href="equivclass.c.html#LN106"><span class='Ref_to_Parameter'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1794"><span class='Ref_to_Member'>left_ec</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN121"><span class='Ref_To_Local'>ec1</span></a><span class='Delimiter'>; 
</span>            <a href="equivclass.c.html#LN106"><span class='Ref_to_Parameter'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1795"><span class='Ref_to_Member'>right_ec</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN121"><span class='Ref_To_Local'>ec1</span></a><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* mark the RI as usable with this pair of EMs */ 
</span>            <a href="equivclass.c.html#LN106"><span class='Ref_to_Parameter'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1796"><span class='Ref_to_Member'>left_em</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN123"><span class='Ref_To_Local'>em1</span></a><span class='Delimiter'>; 
</span>            <a href="equivclass.c.html#LN106"><span class='Ref_to_Parameter'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1797"><span class='Ref_to_Member'>right_em</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN124"><span class='Ref_To_Local'>em2</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Case 2: need to merge ec1 and ec2.  This should never happen after 
         * we've built any canonical pathkeys; if it did, those pathkeys might 
         * be rendered non-canonical by the merge. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN106"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN236"><span class='Ref_to_Member'>canon_pathkeys</span></a> <span class='Operator'>!= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"too late to merge equivalence classes"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We add ec2's items to ec1, then set ec2's ec_merged link to point 
         * to ec1 and remove ec2 from the eq_classes list.  We cannot simply 
         * delete ec2 because that could leave dangling pointers in existing 
         * PathKeys.  We leave it behind with a link so that the merged EC can 
         * be found. 
         */ 
</span>        <a href="equivclass.c.html#LN121"><span class='Ref_To_Local'>ec1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN772"><span class='Ref_to_Member'>ec_members</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN121"><span class='Ref_To_Local'>ec1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN772"><span class='Ref_to_Member'>ec_members</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN122"><span class='Ref_To_Local'>ec2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN772"><span class='Ref_to_Member'>ec_members</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN121"><span class='Ref_To_Local'>ec1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN773"><span class='Ref_to_Member'>ec_sources</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN121"><span class='Ref_To_Local'>ec1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN773"><span class='Ref_to_Member'>ec_sources</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN122"><span class='Ref_To_Local'>ec2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN773"><span class='Ref_to_Member'>ec_sources</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN121"><span class='Ref_To_Local'>ec1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN774"><span class='Ref_to_Member'>ec_derives</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN121"><span class='Ref_To_Local'>ec1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN774"><span class='Ref_to_Member'>ec_derives</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN122"><span class='Ref_To_Local'>ec2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN774"><span class='Ref_to_Member'>ec_derives</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN121"><span class='Ref_To_Local'>ec1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN775"><span class='Ref_to_Member'>ec_relids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN94"><span class='Ref_to_Proto'>bms_join</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN121"><span class='Ref_To_Local'>ec1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN775"><span class='Ref_to_Member'>ec_relids</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN122"><span class='Ref_To_Local'>ec2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN775"><span class='Ref_to_Member'>ec_relids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN121"><span class='Ref_To_Local'>ec1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN777"><span class='Ref_to_Member'>ec_has_const</span></a> <span class='Operator'>|= </span><a href="equivclass.c.html#LN122"><span class='Ref_To_Local'>ec2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN777"><span class='Ref_to_Member'>ec_has_const</span></a><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* can't need to set has_volatile */ 
</span>        <a href="equivclass.c.html#LN121"><span class='Ref_To_Local'>ec1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN779"><span class='Ref_to_Member'>ec_below_outer_join</span></a> <span class='Operator'>|= </span><a href="equivclass.c.html#LN122"><span class='Ref_To_Local'>ec2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN779"><span class='Ref_to_Member'>ec_below_outer_join</span></a><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN121"><span class='Ref_To_Local'>ec1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN782"><span class='Ref_to_Member'>ec_min_security</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN121"><span class='Ref_To_Local'>ec1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN782"><span class='Ref_to_Member'>ec_min_security</span></a><span class='Delimiter'>, 
</span>                                   <a href="equivclass.c.html#LN122"><span class='Ref_To_Local'>ec2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN782"><span class='Ref_to_Member'>ec_min_security</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN121"><span class='Ref_To_Local'>ec1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN783"><span class='Ref_to_Member'>ec_max_security</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN121"><span class='Ref_To_Local'>ec1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN783"><span class='Ref_to_Member'>ec_max_security</span></a><span class='Delimiter'>, 
</span>                                   <a href="equivclass.c.html#LN122"><span class='Ref_To_Local'>ec2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN783"><span class='Ref_to_Member'>ec_max_security</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN122"><span class='Ref_To_Local'>ec2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN784"><span class='Ref_to_Member'>ec_merged</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN121"><span class='Ref_To_Local'>ec1</span></a><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN106"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN234"><span class='Ref_to_Member'>eq_classes</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN234"><span class='Ref_to_Proto'>list_delete_ptr</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN106"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN234"><span class='Ref_to_Member'>eq_classes</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN122"><span class='Ref_To_Local'>ec2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* just to avoid debugging confusion w/ dangling pointers: */ 
</span>        <a href="equivclass.c.html#LN122"><span class='Ref_To_Local'>ec2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN772"><span class='Ref_to_Member'>ec_members</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN122"><span class='Ref_To_Local'>ec2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN773"><span class='Ref_to_Member'>ec_sources</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN122"><span class='Ref_To_Local'>ec2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN774"><span class='Ref_to_Member'>ec_derives</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN122"><span class='Ref_To_Local'>ec2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN775"><span class='Ref_to_Member'>ec_relids</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN121"><span class='Ref_To_Local'>ec1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN773"><span class='Ref_to_Member'>ec_sources</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN121"><span class='Ref_To_Local'>ec1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN773"><span class='Ref_to_Member'>ec_sources</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN106"><span class='Ref_to_Parameter'>restrictinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN121"><span class='Ref_To_Local'>ec1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN779"><span class='Ref_to_Member'>ec_below_outer_join</span></a> <span class='Operator'>|= </span><a href="equivclass.c.html#LN107"><span class='Ref_to_Parameter'>below_outer_join</span></a><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN121"><span class='Ref_To_Local'>ec1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN782"><span class='Ref_to_Member'>ec_min_security</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN121"><span class='Ref_To_Local'>ec1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN782"><span class='Ref_to_Member'>ec_min_security</span></a><span class='Delimiter'>, 
</span>                                   <a href="equivclass.c.html#LN106"><span class='Ref_to_Parameter'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1758"><span class='Ref_to_Member'>security_level</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN121"><span class='Ref_To_Local'>ec1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN783"><span class='Ref_to_Member'>ec_max_security</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN121"><span class='Ref_To_Local'>ec1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN783"><span class='Ref_to_Member'>ec_max_security</span></a><span class='Delimiter'>, 
</span>                                   <a href="equivclass.c.html#LN106"><span class='Ref_to_Parameter'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1758"><span class='Ref_to_Member'>security_level</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* mark the RI as associated with this eclass */ 
</span>        <a href="equivclass.c.html#LN106"><span class='Ref_to_Parameter'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1794"><span class='Ref_to_Member'>left_ec</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN121"><span class='Ref_To_Local'>ec1</span></a><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN106"><span class='Ref_to_Parameter'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1795"><span class='Ref_to_Member'>right_ec</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN121"><span class='Ref_To_Local'>ec1</span></a><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* mark the RI as usable with this pair of EMs */ 
</span>        <a href="equivclass.c.html#LN106"><span class='Ref_to_Parameter'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1796"><span class='Ref_to_Member'>left_em</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN123"><span class='Ref_To_Local'>em1</span></a><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN106"><span class='Ref_to_Parameter'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1797"><span class='Ref_to_Member'>right_em</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN124"><span class='Ref_To_Local'>em2</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if ec1&&ec2 &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN121"><span class='Ref_To_Local'>ec1</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Case 3: add item2 to ec1 */ 
</span>        <a href="equivclass.c.html#LN124"><span class='Ref_To_Local'>em2</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN33"><span class='Ref_to_Proto'>add_eq_member</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN121"><span class='Ref_To_Local'>ec1</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN115"><span class='Ref_To_Local'>item2</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN117"><span class='Ref_To_Local'>item2_relids</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN119"><span class='Ref_To_Local'>item2_nullable_relids</span></a><span class='Delimiter'>, 
</span>                            <span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="equivclass.c.html#LN113"><span class='Ref_To_Local'>item2_type</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN121"><span class='Ref_To_Local'>ec1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN773"><span class='Ref_to_Member'>ec_sources</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN121"><span class='Ref_To_Local'>ec1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN773"><span class='Ref_to_Member'>ec_sources</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN106"><span class='Ref_to_Parameter'>restrictinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN121"><span class='Ref_To_Local'>ec1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN779"><span class='Ref_to_Member'>ec_below_outer_join</span></a> <span class='Operator'>|= </span><a href="equivclass.c.html#LN107"><span class='Ref_to_Parameter'>below_outer_join</span></a><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN121"><span class='Ref_To_Local'>ec1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN782"><span class='Ref_to_Member'>ec_min_security</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN121"><span class='Ref_To_Local'>ec1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN782"><span class='Ref_to_Member'>ec_min_security</span></a><span class='Delimiter'>, 
</span>                                   <a href="equivclass.c.html#LN106"><span class='Ref_to_Parameter'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1758"><span class='Ref_to_Member'>security_level</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN121"><span class='Ref_To_Local'>ec1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN783"><span class='Ref_to_Member'>ec_max_security</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN121"><span class='Ref_To_Local'>ec1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN783"><span class='Ref_to_Member'>ec_max_security</span></a><span class='Delimiter'>, 
</span>                                   <a href="equivclass.c.html#LN106"><span class='Ref_to_Parameter'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1758"><span class='Ref_to_Member'>security_level</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* mark the RI as associated with this eclass */ 
</span>        <a href="equivclass.c.html#LN106"><span class='Ref_to_Parameter'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1794"><span class='Ref_to_Member'>left_ec</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN121"><span class='Ref_To_Local'>ec1</span></a><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN106"><span class='Ref_to_Parameter'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1795"><span class='Ref_to_Member'>right_ec</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN121"><span class='Ref_To_Local'>ec1</span></a><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* mark the RI as usable with this pair of EMs */ 
</span>        <a href="equivclass.c.html#LN106"><span class='Ref_to_Parameter'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1796"><span class='Ref_to_Member'>left_em</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN123"><span class='Ref_To_Local'>em1</span></a><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN106"><span class='Ref_to_Parameter'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1797"><span class='Ref_to_Member'>right_em</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN124"><span class='Ref_To_Local'>em2</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN122"><span class='Ref_To_Local'>ec2</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Case 3: add item1 to ec2 */ 
</span>        <a href="equivclass.c.html#LN123"><span class='Ref_To_Local'>em1</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN33"><span class='Ref_to_Proto'>add_eq_member</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN122"><span class='Ref_To_Local'>ec2</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN114"><span class='Ref_To_Local'>item1</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN116"><span class='Ref_To_Local'>item1_relids</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN118"><span class='Ref_To_Local'>item1_nullable_relids</span></a><span class='Delimiter'>, 
</span>                            <span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="equivclass.c.html#LN112"><span class='Ref_To_Local'>item1_type</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN122"><span class='Ref_To_Local'>ec2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN773"><span class='Ref_to_Member'>ec_sources</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN122"><span class='Ref_To_Local'>ec2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN773"><span class='Ref_to_Member'>ec_sources</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN106"><span class='Ref_to_Parameter'>restrictinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN122"><span class='Ref_To_Local'>ec2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN779"><span class='Ref_to_Member'>ec_below_outer_join</span></a> <span class='Operator'>|= </span><a href="equivclass.c.html#LN107"><span class='Ref_to_Parameter'>below_outer_join</span></a><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN122"><span class='Ref_To_Local'>ec2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN782"><span class='Ref_to_Member'>ec_min_security</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN122"><span class='Ref_To_Local'>ec2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN782"><span class='Ref_to_Member'>ec_min_security</span></a><span class='Delimiter'>, 
</span>                                   <a href="equivclass.c.html#LN106"><span class='Ref_to_Parameter'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1758"><span class='Ref_to_Member'>security_level</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN122"><span class='Ref_To_Local'>ec2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN783"><span class='Ref_to_Member'>ec_max_security</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN122"><span class='Ref_To_Local'>ec2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN783"><span class='Ref_to_Member'>ec_max_security</span></a><span class='Delimiter'>, 
</span>                                   <a href="equivclass.c.html#LN106"><span class='Ref_to_Parameter'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1758"><span class='Ref_to_Member'>security_level</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* mark the RI as associated with this eclass */ 
</span>        <a href="equivclass.c.html#LN106"><span class='Ref_to_Parameter'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1794"><span class='Ref_to_Member'>left_ec</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN122"><span class='Ref_To_Local'>ec2</span></a><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN106"><span class='Ref_to_Parameter'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1795"><span class='Ref_to_Member'>right_ec</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN122"><span class='Ref_To_Local'>ec2</span></a><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* mark the RI as usable with this pair of EMs */ 
</span>        <a href="equivclass.c.html#LN106"><span class='Ref_to_Parameter'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1796"><span class='Ref_to_Member'>left_em</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN123"><span class='Ref_To_Local'>em1</span></a><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN106"><span class='Ref_to_Parameter'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1797"><span class='Ref_to_Member'>right_em</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN124"><span class='Ref_To_Local'>em2</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Case 4: make a new, two-entry EC */ 
</span><a name="LN388"></a>        <a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ec</span> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="equivclass.c.html#LN388"><span class='Ref_To_Local'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN770"><span class='Ref_to_Member'>ec_opfamilies</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN120"><span class='Ref_To_Local'>opfamilies</span></a><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN388"><span class='Ref_To_Local'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN771"><span class='Ref_to_Member'>ec_collation</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN111"><span class='Ref_To_Local'>collation</span></a><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN388"><span class='Ref_To_Local'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN772"><span class='Ref_to_Member'>ec_members</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN388"><span class='Ref_To_Local'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN773"><span class='Ref_to_Member'>ec_sources</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN138"><span class='Ref_to_Macro'>list_make1</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN106"><span class='Ref_to_Parameter'>restrictinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN388"><span class='Ref_To_Local'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN774"><span class='Ref_to_Member'>ec_derives</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN388"><span class='Ref_To_Local'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN775"><span class='Ref_to_Member'>ec_relids</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN388"><span class='Ref_To_Local'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN777"><span class='Ref_to_Member'>ec_has_const</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN388"><span class='Ref_To_Local'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN778"><span class='Ref_to_Member'>ec_has_volatile</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN388"><span class='Ref_To_Local'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN779"><span class='Ref_to_Member'>ec_below_outer_join</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN107"><span class='Ref_to_Parameter'>below_outer_join</span></a><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN388"><span class='Ref_To_Local'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN780"><span class='Ref_to_Member'>ec_broken</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN388"><span class='Ref_To_Local'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN781"><span class='Ref_to_Member'>ec_sortref</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN388"><span class='Ref_To_Local'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN782"><span class='Ref_to_Member'>ec_min_security</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN106"><span class='Ref_to_Parameter'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1758"><span class='Ref_to_Member'>security_level</span></a><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN388"><span class='Ref_To_Local'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN783"><span class='Ref_to_Member'>ec_max_security</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN106"><span class='Ref_to_Parameter'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1758"><span class='Ref_to_Member'>security_level</span></a><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN388"><span class='Ref_To_Local'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN784"><span class='Ref_to_Member'>ec_merged</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN123"><span class='Ref_To_Local'>em1</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN33"><span class='Ref_to_Proto'>add_eq_member</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN388"><span class='Ref_To_Local'>ec</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN114"><span class='Ref_To_Local'>item1</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN116"><span class='Ref_To_Local'>item1_relids</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN118"><span class='Ref_To_Local'>item1_nullable_relids</span></a><span class='Delimiter'>, 
</span>                            <span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="equivclass.c.html#LN112"><span class='Ref_To_Local'>item1_type</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN124"><span class='Ref_To_Local'>em2</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN33"><span class='Ref_to_Proto'>add_eq_member</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN388"><span class='Ref_To_Local'>ec</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN115"><span class='Ref_To_Local'>item2</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN117"><span class='Ref_To_Local'>item2_relids</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN119"><span class='Ref_To_Local'>item2_nullable_relids</span></a><span class='Delimiter'>, 
</span>                            <span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="equivclass.c.html#LN113"><span class='Ref_To_Local'>item2_type</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="equivclass.c.html#LN106"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN234"><span class='Ref_to_Member'>eq_classes</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN106"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN234"><span class='Ref_to_Member'>eq_classes</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN388"><span class='Ref_To_Local'>ec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* mark the RI as associated with this eclass */ 
</span>        <a href="equivclass.c.html#LN106"><span class='Ref_to_Parameter'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1794"><span class='Ref_to_Member'>left_ec</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN388"><span class='Ref_To_Local'>ec</span></a><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN106"><span class='Ref_to_Parameter'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1795"><span class='Ref_to_Member'>right_ec</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN388"><span class='Ref_To_Local'>ec</span></a><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* mark the RI as usable with this pair of EMs */ 
</span>        <a href="equivclass.c.html#LN106"><span class='Ref_to_Parameter'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1796"><span class='Ref_to_Member'>left_em</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN123"><span class='Ref_To_Local'>em1</span></a><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN106"><span class='Ref_to_Parameter'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1797"><span class='Ref_to_Member'>right_em</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN124"><span class='Ref_To_Local'>em2</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end process_equivalence &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * canonicalize_ec_expression 
 * 
 * This function ensures that the expression exposes the expected type and 
 * collation, so that it will be equal() to other equivalence-class expressions 
 * that it ought to be equal() to. 
 * 
 * The rule for datatypes is that the exposed type should match what it would 
 * be for an input to an operator of the EC's opfamilies; which is usually 
 * the declared input type of the operator, but in the case of polymorphic 
 * operators no relabeling is wanted (compare the behavior of parse_coerce.c). 
 * Expressions coming in from quals will generally have the right type 
 * already, but expressions coming from indexkeys may not (because they are 
 * represented without any explicit relabel in pg_index), and the same problem 
 * occurs for sort expressions (because the parser is likewise cavalier about 
 * putting relabels on them).  Such cases will be binary-compatible with the 
 * real operators, so adding a RelabelType is sufficient. 
 * 
 * Also, the expression's exposed collation must match the EC's collation. 
 * This is important because in comparisons like "foo &LT; bar COLLATE baz", 
 * only one of the expressions has the correct exposed collation as we receive 
 * it from the parser.  Forcing both of them to have it ensures that all 
 * variant spellings of such a construct behave the same.  Again, we can 
 * stick on a RelabelType to force the right exposed collation.  (It might 
 * work to not label the collation at all in EC members, but this is risky 
 * since some parts of the system expect exprCollation() to deliver the 
 * right answer for a sort key.) 
 * 
 * Note this code assumes that the expression has already been through 
 * eval_const_expressions, so there are no CollateExprs and no redundant 
 * RelabelTypes. 
 */ 
</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>* 
</span><a name="LN455"></a><span class='Declare_Function'>canonicalize_ec_expression</span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>expr</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>req_type</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>req_collation</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN457"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>expr_type</span> <span class='Operator'>= </span><a href="../../../include/nodes/nodeFuncs.h.html#LN31"><span class='Ref_to_Proto'>exprType</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="equivclass.c.html#LN455"><span class='Ref_to_Parameter'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * For a polymorphic-input-type opclass, just keep the same exposed type. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/catalog/pg_type.h.html#LN744"><span class='Ref_to_Macro'>IsPolymorphicType</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN455"><span class='Ref_to_Parameter'>req_type</span></a><span class='Parentheses'>))</span> 
        <a href="equivclass.c.html#LN455"><span class='Ref_to_Parameter'>req_type</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN457"><span class='Ref_To_Local'>expr_type</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * No work if the expression exposes the right type/collation already. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN457"><span class='Ref_To_Local'>expr_type</span></a> <span class='Operator'>!= </span><a href="equivclass.c.html#LN455"><span class='Ref_to_Parameter'>req_type</span></a> <span class='Operator'>|| 
</span>        <a href="../../../include/nodes/nodeFuncs.h.html#LN38"><span class='Ref_to_Proto'>exprCollation</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="equivclass.c.html#LN455"><span class='Ref_to_Parameter'>expr</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><a href="equivclass.c.html#LN455"><span class='Ref_to_Parameter'>req_collation</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Strip any existing RelabelType, then add a new one if needed. This 
         * is to preserve the invariant of no redundant RelabelTypes. 
         * 
         * If we have to change the exposed type of the stripped expression, 
         * set typmod to -1 (since the new type may not have the same typmod 
         * interpretation).  If we only have to change collation, preserve the 
         * exposed typmod. 
         */ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN455"><span class='Ref_to_Parameter'>expr</span></a> <span class='Operator'>&& </span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN455"><span class='Ref_to_Parameter'>expr</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN786"><span class='Ref_to_Struct'>RelabelType</span></a><span class='Parentheses'>))</span> 
            <a href="equivclass.c.html#LN455"><span class='Ref_to_Parameter'>expr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) ((</span><a href="../../../include/nodes/primnodes.h.html#LN786"><span class='Ref_to_Struct'>RelabelType</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="equivclass.c.html#LN455"><span class='Ref_to_Parameter'>expr</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>arg<span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodeFuncs.h.html#LN31"><span class='Ref_to_Proto'>exprType</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="equivclass.c.html#LN455"><span class='Ref_to_Parameter'>expr</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><a href="equivclass.c.html#LN455"><span class='Ref_to_Parameter'>req_type</span></a><span class='Parentheses'>)</span> 
            <a href="equivclass.c.html#LN455"><span class='Ref_to_Parameter'>expr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/makefuncs.h.html#LN65"><span class='Ref_to_Proto'>makeRelabelType</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN455"><span class='Ref_to_Parameter'>expr</span></a><span class='Delimiter'>, 
</span>                                            <a href="equivclass.c.html#LN455"><span class='Ref_to_Parameter'>req_type</span></a><span class='Delimiter'>, 
</span>                                            <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                            <a href="equivclass.c.html#LN455"><span class='Ref_to_Parameter'>req_collation</span></a><span class='Delimiter'>, 
</span>                                            <a href="../../../include/nodes/primnodes.h.html#LN438"><span class='Ref_to_EnumConst'>COERCE_IMPLICIT_CAST</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodeFuncs.h.html#LN38"><span class='Ref_to_Proto'>exprCollation</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="equivclass.c.html#LN455"><span class='Ref_to_Parameter'>expr</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><a href="equivclass.c.html#LN455"><span class='Ref_to_Parameter'>req_collation</span></a><span class='Parentheses'>)</span> 
            <a href="equivclass.c.html#LN455"><span class='Ref_to_Parameter'>expr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/makefuncs.h.html#LN65"><span class='Ref_to_Proto'>makeRelabelType</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN455"><span class='Ref_to_Parameter'>expr</span></a><span class='Delimiter'>, 
</span>                                            <a href="equivclass.c.html#LN455"><span class='Ref_to_Parameter'>req_type</span></a><span class='Delimiter'>, 
</span>                                            <a href="../../../include/nodes/nodeFuncs.h.html#LN32"><span class='Ref_to_Proto'>exprTypmod</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="equivclass.c.html#LN455"><span class='Ref_to_Parameter'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                            <a href="equivclass.c.html#LN455"><span class='Ref_to_Parameter'>req_collation</span></a><span class='Delimiter'>, 
</span>                                            <a href="../../../include/nodes/primnodes.h.html#LN438"><span class='Ref_to_EnumConst'>COERCE_IMPLICIT_CAST</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if expr_type!=req_type||... &raquo; </span> 
 
    <span class='Control'>return</span> <a href="equivclass.c.html#LN455"><span class='Ref_to_Parameter'>expr</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end canonicalize_ec_expression &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * add_eq_member - build a new EquivalenceMember and add it to an EC 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>* 
</span><a name="LN504"></a><span class='Declare_Function'>add_eq_member</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ec</span><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>expr</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>relids</span><span class='Delimiter'>, 
</span><a name="LN505"></a>              <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>nullable_relids</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>is_child</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>datatype</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN507"></a>    <a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Declare_Local'>em</span> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="equivclass.c.html#LN507"><span class='Ref_To_Local'>em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN820"><span class='Ref_to_Member'>em_expr</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN504"><span class='Ref_to_Parameter'>expr</span></a><span class='Delimiter'>; 
</span>    <a href="equivclass.c.html#LN507"><span class='Ref_To_Local'>em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN821"><span class='Ref_to_Member'>em_relids</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN504"><span class='Ref_to_Parameter'>relids</span></a><span class='Delimiter'>; 
</span>    <a href="equivclass.c.html#LN507"><span class='Ref_To_Local'>em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN822"><span class='Ref_to_Member'>em_nullable_relids</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN505"><span class='Ref_to_Parameter'>nullable_relids</span></a><span class='Delimiter'>; 
</span>    <a href="equivclass.c.html#LN507"><span class='Ref_To_Local'>em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN823"><span class='Ref_to_Member'>em_is_const</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="equivclass.c.html#LN507"><span class='Ref_To_Local'>em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN824"><span class='Ref_to_Member'>em_is_child</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN505"><span class='Ref_to_Parameter'>is_child</span></a><span class='Delimiter'>; 
</span>    <a href="equivclass.c.html#LN507"><span class='Ref_To_Local'>em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN825"><span class='Ref_to_Member'>em_datatype</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN505"><span class='Ref_to_Parameter'>datatype</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/bitmapset.h.html#LN85"><span class='Ref_to_Proto'>bms_is_empty</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN504"><span class='Ref_to_Parameter'>relids</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * No Vars, assume it's a pseudoconstant.  This is correct for entries 
         * generated from process_equivalence(), because a WHERE clause can't 
         * contain aggregates or SRFs, and non-volatility was checked before 
         * process_equivalence() ever got called.  But 
         * get_eclass_for_sort_expr() has to work harder.  We put the tests 
         * there not here to save cycles in the equivalence case. 
         */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="equivclass.c.html#LN505"><span class='Ref_to_Parameter'>is_child</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN507"><span class='Ref_To_Local'>em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN823"><span class='Ref_to_Member'>em_is_const</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN504"><span class='Ref_to_Parameter'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN777"><span class='Ref_to_Member'>ec_has_const</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* it can't affect ec_relids */ 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="equivclass.c.html#LN505"><span class='Ref_to_Parameter'>is_child</span></a><span class='Parentheses'>)</span>         <span class='Comment_Single_Line'>/* child members don't add to ec_relids */ 
</span>    <span class='Delimiter'>{ 
</span>        <a href="equivclass.c.html#LN504"><span class='Ref_to_Parameter'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN775"><span class='Ref_to_Member'>ec_relids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN91"><span class='Ref_to_Proto'>bms_add_members</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN504"><span class='Ref_to_Parameter'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN775"><span class='Ref_to_Member'>ec_relids</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN504"><span class='Ref_to_Parameter'>relids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="equivclass.c.html#LN504"><span class='Ref_to_Parameter'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN772"><span class='Ref_to_Member'>ec_members</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN504"><span class='Ref_to_Parameter'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN772"><span class='Ref_to_Member'>ec_members</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN507"><span class='Ref_To_Local'>em</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="equivclass.c.html#LN507"><span class='Ref_To_Local'>em</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end add_eq_member &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * get_eclass_for_sort_expr 
 *    Given an expression and opfamily/collation info, find an existing 
 *    equivalence class it is a member of; if none, optionally build a new 
 *    single-member EquivalenceClass for it. 
 * 
 * expr is the expression, and nullable_relids is the set of base relids 
 * that are potentially nullable below it.  We actually only care about 
 * the set of such relids that are used in the expression; but for caller 
 * convenience, we perform that intersection step here.  The caller need 
 * only be sure that nullable_relids doesn't omit any nullable rels that 
 * might appear in the expr. 
 * 
 * sortref is the SortGroupRef of the originating SortGroupClause, if any, 
 * or zero if not.  (It should never be zero if the expression is volatile!) 
 * 
 * If rel is not NULL, it identifies a specific relation we're considering 
 * a path for, and indicates that child EC members for that relation can be 
 * considered.  Otherwise child members are ignored.  (Note: since child EC 
 * members aren't guaranteed unique, a non-NULL value means that there could 
 * be more than one EC that matches the expression; if so it's order-dependent 
 * which one you get.  This is annoying but it only happens in corner cases, 
 * so for now we live with just reporting the first match.  See also 
 * generate_implied_equalities_for_column and match_pathkeys_to_index.) 
 * 
 * If create_it is TRUE, we'll build a new EquivalenceClass when there is no 
 * match.  If create_it is FALSE, we just return NULL when no match. 
 * 
 * This can be used safely both before and after EquivalenceClass merging; 
 * since it never causes merging it does not invalidate any existing ECs 
 * or PathKeys.  However, ECs added after path generation has begun are 
 * of limited usefulness, so usually it's best to create them beforehand. 
 * 
 * Note: opfamilies must be chosen consistently with the way 
 * process_equivalence() would do; that is, generated from a mergejoinable 
 * equality operator.  Else we might fail to detect valid equivalences, 
 * generating poor (but not incorrect) plans. 
 */ 
</span><a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>* 
</span><a name="LN580"></a><span class='Declare_Function'>get_eclass_for_sort_expr</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN581"></a>                         <a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>expr</span><span class='Delimiter'>, 
</span><a name="LN582"></a>                         <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>nullable_relids</span><span class='Delimiter'>, 
</span><a name="LN583"></a>                         <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>opfamilies</span><span class='Delimiter'>, 
</span><a name="LN584"></a>                         <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>opcintype</span><span class='Delimiter'>, 
</span><a name="LN585"></a>                         <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>collation</span><span class='Delimiter'>, 
</span><a name="LN586"></a>                         <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>sortref</span><span class='Delimiter'>, 
</span><a name="LN587"></a>                         <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN588"></a>                         <span class='Keyword'>bool </span><span class='Declare_Parameter'>create_it</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN590"></a>    <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a>      <span class='Declare_Local'>expr_relids</span><span class='Delimiter'>; 
</span><a name="LN591"></a>    <a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Declare_Local'>newec</span><span class='Delimiter'>; 
</span><a name="LN592"></a>    <a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Declare_Local'>newem</span><span class='Delimiter'>; 
</span><a name="LN593"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc1</span><span class='Delimiter'>; 
</span><a name="LN594"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Ensure the expression exposes the correct type and collation. 
     */ 
</span>    <a href="equivclass.c.html#LN581"><span class='Ref_to_Parameter'>expr</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/paths.h.html#LN126"><span class='Ref_to_Proto'>canonicalize_ec_expression</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN581"><span class='Ref_to_Parameter'>expr</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN584"><span class='Ref_to_Parameter'>opcintype</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN585"><span class='Ref_to_Parameter'>collation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Get the precise set of nullable relids appearing in the expression. 
     */ 
</span>    <a href="equivclass.c.html#LN590"><span class='Ref_To_Local'>expr_relids</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/var.h.html#LN29"><span class='Ref_to_Proto'>pull_varnos</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="equivclass.c.html#LN581"><span class='Ref_to_Parameter'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="equivclass.c.html#LN582"><span class='Ref_to_Parameter'>nullable_relids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN71"><span class='Ref_to_Proto'>bms_intersect</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN582"><span class='Ref_to_Parameter'>nullable_relids</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN590"><span class='Ref_To_Local'>expr_relids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Scan through the existing EquivalenceClasses for a match 
     */ 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN593"><span class='Ref_To_Local'>lc1</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN580"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN234"><span class='Ref_to_Member'>eq_classes</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN612"></a>        <a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cur_ec</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN593"><span class='Ref_To_Local'>lc1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN613"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc2</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Never match to a volatile EC, except when we are looking at another 
         * reference to the same volatile SortGroupClause. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN612"><span class='Ref_To_Local'>cur_ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN778"><span class='Ref_to_Member'>ec_has_volatile</span></a> <span class='Operator'>&& 
</span>            <span class='Parentheses'>(</span><a href="equivclass.c.html#LN586"><span class='Ref_to_Parameter'>sortref</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="equivclass.c.html#LN586"><span class='Ref_to_Parameter'>sortref</span></a> <span class='Operator'>!= </span><a href="equivclass.c.html#LN612"><span class='Ref_To_Local'>cur_ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN781"><span class='Ref_to_Member'>ec_sortref</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN585"><span class='Ref_to_Parameter'>collation</span></a> <span class='Operator'>!= </span><a href="equivclass.c.html#LN612"><span class='Ref_To_Local'>cur_ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN771"><span class='Ref_to_Member'>ec_collation</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/nodes.h.html#LN626"><span class='Ref_to_Proto'>equal</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN583"><span class='Ref_to_Parameter'>opfamilies</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN612"><span class='Ref_To_Local'>cur_ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN770"><span class='Ref_to_Member'>ec_opfamilies</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN613"><span class='Ref_To_Local'>lc2</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN612"><span class='Ref_To_Local'>cur_ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN772"><span class='Ref_to_Member'>ec_members</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN630"></a>            <a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cur_em</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN613"><span class='Ref_To_Local'>lc2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Ignore child members unless they match the request. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN630"><span class='Ref_To_Local'>cur_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN824"><span class='Ref_to_Member'>em_is_child</span></a> <span class='Operator'>&& 
</span>                <span class='Operator'>!</span><a href="../../../include/nodes/bitmapset.h.html#LN66"><span class='Ref_to_Proto'>bms_equal</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN630"><span class='Ref_To_Local'>cur_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN821"><span class='Ref_to_Member'>em_relids</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN587"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * If below an outer join, don't match constants: they're not as 
             * constant as they look. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN612"><span class='Ref_To_Local'>cur_ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN779"><span class='Ref_to_Member'>ec_below_outer_join</span></a> <span class='Operator'>&& 
</span>                <a href="equivclass.c.html#LN630"><span class='Ref_To_Local'>cur_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN823"><span class='Ref_to_Member'>em_is_const</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN584"><span class='Ref_to_Parameter'>opcintype</span></a> <span class='Operator'>== </span><a href="equivclass.c.html#LN630"><span class='Ref_To_Local'>cur_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN825"><span class='Ref_to_Member'>em_datatype</span></a> <span class='Operator'>&& 
</span>                <a href="../../../include/nodes/nodes.h.html#LN626"><span class='Ref_to_Proto'>equal</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN581"><span class='Ref_to_Parameter'>expr</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN630"><span class='Ref_To_Local'>cur_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN820"><span class='Ref_to_Member'>em_expr</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <a href="equivclass.c.html#LN612"><span class='Ref_To_Local'>cur_ec</span></a><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* Match! */ 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* No match; does caller want a NULL result? */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="equivclass.c.html#LN588"><span class='Ref_to_Parameter'>create_it</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * OK, build a new single-member EC 
     * 
     * Here, we must be sure that we construct the EC in the right context. 
     */ 
</span>    <a href="equivclass.c.html#LN594"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN580"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN286"><span class='Ref_to_Member'>planner_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="equivclass.c.html#LN591"><span class='Ref_To_Local'>newec</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="equivclass.c.html#LN591"><span class='Ref_To_Local'>newec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN770"><span class='Ref_to_Member'>ec_opfamilies</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN268"><span class='Ref_to_Proto'>list_copy</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN583"><span class='Ref_to_Parameter'>opfamilies</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="equivclass.c.html#LN591"><span class='Ref_To_Local'>newec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN771"><span class='Ref_to_Member'>ec_collation</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN585"><span class='Ref_to_Parameter'>collation</span></a><span class='Delimiter'>; 
</span>    <a href="equivclass.c.html#LN591"><span class='Ref_To_Local'>newec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN772"><span class='Ref_to_Member'>ec_members</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="equivclass.c.html#LN591"><span class='Ref_To_Local'>newec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN773"><span class='Ref_to_Member'>ec_sources</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="equivclass.c.html#LN591"><span class='Ref_To_Local'>newec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN774"><span class='Ref_to_Member'>ec_derives</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="equivclass.c.html#LN591"><span class='Ref_To_Local'>newec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN775"><span class='Ref_to_Member'>ec_relids</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="equivclass.c.html#LN591"><span class='Ref_To_Local'>newec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN777"><span class='Ref_to_Member'>ec_has_const</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="equivclass.c.html#LN591"><span class='Ref_To_Local'>newec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN778"><span class='Ref_to_Member'>ec_has_volatile</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/clauses.h.html#LN60"><span class='Ref_to_Proto'>contain_volatile_functions</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="equivclass.c.html#LN581"><span class='Ref_to_Parameter'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="equivclass.c.html#LN591"><span class='Ref_To_Local'>newec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN779"><span class='Ref_to_Member'>ec_below_outer_join</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="equivclass.c.html#LN591"><span class='Ref_To_Local'>newec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN780"><span class='Ref_to_Member'>ec_broken</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="equivclass.c.html#LN591"><span class='Ref_To_Local'>newec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN781"><span class='Ref_to_Member'>ec_sortref</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN586"><span class='Ref_to_Parameter'>sortref</span></a><span class='Delimiter'>; 
</span>    <a href="equivclass.c.html#LN591"><span class='Ref_To_Local'>newec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN782"><span class='Ref_to_Member'>ec_min_security</span></a> <span class='Operator'>= </span>UINT_MAX<span class='Delimiter'>; 
</span>    <a href="equivclass.c.html#LN591"><span class='Ref_To_Local'>newec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN783"><span class='Ref_to_Member'>ec_max_security</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="equivclass.c.html#LN591"><span class='Ref_To_Local'>newec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN784"><span class='Ref_to_Member'>ec_merged</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN591"><span class='Ref_To_Local'>newec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN778"><span class='Ref_to_Member'>ec_has_volatile</span></a> <span class='Operator'>&& </span><a href="equivclass.c.html#LN586"><span class='Ref_to_Parameter'>sortref</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Comment_Single_Line'>/* should not happen */ 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"volatile EquivalenceClass has no sortref"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="equivclass.c.html#LN592"><span class='Ref_To_Local'>newem</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN33"><span class='Ref_to_Proto'>add_eq_member</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN591"><span class='Ref_To_Local'>newec</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN581"><span class='Ref_to_Parameter'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="equivclass.c.html#LN590"><span class='Ref_To_Local'>expr_relids</span></a><span class='Delimiter'>, 
</span>                          <a href="equivclass.c.html#LN582"><span class='Ref_to_Parameter'>nullable_relids</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="equivclass.c.html#LN584"><span class='Ref_to_Parameter'>opcintype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * add_eq_member doesn't check for volatile functions, set-returning 
     * functions, aggregates, or window functions, but such could appear in 
     * sort expressions; so we have to check whether its const-marking was 
     * correct. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN591"><span class='Ref_To_Local'>newec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN777"><span class='Ref_to_Member'>ec_has_const</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN591"><span class='Ref_To_Local'>newec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN778"><span class='Ref_to_Member'>ec_has_volatile</span></a> <span class='Operator'>|| 
</span>            <a href="../../../include/nodes/nodeFuncs.h.html#LN36"><span class='Ref_to_Proto'>expression_returns_set</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="equivclass.c.html#LN581"><span class='Ref_to_Parameter'>expr</span></a><span class='Parentheses'>)</span> <span class='Operator'>|| 
</span>            <a href="../../../include/optimizer/clauses.h.html#LN48"><span class='Ref_to_Proto'>contain_agg_clause</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="equivclass.c.html#LN581"><span class='Ref_to_Parameter'>expr</span></a><span class='Parentheses'>)</span> <span class='Operator'>|| 
</span>            <a href="../../../include/optimizer/clauses.h.html#LN52"><span class='Ref_to_Proto'>contain_window_function</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="equivclass.c.html#LN581"><span class='Ref_to_Parameter'>expr</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="equivclass.c.html#LN591"><span class='Ref_To_Local'>newec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN777"><span class='Ref_to_Member'>ec_has_const</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="equivclass.c.html#LN592"><span class='Ref_To_Local'>newem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN823"><span class='Ref_to_Member'>em_is_const</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="equivclass.c.html#LN580"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN234"><span class='Ref_to_Member'>eq_classes</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN580"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN234"><span class='Ref_to_Member'>eq_classes</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN591"><span class='Ref_To_Local'>newec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN594"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="equivclass.c.html#LN591"><span class='Ref_To_Local'>newec</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_eclass_for_sort_expr &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * generate_base_implied_equalities 
 *    Generate any restriction clauses that we can deduce from equivalence 
 *    classes. 
 * 
 * When an EC contains pseudoconstants, our strategy is to generate 
 * "member = const1" clauses where const1 is the first constant member, for 
 * every other member (including other constants).  If we are able to do this 
 * then we don't need any "var = var" comparisons because we've successfully 
 * constrained all the vars at their points of creation.  If we fail to 
 * generate any of these clauses due to lack of cross-type operators, we fall 
 * back to the "ec_broken" strategy described below.  (XXX if there are 
 * multiple constants of different types, it's possible that we might succeed 
 * in forming all the required clauses if we started from a different const 
 * member; but this seems a sufficiently hokey corner case to not be worth 
 * spending lots of cycles on.) 
 * 
 * For ECs that contain no pseudoconstants, we generate derived clauses 
 * "member1 = member2" for each pair of members belonging to the same base 
 * relation (actually, if there are more than two for the same base relation, 
 * we only need enough clauses to link each to each other).  This provides 
 * the base case for the recursion: each row emitted by a base relation scan 
 * will constrain all computable members of the EC to be equal.  As each 
 * join path is formed, we'll add additional derived clauses on-the-fly 
 * to maintain this invariant (see generate_join_implied_equalities). 
 * 
 * If the opfamilies used by the EC do not provide complete sets of cross-type 
 * equality operators, it is possible that we will fail to generate a clause 
 * that must be generated to maintain the invariant.  (An example: given 
 * "WHERE a.x = b.y AND b.y = a.z", the scheme breaks down if we cannot 
 * generate "a.x = a.z" as a restriction clause for A.)  In this case we mark 
 * the EC "ec_broken" and fall back to regurgitating its original source 
 * RestrictInfos at appropriate times.  We do not try to retract any derived 
 * clauses already generated from the broken EC, so the resulting plan could 
 * be poor due to bad selectivity estimates caused by redundant clauses.  But 
 * the correct solution to that is to fix the opfamilies ... 
 * 
 * Equality clauses derived by this function are passed off to 
 * process_implied_equality (in plan/initsplan.c) to be inserted into the 
 * restrictinfo datastructures.  Note that this must be called after initial 
 * scanning of the quals and before Path construction begins. 
 * 
 * We make no attempt to avoid generating duplicate RestrictInfos here: we 
 * don't search ec_sources for matches, nor put the created RestrictInfos 
 * into ec_derives.  Doing so would require some slightly ugly changes in 
 * initsplan.c's API, and there's no real advantage, because the clauses 
 * generated here can't duplicate anything we will generate for joins anyway. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN761"></a><span class='Declare_Function'>generate_base_implied_equalities</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN763"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span><a name="LN764"></a>    <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a>       <span class='Declare_Local'>rti</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN763"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN761"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN234"><span class='Ref_to_Member'>eq_classes</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN768"></a>        <a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ec</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN763"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="equivclass.c.html#LN768"><span class='Ref_To_Local'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN784"><span class='Ref_to_Member'>ec_merged</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* else shouldn't be in list */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="equivclass.c.html#LN768"><span class='Ref_To_Local'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN780"><span class='Ref_to_Member'>ec_broken</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* not yet anyway... */ 
</span> 
        <span class='Comment_Multi_Line'>/* Single-member ECs won't generate any deductions */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN768"><span class='Ref_To_Local'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN772"><span class='Ref_to_Member'>ec_members</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN768"><span class='Ref_To_Local'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN777"><span class='Ref_to_Member'>ec_has_const</span></a><span class='Parentheses'>) 
</span>            <a href="equivclass.c.html#LN36"><span class='Ref_to_Proto'>generate_base_implied_equalities_const</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN761"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN768"><span class='Ref_To_Local'>ec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="equivclass.c.html#LN38"><span class='Ref_to_Proto'>generate_base_implied_equalities_no_const</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN761"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN768"><span class='Ref_To_Local'>ec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Recover if we failed to generate required derived clauses */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN768"><span class='Ref_To_Local'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN780"><span class='Ref_to_Member'>ec_broken</span></a><span class='Parentheses'>) 
</span>            <a href="equivclass.c.html#LN40"><span class='Ref_to_Proto'>generate_base_implied_equalities_broken</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN761"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN768"><span class='Ref_To_Local'>ec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * This is also a handy place to mark base rels (which should all exist by 
     * now) with flags showing whether they have pending eclass joins. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN764"><span class='Ref_To_Local'>rti</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="equivclass.c.html#LN764"><span class='Ref_To_Local'>rti</span></a> <span class='Operator'>&LT; </span><a href="equivclass.c.html#LN761"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN179"><span class='Ref_to_Member'>simple_rel_array_size</span></a><span class='Delimiter'>; </span><a href="equivclass.c.html#LN764"><span class='Ref_To_Local'>rti</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN793"></a>        <a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>brel</span> <span class='Operator'>= </span><a href="equivclass.c.html#LN761"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN178"><span class='Ref_to_Member'>simple_rel_array</span></a><span class='Delimiter'>[</span><a href="equivclass.c.html#LN764"><span class='Ref_To_Local'>rti</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN793"><span class='Ref_To_Local'>brel</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <a href="equivclass.c.html#LN793"><span class='Ref_To_Local'>brel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN590"><span class='Ref_to_Member'>has_eclass_joins</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/paths.h.html#LN163"><span class='Ref_to_Proto'>has_relevant_eclass_joinclause</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN761"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN793"><span class='Ref_To_Local'>brel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end generate_base_implied_equalities &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * generate_base_implied_equalities when EC contains pseudoconstant(s) 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN806"></a><span class='Declare_Function'>generate_base_implied_equalities_const</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN807"></a>                                       <a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ec</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN809"></a>    <a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Declare_Local'>const_em</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN810"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * In the trivial case where we just had one "var = const" clause, push 
     * the original clause back into the main planner machinery.  There is 
     * nothing to be gained by doing it differently, and we save the effort to 
     * re-build and re-analyze an equality clause that will be exactly 
     * equivalent to the old one. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN807"><span class='Ref_to_Parameter'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN772"><span class='Ref_to_Member'>ec_members</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>2</span> <span class='Operator'>&& 
</span>        <a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN807"><span class='Ref_to_Parameter'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN773"><span class='Ref_to_Member'>ec_sources</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN822"></a>        <a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>restrictinfo</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN807"><span class='Ref_to_Parameter'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN773"><span class='Ref_to_Member'>ec_sources</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/bitmapset.h.html#LN84"><span class='Ref_to_Proto'>bms_membership</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN822"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1764"><span class='Ref_to_Member'>required_relids</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../../include/nodes/bitmapset.h.html#LN57"><span class='Ref_to_EnumConst'>BMS_MULTIPLE</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../../include/optimizer/planmain.h.html#LN80"><span class='Ref_to_Proto'>distribute_restrictinfo_to_rels</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN806"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN822"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Find the constant member to use.  We prefer an actual constant to 
     * pseudo-constants (such as Params), because the constraint exclusion 
     * machinery might be able to exclude relations on the basis of generated 
     * "var = const" equalities, but "var = param" won't work for that. 
     */ 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN810"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN807"><span class='Ref_to_Parameter'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN772"><span class='Ref_to_Member'>ec_members</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN839"></a>        <a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cur_em</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN810"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN839"><span class='Ref_To_Local'>cur_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN823"><span class='Ref_to_Member'>em_is_const</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="equivclass.c.html#LN809"><span class='Ref_To_Local'>const_em</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN839"><span class='Ref_To_Local'>cur_em</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN839"><span class='Ref_To_Local'>cur_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN820"><span class='Ref_to_Member'>em_expr</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="equivclass.c.html#LN809"><span class='Ref_To_Local'>const_em</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Generate a derived equality against each other member */ 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN810"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN807"><span class='Ref_to_Parameter'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN772"><span class='Ref_to_Member'>ec_members</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN853"></a>        <a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cur_em</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN810"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN854"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>eq_op</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="equivclass.c.html#LN853"><span class='Ref_To_Local'>cur_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN824"><span class='Ref_to_Member'>em_is_child</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* no children yet */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN853"><span class='Ref_To_Local'>cur_em</span></a> <span class='Operator'>== </span><a href="equivclass.c.html#LN809"><span class='Ref_To_Local'>const_em</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN854"><span class='Ref_To_Local'>eq_op</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN53"><span class='Ref_to_Proto'>select_equality_operator</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN807"><span class='Ref_to_Parameter'>ec</span></a><span class='Delimiter'>, 
</span>                                         <a href="equivclass.c.html#LN853"><span class='Ref_To_Local'>cur_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN825"><span class='Ref_to_Member'>em_datatype</span></a><span class='Delimiter'>, 
</span>                                         <a href="equivclass.c.html#LN809"><span class='Ref_To_Local'>const_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN825"><span class='Ref_to_Member'>em_datatype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN854"><span class='Ref_To_Local'>eq_op</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* failed... */ 
</span>            <a href="equivclass.c.html#LN807"><span class='Ref_to_Parameter'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN780"><span class='Ref_to_Member'>ec_broken</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../../include/optimizer/planmain.h.html#LN82"><span class='Ref_to_Proto'>process_implied_equality</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN806"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN854"><span class='Ref_To_Local'>eq_op</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN807"><span class='Ref_to_Parameter'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN771"><span class='Ref_to_Member'>ec_collation</span></a><span class='Delimiter'>, 
</span>                                 <a href="equivclass.c.html#LN853"><span class='Ref_To_Local'>cur_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN820"><span class='Ref_to_Member'>em_expr</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN809"><span class='Ref_To_Local'>const_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN820"><span class='Ref_to_Member'>em_expr</span></a><span class='Delimiter'>, 
</span>                                 <a href="../../../include/nodes/bitmapset.h.html#LN65"><span class='Ref_to_Proto'>bms_copy</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN807"><span class='Ref_to_Parameter'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN775"><span class='Ref_to_Member'>ec_relids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../../../include/nodes/bitmapset.h.html#LN70"><span class='Ref_to_Proto'>bms_union</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN853"><span class='Ref_To_Local'>cur_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN822"><span class='Ref_to_Member'>em_nullable_relids</span></a><span class='Delimiter'>, 
</span>                                           <a href="equivclass.c.html#LN809"><span class='Ref_To_Local'>const_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN822"><span class='Ref_to_Member'>em_nullable_relids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="equivclass.c.html#LN807"><span class='Ref_to_Parameter'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN782"><span class='Ref_to_Member'>ec_min_security</span></a><span class='Delimiter'>, 
</span>                                 <a href="equivclass.c.html#LN807"><span class='Ref_to_Parameter'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN779"><span class='Ref_to_Member'>ec_below_outer_join</span></a><span class='Delimiter'>, 
</span>                                 <a href="equivclass.c.html#LN853"><span class='Ref_To_Local'>cur_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN823"><span class='Ref_to_Member'>em_is_const</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end generate_base_implied_equalities_const &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * generate_base_implied_equalities when EC contains no pseudoconstants 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN883"></a><span class='Declare_Function'>generate_base_implied_equalities_no_const</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN884"></a>                                          <a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ec</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN886"></a>    <a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>**</span><span class='Declare_Local'>prev_ems</span><span class='Delimiter'>; 
</span><a name="LN887"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We scan the EC members once and track the last-seen member for each 
     * base relation.  When we see another member of the same base relation, 
     * we generate "prev_mem = cur_mem".  This results in the minimum number 
     * of derived clauses, but it's possible that it will fail when a 
     * different ordering would succeed.  XXX FIXME: use a UNION-FIND 
     * algorithm similar to the way we build merged ECs.  (Use a list-of-lists 
     * for each rel.) 
     */ 
</span>    <a href="equivclass.c.html#LN886"><span class='Ref_To_Local'>prev_ems</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>**</span><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN883"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN179"><span class='Ref_to_Member'>simple_rel_array_size</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN887"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN884"><span class='Ref_to_Parameter'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN772"><span class='Ref_to_Member'>ec_members</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN903"></a>        <a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cur_em</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN887"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN904"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>relid</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="equivclass.c.html#LN903"><span class='Ref_To_Local'>cur_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN824"><span class='Ref_to_Member'>em_is_child</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* no children yet */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/bitmapset.h.html#LN80"><span class='Ref_to_Proto'>bms_get_singleton_member</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN903"><span class='Ref_To_Local'>cur_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN821"><span class='Ref_to_Member'>em_relids</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="equivclass.c.html#LN904"><span class='Ref_To_Local'>relid</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="equivclass.c.html#LN904"><span class='Ref_To_Local'>relid</span></a> <span class='Operator'>&LT; </span><a href="equivclass.c.html#LN883"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN179"><span class='Ref_to_Member'>simple_rel_array_size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN886"><span class='Ref_To_Local'>prev_ems</span></a><span class='Delimiter'>[</span><a href="equivclass.c.html#LN904"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN913"></a>            <a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Declare_Local'>prev_em</span> <span class='Operator'>= </span><a href="equivclass.c.html#LN886"><span class='Ref_To_Local'>prev_ems</span></a><span class='Delimiter'>[</span><a href="equivclass.c.html#LN904"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>]; 
</span><a name="LN914"></a>            <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>eq_op</span><span class='Delimiter'>; 
</span> 
            <a href="equivclass.c.html#LN914"><span class='Ref_To_Local'>eq_op</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN53"><span class='Ref_to_Proto'>select_equality_operator</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN884"><span class='Ref_to_Parameter'>ec</span></a><span class='Delimiter'>, 
</span>                                             <a href="equivclass.c.html#LN913"><span class='Ref_To_Local'>prev_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN825"><span class='Ref_to_Member'>em_datatype</span></a><span class='Delimiter'>, 
</span>                                             <a href="equivclass.c.html#LN903"><span class='Ref_To_Local'>cur_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN825"><span class='Ref_to_Member'>em_datatype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN914"><span class='Ref_To_Local'>eq_op</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* failed... */ 
</span>                <a href="equivclass.c.html#LN884"><span class='Ref_to_Parameter'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN780"><span class='Ref_to_Member'>ec_broken</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="../../../include/optimizer/planmain.h.html#LN82"><span class='Ref_to_Proto'>process_implied_equality</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN883"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN914"><span class='Ref_To_Local'>eq_op</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN884"><span class='Ref_to_Parameter'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN771"><span class='Ref_to_Member'>ec_collation</span></a><span class='Delimiter'>, 
</span>                                     <a href="equivclass.c.html#LN913"><span class='Ref_To_Local'>prev_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN820"><span class='Ref_to_Member'>em_expr</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN903"><span class='Ref_To_Local'>cur_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN820"><span class='Ref_to_Member'>em_expr</span></a><span class='Delimiter'>, 
</span>                                     <a href="../../../include/nodes/bitmapset.h.html#LN65"><span class='Ref_to_Proto'>bms_copy</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN884"><span class='Ref_to_Parameter'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN775"><span class='Ref_to_Member'>ec_relids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                     <a href="../../../include/nodes/bitmapset.h.html#LN70"><span class='Ref_to_Proto'>bms_union</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN913"><span class='Ref_To_Local'>prev_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN822"><span class='Ref_to_Member'>em_nullable_relids</span></a><span class='Delimiter'>, 
</span>                                               <a href="equivclass.c.html#LN903"><span class='Ref_To_Local'>cur_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN822"><span class='Ref_to_Member'>em_nullable_relids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                     <a href="equivclass.c.html#LN884"><span class='Ref_to_Parameter'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN782"><span class='Ref_to_Member'>ec_min_security</span></a><span class='Delimiter'>, 
</span>                                     <a href="equivclass.c.html#LN884"><span class='Ref_to_Parameter'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN779"><span class='Ref_to_Member'>ec_below_outer_join</span></a><span class='Delimiter'>, 
</span>                                     <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if prev_ems[relid]!=NULL &raquo; </span> 
        <a href="equivclass.c.html#LN886"><span class='Ref_To_Local'>prev_ems</span></a><span class='Delimiter'>[</span><a href="equivclass.c.html#LN904"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="equivclass.c.html#LN903"><span class='Ref_To_Local'>cur_em</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN886"><span class='Ref_To_Local'>prev_ems</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We also have to make sure that all the Vars used in the member clauses 
     * will be available at any join node we might try to reference them at. 
     * For the moment we force all the Vars to be available at all join nodes 
     * for this eclass.  Perhaps this could be improved by doing some 
     * pre-analysis of which members we prefer to join, but it's no worse than 
     * what happened in the pre-8.3 code. 
     */ 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN887"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN884"><span class='Ref_to_Parameter'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN772"><span class='Ref_to_Member'>ec_members</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN949"></a>        <a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cur_em</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN887"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN950"></a>        <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>vars</span> <span class='Operator'>= </span><a href="../../../include/optimizer/var.h.html#LN36"><span class='Ref_to_Proto'>pull_var_clause</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="equivclass.c.html#LN949"><span class='Ref_To_Local'>cur_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN820"><span class='Ref_to_Member'>em_expr</span></a><span class='Delimiter'>, 
</span>                                           <a href="../../../include/optimizer/var.h.html#LN20"><span class='Ref_to_Const'>PVC_RECURSE_AGGREGATES</span></a> <span class='Operator'>| 
</span>                                           <a href="../../../include/optimizer/var.h.html#LN22"><span class='Ref_to_Const'>PVC_RECURSE_WINDOWFUNCS</span></a> <span class='Operator'>| 
</span>                                           <a href="../../../include/optimizer/var.h.html#LN23"><span class='Ref_to_Const'>PVC_INCLUDE_PLACEHOLDERS</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/optimizer/planmain.h.html#LN75"><span class='Ref_to_Proto'>add_vars_to_targetlist</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN883"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN950"><span class='Ref_To_Local'>vars</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN884"><span class='Ref_to_Parameter'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN775"><span class='Ref_to_Member'>ec_relids</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN950"><span class='Ref_To_Local'>vars</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end generate_base_implied_equalities_no_const &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * generate_base_implied_equalities cleanup after failure 
 * 
 * What we must do here is push any zero- or one-relation source RestrictInfos 
 * of the EC back into the main restrictinfo datastructures.  Multi-relation 
 * clauses will be regurgitated later by generate_join_implied_equalities(). 
 * (We do it this way to maintain continuity with the case that ec_broken 
 * becomes set only after we've gone up a join level or two.)  However, for 
 * an EC that contains constants, we can adopt a simpler strategy and just 
 * throw back all the source RestrictInfos immediately; that works because 
 * we know that such an EC can't become broken later.  (This rule justifies 
 * ignoring ec_has_const ECs in generate_join_implied_equalities, even when 
 * they are broken.) 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN975"></a><span class='Declare_Function'>generate_base_implied_equalities_broken</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN976"></a>                                        <a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ec</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN978"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN978"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN976"><span class='Ref_to_Parameter'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN773"><span class='Ref_to_Member'>ec_sources</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN982"></a>        <a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>restrictinfo</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN978"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN976"><span class='Ref_to_Parameter'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN777"><span class='Ref_to_Member'>ec_has_const</span></a> <span class='Operator'>|| 
</span>            <a href="../../../include/nodes/bitmapset.h.html#LN84"><span class='Ref_to_Proto'>bms_membership</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN982"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1764"><span class='Ref_to_Member'>required_relids</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../../include/nodes/bitmapset.h.html#LN57"><span class='Ref_to_EnumConst'>BMS_MULTIPLE</span></a><span class='Parentheses'>)</span> 
            <a href="../../../include/optimizer/planmain.h.html#LN80"><span class='Ref_to_Proto'>distribute_restrictinfo_to_rels</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN975"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN982"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * generate_join_implied_equalities 
 *    Generate any join clauses that we can deduce from equivalence classes. 
 * 
 * At a join node, we must enforce restriction clauses sufficient to ensure 
 * that all equivalence-class members computable at that node are equal. 
 * Since the set of clauses to enforce can vary depending on which subset 
 * relations are the inputs, we have to compute this afresh for each join 
 * relation pair.  Hence a fresh List of RestrictInfo nodes is built and 
 * passed back on each call. 
 * 
 * In addition to its use at join nodes, this can be applied to generate 
 * eclass-based join clauses for use in a parameterized scan of a base rel. 
 * The reason for the asymmetry of specifying the inner rel as a RelOptInfo 
 * and the outer rel by Relids is that this usage occurs before we have 
 * built any join RelOptInfos. 
 * 
 * An annoying special case for parameterized scans is that the inner rel can 
 * be an appendrel child (an "other rel").  In this case we must generate 
 * appropriate clauses using child EC members.  add_child_rel_equivalences 
 * must already have been done for the child rel. 
 * 
 * The results are sufficient for use in merge, hash, and plain nestloop join 
 * methods.  We do not worry here about selecting clauses that are optimal 
 * for use in a parameterized indexscan.  indxpath.c makes its own selections 
 * of clauses to use, and if the ones we pick here are redundant with those, 
 * the extras will be eliminated at createplan time, using the parent_ec 
 * markers that we provide (see is_redundant_derived_clause()). 
 * 
 * Because the same join clauses are likely to be needed multiple times as 
 * we consider different join paths, we avoid generating multiple copies: 
 * whenever we select a particular pair of EquivalenceMembers to join, 
 * we check to see if the pair matches any original clause (in ec_sources) 
 * or previously-built clause (in ec_derives).  This saves memory and allows 
 * re-use of information cached in RestrictInfos. 
 * 
 * join_relids should always equal bms_union(outer_relids, inner_rel-&GT;relids). 
 * We could simplify this function's API by computing it internally, but in 
 * most current uses, the caller has the value at hand anyway. 
 */ 
</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN1032"></a><span class='Declare_Function'>generate_join_implied_equalities</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN1033"></a>                                 <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>join_relids</span><span class='Delimiter'>, 
</span><a name="LN1034"></a>                                 <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>outer_relids</span><span class='Delimiter'>, 
</span><a name="LN1035"></a>                                 <a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>inner_rel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="../../../include/optimizer/paths.h.html#LN143"><span class='Ref_to_Proto'>generate_join_implied_equalities_for_ecs</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1032"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                                    <a href="equivclass.c.html#LN1032"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN234"><span class='Ref_to_Member'>eq_classes</span></a><span class='Delimiter'>, 
</span>                                                    <a href="equivclass.c.html#LN1033"><span class='Ref_to_Parameter'>join_relids</span></a><span class='Delimiter'>, 
</span>                                                    <a href="equivclass.c.html#LN1034"><span class='Ref_to_Parameter'>outer_relids</span></a><span class='Delimiter'>, 
</span>                                                    <a href="equivclass.c.html#LN1035"><span class='Ref_to_Parameter'>inner_rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * generate_join_implied_equalities_for_ecs 
 *    As above, but consider only the listed ECs. 
 */ 
</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN1049"></a><span class='Declare_Function'>generate_join_implied_equalities_for_ecs</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN1050"></a>                                         <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>eclasses</span><span class='Delimiter'>, 
</span><a name="LN1051"></a>                                         <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>join_relids</span><span class='Delimiter'>, 
</span><a name="LN1052"></a>                                         <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>outer_relids</span><span class='Delimiter'>, 
</span><a name="LN1053"></a>                                         <a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>inner_rel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1055"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN1056"></a>    <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a>      <span class='Declare_Local'>inner_relids</span> <span class='Operator'>= </span><a href="equivclass.c.html#LN1053"><span class='Ref_to_Parameter'>inner_rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN524"><span class='Ref_to_Member'>relids</span></a><span class='Delimiter'>; 
</span><a name="LN1057"></a>    <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a>      <span class='Declare_Local'>nominal_inner_relids</span><span class='Delimiter'>; 
</span><a name="LN1058"></a>    <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a>      <span class='Declare_Local'>nominal_join_relids</span><span class='Delimiter'>; 
</span><a name="LN1059"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If inner rel is a child, extra setup work is needed */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN515"><span class='Ref_to_Macro'>IS_OTHER_REL</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1053"><span class='Ref_to_Parameter'>inner_rel</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/bitmapset.h.html#LN85"><span class='Ref_to_Proto'>bms_is_empty</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1053"><span class='Ref_to_Parameter'>inner_rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN593"><span class='Ref_to_Member'>top_parent_relids</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Fetch relid set for the topmost parent rel */ 
</span>        <a href="equivclass.c.html#LN1057"><span class='Ref_To_Local'>nominal_inner_relids</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN1053"><span class='Ref_to_Parameter'>inner_rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN593"><span class='Ref_to_Member'>top_parent_relids</span></a><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* ECs will be marked with the parent's relid, not the child's */ 
</span>        <a href="equivclass.c.html#LN1058"><span class='Ref_To_Local'>nominal_join_relids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN70"><span class='Ref_to_Proto'>bms_union</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1052"><span class='Ref_to_Parameter'>outer_relids</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1057"><span class='Ref_To_Local'>nominal_inner_relids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="equivclass.c.html#LN1057"><span class='Ref_To_Local'>nominal_inner_relids</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN1056"><span class='Ref_To_Local'>inner_relids</span></a><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN1058"><span class='Ref_To_Local'>nominal_join_relids</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN1051"><span class='Ref_to_Parameter'>join_relids</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1059"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1050"><span class='Ref_to_Parameter'>eclasses</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1079"></a>        <a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ec</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1059"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1080"></a>        <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>sublist</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* ECs containing consts do not need any further enforcement */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN1079"><span class='Ref_To_Local'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN777"><span class='Ref_to_Member'>ec_has_const</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Single-member ECs won't generate any deductions */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1079"><span class='Ref_To_Local'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN772"><span class='Ref_to_Member'>ec_members</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* We can quickly ignore any that don't overlap the join, too */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/bitmapset.h.html#LN76"><span class='Ref_to_Proto'>bms_overlap</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1079"><span class='Ref_To_Local'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN775"><span class='Ref_to_Member'>ec_relids</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1058"><span class='Ref_To_Local'>nominal_join_relids</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="equivclass.c.html#LN1079"><span class='Ref_To_Local'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN780"><span class='Ref_to_Member'>ec_broken</span></a><span class='Parentheses'>) 
</span>            <a href="equivclass.c.html#LN1080"><span class='Ref_To_Local'>sublist</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN42"><span class='Ref_to_Proto'>generate_join_implied_equalities_normal</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1049"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                                              <a href="equivclass.c.html#LN1079"><span class='Ref_To_Local'>ec</span></a><span class='Delimiter'>, 
</span>                                                              <a href="equivclass.c.html#LN1051"><span class='Ref_to_Parameter'>join_relids</span></a><span class='Delimiter'>, 
</span>                                                              <a href="equivclass.c.html#LN1052"><span class='Ref_to_Parameter'>outer_relids</span></a><span class='Delimiter'>, 
</span>                                                              <a href="equivclass.c.html#LN1056"><span class='Ref_To_Local'>inner_relids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Recover if we failed to generate required derived clauses */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN1079"><span class='Ref_To_Local'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN780"><span class='Ref_to_Member'>ec_broken</span></a><span class='Parentheses'>) 
</span>            <a href="equivclass.c.html#LN1080"><span class='Ref_To_Local'>sublist</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN47"><span class='Ref_to_Proto'>generate_join_implied_equalities_broken</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1049"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                                              <a href="equivclass.c.html#LN1079"><span class='Ref_To_Local'>ec</span></a><span class='Delimiter'>, 
</span>                                                         <a href="equivclass.c.html#LN1058"><span class='Ref_To_Local'>nominal_join_relids</span></a><span class='Delimiter'>, 
</span>                                                              <a href="equivclass.c.html#LN1052"><span class='Ref_to_Parameter'>outer_relids</span></a><span class='Delimiter'>, 
</span>                                                        <a href="equivclass.c.html#LN1057"><span class='Ref_To_Local'>nominal_inner_relids</span></a><span class='Delimiter'>, 
</span>                                                              <a href="equivclass.c.html#LN1053"><span class='Ref_to_Parameter'>inner_rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="equivclass.c.html#LN1055"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1055"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1080"><span class='Ref_To_Local'>sublist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="equivclass.c.html#LN1055"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end generate_join_implied_equalities_for_ecs &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * generate_join_implied_equalities for a still-valid EC 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN1120"></a><span class='Declare_Function'>generate_join_implied_equalities_normal</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN1121"></a>                                        <a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ec</span><span class='Delimiter'>, 
</span><a name="LN1122"></a>                                        <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>join_relids</span><span class='Delimiter'>, 
</span><a name="LN1123"></a>                                        <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>outer_relids</span><span class='Delimiter'>, 
</span><a name="LN1124"></a>                                        <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>inner_relids</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1126"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN1127"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>new_members</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN1128"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>outer_members</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN1129"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>inner_members</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN1130"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * First, scan the EC to identify member values that are computable at the 
     * outer rel, at the inner rel, or at this relation but not in either 
     * input rel.  The outer-rel members should already be enforced equal, 
     * likewise for the inner-rel members.  We'll need to create clauses to 
     * enforce that any newly computable members are all equal to each other 
     * as well as to at least one input member, plus enforce at least one 
     * outer-rel member equal to at least one inner-rel member. 
     */ 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1130"><span class='Ref_To_Local'>lc1</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1121"><span class='Ref_to_Parameter'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN772"><span class='Ref_to_Member'>ec_members</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1143"></a>        <a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cur_em</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1130"><span class='Ref_To_Local'>lc1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We don't need to check explicitly for child EC members.  This test 
         * against join_relids will cause them to be ignored except when 
         * considering a child inner rel, which is what we want. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/bitmapset.h.html#LN73"><span class='Ref_to_Proto'>bms_is_subset</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1143"><span class='Ref_To_Local'>cur_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN821"><span class='Ref_to_Member'>em_relids</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1122"><span class='Ref_to_Parameter'>join_relids</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* not computable yet, or wrong child */ 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/bitmapset.h.html#LN73"><span class='Ref_to_Proto'>bms_is_subset</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1143"><span class='Ref_To_Local'>cur_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN821"><span class='Ref_to_Member'>em_relids</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1123"><span class='Ref_to_Parameter'>outer_relids</span></a><span class='Parentheses'>))</span> 
            <a href="equivclass.c.html#LN1128"><span class='Ref_To_Local'>outer_members</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1128"><span class='Ref_To_Local'>outer_members</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1143"><span class='Ref_To_Local'>cur_em</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/bitmapset.h.html#LN73"><span class='Ref_to_Proto'>bms_is_subset</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1143"><span class='Ref_To_Local'>cur_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN821"><span class='Ref_to_Member'>em_relids</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1124"><span class='Ref_to_Parameter'>inner_relids</span></a><span class='Parentheses'>))</span> 
            <a href="equivclass.c.html#LN1129"><span class='Ref_To_Local'>inner_members</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1129"><span class='Ref_To_Local'>inner_members</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1143"><span class='Ref_To_Local'>cur_em</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="equivclass.c.html#LN1127"><span class='Ref_To_Local'>new_members</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1127"><span class='Ref_To_Local'>new_members</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1143"><span class='Ref_To_Local'>cur_em</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * First, select the joinclause if needed.  We can equate any one outer 
     * member to any one inner member, but we have to find a datatype 
     * combination for which an opfamily member operator exists.  If we have 
     * choices, we prefer simple Var members (possibly with RelabelType) since 
     * these are (a) cheapest to compute at runtime and (b) most likely to 
     * have useful statistics. Also, prefer operators that are also 
     * hashjoinable. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN1128"><span class='Ref_To_Local'>outer_members</span></a> <span class='Operator'>&& </span><a href="equivclass.c.html#LN1129"><span class='Ref_To_Local'>inner_members</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1172"></a>        <a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Declare_Local'>best_outer_em</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1173"></a>        <a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Declare_Local'>best_inner_em</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1174"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>best_eq_op</span> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span><a name="LN1175"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>best_score</span> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span><a name="LN1176"></a>        <a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rinfo</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1130"><span class='Ref_To_Local'>lc1</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1128"><span class='Ref_To_Local'>outer_members</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1180"></a>            <a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Declare_Local'>outer_em</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1130"><span class='Ref_To_Local'>lc1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1181"></a>            <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc2</span><span class='Delimiter'>; 
</span> 
            <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1181"><span class='Ref_To_Local'>lc2</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1129"><span class='Ref_To_Local'>inner_members</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1185"></a>                <a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Declare_Local'>inner_em</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1181"><span class='Ref_To_Local'>lc2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1186"></a>                <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>eq_op</span><span class='Delimiter'>; 
</span><a name="LN1187"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>score</span><span class='Delimiter'>; 
</span> 
                <a href="equivclass.c.html#LN1186"><span class='Ref_To_Local'>eq_op</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN53"><span class='Ref_to_Proto'>select_equality_operator</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1121"><span class='Ref_to_Parameter'>ec</span></a><span class='Delimiter'>, 
</span>                                                 <a href="equivclass.c.html#LN1180"><span class='Ref_To_Local'>outer_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN825"><span class='Ref_to_Member'>em_datatype</span></a><span class='Delimiter'>, 
</span>                                                 <a href="equivclass.c.html#LN1185"><span class='Ref_To_Local'>inner_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN825"><span class='Ref_to_Member'>em_datatype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1186"><span class='Ref_To_Local'>eq_op</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                <a href="equivclass.c.html#LN1187"><span class='Ref_To_Local'>score</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1180"><span class='Ref_To_Local'>outer_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN820"><span class='Ref_to_Member'>em_expr</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a><span class='Parentheses'>)</span> <span class='Operator'>|| 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1180"><span class='Ref_To_Local'>outer_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN820"><span class='Ref_to_Member'>em_expr</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN786"><span class='Ref_to_Struct'>RelabelType</span></a><span class='Parentheses'>)</span> <span class='Operator'>&& 
</span>                     <a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(((</span><a href="../../../include/nodes/primnodes.h.html#LN786"><span class='Ref_to_Struct'>RelabelType</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="equivclass.c.html#LN1180"><span class='Ref_To_Local'>outer_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN820"><span class='Ref_to_Member'>em_expr</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>arg<span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a><span class='Parentheses'>)))</span> 
                    <a href="equivclass.c.html#LN1187"><span class='Ref_To_Local'>score</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1185"><span class='Ref_To_Local'>inner_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN820"><span class='Ref_to_Member'>em_expr</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a><span class='Parentheses'>)</span> <span class='Operator'>|| 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1185"><span class='Ref_To_Local'>inner_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN820"><span class='Ref_to_Member'>em_expr</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN786"><span class='Ref_to_Struct'>RelabelType</span></a><span class='Parentheses'>)</span> <span class='Operator'>&& 
</span>                     <a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(((</span><a href="../../../include/nodes/primnodes.h.html#LN786"><span class='Ref_to_Struct'>RelabelType</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="equivclass.c.html#LN1185"><span class='Ref_To_Local'>inner_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN820"><span class='Ref_to_Member'>em_expr</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>arg<span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a><span class='Parentheses'>)))</span> 
                    <a href="equivclass.c.html#LN1187"><span class='Ref_To_Local'>score</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/lsyscache.h.html#LN103"><span class='Ref_to_Proto'>op_hashjoinable</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1186"><span class='Ref_To_Local'>eq_op</span></a><span class='Delimiter'>, 
</span>                                    <a href="../../../include/nodes/nodeFuncs.h.html#LN31"><span class='Ref_to_Proto'>exprType</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="equivclass.c.html#LN1180"><span class='Ref_To_Local'>outer_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN820"><span class='Ref_to_Member'>em_expr</span></a><span class='Parentheses'>)))</span> 
                    <a href="equivclass.c.html#LN1187"><span class='Ref_To_Local'>score</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN1187"><span class='Ref_To_Local'>score</span></a> <span class='Operator'>&GT; </span><a href="equivclass.c.html#LN1175"><span class='Ref_To_Local'>best_score</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="equivclass.c.html#LN1172"><span class='Ref_To_Local'>best_outer_em</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN1180"><span class='Ref_To_Local'>outer_em</span></a><span class='Delimiter'>; 
</span>                    <a href="equivclass.c.html#LN1173"><span class='Ref_To_Local'>best_inner_em</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN1185"><span class='Ref_To_Local'>inner_em</span></a><span class='Delimiter'>; 
</span>                    <a href="equivclass.c.html#LN1174"><span class='Ref_To_Local'>best_eq_op</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN1186"><span class='Ref_To_Local'>eq_op</span></a><span class='Delimiter'>; 
</span>                    <a href="equivclass.c.html#LN1175"><span class='Ref_To_Local'>best_score</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN1187"><span class='Ref_To_Local'>score</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN1175"><span class='Ref_To_Local'>best_score</span></a> <span class='Operator'>== </span><span class='Number'>3</span><span class='Parentheses'>) 
</span>                        <span class='Control'>break</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* no need to look further */ 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN1175"><span class='Ref_To_Local'>best_score</span></a> <span class='Operator'>== </span><span class='Number'>3</span><span class='Parentheses'>) 
</span>                <span class='Control'>break</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* no need to look further */ 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN1175"><span class='Ref_To_Local'>best_score</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* failed... */ 
</span>            <a href="equivclass.c.html#LN1121"><span class='Ref_to_Parameter'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN780"><span class='Ref_to_Member'>ec_broken</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Create clause, setting parent_ec to mark it as redundant with other 
         * joinclauses 
         */ 
</span>        <a href="equivclass.c.html#LN1176"><span class='Ref_To_Local'>rinfo</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN55"><span class='Ref_to_Proto'>create_join_clause</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1120"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1121"><span class='Ref_to_Parameter'>ec</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1174"><span class='Ref_To_Local'>best_eq_op</span></a><span class='Delimiter'>, 
</span>                                   <a href="equivclass.c.html#LN1172"><span class='Ref_To_Local'>best_outer_em</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1173"><span class='Ref_To_Local'>best_inner_em</span></a><span class='Delimiter'>, 
</span>                                   <a href="equivclass.c.html#LN1121"><span class='Ref_to_Parameter'>ec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="equivclass.c.html#LN1126"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1126"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1176"><span class='Ref_To_Local'>rinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if outer_members&&inner_... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Now deal with building restrictions for any expressions that involve 
     * Vars from both sides of the join.  We have to equate all of these to 
     * each other as well as to at least one old member (if any). 
     * 
     * XXX as in generate_base_implied_equalities_no_const, we could be a lot 
     * smarter here to avoid unnecessary failures in cross-type situations. 
     * For now, use the same left-to-right method used there. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN1127"><span class='Ref_To_Local'>new_members</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1248"></a>        <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>old_members</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1128"><span class='Ref_To_Local'>outer_members</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1129"><span class='Ref_To_Local'>inner_members</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1249"></a>        <a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Declare_Local'>prev_em</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1250"></a>        <a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rinfo</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* For now, arbitrarily take the first old_member as the one to use */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN1248"><span class='Ref_To_Local'>old_members</span></a><span class='Parentheses'>) 
</span>            <a href="equivclass.c.html#LN1127"><span class='Ref_To_Local'>new_members</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1127"><span class='Ref_To_Local'>new_members</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1248"><span class='Ref_To_Local'>old_members</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1130"><span class='Ref_To_Local'>lc1</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1127"><span class='Ref_To_Local'>new_members</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1258"></a>            <a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cur_em</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1130"><span class='Ref_To_Local'>lc1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN1249"><span class='Ref_To_Local'>prev_em</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1262"></a>                <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>eq_op</span><span class='Delimiter'>; 
</span> 
                <a href="equivclass.c.html#LN1262"><span class='Ref_To_Local'>eq_op</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN53"><span class='Ref_to_Proto'>select_equality_operator</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1121"><span class='Ref_to_Parameter'>ec</span></a><span class='Delimiter'>, 
</span>                                                 <a href="equivclass.c.html#LN1249"><span class='Ref_To_Local'>prev_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN825"><span class='Ref_to_Member'>em_datatype</span></a><span class='Delimiter'>, 
</span>                                                 <a href="equivclass.c.html#LN1258"><span class='Ref_To_Local'>cur_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN825"><span class='Ref_to_Member'>em_datatype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1262"><span class='Ref_To_Local'>eq_op</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* failed... */ 
</span>                    <a href="equivclass.c.html#LN1121"><span class='Ref_to_Parameter'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN780"><span class='Ref_to_Member'>ec_broken</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Comment_Multi_Line'>/* do NOT set parent_ec, this qual is not redundant! */ 
</span>                <a href="equivclass.c.html#LN1250"><span class='Ref_To_Local'>rinfo</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN55"><span class='Ref_to_Proto'>create_join_clause</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1120"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1121"><span class='Ref_to_Parameter'>ec</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1262"><span class='Ref_To_Local'>eq_op</span></a><span class='Delimiter'>, 
</span>                                           <a href="equivclass.c.html#LN1249"><span class='Ref_To_Local'>prev_em</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1258"><span class='Ref_To_Local'>cur_em</span></a><span class='Delimiter'>, 
</span>                                           <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="equivclass.c.html#LN1126"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1126"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1250"><span class='Ref_To_Local'>rinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if prev_em!=NULL &raquo; </span> 
            <a href="equivclass.c.html#LN1249"><span class='Ref_To_Local'>prev_em</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN1258"><span class='Ref_To_Local'>cur_em</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if new_members &raquo; </span> 
 
    <span class='Control'>return</span> <a href="equivclass.c.html#LN1126"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end generate_join_implied_equalities_normal &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * generate_join_implied_equalities cleanup after failure 
 * 
 * Return any original RestrictInfos that are enforceable at this join. 
 * 
 * In the case of a child inner relation, we have to translate the 
 * original RestrictInfos from parent to child Vars. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN1296"></a><span class='Declare_Function'>generate_join_implied_equalities_broken</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN1297"></a>                                        <a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ec</span><span class='Delimiter'>, 
</span><a name="LN1298"></a>                                        <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>nominal_join_relids</span><span class='Delimiter'>, 
</span><a name="LN1299"></a>                                        <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>outer_relids</span><span class='Delimiter'>, 
</span><a name="LN1300"></a>                                        <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>nominal_inner_relids</span><span class='Delimiter'>, 
</span><a name="LN1301"></a>                                        <a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>inner_rel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1303"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN1304"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1304"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1297"><span class='Ref_to_Parameter'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN773"><span class='Ref_to_Member'>ec_sources</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1308"></a>        <a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>restrictinfo</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1304"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1309"></a>        <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a>      <span class='Declare_Local'>clause_relids</span> <span class='Operator'>= </span><a href="equivclass.c.html#LN1308"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1764"><span class='Ref_to_Member'>required_relids</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/bitmapset.h.html#LN73"><span class='Ref_to_Proto'>bms_is_subset</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1309"><span class='Ref_To_Local'>clause_relids</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1298"><span class='Ref_to_Parameter'>nominal_join_relids</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>            <span class='Operator'>!</span><a href="../../../include/nodes/bitmapset.h.html#LN73"><span class='Ref_to_Proto'>bms_is_subset</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1309"><span class='Ref_To_Local'>clause_relids</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1299"><span class='Ref_to_Parameter'>outer_relids</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>            <span class='Operator'>!</span><a href="../../../include/nodes/bitmapset.h.html#LN73"><span class='Ref_to_Proto'>bms_is_subset</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1309"><span class='Ref_To_Local'>clause_relids</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1300"><span class='Ref_to_Parameter'>nominal_inner_relids</span></a><span class='Parentheses'>))</span> 
            <a href="equivclass.c.html#LN1303"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1303"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1308"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we have to translate, just brute-force apply adjust_appendrel_attrs 
     * to all the RestrictInfos at once.  This will result in returning 
     * RestrictInfos that are not listed in ec_derives, but there shouldn't be 
     * any duplication, and it's a sufficiently narrow corner case that we 
     * shouldn't sweat too much over it anyway. 
     * 
     * Since inner_rel might be an indirect descendant of the baserel 
     * mentioned in the ec_sources clauses, we have to be prepared to apply 
     * multiple levels of Var translation. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN515"><span class='Ref_to_Macro'>IS_OTHER_REL</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1301"><span class='Ref_to_Parameter'>inner_rel</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="equivclass.c.html#LN1303"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>!= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span> 
        <a href="equivclass.c.html#LN1303"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/optimizer/prep.h.html#LN57"><span class='Ref_to_Proto'>adjust_appendrel_attrs_multilevel</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1296"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                                            <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="equivclass.c.html#LN1303"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                                                            <a href="equivclass.c.html#LN1301"><span class='Ref_to_Parameter'>inner_rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="equivclass.c.html#LN1303"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end generate_join_implied_equalities_broken &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * select_equality_operator 
 *    Select a suitable equality operator for comparing two EC members 
 * 
 * Returns InvalidOid if no operator can be found for this datatype combination 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN1344"></a><span class='Declare_Function'>select_equality_operator</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ec</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>lefttype</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>righttype</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1346"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1346"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1344"><span class='Ref_to_Parameter'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN770"><span class='Ref_to_Member'>ec_opfamilies</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1350"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>opfamily</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1346"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1351"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>opno</span><span class='Delimiter'>; 
</span> 
        <a href="equivclass.c.html#LN1351"><span class='Ref_To_Local'>opno</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN70"><span class='Ref_to_Proto'>get_opfamily_member</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1350"><span class='Ref_To_Local'>opfamily</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1344"><span class='Ref_to_Parameter'>lefttype</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1344"><span class='Ref_to_Parameter'>righttype</span></a><span class='Delimiter'>, 
</span>                                   <a href="../../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1351"><span class='Ref_To_Local'>opno</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* If no barrier quals in query, don't worry about leaky operators */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN1344"><span class='Ref_to_Parameter'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN783"><span class='Ref_to_Member'>ec_max_security</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="equivclass.c.html#LN1351"><span class='Ref_To_Local'>opno</span></a><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Otherwise, insist that selected operators be leakproof */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/lsyscache.h.html#LN120"><span class='Ref_to_Proto'>get_func_leakproof</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/lsyscache.h.html#LN98"><span class='Ref_to_Proto'>get_opcode</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1351"><span class='Ref_To_Local'>opno</span></a><span class='Parentheses'>)))</span> 
            <span class='Control'>return</span> <a href="equivclass.c.html#LN1351"><span class='Ref_To_Local'>opno</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end select_equality_operator &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * create_join_clause 
 *    Find or make a RestrictInfo comparing the two given EC members 
 *    with the given operator. 
 * 
 * parent_ec is either equal to ec (if the clause is a potentially-redundant 
 * join clause) or NULL (if not).  We have to treat this as part of the 
 * match requirements --- it's possible that a clause comparing the same two 
 * EMs is a join clause in one join path and a restriction clause in another. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>* 
</span><a name="LN1379"></a><span class='Declare_Function'>create_join_clause</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN1380"></a>                   <a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ec</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>opno</span><span class='Delimiter'>, 
</span><a name="LN1381"></a>                   <a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>leftem</span><span class='Delimiter'>, 
</span><a name="LN1382"></a>                   <a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rightem</span><span class='Delimiter'>, 
</span><a name="LN1383"></a>                   <a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>parent_ec</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1385"></a>    <a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rinfo</span><span class='Delimiter'>; 
</span><a name="LN1386"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span><a name="LN1387"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Search to see if we already built a RestrictInfo for this pair of 
     * EquivalenceMembers.  We can use either original source clauses or 
     * previously-derived clauses.  The check on opno is probably redundant, 
     * but be safe ... 
     */ 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1386"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1380"><span class='Ref_to_Parameter'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN773"><span class='Ref_to_Member'>ec_sources</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="equivclass.c.html#LN1385"><span class='Ref_To_Local'>rinfo</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1386"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN1385"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1796"><span class='Ref_to_Member'>left_em</span></a> <span class='Operator'>== </span><a href="equivclass.c.html#LN1381"><span class='Ref_to_Parameter'>leftem</span></a> <span class='Operator'>&& 
</span>            <a href="equivclass.c.html#LN1385"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1797"><span class='Ref_to_Member'>right_em</span></a> <span class='Operator'>== </span><a href="equivclass.c.html#LN1382"><span class='Ref_to_Parameter'>rightem</span></a> <span class='Operator'>&& 
</span>            <a href="equivclass.c.html#LN1385"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1780"><span class='Ref_to_Member'>parent_ec</span></a> <span class='Operator'>== </span><a href="equivclass.c.html#LN1383"><span class='Ref_to_Parameter'>parent_ec</span></a> <span class='Operator'>&& 
</span>            <a href="equivclass.c.html#LN1380"><span class='Ref_to_Parameter'>opno</span></a> <span class='Operator'>== </span><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN491"><span class='Ref_to_Struct'>OpExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="equivclass.c.html#LN1385"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1746"><span class='Ref_to_Member'>clause</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>opno<span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <a href="equivclass.c.html#LN1385"><span class='Ref_To_Local'>rinfo</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1386"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1380"><span class='Ref_to_Parameter'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN774"><span class='Ref_to_Member'>ec_derives</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="equivclass.c.html#LN1385"><span class='Ref_To_Local'>rinfo</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1386"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN1385"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1796"><span class='Ref_to_Member'>left_em</span></a> <span class='Operator'>== </span><a href="equivclass.c.html#LN1381"><span class='Ref_to_Parameter'>leftem</span></a> <span class='Operator'>&& 
</span>            <a href="equivclass.c.html#LN1385"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1797"><span class='Ref_to_Member'>right_em</span></a> <span class='Operator'>== </span><a href="equivclass.c.html#LN1382"><span class='Ref_to_Parameter'>rightem</span></a> <span class='Operator'>&& 
</span>            <a href="equivclass.c.html#LN1385"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1780"><span class='Ref_to_Member'>parent_ec</span></a> <span class='Operator'>== </span><a href="equivclass.c.html#LN1383"><span class='Ref_to_Parameter'>parent_ec</span></a> <span class='Operator'>&& 
</span>            <a href="equivclass.c.html#LN1380"><span class='Ref_to_Parameter'>opno</span></a> <span class='Operator'>== </span><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN491"><span class='Ref_to_Struct'>OpExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="equivclass.c.html#LN1385"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1746"><span class='Ref_to_Member'>clause</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>opno<span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <a href="equivclass.c.html#LN1385"><span class='Ref_To_Local'>rinfo</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Not there, so build it, in planner context so we can re-use it. (Not 
     * important in normal planning, but definitely so in GEQO.) 
     */ 
</span>    <a href="equivclass.c.html#LN1387"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1379"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN286"><span class='Ref_to_Member'>planner_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="equivclass.c.html#LN1385"><span class='Ref_To_Local'>rinfo</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/planmain.h.html#LN92"><span class='Ref_to_Proto'>build_implied_join_equality</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1380"><span class='Ref_to_Parameter'>opno</span></a><span class='Delimiter'>, 
</span>                                        <a href="equivclass.c.html#LN1380"><span class='Ref_to_Parameter'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN771"><span class='Ref_to_Member'>ec_collation</span></a><span class='Delimiter'>, 
</span>                                        <a href="equivclass.c.html#LN1381"><span class='Ref_to_Parameter'>leftem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN820"><span class='Ref_to_Member'>em_expr</span></a><span class='Delimiter'>, 
</span>                                        <a href="equivclass.c.html#LN1382"><span class='Ref_to_Parameter'>rightem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN820"><span class='Ref_to_Member'>em_expr</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../../include/nodes/bitmapset.h.html#LN70"><span class='Ref_to_Proto'>bms_union</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1381"><span class='Ref_to_Parameter'>leftem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN821"><span class='Ref_to_Member'>em_relids</span></a><span class='Delimiter'>, 
</span>                                                  <a href="equivclass.c.html#LN1382"><span class='Ref_to_Parameter'>rightem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN821"><span class='Ref_to_Member'>em_relids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                        <a href="../../../include/nodes/bitmapset.h.html#LN70"><span class='Ref_to_Proto'>bms_union</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1381"><span class='Ref_to_Parameter'>leftem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN822"><span class='Ref_to_Member'>em_nullable_relids</span></a><span class='Delimiter'>, 
</span>                                                <a href="equivclass.c.html#LN1382"><span class='Ref_to_Parameter'>rightem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN822"><span class='Ref_to_Member'>em_nullable_relids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                        <a href="equivclass.c.html#LN1380"><span class='Ref_to_Parameter'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN782"><span class='Ref_to_Member'>ec_min_security</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Mark the clause as redundant, or not */ 
</span>    <a href="equivclass.c.html#LN1385"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1780"><span class='Ref_to_Member'>parent_ec</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN1383"><span class='Ref_to_Parameter'>parent_ec</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We know the correct values for left_ec/right_ec, ie this particular EC, 
     * so we can just set them directly instead of forcing another lookup. 
     */ 
</span>    <a href="equivclass.c.html#LN1385"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1794"><span class='Ref_to_Member'>left_ec</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN1380"><span class='Ref_to_Parameter'>ec</span></a><span class='Delimiter'>; 
</span>    <a href="equivclass.c.html#LN1385"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1795"><span class='Ref_to_Member'>right_ec</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN1380"><span class='Ref_to_Parameter'>ec</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Mark it as usable with these EMs */ 
</span>    <a href="equivclass.c.html#LN1385"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1796"><span class='Ref_to_Member'>left_em</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN1381"><span class='Ref_to_Parameter'>leftem</span></a><span class='Delimiter'>; 
</span>    <a href="equivclass.c.html#LN1385"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1797"><span class='Ref_to_Member'>right_em</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN1382"><span class='Ref_to_Parameter'>rightem</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* and save it for possible re-use */ 
</span>    <a href="equivclass.c.html#LN1380"><span class='Ref_to_Parameter'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN774"><span class='Ref_to_Member'>ec_derives</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1380"><span class='Ref_to_Parameter'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN774"><span class='Ref_to_Member'>ec_derives</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1385"><span class='Ref_To_Local'>rinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1387"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="equivclass.c.html#LN1385"><span class='Ref_To_Local'>rinfo</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end create_join_clause &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * reconsider_outer_join_clauses 
 *    Re-examine any outer-join clauses that were set aside by 
 *    distribute_qual_to_rels(), and see if we can derive any 
 *    EquivalenceClasses from them.  Then, if they were not made 
 *    redundant, push them out into the regular join-clause lists. 
 * 
 * When we have mergejoinable clauses A = B that are outer-join clauses, 
 * we can't blindly combine them with other clauses A = C to deduce B = C, 
 * since in fact the "equality" A = B won't necessarily hold above the 
 * outer join (one of the variables might be NULL instead).  Nonetheless 
 * there are cases where we can add qual clauses using transitivity. 
 * 
 * One case that we look for here is an outer-join clause OUTERVAR = INNERVAR 
 * for which there is also an equivalence clause OUTERVAR = CONSTANT. 
 * It is safe and useful to push a clause INNERVAR = CONSTANT into the 
 * evaluation of the inner (nullable) relation, because any inner rows not 
 * meeting this condition will not contribute to the outer-join result anyway. 
 * (Any outer rows they could join to will be eliminated by the pushed-down 
 * equivalence clause.) 
 * 
 * Note that the above rule does not work for full outer joins; nor is it 
 * very interesting to consider cases where the generated equivalence clause 
 * would involve relations outside the outer join, since such clauses couldn't 
 * be pushed into the inner side's scan anyway.  So the restriction to 
 * outervar = pseudoconstant is not really giving up anything. 
 * 
 * For full-join cases, we can only do something useful if it's a FULL JOIN 
 * USING and a merged column has an equivalence MERGEDVAR = CONSTANT. 
 * By the time it gets here, the merged column will look like 
 *      COALESCE(LEFTVAR, RIGHTVAR) 
 * and we will have a full-join clause LEFTVAR = RIGHTVAR that we can match 
 * the COALESCE expression to. In this situation we can push LEFTVAR = CONSTANT 
 * and RIGHTVAR = CONSTANT into the input relations, since any rows not 
 * meeting these conditions cannot contribute to the join result. 
 * 
 * Again, there isn't any traction to be gained by trying to deal with 
 * clauses comparing a mergedvar to a non-pseudoconstant.  So we can make 
 * use of the EquivalenceClasses to search for matching variables that were 
 * equivalenced to constants.  The interesting outer-join clauses were 
 * accumulated for us by distribute_qual_to_rels. 
 * 
 * When we find one of these cases, we implement the changes we want by 
 * generating a new equivalence clause INNERVAR = CONSTANT (or LEFTVAR, etc) 
 * and pushing it into the EquivalenceClass structures.  This is because we 
 * may already know that INNERVAR is equivalenced to some other var(s), and 
 * we'd like the constant to propagate to them too.  Note that it would be 
 * unsafe to merge any existing EC for INNERVAR with the OUTERVAR's EC --- 
 * that could result in propagating constant restrictions from 
 * INNERVAR to OUTERVAR, which would be very wrong. 
 * 
 * It's possible that the INNERVAR is also an OUTERVAR for some other 
 * outer-join clause, in which case the process can be repeated.  So we repeat 
 * looping over the lists of clauses until no further deductions can be made. 
 * Whenever we do make a deduction, we remove the generating clause from the 
 * lists, since we don't want to make the same deduction twice. 
 * 
 * If we don't find any match for a set-aside outer join clause, we must 
 * throw it back into the regular joinclause processing by passing it to 
 * distribute_restrictinfo_to_rels().  If we do generate a derived clause, 
 * however, the outer-join clause is redundant.  We still throw it back, 
 * because otherwise the join will be seen as a clauseless join and avoided 
 * during join order searching; but we mark it as redundant to keep from 
 * messing up the joinrel's size estimate.  (This behavior means that the 
 * API for this routine is uselessly complex: we could have just put all 
 * the clauses into the regular processing initially.  We keep it because 
 * someday we might want to do something else, such as inserting "dummy" 
 * joinclauses instead of real ones.) 
 * 
 * Outer join clauses that are marked outerjoin_delayed are special: this 
 * condition means that one or both VARs might go to null due to a lower 
 * outer join.  We can still push a constant through the clause, but only 
 * if its operator is strict; and we *have to* throw the clause back into 
 * regular joinclause processing.  By keeping the strict join clause, 
 * we ensure that any null-extended rows that are mistakenly generated due 
 * to suppressing rows not matching the constant will be rejected at the 
 * upper outer join.  (This doesn't work for full-join clauses.) 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1532"></a><span class='Declare_Function'>reconsider_outer_join_clauses</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1534"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>found</span><span class='Delimiter'>; 
</span><a name="LN1535"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cell</span><span class='Delimiter'>; 
</span><a name="LN1536"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>prev</span><span class='Delimiter'>; 
</span><a name="LN1537"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>next</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Outer loop repeats until we find no more deductions */ 
</span>    <span class='Control'>do</span> 
    <span class='Delimiter'>{ 
</span>        <a href="equivclass.c.html#LN1534"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Process the LEFT JOIN clauses */ 
</span>        <a href="equivclass.c.html#LN1536"><span class='Ref_To_Local'>prev</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN1535"><span class='Ref_To_Local'>cell</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN75"><span class='Ref_to_Func'>list_head</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1532"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN238"><span class='Ref_to_Member'>left_join_clauses</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><a href="equivclass.c.html#LN1535"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>; </span><a href="equivclass.c.html#LN1535"><span class='Ref_To_Local'>cell</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN1537"><span class='Ref_To_Local'>next</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><a name="LN1548"></a>            <a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rinfo</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1535"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="equivclass.c.html#LN1537"><span class='Ref_To_Local'>next</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1535"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN60"><span class='Ref_to_Proto'>reconsider_outer_join_clause</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1532"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1548"><span class='Ref_To_Local'>rinfo</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="equivclass.c.html#LN1534"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* remove it from the list */ 
</span>                <a href="equivclass.c.html#LN1532"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN238"><span class='Ref_to_Member'>left_join_clauses</span></a> <span class='Operator'>= 
</span>                    <a href="../../../include/nodes/pg_list.h.html#LN238"><span class='Ref_to_Proto'>list_delete_cell</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1532"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN238"><span class='Ref_to_Member'>left_join_clauses</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1535"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1536"><span class='Ref_To_Local'>prev</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* we throw it back anyway (see notes above) */ 
</span>                <span class='Comment_Multi_Line'>/* but the thrown-back clause has no extra selectivity */ 
</span>                <a href="equivclass.c.html#LN1548"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1784"><span class='Ref_to_Member'>norm_selec</span></a> <span class='Operator'>= </span><span class='Number'>2</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <a href="equivclass.c.html#LN1548"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1787"><span class='Ref_to_Member'>outer_selec</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <a href="../../../include/optimizer/planmain.h.html#LN80"><span class='Ref_to_Proto'>distribute_restrictinfo_to_rels</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1532"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1548"><span class='Ref_To_Local'>rinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
                <a href="equivclass.c.html#LN1536"><span class='Ref_To_Local'>prev</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN1535"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for cell=list_head(root-&GT;... &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* Process the RIGHT JOIN clauses */ 
</span>        <a href="equivclass.c.html#LN1536"><span class='Ref_To_Local'>prev</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN1535"><span class='Ref_To_Local'>cell</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN75"><span class='Ref_to_Func'>list_head</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1532"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN242"><span class='Ref_to_Member'>right_join_clauses</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><a href="equivclass.c.html#LN1535"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>; </span><a href="equivclass.c.html#LN1535"><span class='Ref_To_Local'>cell</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN1537"><span class='Ref_To_Local'>next</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><a name="LN1571"></a>            <a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rinfo</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1535"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="equivclass.c.html#LN1537"><span class='Ref_To_Local'>next</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1535"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN60"><span class='Ref_to_Proto'>reconsider_outer_join_clause</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1532"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1571"><span class='Ref_To_Local'>rinfo</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="equivclass.c.html#LN1534"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* remove it from the list */ 
</span>                <a href="equivclass.c.html#LN1532"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN242"><span class='Ref_to_Member'>right_join_clauses</span></a> <span class='Operator'>= 
</span>                    <a href="../../../include/nodes/pg_list.h.html#LN238"><span class='Ref_to_Proto'>list_delete_cell</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1532"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN242"><span class='Ref_to_Member'>right_join_clauses</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1535"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1536"><span class='Ref_To_Local'>prev</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* we throw it back anyway (see notes above) */ 
</span>                <span class='Comment_Multi_Line'>/* but the thrown-back clause has no extra selectivity */ 
</span>                <a href="equivclass.c.html#LN1571"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1784"><span class='Ref_to_Member'>norm_selec</span></a> <span class='Operator'>= </span><span class='Number'>2</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <a href="equivclass.c.html#LN1571"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1787"><span class='Ref_to_Member'>outer_selec</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <a href="../../../include/optimizer/planmain.h.html#LN80"><span class='Ref_to_Proto'>distribute_restrictinfo_to_rels</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1532"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1571"><span class='Ref_To_Local'>rinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
                <a href="equivclass.c.html#LN1536"><span class='Ref_To_Local'>prev</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN1535"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for cell=list_head(root-&GT;... &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* Process the FULL JOIN clauses */ 
</span>        <a href="equivclass.c.html#LN1536"><span class='Ref_To_Local'>prev</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN1535"><span class='Ref_To_Local'>cell</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN75"><span class='Ref_to_Func'>list_head</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1532"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN246"><span class='Ref_to_Member'>full_join_clauses</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><a href="equivclass.c.html#LN1535"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>; </span><a href="equivclass.c.html#LN1535"><span class='Ref_To_Local'>cell</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN1537"><span class='Ref_To_Local'>next</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><a name="LN1594"></a>            <a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rinfo</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1535"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="equivclass.c.html#LN1537"><span class='Ref_To_Local'>next</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1535"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN63"><span class='Ref_to_Proto'>reconsider_full_join_clause</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1532"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1594"><span class='Ref_To_Local'>rinfo</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="equivclass.c.html#LN1534"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* remove it from the list */ 
</span>                <a href="equivclass.c.html#LN1532"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN246"><span class='Ref_to_Member'>full_join_clauses</span></a> <span class='Operator'>= 
</span>                    <a href="../../../include/nodes/pg_list.h.html#LN238"><span class='Ref_to_Proto'>list_delete_cell</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1532"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN246"><span class='Ref_to_Member'>full_join_clauses</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1535"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1536"><span class='Ref_To_Local'>prev</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* we throw it back anyway (see notes above) */ 
</span>                <span class='Comment_Multi_Line'>/* but the thrown-back clause has no extra selectivity */ 
</span>                <a href="equivclass.c.html#LN1594"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1784"><span class='Ref_to_Member'>norm_selec</span></a> <span class='Operator'>= </span><span class='Number'>2</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <a href="equivclass.c.html#LN1594"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1787"><span class='Ref_to_Member'>outer_selec</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <a href="../../../include/optimizer/planmain.h.html#LN80"><span class='Ref_to_Proto'>distribute_restrictinfo_to_rels</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1532"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1594"><span class='Ref_To_Local'>rinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
                <a href="equivclass.c.html#LN1536"><span class='Ref_To_Local'>prev</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN1535"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for cell=list_head(root-&GT;... &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end do &raquo; </span> <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN1534"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Now, any remaining clauses have to be thrown back */ 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1535"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1532"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN238"><span class='Ref_to_Member'>left_join_clauses</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1617"></a>        <a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rinfo</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1535"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/optimizer/planmain.h.html#LN80"><span class='Ref_to_Proto'>distribute_restrictinfo_to_rels</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1532"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1617"><span class='Ref_To_Local'>rinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1535"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1532"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN242"><span class='Ref_to_Member'>right_join_clauses</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1623"></a>        <a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rinfo</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1535"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/optimizer/planmain.h.html#LN80"><span class='Ref_to_Proto'>distribute_restrictinfo_to_rels</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1532"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1623"><span class='Ref_To_Local'>rinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1535"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1532"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN246"><span class='Ref_to_Member'>full_join_clauses</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1629"></a>        <a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rinfo</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1535"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/optimizer/planmain.h.html#LN80"><span class='Ref_to_Proto'>distribute_restrictinfo_to_rels</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1532"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1629"><span class='Ref_To_Local'>rinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end reconsider_outer_join_clauses &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * reconsider_outer_join_clauses for a single LEFT/RIGHT JOIN clause 
 * 
 * Returns TRUE if we were able to propagate a constant through the clause. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1641"></a><span class='Declare_Function'>reconsider_outer_join_clause</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rinfo</span><span class='Delimiter'>, 
</span><a name="LN1642"></a>                             <span class='Keyword'>bool </span><span class='Declare_Parameter'>outer_on_left</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1644"></a>    <a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>outervar</span><span class='Delimiter'>, 
</span><a name="LN1645"></a>               <span class='Operator'>*</span><span class='Declare_Local'>innervar</span><span class='Delimiter'>; 
</span><a name="LN1646"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>opno</span><span class='Delimiter'>, 
</span><a name="LN1647"></a>                <span class='Declare_Local'>collation</span><span class='Delimiter'>, 
</span><a name="LN1648"></a>                <span class='Declare_Local'>left_type</span><span class='Delimiter'>, 
</span><a name="LN1649"></a>                <span class='Declare_Local'>right_type</span><span class='Delimiter'>, 
</span><a name="LN1650"></a>                <span class='Declare_Local'>inner_datatype</span><span class='Delimiter'>; 
</span><a name="LN1651"></a>    <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a>      <span class='Declare_Local'>inner_relids</span><span class='Delimiter'>, 
</span><a name="LN1652"></a>                <span class='Declare_Local'>inner_nullable_relids</span><span class='Delimiter'>; 
</span><a name="LN1653"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc1</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/optimizer/clauses.h.html#LN19"><span class='Ref_to_Macro'>is_opclause</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1641"><span class='Ref_to_Parameter'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1746"><span class='Ref_to_Member'>clause</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="equivclass.c.html#LN1646"><span class='Ref_To_Local'>opno</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN491"><span class='Ref_to_Struct'>OpExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="equivclass.c.html#LN1641"><span class='Ref_to_Parameter'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1746"><span class='Ref_to_Member'>clause</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>opno<span class='Delimiter'>; 
</span>    <a href="equivclass.c.html#LN1647"><span class='Ref_To_Local'>collation</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN491"><span class='Ref_to_Struct'>OpExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="equivclass.c.html#LN1641"><span class='Ref_to_Parameter'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1746"><span class='Ref_to_Member'>clause</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>inputcollid<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If clause is outerjoin_delayed, operator must be strict */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN1641"><span class='Ref_to_Parameter'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1750"><span class='Ref_to_Member'>outerjoin_delayed</span></a> <span class='Operator'>&& !</span><a href="../../../include/utils/lsyscache.h.html#LN104"><span class='Ref_to_Proto'>op_strict</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1646"><span class='Ref_To_Local'>opno</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Extract needed info from the clause */ 
</span>    <a href="../../../include/utils/lsyscache.h.html#LN101"><span class='Ref_to_Proto'>op_input_types</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1646"><span class='Ref_To_Local'>opno</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="equivclass.c.html#LN1648"><span class='Ref_To_Local'>left_type</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="equivclass.c.html#LN1649"><span class='Ref_To_Local'>right_type</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN1642"><span class='Ref_to_Parameter'>outer_on_left</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="equivclass.c.html#LN1644"><span class='Ref_To_Local'>outervar</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/optimizer/clauses.h.html#LN32"><span class='Ref_to_Proto'>get_leftop</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1641"><span class='Ref_to_Parameter'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1746"><span class='Ref_to_Member'>clause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN1645"><span class='Ref_To_Local'>innervar</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/optimizer/clauses.h.html#LN33"><span class='Ref_to_Proto'>get_rightop</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1641"><span class='Ref_to_Parameter'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1746"><span class='Ref_to_Member'>clause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN1650"><span class='Ref_To_Local'>inner_datatype</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN1649"><span class='Ref_To_Local'>right_type</span></a><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN1651"><span class='Ref_To_Local'>inner_relids</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN1641"><span class='Ref_to_Parameter'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1774"><span class='Ref_to_Member'>right_relids</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="equivclass.c.html#LN1644"><span class='Ref_To_Local'>outervar</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/optimizer/clauses.h.html#LN33"><span class='Ref_to_Proto'>get_rightop</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1641"><span class='Ref_to_Parameter'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1746"><span class='Ref_to_Member'>clause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN1645"><span class='Ref_To_Local'>innervar</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/optimizer/clauses.h.html#LN32"><span class='Ref_to_Proto'>get_leftop</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1641"><span class='Ref_to_Parameter'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1746"><span class='Ref_to_Member'>clause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN1650"><span class='Ref_To_Local'>inner_datatype</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN1648"><span class='Ref_To_Local'>left_type</span></a><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN1651"><span class='Ref_To_Local'>inner_relids</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN1641"><span class='Ref_to_Parameter'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1773"><span class='Ref_to_Member'>left_relids</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="equivclass.c.html#LN1652"><span class='Ref_To_Local'>inner_nullable_relids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN71"><span class='Ref_to_Proto'>bms_intersect</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1651"><span class='Ref_To_Local'>inner_relids</span></a><span class='Delimiter'>, 
</span>                                          <a href="equivclass.c.html#LN1641"><span class='Ref_to_Parameter'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1770"><span class='Ref_to_Member'>nullable_relids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Scan EquivalenceClasses for a match to outervar */ 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1653"><span class='Ref_To_Local'>lc1</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1641"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN234"><span class='Ref_to_Member'>eq_classes</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1685"></a>        <a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cur_ec</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1653"><span class='Ref_To_Local'>lc1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1686"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>match</span><span class='Delimiter'>; 
</span><a name="LN1687"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc2</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Ignore EC unless it contains pseudoconstants */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="equivclass.c.html#LN1685"><span class='Ref_To_Local'>cur_ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN777"><span class='Ref_to_Member'>ec_has_const</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Never match to a volatile EC */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN1685"><span class='Ref_To_Local'>cur_ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN778"><span class='Ref_to_Member'>ec_has_volatile</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* It has to match the outer-join clause as to semantics, too */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN1647"><span class='Ref_To_Local'>collation</span></a> <span class='Operator'>!= </span><a href="equivclass.c.html#LN1685"><span class='Ref_To_Local'>cur_ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN771"><span class='Ref_to_Member'>ec_collation</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/nodes.h.html#LN626"><span class='Ref_to_Proto'>equal</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1641"><span class='Ref_to_Parameter'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1791"><span class='Ref_to_Member'>mergeopfamilies</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1685"><span class='Ref_To_Local'>cur_ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN770"><span class='Ref_to_Member'>ec_opfamilies</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Does it contain a match to outervar? */ 
</span>        <a href="equivclass.c.html#LN1686"><span class='Ref_To_Local'>match</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1687"><span class='Ref_To_Local'>lc2</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1685"><span class='Ref_To_Local'>cur_ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN772"><span class='Ref_to_Member'>ec_members</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1704"></a>            <a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cur_em</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1687"><span class='Ref_To_Local'>lc2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="equivclass.c.html#LN1704"><span class='Ref_To_Local'>cur_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN824"><span class='Ref_to_Member'>em_is_child</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* no children yet */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN626"><span class='Ref_to_Proto'>equal</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1644"><span class='Ref_To_Local'>outervar</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1704"><span class='Ref_To_Local'>cur_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN820"><span class='Ref_to_Member'>em_expr</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="equivclass.c.html#LN1686"><span class='Ref_To_Local'>match</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="equivclass.c.html#LN1686"><span class='Ref_To_Local'>match</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* no match, so ignore this EC */ 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Yes it does!  Try to generate a clause INNERVAR = CONSTANT for each 
         * CONSTANT in the EC.  Note that we must succeed with at least one 
         * constant before we can decide to throw away the outer-join clause. 
         */ 
</span>        <a href="equivclass.c.html#LN1686"><span class='Ref_To_Local'>match</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1687"><span class='Ref_To_Local'>lc2</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1685"><span class='Ref_To_Local'>cur_ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN772"><span class='Ref_to_Member'>ec_members</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1724"></a>            <a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cur_em</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1687"><span class='Ref_To_Local'>lc2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1725"></a>            <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>eq_op</span><span class='Delimiter'>; 
</span><a name="LN1726"></a>            <a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>newrinfo</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="equivclass.c.html#LN1724"><span class='Ref_To_Local'>cur_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN823"><span class='Ref_to_Member'>em_is_const</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* ignore non-const members */ 
</span>            <a href="equivclass.c.html#LN1725"><span class='Ref_To_Local'>eq_op</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN53"><span class='Ref_to_Proto'>select_equality_operator</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1685"><span class='Ref_To_Local'>cur_ec</span></a><span class='Delimiter'>, 
</span>                                             <a href="equivclass.c.html#LN1650"><span class='Ref_To_Local'>inner_datatype</span></a><span class='Delimiter'>, 
</span>                                             <a href="equivclass.c.html#LN1724"><span class='Ref_To_Local'>cur_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN825"><span class='Ref_to_Member'>em_datatype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1725"><span class='Ref_To_Local'>eq_op</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>continue</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* can't generate equality */ 
</span>            <a href="equivclass.c.html#LN1726"><span class='Ref_To_Local'>newrinfo</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/planmain.h.html#LN92"><span class='Ref_to_Proto'>build_implied_join_equality</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1725"><span class='Ref_To_Local'>eq_op</span></a><span class='Delimiter'>, 
</span>                                                   <a href="equivclass.c.html#LN1685"><span class='Ref_To_Local'>cur_ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN771"><span class='Ref_to_Member'>ec_collation</span></a><span class='Delimiter'>, 
</span>                                                   <a href="equivclass.c.html#LN1645"><span class='Ref_To_Local'>innervar</span></a><span class='Delimiter'>, 
</span>                                                   <a href="equivclass.c.html#LN1724"><span class='Ref_To_Local'>cur_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN820"><span class='Ref_to_Member'>em_expr</span></a><span class='Delimiter'>, 
</span>                                                   <a href="../../../include/nodes/bitmapset.h.html#LN65"><span class='Ref_to_Proto'>bms_copy</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1651"><span class='Ref_To_Local'>inner_relids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                             <a href="../../../include/nodes/bitmapset.h.html#LN65"><span class='Ref_to_Proto'>bms_copy</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1652"><span class='Ref_To_Local'>inner_nullable_relids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                   <a href="equivclass.c.html#LN1685"><span class='Ref_To_Local'>cur_ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN782"><span class='Ref_to_Member'>ec_min_security</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN105"><span class='Ref_to_Func'>process_equivalence</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1641"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1726"><span class='Ref_To_Local'>newrinfo</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span> 
                <a href="equivclass.c.html#LN1686"><span class='Ref_To_Local'>match</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If we were able to equate INNERVAR to any constant, report success. 
         * Otherwise, fall out of the search loop, since we know the OUTERVAR 
         * appears in at most one EC. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN1686"><span class='Ref_To_Local'>match</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>;</span>               <span class='Comment_Single_Line'>/* failed to make any deduction */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end reconsider_outer_join_clause &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * reconsider_outer_join_clauses for a single FULL JOIN clause 
 * 
 * Returns TRUE if we were able to propagate a constant through the clause. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1766"></a><span class='Declare_Function'>reconsider_full_join_clause</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rinfo</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1768"></a>    <a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>leftvar</span><span class='Delimiter'>; 
</span><a name="LN1769"></a>    <a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>rightvar</span><span class='Delimiter'>; 
</span><a name="LN1770"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>opno</span><span class='Delimiter'>, 
</span><a name="LN1771"></a>                <span class='Declare_Local'>collation</span><span class='Delimiter'>, 
</span><a name="LN1772"></a>                <span class='Declare_Local'>left_type</span><span class='Delimiter'>, 
</span><a name="LN1773"></a>                <span class='Declare_Local'>right_type</span><span class='Delimiter'>; 
</span><a name="LN1774"></a>    <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a>      <span class='Declare_Local'>left_relids</span><span class='Delimiter'>, 
</span><a name="LN1775"></a>                <span class='Declare_Local'>right_relids</span><span class='Delimiter'>, 
</span><a name="LN1776"></a>                <span class='Declare_Local'>left_nullable_relids</span><span class='Delimiter'>, 
</span><a name="LN1777"></a>                <span class='Declare_Local'>right_nullable_relids</span><span class='Delimiter'>; 
</span><a name="LN1778"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Can't use an outerjoin_delayed clause here */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN1766"><span class='Ref_to_Parameter'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1750"><span class='Ref_to_Member'>outerjoin_delayed</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Extract needed info from the clause */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/optimizer/clauses.h.html#LN19"><span class='Ref_to_Macro'>is_opclause</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1766"><span class='Ref_to_Parameter'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1746"><span class='Ref_to_Member'>clause</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="equivclass.c.html#LN1770"><span class='Ref_To_Local'>opno</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN491"><span class='Ref_to_Struct'>OpExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="equivclass.c.html#LN1766"><span class='Ref_to_Parameter'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1746"><span class='Ref_to_Member'>clause</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>opno<span class='Delimiter'>; 
</span>    <a href="equivclass.c.html#LN1771"><span class='Ref_To_Local'>collation</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN491"><span class='Ref_to_Struct'>OpExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="equivclass.c.html#LN1766"><span class='Ref_to_Parameter'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1746"><span class='Ref_to_Member'>clause</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>inputcollid<span class='Delimiter'>; 
</span>    <a href="../../../include/utils/lsyscache.h.html#LN101"><span class='Ref_to_Proto'>op_input_types</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1770"><span class='Ref_To_Local'>opno</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="equivclass.c.html#LN1772"><span class='Ref_To_Local'>left_type</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="equivclass.c.html#LN1773"><span class='Ref_To_Local'>right_type</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="equivclass.c.html#LN1768"><span class='Ref_To_Local'>leftvar</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/optimizer/clauses.h.html#LN32"><span class='Ref_to_Proto'>get_leftop</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1766"><span class='Ref_to_Parameter'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1746"><span class='Ref_to_Member'>clause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="equivclass.c.html#LN1769"><span class='Ref_To_Local'>rightvar</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/optimizer/clauses.h.html#LN33"><span class='Ref_to_Proto'>get_rightop</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1766"><span class='Ref_to_Parameter'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1746"><span class='Ref_to_Member'>clause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="equivclass.c.html#LN1774"><span class='Ref_To_Local'>left_relids</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN1766"><span class='Ref_to_Parameter'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1773"><span class='Ref_to_Member'>left_relids</span></a><span class='Delimiter'>; 
</span>    <a href="equivclass.c.html#LN1775"><span class='Ref_To_Local'>right_relids</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN1766"><span class='Ref_to_Parameter'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1774"><span class='Ref_to_Member'>right_relids</span></a><span class='Delimiter'>; 
</span>    <a href="equivclass.c.html#LN1776"><span class='Ref_To_Local'>left_nullable_relids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN71"><span class='Ref_to_Proto'>bms_intersect</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1774"><span class='Ref_To_Local'>left_relids</span></a><span class='Delimiter'>, 
</span>                                         <a href="equivclass.c.html#LN1766"><span class='Ref_to_Parameter'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1770"><span class='Ref_to_Member'>nullable_relids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="equivclass.c.html#LN1777"><span class='Ref_To_Local'>right_nullable_relids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN71"><span class='Ref_to_Proto'>bms_intersect</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1775"><span class='Ref_To_Local'>right_relids</span></a><span class='Delimiter'>, 
</span>                                          <a href="equivclass.c.html#LN1766"><span class='Ref_to_Parameter'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1770"><span class='Ref_to_Member'>nullable_relids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1778"><span class='Ref_To_Local'>lc1</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1766"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN234"><span class='Ref_to_Member'>eq_classes</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1800"></a>        <a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cur_ec</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1778"><span class='Ref_To_Local'>lc1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1801"></a>        <a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Declare_Local'>coal_em</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1802"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>match</span><span class='Delimiter'>; 
</span><a name="LN1803"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>matchleft</span><span class='Delimiter'>; 
</span><a name="LN1804"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>matchright</span><span class='Delimiter'>; 
</span><a name="LN1805"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc2</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Ignore EC unless it contains pseudoconstants */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="equivclass.c.html#LN1800"><span class='Ref_To_Local'>cur_ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN777"><span class='Ref_to_Member'>ec_has_const</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Never match to a volatile EC */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN1800"><span class='Ref_To_Local'>cur_ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN778"><span class='Ref_to_Member'>ec_has_volatile</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* It has to match the outer-join clause as to semantics, too */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN1771"><span class='Ref_To_Local'>collation</span></a> <span class='Operator'>!= </span><a href="equivclass.c.html#LN1800"><span class='Ref_To_Local'>cur_ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN771"><span class='Ref_to_Member'>ec_collation</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/nodes.h.html#LN626"><span class='Ref_to_Proto'>equal</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1766"><span class='Ref_to_Parameter'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1791"><span class='Ref_to_Member'>mergeopfamilies</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1800"><span class='Ref_To_Local'>cur_ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN770"><span class='Ref_to_Member'>ec_opfamilies</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Does it contain a COALESCE(leftvar, rightvar) construct? 
         * 
         * We can assume the COALESCE() inputs are in the same order as the 
         * join clause, since both were automatically generated in the cases 
         * we care about. 
         * 
         * XXX currently this may fail to match in cross-type cases because 
         * the COALESCE will contain typecast operations while the join clause 
         * may not (if there is a cross-type mergejoin operator available for 
         * the two column types). Is it OK to strip implicit coercions from 
         * the COALESCE arguments? 
         */ 
</span>        <a href="equivclass.c.html#LN1802"><span class='Ref_To_Local'>match</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1805"><span class='Ref_To_Local'>lc2</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1800"><span class='Ref_To_Local'>cur_ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN772"><span class='Ref_to_Member'>ec_members</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="equivclass.c.html#LN1801"><span class='Ref_To_Local'>coal_em</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1805"><span class='Ref_To_Local'>lc2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="equivclass.c.html#LN1801"><span class='Ref_To_Local'>coal_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN824"><span class='Ref_to_Member'>em_is_child</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* no children yet */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1801"><span class='Ref_To_Local'>coal_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN820"><span class='Ref_to_Member'>em_expr</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1040"><span class='Ref_to_Struct'>CoalesceExpr</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span><a name="LN1839"></a>                <a href="../../../include/nodes/primnodes.h.html#LN1040"><span class='Ref_to_Struct'>CoalesceExpr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cexpr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1040"><span class='Ref_to_Struct'>CoalesceExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="equivclass.c.html#LN1801"><span class='Ref_To_Local'>coal_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN820"><span class='Ref_to_Member'>em_expr</span></a><span class='Delimiter'>; 
</span><a name="LN1840"></a>                <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>cfirst</span><span class='Delimiter'>; 
</span><a name="LN1841"></a>                <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>csecond</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1839"><span class='Ref_To_Local'>cexpr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1045"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>2</span><span class='Parentheses'>)</span> 
                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                <a href="equivclass.c.html#LN1840"><span class='Ref_To_Local'>cfirst</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1839"><span class='Ref_To_Local'>cexpr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1045"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="equivclass.c.html#LN1841"><span class='Ref_To_Local'>csecond</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN115"><span class='Ref_to_Macro'>lsecond</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1839"><span class='Ref_To_Local'>cexpr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1045"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN626"><span class='Ref_to_Proto'>equal</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1768"><span class='Ref_To_Local'>leftvar</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1840"><span class='Ref_To_Local'>cfirst</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="../../../include/nodes/nodes.h.html#LN626"><span class='Ref_to_Proto'>equal</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1769"><span class='Ref_To_Local'>rightvar</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1841"><span class='Ref_To_Local'>csecond</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="equivclass.c.html#LN1802"><span class='Ref_To_Local'>match</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="equivclass.c.html#LN1802"><span class='Ref_To_Local'>match</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* no match, so ignore this EC */ 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Yes it does!  Try to generate clauses LEFTVAR = CONSTANT and 
         * RIGHTVAR = CONSTANT for each CONSTANT in the EC.  Note that we must 
         * succeed with at least one constant for each var before we can 
         * decide to throw away the outer-join clause. 
         */ 
</span>        <a href="equivclass.c.html#LN1803"><span class='Ref_To_Local'>matchleft</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN1804"><span class='Ref_To_Local'>matchright</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1805"><span class='Ref_To_Local'>lc2</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1800"><span class='Ref_To_Local'>cur_ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN772"><span class='Ref_to_Member'>ec_members</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1867"></a>            <a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cur_em</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1805"><span class='Ref_To_Local'>lc2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1868"></a>            <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>eq_op</span><span class='Delimiter'>; 
</span><a name="LN1869"></a>            <a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>newrinfo</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="equivclass.c.html#LN1867"><span class='Ref_To_Local'>cur_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN823"><span class='Ref_to_Member'>em_is_const</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* ignore non-const members */ 
</span>            <a href="equivclass.c.html#LN1868"><span class='Ref_To_Local'>eq_op</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN53"><span class='Ref_to_Proto'>select_equality_operator</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1800"><span class='Ref_To_Local'>cur_ec</span></a><span class='Delimiter'>, 
</span>                                             <a href="equivclass.c.html#LN1772"><span class='Ref_To_Local'>left_type</span></a><span class='Delimiter'>, 
</span>                                             <a href="equivclass.c.html#LN1867"><span class='Ref_To_Local'>cur_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN825"><span class='Ref_to_Member'>em_datatype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1868"><span class='Ref_To_Local'>eq_op</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="equivclass.c.html#LN1869"><span class='Ref_To_Local'>newrinfo</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/planmain.h.html#LN92"><span class='Ref_to_Proto'>build_implied_join_equality</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1868"><span class='Ref_To_Local'>eq_op</span></a><span class='Delimiter'>, 
</span>                                                       <a href="equivclass.c.html#LN1800"><span class='Ref_To_Local'>cur_ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN771"><span class='Ref_to_Member'>ec_collation</span></a><span class='Delimiter'>, 
</span>                                                       <a href="equivclass.c.html#LN1768"><span class='Ref_To_Local'>leftvar</span></a><span class='Delimiter'>, 
</span>                                                       <a href="equivclass.c.html#LN1867"><span class='Ref_To_Local'>cur_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN820"><span class='Ref_to_Member'>em_expr</span></a><span class='Delimiter'>, 
</span>                                                       <a href="../../../include/nodes/bitmapset.h.html#LN65"><span class='Ref_to_Proto'>bms_copy</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1774"><span class='Ref_To_Local'>left_relids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                              <a href="../../../include/nodes/bitmapset.h.html#LN65"><span class='Ref_to_Proto'>bms_copy</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1776"><span class='Ref_To_Local'>left_nullable_relids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                    <a href="equivclass.c.html#LN1800"><span class='Ref_To_Local'>cur_ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN782"><span class='Ref_to_Member'>ec_min_security</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN105"><span class='Ref_to_Func'>process_equivalence</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1766"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1869"><span class='Ref_To_Local'>newrinfo</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span> 
                    <a href="equivclass.c.html#LN1803"><span class='Ref_To_Local'>matchleft</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="equivclass.c.html#LN1868"><span class='Ref_To_Local'>eq_op</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN53"><span class='Ref_to_Proto'>select_equality_operator</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1800"><span class='Ref_To_Local'>cur_ec</span></a><span class='Delimiter'>, 
</span>                                             <a href="equivclass.c.html#LN1773"><span class='Ref_To_Local'>right_type</span></a><span class='Delimiter'>, 
</span>                                             <a href="equivclass.c.html#LN1867"><span class='Ref_To_Local'>cur_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN825"><span class='Ref_to_Member'>em_datatype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1868"><span class='Ref_To_Local'>eq_op</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="equivclass.c.html#LN1869"><span class='Ref_To_Local'>newrinfo</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/planmain.h.html#LN92"><span class='Ref_to_Proto'>build_implied_join_equality</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1868"><span class='Ref_To_Local'>eq_op</span></a><span class='Delimiter'>, 
</span>                                                       <a href="equivclass.c.html#LN1800"><span class='Ref_To_Local'>cur_ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN771"><span class='Ref_to_Member'>ec_collation</span></a><span class='Delimiter'>, 
</span>                                                       <a href="equivclass.c.html#LN1769"><span class='Ref_To_Local'>rightvar</span></a><span class='Delimiter'>, 
</span>                                                       <a href="equivclass.c.html#LN1867"><span class='Ref_To_Local'>cur_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN820"><span class='Ref_to_Member'>em_expr</span></a><span class='Delimiter'>, 
</span>                                                       <a href="../../../include/nodes/bitmapset.h.html#LN65"><span class='Ref_to_Proto'>bms_copy</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1775"><span class='Ref_To_Local'>right_relids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                             <a href="../../../include/nodes/bitmapset.h.html#LN65"><span class='Ref_to_Proto'>bms_copy</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1777"><span class='Ref_To_Local'>right_nullable_relids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                    <a href="equivclass.c.html#LN1800"><span class='Ref_To_Local'>cur_ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN782"><span class='Ref_to_Member'>ec_min_security</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN105"><span class='Ref_to_Func'>process_equivalence</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1766"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1869"><span class='Ref_To_Local'>newrinfo</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span> 
                    <a href="equivclass.c.html#LN1804"><span class='Ref_To_Local'>matchright</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If we were able to equate both vars to constants, we're done, and 
         * we can throw away the full-join clause as redundant.  Moreover, we 
         * can remove the COALESCE entry from the EC, since the added 
         * restrictions ensure it will always have the expected value. (We 
         * don't bother trying to update ec_relids or ec_sources.) 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN1803"><span class='Ref_To_Local'>matchleft</span></a> <span class='Operator'>&& </span><a href="equivclass.c.html#LN1804"><span class='Ref_To_Local'>matchright</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="equivclass.c.html#LN1800"><span class='Ref_To_Local'>cur_ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN772"><span class='Ref_to_Member'>ec_members</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN234"><span class='Ref_to_Proto'>list_delete_ptr</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1800"><span class='Ref_To_Local'>cur_ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN772"><span class='Ref_to_Member'>ec_members</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1801"><span class='Ref_To_Local'>coal_em</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Otherwise, fall out of the search loop, since we know the COALESCE 
         * appears in at most one EC (XXX might stop being true if we allow 
         * stripping of coercions above?) 
         */ 
</span>        <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>;</span>               <span class='Comment_Single_Line'>/* failed to make any deduction */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end reconsider_full_join_clause &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * exprs_known_equal 
 *    Detect whether two expressions are known equal due to equivalence 
 *    relationships. 
 * 
 * Actually, this only shows that the expressions are equal according 
 * to some opfamily's notion of equality --- but we only use it for 
 * selectivity estimation, so a fuzzy idea of equality is OK. 
 * 
 * Note: does not bother to check for "equal(item1, item2)"; caller must 
 * check that case if it's possible to pass identical items. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN1943"></a><span class='Declare_Function'>exprs_known_equal</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>item1</span><span class='Delimiter'>, </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>item2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1945"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc1</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1945"><span class='Ref_To_Local'>lc1</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1943"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN234"><span class='Ref_to_Member'>eq_classes</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1949"></a>        <a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ec</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1945"><span class='Ref_To_Local'>lc1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1950"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>item1member</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN1951"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>item2member</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN1952"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc2</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Never match to a volatile EC */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN1949"><span class='Ref_To_Local'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN778"><span class='Ref_to_Member'>ec_has_volatile</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1952"><span class='Ref_To_Local'>lc2</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1949"><span class='Ref_To_Local'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN772"><span class='Ref_to_Member'>ec_members</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1960"></a>            <a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Declare_Local'>em</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1952"><span class='Ref_To_Local'>lc2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN1960"><span class='Ref_To_Local'>em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN824"><span class='Ref_to_Member'>em_is_child</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* ignore children here */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN626"><span class='Ref_to_Proto'>equal</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1943"><span class='Ref_to_Parameter'>item1</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1960"><span class='Ref_To_Local'>em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN820"><span class='Ref_to_Member'>em_expr</span></a><span class='Parentheses'>))</span> 
                <a href="equivclass.c.html#LN1950"><span class='Ref_To_Local'>item1member</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN626"><span class='Ref_to_Proto'>equal</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1943"><span class='Ref_to_Parameter'>item2</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1960"><span class='Ref_To_Local'>em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN820"><span class='Ref_to_Member'>em_expr</span></a><span class='Parentheses'>))</span> 
                <a href="equivclass.c.html#LN1951"><span class='Ref_To_Local'>item2member</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Exit as soon as equality is proven */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN1950"><span class='Ref_To_Local'>item1member</span></a> <span class='Operator'>&& </span><a href="equivclass.c.html#LN1951"><span class='Ref_To_Local'>item2member</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end exprs_known_equal &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * match_eclasses_to_foreign_key_col 
 *    See whether a foreign key column match is proven by any eclass. 
 * 
 * If the referenced and referencing Vars of the fkey's colno'th column are 
 * known equal due to any eclass, return that eclass; otherwise return NULL. 
 * (In principle there might be more than one matching eclass if multiple 
 * collations are involved, but since collation doesn't matter for equality, 
 * we ignore that fine point here.)  This is much like exprs_known_equal, 
 * except that we insist on the comparison operator matching the eclass, so 
 * that the result is definite not approximate. 
 */ 
</span><a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>* 
</span><a name="LN1990"></a><span class='Declare_Function'>match_eclasses_to_foreign_key_col</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN1991"></a>                                  <a href="../../../include/nodes/relation.h.html#LN687"><span class='Ref_to_Struct'>ForeignKeyOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fkinfo</span><span class='Delimiter'>, 
</span><a name="LN1992"></a>                                  <span class='Keyword'>int </span><span class='Declare_Parameter'>colno</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1994"></a>    <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a>       <span class='Declare_Local'>var1varno</span> <span class='Operator'>= </span><a href="equivclass.c.html#LN1991"><span class='Ref_to_Parameter'>fkinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN692"><span class='Ref_to_Member'>con_relid</span></a><span class='Delimiter'>; 
</span><a name="LN1995"></a>    <a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>var1attno</span> <span class='Operator'>= </span><a href="equivclass.c.html#LN1991"><span class='Ref_to_Parameter'>fkinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN695"><span class='Ref_to_Member'>conkey</span></a><span class='Delimiter'>[</span><a href="equivclass.c.html#LN1992"><span class='Ref_to_Parameter'>colno</span></a><span class='Delimiter'>]; 
</span><a name="LN1996"></a>    <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a>       <span class='Declare_Local'>var2varno</span> <span class='Operator'>= </span><a href="equivclass.c.html#LN1991"><span class='Ref_to_Parameter'>fkinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN693"><span class='Ref_to_Member'>ref_relid</span></a><span class='Delimiter'>; 
</span><a name="LN1997"></a>    <a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>var2attno</span> <span class='Operator'>= </span><a href="equivclass.c.html#LN1991"><span class='Ref_to_Parameter'>fkinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN696"><span class='Ref_to_Member'>confkey</span></a><span class='Delimiter'>[</span><a href="equivclass.c.html#LN1992"><span class='Ref_to_Parameter'>colno</span></a><span class='Delimiter'>]; 
</span><a name="LN1998"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>eqop</span> <span class='Operator'>= </span><a href="equivclass.c.html#LN1991"><span class='Ref_to_Parameter'>fkinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN697"><span class='Ref_to_Member'>conpfeqop</span></a><span class='Delimiter'>[</span><a href="equivclass.c.html#LN1992"><span class='Ref_to_Parameter'>colno</span></a><span class='Delimiter'>]; 
</span><a name="LN1999"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>opfamilies</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* compute only if needed */ 
</span><a name="LN2000"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc1</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2000"><span class='Ref_To_Local'>lc1</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN1990"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN234"><span class='Ref_to_Member'>eq_classes</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2004"></a>        <a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ec</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2000"><span class='Ref_To_Local'>lc1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2005"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>item1member</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN2006"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>item2member</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN2007"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc2</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Never match to a volatile EC */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN2004"><span class='Ref_To_Local'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN778"><span class='Ref_to_Member'>ec_has_volatile</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Note: it seems okay to match to "broken" eclasses here */ 
</span> 
        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2007"><span class='Ref_To_Local'>lc2</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN2004"><span class='Ref_To_Local'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN772"><span class='Ref_to_Member'>ec_members</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2016"></a>            <a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Declare_Local'>em</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2007"><span class='Ref_To_Local'>lc2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2017"></a>            <a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>var</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN2016"><span class='Ref_To_Local'>em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN824"><span class='Ref_to_Member'>em_is_child</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* ignore children here */ 
</span> 
            <span class='Comment_Multi_Line'>/* EM must be a Var, possibly with RelabelType */ 
</span>            <a href="equivclass.c.html#LN2017"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="equivclass.c.html#LN2016"><span class='Ref_To_Local'>em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN820"><span class='Ref_to_Member'>em_expr</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN2017"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>&& </span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2017"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN786"><span class='Ref_to_Struct'>RelabelType</span></a><span class='Parentheses'>))</span> 
                <a href="equivclass.c.html#LN2017"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) ((</span><a href="../../../include/nodes/primnodes.h.html#LN786"><span class='Ref_to_Struct'>RelabelType</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="equivclass.c.html#LN2017"><span class='Ref_To_Local'>var</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>arg<span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2017"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>&& </span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2017"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a><span class='Parentheses'>)))</span> 
                <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Match? */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN2017"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN165"><span class='Ref_to_Member'>varno</span></a> <span class='Operator'>== </span><a href="equivclass.c.html#LN1994"><span class='Ref_To_Local'>var1varno</span></a> <span class='Operator'>&& </span><a href="equivclass.c.html#LN2017"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN167"><span class='Ref_to_Member'>varattno</span></a> <span class='Operator'>== </span><a href="equivclass.c.html#LN1995"><span class='Ref_To_Local'>var1attno</span></a><span class='Parentheses'>) 
</span>                <a href="equivclass.c.html#LN2005"><span class='Ref_To_Local'>item1member</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN2017"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN165"><span class='Ref_to_Member'>varno</span></a> <span class='Operator'>== </span><a href="equivclass.c.html#LN1996"><span class='Ref_To_Local'>var2varno</span></a> <span class='Operator'>&& </span><a href="equivclass.c.html#LN2017"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN167"><span class='Ref_to_Member'>varattno</span></a> <span class='Operator'>== </span><a href="equivclass.c.html#LN1997"><span class='Ref_To_Local'>var2attno</span></a><span class='Parentheses'>) 
</span>                <a href="equivclass.c.html#LN2006"><span class='Ref_To_Local'>item2member</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Have we found both PK and FK column in this EC? */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN2005"><span class='Ref_To_Local'>item1member</span></a> <span class='Operator'>&& </span><a href="equivclass.c.html#LN2006"><span class='Ref_To_Local'>item2member</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * Succeed if eqop matches EC's opfamilies.  We could test 
                 * this before scanning the members, but it's probably cheaper 
                 * to test for member matches first. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN1999"><span class='Ref_To_Local'>opfamilies</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span>  <span class='Comment_Single_Line'>/* compute if we didn't already */ 
</span>                    <a href="equivclass.c.html#LN1999"><span class='Ref_To_Local'>opfamilies</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN76"><span class='Ref_to_Proto'>get_mergejoin_opfamilies</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1998"><span class='Ref_To_Local'>eqop</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN626"><span class='Ref_to_Proto'>equal</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN1999"><span class='Ref_To_Local'>opfamilies</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN2004"><span class='Ref_To_Local'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN770"><span class='Ref_to_Member'>ec_opfamilies</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <a href="equivclass.c.html#LN2004"><span class='Ref_To_Local'>ec</span></a><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* Otherwise, done with this EC, move on to the next */ 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end match_eclasses_to_foreign_key_col &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * add_child_rel_equivalences 
 *    Search for EC members that reference the parent_rel, and 
 *    add transformed members referencing the child_rel. 
 * 
 * Note that this function won't be called at all unless we have at least some 
 * reason to believe that the EC members it generates will be useful. 
 * 
 * parent_rel and child_rel could be derived from appinfo, but since the 
 * caller has already computed them, we might as well just pass them in. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN2068"></a><span class='Declare_Function'>add_child_rel_equivalences</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN2069"></a>                           <a href="../../../include/nodes/relation.h.html#LN1964"><span class='Ref_to_Struct'>AppendRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>appinfo</span><span class='Delimiter'>, 
</span><a name="LN2070"></a>                           <a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>parent_rel</span><span class='Delimiter'>, 
</span><a name="LN2071"></a>                           <a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>child_rel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2073"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc1</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2073"><span class='Ref_To_Local'>lc1</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN2068"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN234"><span class='Ref_to_Member'>eq_classes</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2077"></a>        <a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cur_ec</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2073"><span class='Ref_To_Local'>lc1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2078"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc2</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If this EC contains a volatile expression, then generating child 
         * EMs would be downright dangerous, so skip it.  We rely on a 
         * volatile EC having only one EM. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN2077"><span class='Ref_To_Local'>cur_ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN778"><span class='Ref_to_Member'>ec_has_volatile</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * No point in searching if parent rel not mentioned in eclass; but we 
         * can't tell that for sure if parent rel is itself a child. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN2070"><span class='Ref_to_Parameter'>parent_rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN521"><span class='Ref_to_Member'>reloptkind</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/relation.h.html#LN493"><span class='Ref_to_EnumConst'>RELOPT_BASEREL</span></a> <span class='Operator'>&& 
</span>            <span class='Operator'>!</span><a href="../../../include/nodes/bitmapset.h.html#LN73"><span class='Ref_to_Proto'>bms_is_subset</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2070"><span class='Ref_to_Parameter'>parent_rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN524"><span class='Ref_to_Member'>relids</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN2077"><span class='Ref_To_Local'>cur_ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN775"><span class='Ref_to_Member'>ec_relids</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2078"><span class='Ref_To_Local'>lc2</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN2077"><span class='Ref_To_Local'>cur_ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN772"><span class='Ref_to_Member'>ec_members</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2098"></a>            <a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cur_em</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2078"><span class='Ref_To_Local'>lc2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN2098"><span class='Ref_To_Local'>cur_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN823"><span class='Ref_to_Member'>em_is_const</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* ignore consts here */ 
</span> 
            <span class='Comment_Multi_Line'>/* Does it reference parent_rel? */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/bitmapset.h.html#LN76"><span class='Ref_to_Proto'>bms_overlap</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2098"><span class='Ref_To_Local'>cur_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN821"><span class='Ref_to_Member'>em_relids</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN2070"><span class='Ref_to_Parameter'>parent_rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN524"><span class='Ref_to_Member'>relids</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Yes, generate transformed child version */ 
</span><a name="LN2107"></a>                <a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>child_expr</span><span class='Delimiter'>; 
</span><a name="LN2108"></a>                <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a>      <span class='Declare_Local'>new_relids</span><span class='Delimiter'>; 
</span><a name="LN2109"></a>                <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a>      <span class='Declare_Local'>new_nullable_relids</span><span class='Delimiter'>; 
</span> 
                <a href="equivclass.c.html#LN2107"><span class='Ref_To_Local'>child_expr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>                    <a href="../../../include/optimizer/prep.h.html#LN54"><span class='Ref_to_Proto'>adjust_appendrel_attrs</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2068"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                           <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="equivclass.c.html#LN2098"><span class='Ref_To_Local'>cur_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN820"><span class='Ref_to_Member'>em_expr</span></a><span class='Delimiter'>, 
</span>                                           <a href="equivclass.c.html#LN2069"><span class='Ref_to_Parameter'>appinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Transform em_relids to match.  Note we do *not* do 
                 * pull_varnos(child_expr) here, as for example the 
                 * transformation might have substituted a constant, but we 
                 * don't want the child member to be marked as constant. 
                 */ 
</span>                <a href="equivclass.c.html#LN2108"><span class='Ref_To_Local'>new_relids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN72"><span class='Ref_to_Proto'>bms_difference</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2098"><span class='Ref_To_Local'>cur_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN821"><span class='Ref_to_Member'>em_relids</span></a><span class='Delimiter'>, 
</span>                                            <a href="equivclass.c.html#LN2070"><span class='Ref_to_Parameter'>parent_rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN524"><span class='Ref_to_Member'>relids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="equivclass.c.html#LN2108"><span class='Ref_To_Local'>new_relids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN91"><span class='Ref_to_Proto'>bms_add_members</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2108"><span class='Ref_To_Local'>new_relids</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN2071"><span class='Ref_to_Parameter'>child_rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN524"><span class='Ref_to_Member'>relids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * And likewise for nullable_relids.  Note this code assumes 
                 * parent and child relids are singletons. 
                 */ 
</span>                <a href="equivclass.c.html#LN2109"><span class='Ref_To_Local'>new_nullable_relids</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN2098"><span class='Ref_To_Local'>cur_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN822"><span class='Ref_to_Member'>em_nullable_relids</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/bitmapset.h.html#LN76"><span class='Ref_to_Proto'>bms_overlap</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2109"><span class='Ref_To_Local'>new_nullable_relids</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN2070"><span class='Ref_to_Parameter'>parent_rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN524"><span class='Ref_to_Member'>relids</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="equivclass.c.html#LN2109"><span class='Ref_To_Local'>new_nullable_relids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN72"><span class='Ref_to_Proto'>bms_difference</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2109"><span class='Ref_To_Local'>new_nullable_relids</span></a><span class='Delimiter'>, 
</span>                                                         <a href="equivclass.c.html#LN2070"><span class='Ref_to_Parameter'>parent_rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN524"><span class='Ref_to_Member'>relids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="equivclass.c.html#LN2109"><span class='Ref_To_Local'>new_nullable_relids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN91"><span class='Ref_to_Proto'>bms_add_members</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2109"><span class='Ref_To_Local'>new_nullable_relids</span></a><span class='Delimiter'>, 
</span>                                                          <a href="equivclass.c.html#LN2071"><span class='Ref_to_Parameter'>child_rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN524"><span class='Ref_to_Member'>relids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="equivclass.c.html#LN33"><span class='Ref_to_Proto'>add_eq_member</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2077"><span class='Ref_To_Local'>cur_ec</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN2107"><span class='Ref_To_Local'>child_expr</span></a><span class='Delimiter'>, 
</span>                                     <a href="equivclass.c.html#LN2108"><span class='Ref_To_Local'>new_relids</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN2109"><span class='Ref_To_Local'>new_nullable_relids</span></a><span class='Delimiter'>, 
</span>                                     <span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="equivclass.c.html#LN2098"><span class='Ref_To_Local'>cur_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN825"><span class='Ref_to_Member'>em_datatype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if bms_overlap(cur_em-&GT;e... &raquo; </span> 
        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end add_child_rel_equivalences &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * generate_implied_equalities_for_column 
 *    Create EC-derived joinclauses usable with a specific column. 
 * 
 * This is used by indxpath.c to extract potentially indexable joinclauses 
 * from ECs, and can be used by foreign data wrappers for similar purposes. 
 * We assume that only expressions in Vars of a single table are of interest, 
 * but the caller provides a callback function to identify exactly which 
 * such expressions it would like to know about. 
 * 
 * We assume that any given table/index column could appear in only one EC. 
 * (This should be true in all but the most pathological cases, and if it 
 * isn't, we stop on the first match anyway.)  Therefore, what we return 
 * is a redundant list of clauses equating the table/index column to each of 
 * the other-relation values it is known to be equal to.  Any one of 
 * these clauses can be used to create a parameterized path, and there 
 * is no value in using more than one.  (But it *is* worthwhile to create 
 * a separate parameterized path for each one, since that leads to different 
 * join orders.) 
 * 
 * The caller can pass a Relids set of rels we aren't interested in joining 
 * to, so as to save the work of creating useless clauses. 
 */ 
</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN2172"></a><span class='Declare_Function'>generate_implied_equalities_for_column</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN2173"></a>                                       <a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN2174"></a>                                       <a href="../../../include/optimizer/paths.h.html#LN118"><span class='Ref_to_Typedef'>ec_matches_callback_type</span></a> <span class='Declare_Parameter'>callback</span><span class='Delimiter'>, 
</span><a name="LN2175"></a>                                       <span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>callback_arg</span><span class='Delimiter'>, 
</span><a name="LN2176"></a>                                       <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>prohibited_rels</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2178"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN2179"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>is_child_rel</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2173"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN521"><span class='Ref_to_Member'>reloptkind</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/relation.h.html#LN495"><span class='Ref_to_EnumConst'>RELOPT_OTHER_MEMBER_REL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2180"></a>    <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a>      <span class='Declare_Local'>parent_relids</span><span class='Delimiter'>; 
</span><a name="LN2181"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Indexes are available only on base or "other" member relations. */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN504"><span class='Ref_to_Macro'>IS_SIMPLE_REL</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2173"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If it's a child rel, we'll need to know what its parent(s) are */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN2179"><span class='Ref_To_Local'>is_child_rel</span></a><span class='Parentheses'>) 
</span>        <a href="equivclass.c.html#LN2180"><span class='Ref_To_Local'>parent_relids</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/pathnode.h.html#LN274"><span class='Ref_to_Proto'>find_childrel_parents</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2172"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN2173"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="equivclass.c.html#LN2180"><span class='Ref_To_Local'>parent_relids</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* not used, but keep compiler quiet */ 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2181"><span class='Ref_To_Local'>lc1</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN2172"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN234"><span class='Ref_to_Member'>eq_classes</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2194"></a>        <a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cur_ec</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2181"><span class='Ref_To_Local'>lc1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2195"></a>        <a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cur_em</span><span class='Delimiter'>; 
</span><a name="LN2196"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc2</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Won't generate joinclauses if const or single-member (the latter 
         * test covers the volatile case too) 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN2194"><span class='Ref_To_Local'>cur_ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN777"><span class='Ref_to_Member'>ec_has_const</span></a> <span class='Operator'>|| </span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2194"><span class='Ref_To_Local'>cur_ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN772"><span class='Ref_to_Member'>ec_members</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * No point in searching if rel not mentioned in eclass (but we can't 
         * tell that for a child rel). 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="equivclass.c.html#LN2179"><span class='Ref_To_Local'>is_child_rel</span></a> <span class='Operator'>&& 
</span>            <span class='Operator'>!</span><a href="../../../include/nodes/bitmapset.h.html#LN73"><span class='Ref_to_Proto'>bms_is_subset</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2173"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN524"><span class='Ref_to_Member'>relids</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN2194"><span class='Ref_To_Local'>cur_ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN775"><span class='Ref_to_Member'>ec_relids</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Scan members, looking for a match to the target column.  Note that 
         * child EC members are considered, but only when they belong to the 
         * target relation.  (Unlike regular members, the same expression 
         * could be a child member of more than one EC.  Therefore, it's 
         * potentially order-dependent which EC a child relation's target 
         * column gets matched to.  This is annoying but it only happens in 
         * corner cases, so for now we live with just reporting the first 
         * match.  See also get_eclass_for_sort_expr.) 
         */ 
</span>        <a href="equivclass.c.html#LN2195"><span class='Ref_To_Local'>cur_em</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2196"><span class='Ref_To_Local'>lc2</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN2194"><span class='Ref_To_Local'>cur_ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN772"><span class='Ref_to_Member'>ec_members</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="equivclass.c.html#LN2195"><span class='Ref_To_Local'>cur_em</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2196"><span class='Ref_To_Local'>lc2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/bitmapset.h.html#LN66"><span class='Ref_to_Proto'>bms_equal</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2195"><span class='Ref_To_Local'>cur_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN821"><span class='Ref_to_Member'>em_relids</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN2173"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN524"><span class='Ref_to_Member'>relids</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>                <a href="equivclass.c.html#LN2174"><span class='Ref_to_Parameter'>callback</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2172"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN2173"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN2194"><span class='Ref_To_Local'>cur_ec</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN2195"><span class='Ref_To_Local'>cur_em</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN2175"><span class='Ref_to_Parameter'>callback_arg</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <a href="equivclass.c.html#LN2195"><span class='Ref_To_Local'>cur_em</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="equivclass.c.html#LN2195"><span class='Ref_To_Local'>cur_em</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Found our match.  Scan the other EC members and attempt to generate 
         * joinclauses. 
         */ 
</span>        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2196"><span class='Ref_To_Local'>lc2</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN2194"><span class='Ref_To_Local'>cur_ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN772"><span class='Ref_to_Member'>ec_members</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2242"></a>            <a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Declare_Local'>other_em</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2196"><span class='Ref_To_Local'>lc2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2243"></a>            <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>eq_op</span><span class='Delimiter'>; 
</span><a name="LN2244"></a>            <a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rinfo</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN2242"><span class='Ref_To_Local'>other_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN824"><span class='Ref_to_Member'>em_is_child</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* ignore children here */ 
</span> 
            <span class='Comment_Multi_Line'>/* Make sure it'll be a join to a different rel */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN2242"><span class='Ref_To_Local'>other_em</span></a> <span class='Operator'>== </span><a href="equivclass.c.html#LN2195"><span class='Ref_To_Local'>cur_em</span></a> <span class='Operator'>|| 
</span>                <a href="../../../include/nodes/bitmapset.h.html#LN76"><span class='Ref_to_Proto'>bms_overlap</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2242"><span class='Ref_To_Local'>other_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN821"><span class='Ref_to_Member'>em_relids</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN2173"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN524"><span class='Ref_to_Member'>relids</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Forget it if caller doesn't want joins to this rel */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/bitmapset.h.html#LN76"><span class='Ref_to_Proto'>bms_overlap</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2242"><span class='Ref_To_Local'>other_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN821"><span class='Ref_to_Member'>em_relids</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN2176"><span class='Ref_to_Parameter'>prohibited_rels</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Also, if this is a child rel, avoid generating a useless join 
             * to its parent rel(s). 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN2179"><span class='Ref_To_Local'>is_child_rel</span></a> <span class='Operator'>&& 
</span>                <a href="../../../include/nodes/bitmapset.h.html#LN76"><span class='Ref_to_Proto'>bms_overlap</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2180"><span class='Ref_To_Local'>parent_relids</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN2242"><span class='Ref_To_Local'>other_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN821"><span class='Ref_to_Member'>em_relids</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
            <a href="equivclass.c.html#LN2243"><span class='Ref_To_Local'>eq_op</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN53"><span class='Ref_to_Proto'>select_equality_operator</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2194"><span class='Ref_To_Local'>cur_ec</span></a><span class='Delimiter'>, 
</span>                                             <a href="equivclass.c.html#LN2195"><span class='Ref_To_Local'>cur_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN825"><span class='Ref_to_Member'>em_datatype</span></a><span class='Delimiter'>, 
</span>                                             <a href="equivclass.c.html#LN2242"><span class='Ref_To_Local'>other_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN825"><span class='Ref_to_Member'>em_datatype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2243"><span class='Ref_To_Local'>eq_op</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* set parent_ec to mark as redundant with other joinclauses */ 
</span>            <a href="equivclass.c.html#LN2244"><span class='Ref_To_Local'>rinfo</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN55"><span class='Ref_to_Proto'>create_join_clause</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2172"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN2194"><span class='Ref_To_Local'>cur_ec</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN2243"><span class='Ref_To_Local'>eq_op</span></a><span class='Delimiter'>, 
</span>                                       <a href="equivclass.c.html#LN2195"><span class='Ref_To_Local'>cur_em</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN2242"><span class='Ref_To_Local'>other_em</span></a><span class='Delimiter'>, 
</span>                                       <a href="equivclass.c.html#LN2194"><span class='Ref_To_Local'>cur_ec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="equivclass.c.html#LN2178"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2178"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN2244"><span class='Ref_To_Local'>rinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If somehow we failed to create any join clauses, we might as well 
         * keep scanning the ECs for another match.  But if we did make any, 
         * we're done, because we don't want to return non-redundant clauses. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN2178"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="equivclass.c.html#LN2178"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end generate_implied_equalities_for_column &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * have_relevant_eclass_joinclause 
 *      Detect whether there is an EquivalenceClass that could produce 
 *      a joinclause involving the two given relations. 
 * 
 * This is essentially a very cut-down version of 
 * generate_join_implied_equalities().  Note it's OK to occasionally say "yes" 
 * incorrectly.  Hence we don't bother with details like whether the lack of a 
 * cross-type operator might prevent the clause from actually being generated. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN2303"></a><span class='Declare_Function'>have_relevant_eclass_joinclause</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN2304"></a>                                <a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel1</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2306"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc1</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2306"><span class='Ref_To_Local'>lc1</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN2303"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN234"><span class='Ref_to_Member'>eq_classes</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2310"></a>        <a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ec</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2306"><span class='Ref_To_Local'>lc1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Won't generate joinclauses if single-member (this test covers the 
         * volatile case too) 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2310"><span class='Ref_To_Local'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN772"><span class='Ref_to_Member'>ec_members</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We do not need to examine the individual members of the EC, because 
         * all that we care about is whether each rel overlaps the relids of 
         * at least one member, and a test on ec_relids is sufficient to prove 
         * that.  (As with have_relevant_joinclause(), it is not necessary 
         * that the EC be able to form a joinclause relating exactly the two 
         * given rels, only that it be able to form a joinclause mentioning 
         * both, and this will surely be true if both of them overlap 
         * ec_relids.) 
         * 
         * Note we don't test ec_broken; if we did, we'd need a separate code 
         * path to look through ec_sources.  Checking the membership anyway is 
         * OK as a possibly-overoptimistic heuristic. 
         * 
         * We don't test ec_has_const either, even though a const eclass won't 
         * generate real join clauses.  This is because if we had "WHERE a.x = 
         * b.y and a.x = 42", it is worth considering a join between a and b, 
         * since the join result is likely to be small even though it'll end 
         * up being an unqualified nestloop. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/bitmapset.h.html#LN76"><span class='Ref_to_Proto'>bms_overlap</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2304"><span class='Ref_to_Parameter'>rel1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN524"><span class='Ref_to_Member'>relids</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN2310"><span class='Ref_To_Local'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN775"><span class='Ref_to_Member'>ec_relids</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>            <a href="../../../include/nodes/bitmapset.h.html#LN76"><span class='Ref_to_Proto'>bms_overlap</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2304"><span class='Ref_to_Parameter'>rel2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN524"><span class='Ref_to_Member'>relids</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN2310"><span class='Ref_To_Local'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN775"><span class='Ref_to_Member'>ec_relids</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end have_relevant_eclass_joinclause &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * has_relevant_eclass_joinclause 
 *      Detect whether there is an EquivalenceClass that could produce 
 *      a joinclause involving the given relation and anything else. 
 * 
 * This is the same as have_relevant_eclass_joinclause with the other rel 
 * implicitly defined as "everything else in the query". 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN2357"></a><span class='Declare_Function'>has_relevant_eclass_joinclause</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel1</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2359"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc1</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2359"><span class='Ref_To_Local'>lc1</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN2357"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN234"><span class='Ref_to_Member'>eq_classes</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2363"></a>        <a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ec</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2359"><span class='Ref_To_Local'>lc1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Won't generate joinclauses if single-member (this test covers the 
         * volatile case too) 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2363"><span class='Ref_To_Local'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN772"><span class='Ref_to_Member'>ec_members</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Per the comment in have_relevant_eclass_joinclause, it's sufficient 
         * to find an EC that mentions both this rel and some other rel. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/bitmapset.h.html#LN76"><span class='Ref_to_Proto'>bms_overlap</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2357"><span class='Ref_to_Parameter'>rel1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN524"><span class='Ref_to_Member'>relids</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN2363"><span class='Ref_To_Local'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN775"><span class='Ref_to_Member'>ec_relids</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>            <span class='Operator'>!</span><a href="../../../include/nodes/bitmapset.h.html#LN73"><span class='Ref_to_Proto'>bms_is_subset</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2363"><span class='Ref_To_Local'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN775"><span class='Ref_to_Member'>ec_relids</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN2357"><span class='Ref_to_Parameter'>rel1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN524"><span class='Ref_to_Member'>relids</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end has_relevant_eclass_joinclause &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * eclass_useful_for_merging 
 *    Detect whether the EC could produce any mergejoinable join clauses 
 *    against the specified relation. 
 * 
 * This is just a heuristic test and doesn't have to be exact; it's better 
 * to say "yes" incorrectly than "no".  Hence we don't bother with details 
 * like whether the lack of a cross-type operator might prevent the clause 
 * from actually being generated. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN2396"></a><span class='Declare_Function'>eclass_useful_for_merging</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN2397"></a>                          <a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>eclass</span><span class='Delimiter'>, 
</span><a name="LN2398"></a>                          <a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2400"></a>    <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a>      <span class='Declare_Local'>relids</span><span class='Delimiter'>; 
</span><a name="LN2401"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="equivclass.c.html#LN2397"><span class='Ref_to_Parameter'>eclass</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN784"><span class='Ref_to_Member'>ec_merged</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Won't generate joinclauses if const or single-member (the latter test 
     * covers the volatile case too) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN2397"><span class='Ref_to_Parameter'>eclass</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN777"><span class='Ref_to_Member'>ec_has_const</span></a> <span class='Operator'>|| </span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2397"><span class='Ref_to_Parameter'>eclass</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN772"><span class='Ref_to_Member'>ec_members</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Note we don't test ec_broken; if we did, we'd need a separate code path 
     * to look through ec_sources.  Checking the members anyway is OK as a 
     * possibly-overoptimistic heuristic. 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* If specified rel is a child, we must consider the topmost parent rel */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN515"><span class='Ref_to_Macro'>IS_OTHER_REL</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2398"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/bitmapset.h.html#LN85"><span class='Ref_to_Proto'>bms_is_empty</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2398"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN593"><span class='Ref_to_Member'>top_parent_relids</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="equivclass.c.html#LN2400"><span class='Ref_To_Local'>relids</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN2398"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN593"><span class='Ref_to_Member'>top_parent_relids</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="equivclass.c.html#LN2400"><span class='Ref_To_Local'>relids</span></a> <span class='Operator'>= </span><a href="equivclass.c.html#LN2398"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN524"><span class='Ref_to_Member'>relids</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If rel already includes all members of eclass, no point in searching */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/bitmapset.h.html#LN73"><span class='Ref_to_Proto'>bms_is_subset</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2397"><span class='Ref_to_Parameter'>eclass</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN775"><span class='Ref_to_Member'>ec_relids</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN2400"><span class='Ref_To_Local'>relids</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* To join, we need a member not in the given rel */ 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2401"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN2397"><span class='Ref_to_Parameter'>eclass</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN772"><span class='Ref_to_Member'>ec_members</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2434"></a>        <a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cur_em</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2401"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN2434"><span class='Ref_To_Local'>cur_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN824"><span class='Ref_to_Member'>em_is_child</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* ignore children here */ 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/bitmapset.h.html#LN76"><span class='Ref_to_Proto'>bms_overlap</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2434"><span class='Ref_To_Local'>cur_em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN821"><span class='Ref_to_Member'>em_relids</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN2400"><span class='Ref_To_Local'>relids</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end eclass_useful_for_merging &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * is_redundant_derived_clause 
 *      Test whether rinfo is derived from same EC as any clause in clauselist; 
 *      if so, it can be presumed to represent a condition that's redundant 
 *      with that member of the list. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN2454"></a><span class='Declare_Function'>is_redundant_derived_clause</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rinfo</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>clauselist</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2456"></a>    <a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Declare_Local'>parent_ec</span> <span class='Operator'>= </span><a href="equivclass.c.html#LN2454"><span class='Ref_to_Parameter'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1780"><span class='Ref_to_Member'>parent_ec</span></a><span class='Delimiter'>; 
</span><a name="LN2457"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Fail if it's not a potentially-redundant clause from some EC */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN2456"><span class='Ref_To_Local'>parent_ec</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2457"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="equivclass.c.html#LN2454"><span class='Ref_to_Parameter'>clauselist</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2465"></a>        <a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>otherrinfo</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="equivclass.c.html#LN2457"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="equivclass.c.html#LN2465"><span class='Ref_To_Local'>otherrinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1780"><span class='Ref_to_Member'>parent_ec</span></a> <span class='Operator'>== </span><a href="equivclass.c.html#LN2456"><span class='Ref_To_Local'>parent_ec</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end is_redundant_derived_clause &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>