<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\optimizer\path\indxpath.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\optimizer\path\indxpath.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:41 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * indxpath.c 
 *    Routines to determine which indexes are usable for scanning a 
 *    given relation, and create Paths accordingly. 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/optimizer/path/indxpath.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;math.h&GT;</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/stratnum.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/sysattr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_am.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_collation.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_operator.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_opfamily.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"nodes/makefuncs.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/clauses.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/cost.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/pathnode.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/paths.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/predtest.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/prep.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/restrictinfo.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/var.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/bytea.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/pg_locale.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/selfuncs.h"</span> 
 
 
<a name="LN42"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>IsBooleanOpfamily</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>opfamily</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>((</span><a href="indxpath.c.html#LN42"><span class='Ref_to_Parameter'>opfamily</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../../include/catalog/pg_opfamily.h.html#LN65"><span class='Ref_to_Const'>BOOL_BTREE_FAM_OID</span></a> <span class='Operator'>|| </span><span class='Parentheses'>(</span><a href="indxpath.c.html#LN42"><span class='Ref_to_Parameter'>opfamily</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../../include/catalog/pg_opfamily.h.html#LN119"><span class='Ref_to_Const'>BOOL_HASH_FAM_OID</span></a><span class='Parentheses'>)</span> 
 
<a name="LN45"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>IndexCollMatchesExprColl</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>idxcollation</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>exprcollation</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>((</span><a href="indxpath.c.html#LN45"><span class='Ref_to_Parameter'>idxcollation</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a> <span class='Operator'>|| </span><span class='Parentheses'>(</span><a href="indxpath.c.html#LN45"><span class='Ref_to_Parameter'>idxcollation</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Parentheses'>(</span><a href="indxpath.c.html#LN45"><span class='Ref_to_Parameter'>exprcollation</span></a><span class='Parentheses'>))</span> 
 
<span class='Comment_Multi_Line'>/* Whether we are looking for plain indexscan, bitmap scan, or either */ 
</span><span class='Control'>typedef</span> <span class='Control'>enum</span> 
<span class='Delimiter'>{ 
</span><a name="LN51"></a>    <span class='Declare_Enum_Const'>ST_INDEXSCAN</span><span class='Delimiter'>,</span>               <span class='Comment_Single_Line'>/* must support amgettuple */ 
</span><a name="LN52"></a>    <span class='Declare_Enum_Const'>ST_BITMAPSCAN</span><span class='Delimiter'>,</span>              <span class='Comment_Single_Line'>/* must support amgetbitmap */ 
</span><a name="LN53"></a>    <span class='Declare_Enum_Const'>ST_ANYSCAN</span>                  <span class='Comment_Single_Line'>/* either is okay */ 
</span><a name="LN54"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>ScanTypeControl</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* Data structure for collecting qual clauses that match an index */ 
</span><span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN59"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>nonempty</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* True if lists are not all empty */ 
</span>    <span class='Comment_Multi_Line'>/* Lists of RestrictInfos, one per index column */ 
</span><a name="LN61"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>indexclauses</span><span class='Delimiter'>[</span><a href="../../../include/pg_config_manual.h.html#LN45"><span class='Ref_to_Const'>INDEX_MAX_KEYS</span></a><span class='Delimiter'>]; 
</span><a name="LN62"></a>} <span class='Declare_Typedef'>IndexClauseSet</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* Per-path data used within choose_bitmap_and() */ 
</span><span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN67"></a>    <a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>path</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* IndexPath, BitmapAndPath, or BitmapOrPath */ 
</span><a name="LN68"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>quals</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* the WHERE clauses it uses */ 
</span><a name="LN69"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>preds</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* predicates of its partial index(es) */ 
</span><a name="LN70"></a>    <a href="../../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a>  <span class='Operator'>*</span><span class='Declare_Member'>clauseids</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* quals+preds represented as a bitmapset */ 
</span><a name="LN71"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>PathClauseUsage</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* Callback argument for ec_member_matches_indexcol */ 
</span><span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN76"></a>    <a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Member'>index</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* index we're considering */ 
</span><a name="LN77"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>indexcol</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* index column we want to match to */ 
</span><a name="LN78"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>ec_member_matches_arg</span><span class='Delimiter'>; 
</span> 
 
<a name="LN81"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>consider_index_join_clauses</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN82"></a>                            <a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>index</span><span class='Delimiter'>, 
</span><a name="LN83"></a>                            <a href="indxpath.c.html#LN57"><span class='Ref_to_Typedef'>IndexClauseSet</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rclauseset</span><span class='Delimiter'>, 
</span><a name="LN84"></a>                            <a href="indxpath.c.html#LN57"><span class='Ref_to_Typedef'>IndexClauseSet</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jclauseset</span><span class='Delimiter'>, 
</span><a name="LN85"></a>                            <a href="indxpath.c.html#LN57"><span class='Ref_to_Typedef'>IndexClauseSet</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>eclauseset</span><span class='Delimiter'>, 
</span><a name="LN86"></a>                            <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>bitindexpaths</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN87"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>consider_index_join_outer_rels</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN88"></a>                               <a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>index</span><span class='Delimiter'>, 
</span><a name="LN89"></a>                               <a href="indxpath.c.html#LN57"><span class='Ref_to_Typedef'>IndexClauseSet</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rclauseset</span><span class='Delimiter'>, 
</span><a name="LN90"></a>                               <a href="indxpath.c.html#LN57"><span class='Ref_to_Typedef'>IndexClauseSet</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jclauseset</span><span class='Delimiter'>, 
</span><a name="LN91"></a>                               <a href="indxpath.c.html#LN57"><span class='Ref_to_Typedef'>IndexClauseSet</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>eclauseset</span><span class='Delimiter'>, 
</span><a name="LN92"></a>                               <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>bitindexpaths</span><span class='Delimiter'>, 
</span><a name="LN93"></a>                               <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>indexjoinclauses</span><span class='Delimiter'>, 
</span><a name="LN94"></a>                               <span class='Keyword'>int </span><span class='Declare_Parameter'>considered_clauses</span><span class='Delimiter'>, 
</span><a name="LN95"></a>                               <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>considered_relids</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN96"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>get_join_index_paths</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN97"></a>                     <a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>index</span><span class='Delimiter'>, 
</span><a name="LN98"></a>                     <a href="indxpath.c.html#LN57"><span class='Ref_to_Typedef'>IndexClauseSet</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rclauseset</span><span class='Delimiter'>, 
</span><a name="LN99"></a>                     <a href="indxpath.c.html#LN57"><span class='Ref_to_Typedef'>IndexClauseSet</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jclauseset</span><span class='Delimiter'>, 
</span><a name="LN100"></a>                     <a href="indxpath.c.html#LN57"><span class='Ref_to_Typedef'>IndexClauseSet</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>eclauseset</span><span class='Delimiter'>, 
</span><a name="LN101"></a>                     <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>bitindexpaths</span><span class='Delimiter'>, 
</span><a name="LN102"></a>                     <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>relids</span><span class='Delimiter'>, 
</span><a name="LN103"></a>                     <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>considered_relids</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN104"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>eclass_already_used</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>parent_ec</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>oldrelids</span><span class='Delimiter'>, 
</span><a name="LN105"></a>                    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>indexjoinclauses</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN106"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>bms_equal_any</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>relids</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>relids_list</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN107"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>get_index_paths</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN108"></a>                <a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>index</span><span class='Delimiter'>, </span><a href="indxpath.c.html#LN57"><span class='Ref_to_Typedef'>IndexClauseSet</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>clauses</span><span class='Delimiter'>, 
</span><a name="LN109"></a>                <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>bitindexpaths</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN110"></a><span class='Keyword'>static </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>build_index_paths</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN111"></a>                  <a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>index</span><span class='Delimiter'>, </span><a href="indxpath.c.html#LN57"><span class='Ref_to_Typedef'>IndexClauseSet</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>clauses</span><span class='Delimiter'>, 
</span><a name="LN112"></a>                  <span class='Keyword'>bool </span><span class='Declare_Parameter'>useful_predicate</span><span class='Delimiter'>, 
</span><a name="LN113"></a>                  <a href="indxpath.c.html#LN49"><span class='Ref_to_Typedef'>ScanTypeControl</span></a> <span class='Declare_Parameter'>scantype</span><span class='Delimiter'>, 
</span><a name="LN114"></a>                  <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>skip_nonnative_saop</span><span class='Delimiter'>, 
</span><a name="LN115"></a>                  <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>skip_lower_saop</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN116"></a><span class='Keyword'>static </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>build_paths_for_OR</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN117"></a>                   <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>clauses</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>other_clauses</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN118"></a><span class='Keyword'>static </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>generate_bitmap_or_paths</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN119"></a>                         <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>clauses</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>other_clauses</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN120"></a><span class='Keyword'>static </span><a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>choose_bitmap_and</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN121"></a>                  <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>paths</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN122"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>path_usage_comparator</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>b</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN123"></a><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN638"><span class='Ref_to_Typedef'>Cost</span></a> <span class='Declare_Prototype'>bitmap_scan_cost_est</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN124"></a>                     <a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ipath</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN125"></a><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN638"><span class='Ref_to_Typedef'>Cost</span></a> <span class='Declare_Prototype'>bitmap_and_cost_est</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN126"></a>                    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>paths</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN127"></a><span class='Keyword'>static </span><a href="indxpath.c.html#LN65"><span class='Ref_to_Typedef'>PathClauseUsage</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>classify_index_clause_usage</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>path</span><span class='Delimiter'>, 
</span><a name="LN128"></a>                            <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>clauselist</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN129"></a><span class='Keyword'>static </span><a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Prototype'>get_bitmap_tree_required_outer</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>bitmapqual</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN130"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>find_indexpath_quals</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>bitmapqual</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>quals</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>preds</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN131"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>find_list_position</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>nodelist</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN132"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>check_index_only</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>index</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN133"></a><span class='Keyword'>static double </span><span class='Declare_Prototype'>get_loop_count</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>cur_relid</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>outer_relids</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN134"></a><span class='Keyword'>static double </span><span class='Declare_Prototype'>adjust_rowcount_for_semijoins</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN135"></a>                              <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>cur_relid</span><span class='Delimiter'>, 
</span><a name="LN136"></a>                              <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>outer_relid</span><span class='Delimiter'>, 
</span><a name="LN137"></a>                              <span class='Keyword'>double </span><span class='Declare_Parameter'>rowcount</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN138"></a><span class='Keyword'>static double </span><span class='Declare_Prototype'>approximate_joinrel_size</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>relids</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN139"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>match_restriction_clauses_to_index</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN140"></a>                                   <a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>index</span><span class='Delimiter'>, 
</span><a name="LN141"></a>                                   <a href="indxpath.c.html#LN57"><span class='Ref_to_Typedef'>IndexClauseSet</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>clauseset</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN142"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>match_join_clauses_to_index</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN143"></a>                            <a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>index</span><span class='Delimiter'>, 
</span><a name="LN144"></a>                            <a href="indxpath.c.html#LN57"><span class='Ref_to_Typedef'>IndexClauseSet</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>clauseset</span><span class='Delimiter'>, 
</span><a name="LN145"></a>                            <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>joinorclauses</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN146"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>match_eclass_clauses_to_index</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN147"></a>                              <a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>index</span><span class='Delimiter'>, 
</span><a name="LN148"></a>                              <a href="indxpath.c.html#LN57"><span class='Ref_to_Typedef'>IndexClauseSet</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>clauseset</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN149"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>match_clauses_to_index</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>index</span><span class='Delimiter'>, 
</span><a name="LN150"></a>                       <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>clauses</span><span class='Delimiter'>, 
</span><a name="LN151"></a>                       <a href="indxpath.c.html#LN57"><span class='Ref_to_Typedef'>IndexClauseSet</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>clauseset</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN152"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>match_clause_to_index</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>index</span><span class='Delimiter'>, 
</span><a name="LN153"></a>                      <a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rinfo</span><span class='Delimiter'>, 
</span><a name="LN154"></a>                      <a href="indxpath.c.html#LN57"><span class='Ref_to_Typedef'>IndexClauseSet</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>clauseset</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN155"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>match_clause_to_indexcol</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>index</span><span class='Delimiter'>, 
</span><a name="LN156"></a>                         <span class='Keyword'>int </span><span class='Declare_Parameter'>indexcol</span><span class='Delimiter'>, 
</span><a name="LN157"></a>                         <a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rinfo</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN158"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>is_indexable_operator</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>expr_op</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>opfamily</span><span class='Delimiter'>, 
</span><a name="LN159"></a>                      <span class='Keyword'>bool </span><span class='Declare_Parameter'>indexkey_on_left</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN160"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>match_rowcompare_to_indexcol</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>index</span><span class='Delimiter'>, 
</span><a name="LN161"></a>                             <span class='Keyword'>int </span><span class='Declare_Parameter'>indexcol</span><span class='Delimiter'>, 
</span><a name="LN162"></a>                             <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>opfamily</span><span class='Delimiter'>, 
</span><a name="LN163"></a>                             <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>idxcollation</span><span class='Delimiter'>, 
</span><a name="LN164"></a>                             <a href="../../../include/nodes/primnodes.h.html#LN1026"><span class='Ref_to_Struct'>RowCompareExpr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>clause</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN165"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>match_pathkeys_to_index</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>index</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pathkeys</span><span class='Delimiter'>, 
</span><a name="LN166"></a>                        <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>orderby_clauses_p</span><span class='Delimiter'>, 
</span><a name="LN167"></a>                        <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>clause_columns_p</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN168"></a><span class='Keyword'>static </span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>match_clause_to_ordering_op</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>index</span><span class='Delimiter'>, 
</span><a name="LN169"></a>                            <span class='Keyword'>int </span><span class='Declare_Parameter'>indexcol</span><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>clause</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>pk_opfamily</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN170"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>ec_member_matches_indexcol</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN171"></a>                           <a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ec</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>em</span><span class='Delimiter'>, 
</span><a name="LN172"></a>                           <span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN173"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>match_boolean_index_clause</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>clause</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>indexcol</span><span class='Delimiter'>, 
</span><a name="LN174"></a>                           <a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>index</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN175"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>match_special_index_operator</span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>clause</span><span class='Delimiter'>, 
</span><a name="LN176"></a>                             <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>opfamily</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>idxcollation</span><span class='Delimiter'>, 
</span><a name="LN177"></a>                             <span class='Keyword'>bool </span><span class='Declare_Parameter'>indexkey_on_left</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN178"></a><span class='Keyword'>static </span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>expand_boolean_index_clause</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>clause</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>indexcol</span><span class='Delimiter'>, 
</span><a name="LN179"></a>                            <a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>index</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN180"></a><span class='Keyword'>static </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>expand_indexqual_opclause</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rinfo</span><span class='Delimiter'>, 
</span><a name="LN181"></a>                          <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>opfamily</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>idxcollation</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN182"></a><span class='Keyword'>static </span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>expand_indexqual_rowcompare</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rinfo</span><span class='Delimiter'>, 
</span><a name="LN183"></a>                            <a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>index</span><span class='Delimiter'>, 
</span><a name="LN184"></a>                            <span class='Keyword'>int </span><span class='Declare_Parameter'>indexcol</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN185"></a><span class='Keyword'>static </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>prefix_quals</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>leftop</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>opfamily</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>collation</span><span class='Delimiter'>, 
</span><a name="LN186"></a>             <a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>prefix</span><span class='Delimiter'>, </span><a href="../../../include/utils/selfuncs.h.html#LN93"><span class='Ref_to_Typedef'>Pattern_Prefix_Status</span></a> <span class='Declare_Parameter'>pstatus</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN187"></a><span class='Keyword'>static </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>network_prefix_quals</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>leftop</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>expr_op</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>opfamily</span><span class='Delimiter'>, 
</span><a name="LN188"></a>                     <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>rightop</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN189"></a><span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Prototype'>string_to_datum</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>datatype</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN190"></a><span class='Keyword'>static </span><a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>string_to_const</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>datatype</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * create_index_paths() 
 *    Generate all interesting index paths for the given relation. 
 *    Candidate paths are added to the rel's pathlist (using add_path). 
 * 
 * To be considered for an index scan, an index must match one or more 
 * restriction clauses or join clauses from the query's qual condition, 
 * or match the query's ORDER BY condition, or have a predicate that 
 * matches the query's qual condition. 
 * 
 * There are two basic kinds of index scans.  A "plain" index scan uses 
 * only restriction clauses (possibly none at all) in its indexqual, 
 * so it can be applied in any context.  A "parameterized" index scan uses 
 * join clauses (plus restriction clauses, if available) in its indexqual. 
 * When joining such a scan to one of the relations supplying the other 
 * variables used in its indexqual, the parameterized scan must appear as 
 * the inner relation of a nestloop join; it can't be used on the outer side, 
 * nor in a merge or hash join.  In that context, values for the other rels' 
 * attributes are available and fixed during any one scan of the indexpath. 
 * 
 * An IndexPath is generated and submitted to add_path() for each plain or 
 * parameterized index scan this routine deems potentially interesting for 
 * the current query. 
 * 
 * 'rel' is the relation for which we want to generate index paths 
 * 
 * Note: check_index_predicates() must have been run previously for this rel. 
 * 
 * Note: in cases involving LATERAL references in the relation's tlist, it's 
 * possible that rel-&GT;lateral_relids is nonempty.  Currently, we include 
 * lateral_relids into the parameterization reported for each path, but don't 
 * take it into account otherwise.  The fact that any such rels *must* be 
 * available as parameter sources perhaps should influence our choices of 
 * index quals ... but for now, it doesn't seem worth troubling over. 
 * In particular, comments below about "unparameterized" paths should be read 
 * as meaning "unparameterized so far as the indexquals are concerned". 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN231"></a><span class='Declare_Function'>create_index_paths</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN233"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>indexpaths</span><span class='Delimiter'>; 
</span><a name="LN234"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>bitindexpaths</span><span class='Delimiter'>; 
</span><a name="LN235"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>bitjoinpaths</span><span class='Delimiter'>; 
</span><a name="LN236"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>joinorclauses</span><span class='Delimiter'>; 
</span><a name="LN237"></a>    <a href="indxpath.c.html#LN57"><span class='Ref_to_Typedef'>IndexClauseSet</span></a> <span class='Declare_Local'>rclauseset</span><span class='Delimiter'>; 
</span><a name="LN238"></a>    <a href="indxpath.c.html#LN57"><span class='Ref_to_Typedef'>IndexClauseSet</span></a> <span class='Declare_Local'>jclauseset</span><span class='Delimiter'>; 
</span><a name="LN239"></a>    <a href="indxpath.c.html#LN57"><span class='Ref_to_Typedef'>IndexClauseSet</span></a> <span class='Declare_Local'>eclauseset</span><span class='Delimiter'>; 
</span><a name="LN240"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Skip the whole mess if no indexes */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN231"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN561"><span class='Ref_to_Member'>indexlist</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Bitmap paths are collected and then dealt with at the end */ 
</span>    <a href="indxpath.c.html#LN234"><span class='Ref_To_Local'>bitindexpaths</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN235"><span class='Ref_To_Local'>bitjoinpaths</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN236"><span class='Ref_To_Local'>joinorclauses</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Examine each index in turn */ 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN240"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN231"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN561"><span class='Ref_to_Member'>indexlist</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN252"></a>        <a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>index</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN240"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Protect limited-size array in IndexClauseSets */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="indxpath.c.html#LN252"><span class='Ref_To_Local'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN640"><span class='Ref_to_Member'>ncolumns</span></a> <span class='Operator'>&LT;= </span><a href="../../../include/pg_config_manual.h.html#LN45"><span class='Ref_to_Const'>INDEX_MAX_KEYS</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Ignore partial indexes that do not match the query. 
         * (generate_bitmap_or_paths() might be able to do something with 
         * them, but that's of no concern here.) 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN252"><span class='Ref_To_Local'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN653"><span class='Ref_to_Member'>indpred</span></a> <span class='Operator'>!= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a> <span class='Operator'>&& !</span><a href="indxpath.c.html#LN252"><span class='Ref_To_Local'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN662"><span class='Ref_to_Member'>predOK</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Identify the restriction clauses that can match the index. 
         */ 
</span>        <a href="../../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="indxpath.c.html#LN237"><span class='Ref_To_Local'>rclauseset</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="indxpath.c.html#LN237"><span class='Ref_To_Local'>rclauseset</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN139"><span class='Ref_to_Proto'>match_restriction_clauses_to_index</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN231"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN252"><span class='Ref_To_Local'>index</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="indxpath.c.html#LN237"><span class='Ref_To_Local'>rclauseset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Build index paths from the restriction clauses.  These will be 
         * non-parameterized paths.  Plain paths go directly to add_path(), 
         * bitmap paths are added to bitindexpaths to be handled below. 
         */ 
</span>        <a href="indxpath.c.html#LN107"><span class='Ref_to_Proto'>get_index_paths</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN231"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN231"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN252"><span class='Ref_To_Local'>index</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="indxpath.c.html#LN237"><span class='Ref_To_Local'>rclauseset</span></a><span class='Delimiter'>, 
</span>                        <span class='Operator'>&</span><a href="indxpath.c.html#LN234"><span class='Ref_To_Local'>bitindexpaths</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Identify the join clauses that can match the index.  For the moment 
         * we keep them separate from the restriction clauses.  Note that this 
         * step finds only "loose" join clauses that have not been merged into 
         * EquivalenceClasses.  Also, collect join OR clauses for later. 
         */ 
</span>        <a href="../../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="indxpath.c.html#LN238"><span class='Ref_To_Local'>jclauseset</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="indxpath.c.html#LN238"><span class='Ref_To_Local'>jclauseset</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN142"><span class='Ref_to_Proto'>match_join_clauses_to_index</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN231"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN231"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN252"><span class='Ref_To_Local'>index</span></a><span class='Delimiter'>, 
</span>                                    <span class='Operator'>&</span><a href="indxpath.c.html#LN238"><span class='Ref_To_Local'>jclauseset</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="indxpath.c.html#LN236"><span class='Ref_To_Local'>joinorclauses</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Look for EquivalenceClasses that can generate joinclauses matching 
         * the index. 
         */ 
</span>        <a href="../../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="indxpath.c.html#LN239"><span class='Ref_To_Local'>eclauseset</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="indxpath.c.html#LN239"><span class='Ref_To_Local'>eclauseset</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN146"><span class='Ref_to_Proto'>match_eclass_clauses_to_index</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN231"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN252"><span class='Ref_To_Local'>index</span></a><span class='Delimiter'>, 
</span>                                      <span class='Operator'>&</span><a href="indxpath.c.html#LN239"><span class='Ref_To_Local'>eclauseset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If we found any plain or eclass join clauses, build parameterized 
         * index paths using them. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN238"><span class='Ref_To_Local'>jclauseset</span></a><span class='Operator'>.</span><a href="indxpath.c.html#LN59"><span class='Ref_to_Member'>nonempty</span></a> <span class='Operator'>|| </span><a href="indxpath.c.html#LN239"><span class='Ref_To_Local'>eclauseset</span></a><span class='Operator'>.</span><a href="indxpath.c.html#LN59"><span class='Ref_to_Member'>nonempty</span></a><span class='Parentheses'>) 
</span>            <a href="indxpath.c.html#LN81"><span class='Ref_to_Proto'>consider_index_join_clauses</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN231"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN231"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN252"><span class='Ref_To_Local'>index</span></a><span class='Delimiter'>, 
</span>                                        <span class='Operator'>&</span><a href="indxpath.c.html#LN237"><span class='Ref_To_Local'>rclauseset</span></a><span class='Delimiter'>, 
</span>                                        <span class='Operator'>&</span><a href="indxpath.c.html#LN238"><span class='Ref_To_Local'>jclauseset</span></a><span class='Delimiter'>, 
</span>                                        <span class='Operator'>&</span><a href="indxpath.c.html#LN239"><span class='Ref_To_Local'>eclauseset</span></a><span class='Delimiter'>, 
</span>                                        <span class='Operator'>&</span><a href="indxpath.c.html#LN235"><span class='Ref_To_Local'>bitjoinpaths</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Generate BitmapOrPaths for any suitable OR-clauses present in the 
     * restriction list.  Add these to bitindexpaths. 
     */ 
</span>    <a href="indxpath.c.html#LN233"><span class='Ref_To_Local'>indexpaths</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN118"><span class='Ref_to_Proto'>generate_bitmap_or_paths</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN231"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN231"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, 
</span>                                          <a href="indxpath.c.html#LN231"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN583"><span class='Ref_to_Member'>baserestrictinfo</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="indxpath.c.html#LN234"><span class='Ref_To_Local'>bitindexpaths</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN234"><span class='Ref_To_Local'>bitindexpaths</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN233"><span class='Ref_To_Local'>indexpaths</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Likewise, generate BitmapOrPaths for any suitable OR-clauses present in 
     * the joinclause list.  Add these to bitjoinpaths. 
     */ 
</span>    <a href="indxpath.c.html#LN233"><span class='Ref_To_Local'>indexpaths</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN118"><span class='Ref_to_Proto'>generate_bitmap_or_paths</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN231"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN231"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, 
</span>                                       <a href="indxpath.c.html#LN236"><span class='Ref_To_Local'>joinorclauses</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN231"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN583"><span class='Ref_to_Member'>baserestrictinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="indxpath.c.html#LN235"><span class='Ref_To_Local'>bitjoinpaths</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN235"><span class='Ref_To_Local'>bitjoinpaths</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN233"><span class='Ref_To_Local'>indexpaths</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we found anything usable, generate a BitmapHeapPath for the most 
     * promising combination of restriction bitmap index paths.  Note there 
     * will be only one such path no matter how many indexes exist.  This 
     * should be sufficient since there's basically only one figure of merit 
     * (total cost) for such a path. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN234"><span class='Ref_To_Local'>bitindexpaths</span></a> <span class='Operator'>!= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN334"></a>        <a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>bitmapqual</span><span class='Delimiter'>; 
</span><a name="LN335"></a>        <a href="../../../include/nodes/relation.h.html#LN1058"><span class='Ref_to_Struct'>BitmapHeapPath</span></a> <span class='Operator'>*</span><span class='Declare_Local'>bpath</span><span class='Delimiter'>; 
</span> 
        <a href="indxpath.c.html#LN334"><span class='Ref_To_Local'>bitmapqual</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN120"><span class='Ref_to_Proto'>choose_bitmap_and</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN231"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN231"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN234"><span class='Ref_To_Local'>bitindexpaths</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN335"><span class='Ref_To_Local'>bpath</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/pathnode.h.html#LN51"><span class='Ref_to_Proto'>create_bitmap_heap_path</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN231"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN231"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN334"><span class='Ref_To_Local'>bitmapqual</span></a><span class='Delimiter'>, 
</span>                                        <a href="indxpath.c.html#LN231"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN549"><span class='Ref_to_Member'>lateral_relids</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/optimizer/pathnode.h.html#LN27"><span class='Ref_to_Proto'>add_path</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN231"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN335"><span class='Ref_To_Local'>bpath</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* create a partial bitmap heap path */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN231"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN532"><span class='Ref_to_Member'>consider_parallel</span></a> <span class='Operator'>&& </span><a href="indxpath.c.html#LN231"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN549"><span class='Ref_to_Member'>lateral_relids</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="../../../include/optimizer/paths.h.html#LN58"><span class='Ref_to_Proto'>create_partial_bitmap_paths</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN231"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN231"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN334"><span class='Ref_To_Local'>bitmapqual</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Likewise, if we found anything usable, generate BitmapHeapPaths for the 
     * most promising combinations of join bitmap index paths.  Our strategy 
     * is to generate one such path for each distinct parameterization seen 
     * among the available bitmap index paths.  This may look pretty 
     * expensive, but usually there won't be very many distinct 
     * parameterizations.  (This logic is quite similar to that in 
     * consider_index_join_clauses, but we're working with whole paths not 
     * individual clauses.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN235"><span class='Ref_To_Local'>bitjoinpaths</span></a> <span class='Operator'>!= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN359"></a>        <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>path_outer</span><span class='Delimiter'>; 
</span><a name="LN360"></a>        <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>all_path_outers</span><span class='Delimiter'>; 
</span><a name="LN361"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * path_outer holds the parameterization of each path in bitjoinpaths 
         * (to save recalculating that several times), while all_path_outers 
         * holds all distinct parameterization sets. 
         */ 
</span>        <a href="indxpath.c.html#LN359"><span class='Ref_To_Local'>path_outer</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN360"><span class='Ref_To_Local'>all_path_outers</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN361"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN235"><span class='Ref_To_Local'>bitjoinpaths</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN371"></a>            <a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>path</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN361"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN372"></a>            <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a>      <span class='Declare_Local'>required_outer</span><span class='Delimiter'>; 
</span> 
            <a href="indxpath.c.html#LN372"><span class='Ref_To_Local'>required_outer</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN129"><span class='Ref_to_Proto'>get_bitmap_tree_required_outer</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN371"><span class='Ref_To_Local'>path</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="indxpath.c.html#LN359"><span class='Ref_To_Local'>path_outer</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN359"><span class='Ref_To_Local'>path_outer</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN372"><span class='Ref_To_Local'>required_outer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="indxpath.c.html#LN106"><span class='Ref_to_Proto'>bms_equal_any</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN372"><span class='Ref_To_Local'>required_outer</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN360"><span class='Ref_To_Local'>all_path_outers</span></a><span class='Parentheses'>))</span> 
                <a href="indxpath.c.html#LN360"><span class='Ref_To_Local'>all_path_outers</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN360"><span class='Ref_To_Local'>all_path_outers</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN372"><span class='Ref_To_Local'>required_outer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Now, for each distinct parameterization set ... */ 
</span>        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN361"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN360"><span class='Ref_To_Local'>all_path_outers</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN383"></a>            <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a>      <span class='Declare_Local'>max_outers</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN361"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN384"></a>            <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>this_path_set</span><span class='Delimiter'>; 
</span><a name="LN385"></a>            <a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>bitmapqual</span><span class='Delimiter'>; 
</span><a name="LN386"></a>            <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a>      <span class='Declare_Local'>required_outer</span><span class='Delimiter'>; 
</span><a name="LN387"></a>            <span class='Keyword'>double</span>      <span class='Declare_Local'>loop_count</span><span class='Delimiter'>; 
</span><a name="LN388"></a>            <a href="../../../include/nodes/relation.h.html#LN1058"><span class='Ref_to_Struct'>BitmapHeapPath</span></a> <span class='Operator'>*</span><span class='Declare_Local'>bpath</span><span class='Delimiter'>; 
</span><a name="LN389"></a>            <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lcp</span><span class='Delimiter'>; 
</span><a name="LN390"></a>            <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lco</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Identify all the bitmap join paths needing no more than that */ 
</span>            <a href="indxpath.c.html#LN384"><span class='Ref_To_Local'>this_path_set</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>            <a href="../../../include/nodes/pg_list.h.html#LN179"><span class='Ref_to_Macro'>forboth</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN389"><span class='Ref_To_Local'>lcp</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN235"><span class='Ref_To_Local'>bitjoinpaths</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN390"><span class='Ref_To_Local'>lco</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN359"><span class='Ref_To_Local'>path_outer</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN396"></a>                <a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>path</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN389"><span class='Ref_To_Local'>lcp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN397"></a>                <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a>      <span class='Declare_Local'>p_outers</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN390"><span class='Ref_To_Local'>lco</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/bitmapset.h.html#LN73"><span class='Ref_to_Proto'>bms_is_subset</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN397"><span class='Ref_To_Local'>p_outers</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN383"><span class='Ref_To_Local'>max_outers</span></a><span class='Parentheses'>))</span> 
                    <a href="indxpath.c.html#LN384"><span class='Ref_To_Local'>this_path_set</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN384"><span class='Ref_To_Local'>this_path_set</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN396"><span class='Ref_To_Local'>path</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Add in restriction bitmap paths, since they can be used 
             * together with any join paths. 
             */ 
</span>            <a href="indxpath.c.html#LN384"><span class='Ref_To_Local'>this_path_set</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN384"><span class='Ref_To_Local'>this_path_set</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN234"><span class='Ref_To_Local'>bitindexpaths</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Select best AND combination for this parameterization */ 
</span>            <a href="indxpath.c.html#LN385"><span class='Ref_To_Local'>bitmapqual</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN120"><span class='Ref_to_Proto'>choose_bitmap_and</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN231"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN231"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN384"><span class='Ref_To_Local'>this_path_set</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* And push that path into the mix */ 
</span>            <a href="indxpath.c.html#LN386"><span class='Ref_To_Local'>required_outer</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN129"><span class='Ref_to_Proto'>get_bitmap_tree_required_outer</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN385"><span class='Ref_To_Local'>bitmapqual</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="indxpath.c.html#LN387"><span class='Ref_To_Local'>loop_count</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN133"><span class='Ref_to_Proto'>get_loop_count</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN231"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN231"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN552"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN386"><span class='Ref_To_Local'>required_outer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="indxpath.c.html#LN388"><span class='Ref_To_Local'>bpath</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/pathnode.h.html#LN51"><span class='Ref_to_Proto'>create_bitmap_heap_path</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN231"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN231"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN385"><span class='Ref_To_Local'>bitmapqual</span></a><span class='Delimiter'>, 
</span>                                            <a href="indxpath.c.html#LN386"><span class='Ref_To_Local'>required_outer</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN387"><span class='Ref_To_Local'>loop_count</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/optimizer/pathnode.h.html#LN27"><span class='Ref_to_Proto'>add_path</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN231"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN388"><span class='Ref_To_Local'>bpath</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if bitjoinpaths!=NIL &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end create_index_paths &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * consider_index_join_clauses 
 *    Given sets of join clauses for an index, decide which parameterized 
 *    index paths to build. 
 * 
 * Plain indexpaths are sent directly to add_path, while potential 
 * bitmap indexpaths are added to *bitindexpaths for later processing. 
 * 
 * 'rel' is the index's heap relation 
 * 'index' is the index for which we want to generate paths 
 * 'rclauseset' is the collection of indexable restriction clauses 
 * 'jclauseset' is the collection of indexable simple join clauses 
 * 'eclauseset' is the collection of indexable clauses from EquivalenceClasses 
 * '*bitindexpaths' is the list to add bitmap paths to 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN438"></a><span class='Declare_Function'>consider_index_join_clauses</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN439"></a>                            <a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>index</span><span class='Delimiter'>, 
</span><a name="LN440"></a>                            <a href="indxpath.c.html#LN57"><span class='Ref_to_Typedef'>IndexClauseSet</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rclauseset</span><span class='Delimiter'>, 
</span><a name="LN441"></a>                            <a href="indxpath.c.html#LN57"><span class='Ref_to_Typedef'>IndexClauseSet</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jclauseset</span><span class='Delimiter'>, 
</span><a name="LN442"></a>                            <a href="indxpath.c.html#LN57"><span class='Ref_to_Typedef'>IndexClauseSet</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>eclauseset</span><span class='Delimiter'>, 
</span><a name="LN443"></a>                            <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>bitindexpaths</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN445"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>considered_clauses</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN446"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>considered_relids</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN447"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>indexcol</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The strategy here is to identify every potentially useful set of outer 
     * rels that can provide indexable join clauses.  For each such set, 
     * select all the join clauses available from those outer rels, add on all 
     * the indexable restriction clauses, and generate plain and/or bitmap 
     * index paths for that set of clauses.  This is based on the assumption 
     * that it's always better to apply a clause as an indexqual than as a 
     * filter (qpqual); which is where an available clause would end up being 
     * applied if we omit it from the indexquals. 
     * 
     * This looks expensive, but in most practical cases there won't be very 
     * many distinct sets of outer rels to consider.  As a safety valve when 
     * that's not true, we use a heuristic: limit the number of outer rel sets 
     * considered to a multiple of the number of clauses considered.  (We'll 
     * always consider using each individual join clause, though.) 
     * 
     * For simplicity in selecting relevant clauses, we represent each set of 
     * outer rels as a maximum set of clause_relids --- that is, the indexed 
     * relation itself is also included in the relids set.  considered_relids 
     * lists all relids sets we've already tried. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN447"><span class='Ref_To_Local'>indexcol</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="indxpath.c.html#LN447"><span class='Ref_To_Local'>indexcol</span></a> <span class='Operator'>&LT; </span><a href="indxpath.c.html#LN439"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN640"><span class='Ref_to_Member'>ncolumns</span></a><span class='Delimiter'>; </span><a href="indxpath.c.html#LN447"><span class='Ref_To_Local'>indexcol</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Consider each applicable simple join clause */ 
</span>        <a href="indxpath.c.html#LN445"><span class='Ref_To_Local'>considered_clauses</span></a> <span class='Operator'>+= </span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN441"><span class='Ref_to_Parameter'>jclauseset</span></a><span class='Operator'>-&GT;</span><a href="indxpath.c.html#LN61"><span class='Ref_to_Member'>indexclauses</span></a><span class='Delimiter'>[</span><a href="indxpath.c.html#LN447"><span class='Ref_To_Local'>indexcol</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN87"><span class='Ref_to_Proto'>consider_index_join_outer_rels</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN438"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN438"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN439"><span class='Ref_to_Parameter'>index</span></a><span class='Delimiter'>, 
</span>                                       <a href="indxpath.c.html#LN440"><span class='Ref_to_Parameter'>rclauseset</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN441"><span class='Ref_to_Parameter'>jclauseset</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN442"><span class='Ref_to_Parameter'>eclauseset</span></a><span class='Delimiter'>, 
</span>                                       <a href="indxpath.c.html#LN443"><span class='Ref_to_Parameter'>bitindexpaths</span></a><span class='Delimiter'>, 
</span>                                       <a href="indxpath.c.html#LN441"><span class='Ref_to_Parameter'>jclauseset</span></a><span class='Operator'>-&GT;</span><a href="indxpath.c.html#LN61"><span class='Ref_to_Member'>indexclauses</span></a><span class='Delimiter'>[</span><a href="indxpath.c.html#LN447"><span class='Ref_To_Local'>indexcol</span></a><span class='Delimiter'>], 
</span>                                       <a href="indxpath.c.html#LN445"><span class='Ref_To_Local'>considered_clauses</span></a><span class='Delimiter'>, 
</span>                                       <span class='Operator'>&</span><a href="indxpath.c.html#LN446"><span class='Ref_To_Local'>considered_relids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Consider each applicable eclass join clause */ 
</span>        <a href="indxpath.c.html#LN445"><span class='Ref_To_Local'>considered_clauses</span></a> <span class='Operator'>+= </span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN442"><span class='Ref_to_Parameter'>eclauseset</span></a><span class='Operator'>-&GT;</span><a href="indxpath.c.html#LN61"><span class='Ref_to_Member'>indexclauses</span></a><span class='Delimiter'>[</span><a href="indxpath.c.html#LN447"><span class='Ref_To_Local'>indexcol</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN87"><span class='Ref_to_Proto'>consider_index_join_outer_rels</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN438"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN438"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN439"><span class='Ref_to_Parameter'>index</span></a><span class='Delimiter'>, 
</span>                                       <a href="indxpath.c.html#LN440"><span class='Ref_to_Parameter'>rclauseset</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN441"><span class='Ref_to_Parameter'>jclauseset</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN442"><span class='Ref_to_Parameter'>eclauseset</span></a><span class='Delimiter'>, 
</span>                                       <a href="indxpath.c.html#LN443"><span class='Ref_to_Parameter'>bitindexpaths</span></a><span class='Delimiter'>, 
</span>                                       <a href="indxpath.c.html#LN442"><span class='Ref_to_Parameter'>eclauseset</span></a><span class='Operator'>-&GT;</span><a href="indxpath.c.html#LN61"><span class='Ref_to_Member'>indexclauses</span></a><span class='Delimiter'>[</span><a href="indxpath.c.html#LN447"><span class='Ref_To_Local'>indexcol</span></a><span class='Delimiter'>], 
</span>                                       <a href="indxpath.c.html#LN445"><span class='Ref_To_Local'>considered_clauses</span></a><span class='Delimiter'>, 
</span>                                       <span class='Operator'>&</span><a href="indxpath.c.html#LN446"><span class='Ref_To_Local'>considered_relids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end consider_index_join_clauses &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * consider_index_join_outer_rels 
 *    Generate parameterized paths based on clause relids in the clause list. 
 * 
 * Workhorse for consider_index_join_clauses; see notes therein for rationale. 
 * 
 * 'rel', 'index', 'rclauseset', 'jclauseset', 'eclauseset', and 
 *      'bitindexpaths' as above 
 * 'indexjoinclauses' is a list of RestrictInfos for join clauses 
 * 'considered_clauses' is the total number of clauses considered (so far) 
 * '*considered_relids' is a list of all relids sets already considered 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN504"></a><span class='Declare_Function'>consider_index_join_outer_rels</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN505"></a>                               <a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>index</span><span class='Delimiter'>, 
</span><a name="LN506"></a>                               <a href="indxpath.c.html#LN57"><span class='Ref_to_Typedef'>IndexClauseSet</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rclauseset</span><span class='Delimiter'>, 
</span><a name="LN507"></a>                               <a href="indxpath.c.html#LN57"><span class='Ref_to_Typedef'>IndexClauseSet</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jclauseset</span><span class='Delimiter'>, 
</span><a name="LN508"></a>                               <a href="indxpath.c.html#LN57"><span class='Ref_to_Typedef'>IndexClauseSet</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>eclauseset</span><span class='Delimiter'>, 
</span><a name="LN509"></a>                               <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>bitindexpaths</span><span class='Delimiter'>, 
</span><a name="LN510"></a>                               <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>indexjoinclauses</span><span class='Delimiter'>, 
</span><a name="LN511"></a>                               <span class='Keyword'>int </span><span class='Declare_Parameter'>considered_clauses</span><span class='Delimiter'>, 
</span><a name="LN512"></a>                               <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>considered_relids</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN514"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Examine relids of each joinclause in the given list */ 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN514"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN510"><span class='Ref_to_Parameter'>indexjoinclauses</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN519"></a>        <a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rinfo</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN514"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN520"></a>        <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a>      <span class='Declare_Local'>clause_relids</span> <span class='Operator'>= </span><a href="indxpath.c.html#LN519"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1761"><span class='Ref_to_Member'>clause_relids</span></a><span class='Delimiter'>; 
</span><a name="LN521"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc2</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* If we already tried its relids set, no need to do so again */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN106"><span class='Ref_to_Proto'>bms_equal_any</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN520"><span class='Ref_To_Local'>clause_relids</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="indxpath.c.html#LN512"><span class='Ref_to_Parameter'>considered_relids</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Generate the union of this clause's relids set with each 
         * previously-tried set.  This ensures we try this clause along with 
         * every interesting subset of previous clauses.  However, to avoid 
         * exponential growth of planning time when there are many clauses, 
         * limit the number of relid sets accepted to 10 * considered_clauses. 
         * 
         * Note: get_join_index_paths adds entries to *considered_relids, but 
         * it prepends them to the list, so that we won't visit new entries 
         * during the inner foreach loop.  No real harm would be done if we 
         * did, since the subset check would reject them; but it would waste 
         * some cycles. 
         */ 
</span>        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN521"><span class='Ref_To_Local'>lc2</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="indxpath.c.html#LN512"><span class='Ref_to_Parameter'>considered_relids</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN542"></a>            <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a>      <span class='Declare_Local'>oldrelids</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN521"><span class='Ref_To_Local'>lc2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * If either is a subset of the other, no new set is possible. 
             * This isn't a complete test for redundancy, but it's easy and 
             * cheap.  get_join_index_paths will check more carefully if we 
             * already generated the same relids set. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/bitmapset.h.html#LN74"><span class='Ref_to_Proto'>bms_subset_compare</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN520"><span class='Ref_To_Local'>clause_relids</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN542"><span class='Ref_To_Local'>oldrelids</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../../include/nodes/bitmapset.h.html#LN49"><span class='Ref_to_EnumConst'>BMS_DIFFERENT</span></a><span class='Parentheses'>)</span> 
                <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * If this clause was derived from an equivalence class, the 
             * clause list may contain other clauses derived from the same 
             * eclass.  We should not consider that combining this clause with 
             * one of those clauses generates a usefully different 
             * parameterization; so skip if any clause derived from the same 
             * eclass would already have been included when using oldrelids. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN519"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1780"><span class='Ref_to_Member'>parent_ec</span></a> <span class='Operator'>&& 
</span>                <a href="indxpath.c.html#LN104"><span class='Ref_to_Proto'>eclass_already_used</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN519"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1780"><span class='Ref_to_Member'>parent_ec</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN542"><span class='Ref_To_Local'>oldrelids</span></a><span class='Delimiter'>, 
</span>                                    <a href="indxpath.c.html#LN510"><span class='Ref_to_Parameter'>indexjoinclauses</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * If the number of relid sets considered exceeds our heuristic 
             * limit, stop considering combinations of clauses.  We'll still 
             * consider the current clause alone, though (below this loop). 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="indxpath.c.html#LN512"><span class='Ref_to_Parameter'>considered_relids</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='Number'>10</span> <span class='Operator'>* </span><a href="indxpath.c.html#LN511"><span class='Ref_to_Parameter'>considered_clauses</span></a><span class='Parentheses'>)</span> 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* OK, try the union set */ 
</span>            <a href="indxpath.c.html#LN96"><span class='Ref_to_Proto'>get_join_index_paths</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN504"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN504"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN505"><span class='Ref_to_Parameter'>index</span></a><span class='Delimiter'>, 
</span>                                 <a href="indxpath.c.html#LN506"><span class='Ref_to_Parameter'>rclauseset</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN507"><span class='Ref_to_Parameter'>jclauseset</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN508"><span class='Ref_to_Parameter'>eclauseset</span></a><span class='Delimiter'>, 
</span>                                 <a href="indxpath.c.html#LN509"><span class='Ref_to_Parameter'>bitindexpaths</span></a><span class='Delimiter'>, 
</span>                                 <a href="../../../include/nodes/bitmapset.h.html#LN70"><span class='Ref_to_Proto'>bms_union</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN520"><span class='Ref_To_Local'>clause_relids</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN542"><span class='Ref_To_Local'>oldrelids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="indxpath.c.html#LN512"><span class='Ref_to_Parameter'>considered_relids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Also try this set of relids by itself */ 
</span>        <a href="indxpath.c.html#LN96"><span class='Ref_to_Proto'>get_join_index_paths</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN504"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN504"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN505"><span class='Ref_to_Parameter'>index</span></a><span class='Delimiter'>, 
</span>                             <a href="indxpath.c.html#LN506"><span class='Ref_to_Parameter'>rclauseset</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN507"><span class='Ref_to_Parameter'>jclauseset</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN508"><span class='Ref_to_Parameter'>eclauseset</span></a><span class='Delimiter'>, 
</span>                             <a href="indxpath.c.html#LN509"><span class='Ref_to_Parameter'>bitindexpaths</span></a><span class='Delimiter'>, 
</span>                             <a href="indxpath.c.html#LN520"><span class='Ref_To_Local'>clause_relids</span></a><span class='Delimiter'>, 
</span>                             <a href="indxpath.c.html#LN512"><span class='Ref_to_Parameter'>considered_relids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end consider_index_join_outer_rels &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * get_join_index_paths 
 *    Generate index paths using clauses from the specified outer relations. 
 *    In addition to generating paths, relids is added to *considered_relids 
 *    if not already present. 
 * 
 * Workhorse for consider_index_join_clauses; see notes therein for rationale. 
 * 
 * 'rel', 'index', 'rclauseset', 'jclauseset', 'eclauseset', 
 *      'bitindexpaths', 'considered_relids' as above 
 * 'relids' is the current set of relids to consider (the target rel plus 
 *      one or more outer rels) 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN605"></a><span class='Declare_Function'>get_join_index_paths</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN606"></a>                     <a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>index</span><span class='Delimiter'>, 
</span><a name="LN607"></a>                     <a href="indxpath.c.html#LN57"><span class='Ref_to_Typedef'>IndexClauseSet</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rclauseset</span><span class='Delimiter'>, 
</span><a name="LN608"></a>                     <a href="indxpath.c.html#LN57"><span class='Ref_to_Typedef'>IndexClauseSet</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jclauseset</span><span class='Delimiter'>, 
</span><a name="LN609"></a>                     <a href="indxpath.c.html#LN57"><span class='Ref_to_Typedef'>IndexClauseSet</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>eclauseset</span><span class='Delimiter'>, 
</span><a name="LN610"></a>                     <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>bitindexpaths</span><span class='Delimiter'>, 
</span><a name="LN611"></a>                     <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>relids</span><span class='Delimiter'>, 
</span><a name="LN612"></a>                     <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>considered_relids</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN614"></a>    <a href="indxpath.c.html#LN57"><span class='Ref_to_Typedef'>IndexClauseSet</span></a> <span class='Declare_Local'>clauseset</span><span class='Delimiter'>; 
</span><a name="LN615"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>indexcol</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If we already considered this relids set, don't repeat the work */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN106"><span class='Ref_to_Proto'>bms_equal_any</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN611"><span class='Ref_to_Parameter'>relids</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="indxpath.c.html#LN612"><span class='Ref_to_Parameter'>considered_relids</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Identify indexclauses usable with this relids set */ 
</span>    <a href="../../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="indxpath.c.html#LN614"><span class='Ref_To_Local'>clauseset</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="indxpath.c.html#LN614"><span class='Ref_To_Local'>clauseset</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN615"><span class='Ref_To_Local'>indexcol</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="indxpath.c.html#LN615"><span class='Ref_To_Local'>indexcol</span></a> <span class='Operator'>&LT; </span><a href="indxpath.c.html#LN606"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN640"><span class='Ref_to_Member'>ncolumns</span></a><span class='Delimiter'>; </span><a href="indxpath.c.html#LN615"><span class='Ref_To_Local'>indexcol</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN626"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* First find applicable simple join clauses */ 
</span>        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN626"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN608"><span class='Ref_to_Parameter'>jclauseset</span></a><span class='Operator'>-&GT;</span><a href="indxpath.c.html#LN61"><span class='Ref_to_Member'>indexclauses</span></a><span class='Delimiter'>[</span><a href="indxpath.c.html#LN615"><span class='Ref_To_Local'>indexcol</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN631"></a>            <a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rinfo</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN626"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/bitmapset.h.html#LN73"><span class='Ref_to_Proto'>bms_is_subset</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN631"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1761"><span class='Ref_to_Member'>clause_relids</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN611"><span class='Ref_to_Parameter'>relids</span></a><span class='Parentheses'>))</span> 
                <a href="indxpath.c.html#LN614"><span class='Ref_To_Local'>clauseset</span></a><span class='Operator'>.</span><a href="indxpath.c.html#LN61"><span class='Ref_to_Member'>indexclauses</span></a><span class='Delimiter'>[</span><a href="indxpath.c.html#LN615"><span class='Ref_To_Local'>indexcol</span></a><span class='Delimiter'>] </span><span class='Operator'>= 
</span>                    <a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN614"><span class='Ref_To_Local'>clauseset</span></a><span class='Operator'>.</span><a href="indxpath.c.html#LN61"><span class='Ref_to_Member'>indexclauses</span></a><span class='Delimiter'>[</span><a href="indxpath.c.html#LN615"><span class='Ref_To_Local'>indexcol</span></a><span class='Delimiter'>], </span><a href="indxpath.c.html#LN631"><span class='Ref_To_Local'>rinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Add applicable eclass join clauses.  The clauses generated for each 
         * column are redundant (cf generate_implied_equalities_for_column), 
         * so we need at most one.  This is the only exception to the general 
         * rule of using all available index clauses. 
         */ 
</span>        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN626"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN609"><span class='Ref_to_Parameter'>eclauseset</span></a><span class='Operator'>-&GT;</span><a href="indxpath.c.html#LN61"><span class='Ref_to_Member'>indexclauses</span></a><span class='Delimiter'>[</span><a href="indxpath.c.html#LN615"><span class='Ref_To_Local'>indexcol</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN646"></a>            <a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rinfo</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN626"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/bitmapset.h.html#LN73"><span class='Ref_to_Proto'>bms_is_subset</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN646"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1761"><span class='Ref_to_Member'>clause_relids</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN611"><span class='Ref_to_Parameter'>relids</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="indxpath.c.html#LN614"><span class='Ref_To_Local'>clauseset</span></a><span class='Operator'>.</span><a href="indxpath.c.html#LN61"><span class='Ref_to_Member'>indexclauses</span></a><span class='Delimiter'>[</span><a href="indxpath.c.html#LN615"><span class='Ref_To_Local'>indexcol</span></a><span class='Delimiter'>] </span><span class='Operator'>= 
</span>                    <a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN614"><span class='Ref_To_Local'>clauseset</span></a><span class='Operator'>.</span><a href="indxpath.c.html#LN61"><span class='Ref_to_Member'>indexclauses</span></a><span class='Delimiter'>[</span><a href="indxpath.c.html#LN615"><span class='Ref_To_Local'>indexcol</span></a><span class='Delimiter'>], </span><a href="indxpath.c.html#LN646"><span class='Ref_To_Local'>rinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Add restriction clauses (this is nondestructive to rclauseset) */ 
</span>        <a href="indxpath.c.html#LN614"><span class='Ref_To_Local'>clauseset</span></a><span class='Operator'>.</span><a href="indxpath.c.html#LN61"><span class='Ref_to_Member'>indexclauses</span></a><span class='Delimiter'>[</span><a href="indxpath.c.html#LN615"><span class='Ref_To_Local'>indexcol</span></a><span class='Delimiter'>] </span><span class='Operator'>= 
</span>            <a href="../../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN614"><span class='Ref_To_Local'>clauseset</span></a><span class='Operator'>.</span><a href="indxpath.c.html#LN61"><span class='Ref_to_Member'>indexclauses</span></a><span class='Delimiter'>[</span><a href="indxpath.c.html#LN615"><span class='Ref_To_Local'>indexcol</span></a><span class='Delimiter'>], 
</span>                        <a href="indxpath.c.html#LN607"><span class='Ref_to_Parameter'>rclauseset</span></a><span class='Operator'>-&GT;</span><a href="indxpath.c.html#LN61"><span class='Ref_to_Member'>indexclauses</span></a><span class='Delimiter'>[</span><a href="indxpath.c.html#LN615"><span class='Ref_To_Local'>indexcol</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN614"><span class='Ref_To_Local'>clauseset</span></a><span class='Operator'>.</span><a href="indxpath.c.html#LN61"><span class='Ref_to_Member'>indexclauses</span></a><span class='Delimiter'>[</span><a href="indxpath.c.html#LN615"><span class='Ref_To_Local'>indexcol</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>            <a href="indxpath.c.html#LN614"><span class='Ref_To_Local'>clauseset</span></a><span class='Operator'>.</span><a href="indxpath.c.html#LN59"><span class='Ref_to_Member'>nonempty</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for indexcol=0;indexcol&LT;i... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* We should have found something, else caller passed silly relids */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="indxpath.c.html#LN614"><span class='Ref_To_Local'>clauseset</span></a><span class='Operator'>.</span><a href="indxpath.c.html#LN59"><span class='Ref_to_Member'>nonempty</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Build index path(s) using the collected set of clauses */ 
</span>    <a href="indxpath.c.html#LN107"><span class='Ref_to_Proto'>get_index_paths</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN605"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN605"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN606"><span class='Ref_to_Parameter'>index</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="indxpath.c.html#LN614"><span class='Ref_To_Local'>clauseset</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN610"><span class='Ref_to_Parameter'>bitindexpaths</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Remember we considered paths for this set of relids.  We use lcons not 
     * lappend to avoid confusing the loop in consider_index_join_outer_rels. 
     */ 
</span>    <span class='Operator'>*</span><a href="indxpath.c.html#LN612"><span class='Ref_to_Parameter'>considered_relids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN215"><span class='Ref_to_Proto'>lcons</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN611"><span class='Ref_to_Parameter'>relids</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="indxpath.c.html#LN612"><span class='Ref_to_Parameter'>considered_relids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_join_index_paths &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * eclass_already_used 
 *      True if any join clause usable with oldrelids was generated from 
 *      the specified equivalence class. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN684"></a><span class='Declare_Function'>eclass_already_used</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>parent_ec</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>oldrelids</span><span class='Delimiter'>, 
</span><a name="LN685"></a>                    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>indexjoinclauses</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN687"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN687"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN685"><span class='Ref_to_Parameter'>indexjoinclauses</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN691"></a>        <a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rinfo</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN687"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN691"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1780"><span class='Ref_to_Member'>parent_ec</span></a> <span class='Operator'>== </span><a href="indxpath.c.html#LN684"><span class='Ref_to_Parameter'>parent_ec</span></a> <span class='Operator'>&& 
</span>            <a href="../../../include/nodes/bitmapset.h.html#LN73"><span class='Ref_to_Proto'>bms_is_subset</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN691"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1761"><span class='Ref_to_Member'>clause_relids</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN684"><span class='Ref_to_Parameter'>oldrelids</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * bms_equal_any 
 *      True if relids is bms_equal to any member of relids_list 
 * 
 * Perhaps this should be in bitmapset.c someday. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN707"></a><span class='Declare_Function'>bms_equal_any</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>relids</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>relids_list</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN709"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN709"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN707"><span class='Ref_to_Parameter'>relids_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/bitmapset.h.html#LN66"><span class='Ref_to_Proto'>bms_equal</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN707"><span class='Ref_to_Parameter'>relids</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN709"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)))</span> 
            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * get_index_paths 
 *    Given an index and a set of index clauses for it, construct IndexPaths. 
 * 
 * Plain indexpaths are sent directly to add_path, while potential 
 * bitmap indexpaths are added to *bitindexpaths for later processing. 
 * 
 * This is a fairly simple frontend to build_index_paths().  Its reason for 
 * existence is mainly to handle ScalarArrayOpExpr quals properly.  If the 
 * index AM supports them natively, we should just include them in simple 
 * index paths.  If not, we should exclude them while building simple index 
 * paths, and then make a separate attempt to include them in bitmap paths. 
 * Furthermore, we should consider excluding lower-order ScalarArrayOpExpr 
 * quals so as to create ordered paths. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN736"></a><span class='Declare_Function'>get_index_paths</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN737"></a>                <a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>index</span><span class='Delimiter'>, </span><a href="indxpath.c.html#LN57"><span class='Ref_to_Typedef'>IndexClauseSet</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>clauses</span><span class='Delimiter'>, 
</span><a name="LN738"></a>                <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>bitindexpaths</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN740"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>indexpaths</span><span class='Delimiter'>; 
</span><a name="LN741"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>skip_nonnative_saop</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN742"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>skip_lower_saop</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN743"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Build simple index paths using the clauses.  Allow ScalarArrayOpExpr 
     * clauses only if the index AM supports them natively, and skip any such 
     * clauses for index columns after the first (so that we produce ordered 
     * paths if possible). 
     */ 
</span>    <a href="indxpath.c.html#LN740"><span class='Ref_To_Local'>indexpaths</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN110"><span class='Ref_to_Proto'>build_index_paths</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN736"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN736"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, 
</span>                                   <a href="indxpath.c.html#LN737"><span class='Ref_to_Parameter'>index</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN737"><span class='Ref_to_Parameter'>clauses</span></a><span class='Delimiter'>, 
</span>                                   <a href="indxpath.c.html#LN737"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN662"><span class='Ref_to_Member'>predOK</span></a><span class='Delimiter'>, 
</span>                                   <a href="indxpath.c.html#LN53"><span class='Ref_to_EnumConst'>ST_ANYSCAN</span></a><span class='Delimiter'>, 
</span>                                   <span class='Operator'>&</span><a href="indxpath.c.html#LN741"><span class='Ref_To_Local'>skip_nonnative_saop</span></a><span class='Delimiter'>, 
</span>                                   <span class='Operator'>&</span><a href="indxpath.c.html#LN742"><span class='Ref_To_Local'>skip_lower_saop</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we skipped any lower-order ScalarArrayOpExprs on an index with an AM 
     * that supports them, then try again including those clauses.  This will 
     * produce paths with more selectivity but no ordering. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN742"><span class='Ref_To_Local'>skip_lower_saop</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="indxpath.c.html#LN740"><span class='Ref_To_Local'>indexpaths</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN740"><span class='Ref_To_Local'>indexpaths</span></a><span class='Delimiter'>, 
</span>                                 <a href="indxpath.c.html#LN110"><span class='Ref_to_Proto'>build_index_paths</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN736"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN736"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, 
</span>                                                   <a href="indxpath.c.html#LN737"><span class='Ref_to_Parameter'>index</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN737"><span class='Ref_to_Parameter'>clauses</span></a><span class='Delimiter'>, 
</span>                                                   <a href="indxpath.c.html#LN737"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN662"><span class='Ref_to_Member'>predOK</span></a><span class='Delimiter'>, 
</span>                                                   <a href="indxpath.c.html#LN53"><span class='Ref_to_EnumConst'>ST_ANYSCAN</span></a><span class='Delimiter'>, 
</span>                                                   <span class='Operator'>&</span><a href="indxpath.c.html#LN741"><span class='Ref_To_Local'>skip_nonnative_saop</span></a><span class='Delimiter'>, 
</span>                                                   <span class='Null_Value'>NULL</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Submit all the ones that can form plain IndexScan plans to add_path. (A 
     * plain IndexPath can represent either a plain IndexScan or an 
     * IndexOnlyScan, but for our purposes here that distinction does not 
     * matter.  However, some of the indexes might support only bitmap scans, 
     * and those we mustn't submit to add_path here.) 
     * 
     * Also, pick out the ones that are usable as bitmap scans.  For that, we 
     * must discard indexes that don't support bitmap scans, and we also are 
     * only interested in paths that have some selectivity; we should discard 
     * anything that was generated solely for ordering purposes. 
     */ 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN743"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN740"><span class='Ref_To_Local'>indexpaths</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN788"></a>        <a href="../../../include/nodes/relation.h.html#LN1027"><span class='Ref_to_Struct'>IndexPath</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>ipath</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1027"><span class='Ref_to_Struct'>IndexPath</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN743"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN737"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN672"><span class='Ref_to_Member'>amhasgettuple</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/optimizer/pathnode.h.html#LN27"><span class='Ref_to_Proto'>add_path</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN736"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN788"><span class='Ref_To_Local'>ipath</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN737"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN673"><span class='Ref_to_Member'>amhasgetbitmap</span></a> <span class='Operator'>&& 
</span>            <span class='Parentheses'>(</span><a href="indxpath.c.html#LN788"><span class='Ref_To_Local'>ipath</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1029"><span class='Ref_to_Member'>path</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN967"><span class='Ref_to_Member'>pathkeys</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a> <span class='Operator'>|| 
</span>             <a href="indxpath.c.html#LN788"><span class='Ref_To_Local'>ipath</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1038"><span class='Ref_to_Member'>indexselectivity</span></a> <span class='Operator'>&LT; </span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Parentheses'>))</span> 
            <span class='Operator'>*</span><a href="indxpath.c.html#LN738"><span class='Ref_to_Parameter'>bitindexpaths</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="indxpath.c.html#LN738"><span class='Ref_to_Parameter'>bitindexpaths</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN788"><span class='Ref_To_Local'>ipath</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If there were ScalarArrayOpExpr clauses that the index can't handle 
     * natively, generate bitmap scan paths relying on executor-managed 
     * ScalarArrayOpExpr. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN741"><span class='Ref_To_Local'>skip_nonnative_saop</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="indxpath.c.html#LN740"><span class='Ref_To_Local'>indexpaths</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN110"><span class='Ref_to_Proto'>build_index_paths</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN736"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN736"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, 
</span>                                       <a href="indxpath.c.html#LN737"><span class='Ref_to_Parameter'>index</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN737"><span class='Ref_to_Parameter'>clauses</span></a><span class='Delimiter'>, 
</span>                                       <span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                       <a href="indxpath.c.html#LN52"><span class='Ref_to_EnumConst'>ST_BITMAPSCAN</span></a><span class='Delimiter'>, 
</span>                                       <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                       <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="indxpath.c.html#LN738"><span class='Ref_to_Parameter'>bitindexpaths</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="indxpath.c.html#LN738"><span class='Ref_to_Parameter'>bitindexpaths</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN740"><span class='Ref_To_Local'>indexpaths</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end get_index_paths &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * build_index_paths 
 *    Given an index and a set of index clauses for it, construct zero 
 *    or more IndexPaths. It also constructs zero or more partial IndexPaths. 
 * 
 * We return a list of paths because (1) this routine checks some cases 
 * that should cause us to not generate any IndexPath, and (2) in some 
 * cases we want to consider both a forward and a backward scan, so as 
 * to obtain both sort orders.  Note that the paths are just returned 
 * to the caller and not immediately fed to add_path(). 
 * 
 * At top level, useful_predicate should be exactly the index's predOK flag 
 * (ie, true if it has a predicate that was proven from the restriction 
 * clauses).  When working on an arm of an OR clause, useful_predicate 
 * should be true if the predicate required the current OR list to be proven. 
 * Note that this routine should never be called at all if the index has an 
 * unprovable predicate. 
 * 
 * scantype indicates whether we want to create plain indexscans, bitmap 
 * indexscans, or both.  When it's ST_BITMAPSCAN, we will not consider 
 * index ordering while deciding if a Path is worth generating. 
 * 
 * If skip_nonnative_saop is non-NULL, we ignore ScalarArrayOpExpr clauses 
 * unless the index AM supports them directly, and we set *skip_nonnative_saop 
 * to TRUE if we found any such clauses (caller must initialize the variable 
 * to FALSE).  If it's NULL, we do not ignore ScalarArrayOpExpr clauses. 
 * 
 * If skip_lower_saop is non-NULL, we ignore ScalarArrayOpExpr clauses for 
 * non-first index columns, and we set *skip_lower_saop to TRUE if we found 
 * any such clauses (caller must initialize the variable to FALSE).  If it's 
 * NULL, we do not ignore non-first ScalarArrayOpExpr clauses, but they will 
 * result in considering the scan's output to be unordered. 
 * 
 * 'rel' is the index's heap relation 
 * 'index' is the index for which we want to generate paths 
 * 'clauses' is the collection of indexable clauses (RestrictInfo nodes) 
 * 'useful_predicate' indicates whether the index has a useful predicate 
 * 'scantype' indicates whether we need plain or bitmap scan support 
 * 'skip_nonnative_saop' indicates whether to accept SAOP if index AM doesn't 
 * 'skip_lower_saop' indicates whether to accept non-first-column SAOP 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN858"></a><span class='Declare_Function'>build_index_paths</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN859"></a>                  <a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>index</span><span class='Delimiter'>, </span><a href="indxpath.c.html#LN57"><span class='Ref_to_Typedef'>IndexClauseSet</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>clauses</span><span class='Delimiter'>, 
</span><a name="LN860"></a>                  <span class='Keyword'>bool </span><span class='Declare_Parameter'>useful_predicate</span><span class='Delimiter'>, 
</span><a name="LN861"></a>                  <a href="indxpath.c.html#LN49"><span class='Ref_to_Typedef'>ScanTypeControl</span></a> <span class='Declare_Parameter'>scantype</span><span class='Delimiter'>, 
</span><a name="LN862"></a>                  <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>skip_nonnative_saop</span><span class='Delimiter'>, 
</span><a name="LN863"></a>                  <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>skip_lower_saop</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN865"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN866"></a>    <a href="../../../include/nodes/relation.h.html#LN1027"><span class='Ref_to_Struct'>IndexPath</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>ipath</span><span class='Delimiter'>; 
</span><a name="LN867"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>index_clauses</span><span class='Delimiter'>; 
</span><a name="LN868"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>clause_columns</span><span class='Delimiter'>; 
</span><a name="LN869"></a>    <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a>      <span class='Declare_Local'>outer_relids</span><span class='Delimiter'>; 
</span><a name="LN870"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>loop_count</span><span class='Delimiter'>; 
</span><a name="LN871"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>orderbyclauses</span><span class='Delimiter'>; 
</span><a name="LN872"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>orderbyclausecols</span><span class='Delimiter'>; 
</span><a name="LN873"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>index_pathkeys</span><span class='Delimiter'>; 
</span><a name="LN874"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>useful_pathkeys</span><span class='Delimiter'>; 
</span><a name="LN875"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>found_lower_saop_clause</span><span class='Delimiter'>; 
</span><a name="LN876"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>pathkeys_possibly_useful</span><span class='Delimiter'>; 
</span><a name="LN877"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>index_is_ordered</span><span class='Delimiter'>; 
</span><a name="LN878"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>index_only_scan</span><span class='Delimiter'>; 
</span><a name="LN879"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>indexcol</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check that index supports the desired scan type(s) 
     */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN861"><span class='Ref_to_Parameter'>scantype</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="indxpath.c.html#LN51"><span class='Ref_to_EnumConst'>ST_INDEXSCAN</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="indxpath.c.html#LN859"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN672"><span class='Ref_to_Member'>amhasgettuple</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="indxpath.c.html#LN52"><span class='Ref_to_EnumConst'>ST_BITMAPSCAN</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="indxpath.c.html#LN859"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN673"><span class='Ref_to_Member'>amhasgetbitmap</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="indxpath.c.html#LN53"><span class='Ref_to_EnumConst'>ST_ANYSCAN</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* either or both are OK */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * 1. Collect the index clauses into a single list. 
     * 
     * We build a list of RestrictInfo nodes for clauses to be used with this 
     * index, along with an integer list of the index column numbers (zero 
     * based) that each clause should be used with.  The clauses are ordered 
     * by index key, so that the column numbers form a nondecreasing sequence. 
     * (This order is depended on by btree and possibly other places.)  The 
     * lists can be empty, if the index AM allows that. 
     * 
     * found_lower_saop_clause is set true if we accept a ScalarArrayOpExpr 
     * index clause for a non-first index column.  This prevents us from 
     * assuming that the scan result is ordered.  (Actually, the result is 
     * still ordered if there are equality constraints for all earlier 
     * columns, but it seems too expensive and non-modular for this code to be 
     * aware of that refinement.) 
     * 
     * We also build a Relids set showing which outer rels are required by the 
     * selected clauses.  Any lateral_relids are included in that, but not 
     * otherwise accounted for. 
     */ 
</span>    <a href="indxpath.c.html#LN867"><span class='Ref_To_Local'>index_clauses</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="indxpath.c.html#LN868"><span class='Ref_To_Local'>clause_columns</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="indxpath.c.html#LN875"><span class='Ref_To_Local'>found_lower_saop_clause</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="indxpath.c.html#LN869"><span class='Ref_To_Local'>outer_relids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN65"><span class='Ref_to_Proto'>bms_copy</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN858"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN549"><span class='Ref_to_Member'>lateral_relids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN879"><span class='Ref_To_Local'>indexcol</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="indxpath.c.html#LN879"><span class='Ref_To_Local'>indexcol</span></a> <span class='Operator'>&LT; </span><a href="indxpath.c.html#LN859"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN640"><span class='Ref_to_Member'>ncolumns</span></a><span class='Delimiter'>; </span><a href="indxpath.c.html#LN879"><span class='Ref_To_Local'>indexcol</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN926"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN926"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN859"><span class='Ref_to_Parameter'>clauses</span></a><span class='Operator'>-&GT;</span><a href="indxpath.c.html#LN61"><span class='Ref_to_Member'>indexclauses</span></a><span class='Delimiter'>[</span><a href="indxpath.c.html#LN879"><span class='Ref_To_Local'>indexcol</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN930"></a>            <a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rinfo</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN926"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN930"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1746"><span class='Ref_to_Member'>clause</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN534"><span class='Ref_to_Struct'>ScalarArrayOpExpr</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="indxpath.c.html#LN859"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN670"><span class='Ref_to_Member'>amsearcharray</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN862"><span class='Ref_to_Parameter'>skip_nonnative_saop</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* Ignore because not supported by index */ 
</span>                        <span class='Operator'>*</span><a href="indxpath.c.html#LN862"><span class='Ref_to_Parameter'>skip_nonnative_saop</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                        <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Comment_Multi_Line'>/* Caller had better intend this only for bitmap scan */ 
</span>                    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="indxpath.c.html#LN861"><span class='Ref_to_Parameter'>scantype</span></a> <span class='Operator'>== </span><a href="indxpath.c.html#LN52"><span class='Ref_to_EnumConst'>ST_BITMAPSCAN</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN879"><span class='Ref_To_Local'>indexcol</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN863"><span class='Ref_to_Parameter'>skip_lower_saop</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* Caller doesn't want to lose index ordering */ 
</span>                        <span class='Operator'>*</span><a href="indxpath.c.html#LN863"><span class='Ref_to_Parameter'>skip_lower_saop</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                        <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <a href="indxpath.c.html#LN875"><span class='Ref_To_Local'>found_lower_saop_clause</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IsA(rinfo-&GT;clause,Sca... &raquo; </span> 
            <a href="indxpath.c.html#LN867"><span class='Ref_To_Local'>index_clauses</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN867"><span class='Ref_To_Local'>index_clauses</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN930"><span class='Ref_To_Local'>rinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="indxpath.c.html#LN868"><span class='Ref_To_Local'>clause_columns</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN144"><span class='Ref_to_Func'>lappend_int</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN868"><span class='Ref_To_Local'>clause_columns</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN879"><span class='Ref_To_Local'>indexcol</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="indxpath.c.html#LN869"><span class='Ref_To_Local'>outer_relids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN91"><span class='Ref_to_Proto'>bms_add_members</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN869"><span class='Ref_To_Local'>outer_relids</span></a><span class='Delimiter'>, 
</span>                                           <a href="indxpath.c.html#LN930"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1761"><span class='Ref_to_Member'>clause_relids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If no clauses match the first index column, check for amoptionalkey 
         * restriction.  We can't generate a scan over an index with 
         * amoptionalkey = false unless there's at least one index clause. 
         * (When working on columns after the first, this test cannot fail. It 
         * is always okay for columns after the first to not have any 
         * clauses.) 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN867"><span class='Ref_To_Local'>index_clauses</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a> <span class='Operator'>&& !</span><a href="indxpath.c.html#LN859"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN669"><span class='Ref_to_Member'>amoptionalkey</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for indexcol=0;indexcol&LT;i... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* We do not want the index's rel itself listed in outer_relids */ 
</span>    <a href="indxpath.c.html#LN869"><span class='Ref_To_Local'>outer_relids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN90"><span class='Ref_to_Proto'>bms_del_member</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN869"><span class='Ref_To_Local'>outer_relids</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN858"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN552"><span class='Ref_to_Member'>relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Enforce convention that outer_relids is exactly NULL if empty */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/bitmapset.h.html#LN85"><span class='Ref_to_Proto'>bms_is_empty</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN869"><span class='Ref_To_Local'>outer_relids</span></a><span class='Parentheses'>))</span> 
        <a href="indxpath.c.html#LN869"><span class='Ref_To_Local'>outer_relids</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Compute loop_count for cost estimation purposes */ 
</span>    <a href="indxpath.c.html#LN870"><span class='Ref_To_Local'>loop_count</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN133"><span class='Ref_to_Proto'>get_loop_count</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN858"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN858"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN552"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN869"><span class='Ref_To_Local'>outer_relids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * 2. Compute pathkeys describing index's ordering, if any, then see how 
     * many of them are actually useful for this query.  This is not relevant 
     * if we are only trying to build bitmap indexscans, nor if we have to 
     * assume the scan is unordered. 
     */ 
</span>    <a href="indxpath.c.html#LN876"><span class='Ref_To_Local'>pathkeys_possibly_useful</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="indxpath.c.html#LN861"><span class='Ref_to_Parameter'>scantype</span></a> <span class='Operator'>!= </span><a href="indxpath.c.html#LN52"><span class='Ref_to_EnumConst'>ST_BITMAPSCAN</span></a> <span class='Operator'>&& 
</span>                                <span class='Operator'>!</span><a href="indxpath.c.html#LN875"><span class='Ref_To_Local'>found_lower_saop_clause</span></a> <span class='Operator'>&& 
</span>                                <a href="../../../include/optimizer/paths.h.html#LN225"><span class='Ref_to_Proto'>has_useful_pathkeys</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN858"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN858"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="indxpath.c.html#LN877"><span class='Ref_To_Local'>index_is_ordered</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="indxpath.c.html#LN859"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN645"><span class='Ref_to_Member'>sortopfamily</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN877"><span class='Ref_To_Local'>index_is_ordered</span></a> <span class='Operator'>&& </span><a href="indxpath.c.html#LN876"><span class='Ref_To_Local'>pathkeys_possibly_useful</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="indxpath.c.html#LN873"><span class='Ref_To_Local'>index_pathkeys</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/paths.h.html#LN193"><span class='Ref_to_Proto'>build_index_pathkeys</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN858"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN859"><span class='Ref_to_Parameter'>index</span></a><span class='Delimiter'>, 
</span>                                              <a href="../../../include/access/sdir.h.html#LN25"><span class='Ref_to_EnumConst'>ForwardScanDirection</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN874"><span class='Ref_To_Local'>useful_pathkeys</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/paths.h.html#LN222"><span class='Ref_to_Proto'>truncate_useless_pathkeys</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN858"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN858"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, 
</span>                                                    <a href="indxpath.c.html#LN873"><span class='Ref_To_Local'>index_pathkeys</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN871"><span class='Ref_To_Local'>orderbyclauses</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN872"><span class='Ref_To_Local'>orderbyclausecols</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN859"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN668"><span class='Ref_to_Member'>amcanorderbyop</span></a> <span class='Operator'>&& </span><a href="indxpath.c.html#LN876"><span class='Ref_To_Local'>pathkeys_possibly_useful</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* see if we can generate ordering operators for query_pathkeys */ 
</span>        <a href="indxpath.c.html#LN165"><span class='Ref_to_Proto'>match_pathkeys_to_index</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN859"><span class='Ref_to_Parameter'>index</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN858"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN261"><span class='Ref_to_Member'>query_pathkeys</span></a><span class='Delimiter'>, 
</span>                                <span class='Operator'>&</span><a href="indxpath.c.html#LN871"><span class='Ref_To_Local'>orderbyclauses</span></a><span class='Delimiter'>, 
</span>                                <span class='Operator'>&</span><a href="indxpath.c.html#LN872"><span class='Ref_To_Local'>orderbyclausecols</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN871"><span class='Ref_To_Local'>orderbyclauses</span></a><span class='Parentheses'>) 
</span>            <a href="indxpath.c.html#LN874"><span class='Ref_To_Local'>useful_pathkeys</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN858"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN261"><span class='Ref_to_Member'>query_pathkeys</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="indxpath.c.html#LN874"><span class='Ref_To_Local'>useful_pathkeys</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="indxpath.c.html#LN874"><span class='Ref_To_Local'>useful_pathkeys</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN871"><span class='Ref_To_Local'>orderbyclauses</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN872"><span class='Ref_To_Local'>orderbyclausecols</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * 3. Check if an index-only scan is possible.  If we're not building 
     * plain indexscans, this isn't relevant since bitmap scans don't support 
     * index data retrieval anyway. 
     */ 
</span>    <a href="indxpath.c.html#LN878"><span class='Ref_To_Local'>index_only_scan</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="indxpath.c.html#LN861"><span class='Ref_to_Parameter'>scantype</span></a> <span class='Operator'>!= </span><a href="indxpath.c.html#LN52"><span class='Ref_to_EnumConst'>ST_BITMAPSCAN</span></a> <span class='Operator'>&& 
</span>                       <a href="indxpath.c.html#LN132"><span class='Ref_to_Proto'>check_index_only</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN858"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN859"><span class='Ref_to_Parameter'>index</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * 4. Generate an indexscan path if there are relevant restriction clauses 
     * in the current clauses, OR the index ordering is potentially useful for 
     * later merging or final output ordering, OR the index has a useful 
     * predicate, OR an index-only scan is possible. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN867"><span class='Ref_To_Local'>index_clauses</span></a> <span class='Operator'>!= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a> <span class='Operator'>|| </span><a href="indxpath.c.html#LN874"><span class='Ref_To_Local'>useful_pathkeys</span></a> <span class='Operator'>!= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a> <span class='Operator'>|| </span><a href="indxpath.c.html#LN860"><span class='Ref_to_Parameter'>useful_predicate</span></a> <span class='Operator'>|| 
</span>        <a href="indxpath.c.html#LN878"><span class='Ref_To_Local'>index_only_scan</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="indxpath.c.html#LN866"><span class='Ref_To_Local'>ipath</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/pathnode.h.html#LN39"><span class='Ref_to_Proto'>create_index_path</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN858"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN859"><span class='Ref_to_Parameter'>index</span></a><span class='Delimiter'>, 
</span>                                  <a href="indxpath.c.html#LN867"><span class='Ref_To_Local'>index_clauses</span></a><span class='Delimiter'>, 
</span>                                  <a href="indxpath.c.html#LN868"><span class='Ref_To_Local'>clause_columns</span></a><span class='Delimiter'>, 
</span>                                  <a href="indxpath.c.html#LN871"><span class='Ref_To_Local'>orderbyclauses</span></a><span class='Delimiter'>, 
</span>                                  <a href="indxpath.c.html#LN872"><span class='Ref_To_Local'>orderbyclausecols</span></a><span class='Delimiter'>, 
</span>                                  <a href="indxpath.c.html#LN874"><span class='Ref_To_Local'>useful_pathkeys</span></a><span class='Delimiter'>, 
</span>                                  <a href="indxpath.c.html#LN877"><span class='Ref_To_Local'>index_is_ordered</span></a> <span class='Operator'>? 
</span>                                  <a href="../../../include/access/sdir.h.html#LN25"><span class='Ref_to_EnumConst'>ForwardScanDirection</span></a> <span class='Operator'>: 
</span>                                  <a href="../../../include/access/sdir.h.html#LN24"><span class='Ref_to_EnumConst'>NoMovementScanDirection</span></a><span class='Delimiter'>, 
</span>                                  <a href="indxpath.c.html#LN878"><span class='Ref_To_Local'>index_only_scan</span></a><span class='Delimiter'>, 
</span>                                  <a href="indxpath.c.html#LN869"><span class='Ref_To_Local'>outer_relids</span></a><span class='Delimiter'>, 
</span>                                  <a href="indxpath.c.html#LN870"><span class='Ref_To_Local'>loop_count</span></a><span class='Delimiter'>, 
</span>                                  <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN865"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN865"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN866"><span class='Ref_To_Local'>ipath</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If appropriate, consider parallel index scan.  We don't allow 
         * parallel index scan for bitmap index scans. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN859"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN674"><span class='Ref_to_Member'>amcanparallel</span></a> <span class='Operator'>&& 
</span>            <a href="indxpath.c.html#LN858"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN532"><span class='Ref_to_Member'>consider_parallel</span></a> <span class='Operator'>&& </span><a href="indxpath.c.html#LN869"><span class='Ref_To_Local'>outer_relids</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>            <a href="indxpath.c.html#LN861"><span class='Ref_to_Parameter'>scantype</span></a> <span class='Operator'>!= </span><a href="indxpath.c.html#LN52"><span class='Ref_to_EnumConst'>ST_BITMAPSCAN</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="indxpath.c.html#LN866"><span class='Ref_To_Local'>ipath</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/pathnode.h.html#LN39"><span class='Ref_to_Proto'>create_index_path</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN858"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN859"><span class='Ref_to_Parameter'>index</span></a><span class='Delimiter'>, 
</span>                                      <a href="indxpath.c.html#LN867"><span class='Ref_To_Local'>index_clauses</span></a><span class='Delimiter'>, 
</span>                                      <a href="indxpath.c.html#LN868"><span class='Ref_To_Local'>clause_columns</span></a><span class='Delimiter'>, 
</span>                                      <a href="indxpath.c.html#LN871"><span class='Ref_To_Local'>orderbyclauses</span></a><span class='Delimiter'>, 
</span>                                      <a href="indxpath.c.html#LN872"><span class='Ref_To_Local'>orderbyclausecols</span></a><span class='Delimiter'>, 
</span>                                      <a href="indxpath.c.html#LN874"><span class='Ref_To_Local'>useful_pathkeys</span></a><span class='Delimiter'>, 
</span>                                      <a href="indxpath.c.html#LN877"><span class='Ref_To_Local'>index_is_ordered</span></a> <span class='Operator'>? 
</span>                                      <a href="../../../include/access/sdir.h.html#LN25"><span class='Ref_to_EnumConst'>ForwardScanDirection</span></a> <span class='Operator'>: 
</span>                                      <a href="../../../include/access/sdir.h.html#LN24"><span class='Ref_to_EnumConst'>NoMovementScanDirection</span></a><span class='Delimiter'>, 
</span>                                      <a href="indxpath.c.html#LN878"><span class='Ref_To_Local'>index_only_scan</span></a><span class='Delimiter'>, 
</span>                                      <a href="indxpath.c.html#LN869"><span class='Ref_To_Local'>outer_relids</span></a><span class='Delimiter'>, 
</span>                                      <a href="indxpath.c.html#LN870"><span class='Ref_To_Local'>loop_count</span></a><span class='Delimiter'>, 
</span>                                      <span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * if, after costing the path, we find that it's not worth using 
             * parallel workers, just free it. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN866"><span class='Ref_To_Local'>ipath</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1029"><span class='Ref_to_Member'>path</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN959"><span class='Ref_to_Member'>parallel_workers</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="../../../include/optimizer/pathnode.h.html#LN31"><span class='Ref_to_Proto'>add_partial_path</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN858"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN866"><span class='Ref_To_Local'>ipath</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN866"><span class='Ref_To_Local'>ipath</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if index-&GT;amcanparallel&... &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if index_clauses!=NIL||u... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * 5. If the index is ordered, a backwards scan might be interesting. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN877"><span class='Ref_To_Local'>index_is_ordered</span></a> <span class='Operator'>&& </span><a href="indxpath.c.html#LN876"><span class='Ref_To_Local'>pathkeys_possibly_useful</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="indxpath.c.html#LN873"><span class='Ref_To_Local'>index_pathkeys</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/paths.h.html#LN193"><span class='Ref_to_Proto'>build_index_pathkeys</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN858"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN859"><span class='Ref_to_Parameter'>index</span></a><span class='Delimiter'>, 
</span>                                              <a href="../../../include/access/sdir.h.html#LN23"><span class='Ref_to_EnumConst'>BackwardScanDirection</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN874"><span class='Ref_To_Local'>useful_pathkeys</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/paths.h.html#LN222"><span class='Ref_to_Proto'>truncate_useless_pathkeys</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN858"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN858"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, 
</span>                                                    <a href="indxpath.c.html#LN873"><span class='Ref_To_Local'>index_pathkeys</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN874"><span class='Ref_To_Local'>useful_pathkeys</span></a> <span class='Operator'>!= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="indxpath.c.html#LN866"><span class='Ref_To_Local'>ipath</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/pathnode.h.html#LN39"><span class='Ref_to_Proto'>create_index_path</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN858"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN859"><span class='Ref_to_Parameter'>index</span></a><span class='Delimiter'>, 
</span>                                      <a href="indxpath.c.html#LN867"><span class='Ref_To_Local'>index_clauses</span></a><span class='Delimiter'>, 
</span>                                      <a href="indxpath.c.html#LN868"><span class='Ref_To_Local'>clause_columns</span></a><span class='Delimiter'>, 
</span>                                      <a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, 
</span>                                      <a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, 
</span>                                      <a href="indxpath.c.html#LN874"><span class='Ref_To_Local'>useful_pathkeys</span></a><span class='Delimiter'>, 
</span>                                      <a href="../../../include/access/sdir.h.html#LN23"><span class='Ref_to_EnumConst'>BackwardScanDirection</span></a><span class='Delimiter'>, 
</span>                                      <a href="indxpath.c.html#LN878"><span class='Ref_To_Local'>index_only_scan</span></a><span class='Delimiter'>, 
</span>                                      <a href="indxpath.c.html#LN869"><span class='Ref_To_Local'>outer_relids</span></a><span class='Delimiter'>, 
</span>                                      <a href="indxpath.c.html#LN870"><span class='Ref_To_Local'>loop_count</span></a><span class='Delimiter'>, 
</span>                                      <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="indxpath.c.html#LN865"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN865"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN866"><span class='Ref_To_Local'>ipath</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* If appropriate, consider parallel index scan */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN859"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN674"><span class='Ref_to_Member'>amcanparallel</span></a> <span class='Operator'>&& 
</span>                <a href="indxpath.c.html#LN858"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN532"><span class='Ref_to_Member'>consider_parallel</span></a> <span class='Operator'>&& </span><a href="indxpath.c.html#LN869"><span class='Ref_To_Local'>outer_relids</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>                <a href="indxpath.c.html#LN861"><span class='Ref_to_Parameter'>scantype</span></a> <span class='Operator'>!= </span><a href="indxpath.c.html#LN52"><span class='Ref_to_EnumConst'>ST_BITMAPSCAN</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="indxpath.c.html#LN866"><span class='Ref_To_Local'>ipath</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/pathnode.h.html#LN39"><span class='Ref_to_Proto'>create_index_path</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN858"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN859"><span class='Ref_to_Parameter'>index</span></a><span class='Delimiter'>, 
</span>                                          <a href="indxpath.c.html#LN867"><span class='Ref_To_Local'>index_clauses</span></a><span class='Delimiter'>, 
</span>                                          <a href="indxpath.c.html#LN868"><span class='Ref_To_Local'>clause_columns</span></a><span class='Delimiter'>, 
</span>                                          <a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, 
</span>                                          <a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, 
</span>                                          <a href="indxpath.c.html#LN874"><span class='Ref_To_Local'>useful_pathkeys</span></a><span class='Delimiter'>, 
</span>                                          <a href="../../../include/access/sdir.h.html#LN23"><span class='Ref_to_EnumConst'>BackwardScanDirection</span></a><span class='Delimiter'>, 
</span>                                          <a href="indxpath.c.html#LN878"><span class='Ref_To_Local'>index_only_scan</span></a><span class='Delimiter'>, 
</span>                                          <a href="indxpath.c.html#LN869"><span class='Ref_To_Local'>outer_relids</span></a><span class='Delimiter'>, 
</span>                                          <a href="indxpath.c.html#LN870"><span class='Ref_To_Local'>loop_count</span></a><span class='Delimiter'>, 
</span>                                          <span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * if, after costing the path, we find that it's not worth 
                 * using parallel workers, just free it. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN866"><span class='Ref_To_Local'>ipath</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1029"><span class='Ref_to_Member'>path</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN959"><span class='Ref_to_Member'>parallel_workers</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <a href="../../../include/optimizer/pathnode.h.html#LN31"><span class='Ref_to_Proto'>add_partial_path</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN858"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN866"><span class='Ref_To_Local'>ipath</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN866"><span class='Ref_To_Local'>ipath</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if index-&GT;amcanparallel&... &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if useful_pathkeys!=NIL &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if index_is_ordered&&pat... &raquo; </span> 
 
    <span class='Control'>return</span> <a href="indxpath.c.html#LN865"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end build_index_paths &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * build_paths_for_OR 
 *    Given a list of restriction clauses from one arm of an OR clause, 
 *    construct all matching IndexPaths for the relation. 
 * 
 * Here we must scan all indexes of the relation, since a bitmap OR tree 
 * can use multiple indexes. 
 * 
 * The caller actually supplies two lists of restriction clauses: some 
 * "current" ones and some "other" ones.  Both lists can be used freely 
 * to match keys of the index, but an index must use at least one of the 
 * "current" clauses to be considered usable.  The motivation for this is 
 * examples like 
 *      WHERE (x = 42) AND (... OR (y = 52 AND z = 77) OR ....) 
 * While we are considering the y/z subclause of the OR, we can use "x = 42" 
 * as one of the available index conditions; but we shouldn't match the 
 * subclause to any index on x alone, because such a Path would already have 
 * been generated at the upper level.  So we could use an index on x,y,z 
 * or an index on x,y for the OR subclause, but not an index on just x. 
 * When dealing with a partial index, a match of the index predicate to 
 * one of the "current" clauses also makes the index usable. 
 * 
 * 'rel' is the relation for which we want to generate index paths 
 * 'clauses' is the current list of clauses (RestrictInfo nodes) 
 * 'other_clauses' is the list of additional upper-level clauses 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN1168"></a><span class='Declare_Function'>build_paths_for_OR</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN1169"></a>                   <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>clauses</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>other_clauses</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1171"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN1172"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>all_clauses</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* not computed till needed */ 
</span><a name="LN1173"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1173"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1168"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN561"><span class='Ref_to_Member'>indexlist</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1177"></a>        <a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>index</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1173"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1178"></a>        <a href="indxpath.c.html#LN57"><span class='Ref_to_Typedef'>IndexClauseSet</span></a> <span class='Declare_Local'>clauseset</span><span class='Delimiter'>; 
</span><a name="LN1179"></a>        <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>indexpaths</span><span class='Delimiter'>; 
</span><a name="LN1180"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>useful_predicate</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Ignore index if it doesn't support bitmap scans */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="indxpath.c.html#LN1177"><span class='Ref_To_Local'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN673"><span class='Ref_to_Member'>amhasgetbitmap</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Ignore partial indexes that do not match the query.  If a partial 
         * index is marked predOK then we know it's OK.  Otherwise, we have to 
         * test whether the added clauses are sufficient to imply the 
         * predicate. If so, we can use the index in the current context. 
         * 
         * We set useful_predicate to true iff the predicate was proven using 
         * the current set of clauses.  This is needed to prevent matching a 
         * predOK index to an arm of an OR, which would be a legal but 
         * pointlessly inefficient plan.  (A better plan will be generated by 
         * just scanning the predOK index alone, no OR.) 
         */ 
</span>        <a href="indxpath.c.html#LN1180"><span class='Ref_To_Local'>useful_predicate</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN1177"><span class='Ref_To_Local'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN653"><span class='Ref_to_Member'>indpred</span></a> <span class='Operator'>!= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN1177"><span class='Ref_To_Local'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN662"><span class='Ref_to_Member'>predOK</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Usable, but don't set useful_predicate */ 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Form all_clauses if not done already */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN1172"><span class='Ref_To_Local'>all_clauses</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>                    <a href="indxpath.c.html#LN1172"><span class='Ref_To_Local'>all_clauses</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN268"><span class='Ref_to_Proto'>list_copy</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1169"><span class='Ref_to_Parameter'>clauses</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                              <a href="indxpath.c.html#LN1169"><span class='Ref_to_Parameter'>other_clauses</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/optimizer/predtest.h.html#LN19"><span class='Ref_to_Proto'>predicate_implied_by</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1177"><span class='Ref_To_Local'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN653"><span class='Ref_to_Member'>indpred</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1172"><span class='Ref_To_Local'>all_clauses</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>continue</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* can't use it at all */ 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/optimizer/predtest.h.html#LN19"><span class='Ref_to_Proto'>predicate_implied_by</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1177"><span class='Ref_To_Local'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN653"><span class='Ref_to_Member'>indpred</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1169"><span class='Ref_to_Parameter'>other_clauses</span></a><span class='Parentheses'>))</span> 
                    <a href="indxpath.c.html#LN1180"><span class='Ref_To_Local'>useful_predicate</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if index-&GT;indpred!=NIL &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* 
         * Identify the restriction clauses that can match the index. 
         */ 
</span>        <a href="../../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="indxpath.c.html#LN1178"><span class='Ref_To_Local'>clauseset</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1178"><span class='Ref_To_Local'>clauseset</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN149"><span class='Ref_to_Proto'>match_clauses_to_index</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1177"><span class='Ref_To_Local'>index</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1169"><span class='Ref_to_Parameter'>clauses</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="indxpath.c.html#LN1178"><span class='Ref_To_Local'>clauseset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If no matches so far, and the index predicate isn't useful, we 
         * don't want it. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="indxpath.c.html#LN1178"><span class='Ref_To_Local'>clauseset</span></a><span class='Operator'>.</span><a href="indxpath.c.html#LN59"><span class='Ref_to_Member'>nonempty</span></a> <span class='Operator'>&& !</span><a href="indxpath.c.html#LN1180"><span class='Ref_To_Local'>useful_predicate</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Add "other" restriction clauses to the clauseset. 
         */ 
</span>        <a href="indxpath.c.html#LN149"><span class='Ref_to_Proto'>match_clauses_to_index</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1177"><span class='Ref_To_Local'>index</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1169"><span class='Ref_to_Parameter'>other_clauses</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="indxpath.c.html#LN1178"><span class='Ref_To_Local'>clauseset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Construct paths if possible. 
         */ 
</span>        <a href="indxpath.c.html#LN1179"><span class='Ref_To_Local'>indexpaths</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN110"><span class='Ref_to_Proto'>build_index_paths</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1168"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1168"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, 
</span>                                       <a href="indxpath.c.html#LN1177"><span class='Ref_To_Local'>index</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="indxpath.c.html#LN1178"><span class='Ref_To_Local'>clauseset</span></a><span class='Delimiter'>, 
</span>                                       <a href="indxpath.c.html#LN1180"><span class='Ref_To_Local'>useful_predicate</span></a><span class='Delimiter'>, 
</span>                                       <a href="indxpath.c.html#LN52"><span class='Ref_to_EnumConst'>ST_BITMAPSCAN</span></a><span class='Delimiter'>, 
</span>                                       <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                       <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN1171"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1171"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1179"><span class='Ref_To_Local'>indexpaths</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="indxpath.c.html#LN1171"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end build_paths_for_OR &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * generate_bitmap_or_paths 
 *      Look through the list of clauses to find OR clauses, and generate 
 *      a BitmapOrPath for each one we can handle that way.  Return a list 
 *      of the generated BitmapOrPaths. 
 * 
 * other_clauses is a list of additional clauses that can be assumed true 
 * for the purpose of generating indexquals, but are not to be searched for 
 * ORs.  (See build_paths_for_OR() for motivation.) 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN1264"></a><span class='Declare_Function'>generate_bitmap_or_paths</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN1265"></a>                         <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>clauses</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>other_clauses</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1267"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN1268"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>all_clauses</span><span class='Delimiter'>; 
</span><a name="LN1269"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We can use both the current and other clauses as context for 
     * build_paths_for_OR; no need to remove ORs from the lists. 
     */ 
</span>    <a href="indxpath.c.html#LN1268"><span class='Ref_To_Local'>all_clauses</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN268"><span class='Ref_to_Proto'>list_copy</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1265"><span class='Ref_to_Parameter'>clauses</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1265"><span class='Ref_to_Parameter'>other_clauses</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1269"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1265"><span class='Ref_to_Parameter'>clauses</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1279"></a>        <a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rinfo</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN108"><span class='Ref_to_Macro'>lfirst_node</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1269"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1280"></a>        <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>pathlist</span><span class='Delimiter'>; 
</span><a name="LN1281"></a>        <a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>bitmapqual</span><span class='Delimiter'>; 
</span><a name="LN1282"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>j</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Ignore RestrictInfos that aren't ORs */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/optimizer/restrictinfo.h.html#LN31"><span class='Ref_to_Proto'>restriction_is_or_clause</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1279"><span class='Ref_To_Local'>rinfo</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We must be able to match at least one index to each of the arms of 
         * the OR, else we can't use it. 
         */ 
</span>        <a href="indxpath.c.html#LN1280"><span class='Ref_To_Local'>pathlist</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1282"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>, </span><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN557"><span class='Ref_to_Struct'>BoolExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN1279"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1777"><span class='Ref_to_Member'>orclause</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>args<span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><a name="LN1295"></a>            <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>orarg</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1282"><span class='Ref_To_Local'>j</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1296"></a>            <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>indlist</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* OR arguments should be ANDs or sub-RestrictInfos */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/optimizer/clauses.h.html#LN42"><span class='Ref_to_Proto'>and_clause</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1295"><span class='Ref_To_Local'>orarg</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span><a name="LN1301"></a>                <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>andargs</span> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN557"><span class='Ref_to_Struct'>BoolExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN1295"><span class='Ref_To_Local'>orarg</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>args<span class='Delimiter'>; 
</span> 
                <a href="indxpath.c.html#LN1296"><span class='Ref_To_Local'>indlist</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN116"><span class='Ref_to_Proto'>build_paths_for_OR</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1264"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1264"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, 
</span>                                             <a href="indxpath.c.html#LN1301"><span class='Ref_To_Local'>andargs</span></a><span class='Delimiter'>, 
</span>                                             <a href="indxpath.c.html#LN1268"><span class='Ref_To_Local'>all_clauses</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Recurse in case there are sub-ORs */ 
</span>                <a href="indxpath.c.html#LN1296"><span class='Ref_To_Local'>indlist</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1296"><span class='Ref_To_Local'>indlist</span></a><span class='Delimiter'>, 
</span>                                      <a href="indxpath.c.html#LN118"><span class='Ref_to_Proto'>generate_bitmap_or_paths</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1264"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1264"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, 
</span>                                                               <a href="indxpath.c.html#LN1301"><span class='Ref_To_Local'>andargs</span></a><span class='Delimiter'>, 
</span>                                                               <a href="indxpath.c.html#LN1268"><span class='Ref_To_Local'>all_clauses</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span><a name="LN1315"></a>                <a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rinfo</span> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN575"><span class='Ref_to_Macro'>castNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1295"><span class='Ref_To_Local'>orarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1316"></a>                <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>orargs</span><span class='Delimiter'>; 
</span> 
                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/optimizer/restrictinfo.h.html#LN31"><span class='Ref_to_Proto'>restriction_is_or_clause</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1315"><span class='Ref_To_Local'>rinfo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="indxpath.c.html#LN1316"><span class='Ref_To_Local'>orargs</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN138"><span class='Ref_to_Macro'>list_make1</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1315"><span class='Ref_To_Local'>rinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="indxpath.c.html#LN1296"><span class='Ref_To_Local'>indlist</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN116"><span class='Ref_to_Proto'>build_paths_for_OR</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1264"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1264"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, 
</span>                                             <a href="indxpath.c.html#LN1316"><span class='Ref_To_Local'>orargs</span></a><span class='Delimiter'>, 
</span>                                             <a href="indxpath.c.html#LN1268"><span class='Ref_To_Local'>all_clauses</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * If nothing matched this arm, we can't do anything with this OR 
             * clause. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN1296"><span class='Ref_To_Local'>indlist</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="indxpath.c.html#LN1280"><span class='Ref_To_Local'>pathlist</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * OK, pick the most promising AND combination, and add it to 
             * pathlist. 
             */ 
</span>            <a href="indxpath.c.html#LN1281"><span class='Ref_To_Local'>bitmapqual</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN120"><span class='Ref_to_Proto'>choose_bitmap_and</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1264"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1264"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1296"><span class='Ref_To_Local'>indlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="indxpath.c.html#LN1280"><span class='Ref_To_Local'>pathlist</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1280"><span class='Ref_To_Local'>pathlist</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1281"><span class='Ref_To_Local'>bitmapqual</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If we have a match for every arm, then turn them into a 
         * BitmapOrPath, and add to result list. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN1280"><span class='Ref_To_Local'>pathlist</span></a> <span class='Operator'>!= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="indxpath.c.html#LN1281"><span class='Ref_To_Local'>bitmapqual</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/optimizer/pathnode.h.html#LN60"><span class='Ref_to_Proto'>create_bitmap_or_path</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1264"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1264"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1280"><span class='Ref_To_Local'>pathlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="indxpath.c.html#LN1267"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1267"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1281"><span class='Ref_To_Local'>bitmapqual</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="indxpath.c.html#LN1267"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end generate_bitmap_or_paths &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * choose_bitmap_and 
 *      Given a nonempty list of bitmap paths, AND them into one path. 
 * 
 * This is a nontrivial decision since we can legally use any subset of the 
 * given path set.  We want to choose a good tradeoff between selectivity 
 * and cost of computing the bitmap. 
 * 
 * The result is either a single one of the inputs, or a BitmapAndPath 
 * combining multiple inputs. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>* 
</span><a name="LN1371"></a><span class='Declare_Function'>choose_bitmap_and</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>paths</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1373"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>npaths</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1371"><span class='Ref_to_Parameter'>paths</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1374"></a>    <a href="indxpath.c.html#LN65"><span class='Ref_to_Typedef'>PathClauseUsage</span></a> <span class='Operator'>**</span><span class='Declare_Local'>pathinfoarray</span><span class='Delimiter'>; 
</span><a name="LN1375"></a>    <a href="indxpath.c.html#LN65"><span class='Ref_to_Typedef'>PathClauseUsage</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pathinfo</span><span class='Delimiter'>; 
</span><a name="LN1376"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>clauselist</span><span class='Delimiter'>; 
</span><a name="LN1377"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>bestpaths</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN1378"></a>    <a href="../../../include/nodes/nodes.h.html#LN638"><span class='Ref_to_Typedef'>Cost</span></a>        <span class='Declare_Local'>bestcost</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN1379"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN1380"></a>                <span class='Declare_Local'>j</span><span class='Delimiter'>; 
</span><a name="LN1381"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1373"><span class='Ref_To_Local'>npaths</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* else caller error */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN1373"><span class='Ref_To_Local'>npaths</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1371"><span class='Ref_to_Parameter'>paths</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* easy case */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * In theory we should consider every nonempty subset of the given paths. 
     * In practice that seems like overkill, given the crude nature of the 
     * estimates, not to mention the possible effects of higher-level AND and 
     * OR clauses.  Moreover, it's completely impractical if there are a large 
     * number of paths, since the work would grow as O(2^N). 
     * 
     * As a heuristic, we first check for paths using exactly the same sets of 
     * WHERE clauses + index predicate conditions, and reject all but the 
     * cheapest-to-scan in any such group.  This primarily gets rid of indexes 
     * that include the interesting columns but also irrelevant columns.  (In 
     * situations where the DBA has gone overboard on creating variant 
     * indexes, this can make for a very large reduction in the number of 
     * paths considered further.) 
     * 
     * We then sort the surviving paths with the cheapest-to-scan first, and 
     * for each path, consider using that path alone as the basis for a bitmap 
     * scan.  Then we consider bitmap AND scans formed from that path plus 
     * each subsequent (higher-cost) path, adding on a subsequent path if it 
     * results in a reduction in the estimated total scan cost. This means we 
     * consider about O(N^2) rather than O(2^N) path combinations, which is 
     * quite tolerable, especially given than N is usually reasonably small 
     * because of the prefiltering step.  The cheapest of these is returned. 
     * 
     * We will only consider AND combinations in which no two indexes use the 
     * same WHERE clause.  This is a bit of a kluge: it's needed because 
     * costsize.c and clausesel.c aren't very smart about redundant clauses. 
     * They will usually double-count the redundant clauses, producing a 
     * too-small selectivity that makes a redundant AND step look like it 
     * reduces the total cost.  Perhaps someday that code will be smarter and 
     * we can remove this limitation.  (But note that this also defends 
     * against flat-out duplicate input paths, which can happen because 
     * match_join_clauses_to_index will find the same OR join clauses that 
     * extract_restriction_or_clauses has pulled OR restriction clauses out 
     * of.) 
     * 
     * For the same reason, we reject AND combinations in which an index 
     * predicate clause duplicates another clause.  Here we find it necessary 
     * to be even stricter: we'll reject a partial index if any of its 
     * predicate clauses are implied by the set of WHERE clauses and predicate 
     * clauses used so far.  This covers cases such as a condition "x = 42" 
     * used with a plain index, followed by a clauseless scan of a partial 
     * index "WHERE x &GT;= 40 AND x &LT; 50".  The partial index has been accepted 
     * only because "x = 42" was present, and so allowing it would partially 
     * double-count selectivity.  (We could use predicate_implied_by on 
     * regular qual clauses too, to have a more intelligent, but much more 
     * expensive, check for redundancy --- but in most cases simple equality 
     * seems to suffice.) 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Extract clause usage info and detect any paths that use exactly the 
     * same set of clauses; keep only the cheapest-to-scan of any such groups. 
     * The surviving paths are put into an array for qsort'ing. 
     */ 
</span>    <a href="indxpath.c.html#LN1374"><span class='Ref_To_Local'>pathinfoarray</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="indxpath.c.html#LN65"><span class='Ref_to_Typedef'>PathClauseUsage</span></a> <span class='Operator'>**</span><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1373"><span class='Ref_To_Local'>npaths</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="indxpath.c.html#LN65"><span class='Ref_to_Typedef'>PathClauseUsage</span></a> <span class='Operator'>*</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="indxpath.c.html#LN1376"><span class='Ref_To_Local'>clauselist</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="indxpath.c.html#LN1373"><span class='Ref_To_Local'>npaths</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1381"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1371"><span class='Ref_to_Parameter'>paths</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1448"></a>        <a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>ipath</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1381"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="indxpath.c.html#LN1375"><span class='Ref_To_Local'>pathinfo</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN127"><span class='Ref_to_Proto'>classify_index_clause_usage</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1448"><span class='Ref_To_Local'>ipath</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="indxpath.c.html#LN1376"><span class='Ref_To_Local'>clauselist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN1379"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="indxpath.c.html#LN1379"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="indxpath.c.html#LN1373"><span class='Ref_To_Local'>npaths</span></a><span class='Delimiter'>; </span><a href="indxpath.c.html#LN1379"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/bitmapset.h.html#LN66"><span class='Ref_to_Proto'>bms_equal</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1375"><span class='Ref_To_Local'>pathinfo</span></a><span class='Operator'>-&GT;</span><a href="indxpath.c.html#LN70"><span class='Ref_to_Member'>clauseids</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1374"><span class='Ref_To_Local'>pathinfoarray</span></a><span class='Delimiter'>[</span><a href="indxpath.c.html#LN1379"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="indxpath.c.html#LN70"><span class='Ref_to_Member'>clauseids</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN1379"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="indxpath.c.html#LN1373"><span class='Ref_To_Local'>npaths</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* duplicate clauseids, keep the cheaper one */ 
</span><a name="LN1459"></a>            <a href="../../../include/nodes/nodes.h.html#LN638"><span class='Ref_to_Typedef'>Cost</span></a>        <span class='Declare_Local'>ncost</span><span class='Delimiter'>; 
</span><a name="LN1460"></a>            <a href="../../../include/nodes/nodes.h.html#LN638"><span class='Ref_to_Typedef'>Cost</span></a>        <span class='Declare_Local'>ocost</span><span class='Delimiter'>; 
</span><a name="LN1461"></a>            <a href="../../../include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a> <span class='Declare_Local'>nselec</span><span class='Delimiter'>; 
</span><a name="LN1462"></a>            <a href="../../../include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a> <span class='Declare_Local'>oselec</span><span class='Delimiter'>; 
</span> 
            <a href="../../../include/optimizer/cost.h.html#LN85"><span class='Ref_to_Proto'>cost_bitmap_tree_node</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1375"><span class='Ref_To_Local'>pathinfo</span></a><span class='Operator'>-&GT;</span><a href="indxpath.c.html#LN67"><span class='Ref_to_Member'>path</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="indxpath.c.html#LN1459"><span class='Ref_To_Local'>ncost</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="indxpath.c.html#LN1461"><span class='Ref_To_Local'>nselec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/optimizer/cost.h.html#LN85"><span class='Ref_to_Proto'>cost_bitmap_tree_node</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1374"><span class='Ref_To_Local'>pathinfoarray</span></a><span class='Delimiter'>[</span><a href="indxpath.c.html#LN1379"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="indxpath.c.html#LN67"><span class='Ref_to_Member'>path</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="indxpath.c.html#LN1460"><span class='Ref_To_Local'>ocost</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="indxpath.c.html#LN1462"><span class='Ref_To_Local'>oselec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN1459"><span class='Ref_To_Local'>ncost</span></a> <span class='Operator'>&LT; </span><a href="indxpath.c.html#LN1460"><span class='Ref_To_Local'>ocost</span></a><span class='Parentheses'>) 
</span>                <a href="indxpath.c.html#LN1374"><span class='Ref_To_Local'>pathinfoarray</span></a><span class='Delimiter'>[</span><a href="indxpath.c.html#LN1379"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="indxpath.c.html#LN1375"><span class='Ref_To_Local'>pathinfo</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* not duplicate clauseids, add to array */ 
</span>            <a href="indxpath.c.html#LN1374"><span class='Ref_To_Local'>pathinfoarray</span></a><span class='Delimiter'>[</span><a href="indxpath.c.html#LN1373"><span class='Ref_To_Local'>npaths</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="indxpath.c.html#LN1375"><span class='Ref_To_Local'>pathinfo</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* If only one surviving path, we're done */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN1373"><span class='Ref_To_Local'>npaths</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="indxpath.c.html#LN1374"><span class='Ref_To_Local'>pathinfoarray</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="indxpath.c.html#LN67"><span class='Ref_to_Member'>path</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Sort the surviving paths by index access cost */ 
</span>    <a href="../../../include/port.h.html#LN439"><span class='Ref_to_Macro'>qsort</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1374"><span class='Ref_To_Local'>pathinfoarray</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1373"><span class='Ref_To_Local'>npaths</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="indxpath.c.html#LN65"><span class='Ref_to_Typedef'>PathClauseUsage</span></a> <span class='Operator'>*</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>          <a href="indxpath.c.html#LN122"><span class='Ref_to_Proto'>path_usage_comparator</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * For each surviving index, consider it as an "AND group leader", and see 
     * whether adding on any of the later indexes results in an AND path with 
     * cheaper total cost than before.  Then take the cheapest AND group. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN1379"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="indxpath.c.html#LN1379"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="indxpath.c.html#LN1373"><span class='Ref_To_Local'>npaths</span></a><span class='Delimiter'>; </span><a href="indxpath.c.html#LN1379"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1491"></a>        <a href="../../../include/nodes/nodes.h.html#LN638"><span class='Ref_to_Typedef'>Cost</span></a>        <span class='Declare_Local'>costsofar</span><span class='Delimiter'>; 
</span><a name="LN1492"></a>        <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>qualsofar</span><span class='Delimiter'>; 
</span><a name="LN1493"></a>        <a href="../../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>clauseidsofar</span><span class='Delimiter'>; 
</span><a name="LN1494"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lastcell</span><span class='Delimiter'>; 
</span> 
        <a href="indxpath.c.html#LN1375"><span class='Ref_To_Local'>pathinfo</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN1374"><span class='Ref_To_Local'>pathinfoarray</span></a><span class='Delimiter'>[</span><a href="indxpath.c.html#LN1379"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>        <a href="indxpath.c.html#LN1371"><span class='Ref_to_Parameter'>paths</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN138"><span class='Ref_to_Macro'>list_make1</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1375"><span class='Ref_To_Local'>pathinfo</span></a><span class='Operator'>-&GT;</span><a href="indxpath.c.html#LN67"><span class='Ref_to_Member'>path</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN1491"><span class='Ref_To_Local'>costsofar</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN123"><span class='Ref_to_Proto'>bitmap_scan_cost_est</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1371"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1371"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1375"><span class='Ref_To_Local'>pathinfo</span></a><span class='Operator'>-&GT;</span><a href="indxpath.c.html#LN67"><span class='Ref_to_Member'>path</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN1492"><span class='Ref_To_Local'>qualsofar</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN268"><span class='Ref_to_Proto'>list_copy</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1375"><span class='Ref_To_Local'>pathinfo</span></a><span class='Operator'>-&GT;</span><a href="indxpath.c.html#LN68"><span class='Ref_to_Member'>quals</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="../../../include/nodes/pg_list.h.html#LN268"><span class='Ref_to_Proto'>list_copy</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1375"><span class='Ref_To_Local'>pathinfo</span></a><span class='Operator'>-&GT;</span><a href="indxpath.c.html#LN69"><span class='Ref_to_Member'>preds</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN1493"><span class='Ref_To_Local'>clauseidsofar</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN65"><span class='Ref_to_Proto'>bms_copy</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1375"><span class='Ref_To_Local'>pathinfo</span></a><span class='Operator'>-&GT;</span><a href="indxpath.c.html#LN70"><span class='Ref_to_Member'>clauseids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN1494"><span class='Ref_To_Local'>lastcell</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN75"><span class='Ref_to_Func'>list_head</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1371"><span class='Ref_to_Parameter'>paths</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* for quick deletions */ 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN1380"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN1379"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="indxpath.c.html#LN1380"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>&LT; </span><a href="indxpath.c.html#LN1373"><span class='Ref_To_Local'>npaths</span></a><span class='Delimiter'>; </span><a href="indxpath.c.html#LN1380"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1506"></a>            <a href="../../../include/nodes/nodes.h.html#LN638"><span class='Ref_to_Typedef'>Cost</span></a>        <span class='Declare_Local'>newcost</span><span class='Delimiter'>; 
</span> 
            <a href="indxpath.c.html#LN1375"><span class='Ref_To_Local'>pathinfo</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN1374"><span class='Ref_To_Local'>pathinfoarray</span></a><span class='Delimiter'>[</span><a href="indxpath.c.html#LN1380"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]; 
</span>            <span class='Comment_Multi_Line'>/* Check for redundancy */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/bitmapset.h.html#LN76"><span class='Ref_to_Proto'>bms_overlap</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1375"><span class='Ref_To_Local'>pathinfo</span></a><span class='Operator'>-&GT;</span><a href="indxpath.c.html#LN70"><span class='Ref_to_Member'>clauseids</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1493"><span class='Ref_To_Local'>clauseidsofar</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>continue</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* consider it redundant */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN1375"><span class='Ref_To_Local'>pathinfo</span></a><span class='Operator'>-&GT;</span><a href="indxpath.c.html#LN69"><span class='Ref_to_Member'>preds</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1514"></a>                <span class='Keyword'>bool</span>        <span class='Declare_Local'>redundant</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* we check each predicate clause separately */ 
</span>                <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1381"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1375"><span class='Ref_To_Local'>pathinfo</span></a><span class='Operator'>-&GT;</span><a href="indxpath.c.html#LN69"><span class='Ref_to_Member'>preds</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN1519"></a>                    <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>np</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1381"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/optimizer/predtest.h.html#LN19"><span class='Ref_to_Proto'>predicate_implied_by</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN138"><span class='Ref_to_Macro'>list_make1</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1519"><span class='Ref_To_Local'>np</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1492"><span class='Ref_To_Local'>qualsofar</span></a><span class='Parentheses'>))</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="indxpath.c.html#LN1514"><span class='Ref_To_Local'>redundant</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* out of inner foreach loop */ 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN1514"><span class='Ref_To_Local'>redundant</span></a><span class='Parentheses'>) 
</span>                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Comment_Multi_Line'>/* tentatively add new path to paths, so we can estimate cost */ 
</span>            <a href="indxpath.c.html#LN1371"><span class='Ref_to_Parameter'>paths</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1371"><span class='Ref_to_Parameter'>paths</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1375"><span class='Ref_To_Local'>pathinfo</span></a><span class='Operator'>-&GT;</span><a href="indxpath.c.html#LN67"><span class='Ref_to_Member'>path</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="indxpath.c.html#LN1506"><span class='Ref_To_Local'>newcost</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN125"><span class='Ref_to_Proto'>bitmap_and_cost_est</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1371"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1371"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1371"><span class='Ref_to_Parameter'>paths</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN1506"><span class='Ref_To_Local'>newcost</span></a> <span class='Operator'>&LT; </span><a href="indxpath.c.html#LN1491"><span class='Ref_To_Local'>costsofar</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* keep new path in paths, update subsidiary variables */ 
</span>                <a href="indxpath.c.html#LN1491"><span class='Ref_To_Local'>costsofar</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN1506"><span class='Ref_To_Local'>newcost</span></a><span class='Delimiter'>; 
</span>                <a href="indxpath.c.html#LN1492"><span class='Ref_To_Local'>qualsofar</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1492"><span class='Ref_To_Local'>qualsofar</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../../include/nodes/pg_list.h.html#LN268"><span class='Ref_to_Proto'>list_copy</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1375"><span class='Ref_To_Local'>pathinfo</span></a><span class='Operator'>-&GT;</span><a href="indxpath.c.html#LN68"><span class='Ref_to_Member'>quals</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="indxpath.c.html#LN1492"><span class='Ref_To_Local'>qualsofar</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1492"><span class='Ref_To_Local'>qualsofar</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../../include/nodes/pg_list.h.html#LN268"><span class='Ref_to_Proto'>list_copy</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1375"><span class='Ref_To_Local'>pathinfo</span></a><span class='Operator'>-&GT;</span><a href="indxpath.c.html#LN69"><span class='Ref_to_Member'>preds</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="indxpath.c.html#LN1493"><span class='Ref_To_Local'>clauseidsofar</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN91"><span class='Ref_to_Proto'>bms_add_members</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1493"><span class='Ref_To_Local'>clauseidsofar</span></a><span class='Delimiter'>, 
</span>                                                <a href="indxpath.c.html#LN1375"><span class='Ref_To_Local'>pathinfo</span></a><span class='Operator'>-&GT;</span><a href="indxpath.c.html#LN70"><span class='Ref_to_Member'>clauseids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="indxpath.c.html#LN1494"><span class='Ref_To_Local'>lastcell</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1494"><span class='Ref_To_Local'>lastcell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* reject new path, remove it from paths list */ 
</span>                <a href="indxpath.c.html#LN1371"><span class='Ref_to_Parameter'>paths</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN238"><span class='Ref_to_Proto'>list_delete_cell</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1371"><span class='Ref_to_Parameter'>paths</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1494"><span class='Ref_To_Local'>lastcell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1494"><span class='Ref_To_Local'>lastcell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1494"><span class='Ref_To_Local'>lastcell</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for j=i+1;j&LT;npaths;j++ &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* Keep the cheapest AND-group (or singleton) */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN1379"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="indxpath.c.html#LN1491"><span class='Ref_To_Local'>costsofar</span></a> <span class='Operator'>&LT; </span><a href="indxpath.c.html#LN1378"><span class='Ref_To_Local'>bestcost</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="indxpath.c.html#LN1377"><span class='Ref_To_Local'>bestpaths</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN1371"><span class='Ref_to_Parameter'>paths</span></a><span class='Delimiter'>; 
</span>            <a href="indxpath.c.html#LN1378"><span class='Ref_To_Local'>bestcost</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN1491"><span class='Ref_To_Local'>costsofar</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* some easy cleanup (we don't try real hard though) */ 
</span>        <a href="../../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1492"><span class='Ref_To_Local'>qualsofar</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;npaths;i++ &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1377"><span class='Ref_To_Local'>bestpaths</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1377"><span class='Ref_To_Local'>bestpaths</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* no need for AND */ 
</span>    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/optimizer/pathnode.h.html#LN57"><span class='Ref_to_Proto'>create_bitmap_and_path</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1371"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1371"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1377"><span class='Ref_To_Local'>bestpaths</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end choose_bitmap_and &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* qsort comparator to sort in increasing index access cost order */ 
</span><span class='Keyword'>static int 
</span><a name="LN1571"></a><span class='Declare_Function'>path_usage_comparator</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>b</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1573"></a>    <a href="indxpath.c.html#LN65"><span class='Ref_to_Typedef'>PathClauseUsage</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pa</span> <span class='Operator'>= *</span><span class='Parentheses'>(</span><a href="indxpath.c.html#LN65"><span class='Ref_to_Typedef'>PathClauseUsage</span></a> <span class='Operator'>*</span><span class='Keyword'>const </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN1571"><span class='Ref_to_Parameter'>a</span></a><span class='Delimiter'>; 
</span><a name="LN1574"></a>    <a href="indxpath.c.html#LN65"><span class='Ref_to_Typedef'>PathClauseUsage</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pb</span> <span class='Operator'>= *</span><span class='Parentheses'>(</span><a href="indxpath.c.html#LN65"><span class='Ref_to_Typedef'>PathClauseUsage</span></a> <span class='Operator'>*</span><span class='Keyword'>const </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN1571"><span class='Ref_to_Parameter'>b</span></a><span class='Delimiter'>; 
</span><a name="LN1575"></a>    <a href="../../../include/nodes/nodes.h.html#LN638"><span class='Ref_to_Typedef'>Cost</span></a>        <span class='Declare_Local'>acost</span><span class='Delimiter'>; 
</span><a name="LN1576"></a>    <a href="../../../include/nodes/nodes.h.html#LN638"><span class='Ref_to_Typedef'>Cost</span></a>        <span class='Declare_Local'>bcost</span><span class='Delimiter'>; 
</span><a name="LN1577"></a>    <a href="../../../include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a> <span class='Declare_Local'>aselec</span><span class='Delimiter'>; 
</span><a name="LN1578"></a>    <a href="../../../include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a> <span class='Declare_Local'>bselec</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/optimizer/cost.h.html#LN85"><span class='Ref_to_Proto'>cost_bitmap_tree_node</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1573"><span class='Ref_To_Local'>pa</span></a><span class='Operator'>-&GT;</span><a href="indxpath.c.html#LN67"><span class='Ref_to_Member'>path</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="indxpath.c.html#LN1575"><span class='Ref_To_Local'>acost</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="indxpath.c.html#LN1577"><span class='Ref_To_Local'>aselec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/optimizer/cost.h.html#LN85"><span class='Ref_to_Proto'>cost_bitmap_tree_node</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1574"><span class='Ref_To_Local'>pb</span></a><span class='Operator'>-&GT;</span><a href="indxpath.c.html#LN67"><span class='Ref_to_Member'>path</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="indxpath.c.html#LN1576"><span class='Ref_To_Local'>bcost</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="indxpath.c.html#LN1578"><span class='Ref_To_Local'>bselec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If costs are the same, sort by selectivity. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN1575"><span class='Ref_To_Local'>acost</span></a> <span class='Operator'>&LT; </span><a href="indxpath.c.html#LN1576"><span class='Ref_To_Local'>bcost</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN1575"><span class='Ref_To_Local'>acost</span></a> <span class='Operator'>&GT; </span><a href="indxpath.c.html#LN1576"><span class='Ref_To_Local'>bcost</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN1577"><span class='Ref_To_Local'>aselec</span></a> <span class='Operator'>&LT; </span><a href="indxpath.c.html#LN1578"><span class='Ref_To_Local'>bselec</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN1577"><span class='Ref_To_Local'>aselec</span></a> <span class='Operator'>&GT; </span><a href="indxpath.c.html#LN1578"><span class='Ref_To_Local'>bselec</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end path_usage_comparator &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Estimate the cost of actually executing a bitmap scan with a single 
 * index path (no BitmapAnd, at least not at this level; but it could be 
 * a BitmapOr). 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN638"><span class='Ref_to_Typedef'>Cost</span></a> 
<a name="LN1605"></a><span class='Declare_Function'>bitmap_scan_cost_est</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ipath</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1607"></a>    <a href="../../../include/nodes/relation.h.html#LN1058"><span class='Ref_to_Struct'>BitmapHeapPath</span></a> <span class='Declare_Local'>bpath</span><span class='Delimiter'>; 
</span><a name="LN1608"></a>    <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a>      <span class='Declare_Local'>required_outer</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Identify required outer rels, in case it's a parameterized scan */ 
</span>    <a href="indxpath.c.html#LN1608"><span class='Ref_To_Local'>required_outer</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN129"><span class='Ref_to_Proto'>get_bitmap_tree_required_outer</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1605"><span class='Ref_to_Parameter'>ipath</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Set up a dummy BitmapHeapPath */ 
</span>    <a href="indxpath.c.html#LN1607"><span class='Ref_To_Local'>bpath</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN1060"><span class='Ref_to_Member'>path</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN948"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN222"><span class='Ref_to_EnumConst'>T_BitmapHeapPath</span></a><span class='Delimiter'>; 
</span>    <a href="indxpath.c.html#LN1607"><span class='Ref_To_Local'>bpath</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN1060"><span class='Ref_to_Member'>path</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN950"><span class='Ref_to_Member'>pathtype</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN58"><span class='Ref_to_EnumConst'>T_BitmapHeapScan</span></a><span class='Delimiter'>; 
</span>    <a href="indxpath.c.html#LN1607"><span class='Ref_To_Local'>bpath</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN1060"><span class='Ref_to_Member'>path</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN952"><span class='Ref_to_Member'>parent</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN1605"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>; 
</span>    <a href="indxpath.c.html#LN1607"><span class='Ref_To_Local'>bpath</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN1060"><span class='Ref_to_Member'>path</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN953"><span class='Ref_to_Member'>pathtarget</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN1605"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN535"><span class='Ref_to_Member'>reltarget</span></a><span class='Delimiter'>; 
</span>    <a href="indxpath.c.html#LN1607"><span class='Ref_To_Local'>bpath</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN1060"><span class='Ref_to_Member'>path</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN955"><span class='Ref_to_Member'>param_info</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/pathnode.h.html#LN275"><span class='Ref_to_Proto'>get_baserel_parampathinfo</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1605"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1605"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, 
</span>                                                      <a href="indxpath.c.html#LN1608"><span class='Ref_To_Local'>required_outer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="indxpath.c.html#LN1607"><span class='Ref_To_Local'>bpath</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN1060"><span class='Ref_to_Member'>path</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN967"><span class='Ref_to_Member'>pathkeys</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="indxpath.c.html#LN1607"><span class='Ref_To_Local'>bpath</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN1061"><span class='Ref_to_Member'>bitmapqual</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN1605"><span class='Ref_to_Parameter'>ipath</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check the cost of temporary path without considering parallelism. 
     * Parallel bitmap heap path will be considered at later stage. 
     */ 
</span>    <a href="indxpath.c.html#LN1607"><span class='Ref_To_Local'>bpath</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN1060"><span class='Ref_to_Member'>path</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN959"><span class='Ref_to_Member'>parallel_workers</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="../../../include/optimizer/cost.h.html#LN80"><span class='Ref_to_Proto'>cost_bitmap_heap_scan</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="indxpath.c.html#LN1607"><span class='Ref_To_Local'>bpath</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN1060"><span class='Ref_to_Member'>path</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1605"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1605"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, 
</span>                          <a href="indxpath.c.html#LN1607"><span class='Ref_To_Local'>bpath</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN1060"><span class='Ref_to_Member'>path</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN955"><span class='Ref_to_Member'>param_info</span></a><span class='Delimiter'>, 
</span>                          <a href="indxpath.c.html#LN1605"><span class='Ref_to_Parameter'>ipath</span></a><span class='Delimiter'>, 
</span>                          <a href="indxpath.c.html#LN133"><span class='Ref_to_Proto'>get_loop_count</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1605"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1605"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN552"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1608"><span class='Ref_To_Local'>required_outer</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="indxpath.c.html#LN1607"><span class='Ref_To_Local'>bpath</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN1060"><span class='Ref_to_Member'>path</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN965"><span class='Ref_to_Member'>total_cost</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end bitmap_scan_cost_est &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Estimate the cost of actually executing a BitmapAnd scan with the given 
 * inputs. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN638"><span class='Ref_to_Typedef'>Cost</span></a> 
<a name="LN1641"></a><span class='Declare_Function'>bitmap_and_cost_est</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>paths</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1643"></a>    <a href="../../../include/nodes/relation.h.html#LN1070"><span class='Ref_to_Struct'>BitmapAndPath</span></a> <span class='Declare_Local'>apath</span><span class='Delimiter'>; 
</span><a name="LN1644"></a>    <a href="../../../include/nodes/relation.h.html#LN1058"><span class='Ref_to_Struct'>BitmapHeapPath</span></a> <span class='Declare_Local'>bpath</span><span class='Delimiter'>; 
</span><a name="LN1645"></a>    <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a>      <span class='Declare_Local'>required_outer</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Set up a dummy BitmapAndPath */ 
</span>    <a href="indxpath.c.html#LN1643"><span class='Ref_To_Local'>apath</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN1072"><span class='Ref_to_Member'>path</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN948"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN223"><span class='Ref_to_EnumConst'>T_BitmapAndPath</span></a><span class='Delimiter'>; 
</span>    <a href="indxpath.c.html#LN1643"><span class='Ref_To_Local'>apath</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN1072"><span class='Ref_to_Member'>path</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN950"><span class='Ref_to_Member'>pathtype</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN50"><span class='Ref_to_EnumConst'>T_BitmapAnd</span></a><span class='Delimiter'>; 
</span>    <a href="indxpath.c.html#LN1643"><span class='Ref_To_Local'>apath</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN1072"><span class='Ref_to_Member'>path</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN952"><span class='Ref_to_Member'>parent</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN1641"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>; 
</span>    <a href="indxpath.c.html#LN1643"><span class='Ref_To_Local'>apath</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN1072"><span class='Ref_to_Member'>path</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN953"><span class='Ref_to_Member'>pathtarget</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN1641"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN535"><span class='Ref_to_Member'>reltarget</span></a><span class='Delimiter'>; 
</span>    <a href="indxpath.c.html#LN1643"><span class='Ref_To_Local'>apath</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN1072"><span class='Ref_to_Member'>path</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN955"><span class='Ref_to_Member'>param_info</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* not used in bitmap trees */ 
</span>    <a href="indxpath.c.html#LN1643"><span class='Ref_To_Local'>apath</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN1072"><span class='Ref_to_Member'>path</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN967"><span class='Ref_to_Member'>pathkeys</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="indxpath.c.html#LN1643"><span class='Ref_To_Local'>apath</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN1073"><span class='Ref_to_Member'>bitmapquals</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN1641"><span class='Ref_to_Parameter'>paths</span></a><span class='Delimiter'>; 
</span>    <a href="../../../include/optimizer/cost.h.html#LN83"><span class='Ref_to_Proto'>cost_bitmap_and_node</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="indxpath.c.html#LN1643"><span class='Ref_To_Local'>apath</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1641"><span class='Ref_to_Parameter'>root</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Identify required outer rels, in case it's a parameterized scan */ 
</span>    <a href="indxpath.c.html#LN1645"><span class='Ref_To_Local'>required_outer</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN129"><span class='Ref_to_Proto'>get_bitmap_tree_required_outer</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="indxpath.c.html#LN1643"><span class='Ref_To_Local'>apath</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Set up a dummy BitmapHeapPath */ 
</span>    <a href="indxpath.c.html#LN1644"><span class='Ref_To_Local'>bpath</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN1060"><span class='Ref_to_Member'>path</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN948"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN222"><span class='Ref_to_EnumConst'>T_BitmapHeapPath</span></a><span class='Delimiter'>; 
</span>    <a href="indxpath.c.html#LN1644"><span class='Ref_To_Local'>bpath</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN1060"><span class='Ref_to_Member'>path</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN950"><span class='Ref_to_Member'>pathtype</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN58"><span class='Ref_to_EnumConst'>T_BitmapHeapScan</span></a><span class='Delimiter'>; 
</span>    <a href="indxpath.c.html#LN1644"><span class='Ref_To_Local'>bpath</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN1060"><span class='Ref_to_Member'>path</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN952"><span class='Ref_to_Member'>parent</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN1641"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>; 
</span>    <a href="indxpath.c.html#LN1644"><span class='Ref_To_Local'>bpath</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN1060"><span class='Ref_to_Member'>path</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN953"><span class='Ref_to_Member'>pathtarget</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN1641"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN535"><span class='Ref_to_Member'>reltarget</span></a><span class='Delimiter'>; 
</span>    <a href="indxpath.c.html#LN1644"><span class='Ref_To_Local'>bpath</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN1060"><span class='Ref_to_Member'>path</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN955"><span class='Ref_to_Member'>param_info</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/pathnode.h.html#LN275"><span class='Ref_to_Proto'>get_baserel_parampathinfo</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1641"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1641"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, 
</span>                                                      <a href="indxpath.c.html#LN1645"><span class='Ref_To_Local'>required_outer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="indxpath.c.html#LN1644"><span class='Ref_To_Local'>bpath</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN1060"><span class='Ref_to_Member'>path</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN967"><span class='Ref_to_Member'>pathkeys</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="indxpath.c.html#LN1644"><span class='Ref_To_Local'>bpath</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN1061"><span class='Ref_to_Member'>bitmapqual</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="indxpath.c.html#LN1643"><span class='Ref_To_Local'>apath</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check the cost of temporary path without considering parallelism. 
     * Parallel bitmap heap path will be considered at later stage. 
     */ 
</span>    <a href="indxpath.c.html#LN1644"><span class='Ref_To_Local'>bpath</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN1060"><span class='Ref_to_Member'>path</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN959"><span class='Ref_to_Member'>parallel_workers</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Now we can do cost_bitmap_heap_scan */ 
</span>    <a href="../../../include/optimizer/cost.h.html#LN80"><span class='Ref_to_Proto'>cost_bitmap_heap_scan</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="indxpath.c.html#LN1644"><span class='Ref_To_Local'>bpath</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN1060"><span class='Ref_to_Member'>path</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1641"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1641"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, 
</span>                          <a href="indxpath.c.html#LN1644"><span class='Ref_To_Local'>bpath</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN1060"><span class='Ref_to_Member'>path</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN955"><span class='Ref_to_Member'>param_info</span></a><span class='Delimiter'>, 
</span>                          <span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="indxpath.c.html#LN1643"><span class='Ref_To_Local'>apath</span></a><span class='Delimiter'>, 
</span>                          <a href="indxpath.c.html#LN133"><span class='Ref_to_Proto'>get_loop_count</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1641"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1641"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN552"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1645"><span class='Ref_To_Local'>required_outer</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="indxpath.c.html#LN1644"><span class='Ref_To_Local'>bpath</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN1060"><span class='Ref_to_Member'>path</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN965"><span class='Ref_to_Member'>total_cost</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end bitmap_and_cost_est &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * classify_index_clause_usage 
 *      Construct a PathClauseUsage struct describing the WHERE clauses and 
 *      index predicate clauses used by the given indexscan path. 
 *      We consider two clauses the same if they are equal(). 
 * 
 * At some point we might want to migrate this info into the Path data 
 * structure proper, but for the moment it's only needed within 
 * choose_bitmap_and(). 
 * 
 * *clauselist is used and expanded as needed to identify all the distinct 
 * clauses seen across successive calls.  Caller must initialize it to NIL 
 * before first call of a set. 
 */ 
</span><span class='Keyword'>static </span><a href="indxpath.c.html#LN65"><span class='Ref_to_Typedef'>PathClauseUsage</span></a> <span class='Operator'>* 
</span><a name="LN1701"></a><span class='Declare_Function'>classify_index_clause_usage</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>path</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>clauselist</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1703"></a>    <a href="indxpath.c.html#LN65"><span class='Ref_to_Typedef'>PathClauseUsage</span></a> <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN1704"></a>    <a href="../../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>clauseids</span><span class='Delimiter'>; 
</span><a name="LN1705"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <a href="indxpath.c.html#LN1703"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="indxpath.c.html#LN65"><span class='Ref_to_Typedef'>PathClauseUsage</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="indxpath.c.html#LN65"><span class='Ref_to_Typedef'>PathClauseUsage</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="indxpath.c.html#LN1703"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="indxpath.c.html#LN67"><span class='Ref_to_Member'>path</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN1701"><span class='Ref_to_Parameter'>path</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Recursively find the quals and preds used by the path */ 
</span>    <a href="indxpath.c.html#LN1703"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="indxpath.c.html#LN68"><span class='Ref_to_Member'>quals</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="indxpath.c.html#LN1703"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="indxpath.c.html#LN69"><span class='Ref_to_Member'>preds</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="indxpath.c.html#LN130"><span class='Ref_to_Proto'>find_indexpath_quals</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1701"><span class='Ref_to_Parameter'>path</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="indxpath.c.html#LN1703"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="indxpath.c.html#LN68"><span class='Ref_to_Member'>quals</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="indxpath.c.html#LN1703"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="indxpath.c.html#LN69"><span class='Ref_to_Member'>preds</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Build up a bitmapset representing the quals and preds */ 
</span>    <a href="indxpath.c.html#LN1704"><span class='Ref_To_Local'>clauseids</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1705"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1703"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="indxpath.c.html#LN68"><span class='Ref_to_Member'>quals</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1719"></a>        <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>node</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1705"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="indxpath.c.html#LN1704"><span class='Ref_To_Local'>clauseids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN89"><span class='Ref_to_Proto'>bms_add_member</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1704"><span class='Ref_To_Local'>clauseids</span></a><span class='Delimiter'>, 
</span>                                   <a href="indxpath.c.html#LN131"><span class='Ref_to_Proto'>find_list_position</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1719"><span class='Ref_To_Local'>node</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1701"><span class='Ref_to_Parameter'>clauselist</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1705"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1703"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="indxpath.c.html#LN69"><span class='Ref_to_Member'>preds</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1726"></a>        <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>node</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1705"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="indxpath.c.html#LN1704"><span class='Ref_To_Local'>clauseids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN89"><span class='Ref_to_Proto'>bms_add_member</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1704"><span class='Ref_To_Local'>clauseids</span></a><span class='Delimiter'>, 
</span>                                   <a href="indxpath.c.html#LN131"><span class='Ref_to_Proto'>find_list_position</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1726"><span class='Ref_To_Local'>node</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1701"><span class='Ref_to_Parameter'>clauselist</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="indxpath.c.html#LN1703"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="indxpath.c.html#LN70"><span class='Ref_to_Member'>clauseids</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN1704"><span class='Ref_To_Local'>clauseids</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="indxpath.c.html#LN1703"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end classify_index_clause_usage &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * get_bitmap_tree_required_outer 
 *      Find the required outer rels for a bitmap tree (index/and/or) 
 * 
 * We don't associate any particular parameterization with a BitmapAnd or 
 * BitmapOr node; however, the IndexPaths have parameterization info, in 
 * their capacity as standalone access paths.  The parameterization required 
 * for the bitmap heap scan node is the union of rels referenced in the 
 * child IndexPaths. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> 
<a name="LN1748"></a><span class='Declare_Function'>get_bitmap_tree_required_outer</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>bitmapqual</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1750"></a>    <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a>      <span class='Declare_Local'>result</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1751"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1748"><span class='Ref_to_Parameter'>bitmapqual</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN1027"><span class='Ref_to_Struct'>IndexPath</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>return</span> <a href="../../../include/nodes/bitmapset.h.html#LN65"><span class='Ref_to_Proto'>bms_copy</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN972"><span class='Ref_to_Macro'>PATH_REQ_OUTER</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1748"><span class='Ref_to_Parameter'>bitmapqual</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1748"><span class='Ref_to_Parameter'>bitmapqual</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN1070"><span class='Ref_to_Struct'>BitmapAndPath</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1751"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><span class='Parentheses'>((</span><a href="../../../include/nodes/relation.h.html#LN1070"><span class='Ref_to_Struct'>BitmapAndPath</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN1748"><span class='Ref_to_Parameter'>bitmapqual</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>bitmapquals<span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="indxpath.c.html#LN1750"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN94"><span class='Ref_to_Proto'>bms_join</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1750"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                        <a href="indxpath.c.html#LN129"><span class='Ref_to_Proto'>get_bitmap_tree_required_outer</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1751"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1748"><span class='Ref_to_Parameter'>bitmapqual</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN1083"><span class='Ref_to_Struct'>BitmapOrPath</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1751"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><span class='Parentheses'>((</span><a href="../../../include/nodes/relation.h.html#LN1083"><span class='Ref_to_Struct'>BitmapOrPath</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN1748"><span class='Ref_to_Parameter'>bitmapqual</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>bitmapquals<span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="indxpath.c.html#LN1750"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN94"><span class='Ref_to_Proto'>bms_join</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1750"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                        <a href="indxpath.c.html#LN129"><span class='Ref_to_Proto'>get_bitmap_tree_required_outer</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1751"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized node type: %d"</span><span class='Delimiter'>, </span><a href="../../../include/nodes/nodes.h.html#LN513"><span class='Ref_to_Macro'>nodeTag</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1748"><span class='Ref_to_Parameter'>bitmapqual</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="indxpath.c.html#LN1750"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_bitmap_tree_required_outer &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * find_indexpath_quals 
 * 
 * Given the Path structure for a plain or bitmap indexscan, extract lists 
 * of all the indexquals and index predicate conditions used in the Path. 
 * These are appended to the initial contents of *quals and *preds (hence 
 * caller should initialize those to NIL). 
 * 
 * Note we are not trying to produce an accurate representation of the AND/OR 
 * semantics of the Path, but just find out all the base conditions used. 
 * 
 * The result lists contain pointers to the expressions used in the Path, 
 * but all the list cells are freshly built, so it's safe to destructively 
 * modify the lists (eg, by concat'ing with other lists). 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1796"></a><span class='Declare_Function'>find_indexpath_quals</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>bitmapqual</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>quals</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>preds</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1796"><span class='Ref_to_Parameter'>bitmapqual</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN1070"><span class='Ref_to_Struct'>BitmapAndPath</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1800"></a>        <a href="../../../include/nodes/relation.h.html#LN1070"><span class='Ref_to_Struct'>BitmapAndPath</span></a> <span class='Operator'>*</span><span class='Declare_Local'>apath</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1070"><span class='Ref_to_Struct'>BitmapAndPath</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN1796"><span class='Ref_to_Parameter'>bitmapqual</span></a><span class='Delimiter'>; 
</span><a name="LN1801"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1801"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1800"><span class='Ref_To_Local'>apath</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1073"><span class='Ref_to_Member'>bitmapquals</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="indxpath.c.html#LN130"><span class='Ref_to_Proto'>find_indexpath_quals</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1801"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1796"><span class='Ref_to_Parameter'>quals</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1796"><span class='Ref_to_Parameter'>preds</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1796"><span class='Ref_to_Parameter'>bitmapqual</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN1083"><span class='Ref_to_Struct'>BitmapOrPath</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1810"></a>        <a href="../../../include/nodes/relation.h.html#LN1083"><span class='Ref_to_Struct'>BitmapOrPath</span></a> <span class='Operator'>*</span><span class='Declare_Local'>opath</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1083"><span class='Ref_to_Struct'>BitmapOrPath</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN1796"><span class='Ref_to_Parameter'>bitmapqual</span></a><span class='Delimiter'>; 
</span><a name="LN1811"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1811"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1810"><span class='Ref_To_Local'>opath</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1086"><span class='Ref_to_Member'>bitmapquals</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="indxpath.c.html#LN130"><span class='Ref_to_Proto'>find_indexpath_quals</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1811"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1796"><span class='Ref_to_Parameter'>quals</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1796"><span class='Ref_to_Parameter'>preds</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1796"><span class='Ref_to_Parameter'>bitmapqual</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN1027"><span class='Ref_to_Struct'>IndexPath</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1820"></a>        <a href="../../../include/nodes/relation.h.html#LN1027"><span class='Ref_to_Struct'>IndexPath</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>ipath</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1027"><span class='Ref_to_Struct'>IndexPath</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN1796"><span class='Ref_to_Parameter'>bitmapqual</span></a><span class='Delimiter'>; 
</span> 
        <span class='Operator'>*</span><a href="indxpath.c.html#LN1796"><span class='Ref_to_Parameter'>quals</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="indxpath.c.html#LN1796"><span class='Ref_to_Parameter'>quals</span></a><span class='Delimiter'>, </span><a href="../../../include/optimizer/restrictinfo.h.html#LN34"><span class='Ref_to_Proto'>get_actual_clauses</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1820"><span class='Ref_To_Local'>ipath</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1031"><span class='Ref_to_Member'>indexclauses</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="indxpath.c.html#LN1796"><span class='Ref_to_Parameter'>preds</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="indxpath.c.html#LN1796"><span class='Ref_to_Parameter'>preds</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN268"><span class='Ref_to_Proto'>list_copy</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1820"><span class='Ref_To_Local'>ipath</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1030"><span class='Ref_to_Member'>indexinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN653"><span class='Ref_to_Member'>indpred</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized node type: %d"</span><span class='Delimiter'>, </span><a href="../../../include/nodes/nodes.h.html#LN513"><span class='Ref_to_Macro'>nodeTag</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1796"><span class='Ref_to_Parameter'>bitmapqual</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end find_indexpath_quals &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * find_list_position 
 *      Return the given node's position (counting from 0) in the given 
 *      list of nodes.  If it's not equal() to any existing list member, 
 *      add it at the end, and return that position. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1837"></a><span class='Declare_Function'>find_list_position</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>nodelist</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1839"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN1840"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <a href="indxpath.c.html#LN1839"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1840"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="indxpath.c.html#LN1837"><span class='Ref_to_Parameter'>nodelist</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1845"></a>        <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>oldnode</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1840"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN626"><span class='Ref_to_Proto'>equal</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1837"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1845"><span class='Ref_To_Local'>oldnode</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <a href="indxpath.c.html#LN1839"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN1839"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Operator'>*</span><a href="indxpath.c.html#LN1837"><span class='Ref_to_Parameter'>nodelist</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="indxpath.c.html#LN1837"><span class='Ref_to_Parameter'>nodelist</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1837"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="indxpath.c.html#LN1839"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end find_list_position &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * check_index_only 
 *      Determine whether an index-only scan is possible for this index. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1863"></a><span class='Declare_Function'>check_index_only</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>index</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1865"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN1866"></a>    <a href="../../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>attrs_used</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1867"></a>    <a href="../../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>index_canreturn_attrs</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1868"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span><a name="LN1869"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Index-only scans must be enabled */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="costsize.c.html#LN119"><span class='Ref_to_Global_Var'>enable_indexonlyscan</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check that all needed attributes of the relation are available from the 
     * index. 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * First, identify all the attributes needed for joins or final output. 
     * Note: we must look at rel's targetlist, not the attr_needed data, 
     * because attr_needed isn't computed for inheritance child rels. 
     */ 
</span>    <a href="../../../include/optimizer/var.h.html#LN31"><span class='Ref_to_Proto'>pull_varattnos</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN1863"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN535"><span class='Ref_to_Member'>reltarget</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN882"><span class='Ref_to_Member'>exprs</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1863"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN552"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="indxpath.c.html#LN1866"><span class='Ref_To_Local'>attrs_used</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Add all the attributes used by restriction clauses; but consider only 
     * those clauses not implied by the index predicate, since ones that are 
     * so implied don't need to be checked explicitly in the plan. 
     * 
     * Note: attributes used only in index quals would not be needed at 
     * runtime either, if we are certain that the index is not lossy.  However 
     * it'd be complicated to account for that accurately, and it doesn't 
     * matter in most cases, since we'd conclude that such attributes are 
     * available from the index anyway. 
     */ 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1868"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1863"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN657"><span class='Ref_to_Member'>indrestrictinfo</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1900"></a>        <a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rinfo</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1868"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/optimizer/var.h.html#LN31"><span class='Ref_to_Proto'>pull_varattnos</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN1900"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1746"><span class='Ref_to_Member'>clause</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1863"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN552"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="indxpath.c.html#LN1866"><span class='Ref_To_Local'>attrs_used</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Construct a bitmapset of columns that the index can return back in an 
     * index-only scan. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN1869"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="indxpath.c.html#LN1869"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="indxpath.c.html#LN1863"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN640"><span class='Ref_to_Member'>ncolumns</span></a><span class='Delimiter'>; </span><a href="indxpath.c.html#LN1869"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1911"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>attno</span> <span class='Operator'>= </span><a href="indxpath.c.html#LN1863"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN641"><span class='Ref_to_Member'>indexkeys</span></a><span class='Delimiter'>[</span><a href="indxpath.c.html#LN1869"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * For the moment, we just ignore index expressions.  It might be nice 
         * to do something with them, later. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN1911"><span class='Ref_To_Local'>attno</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN1863"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN648"><span class='Ref_to_Member'>canreturn</span></a><span class='Delimiter'>[</span><a href="indxpath.c.html#LN1869"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <a href="indxpath.c.html#LN1867"><span class='Ref_To_Local'>index_canreturn_attrs</span></a> <span class='Operator'>= 
</span>                <a href="../../../include/nodes/bitmapset.h.html#LN89"><span class='Ref_to_Proto'>bms_add_member</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1867"><span class='Ref_To_Local'>index_canreturn_attrs</span></a><span class='Delimiter'>, 
</span>                               <a href="indxpath.c.html#LN1911"><span class='Ref_To_Local'>attno</span></a> <span class='Operator'>- </span><a href="../../../include/access/sysattr.h.html#LN27"><span class='Ref_to_Const'>FirstLowInvalidHeapAttributeNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Do we have all the necessary attributes? */ 
</span>    <a href="indxpath.c.html#LN1865"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN73"><span class='Ref_to_Proto'>bms_is_subset</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1866"><span class='Ref_To_Local'>attrs_used</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1867"><span class='Ref_To_Local'>index_canreturn_attrs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/nodes/bitmapset.h.html#LN68"><span class='Ref_to_Proto'>bms_free</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1866"><span class='Ref_To_Local'>attrs_used</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/nodes/bitmapset.h.html#LN68"><span class='Ref_to_Proto'>bms_free</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1867"><span class='Ref_To_Local'>index_canreturn_attrs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="indxpath.c.html#LN1865"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end check_index_only &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * get_loop_count 
 *      Choose the loop count estimate to use for costing a parameterized path 
 *      with the given set of outer relids. 
 * 
 * Since we produce parameterized paths before we've begun to generate join 
 * relations, it's impossible to predict exactly how many times a parameterized 
 * path will be iterated; we don't know the size of the relation that will be 
 * on the outside of the nestloop.  However, we should try to account for 
 * multiple iterations somehow in costing the path.  The heuristic embodied 
 * here is to use the rowcount of the smallest other base relation needed in 
 * the join clauses used by the path.  (We could alternatively consider the 
 * largest one, but that seems too optimistic.)  This is of course the right 
 * answer for single-other-relation cases, and it seems like a reasonable 
 * zero-order approximation for multiway-join cases. 
 * 
 * In addition, we check to see if the other side of each join clause is on 
 * the inside of some semijoin that the current relation is on the outside of. 
 * If so, the only way that a parameterized path could be used is if the 
 * semijoin RHS has been unique-ified, so we should use the number of unique 
 * RHS rows rather than using the relation's raw rowcount. 
 * 
 * Note: for this to work, allpaths.c must establish all baserel size 
 * estimates before it begins to compute paths, or at least before it 
 * calls create_index_paths(). 
 */ 
</span><span class='Keyword'>static double 
</span><a name="LN1962"></a><span class='Declare_Function'>get_loop_count</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>cur_relid</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>outer_relids</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1964"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN1965"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>outer_relid</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* For a non-parameterized path, just return 1.0 quickly */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN1962"><span class='Ref_to_Parameter'>outer_relids</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="indxpath.c.html#LN1964"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="indxpath.c.html#LN1965"><span class='Ref_To_Local'>outer_relid</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="indxpath.c.html#LN1965"><span class='Ref_To_Local'>outer_relid</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN98"><span class='Ref_to_Proto'>bms_next_member</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1962"><span class='Ref_to_Parameter'>outer_relids</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN1965"><span class='Ref_To_Local'>outer_relid</span></a><span class='Parentheses'>))</span> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1975"></a>        <a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>outer_rel</span><span class='Delimiter'>; 
</span><a name="LN1976"></a>        <span class='Keyword'>double</span>      <span class='Declare_Local'>rowcount</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Paranoia: ignore bogus relid indexes */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN1965"><span class='Ref_To_Local'>outer_relid</span></a> <span class='Operator'>&GT;= </span><a href="indxpath.c.html#LN1962"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN179"><span class='Ref_to_Member'>simple_rel_array_size</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN1975"><span class='Ref_To_Local'>outer_rel</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN1962"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN178"><span class='Ref_to_Member'>simple_rel_array</span></a><span class='Delimiter'>[</span><a href="indxpath.c.html#LN1965"><span class='Ref_To_Local'>outer_relid</span></a><span class='Delimiter'>]; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN1975"><span class='Ref_To_Local'>outer_rel</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1975"><span class='Ref_To_Local'>outer_rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN552"><span class='Ref_to_Member'>relid</span></a> <span class='Operator'>== </span><a href="indxpath.c.html#LN1965"><span class='Ref_To_Local'>outer_relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* sanity check on array */ 
</span> 
        <span class='Comment_Multi_Line'>/* Other relation could be proven empty, if so ignore */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1186"><span class='Ref_to_Macro'>IS_DUMMY_REL</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1975"><span class='Ref_To_Local'>outer_rel</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Otherwise, rel's rows estimate should be valid by now */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1975"><span class='Ref_To_Local'>outer_rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN527"><span class='Ref_to_Member'>rows</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Check to see if rel is on the inside of any semijoins */ 
</span>        <a href="indxpath.c.html#LN1976"><span class='Ref_To_Local'>rowcount</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN134"><span class='Ref_to_Proto'>adjust_rowcount_for_semijoins</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN1962"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                                 <a href="indxpath.c.html#LN1962"><span class='Ref_to_Parameter'>cur_relid</span></a><span class='Delimiter'>, 
</span>                                                 <a href="indxpath.c.html#LN1965"><span class='Ref_To_Local'>outer_relid</span></a><span class='Delimiter'>, 
</span>                                                 <a href="indxpath.c.html#LN1975"><span class='Ref_To_Local'>outer_rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN527"><span class='Ref_to_Member'>rows</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Remember smallest row count estimate among the outer rels */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN1964"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="indxpath.c.html#LN1964"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>&GT; </span><a href="indxpath.c.html#LN1976"><span class='Ref_To_Local'>rowcount</span></a><span class='Parentheses'>) 
</span>            <a href="indxpath.c.html#LN1964"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN1976"><span class='Ref_To_Local'>rowcount</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while (outer_relid=bms_next... &raquo; </span> 
    <span class='Comment_Multi_Line'>/* Return 1.0 if we found no valid relations (shouldn't happen) */ 
</span>    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN1964"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><a href="indxpath.c.html#LN1964"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>: </span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_loop_count &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Check to see if outer_relid is on the inside of any semijoin that cur_relid 
 * is on the outside of.  If so, replace rowcount with the estimated number of 
 * unique rows from the semijoin RHS (assuming that's smaller, which it might 
 * not be).  The estimate is crude but it's the best we can do at this stage 
 * of the proceedings. 
 */ 
</span><span class='Keyword'>static double 
</span><a name="LN2015"></a><span class='Declare_Function'>adjust_rowcount_for_semijoins</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN2016"></a>                              <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>cur_relid</span><span class='Delimiter'>, 
</span><a name="LN2017"></a>                              <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>outer_relid</span><span class='Delimiter'>, 
</span><a name="LN2018"></a>                              <span class='Keyword'>double </span><span class='Declare_Parameter'>rowcount</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2020"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2020"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2015"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN249"><span class='Ref_to_Member'>join_info_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2024"></a>        <a href="../../../include/nodes/relation.h.html#LN1913"><span class='Ref_to_Struct'>SpecialJoinInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>sjinfo</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1913"><span class='Ref_to_Struct'>SpecialJoinInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2020"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN2024"><span class='Ref_To_Local'>sjinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1920"><span class='Ref_to_Member'>jointype</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/nodes.h.html#LN691"><span class='Ref_to_EnumConst'>JOIN_SEMI</span></a> <span class='Operator'>&& 
</span>            <a href="../../../include/nodes/bitmapset.h.html#LN75"><span class='Ref_to_Proto'>bms_is_member</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2016"><span class='Ref_to_Parameter'>cur_relid</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2024"><span class='Ref_To_Local'>sjinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1918"><span class='Ref_to_Member'>syn_lefthand</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>            <a href="../../../include/nodes/bitmapset.h.html#LN75"><span class='Ref_to_Proto'>bms_is_member</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2017"><span class='Ref_to_Parameter'>outer_relid</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2024"><span class='Ref_To_Local'>sjinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1919"><span class='Ref_to_Member'>syn_righthand</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Estimate number of unique-ified rows */ 
</span><a name="LN2031"></a>            <span class='Keyword'>double</span>      <span class='Declare_Local'>nraw</span><span class='Delimiter'>; 
</span><a name="LN2032"></a>            <span class='Keyword'>double</span>      <span class='Declare_Local'>nunique</span><span class='Delimiter'>; 
</span> 
            <a href="indxpath.c.html#LN2031"><span class='Ref_To_Local'>nraw</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN138"><span class='Ref_to_Proto'>approximate_joinrel_size</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2015"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2024"><span class='Ref_To_Local'>sjinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1919"><span class='Ref_to_Member'>syn_righthand</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="indxpath.c.html#LN2032"><span class='Ref_To_Local'>nunique</span></a> <span class='Operator'>= </span><a href="../../../include/utils/selfuncs.h.html#LN205"><span class='Ref_to_Proto'>estimate_num_groups</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2015"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                          <a href="indxpath.c.html#LN2024"><span class='Ref_To_Local'>sjinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1927"><span class='Ref_to_Member'>semi_rhs_exprs</span></a><span class='Delimiter'>, 
</span>                                          <a href="indxpath.c.html#LN2031"><span class='Ref_To_Local'>nraw</span></a><span class='Delimiter'>, 
</span>                                          <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN2018"><span class='Ref_to_Parameter'>rowcount</span></a> <span class='Operator'>&GT; </span><a href="indxpath.c.html#LN2032"><span class='Ref_To_Local'>nunique</span></a><span class='Parentheses'>) 
</span>                <a href="indxpath.c.html#LN2018"><span class='Ref_to_Parameter'>rowcount</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN2032"><span class='Ref_To_Local'>nunique</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="indxpath.c.html#LN2018"><span class='Ref_to_Parameter'>rowcount</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end adjust_rowcount_for_semijoins &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Make an approximate estimate of the size of a joinrel. 
 * 
 * We don't have enough info at this point to get a good estimate, so we 
 * just multiply the base relation sizes together.  Fortunately, this is 
 * the right answer anyway for the most common case with a single relation 
 * on the RHS of a semijoin.  Also, estimate_num_groups() has only a weak 
 * dependency on its input_rows argument (it basically uses it as a clamp). 
 * So we might be able to get a fairly decent end result even with a severe 
 * overestimate of the RHS's raw size. 
 */ 
</span><span class='Keyword'>static double 
</span><a name="LN2058"></a><span class='Declare_Function'>approximate_joinrel_size</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>relids</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2060"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>rowcount</span> <span class='Operator'>= </span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN2061"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>relid</span><span class='Delimiter'>; 
</span> 
    <a href="indxpath.c.html#LN2061"><span class='Ref_To_Local'>relid</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="indxpath.c.html#LN2061"><span class='Ref_To_Local'>relid</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN98"><span class='Ref_to_Proto'>bms_next_member</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2058"><span class='Ref_to_Parameter'>relids</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2061"><span class='Ref_To_Local'>relid</span></a><span class='Parentheses'>))</span> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2066"></a>        <a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Paranoia: ignore bogus relid indexes */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN2061"><span class='Ref_To_Local'>relid</span></a> <span class='Operator'>&GT;= </span><a href="indxpath.c.html#LN2058"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN179"><span class='Ref_to_Member'>simple_rel_array_size</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN2066"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN2058"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN178"><span class='Ref_to_Member'>simple_rel_array</span></a><span class='Delimiter'>[</span><a href="indxpath.c.html#LN2061"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>]; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN2066"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2066"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN552"><span class='Ref_to_Member'>relid</span></a> <span class='Operator'>== </span><a href="indxpath.c.html#LN2061"><span class='Ref_To_Local'>relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* sanity check on array */ 
</span> 
        <span class='Comment_Multi_Line'>/* Relation could be proven empty, if so ignore */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1186"><span class='Ref_to_Macro'>IS_DUMMY_REL</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2066"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Otherwise, rel's rows estimate should be valid by now */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2066"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN527"><span class='Ref_to_Member'>rows</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Accumulate product */ 
</span>        <a href="indxpath.c.html#LN2060"><span class='Ref_To_Local'>rowcount</span></a> <span class='Operator'>*= </span><a href="indxpath.c.html#LN2066"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN527"><span class='Ref_to_Member'>rows</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while (relid=bms_next_membe... &raquo; </span> 
    <span class='Control'>return</span> <a href="indxpath.c.html#LN2060"><span class='Ref_To_Local'>rowcount</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end approximate_joinrel_size &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/**************************************************************************** 
 *              ----  ROUTINES TO CHECK QUERY CLAUSES  ---- 
 ****************************************************************************/ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * match_restriction_clauses_to_index 
 *    Identify restriction clauses for the rel that match the index. 
 *    Matching clauses are added to *clauseset. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2100"></a><span class='Declare_Function'>match_restriction_clauses_to_index</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>index</span><span class='Delimiter'>, 
</span><a name="LN2101"></a>                                   <a href="indxpath.c.html#LN57"><span class='Ref_to_Typedef'>IndexClauseSet</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>clauseset</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* We can ignore clauses that are implied by the index predicate */ 
</span>    <a href="indxpath.c.html#LN149"><span class='Ref_to_Proto'>match_clauses_to_index</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2100"><span class='Ref_to_Parameter'>index</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2100"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN657"><span class='Ref_to_Member'>indrestrictinfo</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2101"><span class='Ref_to_Parameter'>clauseset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * match_join_clauses_to_index 
 *    Identify join clauses for the rel that match the index. 
 *    Matching clauses are added to *clauseset. 
 *    Also, add any potentially usable join OR clauses to *joinorclauses. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2114"></a><span class='Declare_Function'>match_join_clauses_to_index</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN2115"></a>                            <a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>index</span><span class='Delimiter'>, 
</span><a name="LN2116"></a>                            <a href="indxpath.c.html#LN57"><span class='Ref_to_Typedef'>IndexClauseSet</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>clauseset</span><span class='Delimiter'>, 
</span><a name="LN2117"></a>                            <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>joinorclauses</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2119"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Scan the rel's join clauses */ 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2119"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2115"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN588"><span class='Ref_to_Member'>joininfo</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2124"></a>        <a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rinfo</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2119"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Check if clause can be moved to this rel */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/optimizer/restrictinfo.h.html#LN40"><span class='Ref_to_Proto'>join_clause_is_movable_to</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2124"><span class='Ref_To_Local'>rinfo</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2115"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Potentially usable, so see if it matches the index or is an OR */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/optimizer/restrictinfo.h.html#LN31"><span class='Ref_to_Proto'>restriction_is_or_clause</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2124"><span class='Ref_To_Local'>rinfo</span></a><span class='Parentheses'>))</span> 
            <span class='Operator'>*</span><a href="indxpath.c.html#LN2117"><span class='Ref_to_Parameter'>joinorclauses</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="indxpath.c.html#LN2117"><span class='Ref_to_Parameter'>joinorclauses</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2124"><span class='Ref_To_Local'>rinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="indxpath.c.html#LN152"><span class='Ref_to_Proto'>match_clause_to_index</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2115"><span class='Ref_to_Parameter'>index</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2124"><span class='Ref_To_Local'>rinfo</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2116"><span class='Ref_to_Parameter'>clauseset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end match_join_clauses_to_index &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * match_eclass_clauses_to_index 
 *    Identify EquivalenceClass join clauses for the rel that match the index. 
 *    Matching clauses are added to *clauseset. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2144"></a><span class='Declare_Function'>match_eclass_clauses_to_index</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>index</span><span class='Delimiter'>, 
</span><a name="LN2145"></a>                              <a href="indxpath.c.html#LN57"><span class='Ref_to_Typedef'>IndexClauseSet</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>clauseset</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2147"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>indexcol</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* No work if rel is not in any such ECs */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="indxpath.c.html#LN2144"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN632"><span class='Ref_to_Member'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN590"><span class='Ref_to_Member'>has_eclass_joins</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN2147"><span class='Ref_To_Local'>indexcol</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="indxpath.c.html#LN2147"><span class='Ref_To_Local'>indexcol</span></a> <span class='Operator'>&LT; </span><a href="indxpath.c.html#LN2144"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN640"><span class='Ref_to_Member'>ncolumns</span></a><span class='Delimiter'>; </span><a href="indxpath.c.html#LN2147"><span class='Ref_To_Local'>indexcol</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2155"></a>        <a href="indxpath.c.html#LN74"><span class='Ref_to_Typedef'>ec_member_matches_arg</span></a> <span class='Declare_Local'>arg</span><span class='Delimiter'>; 
</span><a name="LN2156"></a>        <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>clauses</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Generate clauses, skipping any that join to lateral_referencers */ 
</span>        <a href="indxpath.c.html#LN2155"><span class='Ref_To_Local'>arg</span></a><span class='Operator'>.</span><a href="indxpath.c.html#LN76"><span class='Ref_to_Member'>index</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN2144"><span class='Ref_to_Parameter'>index</span></a><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN2155"><span class='Ref_To_Local'>arg</span></a><span class='Operator'>.</span><a href="indxpath.c.html#LN77"><span class='Ref_to_Member'>indexcol</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN2147"><span class='Ref_To_Local'>indexcol</span></a><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN2156"><span class='Ref_To_Local'>clauses</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/paths.h.html#LN156"><span class='Ref_to_Proto'>generate_implied_equalities_for_column</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2144"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                                         <a href="indxpath.c.html#LN2144"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN632"><span class='Ref_to_Member'>rel</span></a><span class='Delimiter'>, 
</span>                                                  <a href="indxpath.c.html#LN170"><span class='Ref_to_Proto'>ec_member_matches_indexcol</span></a><span class='Delimiter'>, 
</span>                                                         <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="indxpath.c.html#LN2155"><span class='Ref_To_Local'>arg</span></a><span class='Delimiter'>, 
</span>                                            <a href="indxpath.c.html#LN2144"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN632"><span class='Ref_to_Member'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN560"><span class='Ref_to_Member'>lateral_referencers</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We have to check whether the results actually do match the index, 
         * since for non-btree indexes the EC's equality operators might not 
         * be in the index opclass (cf ec_member_matches_indexcol). 
         */ 
</span>        <a href="indxpath.c.html#LN149"><span class='Ref_to_Proto'>match_clauses_to_index</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2144"><span class='Ref_to_Parameter'>index</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2156"><span class='Ref_To_Local'>clauses</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2145"><span class='Ref_to_Parameter'>clauseset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for indexcol=0;indexcol&LT;i... &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end match_eclass_clauses_to_index &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * match_clauses_to_index 
 *    Perform match_clause_to_index() for each clause in a list. 
 *    Matching clauses are added to *clauseset. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2182"></a><span class='Declare_Function'>match_clauses_to_index</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>index</span><span class='Delimiter'>, 
</span><a name="LN2183"></a>                       <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>clauses</span><span class='Delimiter'>, 
</span><a name="LN2184"></a>                       <a href="indxpath.c.html#LN57"><span class='Ref_to_Typedef'>IndexClauseSet</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>clauseset</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2186"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2186"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2183"><span class='Ref_to_Parameter'>clauses</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2190"></a>        <a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rinfo</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN108"><span class='Ref_to_Macro'>lfirst_node</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2186"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="indxpath.c.html#LN152"><span class='Ref_to_Proto'>match_clause_to_index</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2182"><span class='Ref_to_Parameter'>index</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2190"><span class='Ref_To_Local'>rinfo</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2184"><span class='Ref_to_Parameter'>clauseset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * match_clause_to_index 
 *    Test whether a qual clause can be used with an index. 
 * 
 * If the clause is usable, add it to the appropriate list in *clauseset. 
 * *clauseset must be initialized to zeroes before first call. 
 * 
 * Note: in some circumstances we may find the same RestrictInfos coming from 
 * multiple places.  Defend against redundant outputs by refusing to add a 
 * clause twice (pointer equality should be a good enough check for this). 
 * 
 * Note: it's possible that a badly-defined index could have multiple matching 
 * columns.  We always select the first match if so; this avoids scenarios 
 * wherein we get an inflated idea of the index's selectivity by using the 
 * same clause multiple times with different index columns. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2213"></a><span class='Declare_Function'>match_clause_to_index</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>index</span><span class='Delimiter'>, 
</span><a name="LN2214"></a>                      <a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rinfo</span><span class='Delimiter'>, 
</span><a name="LN2215"></a>                      <a href="indxpath.c.html#LN57"><span class='Ref_to_Typedef'>IndexClauseSet</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>clauseset</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2217"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>indexcol</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Never match pseudoconstants to indexes.  (Normally a match could not 
     * happen anyway, since a pseudoconstant clause couldn't contain a Var, 
     * but what if someone builds an expression index on a constant? It's not 
     * totally unreasonable to do so with a partial index, either.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN2214"><span class='Ref_to_Parameter'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1754"><span class='Ref_to_Member'>pseudoconstant</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If clause can't be used as an indexqual because it must wait till after 
     * some lower-security-level restriction clause, reject it. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/optimizer/restrictinfo.h.html#LN32"><span class='Ref_to_Proto'>restriction_is_securely_promotable</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2214"><span class='Ref_to_Parameter'>rinfo</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2213"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN632"><span class='Ref_to_Member'>rel</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* OK, check each index column for a match */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN2217"><span class='Ref_To_Local'>indexcol</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="indxpath.c.html#LN2217"><span class='Ref_To_Local'>indexcol</span></a> <span class='Operator'>&LT; </span><a href="indxpath.c.html#LN2213"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN640"><span class='Ref_to_Member'>ncolumns</span></a><span class='Delimiter'>; </span><a href="indxpath.c.html#LN2217"><span class='Ref_To_Local'>indexcol</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN155"><span class='Ref_to_Proto'>match_clause_to_indexcol</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2213"><span class='Ref_to_Parameter'>index</span></a><span class='Delimiter'>, 
</span>                                     <a href="indxpath.c.html#LN2217"><span class='Ref_To_Local'>indexcol</span></a><span class='Delimiter'>, 
</span>                                     <a href="indxpath.c.html#LN2214"><span class='Ref_to_Parameter'>rinfo</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="indxpath.c.html#LN2215"><span class='Ref_to_Parameter'>clauseset</span></a><span class='Operator'>-&GT;</span><a href="indxpath.c.html#LN61"><span class='Ref_to_Member'>indexclauses</span></a><span class='Delimiter'>[</span><a href="indxpath.c.html#LN2217"><span class='Ref_To_Local'>indexcol</span></a><span class='Delimiter'>] </span><span class='Operator'>= 
</span>                <a href="../../../include/nodes/pg_list.h.html#LN256"><span class='Ref_to_Proto'>list_append_unique_ptr</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2215"><span class='Ref_to_Parameter'>clauseset</span></a><span class='Operator'>-&GT;</span><a href="indxpath.c.html#LN61"><span class='Ref_to_Member'>indexclauses</span></a><span class='Delimiter'>[</span><a href="indxpath.c.html#LN2217"><span class='Ref_To_Local'>indexcol</span></a><span class='Delimiter'>], 
</span>                                       <a href="indxpath.c.html#LN2214"><span class='Ref_to_Parameter'>rinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="indxpath.c.html#LN2215"><span class='Ref_to_Parameter'>clauseset</span></a><span class='Operator'>-&GT;</span><a href="indxpath.c.html#LN59"><span class='Ref_to_Member'>nonempty</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end match_clause_to_index &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * match_clause_to_indexcol() 
 *    Determines whether a restriction clause matches a column of an index. 
 * 
 *    To match an index normally, the clause: 
 * 
 *    (1)  must be in the form (indexkey op const) or (const op indexkey); 
 *         and 
 *    (2)  must contain an operator which is in the same family as the index 
 *         operator for this column, or is a "special" operator as recognized 
 *         by match_special_index_operator(); 
 *         and 
 *    (3)  must match the collation of the index, if collation is relevant. 
 * 
 *    Our definition of "const" is exceedingly liberal: we allow anything that 
 *    doesn't involve a volatile function or a Var of the index's relation. 
 *    In particular, Vars belonging to other relations of the query are 
 *    accepted here, since a clause of that form can be used in a 
 *    parameterized indexscan.  It's the responsibility of higher code levels 
 *    to manage restriction and join clauses appropriately. 
 * 
 *    Note: we do need to check for Vars of the index's relation on the 
 *    "const" side of the clause, since clauses like (a.f1 OP (b.f2 OP a.f3)) 
 *    are not processable by a parameterized indexscan on a.f1, whereas 
 *    something like (a.f1 OP (b.f2 OP c.f3)) is. 
 * 
 *    Presently, the executor can only deal with indexquals that have the 
 *    indexkey on the left, so we can only use clauses that have the indexkey 
 *    on the right if we can commute the clause to put the key on the left. 
 *    We do not actually do the commuting here, but we check whether a 
 *    suitable commutator operator is available. 
 * 
 *    If the index has a collation, the clause must have the same collation. 
 *    For collation-less indexes, we assume it doesn't matter; this is 
 *    necessary for cases like "hstore ? text", wherein hstore's operators 
 *    don't care about collation but the clause will get marked with a 
 *    collation anyway because of the text argument.  (This logic is 
 *    embodied in the macro IndexCollMatchesExprColl.) 
 * 
 *    It is also possible to match RowCompareExpr clauses to indexes (but 
 *    currently, only btree indexes handle this).  In this routine we will 
 *    report a match if the first column of the row comparison matches the 
 *    target index column.  This is sufficient to guarantee that some index 
 *    condition can be constructed from the RowCompareExpr --- whether the 
 *    remaining columns match the index too is considered in 
 *    adjust_rowcompare_for_index(). 
 * 
 *    It is also possible to match ScalarArrayOpExpr clauses to indexes, when 
 *    the clause is of the form "indexkey op ANY (arrayconst)". 
 * 
 *    For boolean indexes, it is also possible to match the clause directly 
 *    to the indexkey; or perhaps the clause is (NOT indexkey). 
 * 
 * 'index' is the index of interest. 
 * 'indexcol' is a column number of 'index' (counting from 0). 
 * 'rinfo' is the clause to be tested (as a RestrictInfo node). 
 * 
 * Returns true if the clause can be used with this index key. 
 * 
 * NOTE:  returns false if clause is an OR or AND clause; it is the 
 * responsibility of higher-level routines to cope with those. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN2314"></a><span class='Declare_Function'>match_clause_to_indexcol</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>index</span><span class='Delimiter'>, 
</span><a name="LN2315"></a>                         <span class='Keyword'>int </span><span class='Declare_Parameter'>indexcol</span><span class='Delimiter'>, 
</span><a name="LN2316"></a>                         <a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rinfo</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2318"></a>    <a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>clause</span> <span class='Operator'>= </span><a href="indxpath.c.html#LN2316"><span class='Ref_to_Parameter'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1746"><span class='Ref_to_Member'>clause</span></a><span class='Delimiter'>; 
</span><a name="LN2319"></a>    <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a>       <span class='Declare_Local'>index_relid</span> <span class='Operator'>= </span><a href="indxpath.c.html#LN2314"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN632"><span class='Ref_to_Member'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN552"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>; 
</span><a name="LN2320"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>opfamily</span> <span class='Operator'>= </span><a href="indxpath.c.html#LN2314"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN643"><span class='Ref_to_Member'>opfamily</span></a><span class='Delimiter'>[</span><a href="indxpath.c.html#LN2315"><span class='Ref_to_Parameter'>indexcol</span></a><span class='Delimiter'>]; 
</span><a name="LN2321"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>idxcollation</span> <span class='Operator'>= </span><a href="indxpath.c.html#LN2314"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN642"><span class='Ref_to_Member'>indexcollations</span></a><span class='Delimiter'>[</span><a href="indxpath.c.html#LN2315"><span class='Ref_to_Parameter'>indexcol</span></a><span class='Delimiter'>]; 
</span><a name="LN2322"></a>    <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>leftop</span><span class='Delimiter'>, 
</span><a name="LN2323"></a>               <span class='Operator'>*</span><span class='Declare_Local'>rightop</span><span class='Delimiter'>; 
</span><a name="LN2324"></a>    <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a>      <span class='Declare_Local'>left_relids</span><span class='Delimiter'>; 
</span><a name="LN2325"></a>    <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a>      <span class='Declare_Local'>right_relids</span><span class='Delimiter'>; 
</span><a name="LN2326"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>expr_op</span><span class='Delimiter'>; 
</span><a name="LN2327"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>expr_coll</span><span class='Delimiter'>; 
</span><a name="LN2328"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>plain_op</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* First check for boolean-index cases. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN42"><span class='Ref_to_Macro'>IsBooleanOpfamily</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2320"><span class='Ref_To_Local'>opfamily</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN173"><span class='Ref_to_Proto'>match_boolean_index_clause</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN2318"><span class='Ref_To_Local'>clause</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2315"><span class='Ref_to_Parameter'>indexcol</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2314"><span class='Ref_to_Parameter'>index</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Clause must be a binary opclause, or possibly a ScalarArrayOpExpr 
     * (which is always binary, by definition).  Or it could be a 
     * RowCompareExpr, which we pass off to match_rowcompare_to_indexcol(). 
     * Or, if the index supports it, we can handle IS NULL/NOT NULL clauses. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/optimizer/clauses.h.html#LN19"><span class='Ref_to_Macro'>is_opclause</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2318"><span class='Ref_To_Local'>clause</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="indxpath.c.html#LN2322"><span class='Ref_To_Local'>leftop</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/clauses.h.html#LN32"><span class='Ref_to_Proto'>get_leftop</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2318"><span class='Ref_To_Local'>clause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN2323"><span class='Ref_To_Local'>rightop</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/clauses.h.html#LN33"><span class='Ref_to_Proto'>get_rightop</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2318"><span class='Ref_To_Local'>clause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="indxpath.c.html#LN2322"><span class='Ref_To_Local'>leftop</span></a> <span class='Operator'>|| !</span><a href="indxpath.c.html#LN2323"><span class='Ref_To_Local'>rightop</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN2324"><span class='Ref_To_Local'>left_relids</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN2316"><span class='Ref_to_Parameter'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1773"><span class='Ref_to_Member'>left_relids</span></a><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN2325"><span class='Ref_To_Local'>right_relids</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN2316"><span class='Ref_to_Parameter'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1774"><span class='Ref_to_Member'>right_relids</span></a><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN2326"><span class='Ref_To_Local'>expr_op</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN491"><span class='Ref_to_Struct'>OpExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN2318"><span class='Ref_To_Local'>clause</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>opno<span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN2327"><span class='Ref_To_Local'>expr_coll</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN491"><span class='Ref_to_Struct'>OpExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN2318"><span class='Ref_To_Local'>clause</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>inputcollid<span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN2328"><span class='Ref_To_Local'>plain_op</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN2318"><span class='Ref_To_Local'>clause</span></a> <span class='Operator'>&& </span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2318"><span class='Ref_To_Local'>clause</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN534"><span class='Ref_to_Struct'>ScalarArrayOpExpr</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2357"></a>        <a href="../../../include/nodes/primnodes.h.html#LN534"><span class='Ref_to_Struct'>ScalarArrayOpExpr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>saop</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN534"><span class='Ref_to_Struct'>ScalarArrayOpExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN2318"><span class='Ref_To_Local'>clause</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* We only accept ANY clauses, not ALL */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="indxpath.c.html#LN2357"><span class='Ref_To_Local'>saop</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN539"><span class='Ref_to_Member'>useOr</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN2322"><span class='Ref_To_Local'>leftop</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2357"><span class='Ref_To_Local'>saop</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN541"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN2323"><span class='Ref_To_Local'>rightop</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN115"><span class='Ref_to_Macro'>lsecond</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2357"><span class='Ref_To_Local'>saop</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN541"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN2324"><span class='Ref_To_Local'>left_relids</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* not actually needed */ 
</span>        <a href="indxpath.c.html#LN2325"><span class='Ref_To_Local'>right_relids</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/var.h.html#LN29"><span class='Ref_to_Proto'>pull_varnos</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2323"><span class='Ref_To_Local'>rightop</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN2326"><span class='Ref_To_Local'>expr_op</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN2357"><span class='Ref_To_Local'>saop</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN537"><span class='Ref_to_Member'>opno</span></a><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN2327"><span class='Ref_To_Local'>expr_coll</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN2357"><span class='Ref_To_Local'>saop</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN540"><span class='Ref_to_Member'>inputcollid</span></a><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN2328"><span class='Ref_To_Local'>plain_op</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN2318"><span class='Ref_To_Local'>clause</span></a> <span class='Operator'>&& </span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2318"><span class='Ref_To_Local'>clause</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1026"><span class='Ref_to_Struct'>RowCompareExpr</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>return</span> <a href="indxpath.c.html#LN160"><span class='Ref_to_Proto'>match_rowcompare_to_indexcol</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2314"><span class='Ref_to_Parameter'>index</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2315"><span class='Ref_to_Parameter'>indexcol</span></a><span class='Delimiter'>, 
</span>                                            <a href="indxpath.c.html#LN2320"><span class='Ref_To_Local'>opfamily</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2321"><span class='Ref_To_Local'>idxcollation</span></a><span class='Delimiter'>, 
</span>                                            <span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1026"><span class='Ref_to_Struct'>RowCompareExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN2318"><span class='Ref_To_Local'>clause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN2314"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN671"><span class='Ref_to_Member'>amsearchnulls</span></a> <span class='Operator'>&& </span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2318"><span class='Ref_To_Local'>clause</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1175"><span class='Ref_to_Struct'>NullTest</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2378"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1175"><span class='Ref_to_Struct'>NullTest</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>nt</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1175"><span class='Ref_to_Struct'>NullTest</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN2318"><span class='Ref_To_Local'>clause</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="indxpath.c.html#LN2378"><span class='Ref_To_Local'>nt</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1180"><span class='Ref_to_Member'>argisrow</span></a> <span class='Operator'>&& 
</span>            <a href="../../../include/optimizer/paths.h.html#LN75"><span class='Ref_to_Proto'>match_index_to_operand</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN2378"><span class='Ref_To_Local'>nt</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1178"><span class='Ref_to_Member'>arg</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2315"><span class='Ref_to_Parameter'>indexcol</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2314"><span class='Ref_to_Parameter'>index</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check for clauses of the form: (indexkey operator constant) or 
     * (constant operator indexkey).  See above notes about const-ness. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/optimizer/paths.h.html#LN75"><span class='Ref_to_Proto'>match_index_to_operand</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2322"><span class='Ref_To_Local'>leftop</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2315"><span class='Ref_to_Parameter'>indexcol</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2314"><span class='Ref_to_Parameter'>index</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>        <span class='Operator'>!</span><a href="../../../include/nodes/bitmapset.h.html#LN75"><span class='Ref_to_Proto'>bms_is_member</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2319"><span class='Ref_To_Local'>index_relid</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2325"><span class='Ref_To_Local'>right_relids</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>        <span class='Operator'>!</span><a href="../../../include/optimizer/clauses.h.html#LN60"><span class='Ref_to_Proto'>contain_volatile_functions</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2323"><span class='Ref_To_Local'>rightop</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN45"><span class='Ref_to_Macro'>IndexCollMatchesExprColl</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2321"><span class='Ref_To_Local'>idxcollation</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2327"><span class='Ref_To_Local'>expr_coll</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>            <a href="indxpath.c.html#LN158"><span class='Ref_to_Proto'>is_indexable_operator</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2326"><span class='Ref_To_Local'>expr_op</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2320"><span class='Ref_To_Local'>opfamily</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If we didn't find a member of the index's opfamily, see whether it 
         * is a "special" indexable operator. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN2328"><span class='Ref_To_Local'>plain_op</span></a> <span class='Operator'>&& 
</span>            <a href="indxpath.c.html#LN175"><span class='Ref_to_Proto'>match_special_index_operator</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2318"><span class='Ref_To_Local'>clause</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2320"><span class='Ref_To_Local'>opfamily</span></a><span class='Delimiter'>, 
</span>                                         <a href="indxpath.c.html#LN2321"><span class='Ref_To_Local'>idxcollation</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN2328"><span class='Ref_To_Local'>plain_op</span></a> <span class='Operator'>&& 
</span>        <a href="../../../include/optimizer/paths.h.html#LN75"><span class='Ref_to_Proto'>match_index_to_operand</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2323"><span class='Ref_To_Local'>rightop</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2315"><span class='Ref_to_Parameter'>indexcol</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2314"><span class='Ref_to_Parameter'>index</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>        <span class='Operator'>!</span><a href="../../../include/nodes/bitmapset.h.html#LN75"><span class='Ref_to_Proto'>bms_is_member</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2319"><span class='Ref_To_Local'>index_relid</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2324"><span class='Ref_To_Local'>left_relids</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>        <span class='Operator'>!</span><a href="../../../include/optimizer/clauses.h.html#LN60"><span class='Ref_to_Proto'>contain_volatile_functions</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2322"><span class='Ref_To_Local'>leftop</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN45"><span class='Ref_to_Macro'>IndexCollMatchesExprColl</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2321"><span class='Ref_To_Local'>idxcollation</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2327"><span class='Ref_To_Local'>expr_coll</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>            <a href="indxpath.c.html#LN158"><span class='Ref_to_Proto'>is_indexable_operator</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2326"><span class='Ref_To_Local'>expr_op</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2320"><span class='Ref_To_Local'>opfamily</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If we didn't find a member of the index's opfamily, see whether it 
         * is a "special" indexable operator. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN175"><span class='Ref_to_Proto'>match_special_index_operator</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2318"><span class='Ref_To_Local'>clause</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2320"><span class='Ref_To_Local'>opfamily</span></a><span class='Delimiter'>, 
</span>                                         <a href="indxpath.c.html#LN2321"><span class='Ref_To_Local'>idxcollation</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end match_clause_to_indexcol &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * is_indexable_operator 
 *    Does the operator match the specified index opfamily? 
 * 
 * If the indexkey is on the right, what we actually want to know 
 * is whether the operator has a commutator operator that matches 
 * the opfamily. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN2442"></a><span class='Declare_Function'>is_indexable_operator</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>expr_op</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>opfamily</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>indexkey_on_left</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Get the commuted operator if necessary */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="indxpath.c.html#LN2442"><span class='Ref_to_Parameter'>indexkey_on_left</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="indxpath.c.html#LN2442"><span class='Ref_to_Parameter'>expr_op</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN106"><span class='Ref_to_Proto'>get_commutator</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2442"><span class='Ref_to_Parameter'>expr_op</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN2442"><span class='Ref_to_Parameter'>expr_op</span></a> <span class='Operator'>== </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* OK if the (commuted) operator is a member of the index's opfamily */ 
</span>    <span class='Control'>return</span> <a href="../../utils/cache/lsyscache.c.html#LN61"><span class='Ref_to_Func'>op_in_opfamily</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2442"><span class='Ref_to_Parameter'>expr_op</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2442"><span class='Ref_to_Parameter'>opfamily</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * match_rowcompare_to_indexcol() 
 *    Handles the RowCompareExpr case for match_clause_to_indexcol(), 
 *    which see for comments. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN2462"></a><span class='Declare_Function'>match_rowcompare_to_indexcol</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>index</span><span class='Delimiter'>, 
</span><a name="LN2463"></a>                             <span class='Keyword'>int </span><span class='Declare_Parameter'>indexcol</span><span class='Delimiter'>, 
</span><a name="LN2464"></a>                             <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>opfamily</span><span class='Delimiter'>, 
</span><a name="LN2465"></a>                             <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>idxcollation</span><span class='Delimiter'>, 
</span><a name="LN2466"></a>                             <a href="../../../include/nodes/primnodes.h.html#LN1026"><span class='Ref_to_Struct'>RowCompareExpr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>clause</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2468"></a>    <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a>       <span class='Declare_Local'>index_relid</span> <span class='Operator'>= </span><a href="indxpath.c.html#LN2462"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN632"><span class='Ref_to_Member'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN552"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>; 
</span><a name="LN2469"></a>    <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>leftop</span><span class='Delimiter'>, 
</span><a name="LN2470"></a>               <span class='Operator'>*</span><span class='Declare_Local'>rightop</span><span class='Delimiter'>; 
</span><a name="LN2471"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>expr_op</span><span class='Delimiter'>; 
</span><a name="LN2472"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>expr_coll</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Forget it if we're not dealing with a btree index */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN2462"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN650"><span class='Ref_to_Member'>relam</span></a> <span class='Operator'>!= </span><a href="../../../include/catalog/pg_am.h.html#LN69"><span class='Ref_to_Const'>BTREE_AM_OID</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We could do the matching on the basis of insisting that the opfamily 
     * shown in the RowCompareExpr be the same as the index column's opfamily, 
     * but that could fail in the presence of reverse-sort opfamilies: it'd be 
     * a matter of chance whether RowCompareExpr had picked the forward or 
     * reverse-sort family.  So look only at the operator, and match if it is 
     * a member of the index's opfamily (after commutation, if the indexkey is 
     * on the right).  We'll worry later about whether any additional 
     * operators are matchable to the index. 
     */ 
</span>    <a href="indxpath.c.html#LN2469"><span class='Ref_To_Local'>leftop</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2466"><span class='Ref_to_Parameter'>clause</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1033"><span class='Ref_to_Member'>largs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="indxpath.c.html#LN2470"><span class='Ref_To_Local'>rightop</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2466"><span class='Ref_to_Parameter'>clause</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1034"><span class='Ref_to_Member'>rargs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="indxpath.c.html#LN2471"><span class='Ref_To_Local'>expr_op</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN112"><span class='Ref_to_Macro'>linitial_oid</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2466"><span class='Ref_to_Parameter'>clause</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1030"><span class='Ref_to_Member'>opnos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="indxpath.c.html#LN2472"><span class='Ref_To_Local'>expr_coll</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN112"><span class='Ref_to_Macro'>linitial_oid</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2466"><span class='Ref_to_Parameter'>clause</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1032"><span class='Ref_to_Member'>inputcollids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Collations must match, if relevant */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="indxpath.c.html#LN45"><span class='Ref_to_Macro'>IndexCollMatchesExprColl</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2465"><span class='Ref_to_Parameter'>idxcollation</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2472"><span class='Ref_To_Local'>expr_coll</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * These syntactic tests are the same as in match_clause_to_indexcol() 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/optimizer/paths.h.html#LN75"><span class='Ref_to_Proto'>match_index_to_operand</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2469"><span class='Ref_To_Local'>leftop</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2463"><span class='Ref_to_Parameter'>indexcol</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2462"><span class='Ref_to_Parameter'>index</span></a><span class='Parentheses'>)</span> <span class='Operator'>&& 
</span>        <span class='Operator'>!</span><a href="../../../include/nodes/bitmapset.h.html#LN75"><span class='Ref_to_Proto'>bms_is_member</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2468"><span class='Ref_To_Local'>index_relid</span></a><span class='Delimiter'>, </span><a href="../../../include/optimizer/var.h.html#LN29"><span class='Ref_to_Proto'>pull_varnos</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2470"><span class='Ref_To_Local'>rightop</span></a><span class='Parentheses'>))</span> <span class='Operator'>&& 
</span>        <span class='Operator'>!</span><a href="../../../include/optimizer/clauses.h.html#LN60"><span class='Ref_to_Proto'>contain_volatile_functions</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2470"><span class='Ref_To_Local'>rightop</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* OK, indexkey is on left */ 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/optimizer/paths.h.html#LN75"><span class='Ref_to_Proto'>match_index_to_operand</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2470"><span class='Ref_To_Local'>rightop</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2463"><span class='Ref_to_Parameter'>indexcol</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2462"><span class='Ref_to_Parameter'>index</span></a><span class='Parentheses'>)</span> <span class='Operator'>&& 
</span>             <span class='Operator'>!</span><a href="../../../include/nodes/bitmapset.h.html#LN75"><span class='Ref_to_Proto'>bms_is_member</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2468"><span class='Ref_To_Local'>index_relid</span></a><span class='Delimiter'>, </span><a href="../../../include/optimizer/var.h.html#LN29"><span class='Ref_to_Proto'>pull_varnos</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2469"><span class='Ref_To_Local'>leftop</span></a><span class='Parentheses'>))</span> <span class='Operator'>&& 
</span>             <span class='Operator'>!</span><a href="../../../include/optimizer/clauses.h.html#LN60"><span class='Ref_to_Proto'>contain_volatile_functions</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2469"><span class='Ref_To_Local'>leftop</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* indexkey is on right, so commute the operator */ 
</span>        <a href="indxpath.c.html#LN2471"><span class='Ref_To_Local'>expr_op</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN106"><span class='Ref_to_Proto'>get_commutator</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2471"><span class='Ref_To_Local'>expr_op</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN2471"><span class='Ref_To_Local'>expr_op</span></a> <span class='Operator'>== </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* We're good if the operator is the right type of opfamily member */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="../../../include/utils/lsyscache.h.html#LN64"><span class='Ref_to_Proto'>get_op_opfamily_strategy</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2471"><span class='Ref_To_Local'>expr_op</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2464"><span class='Ref_to_Parameter'>opfamily</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN28"><span class='Ref_to_Const'>BTLessStrategyNumber</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN29"><span class='Ref_to_Const'>BTLessEqualStrategyNumber</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN31"><span class='Ref_to_Const'>BTGreaterEqualStrategyNumber</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN32"><span class='Ref_to_Const'>BTGreaterStrategyNumber</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end match_rowcompare_to_indexcol &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/**************************************************************************** 
 *              ----  ROUTINES TO CHECK ORDERING OPERATORS  ---- 
 ****************************************************************************/ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * match_pathkeys_to_index 
 *      Test whether an index can produce output ordered according to the 
 *      given pathkeys using "ordering operators". 
 * 
 * If it can, return a list of suitable ORDER BY expressions, each of the form 
 * "indexedcol operator pseudoconstant", along with an integer list of the 
 * index column numbers (zero based) that each clause would be used with. 
 * NIL lists are returned if the ordering is not achievable this way. 
 * 
 * On success, the result list is ordered by pathkeys, and in fact is 
 * one-to-one with the requested pathkeys. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2550"></a><span class='Declare_Function'>match_pathkeys_to_index</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>index</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pathkeys</span><span class='Delimiter'>, 
</span><a name="LN2551"></a>                        <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>orderby_clauses_p</span><span class='Delimiter'>, 
</span><a name="LN2552"></a>                        <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>clause_columns_p</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2554"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>orderby_clauses</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN2555"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>clause_columns</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN2556"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc1</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="indxpath.c.html#LN2551"><span class='Ref_to_Parameter'>orderby_clauses_p</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* set default results */ 
</span>    <span class='Operator'>*</span><a href="indxpath.c.html#LN2552"><span class='Ref_to_Parameter'>clause_columns_p</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Only indexes with the amcanorderbyop property are interesting here */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="indxpath.c.html#LN2550"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN668"><span class='Ref_to_Member'>amcanorderbyop</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2556"><span class='Ref_To_Local'>lc1</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2550"><span class='Ref_to_Parameter'>pathkeys</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2567"></a>        <a href="../../../include/nodes/relation.h.html#LN845"><span class='Ref_to_Struct'>PathKey</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>pathkey</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN845"><span class='Ref_to_Struct'>PathKey</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2556"><span class='Ref_To_Local'>lc1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2568"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>found</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN2569"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc2</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Note: for any failure to match, we just return NIL immediately. 
         * There is no value in matching just some of the pathkeys. 
         */ 
</span> 
        <span class='Comment_Multi_Line'>/* Pathkey must request default sort order for the target opfamily */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN2567"><span class='Ref_To_Local'>pathkey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN851"><span class='Ref_to_Member'>pk_strategy</span></a> <span class='Operator'>!= </span><a href="../../../include/access/stratnum.h.html#LN28"><span class='Ref_to_Const'>BTLessStrategyNumber</span></a> <span class='Operator'>|| 
</span>            <a href="indxpath.c.html#LN2567"><span class='Ref_To_Local'>pathkey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN852"><span class='Ref_to_Member'>pk_nulls_first</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* If eclass is volatile, no hope of using an indexscan */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN2567"><span class='Ref_To_Local'>pathkey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN849"><span class='Ref_to_Member'>pk_eclass</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN778"><span class='Ref_to_Member'>ec_has_volatile</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Try to match eclass member expression(s) to index.  Note that child 
         * EC members are considered, but only when they belong to the target 
         * relation.  (Unlike regular members, the same expression could be a 
         * child member of more than one EC.  Therefore, the same index could 
         * be considered to match more than one pathkey list, which is OK 
         * here.  See also get_eclass_for_sort_expr.) 
         */ 
</span>        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2569"><span class='Ref_To_Local'>lc2</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2567"><span class='Ref_To_Local'>pathkey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN849"><span class='Ref_to_Member'>pk_eclass</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN772"><span class='Ref_to_Member'>ec_members</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2595"></a>            <a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Declare_Local'>member</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2569"><span class='Ref_To_Local'>lc2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2596"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>indexcol</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* No possibility of match if it references other relations */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/bitmapset.h.html#LN66"><span class='Ref_to_Proto'>bms_equal</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2595"><span class='Ref_To_Local'>member</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN821"><span class='Ref_to_Member'>em_relids</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2550"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN632"><span class='Ref_to_Member'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN524"><span class='Ref_to_Member'>relids</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * We allow any column of the index to match each pathkey; they 
             * don't have to match left-to-right as you might expect.  This is 
             * correct for GiST, which is the sole existing AM supporting 
             * amcanorderbyop.  We might need different logic in future for 
             * other implementations. 
             */ 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN2596"><span class='Ref_To_Local'>indexcol</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="indxpath.c.html#LN2596"><span class='Ref_To_Local'>indexcol</span></a> <span class='Operator'>&LT; </span><a href="indxpath.c.html#LN2550"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN640"><span class='Ref_to_Member'>ncolumns</span></a><span class='Delimiter'>; </span><a href="indxpath.c.html#LN2596"><span class='Ref_To_Local'>indexcol</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2611"></a>                <a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>expr</span><span class='Delimiter'>; 
</span> 
                <a href="indxpath.c.html#LN2611"><span class='Ref_To_Local'>expr</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN168"><span class='Ref_to_Proto'>match_clause_to_ordering_op</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2550"><span class='Ref_to_Parameter'>index</span></a><span class='Delimiter'>, 
</span>                                                   <a href="indxpath.c.html#LN2596"><span class='Ref_To_Local'>indexcol</span></a><span class='Delimiter'>, 
</span>                                                   <a href="indxpath.c.html#LN2595"><span class='Ref_To_Local'>member</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN820"><span class='Ref_to_Member'>em_expr</span></a><span class='Delimiter'>, 
</span>                                                   <a href="indxpath.c.html#LN2567"><span class='Ref_To_Local'>pathkey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN850"><span class='Ref_to_Member'>pk_opfamily</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN2611"><span class='Ref_To_Local'>expr</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="indxpath.c.html#LN2554"><span class='Ref_To_Local'>orderby_clauses</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2554"><span class='Ref_To_Local'>orderby_clauses</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2611"><span class='Ref_To_Local'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="indxpath.c.html#LN2555"><span class='Ref_To_Local'>clause_columns</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN144"><span class='Ref_to_Func'>lappend_int</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2555"><span class='Ref_To_Local'>clause_columns</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2596"><span class='Ref_To_Local'>indexcol</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="indxpath.c.html#LN2568"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN2568"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>)</span>          <span class='Comment_Single_Line'>/* don't want to look at remaining members */ 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="indxpath.c.html#LN2568"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>)</span>             <span class='Comment_Single_Line'>/* fail if no match for this pathkey */ 
</span>            <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Operator'>*</span><a href="indxpath.c.html#LN2551"><span class='Ref_to_Parameter'>orderby_clauses_p</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN2554"><span class='Ref_To_Local'>orderby_clauses</span></a><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* success! */ 
</span>    <span class='Operator'>*</span><a href="indxpath.c.html#LN2552"><span class='Ref_to_Parameter'>clause_columns_p</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN2555"><span class='Ref_To_Local'>clause_columns</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end match_pathkeys_to_index &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * match_clause_to_ordering_op 
 *    Determines whether an ordering operator expression matches an 
 *    index column. 
 * 
 *    This is similar to, but simpler than, match_clause_to_indexcol. 
 *    We only care about simple OpExpr cases.  The input is a bare 
 *    expression that is being ordered by, which must be of the form 
 *    (indexkey op const) or (const op indexkey) where op is an ordering 
 *    operator for the column's opfamily. 
 * 
 * 'index' is the index of interest. 
 * 'indexcol' is a column number of 'index' (counting from 0). 
 * 'clause' is the ordering expression to be tested. 
 * 'pk_opfamily' is the btree opfamily describing the required sort order. 
 * 
 * Note that we currently do not consider the collation of the ordering 
 * operator's result.  In practical cases the result type will be numeric 
 * and thus have no collation, and it's not very clear what to match to 
 * if it did have a collation.  The index's collation should match the 
 * ordering operator's input collation, not its result. 
 * 
 * If successful, return 'clause' as-is if the indexkey is on the left, 
 * otherwise a commuted copy of 'clause'.  If no match, return NULL. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>* 
</span><a name="LN2664"></a><span class='Declare_Function'>match_clause_to_ordering_op</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>index</span><span class='Delimiter'>, 
</span><a name="LN2665"></a>                            <span class='Keyword'>int </span><span class='Declare_Parameter'>indexcol</span><span class='Delimiter'>, 
</span><a name="LN2666"></a>                            <a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>clause</span><span class='Delimiter'>, 
</span><a name="LN2667"></a>                            <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>pk_opfamily</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2669"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>opfamily</span> <span class='Operator'>= </span><a href="indxpath.c.html#LN2664"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN643"><span class='Ref_to_Member'>opfamily</span></a><span class='Delimiter'>[</span><a href="indxpath.c.html#LN2665"><span class='Ref_to_Parameter'>indexcol</span></a><span class='Delimiter'>]; 
</span><a name="LN2670"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>idxcollation</span> <span class='Operator'>= </span><a href="indxpath.c.html#LN2664"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN642"><span class='Ref_to_Member'>indexcollations</span></a><span class='Delimiter'>[</span><a href="indxpath.c.html#LN2665"><span class='Ref_to_Parameter'>indexcol</span></a><span class='Delimiter'>]; 
</span><a name="LN2671"></a>    <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>leftop</span><span class='Delimiter'>, 
</span><a name="LN2672"></a>               <span class='Operator'>*</span><span class='Declare_Local'>rightop</span><span class='Delimiter'>; 
</span><a name="LN2673"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>expr_op</span><span class='Delimiter'>; 
</span><a name="LN2674"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>expr_coll</span><span class='Delimiter'>; 
</span><a name="LN2675"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>sortfamily</span><span class='Delimiter'>; 
</span><a name="LN2676"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>commuted</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Clause must be a binary opclause. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/optimizer/clauses.h.html#LN19"><span class='Ref_to_Macro'>is_opclause</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2666"><span class='Ref_to_Parameter'>clause</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="indxpath.c.html#LN2671"><span class='Ref_To_Local'>leftop</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/clauses.h.html#LN32"><span class='Ref_to_Proto'>get_leftop</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2666"><span class='Ref_to_Parameter'>clause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="indxpath.c.html#LN2672"><span class='Ref_To_Local'>rightop</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/clauses.h.html#LN33"><span class='Ref_to_Proto'>get_rightop</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2666"><span class='Ref_to_Parameter'>clause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="indxpath.c.html#LN2671"><span class='Ref_To_Local'>leftop</span></a> <span class='Operator'>|| !</span><a href="indxpath.c.html#LN2672"><span class='Ref_To_Local'>rightop</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="indxpath.c.html#LN2673"><span class='Ref_To_Local'>expr_op</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN491"><span class='Ref_to_Struct'>OpExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN2666"><span class='Ref_to_Parameter'>clause</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>opno<span class='Delimiter'>; 
</span>    <a href="indxpath.c.html#LN2674"><span class='Ref_To_Local'>expr_coll</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN491"><span class='Ref_to_Struct'>OpExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN2666"><span class='Ref_to_Parameter'>clause</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>inputcollid<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We can forget the whole thing right away if wrong collation. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="indxpath.c.html#LN45"><span class='Ref_to_Macro'>IndexCollMatchesExprColl</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2670"><span class='Ref_To_Local'>idxcollation</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2674"><span class='Ref_To_Local'>expr_coll</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check for clauses of the form: (indexkey operator constant) or 
     * (constant operator indexkey). 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/optimizer/paths.h.html#LN75"><span class='Ref_to_Proto'>match_index_to_operand</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2671"><span class='Ref_To_Local'>leftop</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2665"><span class='Ref_to_Parameter'>indexcol</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2664"><span class='Ref_to_Parameter'>index</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>        <span class='Operator'>!</span><a href="../../../include/optimizer/var.h.html#LN33"><span class='Ref_to_Proto'>contain_var_clause</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2672"><span class='Ref_To_Local'>rightop</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>        <span class='Operator'>!</span><a href="../../../include/optimizer/clauses.h.html#LN60"><span class='Ref_to_Proto'>contain_volatile_functions</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2672"><span class='Ref_To_Local'>rightop</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="indxpath.c.html#LN2676"><span class='Ref_To_Local'>commuted</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/optimizer/paths.h.html#LN75"><span class='Ref_to_Proto'>match_index_to_operand</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2672"><span class='Ref_To_Local'>rightop</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2665"><span class='Ref_to_Parameter'>indexcol</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2664"><span class='Ref_to_Parameter'>index</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>             <span class='Operator'>!</span><a href="../../../include/optimizer/var.h.html#LN33"><span class='Ref_to_Proto'>contain_var_clause</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2671"><span class='Ref_To_Local'>leftop</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>             <span class='Operator'>!</span><a href="../../../include/optimizer/clauses.h.html#LN60"><span class='Ref_to_Proto'>contain_volatile_functions</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2671"><span class='Ref_To_Local'>leftop</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Might match, but we need a commuted operator */ 
</span>        <a href="indxpath.c.html#LN2673"><span class='Ref_To_Local'>expr_op</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN106"><span class='Ref_to_Proto'>get_commutator</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2673"><span class='Ref_To_Local'>expr_op</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN2673"><span class='Ref_To_Local'>expr_op</span></a> <span class='Operator'>== </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN2676"><span class='Ref_To_Local'>commuted</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Is the (commuted) operator an ordering operator for the opfamily? And 
     * if so, does it yield the right sorting semantics? 
     */ 
</span>    <a href="indxpath.c.html#LN2675"><span class='Ref_To_Local'>sortfamily</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN65"><span class='Ref_to_Proto'>get_op_opfamily_sortfamily</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2673"><span class='Ref_To_Local'>expr_op</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2669"><span class='Ref_To_Local'>opfamily</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN2675"><span class='Ref_To_Local'>sortfamily</span></a> <span class='Operator'>!= </span><a href="indxpath.c.html#LN2667"><span class='Ref_to_Parameter'>pk_opfamily</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* We have a match.  Return clause or a commuted version thereof. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN2676"><span class='Ref_To_Local'>commuted</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2730"></a>        <a href="../../../include/nodes/primnodes.h.html#LN491"><span class='Ref_to_Struct'>OpExpr</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>newclause</span> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN491"><span class='Ref_to_Struct'>OpExpr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* flat-copy all the fields of clause */ 
</span>        memcpy<span class='Parentheses'>(</span><a href="indxpath.c.html#LN2730"><span class='Ref_To_Local'>newclause</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2666"><span class='Ref_to_Parameter'>clause</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN491"><span class='Ref_to_Struct'>OpExpr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* commute it */ 
</span>        <a href="indxpath.c.html#LN2730"><span class='Ref_To_Local'>newclause</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN494"><span class='Ref_to_Member'>opno</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN2673"><span class='Ref_To_Local'>expr_op</span></a><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN2730"><span class='Ref_To_Local'>newclause</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN495"><span class='Ref_to_Member'>opfuncid</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN2730"><span class='Ref_To_Local'>newclause</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN500"><span class='Ref_to_Member'>args</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN139"><span class='Ref_to_Macro'>list_make2</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2672"><span class='Ref_To_Local'>rightop</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2671"><span class='Ref_To_Local'>leftop</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="indxpath.c.html#LN2666"><span class='Ref_to_Parameter'>clause</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN2730"><span class='Ref_To_Local'>newclause</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="indxpath.c.html#LN2666"><span class='Ref_to_Parameter'>clause</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end match_clause_to_ordering_op &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/**************************************************************************** 
 *              ----  ROUTINES TO DO PARTIAL INDEX PREDICATE TESTS  ---- 
 ****************************************************************************/ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * check_index_predicates 
 *      Set the predicate-derived IndexOptInfo fields for each index 
 *      of the specified relation. 
 * 
 * predOK is set true if the index is partial and its predicate is satisfied 
 * for this query, ie the query's WHERE clauses imply the predicate. 
 * 
 * indrestrictinfo is set to the relation's baserestrictinfo list less any 
 * conditions that are implied by the index's predicate.  (Obviously, for a 
 * non-partial index, this is the same as baserestrictinfo.)  Such conditions 
 * can be dropped from the plan when using the index, in certain cases. 
 * 
 * At one time it was possible for this to get re-run after adding more 
 * restrictions to the rel, thus possibly letting us prove more indexes OK. 
 * That doesn't happen any more (at least not in the core code's usage), 
 * but this code still supports it in case extensions want to mess with the 
 * baserestrictinfo list.  We assume that adding more restrictions can't make 
 * an index not predOK.  We must recompute indrestrictinfo each time, though, 
 * to make sure any newly-added restrictions get into it if needed. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN2773"></a><span class='Declare_Function'>check_index_predicates</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2775"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>clauselist</span><span class='Delimiter'>; 
</span><a name="LN2776"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>have_partial</span><span class='Delimiter'>; 
</span><a name="LN2777"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>is_target_rel</span><span class='Delimiter'>; 
</span><a name="LN2778"></a>    <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a>      <span class='Declare_Local'>otherrels</span><span class='Delimiter'>; 
</span><a name="LN2779"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Indexes are available only on base or "other" member relations. */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN504"><span class='Ref_to_Macro'>IS_SIMPLE_REL</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2773"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Initialize the indrestrictinfo lists to be identical to 
     * baserestrictinfo, and check whether there are any partial indexes.  If 
     * not, this is all we need to do. 
     */ 
</span>    <a href="indxpath.c.html#LN2776"><span class='Ref_To_Local'>have_partial</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2779"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2773"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN561"><span class='Ref_to_Member'>indexlist</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2792"></a>        <a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>index</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2779"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="indxpath.c.html#LN2792"><span class='Ref_To_Local'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN657"><span class='Ref_to_Member'>indrestrictinfo</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN2773"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN583"><span class='Ref_to_Member'>baserestrictinfo</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN2792"><span class='Ref_To_Local'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN653"><span class='Ref_to_Member'>indpred</span></a><span class='Parentheses'>) 
</span>            <a href="indxpath.c.html#LN2776"><span class='Ref_To_Local'>have_partial</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="indxpath.c.html#LN2776"><span class='Ref_To_Local'>have_partial</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Construct a list of clauses that we can assume true for the purpose of 
     * proving the index(es) usable.  Restriction clauses for the rel are 
     * always usable, and so are any join clauses that are "movable to" this 
     * rel.  Also, we can consider any EC-derivable join clauses (which must 
     * be "movable to" this rel, by definition). 
     */ 
</span>    <a href="indxpath.c.html#LN2775"><span class='Ref_To_Local'>clauselist</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN268"><span class='Ref_to_Proto'>list_copy</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2773"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN583"><span class='Ref_to_Member'>baserestrictinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Scan the rel's join clauses */ 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2779"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2773"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN588"><span class='Ref_to_Member'>joininfo</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2813"></a>        <a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rinfo</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2779"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Check if clause can be moved to this rel */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/optimizer/restrictinfo.h.html#LN40"><span class='Ref_to_Proto'>join_clause_is_movable_to</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2813"><span class='Ref_To_Local'>rinfo</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2773"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <a href="indxpath.c.html#LN2775"><span class='Ref_To_Local'>clauselist</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2775"><span class='Ref_To_Local'>clauselist</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2813"><span class='Ref_To_Local'>rinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Add on any equivalence-derivable join clauses.  Computing the correct 
     * relid sets for generate_join_implied_equalities is slightly tricky 
     * because the rel could be a child rel rather than a true baserel, and in 
     * that case we must remove its parents' relid(s) from all_baserels. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN2773"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN521"><span class='Ref_to_Member'>reloptkind</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/relation.h.html#LN495"><span class='Ref_to_EnumConst'>RELOPT_OTHER_MEMBER_REL</span></a><span class='Parentheses'>) 
</span>        <a href="indxpath.c.html#LN2778"><span class='Ref_To_Local'>otherrels</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN72"><span class='Ref_to_Proto'>bms_difference</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2773"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN195"><span class='Ref_to_Member'>all_baserels</span></a><span class='Delimiter'>, 
</span>                                   <a href="../../../include/optimizer/pathnode.h.html#LN274"><span class='Ref_to_Proto'>find_childrel_parents</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2773"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2773"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="indxpath.c.html#LN2778"><span class='Ref_To_Local'>otherrels</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN72"><span class='Ref_to_Proto'>bms_difference</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2773"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN195"><span class='Ref_to_Member'>all_baserels</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2773"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN524"><span class='Ref_to_Member'>relids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/bitmapset.h.html#LN85"><span class='Ref_to_Proto'>bms_is_empty</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2778"><span class='Ref_To_Local'>otherrels</span></a><span class='Parentheses'>))</span> 
        <a href="indxpath.c.html#LN2775"><span class='Ref_To_Local'>clauselist</span></a> <span class='Operator'>= 
</span>            <a href="../../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2775"><span class='Ref_To_Local'>clauselist</span></a><span class='Delimiter'>, 
</span>                        <a href="../../../include/optimizer/paths.h.html#LN139"><span class='Ref_to_Proto'>generate_join_implied_equalities</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2773"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                                       <a href="../../../include/nodes/bitmapset.h.html#LN70"><span class='Ref_to_Proto'>bms_union</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2773"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN524"><span class='Ref_to_Member'>relids</span></a><span class='Delimiter'>, 
</span>                                                                 <a href="indxpath.c.html#LN2778"><span class='Ref_To_Local'>otherrels</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                         <a href="indxpath.c.html#LN2778"><span class='Ref_To_Local'>otherrels</span></a><span class='Delimiter'>, 
</span>                                                         <a href="indxpath.c.html#LN2773"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Normally we remove quals that are implied by a partial index's 
     * predicate from indrestrictinfo, indicating that they need not be 
     * checked explicitly by an indexscan plan using this index.  However, if 
     * the rel is a target relation of UPDATE/DELETE/SELECT FOR UPDATE, we 
     * cannot remove such quals from the plan, because they need to be in the 
     * plan so that they will be properly rechecked by EvalPlanQual testing. 
     * Some day we might want to remove such quals from the main plan anyway 
     * and pass them through to EvalPlanQual via a side channel; but for now, 
     * we just don't remove implied quals at all for target relations. 
     */ 
</span>    <a href="indxpath.c.html#LN2777"><span class='Ref_To_Local'>is_target_rel</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2773"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN552"><span class='Ref_to_Member'>relid</span></a> <span class='Operator'>== </span><a href="indxpath.c.html#LN2773"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN119"><span class='Ref_to_Member'>resultRelation</span></a> <span class='Operator'>|| 
</span>                     <a href="../../../include/optimizer/prep.h.html#LN45"><span class='Ref_to_Proto'>get_plan_rowmark</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2773"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN255"><span class='Ref_to_Member'>rowMarks</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2773"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN552"><span class='Ref_to_Member'>relid</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now try to prove each index predicate true, and compute the 
     * indrestrictinfo lists for partial indexes.  Note that we compute the 
     * indrestrictinfo list even for non-predOK indexes; this might seem 
     * wasteful, but we may be able to use such indexes in OR clauses, cf 
     * generate_bitmap_or_paths(). 
     */ 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2779"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2773"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN561"><span class='Ref_to_Member'>indexlist</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2866"></a>        <a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>index</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2779"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2867"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lcr</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN2866"><span class='Ref_To_Local'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN653"><span class='Ref_to_Member'>indpred</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* ignore non-partial indexes here */ 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="indxpath.c.html#LN2866"><span class='Ref_To_Local'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN662"><span class='Ref_to_Member'>predOK</span></a><span class='Parentheses'>)</span>     <span class='Comment_Single_Line'>/* don't repeat work if already proven OK */ 
</span>            <a href="indxpath.c.html#LN2866"><span class='Ref_To_Local'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN662"><span class='Ref_to_Member'>predOK</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/predtest.h.html#LN19"><span class='Ref_to_Proto'>predicate_implied_by</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2866"><span class='Ref_To_Local'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN653"><span class='Ref_to_Member'>indpred</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2775"><span class='Ref_To_Local'>clauselist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* If rel is an update target, leave indrestrictinfo as set above */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN2777"><span class='Ref_To_Local'>is_target_rel</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Else compute indrestrictinfo as the non-implied quals */ 
</span>        <a href="indxpath.c.html#LN2866"><span class='Ref_To_Local'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN657"><span class='Ref_to_Member'>indrestrictinfo</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2867"><span class='Ref_To_Local'>lcr</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2773"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN583"><span class='Ref_to_Member'>baserestrictinfo</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2883"></a>            <a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rinfo</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2867"><span class='Ref_To_Local'>lcr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* predicate_implied_by() assumes first arg is immutable */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/optimizer/clauses.h.html#LN59"><span class='Ref_to_Proto'>contain_mutable_functions</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN2883"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1746"><span class='Ref_to_Member'>clause</span></a><span class='Parentheses'>)</span> <span class='Operator'>|| 
</span>                <span class='Operator'>!</span><a href="../../../include/optimizer/predtest.h.html#LN19"><span class='Ref_to_Proto'>predicate_implied_by</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN138"><span class='Ref_to_Macro'>list_make1</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2883"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1746"><span class='Ref_to_Member'>clause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                      <a href="indxpath.c.html#LN2866"><span class='Ref_To_Local'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN653"><span class='Ref_to_Member'>indpred</span></a><span class='Parentheses'>))</span> 
                <a href="indxpath.c.html#LN2866"><span class='Ref_To_Local'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN657"><span class='Ref_to_Member'>indrestrictinfo</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2866"><span class='Ref_To_Local'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN657"><span class='Ref_to_Member'>indrestrictinfo</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2883"><span class='Ref_To_Local'>rinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end check_index_predicates &raquo; </span> 
 
<span class='Comment_Multi_Line'>/**************************************************************************** 
 *              ----  ROUTINES TO CHECK EXTERNALLY-VISIBLE CONDITIONS  ---- 
 ****************************************************************************/ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * ec_member_matches_indexcol 
 *    Test whether an EquivalenceClass member matches an index column. 
 * 
 * This is a callback for use by generate_implied_equalities_for_column. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN2905"></a><span class='Declare_Function'>ec_member_matches_indexcol</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN2906"></a>                           <a href="../../../include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ec</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>em</span><span class='Delimiter'>, 
</span><a name="LN2907"></a>                           <span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2909"></a>    <a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>index</span> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="indxpath.c.html#LN74"><span class='Ref_to_Typedef'>ec_member_matches_arg</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN2907"><span class='Ref_to_Parameter'>arg</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>index<span class='Delimiter'>; 
</span><a name="LN2910"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>indexcol</span> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="indxpath.c.html#LN74"><span class='Ref_to_Typedef'>ec_member_matches_arg</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN2907"><span class='Ref_to_Parameter'>arg</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>indexcol<span class='Delimiter'>; 
</span><a name="LN2911"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>curFamily</span> <span class='Operator'>= </span><a href="indxpath.c.html#LN2909"><span class='Ref_To_Local'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN643"><span class='Ref_to_Member'>opfamily</span></a><span class='Delimiter'>[</span><a href="indxpath.c.html#LN2910"><span class='Ref_To_Local'>indexcol</span></a><span class='Delimiter'>]; 
</span><a name="LN2912"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>curCollation</span> <span class='Operator'>= </span><a href="indxpath.c.html#LN2909"><span class='Ref_To_Local'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN642"><span class='Ref_to_Member'>indexcollations</span></a><span class='Delimiter'>[</span><a href="indxpath.c.html#LN2910"><span class='Ref_To_Local'>indexcol</span></a><span class='Delimiter'>]; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If it's a btree index, we can reject it if its opfamily isn't 
     * compatible with the EC, since no clause generated from the EC could be 
     * used with the index.  For non-btree indexes, we can't easily tell 
     * whether clauses generated from the EC could be used with the index, so 
     * don't check the opfamily.  This might mean we return "true" for a 
     * useless EC, so we have to recheck the results of 
     * generate_implied_equalities_for_column; see 
     * match_eclass_clauses_to_index. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN2909"><span class='Ref_To_Local'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN650"><span class='Ref_to_Member'>relam</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_am.h.html#LN69"><span class='Ref_to_Const'>BTREE_AM_OID</span></a> <span class='Operator'>&& 
</span>        <span class='Operator'>!</span><a href="../../../include/nodes/pg_list.h.html#LN231"><span class='Ref_to_Proto'>list_member_oid</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2906"><span class='Ref_to_Parameter'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN770"><span class='Ref_to_Member'>ec_opfamilies</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2911"><span class='Ref_To_Local'>curFamily</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* We insist on collation match for all index types, though */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="indxpath.c.html#LN45"><span class='Ref_to_Macro'>IndexCollMatchesExprColl</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2912"><span class='Ref_To_Local'>curCollation</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2906"><span class='Ref_to_Parameter'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN771"><span class='Ref_to_Member'>ec_collation</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../../include/optimizer/paths.h.html#LN75"><span class='Ref_to_Proto'>match_index_to_operand</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN2906"><span class='Ref_to_Parameter'>em</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN820"><span class='Ref_to_Member'>em_expr</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2910"><span class='Ref_To_Local'>indexcol</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2909"><span class='Ref_To_Local'>index</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ec_member_matches_indexcol &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * relation_has_unique_index_for 
 *    Determine whether the relation provably has at most one row satisfying 
 *    a set of equality conditions, because the conditions constrain all 
 *    columns of some unique index. 
 * 
 * The conditions can be represented in either or both of two ways: 
 * 1. A list of RestrictInfo nodes, where the caller has already determined 
 * that each condition is a mergejoinable equality with an expression in 
 * this relation on one side, and an expression not involving this relation 
 * on the other.  The transient outer_is_left flag is used to identify which 
 * side we should look at: left side if outer_is_left is false, right side 
 * if it is true. 
 * 2. A list of expressions in this relation, and a corresponding list of 
 * equality operators. The caller must have already checked that the operators 
 * represent equality.  (Note: the operators could be cross-type; the 
 * expressions should correspond to their RHS inputs.) 
 * 
 * The caller need only supply equality conditions arising from joins; 
 * this routine automatically adds in any usable baserestrictinfo clauses. 
 * (Note that the passed-in restrictlist will be destructively modified!) 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN2958"></a><span class='Declare_Function'>relation_has_unique_index_for</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN2959"></a>                              <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>restrictlist</span><span class='Delimiter'>, 
</span><a name="LN2960"></a>                              <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>exprlist</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>oprlist</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2962"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>ic</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2960"><span class='Ref_to_Parameter'>exprlist</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2960"><span class='Ref_to_Parameter'>oprlist</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Short-circuit if no indexes... */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN2958"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN561"><span class='Ref_to_Member'>indexlist</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Examine the rel's restriction clauses for usable var = const clauses 
     * that we can add to the restrictlist. 
     */ 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2962"><span class='Ref_To_Local'>ic</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2958"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN583"><span class='Ref_to_Member'>baserestrictinfo</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2976"></a>        <a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>restrictinfo</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2962"><span class='Ref_To_Local'>ic</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Note: can_join won't be set for a restriction clause, but 
         * mergeopfamilies will be if it has a mergejoinable operator and 
         * doesn't contain volatile functions. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN2976"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1791"><span class='Ref_to_Member'>mergeopfamilies</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* not mergejoinable */ 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * The clause certainly doesn't refer to anything but the given rel. 
         * If either side is pseudoconstant then we can use it. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/bitmapset.h.html#LN85"><span class='Ref_to_Proto'>bms_is_empty</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2976"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1773"><span class='Ref_to_Member'>left_relids</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* righthand side is inner */ 
</span>            <a href="indxpath.c.html#LN2976"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1801"><span class='Ref_to_Member'>outer_is_left</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/bitmapset.h.html#LN85"><span class='Ref_to_Proto'>bms_is_empty</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2976"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1774"><span class='Ref_to_Member'>right_relids</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* lefthand side is inner */ 
</span>            <a href="indxpath.c.html#LN2976"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1801"><span class='Ref_to_Member'>outer_is_left</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* OK, add to list */ 
</span>        <a href="indxpath.c.html#LN2959"><span class='Ref_to_Parameter'>restrictlist</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2959"><span class='Ref_to_Parameter'>restrictlist</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2976"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Short-circuit the easy case */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN2959"><span class='Ref_to_Parameter'>restrictlist</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a> <span class='Operator'>&& </span><a href="indxpath.c.html#LN2960"><span class='Ref_to_Parameter'>exprlist</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Examine each index of the relation ... */ 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2962"><span class='Ref_To_Local'>ic</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2958"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN561"><span class='Ref_to_Member'>indexlist</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3014"></a>        <a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ind</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN2962"><span class='Ref_To_Local'>ic</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3015"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>c</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If the index is not unique, or not immediately enforced, or if it's 
         * a partial index that doesn't match the query, it's useless here. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="indxpath.c.html#LN3014"><span class='Ref_To_Local'>ind</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN663"><span class='Ref_to_Member'>unique</span></a> <span class='Operator'>|| !</span><a href="indxpath.c.html#LN3014"><span class='Ref_To_Local'>ind</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN664"><span class='Ref_to_Member'>immediate</span></a> <span class='Operator'>|| 
</span>            <span class='Parentheses'>(</span><a href="indxpath.c.html#LN3014"><span class='Ref_To_Local'>ind</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN653"><span class='Ref_to_Member'>indpred</span></a> <span class='Operator'>!= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a> <span class='Operator'>&& !</span><a href="indxpath.c.html#LN3014"><span class='Ref_To_Local'>ind</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN662"><span class='Ref_to_Member'>predOK</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Try to find each index column in the lists of conditions.  This is 
         * O(N^2) or worse, but we expect all the lists to be short. 
         */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN3015"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="indxpath.c.html#LN3015"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>&LT; </span><a href="indxpath.c.html#LN3014"><span class='Ref_To_Local'>ind</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN640"><span class='Ref_to_Member'>ncolumns</span></a><span class='Delimiter'>; </span><a href="indxpath.c.html#LN3015"><span class='Ref_To_Local'>c</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN3031"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>matched</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN3032"></a>            <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span><a name="LN3033"></a>            <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc2</span><span class='Delimiter'>; 
</span> 
            <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3032"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2959"><span class='Ref_to_Parameter'>restrictlist</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN3037"></a>                <a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rinfo</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3032"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3038"></a>                <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>rexpr</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * The condition's equality operator must be a member of the 
                 * index opfamily, else it is not asserting the right kind of 
                 * equality behavior for this index.  We check this first 
                 * since it's probably cheaper than match_index_to_operand(). 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/pg_list.h.html#LN231"><span class='Ref_to_Proto'>list_member_oid</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3037"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1791"><span class='Ref_to_Member'>mergeopfamilies</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3014"><span class='Ref_To_Local'>ind</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN643"><span class='Ref_to_Member'>opfamily</span></a><span class='Delimiter'>[</span><a href="indxpath.c.html#LN3015"><span class='Ref_To_Local'>c</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span> 
                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * XXX at some point we may need to check collations here too. 
                 * For the moment we assume all collations reduce to the same 
                 * notion of equality. 
                 */ 
</span> 
                <span class='Comment_Multi_Line'>/* OK, see if the condition operand matches the index key */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN3037"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1801"><span class='Ref_to_Member'>outer_is_left</span></a><span class='Parentheses'>) 
</span>                    <a href="indxpath.c.html#LN3038"><span class='Ref_To_Local'>rexpr</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/clauses.h.html#LN33"><span class='Ref_to_Proto'>get_rightop</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3037"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1746"><span class='Ref_to_Member'>clause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="indxpath.c.html#LN3038"><span class='Ref_To_Local'>rexpr</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/clauses.h.html#LN32"><span class='Ref_to_Proto'>get_leftop</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3037"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1746"><span class='Ref_to_Member'>clause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/optimizer/paths.h.html#LN75"><span class='Ref_to_Proto'>match_index_to_operand</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3038"><span class='Ref_To_Local'>rexpr</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3015"><span class='Ref_To_Local'>c</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3014"><span class='Ref_To_Local'>ind</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="indxpath.c.html#LN3031"><span class='Ref_To_Local'>matched</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* column is unique */ 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN3031"><span class='Ref_To_Local'>matched</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
            <a href="../../../include/nodes/pg_list.h.html#LN179"><span class='Ref_to_Macro'>forboth</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3032"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2960"><span class='Ref_to_Parameter'>exprlist</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3033"><span class='Ref_To_Local'>lc2</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN2960"><span class='Ref_to_Parameter'>oprlist</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN3073"></a>                <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>expr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3032"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3074"></a>                <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>opr</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3033"><span class='Ref_To_Local'>lc2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* See if the expression matches the index key */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/optimizer/paths.h.html#LN75"><span class='Ref_to_Proto'>match_index_to_operand</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3073"><span class='Ref_To_Local'>expr</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3015"><span class='Ref_To_Local'>c</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3014"><span class='Ref_To_Local'>ind</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * The equality operator must be a member of the index 
                 * opfamily, else it is not asserting the right kind of 
                 * equality behavior for this index.  We assume the caller 
                 * determined it is an equality operator, so we don't need to 
                 * check any more tightly than this. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../utils/cache/lsyscache.c.html#LN61"><span class='Ref_to_Func'>op_in_opfamily</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3074"><span class='Ref_To_Local'>opr</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3014"><span class='Ref_To_Local'>ind</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN643"><span class='Ref_to_Member'>opfamily</span></a><span class='Delimiter'>[</span><a href="indxpath.c.html#LN3015"><span class='Ref_To_Local'>c</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span> 
                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * XXX at some point we may need to check collations here too. 
                 * For the moment we assume all collations reduce to the same 
                 * notion of equality. 
                 */ 
</span> 
                <a href="indxpath.c.html#LN3031"><span class='Ref_To_Local'>matched</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* column is unique */ 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="indxpath.c.html#LN3031"><span class='Ref_To_Local'>matched</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>break</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* no match; this index doesn't help us */ 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for c=0;c&LT;ind-&GT;ncolumns;c... &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* Matched all columns of this index? */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN3015"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>== </span><a href="indxpath.c.html#LN3014"><span class='Ref_To_Local'>ind</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN640"><span class='Ref_to_Member'>ncolumns</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end relation_has_unique_index_for &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * indexcol_is_bool_constant_for_query 
 * 
 * If an index column is constrained to have a constant value by the query's 
 * WHERE conditions, then it's irrelevant for sort-order considerations. 
 * Usually that means we have a restriction clause WHERE indexcol = constant, 
 * which gets turned into an EquivalenceClass containing a constant, which 
 * is recognized as redundant by build_index_pathkeys().  But if the index 
 * column is a boolean variable (or expression), then we are not going to 
 * see WHERE indexcol = constant, because expression preprocessing will have 
 * simplified that to "WHERE indexcol" or "WHERE NOT indexcol".  So we are not 
 * going to have a matching EquivalenceClass (unless the query also contains 
 * "ORDER BY indexcol").  To allow such cases to work the same as they would 
 * for non-boolean values, this function is provided to detect whether the 
 * specified index column matches a boolean restriction clause. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN3129"></a><span class='Declare_Function'>indexcol_is_bool_constant_for_query</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>index</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>indexcol</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3131"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If the index isn't boolean, we can't possibly get a match */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="indxpath.c.html#LN42"><span class='Ref_to_Macro'>IsBooleanOpfamily</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3129"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN643"><span class='Ref_to_Member'>opfamily</span></a><span class='Delimiter'>[</span><a href="indxpath.c.html#LN3129"><span class='Ref_to_Parameter'>indexcol</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check each restriction clause for the index's rel */ 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3131"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3129"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN632"><span class='Ref_to_Member'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN583"><span class='Ref_to_Member'>baserestrictinfo</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3140"></a>        <a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rinfo</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3131"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * As in match_clause_to_indexcol, never match pseudoconstants to 
         * indexes.  (It might be semantically okay to do so here, but the 
         * odds of getting a match are negligible, so don't waste the cycles.) 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN3140"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1754"><span class='Ref_to_Member'>pseudoconstant</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* See if we can match the clause's expression to the index column */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN173"><span class='Ref_to_Proto'>match_boolean_index_clause</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN3140"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1746"><span class='Ref_to_Member'>clause</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3129"><span class='Ref_to_Parameter'>indexcol</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3129"><span class='Ref_to_Parameter'>index</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end indexcol_is_bool_constant_for_query &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/**************************************************************************** 
 *              ----  ROUTINES TO CHECK OPERANDS  ---- 
 ****************************************************************************/ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * match_index_to_operand() 
 *    Generalized test for a match between an index's key 
 *    and the operand on one side of a restriction or join clause. 
 * 
 * operand: the nodetree to be compared to the index 
 * indexcol: the column number of the index (counting from 0) 
 * index: the index of interest 
 * 
 * Note that we aren't interested in collations here; the caller must check 
 * for a collation match, if it's dealing with an operator where that matters. 
 * 
 * This is exported for use in selfuncs.c. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN3178"></a><span class='Declare_Function'>match_index_to_operand</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>operand</span><span class='Delimiter'>, 
</span><a name="LN3179"></a>                       <span class='Keyword'>int </span><span class='Declare_Parameter'>indexcol</span><span class='Delimiter'>, 
</span><a name="LN3180"></a>                       <a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>index</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3182"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>indkey</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Ignore any RelabelType node above the operand.   This is needed to be 
     * able to apply indexscanning in binary-compatible-operator cases. Note: 
     * we can assume there is at most one RelabelType node; 
     * eval_const_expressions() will have simplified if more than one. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN3178"><span class='Ref_to_Parameter'>operand</span></a> <span class='Operator'>&& </span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3178"><span class='Ref_to_Parameter'>operand</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN786"><span class='Ref_to_Struct'>RelabelType</span></a><span class='Parentheses'>))</span> 
        <a href="indxpath.c.html#LN3178"><span class='Ref_to_Parameter'>operand</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) ((</span><a href="../../../include/nodes/primnodes.h.html#LN786"><span class='Ref_to_Struct'>RelabelType</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN3178"><span class='Ref_to_Parameter'>operand</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>arg<span class='Delimiter'>; 
</span> 
    <a href="indxpath.c.html#LN3182"><span class='Ref_To_Local'>indkey</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN3180"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN641"><span class='Ref_to_Member'>indexkeys</span></a><span class='Delimiter'>[</span><a href="indxpath.c.html#LN3179"><span class='Ref_to_Parameter'>indexcol</span></a><span class='Delimiter'>]; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN3182"><span class='Ref_To_Local'>indkey</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Simple index column; operand must be a matching Var. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN3178"><span class='Ref_to_Parameter'>operand</span></a> <span class='Operator'>&& </span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3178"><span class='Ref_to_Parameter'>operand</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a><span class='Parentheses'>)</span> <span class='Operator'>&& 
</span>            <a href="indxpath.c.html#LN3180"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN632"><span class='Ref_to_Member'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN552"><span class='Ref_to_Member'>relid</span></a> <span class='Operator'>== </span><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN3178"><span class='Ref_to_Parameter'>operand</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>varno <span class='Operator'>&& 
</span>            <a href="indxpath.c.html#LN3182"><span class='Ref_To_Local'>indkey</span></a> <span class='Operator'>== </span><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN3178"><span class='Ref_to_Parameter'>operand</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>varattno<span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Index expression; find the correct expression.  (This search could 
         * be avoided, at the cost of complicating all the callers of this 
         * routine; doesn't seem worth it.) 
         */ 
</span><a name="LN3211"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>indexpr_item</span><span class='Delimiter'>; 
</span><a name="LN3212"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN3213"></a>        <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>indexkey</span><span class='Delimiter'>; 
</span> 
        <a href="indxpath.c.html#LN3211"><span class='Ref_To_Local'>indexpr_item</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN75"><span class='Ref_to_Func'>list_head</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3180"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN652"><span class='Ref_to_Member'>indexprs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN3212"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="indxpath.c.html#LN3212"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="indxpath.c.html#LN3179"><span class='Ref_to_Parameter'>indexcol</span></a><span class='Delimiter'>; </span><a href="indxpath.c.html#LN3212"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN3180"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN641"><span class='Ref_to_Member'>indexkeys</span></a><span class='Delimiter'>[</span><a href="indxpath.c.html#LN3212"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN3211"><span class='Ref_To_Local'>indexpr_item</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"wrong number of index expressions"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="indxpath.c.html#LN3211"><span class='Ref_To_Local'>indexpr_item</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3211"><span class='Ref_To_Local'>indexpr_item</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN3211"><span class='Ref_To_Local'>indexpr_item</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"wrong number of index expressions"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN3213"><span class='Ref_To_Local'>indexkey</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3211"><span class='Ref_To_Local'>indexpr_item</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Does it match the operand?  Again, strip any relabeling. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN3213"><span class='Ref_To_Local'>indexkey</span></a> <span class='Operator'>&& </span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3213"><span class='Ref_To_Local'>indexkey</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN786"><span class='Ref_to_Struct'>RelabelType</span></a><span class='Parentheses'>))</span> 
            <a href="indxpath.c.html#LN3213"><span class='Ref_To_Local'>indexkey</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) ((</span><a href="../../../include/nodes/primnodes.h.html#LN786"><span class='Ref_to_Struct'>RelabelType</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN3213"><span class='Ref_To_Local'>indexkey</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>arg<span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN626"><span class='Ref_to_Proto'>equal</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3213"><span class='Ref_To_Local'>indexkey</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3178"><span class='Ref_to_Parameter'>operand</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end match_index_to_operand &raquo; </span> 
 
<span class='Comment_Multi_Line'>/**************************************************************************** 
 *          ----  ROUTINES FOR "SPECIAL" INDEXABLE OPERATORS  ---- 
 ****************************************************************************/ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * These routines handle special optimization of operators that can be 
 * used with index scans even though they are not known to the executor's 
 * indexscan machinery.  The key idea is that these operators allow us 
 * to derive approximate indexscan qual clauses, such that any tuples 
 * that pass the operator clause itself must also satisfy the simpler 
 * indexscan condition(s).  Then we can use the indexscan machinery 
 * to avoid scanning as much of the table as we'd otherwise have to, 
 * while applying the original operator as a qpqual condition to ensure 
 * we deliver only the tuples we want.  (In essence, we're using a regular 
 * index as if it were a lossy index.) 
 * 
 * An example of what we're doing is 
 *          textfield LIKE 'abc%' 
 * from which we can generate the indexscanable conditions 
 *          textfield &GT;= 'abc' AND textfield &LT; 'abd' 
 * which allow efficient scanning of an index on textfield. 
 * (In reality, character set and collation issues make the transformation 
 * from LIKE to indexscan limits rather harder than one might think ... 
 * but that's the basic idea.) 
 * 
 * Another thing that we do with this machinery is to provide special 
 * smarts for "boolean" indexes (that is, indexes on boolean columns 
 * that support boolean equality).  We can transform a plain reference 
 * to the indexkey into "indexkey = true", or "NOT indexkey" into 
 * "indexkey = false", so as to make the expression indexable using the 
 * regular index operators.  (As of Postgres 8.1, we must do this here 
 * because constant simplification does the reverse transformation; 
 * without this code there'd be no way to use such an index at all.) 
 * 
 * Three routines are provided here: 
 * 
 * match_special_index_operator() is just an auxiliary function for 
 * match_clause_to_indexcol(); after the latter fails to recognize a 
 * restriction opclause's operator as a member of an index's opfamily, 
 * it asks match_special_index_operator() whether the clause should be 
 * considered an indexqual anyway. 
 * 
 * match_boolean_index_clause() similarly detects clauses that can be 
 * converted into boolean equality operators. 
 * 
 * expand_indexqual_conditions() converts a list of RestrictInfo nodes 
 * (with implicit AND semantics across list elements) into a list of clauses 
 * that the executor can actually handle.  For operators that are members of 
 * the index's opfamily this transformation is a no-op, but clauses recognized 
 * by match_special_index_operator() or match_boolean_index_clause() must be 
 * converted into one or more "regular" indexqual conditions. 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * match_boolean_index_clause 
 *    Recognize restriction clauses that can be matched to a boolean index. 
 * 
 * This should be called only when IsBooleanOpfamily() recognizes the 
 * index's operator family.  We check to see if the clause matches the 
 * index's key. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN3304"></a><span class='Declare_Function'>match_boolean_index_clause</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>clause</span><span class='Delimiter'>, 
</span><a name="LN3305"></a>                           <span class='Keyword'>int </span><span class='Declare_Parameter'>indexcol</span><span class='Delimiter'>, 
</span><a name="LN3306"></a>                           <a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>index</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Direct match? */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/optimizer/paths.h.html#LN75"><span class='Ref_to_Proto'>match_index_to_operand</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3304"><span class='Ref_to_Parameter'>clause</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3305"><span class='Ref_to_Parameter'>indexcol</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3306"><span class='Ref_to_Parameter'>index</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* NOT clause? */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/optimizer/clauses.h.html#LN35"><span class='Ref_to_Proto'>not_clause</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3304"><span class='Ref_to_Parameter'>clause</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/optimizer/paths.h.html#LN75"><span class='Ref_to_Proto'>match_index_to_operand</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>)</span> <a href="../../../include/optimizer/clauses.h.html#LN37"><span class='Ref_to_Proto'>get_notclausearg</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN3304"><span class='Ref_to_Parameter'>clause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                   <a href="indxpath.c.html#LN3305"><span class='Ref_to_Parameter'>indexcol</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3306"><span class='Ref_to_Parameter'>index</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Since we only consider clauses at top level of WHERE, we can convert 
     * indexkey IS TRUE and indexkey IS FALSE to index searches as well. The 
     * different meaning for NULL isn't important. 
     */ 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN3304"><span class='Ref_to_Parameter'>clause</span></a> <span class='Operator'>&& </span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3304"><span class='Ref_to_Parameter'>clause</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1198"><span class='Ref_to_Struct'>BooleanTest</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN3326"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1198"><span class='Ref_to_Struct'>BooleanTest</span></a> <span class='Operator'>*</span><span class='Declare_Local'>btest</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1198"><span class='Ref_to_Struct'>BooleanTest</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN3304"><span class='Ref_to_Parameter'>clause</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN3326"><span class='Ref_To_Local'>btest</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1202"><span class='Ref_to_Member'>booltesttype</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/primnodes.h.html#LN1195"><span class='Ref_to_EnumConst'>IS_TRUE</span></a> <span class='Operator'>|| 
</span>            <a href="indxpath.c.html#LN3326"><span class='Ref_To_Local'>btest</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1202"><span class='Ref_to_Member'>booltesttype</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/primnodes.h.html#LN1195"><span class='Ref_to_EnumConst'>IS_FALSE</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/optimizer/paths.h.html#LN75"><span class='Ref_to_Proto'>match_index_to_operand</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN3326"><span class='Ref_To_Local'>btest</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1201"><span class='Ref_to_Member'>arg</span></a><span class='Delimiter'>, 
</span>                                       <a href="indxpath.c.html#LN3305"><span class='Ref_to_Parameter'>indexcol</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3306"><span class='Ref_to_Parameter'>index</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end match_boolean_index_clause &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * match_special_index_operator 
 *    Recognize restriction clauses that can be used to generate 
 *    additional indexscanable qualifications. 
 * 
 * The given clause is already known to be a binary opclause having 
 * the form (indexkey OP pseudoconst) or (pseudoconst OP indexkey), 
 * but the OP proved not to be one of the index's opfamily operators. 
 * Return 'true' if we can do something with it anyway. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN3348"></a><span class='Declare_Function'>match_special_index_operator</span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>clause</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>opfamily</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>idxcollation</span><span class='Delimiter'>, 
</span><a name="LN3349"></a>                             <span class='Keyword'>bool </span><span class='Declare_Parameter'>indexkey_on_left</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3351"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isIndexable</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN3352"></a>    <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>rightop</span><span class='Delimiter'>; 
</span><a name="LN3353"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>expr_op</span><span class='Delimiter'>; 
</span><a name="LN3354"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>expr_coll</span><span class='Delimiter'>; 
</span><a name="LN3355"></a>    <a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>patt</span><span class='Delimiter'>; 
</span><a name="LN3356"></a>    <a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>prefix</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN3357"></a>    <a href="../../../include/utils/selfuncs.h.html#LN93"><span class='Ref_to_Typedef'>Pattern_Prefix_Status</span></a> <span class='Declare_Local'>pstatus</span> <span class='Operator'>= </span><a href="../../../include/utils/selfuncs.h.html#LN95"><span class='Ref_to_EnumConst'>Pattern_Prefix_None</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Currently, all known special operators require the indexkey on the 
     * left, but this test could be pushed into the switch statement if some 
     * are added that do not... 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="indxpath.c.html#LN3349"><span class='Ref_to_Parameter'>indexkey_on_left</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* we know these will succeed */ 
</span>    <a href="indxpath.c.html#LN3352"><span class='Ref_To_Local'>rightop</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/clauses.h.html#LN33"><span class='Ref_to_Proto'>get_rightop</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3348"><span class='Ref_to_Parameter'>clause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="indxpath.c.html#LN3353"><span class='Ref_To_Local'>expr_op</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN491"><span class='Ref_to_Struct'>OpExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN3348"><span class='Ref_to_Parameter'>clause</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>opno<span class='Delimiter'>; 
</span>    <a href="indxpath.c.html#LN3354"><span class='Ref_To_Local'>expr_coll</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN491"><span class='Ref_to_Struct'>OpExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN3348"><span class='Ref_to_Parameter'>clause</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>inputcollid<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* again, required for all current special ops: */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3352"><span class='Ref_To_Local'>rightop</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a><span class='Parentheses'>)</span> <span class='Operator'>|| 
</span>        <span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN3352"><span class='Ref_To_Local'>rightop</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>constisnull<span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="indxpath.c.html#LN3355"><span class='Ref_To_Local'>patt</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN3352"><span class='Ref_To_Local'>rightop</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN3353"><span class='Ref_To_Local'>expr_op</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN894"><span class='Ref_to_Const'>OID_TEXT_LIKE_OP</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN899"><span class='Ref_to_Const'>OID_BPCHAR_LIKE_OP</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN889"><span class='Ref_to_Const'>OID_NAME_LIKE_OP</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* the right-hand const is type text for all of these */ 
</span>            <a href="indxpath.c.html#LN3357"><span class='Ref_To_Local'>pstatus</span></a> <span class='Operator'>= </span><a href="../../../include/utils/selfuncs.h.html#LN176"><span class='Ref_to_Proto'>pattern_fixed_prefix</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3355"><span class='Ref_To_Local'>patt</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/selfuncs.h.html#LN89"><span class='Ref_to_EnumConst'>Pattern_Type_Like</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3354"><span class='Ref_To_Local'>expr_coll</span></a><span class='Delimiter'>, 
</span>                                           <span class='Operator'>&</span><a href="indxpath.c.html#LN3356"><span class='Ref_To_Local'>prefix</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="indxpath.c.html#LN3351"><span class='Ref_To_Local'>isIndexable</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3357"><span class='Ref_To_Local'>pstatus</span></a> <span class='Operator'>!= </span><a href="../../../include/utils/selfuncs.h.html#LN95"><span class='Ref_to_EnumConst'>Pattern_Prefix_None</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1400"><span class='Ref_to_Const'>OID_BYTEA_LIKE_OP</span></a><span class='Operator'>: 
</span>            <a href="indxpath.c.html#LN3357"><span class='Ref_To_Local'>pstatus</span></a> <span class='Operator'>= </span><a href="../../../include/utils/selfuncs.h.html#LN176"><span class='Ref_to_Proto'>pattern_fixed_prefix</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3355"><span class='Ref_To_Local'>patt</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/selfuncs.h.html#LN89"><span class='Ref_to_EnumConst'>Pattern_Type_Like</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3354"><span class='Ref_To_Local'>expr_coll</span></a><span class='Delimiter'>, 
</span>                                           <span class='Operator'>&</span><a href="indxpath.c.html#LN3356"><span class='Ref_To_Local'>prefix</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="indxpath.c.html#LN3351"><span class='Ref_To_Local'>isIndexable</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3357"><span class='Ref_To_Local'>pstatus</span></a> <span class='Operator'>!= </span><a href="../../../include/utils/selfuncs.h.html#LN95"><span class='Ref_to_EnumConst'>Pattern_Prefix_None</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1215"><span class='Ref_to_Const'>OID_TEXT_ICLIKE_OP</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1220"><span class='Ref_to_Const'>OID_BPCHAR_ICLIKE_OP</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1210"><span class='Ref_to_Const'>OID_NAME_ICLIKE_OP</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* the right-hand const is type text for all of these */ 
</span>            <a href="indxpath.c.html#LN3357"><span class='Ref_To_Local'>pstatus</span></a> <span class='Operator'>= </span><a href="../../../include/utils/selfuncs.h.html#LN176"><span class='Ref_to_Proto'>pattern_fixed_prefix</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3355"><span class='Ref_To_Local'>patt</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/selfuncs.h.html#LN89"><span class='Ref_to_EnumConst'>Pattern_Type_Like_IC</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3354"><span class='Ref_To_Local'>expr_coll</span></a><span class='Delimiter'>, 
</span>                                           <span class='Operator'>&</span><a href="indxpath.c.html#LN3356"><span class='Ref_To_Local'>prefix</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="indxpath.c.html#LN3351"><span class='Ref_To_Local'>isIndexable</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3357"><span class='Ref_To_Local'>pstatus</span></a> <span class='Operator'>!= </span><a href="../../../include/utils/selfuncs.h.html#LN95"><span class='Ref_to_EnumConst'>Pattern_Prefix_None</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN502"><span class='Ref_to_Const'>OID_TEXT_REGEXEQ_OP</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN758"><span class='Ref_to_Const'>OID_BPCHAR_REGEXEQ_OP</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN497"><span class='Ref_to_Const'>OID_NAME_REGEXEQ_OP</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* the right-hand const is type text for all of these */ 
</span>            <a href="indxpath.c.html#LN3357"><span class='Ref_To_Local'>pstatus</span></a> <span class='Operator'>= </span><a href="../../../include/utils/selfuncs.h.html#LN176"><span class='Ref_to_Proto'>pattern_fixed_prefix</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3355"><span class='Ref_To_Local'>patt</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/selfuncs.h.html#LN90"><span class='Ref_to_EnumConst'>Pattern_Type_Regex</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3354"><span class='Ref_To_Local'>expr_coll</span></a><span class='Delimiter'>, 
</span>                                           <span class='Operator'>&</span><a href="indxpath.c.html#LN3356"><span class='Ref_To_Local'>prefix</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="indxpath.c.html#LN3351"><span class='Ref_To_Local'>isIndexable</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3357"><span class='Ref_To_Local'>pstatus</span></a> <span class='Operator'>!= </span><a href="../../../include/utils/selfuncs.h.html#LN95"><span class='Ref_to_EnumConst'>Pattern_Prefix_None</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN911"><span class='Ref_to_Const'>OID_TEXT_ICREGEXEQ_OP</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN916"><span class='Ref_to_Const'>OID_BPCHAR_ICREGEXEQ_OP</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN906"><span class='Ref_to_Const'>OID_NAME_ICREGEXEQ_OP</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* the right-hand const is type text for all of these */ 
</span>            <a href="indxpath.c.html#LN3357"><span class='Ref_To_Local'>pstatus</span></a> <span class='Operator'>= </span><a href="../../../include/utils/selfuncs.h.html#LN176"><span class='Ref_to_Proto'>pattern_fixed_prefix</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3355"><span class='Ref_To_Local'>patt</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/selfuncs.h.html#LN90"><span class='Ref_to_EnumConst'>Pattern_Type_Regex_IC</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3354"><span class='Ref_To_Local'>expr_coll</span></a><span class='Delimiter'>, 
</span>                                           <span class='Operator'>&</span><a href="indxpath.c.html#LN3356"><span class='Ref_To_Local'>prefix</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="indxpath.c.html#LN3351"><span class='Ref_To_Local'>isIndexable</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3357"><span class='Ref_To_Local'>pstatus</span></a> <span class='Operator'>!= </span><a href="../../../include/utils/selfuncs.h.html#LN95"><span class='Ref_to_EnumConst'>Pattern_Prefix_None</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1178"><span class='Ref_to_Const'>OID_INET_SUB_OP</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1181"><span class='Ref_to_Const'>OID_INET_SUBEQ_OP</span></a><span class='Operator'>: 
</span>            <a href="indxpath.c.html#LN3351"><span class='Ref_To_Local'>isIndexable</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch expr_op &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN3356"><span class='Ref_To_Local'>prefix</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3356"><span class='Ref_To_Local'>prefix</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN195"><span class='Ref_to_Member'>constvalue</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3356"><span class='Ref_To_Local'>prefix</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* done if the expression doesn't look indexable */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="indxpath.c.html#LN3351"><span class='Ref_To_Local'>isIndexable</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Must also check that index's opfamily supports the operators we will 
     * want to apply.  (A hash index, for example, will not support "&GT;=".) 
     * Currently, only btree and spgist support the operators we need. 
     * 
     * Note: actually, in the Pattern_Prefix_Exact case, we only need "=" so a 
     * hash index would work.  Currently it doesn't seem worth checking for 
     * that, however. 
     * 
     * We insist on the opfamily being the specific one we expect, else we'd 
     * do the wrong thing if someone were to make a reverse-sort opfamily with 
     * the same operators. 
     * 
     * The non-pattern opclasses will not sort the way we need in most non-C 
     * locales.  We can use such an index anyway for an exact match (simple 
     * equality), but not for prefix-match cases.  Note that here we are 
     * looking at the index's collation, not the expression's collation -- 
     * this test is *not* dependent on the LIKE/regex operator's collation. 
     */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN3353"><span class='Ref_To_Local'>expr_op</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN894"><span class='Ref_to_Const'>OID_TEXT_LIKE_OP</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1215"><span class='Ref_to_Const'>OID_TEXT_ICLIKE_OP</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN502"><span class='Ref_to_Const'>OID_TEXT_REGEXEQ_OP</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN911"><span class='Ref_to_Const'>OID_TEXT_ICREGEXEQ_OP</span></a><span class='Operator'>: 
</span>            <a href="indxpath.c.html#LN3351"><span class='Ref_To_Local'>isIndexable</span></a> <span class='Operator'>= 
</span>                <span class='Parentheses'>(</span><a href="indxpath.c.html#LN3348"><span class='Ref_to_Parameter'>opfamily</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_opfamily.h.html#LN114"><span class='Ref_to_Const'>TEXT_PATTERN_BTREE_FAM_OID</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>                <span class='Parentheses'>(</span><a href="indxpath.c.html#LN3348"><span class='Ref_to_Parameter'>opfamily</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_opfamily.h.html#LN154"><span class='Ref_to_Const'>TEXT_SPGIST_FAM_OID</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>                <span class='Parentheses'>(</span><a href="indxpath.c.html#LN3348"><span class='Ref_to_Parameter'>opfamily</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_opfamily.h.html#LN104"><span class='Ref_to_Const'>TEXT_BTREE_FAM_OID</span></a> <span class='Operator'>&& 
</span>                 <span class='Parentheses'>(</span><a href="indxpath.c.html#LN3357"><span class='Ref_To_Local'>pstatus</span></a> <span class='Operator'>== </span><a href="../../../include/utils/selfuncs.h.html#LN95"><span class='Ref_to_EnumConst'>Pattern_Prefix_Exact</span></a> <span class='Operator'>|| 
</span>                  <a href="../../../include/utils/pg_locale.h.html#LN50"><span class='Ref_to_Proto'>lc_collate_is_c</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3348"><span class='Ref_to_Parameter'>idxcollation</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN899"><span class='Ref_to_Const'>OID_BPCHAR_LIKE_OP</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1220"><span class='Ref_to_Const'>OID_BPCHAR_ICLIKE_OP</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN758"><span class='Ref_to_Const'>OID_BPCHAR_REGEXEQ_OP</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN916"><span class='Ref_to_Const'>OID_BPCHAR_ICREGEXEQ_OP</span></a><span class='Operator'>: 
</span>            <a href="indxpath.c.html#LN3351"><span class='Ref_To_Local'>isIndexable</span></a> <span class='Operator'>= 
</span>                <span class='Parentheses'>(</span><a href="indxpath.c.html#LN3348"><span class='Ref_to_Parameter'>opfamily</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_opfamily.h.html#LN116"><span class='Ref_to_Const'>BPCHAR_PATTERN_BTREE_FAM_OID</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>                <span class='Parentheses'>(</span><a href="indxpath.c.html#LN3348"><span class='Ref_to_Parameter'>opfamily</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_opfamily.h.html#LN67"><span class='Ref_to_Const'>BPCHAR_BTREE_FAM_OID</span></a> <span class='Operator'>&& 
</span>                 <span class='Parentheses'>(</span><a href="indxpath.c.html#LN3357"><span class='Ref_To_Local'>pstatus</span></a> <span class='Operator'>== </span><a href="../../../include/utils/selfuncs.h.html#LN95"><span class='Ref_to_EnumConst'>Pattern_Prefix_Exact</span></a> <span class='Operator'>|| 
</span>                  <a href="../../../include/utils/pg_locale.h.html#LN50"><span class='Ref_to_Proto'>lc_collate_is_c</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3348"><span class='Ref_to_Parameter'>idxcollation</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN889"><span class='Ref_to_Const'>OID_NAME_LIKE_OP</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1210"><span class='Ref_to_Const'>OID_NAME_ICLIKE_OP</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN497"><span class='Ref_to_Const'>OID_NAME_REGEXEQ_OP</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN906"><span class='Ref_to_Const'>OID_NAME_ICREGEXEQ_OP</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* name uses locale-insensitive sorting */ 
</span>            <a href="indxpath.c.html#LN3351"><span class='Ref_To_Local'>isIndexable</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3348"><span class='Ref_to_Parameter'>opfamily</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_opfamily.h.html#LN92"><span class='Ref_to_Const'>NAME_BTREE_FAM_OID</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1400"><span class='Ref_to_Const'>OID_BYTEA_LIKE_OP</span></a><span class='Operator'>: 
</span>            <a href="indxpath.c.html#LN3351"><span class='Ref_To_Local'>isIndexable</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3348"><span class='Ref_to_Parameter'>opfamily</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_opfamily.h.html#LN70"><span class='Ref_to_Const'>BYTEA_BTREE_FAM_OID</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1178"><span class='Ref_to_Const'>OID_INET_SUB_OP</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1181"><span class='Ref_to_Const'>OID_INET_SUBEQ_OP</span></a><span class='Operator'>: 
</span>            <a href="indxpath.c.html#LN3351"><span class='Ref_To_Local'>isIndexable</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3348"><span class='Ref_to_Parameter'>opfamily</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_opfamily.h.html#LN78"><span class='Ref_to_Const'>NETWORK_BTREE_FAM_OID</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch expr_op &raquo; </span> 
 
    <span class='Control'>return</span> <a href="indxpath.c.html#LN3351"><span class='Ref_To_Local'>isIndexable</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end match_special_index_operator &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * expand_indexqual_conditions 
 *    Given a list of RestrictInfo nodes, produce a list of directly usable 
 *    index qual clauses. 
 * 
 * Standard qual clauses (those in the index's opfamily) are passed through 
 * unchanged.  Boolean clauses and "special" index operators are expanded 
 * into clauses that the indexscan machinery will know what to do with. 
 * RowCompare clauses are simplified if necessary to create a clause that is 
 * fully checkable by the index. 
 * 
 * In addition to the expressions themselves, there are auxiliary lists 
 * of the index column numbers that the clauses are meant to be used with; 
 * we generate an updated column number list for the result.  (This is not 
 * the identical list because one input clause sometimes produces more than 
 * one output clause.) 
 * 
 * The input clauses are sorted by column number, and so the output is too. 
 * (This is depended on in various places in both planner and executor.) 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN3524"></a><span class='Declare_Function'>expand_indexqual_conditions</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>index</span><span class='Delimiter'>, 
</span><a name="LN3525"></a>                            <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>indexclauses</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>indexclausecols</span><span class='Delimiter'>, 
</span><a name="LN3526"></a>                            <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>indexquals_p</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>indexqualcols_p</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3528"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>indexquals</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN3529"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>indexqualcols</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN3530"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lcc</span><span class='Delimiter'>, 
</span><a name="LN3531"></a>               <span class='Operator'>*</span><span class='Declare_Local'>lci</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN179"><span class='Ref_to_Macro'>forboth</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3530"><span class='Ref_To_Local'>lcc</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3525"><span class='Ref_to_Parameter'>indexclauses</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3531"><span class='Ref_To_Local'>lci</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3525"><span class='Ref_to_Parameter'>indexclausecols</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3535"></a>        <a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rinfo</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3530"><span class='Ref_To_Local'>lcc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3536"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>indexcol</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN106"><span class='Ref_to_Macro'>lfirst_int</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3531"><span class='Ref_To_Local'>lci</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3537"></a>        <a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>clause</span> <span class='Operator'>= </span><a href="indxpath.c.html#LN3535"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1746"><span class='Ref_to_Member'>clause</span></a><span class='Delimiter'>; 
</span><a name="LN3538"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>curFamily</span> <span class='Operator'>= </span><a href="indxpath.c.html#LN3524"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN643"><span class='Ref_to_Member'>opfamily</span></a><span class='Delimiter'>[</span><a href="indxpath.c.html#LN3536"><span class='Ref_To_Local'>indexcol</span></a><span class='Delimiter'>]; 
</span><a name="LN3539"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>curCollation</span> <span class='Operator'>= </span><a href="indxpath.c.html#LN3524"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN642"><span class='Ref_to_Member'>indexcollations</span></a><span class='Delimiter'>[</span><a href="indxpath.c.html#LN3536"><span class='Ref_To_Local'>indexcol</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Comment_Multi_Line'>/* First check for boolean cases */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN42"><span class='Ref_to_Macro'>IsBooleanOpfamily</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3538"><span class='Ref_To_Local'>curFamily</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN3544"></a>            <a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>boolqual</span><span class='Delimiter'>; 
</span> 
            <a href="indxpath.c.html#LN3544"><span class='Ref_To_Local'>boolqual</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN178"><span class='Ref_to_Proto'>expand_boolean_index_clause</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN3537"><span class='Ref_To_Local'>clause</span></a><span class='Delimiter'>, 
</span>                                                   <a href="indxpath.c.html#LN3536"><span class='Ref_To_Local'>indexcol</span></a><span class='Delimiter'>, 
</span>                                                   <a href="indxpath.c.html#LN3524"><span class='Ref_to_Parameter'>index</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN3544"><span class='Ref_To_Local'>boolqual</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="indxpath.c.html#LN3528"><span class='Ref_To_Local'>indexquals</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3528"><span class='Ref_To_Local'>indexquals</span></a><span class='Delimiter'>, 
</span>                                     <a href="../../../include/optimizer/restrictinfo.h.html#LN20"><span class='Ref_to_Macro'>make_simple_restrictinfo</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3544"><span class='Ref_To_Local'>boolqual</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="indxpath.c.html#LN3529"><span class='Ref_To_Local'>indexqualcols</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN144"><span class='Ref_to_Func'>lappend_int</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3529"><span class='Ref_To_Local'>indexqualcols</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3536"><span class='Ref_To_Local'>indexcol</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Else it must be an opclause (usual case), ScalarArrayOp, 
         * RowCompare, or NullTest 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/optimizer/clauses.h.html#LN19"><span class='Ref_to_Macro'>is_opclause</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3537"><span class='Ref_To_Local'>clause</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="indxpath.c.html#LN3528"><span class='Ref_To_Local'>indexquals</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3528"><span class='Ref_To_Local'>indexquals</span></a><span class='Delimiter'>, 
</span>                                     <a href="indxpath.c.html#LN180"><span class='Ref_to_Proto'>expand_indexqual_opclause</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3535"><span class='Ref_To_Local'>rinfo</span></a><span class='Delimiter'>, 
</span>                                                               <a href="indxpath.c.html#LN3538"><span class='Ref_To_Local'>curFamily</span></a><span class='Delimiter'>, 
</span>                                                               <a href="indxpath.c.html#LN3539"><span class='Ref_To_Local'>curCollation</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* expand_indexqual_opclause can produce multiple clauses */ 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3529"><span class='Ref_To_Local'>indexqualcols</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3528"><span class='Ref_To_Local'>indexquals</span></a><span class='Parentheses'>))</span> 
                <a href="indxpath.c.html#LN3529"><span class='Ref_To_Local'>indexqualcols</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN144"><span class='Ref_to_Func'>lappend_int</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3529"><span class='Ref_To_Local'>indexqualcols</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3536"><span class='Ref_To_Local'>indexcol</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3537"><span class='Ref_To_Local'>clause</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN534"><span class='Ref_to_Struct'>ScalarArrayOpExpr</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* no extra work at this time */ 
</span>            <a href="indxpath.c.html#LN3528"><span class='Ref_To_Local'>indexquals</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3528"><span class='Ref_To_Local'>indexquals</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3535"><span class='Ref_To_Local'>rinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="indxpath.c.html#LN3529"><span class='Ref_To_Local'>indexqualcols</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN144"><span class='Ref_to_Func'>lappend_int</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3529"><span class='Ref_To_Local'>indexqualcols</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3536"><span class='Ref_To_Local'>indexcol</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3537"><span class='Ref_To_Local'>clause</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1026"><span class='Ref_to_Struct'>RowCompareExpr</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="indxpath.c.html#LN3528"><span class='Ref_To_Local'>indexquals</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3528"><span class='Ref_To_Local'>indexquals</span></a><span class='Delimiter'>, 
</span>                                 <a href="indxpath.c.html#LN182"><span class='Ref_to_Proto'>expand_indexqual_rowcompare</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3535"><span class='Ref_To_Local'>rinfo</span></a><span class='Delimiter'>, 
</span>                                                             <a href="indxpath.c.html#LN3524"><span class='Ref_to_Parameter'>index</span></a><span class='Delimiter'>, 
</span>                                                             <a href="indxpath.c.html#LN3536"><span class='Ref_To_Local'>indexcol</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="indxpath.c.html#LN3529"><span class='Ref_To_Local'>indexqualcols</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN144"><span class='Ref_to_Func'>lappend_int</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3529"><span class='Ref_To_Local'>indexqualcols</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3536"><span class='Ref_To_Local'>indexcol</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3537"><span class='Ref_To_Local'>clause</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1175"><span class='Ref_to_Struct'>NullTest</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3524"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN671"><span class='Ref_to_Member'>amsearchnulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="indxpath.c.html#LN3528"><span class='Ref_To_Local'>indexquals</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3528"><span class='Ref_To_Local'>indexquals</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3535"><span class='Ref_To_Local'>rinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="indxpath.c.html#LN3529"><span class='Ref_To_Local'>indexqualcols</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN144"><span class='Ref_to_Func'>lappend_int</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3529"><span class='Ref_To_Local'>indexqualcols</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3536"><span class='Ref_To_Local'>indexcol</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unsupported indexqual type: %d"</span><span class='Delimiter'>, 
</span>                 <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="../../../include/nodes/nodes.h.html#LN513"><span class='Ref_to_Macro'>nodeTag</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3537"><span class='Ref_To_Local'>clause</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Operator'>*</span><a href="indxpath.c.html#LN3526"><span class='Ref_to_Parameter'>indexquals_p</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN3528"><span class='Ref_To_Local'>indexquals</span></a><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="indxpath.c.html#LN3526"><span class='Ref_to_Parameter'>indexqualcols_p</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN3529"><span class='Ref_To_Local'>indexqualcols</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end expand_indexqual_conditions &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * expand_boolean_index_clause 
 *    Convert a clause recognized by match_boolean_index_clause into 
 *    a boolean equality operator clause. 
 * 
 * Returns NULL if the clause isn't a boolean index qual. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>* 
</span><a name="LN3609"></a><span class='Declare_Function'>expand_boolean_index_clause</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>clause</span><span class='Delimiter'>, 
</span><a name="LN3610"></a>                            <span class='Keyword'>int </span><span class='Declare_Parameter'>indexcol</span><span class='Delimiter'>, 
</span><a name="LN3611"></a>                            <a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>index</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Direct match? */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/optimizer/paths.h.html#LN75"><span class='Ref_to_Proto'>match_index_to_operand</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3609"><span class='Ref_to_Parameter'>clause</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3610"><span class='Ref_to_Parameter'>indexcol</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3611"><span class='Ref_to_Parameter'>index</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* convert to indexkey = TRUE */ 
</span>        <span class='Control'>return</span> <a href="../../../include/optimizer/clauses.h.html#LN29"><span class='Ref_to_Proto'>make_opclause</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_operator.h.html#LN113"><span class='Ref_to_Const'>BooleanEqualOperator</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN17"><span class='Ref_to_Const'>BOOLOID</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                             <span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN3609"><span class='Ref_to_Parameter'>clause</span></a><span class='Delimiter'>, 
</span>                             <span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/makefuncs.h.html#LN59"><span class='Ref_to_Proto'>makeBoolConst</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Comment_Multi_Line'>/* NOT clause? */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/optimizer/clauses.h.html#LN35"><span class='Ref_to_Proto'>not_clause</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3609"><span class='Ref_to_Parameter'>clause</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN3625"></a>        <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>arg</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/optimizer/clauses.h.html#LN37"><span class='Ref_to_Proto'>get_notclausearg</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN3609"><span class='Ref_to_Parameter'>clause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* It must have matched the indexkey */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/optimizer/paths.h.html#LN75"><span class='Ref_to_Proto'>match_index_to_operand</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3625"><span class='Ref_To_Local'>arg</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3610"><span class='Ref_to_Parameter'>indexcol</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3611"><span class='Ref_to_Parameter'>index</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* convert to indexkey = FALSE */ 
</span>        <span class='Control'>return</span> <a href="../../../include/optimizer/clauses.h.html#LN29"><span class='Ref_to_Proto'>make_opclause</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_operator.h.html#LN113"><span class='Ref_to_Const'>BooleanEqualOperator</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN17"><span class='Ref_to_Const'>BOOLOID</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                             <span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN3625"><span class='Ref_To_Local'>arg</span></a><span class='Delimiter'>, 
</span>                             <span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/makefuncs.h.html#LN59"><span class='Ref_to_Proto'>makeBoolConst</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN3609"><span class='Ref_to_Parameter'>clause</span></a> <span class='Operator'>&& </span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3609"><span class='Ref_to_Parameter'>clause</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1198"><span class='Ref_to_Struct'>BooleanTest</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN3637"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1198"><span class='Ref_to_Struct'>BooleanTest</span></a> <span class='Operator'>*</span><span class='Declare_Local'>btest</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1198"><span class='Ref_to_Struct'>BooleanTest</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN3609"><span class='Ref_to_Parameter'>clause</span></a><span class='Delimiter'>; 
</span><a name="LN3638"></a>        <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>arg</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN3637"><span class='Ref_To_Local'>btest</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1201"><span class='Ref_to_Member'>arg</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* It must have matched the indexkey */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/optimizer/paths.h.html#LN75"><span class='Ref_to_Proto'>match_index_to_operand</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3638"><span class='Ref_To_Local'>arg</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3610"><span class='Ref_to_Parameter'>indexcol</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3611"><span class='Ref_to_Parameter'>index</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN3637"><span class='Ref_To_Local'>btest</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1202"><span class='Ref_to_Member'>booltesttype</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/primnodes.h.html#LN1195"><span class='Ref_to_EnumConst'>IS_TRUE</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* convert to indexkey = TRUE */ 
</span>            <span class='Control'>return</span> <a href="../../../include/optimizer/clauses.h.html#LN29"><span class='Ref_to_Proto'>make_opclause</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_operator.h.html#LN113"><span class='Ref_to_Const'>BooleanEqualOperator</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN17"><span class='Ref_to_Const'>BOOLOID</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                 <span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN3638"><span class='Ref_To_Local'>arg</span></a><span class='Delimiter'>, 
</span>                                 <span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/makefuncs.h.html#LN59"><span class='Ref_to_Proto'>makeBoolConst</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN3637"><span class='Ref_To_Local'>btest</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1202"><span class='Ref_to_Member'>booltesttype</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/primnodes.h.html#LN1195"><span class='Ref_to_EnumConst'>IS_FALSE</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* convert to indexkey = FALSE */ 
</span>            <span class='Control'>return</span> <a href="../../../include/optimizer/clauses.h.html#LN29"><span class='Ref_to_Proto'>make_opclause</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_operator.h.html#LN113"><span class='Ref_to_Const'>BooleanEqualOperator</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN17"><span class='Ref_to_Const'>BOOLOID</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                 <span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN3638"><span class='Ref_To_Local'>arg</span></a><span class='Delimiter'>, 
</span>                                 <span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/makefuncs.h.html#LN59"><span class='Ref_to_Proto'>makeBoolConst</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* Oops */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if clause&&IsA(clause,Bo... &raquo; </span> 
 
    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end expand_boolean_index_clause &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * expand_indexqual_opclause --- expand a single indexqual condition 
 *      that is an operator clause 
 * 
 * The input is a single RestrictInfo, the output a list of RestrictInfos. 
 * 
 * In the base case this is just list_make1(), but we have to be prepared to 
 * expand special cases that were accepted by match_special_index_operator(). 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN3675"></a><span class='Declare_Function'>expand_indexqual_opclause</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rinfo</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>opfamily</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>idxcollation</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3677"></a>    <a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>clause</span> <span class='Operator'>= </span><a href="indxpath.c.html#LN3675"><span class='Ref_to_Parameter'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1746"><span class='Ref_to_Member'>clause</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* we know these will succeed */ 
</span><a name="LN3680"></a>    <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>leftop</span> <span class='Operator'>= </span><a href="../../../include/optimizer/clauses.h.html#LN32"><span class='Ref_to_Proto'>get_leftop</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3677"><span class='Ref_To_Local'>clause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3681"></a>    <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>rightop</span> <span class='Operator'>= </span><a href="../../../include/optimizer/clauses.h.html#LN33"><span class='Ref_to_Proto'>get_rightop</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3677"><span class='Ref_To_Local'>clause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3682"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>expr_op</span> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN491"><span class='Ref_to_Struct'>OpExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN3677"><span class='Ref_To_Local'>clause</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>opno<span class='Delimiter'>; 
</span><a name="LN3683"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>expr_coll</span> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN491"><span class='Ref_to_Struct'>OpExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN3677"><span class='Ref_To_Local'>clause</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>inputcollid<span class='Delimiter'>; 
</span><a name="LN3684"></a>    <a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>patt</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN3681"><span class='Ref_To_Local'>rightop</span></a><span class='Delimiter'>; 
</span><a name="LN3685"></a>    <a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>prefix</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN3686"></a>    <a href="../../../include/utils/selfuncs.h.html#LN93"><span class='Ref_to_Typedef'>Pattern_Prefix_Status</span></a> <span class='Declare_Local'>pstatus</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * LIKE and regex operators are not members of any btree index opfamily, 
     * but they can be members of opfamilies for more exotic index types such 
     * as GIN.  Therefore, we should only do expansion if the operator is 
     * actually not in the opfamily.  But checking that requires a syscache 
     * lookup, so it's best to first see if the operator is one we are 
     * interested in. 
     */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN3682"><span class='Ref_To_Local'>expr_op</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN894"><span class='Ref_to_Const'>OID_TEXT_LIKE_OP</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN899"><span class='Ref_to_Const'>OID_BPCHAR_LIKE_OP</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN889"><span class='Ref_to_Const'>OID_NAME_LIKE_OP</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1400"><span class='Ref_to_Const'>OID_BYTEA_LIKE_OP</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../utils/cache/lsyscache.c.html#LN61"><span class='Ref_to_Func'>op_in_opfamily</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3682"><span class='Ref_To_Local'>expr_op</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3675"><span class='Ref_to_Parameter'>opfamily</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="indxpath.c.html#LN3686"><span class='Ref_To_Local'>pstatus</span></a> <span class='Operator'>= </span><a href="../../../include/utils/selfuncs.h.html#LN176"><span class='Ref_to_Proto'>pattern_fixed_prefix</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3684"><span class='Ref_To_Local'>patt</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/selfuncs.h.html#LN89"><span class='Ref_to_EnumConst'>Pattern_Type_Like</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3683"><span class='Ref_To_Local'>expr_coll</span></a><span class='Delimiter'>, 
</span>                                               <span class='Operator'>&</span><a href="indxpath.c.html#LN3685"><span class='Ref_To_Local'>prefix</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <a href="indxpath.c.html#LN185"><span class='Ref_to_Proto'>prefix_quals</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3680"><span class='Ref_To_Local'>leftop</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3675"><span class='Ref_to_Parameter'>opfamily</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3675"><span class='Ref_to_Parameter'>idxcollation</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3685"><span class='Ref_To_Local'>prefix</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3686"><span class='Ref_To_Local'>pstatus</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1215"><span class='Ref_to_Const'>OID_TEXT_ICLIKE_OP</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1220"><span class='Ref_to_Const'>OID_BPCHAR_ICLIKE_OP</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1210"><span class='Ref_to_Const'>OID_NAME_ICLIKE_OP</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../utils/cache/lsyscache.c.html#LN61"><span class='Ref_to_Func'>op_in_opfamily</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3682"><span class='Ref_To_Local'>expr_op</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3675"><span class='Ref_to_Parameter'>opfamily</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* the right-hand const is type text for all of these */ 
</span>                <a href="indxpath.c.html#LN3686"><span class='Ref_To_Local'>pstatus</span></a> <span class='Operator'>= </span><a href="../../../include/utils/selfuncs.h.html#LN176"><span class='Ref_to_Proto'>pattern_fixed_prefix</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3684"><span class='Ref_To_Local'>patt</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/selfuncs.h.html#LN89"><span class='Ref_to_EnumConst'>Pattern_Type_Like_IC</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3683"><span class='Ref_To_Local'>expr_coll</span></a><span class='Delimiter'>, 
</span>                                               <span class='Operator'>&</span><a href="indxpath.c.html#LN3685"><span class='Ref_To_Local'>prefix</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <a href="indxpath.c.html#LN185"><span class='Ref_to_Proto'>prefix_quals</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3680"><span class='Ref_To_Local'>leftop</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3675"><span class='Ref_to_Parameter'>opfamily</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3675"><span class='Ref_to_Parameter'>idxcollation</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3685"><span class='Ref_To_Local'>prefix</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3686"><span class='Ref_To_Local'>pstatus</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN502"><span class='Ref_to_Const'>OID_TEXT_REGEXEQ_OP</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN758"><span class='Ref_to_Const'>OID_BPCHAR_REGEXEQ_OP</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN497"><span class='Ref_to_Const'>OID_NAME_REGEXEQ_OP</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../utils/cache/lsyscache.c.html#LN61"><span class='Ref_to_Func'>op_in_opfamily</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3682"><span class='Ref_To_Local'>expr_op</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3675"><span class='Ref_to_Parameter'>opfamily</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* the right-hand const is type text for all of these */ 
</span>                <a href="indxpath.c.html#LN3686"><span class='Ref_To_Local'>pstatus</span></a> <span class='Operator'>= </span><a href="../../../include/utils/selfuncs.h.html#LN176"><span class='Ref_to_Proto'>pattern_fixed_prefix</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3684"><span class='Ref_To_Local'>patt</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/selfuncs.h.html#LN90"><span class='Ref_to_EnumConst'>Pattern_Type_Regex</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3683"><span class='Ref_To_Local'>expr_coll</span></a><span class='Delimiter'>, 
</span>                                               <span class='Operator'>&</span><a href="indxpath.c.html#LN3685"><span class='Ref_To_Local'>prefix</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <a href="indxpath.c.html#LN185"><span class='Ref_to_Proto'>prefix_quals</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3680"><span class='Ref_To_Local'>leftop</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3675"><span class='Ref_to_Parameter'>opfamily</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3675"><span class='Ref_to_Parameter'>idxcollation</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3685"><span class='Ref_To_Local'>prefix</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3686"><span class='Ref_To_Local'>pstatus</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN911"><span class='Ref_to_Const'>OID_TEXT_ICREGEXEQ_OP</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN916"><span class='Ref_to_Const'>OID_BPCHAR_ICREGEXEQ_OP</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN906"><span class='Ref_to_Const'>OID_NAME_ICREGEXEQ_OP</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../utils/cache/lsyscache.c.html#LN61"><span class='Ref_to_Func'>op_in_opfamily</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3682"><span class='Ref_To_Local'>expr_op</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3675"><span class='Ref_to_Parameter'>opfamily</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* the right-hand const is type text for all of these */ 
</span>                <a href="indxpath.c.html#LN3686"><span class='Ref_To_Local'>pstatus</span></a> <span class='Operator'>= </span><a href="../../../include/utils/selfuncs.h.html#LN176"><span class='Ref_to_Proto'>pattern_fixed_prefix</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3684"><span class='Ref_To_Local'>patt</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/selfuncs.h.html#LN90"><span class='Ref_to_EnumConst'>Pattern_Type_Regex_IC</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3683"><span class='Ref_To_Local'>expr_coll</span></a><span class='Delimiter'>, 
</span>                                               <span class='Operator'>&</span><a href="indxpath.c.html#LN3685"><span class='Ref_To_Local'>prefix</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <a href="indxpath.c.html#LN185"><span class='Ref_to_Proto'>prefix_quals</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3680"><span class='Ref_To_Local'>leftop</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3675"><span class='Ref_to_Parameter'>opfamily</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3675"><span class='Ref_to_Parameter'>idxcollation</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3685"><span class='Ref_To_Local'>prefix</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3686"><span class='Ref_To_Local'>pstatus</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1178"><span class='Ref_to_Const'>OID_INET_SUB_OP</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1181"><span class='Ref_to_Const'>OID_INET_SUBEQ_OP</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../utils/cache/lsyscache.c.html#LN61"><span class='Ref_to_Func'>op_in_opfamily</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3682"><span class='Ref_To_Local'>expr_op</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3675"><span class='Ref_to_Parameter'>opfamily</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>return</span> <a href="indxpath.c.html#LN187"><span class='Ref_to_Proto'>network_prefix_quals</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3680"><span class='Ref_To_Local'>leftop</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3682"><span class='Ref_To_Local'>expr_op</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3675"><span class='Ref_to_Parameter'>opfamily</span></a><span class='Delimiter'>, 
</span>                                            <a href="indxpath.c.html#LN3684"><span class='Ref_To_Local'>patt</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN195"><span class='Ref_to_Member'>constvalue</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch expr_op &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Default case: just make a list of the unmodified indexqual */ 
</span>    <span class='Control'>return</span> <a href="../../../include/nodes/pg_list.h.html#LN138"><span class='Ref_to_Macro'>list_make1</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3675"><span class='Ref_to_Parameter'>rinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end expand_indexqual_opclause &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * expand_indexqual_rowcompare --- expand a single indexqual condition 
 *      that is a RowCompareExpr 
 * 
 * This is a thin wrapper around adjust_rowcompare_for_index; we export the 
 * latter so that createplan.c can use it to re-discover which columns of the 
 * index are used by a row comparison indexqual. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>* 
</span><a name="LN3769"></a><span class='Declare_Function'>expand_indexqual_rowcompare</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rinfo</span><span class='Delimiter'>, 
</span><a name="LN3770"></a>                            <a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>index</span><span class='Delimiter'>, 
</span><a name="LN3771"></a>                            <span class='Keyword'>int </span><span class='Declare_Parameter'>indexcol</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3773"></a>    <a href="../../../include/nodes/primnodes.h.html#LN1026"><span class='Ref_to_Struct'>RowCompareExpr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>clause</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1026"><span class='Ref_to_Struct'>RowCompareExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN3769"><span class='Ref_to_Parameter'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1746"><span class='Ref_to_Member'>clause</span></a><span class='Delimiter'>; 
</span><a name="LN3774"></a>    <a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>newclause</span><span class='Delimiter'>; 
</span><a name="LN3775"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>indexcolnos</span><span class='Delimiter'>; 
</span><a name="LN3776"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>var_on_left</span><span class='Delimiter'>; 
</span> 
    <a href="indxpath.c.html#LN3774"><span class='Ref_To_Local'>newclause</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/paths.h.html#LN81"><span class='Ref_to_Proto'>adjust_rowcompare_for_index</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3773"><span class='Ref_To_Local'>clause</span></a><span class='Delimiter'>, 
</span>                                            <a href="indxpath.c.html#LN3770"><span class='Ref_to_Parameter'>index</span></a><span class='Delimiter'>, 
</span>                                            <a href="indxpath.c.html#LN3771"><span class='Ref_to_Parameter'>indexcol</span></a><span class='Delimiter'>, 
</span>                                            <span class='Operator'>&</span><a href="indxpath.c.html#LN3775"><span class='Ref_To_Local'>indexcolnos</span></a><span class='Delimiter'>, 
</span>                                            <span class='Operator'>&</span><a href="indxpath.c.html#LN3776"><span class='Ref_To_Local'>var_on_left</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we didn't have to change the RowCompareExpr, return the original 
     * RestrictInfo. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN3774"><span class='Ref_To_Local'>newclause</span></a> <span class='Operator'>== </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN3773"><span class='Ref_To_Local'>clause</span></a><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="indxpath.c.html#LN3769"><span class='Ref_to_Parameter'>rinfo</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Else we need a new RestrictInfo */ 
</span>    <span class='Control'>return</span> <a href="../../../include/optimizer/restrictinfo.h.html#LN20"><span class='Ref_to_Macro'>make_simple_restrictinfo</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3774"><span class='Ref_To_Local'>newclause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end expand_indexqual_rowcompare &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * adjust_rowcompare_for_index --- expand a single indexqual condition 
 *      that is a RowCompareExpr 
 * 
 * It's already known that the first column of the row comparison matches 
 * the specified column of the index.  We can use additional columns of the 
 * row comparison as index qualifications, so long as they match the index 
 * in the "same direction", ie, the indexkeys are all on the same side of the 
 * clause and the operators are all the same-type members of the opfamilies. 
 * If all the columns of the RowCompareExpr match in this way, we just use it 
 * as-is.  Otherwise, we build a shortened RowCompareExpr (if more than one 
 * column matches) or a simple OpExpr (if the first-column match is all 
 * there is).  In these cases the modified clause is always "&LT;=" or "&GT;=" 
 * even when the original was "&LT;" or "&GT;" --- this is necessary to match all 
 * the rows that could match the original.  (We are essentially building a 
 * lossy version of the row comparison when we do this.) 
 * 
 * *indexcolnos receives an integer list of the index column numbers (zero 
 * based) used in the resulting expression.  The reason we need to return 
 * that is that if the index is selected for use, createplan.c will need to 
 * call this again to extract that list.  (This is a bit grotty, but row 
 * comparison indexquals aren't used enough to justify finding someplace to 
 * keep the information in the Path representation.)  Since createplan.c 
 * also needs to know which side of the RowCompareExpr is the index side, 
 * we also return *var_on_left_p rather than re-deducing that there. 
 */ 
</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>* 
</span><a name="LN3822"></a><span class='Declare_Function'>adjust_rowcompare_for_index</span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1026"><span class='Ref_to_Struct'>RowCompareExpr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>clause</span><span class='Delimiter'>, 
</span><a name="LN3823"></a>                            <a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>index</span><span class='Delimiter'>, 
</span><a name="LN3824"></a>                            <span class='Keyword'>int </span><span class='Declare_Parameter'>indexcol</span><span class='Delimiter'>, 
</span><a name="LN3825"></a>                            <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>indexcolnos</span><span class='Delimiter'>, 
</span><a name="LN3826"></a>                            <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>var_on_left_p</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3828"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>var_on_left</span><span class='Delimiter'>; 
</span><a name="LN3829"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>op_strategy</span><span class='Delimiter'>; 
</span><a name="LN3830"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>op_lefttype</span><span class='Delimiter'>; 
</span><a name="LN3831"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>op_righttype</span><span class='Delimiter'>; 
</span><a name="LN3832"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>matching_cols</span><span class='Delimiter'>; 
</span><a name="LN3833"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>expr_op</span><span class='Delimiter'>; 
</span><a name="LN3834"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>opfamilies</span><span class='Delimiter'>; 
</span><a name="LN3835"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>lefttypes</span><span class='Delimiter'>; 
</span><a name="LN3836"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>righttypes</span><span class='Delimiter'>; 
</span><a name="LN3837"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>new_ops</span><span class='Delimiter'>; 
</span><a name="LN3838"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>largs_cell</span><span class='Delimiter'>; 
</span><a name="LN3839"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>rargs_cell</span><span class='Delimiter'>; 
</span><a name="LN3840"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>opnos_cell</span><span class='Delimiter'>; 
</span><a name="LN3841"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>collids_cell</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* We have to figure out (again) how the first col matches */ 
</span>    <a href="indxpath.c.html#LN3828"><span class='Ref_To_Local'>var_on_left</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/paths.h.html#LN75"><span class='Ref_to_Proto'>match_index_to_operand</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3822"><span class='Ref_to_Parameter'>clause</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1033"><span class='Ref_to_Member'>largs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                         <a href="indxpath.c.html#LN3824"><span class='Ref_to_Parameter'>indexcol</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3823"><span class='Ref_to_Parameter'>index</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3828"><span class='Ref_To_Local'>var_on_left</span></a> <span class='Operator'>|| 
</span>           <a href="../../../include/optimizer/paths.h.html#LN75"><span class='Ref_to_Proto'>match_index_to_operand</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3822"><span class='Ref_to_Parameter'>clause</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1034"><span class='Ref_to_Member'>rargs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                  <a href="indxpath.c.html#LN3824"><span class='Ref_to_Parameter'>indexcol</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3823"><span class='Ref_to_Parameter'>index</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="indxpath.c.html#LN3826"><span class='Ref_to_Parameter'>var_on_left_p</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN3828"><span class='Ref_To_Local'>var_on_left</span></a><span class='Delimiter'>; 
</span> 
    <a href="indxpath.c.html#LN3833"><span class='Ref_To_Local'>expr_op</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN112"><span class='Ref_to_Macro'>linitial_oid</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3822"><span class='Ref_to_Parameter'>clause</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1030"><span class='Ref_to_Member'>opnos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="indxpath.c.html#LN3828"><span class='Ref_To_Local'>var_on_left</span></a><span class='Parentheses'>) 
</span>        <a href="indxpath.c.html#LN3833"><span class='Ref_To_Local'>expr_op</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN106"><span class='Ref_to_Proto'>get_commutator</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3833"><span class='Ref_To_Local'>expr_op</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/lsyscache.h.html#LN66"><span class='Ref_to_Proto'>get_op_opfamily_properties</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3833"><span class='Ref_To_Local'>expr_op</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3823"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN643"><span class='Ref_to_Member'>opfamily</span></a><span class='Delimiter'>[</span><a href="indxpath.c.html#LN3824"><span class='Ref_to_Parameter'>indexcol</span></a><span class='Delimiter'>], </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                               <span class='Operator'>&</span><a href="indxpath.c.html#LN3829"><span class='Ref_To_Local'>op_strategy</span></a><span class='Delimiter'>, 
</span>                               <span class='Operator'>&</span><a href="indxpath.c.html#LN3830"><span class='Ref_To_Local'>op_lefttype</span></a><span class='Delimiter'>, 
</span>                               <span class='Operator'>&</span><a href="indxpath.c.html#LN3831"><span class='Ref_To_Local'>op_righttype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Initialize returned list of which index columns are used */ 
</span>    <span class='Operator'>*</span><a href="indxpath.c.html#LN3825"><span class='Ref_to_Parameter'>indexcolnos</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN144"><span class='Ref_to_Macro'>list_make1_int</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3824"><span class='Ref_to_Parameter'>indexcol</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Build lists of the opfamilies and operator datatypes in case needed */ 
</span>    <a href="indxpath.c.html#LN3834"><span class='Ref_To_Local'>opfamilies</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN150"><span class='Ref_to_Macro'>list_make1_oid</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3823"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN643"><span class='Ref_to_Member'>opfamily</span></a><span class='Delimiter'>[</span><a href="indxpath.c.html#LN3824"><span class='Ref_to_Parameter'>indexcol</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="indxpath.c.html#LN3835"><span class='Ref_To_Local'>lefttypes</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN150"><span class='Ref_to_Macro'>list_make1_oid</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3830"><span class='Ref_To_Local'>op_lefttype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="indxpath.c.html#LN3836"><span class='Ref_To_Local'>righttypes</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN150"><span class='Ref_to_Macro'>list_make1_oid</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3831"><span class='Ref_To_Local'>op_righttype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * See how many of the remaining columns match some index column in the 
     * same way.  As in match_clause_to_indexcol(), the "other" side of any 
     * potential index condition is OK as long as it doesn't use Vars from the 
     * indexed relation. 
     */ 
</span>    <a href="indxpath.c.html#LN3832"><span class='Ref_To_Local'>matching_cols</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="indxpath.c.html#LN3838"><span class='Ref_To_Local'>largs_cell</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN75"><span class='Ref_to_Func'>list_head</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3822"><span class='Ref_to_Parameter'>clause</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1033"><span class='Ref_to_Member'>largs</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="indxpath.c.html#LN3839"><span class='Ref_To_Local'>rargs_cell</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN75"><span class='Ref_to_Func'>list_head</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3822"><span class='Ref_to_Parameter'>clause</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1034"><span class='Ref_to_Member'>rargs</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="indxpath.c.html#LN3840"><span class='Ref_To_Local'>opnos_cell</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN75"><span class='Ref_to_Func'>list_head</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3822"><span class='Ref_to_Parameter'>clause</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1030"><span class='Ref_to_Member'>opnos</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="indxpath.c.html#LN3841"><span class='Ref_To_Local'>collids_cell</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN75"><span class='Ref_to_Func'>list_head</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3822"><span class='Ref_to_Parameter'>clause</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1032"><span class='Ref_to_Member'>inputcollids</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN3838"><span class='Ref_To_Local'>largs_cell</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3881"></a>        <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>varop</span><span class='Delimiter'>; 
</span><a name="LN3882"></a>        <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>constop</span><span class='Delimiter'>; 
</span><a name="LN3883"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <a href="indxpath.c.html#LN3833"><span class='Ref_To_Local'>expr_op</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3840"><span class='Ref_To_Local'>opnos_cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN3828"><span class='Ref_To_Local'>var_on_left</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="indxpath.c.html#LN3881"><span class='Ref_To_Local'>varop</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3838"><span class='Ref_To_Local'>largs_cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="indxpath.c.html#LN3882"><span class='Ref_To_Local'>constop</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3839"><span class='Ref_To_Local'>rargs_cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="indxpath.c.html#LN3881"><span class='Ref_To_Local'>varop</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3839"><span class='Ref_To_Local'>rargs_cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="indxpath.c.html#LN3882"><span class='Ref_To_Local'>constop</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3838"><span class='Ref_To_Local'>largs_cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* indexkey is on right, so commute the operator */ 
</span>            <a href="indxpath.c.html#LN3833"><span class='Ref_To_Local'>expr_op</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN106"><span class='Ref_to_Proto'>get_commutator</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3833"><span class='Ref_To_Local'>expr_op</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN3833"><span class='Ref_To_Local'>expr_op</span></a> <span class='Operator'>== </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>break</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* operator is not usable */ 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/bitmapset.h.html#LN75"><span class='Ref_to_Proto'>bms_is_member</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3823"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN632"><span class='Ref_to_Member'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN552"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>, </span><a href="../../../include/optimizer/var.h.html#LN29"><span class='Ref_to_Proto'>pull_varnos</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3882"><span class='Ref_To_Local'>constop</span></a><span class='Parentheses'>)))</span> 
            <span class='Control'>break</span><span class='Delimiter'>;</span>              <span class='Comment_Single_Line'>/* no good, Var on wrong side */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/optimizer/clauses.h.html#LN60"><span class='Ref_to_Proto'>contain_volatile_functions</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3882"><span class='Ref_To_Local'>constop</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>break</span><span class='Delimiter'>;</span>              <span class='Comment_Single_Line'>/* no good, volatile comparison value */ 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * The Var side can match any column of the index. 
         */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN3883"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="indxpath.c.html#LN3883"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="indxpath.c.html#LN3823"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN640"><span class='Ref_to_Member'>ncolumns</span></a><span class='Delimiter'>; </span><a href="indxpath.c.html#LN3883"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/optimizer/paths.h.html#LN75"><span class='Ref_to_Proto'>match_index_to_operand</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3881"><span class='Ref_To_Local'>varop</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3883"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3823"><span class='Ref_to_Parameter'>index</span></a><span class='Parentheses'>)</span> <span class='Operator'>&& 
</span>                <a href="../../../include/utils/lsyscache.h.html#LN64"><span class='Ref_to_Proto'>get_op_opfamily_strategy</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3833"><span class='Ref_To_Local'>expr_op</span></a><span class='Delimiter'>, 
</span>                                         <a href="indxpath.c.html#LN3823"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN643"><span class='Ref_to_Member'>opfamily</span></a><span class='Delimiter'>[</span><a href="indxpath.c.html#LN3883"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span> <span class='Operator'>== </span><a href="indxpath.c.html#LN3829"><span class='Ref_To_Local'>op_strategy</span></a> <span class='Operator'>&& 
</span>                <a href="indxpath.c.html#LN45"><span class='Ref_to_Macro'>IndexCollMatchesExprColl</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3823"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN642"><span class='Ref_to_Member'>indexcollations</span></a><span class='Delimiter'>[</span><a href="indxpath.c.html#LN3883"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                                         <a href="../../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3841"><span class='Ref_To_Local'>collids_cell</span></a><span class='Parentheses'>)))</span> 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN3883"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT;= </span><a href="indxpath.c.html#LN3823"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN640"><span class='Ref_to_Member'>ncolumns</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>;</span>              <span class='Comment_Single_Line'>/* no match found */ 
</span> 
        <span class='Comment_Multi_Line'>/* Add column number to returned list */ 
</span>        <span class='Operator'>*</span><a href="indxpath.c.html#LN3825"><span class='Ref_to_Parameter'>indexcolnos</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN144"><span class='Ref_to_Func'>lappend_int</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="indxpath.c.html#LN3825"><span class='Ref_to_Parameter'>indexcolnos</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3883"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Add opfamily and datatypes to lists */ 
</span>        <a href="../../../include/utils/lsyscache.h.html#LN66"><span class='Ref_to_Proto'>get_op_opfamily_properties</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3833"><span class='Ref_To_Local'>expr_op</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3823"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN643"><span class='Ref_to_Member'>opfamily</span></a><span class='Delimiter'>[</span><a href="indxpath.c.html#LN3883"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                   <span class='Operator'>&</span><a href="indxpath.c.html#LN3829"><span class='Ref_To_Local'>op_strategy</span></a><span class='Delimiter'>, 
</span>                                   <span class='Operator'>&</span><a href="indxpath.c.html#LN3830"><span class='Ref_To_Local'>op_lefttype</span></a><span class='Delimiter'>, 
</span>                                   <span class='Operator'>&</span><a href="indxpath.c.html#LN3831"><span class='Ref_To_Local'>op_righttype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN3834"><span class='Ref_To_Local'>opfamilies</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3834"><span class='Ref_To_Local'>opfamilies</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3823"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN643"><span class='Ref_to_Member'>opfamily</span></a><span class='Delimiter'>[</span><a href="indxpath.c.html#LN3883"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN3835"><span class='Ref_To_Local'>lefttypes</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3835"><span class='Ref_To_Local'>lefttypes</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3830"><span class='Ref_To_Local'>op_lefttype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN3836"><span class='Ref_To_Local'>righttypes</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3836"><span class='Ref_To_Local'>righttypes</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3831"><span class='Ref_To_Local'>op_righttype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* This column matches, keep scanning */ 
</span>        <a href="indxpath.c.html#LN3832"><span class='Ref_To_Local'>matching_cols</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN3838"><span class='Ref_To_Local'>largs_cell</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3838"><span class='Ref_To_Local'>largs_cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN3839"><span class='Ref_To_Local'>rargs_cell</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3839"><span class='Ref_To_Local'>rargs_cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN3840"><span class='Ref_To_Local'>opnos_cell</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3840"><span class='Ref_To_Local'>opnos_cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN3841"><span class='Ref_To_Local'>collids_cell</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3841"><span class='Ref_To_Local'>collids_cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while largs_cell!=NULL &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Return clause as-is if it's all usable as index quals */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN3832"><span class='Ref_To_Local'>matching_cols</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3822"><span class='Ref_to_Parameter'>clause</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1030"><span class='Ref_to_Member'>opnos</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN3822"><span class='Ref_to_Parameter'>clause</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We have to generate a subset rowcompare (possibly just one OpExpr). The 
     * painful part of this is changing &LT; to &LT;= or &GT; to &GT;=, so deal with that 
     * first. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN3829"><span class='Ref_To_Local'>op_strategy</span></a> <span class='Operator'>== </span><a href="../../../include/access/stratnum.h.html#LN29"><span class='Ref_to_Const'>BTLessEqualStrategyNumber</span></a> <span class='Operator'>|| 
</span>        <a href="indxpath.c.html#LN3829"><span class='Ref_To_Local'>op_strategy</span></a> <span class='Operator'>== </span><a href="../../../include/access/stratnum.h.html#LN31"><span class='Ref_to_Const'>BTGreaterEqualStrategyNumber</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* easy, just use the same operators */ 
</span>        <a href="indxpath.c.html#LN3837"><span class='Ref_To_Local'>new_ops</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN220"><span class='Ref_to_Proto'>list_truncate</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN268"><span class='Ref_to_Proto'>list_copy</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3822"><span class='Ref_to_Parameter'>clause</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1030"><span class='Ref_to_Member'>opnos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3832"><span class='Ref_To_Local'>matching_cols</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN3957"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>opfamilies_cell</span><span class='Delimiter'>; 
</span><a name="LN3958"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lefttypes_cell</span><span class='Delimiter'>; 
</span><a name="LN3959"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>righttypes_cell</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN3829"><span class='Ref_To_Local'>op_strategy</span></a> <span class='Operator'>== </span><a href="../../../include/access/stratnum.h.html#LN28"><span class='Ref_to_Const'>BTLessStrategyNumber</span></a><span class='Parentheses'>) 
</span>            <a href="indxpath.c.html#LN3829"><span class='Ref_To_Local'>op_strategy</span></a> <span class='Operator'>= </span><a href="../../../include/access/stratnum.h.html#LN29"><span class='Ref_to_Const'>BTLessEqualStrategyNumber</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN3829"><span class='Ref_To_Local'>op_strategy</span></a> <span class='Operator'>== </span><a href="../../../include/access/stratnum.h.html#LN32"><span class='Ref_to_Const'>BTGreaterStrategyNumber</span></a><span class='Parentheses'>) 
</span>            <a href="indxpath.c.html#LN3829"><span class='Ref_To_Local'>op_strategy</span></a> <span class='Operator'>= </span><a href="../../../include/access/stratnum.h.html#LN31"><span class='Ref_to_Const'>BTGreaterEqualStrategyNumber</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected strategy number %d"</span><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3829"><span class='Ref_To_Local'>op_strategy</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN3837"><span class='Ref_To_Local'>new_ops</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN3958"><span class='Ref_To_Local'>lefttypes_cell</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN75"><span class='Ref_to_Func'>list_head</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3835"><span class='Ref_To_Local'>lefttypes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN3959"><span class='Ref_To_Local'>righttypes_cell</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN75"><span class='Ref_to_Func'>list_head</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3836"><span class='Ref_To_Local'>righttypes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3957"><span class='Ref_To_Local'>opfamilies_cell</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3834"><span class='Ref_To_Local'>opfamilies</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN3972"></a>            <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>opfam</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3957"><span class='Ref_To_Local'>opfamilies_cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3973"></a>            <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>lefttype</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3958"><span class='Ref_To_Local'>lefttypes_cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3974"></a>            <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>righttype</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3959"><span class='Ref_To_Local'>righttypes_cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="indxpath.c.html#LN3833"><span class='Ref_To_Local'>expr_op</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN70"><span class='Ref_to_Proto'>get_opfamily_member</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3972"><span class='Ref_To_Local'>opfam</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3973"><span class='Ref_To_Local'>lefttype</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3974"><span class='Ref_To_Local'>righttype</span></a><span class='Delimiter'>, 
</span>                                          <a href="indxpath.c.html#LN3829"><span class='Ref_To_Local'>op_strategy</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3833"><span class='Ref_To_Local'>expr_op</span></a><span class='Parentheses'>))</span>   <span class='Comment_Single_Line'>/* should not happen */ 
</span>                <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not find member %d(%u,%u) of opfamily %u"</span><span class='Delimiter'>, 
</span>                     <a href="indxpath.c.html#LN3829"><span class='Ref_To_Local'>op_strategy</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3973"><span class='Ref_To_Local'>lefttype</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3974"><span class='Ref_To_Local'>righttype</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3972"><span class='Ref_To_Local'>opfam</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="indxpath.c.html#LN3828"><span class='Ref_To_Local'>var_on_left</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="indxpath.c.html#LN3833"><span class='Ref_To_Local'>expr_op</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN106"><span class='Ref_to_Proto'>get_commutator</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3833"><span class='Ref_To_Local'>expr_op</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3833"><span class='Ref_To_Local'>expr_op</span></a><span class='Parentheses'>))</span>       <span class='Comment_Single_Line'>/* should not happen */ 
</span>                    <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not find commutator of member %d(%u,%u) of opfamily %u"</span><span class='Delimiter'>, 
</span>                         <a href="indxpath.c.html#LN3829"><span class='Ref_To_Local'>op_strategy</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3973"><span class='Ref_To_Local'>lefttype</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3974"><span class='Ref_To_Local'>righttype</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3972"><span class='Ref_To_Local'>opfam</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="indxpath.c.html#LN3837"><span class='Ref_To_Local'>new_ops</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3837"><span class='Ref_To_Local'>new_ops</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN3833"><span class='Ref_To_Local'>expr_op</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="indxpath.c.html#LN3958"><span class='Ref_To_Local'>lefttypes_cell</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3958"><span class='Ref_To_Local'>lefttypes_cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="indxpath.c.html#LN3959"><span class='Ref_To_Local'>righttypes_cell</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3959"><span class='Ref_To_Local'>righttypes_cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* If we have more than one matching col, create a subset rowcompare */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN3832"><span class='Ref_To_Local'>matching_cols</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3997"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1026"><span class='Ref_to_Struct'>RowCompareExpr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rc</span> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1026"><span class='Ref_to_Struct'>RowCompareExpr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN3828"><span class='Ref_To_Local'>var_on_left</span></a><span class='Parentheses'>) 
</span>            <a href="indxpath.c.html#LN3997"><span class='Ref_To_Local'>rc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1029"><span class='Ref_to_Member'>rctype</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1015"><span class='Ref_to_Enum'>RowCompareType</span></a><span class='Parentheses'>) </span><a href="indxpath.c.html#LN3829"><span class='Ref_To_Local'>op_strategy</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="indxpath.c.html#LN3997"><span class='Ref_To_Local'>rc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1029"><span class='Ref_to_Member'>rctype</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3829"><span class='Ref_To_Local'>op_strategy</span></a> <span class='Operator'>== </span><a href="../../../include/access/stratnum.h.html#LN29"><span class='Ref_to_Const'>BTLessEqualStrategyNumber</span></a><span class='Parentheses'>) </span><span class='Operator'>? 
</span>                <a href="../../../include/nodes/primnodes.h.html#LN1021"><span class='Ref_to_EnumConst'>ROWCOMPARE_GE</span></a> <span class='Operator'>: </span><a href="../../../include/nodes/primnodes.h.html#LN1019"><span class='Ref_to_EnumConst'>ROWCOMPARE_LE</span></a><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN3997"><span class='Ref_To_Local'>rc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1030"><span class='Ref_to_Member'>opnos</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN3837"><span class='Ref_To_Local'>new_ops</span></a><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN3997"><span class='Ref_To_Local'>rc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1031"><span class='Ref_to_Member'>opfamilies</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN220"><span class='Ref_to_Proto'>list_truncate</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN268"><span class='Ref_to_Proto'>list_copy</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3822"><span class='Ref_to_Parameter'>clause</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1031"><span class='Ref_to_Member'>opfamilies</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                       <a href="indxpath.c.html#LN3832"><span class='Ref_To_Local'>matching_cols</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN3997"><span class='Ref_To_Local'>rc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1032"><span class='Ref_to_Member'>inputcollids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN220"><span class='Ref_to_Proto'>list_truncate</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN268"><span class='Ref_to_Proto'>list_copy</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3822"><span class='Ref_to_Parameter'>clause</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1032"><span class='Ref_to_Member'>inputcollids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                         <a href="indxpath.c.html#LN3832"><span class='Ref_To_Local'>matching_cols</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN3997"><span class='Ref_To_Local'>rc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1033"><span class='Ref_to_Member'>largs</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN220"><span class='Ref_to_Proto'>list_truncate</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3822"><span class='Ref_to_Parameter'>clause</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1033"><span class='Ref_to_Member'>largs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                  <a href="indxpath.c.html#LN3832"><span class='Ref_To_Local'>matching_cols</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN3997"><span class='Ref_To_Local'>rc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1034"><span class='Ref_to_Member'>rargs</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN220"><span class='Ref_to_Proto'>list_truncate</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3822"><span class='Ref_to_Parameter'>clause</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1034"><span class='Ref_to_Member'>rargs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                  <a href="indxpath.c.html#LN3832"><span class='Ref_To_Local'>matching_cols</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN3997"><span class='Ref_To_Local'>rc</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if matching_cols&GT;1 &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>return</span> <a href="../../../include/optimizer/clauses.h.html#LN29"><span class='Ref_to_Proto'>make_opclause</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN112"><span class='Ref_to_Macro'>linitial_oid</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3837"><span class='Ref_To_Local'>new_ops</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN17"><span class='Ref_to_Const'>BOOLOID</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                             <a href="../../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3822"><span class='Ref_to_Parameter'>clause</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1033"><span class='Ref_to_Member'>largs</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                             <a href="../../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3822"><span class='Ref_to_Parameter'>clause</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1034"><span class='Ref_to_Member'>rargs</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                             <a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, 
</span>                             <a href="../../../include/nodes/pg_list.h.html#LN112"><span class='Ref_to_Macro'>linitial_oid</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN3822"><span class='Ref_to_Parameter'>clause</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1032"><span class='Ref_to_Member'>inputcollids</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end adjust_rowcompare_for_index &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Given a fixed prefix that all the "leftop" values must have, 
 * generate suitable indexqual condition(s).  opfamily is the index 
 * operator family; we use it to deduce the appropriate comparison 
 * operators and operand datatypes.  collation is the input collation to use. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN4032"></a><span class='Declare_Function'>prefix_quals</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>leftop</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>opfamily</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>collation</span><span class='Delimiter'>, 
</span><a name="LN4033"></a>             <a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>prefix_const</span><span class='Delimiter'>, </span><a href="../../../include/utils/selfuncs.h.html#LN93"><span class='Ref_to_Typedef'>Pattern_Prefix_Status</span></a> <span class='Declare_Parameter'>pstatus</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4035"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN4036"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>datatype</span><span class='Delimiter'>; 
</span><a name="LN4037"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>oproid</span><span class='Delimiter'>; 
</span><a name="LN4038"></a>    <a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>expr</span><span class='Delimiter'>; 
</span><a name="LN4039"></a>    <a href="../../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a>    <span class='Declare_Local'>ltproc</span><span class='Delimiter'>; 
</span><a name="LN4040"></a>    <a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>greaterstr</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="indxpath.c.html#LN4033"><span class='Ref_to_Parameter'>pstatus</span></a> <span class='Operator'>!= </span><a href="../../../include/utils/selfuncs.h.html#LN95"><span class='Ref_to_EnumConst'>Pattern_Prefix_None</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN4032"><span class='Ref_to_Parameter'>opfamily</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_opfamily.h.html#LN104"><span class='Ref_to_Const'>TEXT_BTREE_FAM_OID</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_opfamily.h.html#LN114"><span class='Ref_to_Const'>TEXT_PATTERN_BTREE_FAM_OID</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_opfamily.h.html#LN154"><span class='Ref_to_Const'>TEXT_SPGIST_FAM_OID</span></a><span class='Operator'>: 
</span>            <a href="indxpath.c.html#LN4036"><span class='Ref_To_Local'>datatype</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/catalog/pg_opfamily.h.html#LN67"><span class='Ref_to_Const'>BPCHAR_BTREE_FAM_OID</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_opfamily.h.html#LN116"><span class='Ref_to_Const'>BPCHAR_PATTERN_BTREE_FAM_OID</span></a><span class='Operator'>: 
</span>            <a href="indxpath.c.html#LN4036"><span class='Ref_To_Local'>datatype</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN48"><span class='Ref_to_Const'>BPCHAROID</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/catalog/pg_opfamily.h.html#LN92"><span class='Ref_to_Const'>NAME_BTREE_FAM_OID</span></a><span class='Operator'>: 
</span>            <a href="indxpath.c.html#LN4036"><span class='Ref_To_Local'>datatype</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN20"><span class='Ref_to_Const'>NAMEOID</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/catalog/pg_opfamily.h.html#LN70"><span class='Ref_to_Const'>BYTEA_BTREE_FAM_OID</span></a><span class='Operator'>: 
</span>            <a href="indxpath.c.html#LN4036"><span class='Ref_To_Local'>datatype</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN18"><span class='Ref_to_Const'>BYTEAOID</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* shouldn't get here */ 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected opfamily: %u"</span><span class='Delimiter'>, </span><a href="indxpath.c.html#LN4032"><span class='Ref_to_Parameter'>opfamily</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch opfamily &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * If necessary, coerce the prefix constant to the right type. The given 
     * prefix constant is either text or bytea type. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN4033"><span class='Ref_to_Parameter'>prefix_const</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN191"><span class='Ref_to_Member'>consttype</span></a> <span class='Operator'>!= </span><a href="indxpath.c.html#LN4036"><span class='Ref_To_Local'>datatype</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4077"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>prefix</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN4033"><span class='Ref_to_Parameter'>prefix_const</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN191"><span class='Ref_to_Member'>consttype</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Operator'>: 
</span>                <a href="indxpath.c.html#LN4077"><span class='Ref_To_Local'>prefix</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN91"><span class='Ref_to_Macro'>TextDatumGetCString</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN4033"><span class='Ref_to_Parameter'>prefix_const</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN195"><span class='Ref_to_Member'>constvalue</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN18"><span class='Ref_to_Const'>BYTEAOID</span></a><span class='Operator'>: 
</span>                <a href="indxpath.c.html#LN4077"><span class='Ref_To_Local'>prefix</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN571"><span class='Ref_to_Macro'>DatumGetCString</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="../../utils/adt/varlena.c.html#LN349"><span class='Ref_to_Func'>byteaout</span></a><span class='Delimiter'>, 
</span>                                                  <a href="indxpath.c.html#LN4033"><span class='Ref_to_Parameter'>prefix_const</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN195"><span class='Ref_to_Member'>constvalue</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected const type: %u"</span><span class='Delimiter'>, 
</span>                     <a href="indxpath.c.html#LN4033"><span class='Ref_to_Parameter'>prefix_const</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN191"><span class='Ref_to_Member'>consttype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="indxpath.c.html#LN4033"><span class='Ref_to_Parameter'>prefix_const</span></a> <span class='Operator'>= </span><a href="indxpath.c.html#LN190"><span class='Ref_to_Proto'>string_to_const</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN4077"><span class='Ref_To_Local'>prefix</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN4036"><span class='Ref_To_Local'>datatype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN4077"><span class='Ref_To_Local'>prefix</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if prefix_const-&GT;constty... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * If we found an exact-match pattern, generate an "=" indexqual. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN4033"><span class='Ref_to_Parameter'>pstatus</span></a> <span class='Operator'>== </span><a href="../../../include/utils/selfuncs.h.html#LN95"><span class='Ref_to_EnumConst'>Pattern_Prefix_Exact</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="indxpath.c.html#LN4037"><span class='Ref_To_Local'>oproid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN70"><span class='Ref_to_Proto'>get_opfamily_member</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN4032"><span class='Ref_to_Parameter'>opfamily</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN4036"><span class='Ref_To_Local'>datatype</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN4036"><span class='Ref_To_Local'>datatype</span></a><span class='Delimiter'>, 
</span>                                     <a href="../../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN4037"><span class='Ref_To_Local'>oproid</span></a> <span class='Operator'>== </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"no = operator for opfamily %u"</span><span class='Delimiter'>, </span><a href="indxpath.c.html#LN4032"><span class='Ref_to_Parameter'>opfamily</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN4038"><span class='Ref_To_Local'>expr</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/clauses.h.html#LN29"><span class='Ref_to_Proto'>make_opclause</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN4037"><span class='Ref_To_Local'>oproid</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN17"><span class='Ref_to_Const'>BOOLOID</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                             <span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN4032"><span class='Ref_to_Parameter'>leftop</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN4033"><span class='Ref_to_Parameter'>prefix_const</span></a><span class='Delimiter'>, 
</span>                             <a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN4032"><span class='Ref_to_Parameter'>collation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN4035"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN138"><span class='Ref_to_Macro'>list_make1</span></a><span class='Parentheses'>(</span><a href="../../../include/optimizer/restrictinfo.h.html#LN20"><span class='Ref_to_Macro'>make_simple_restrictinfo</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN4038"><span class='Ref_To_Local'>expr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="indxpath.c.html#LN4035"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Otherwise, we have a nonempty required prefix of the values. 
     * 
     * We can always say "x &GT;= prefix". 
     */ 
</span>    <a href="indxpath.c.html#LN4037"><span class='Ref_To_Local'>oproid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN70"><span class='Ref_to_Proto'>get_opfamily_member</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN4032"><span class='Ref_to_Parameter'>opfamily</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN4036"><span class='Ref_To_Local'>datatype</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN4036"><span class='Ref_To_Local'>datatype</span></a><span class='Delimiter'>, 
</span>                                 <a href="../../../include/access/stratnum.h.html#LN31"><span class='Ref_to_Const'>BTGreaterEqualStrategyNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN4037"><span class='Ref_To_Local'>oproid</span></a> <span class='Operator'>== </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"no &GT;= operator for opfamily %u"</span><span class='Delimiter'>, </span><a href="indxpath.c.html#LN4032"><span class='Ref_to_Parameter'>opfamily</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="indxpath.c.html#LN4038"><span class='Ref_To_Local'>expr</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/clauses.h.html#LN29"><span class='Ref_to_Proto'>make_opclause</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN4037"><span class='Ref_To_Local'>oproid</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN17"><span class='Ref_to_Const'>BOOLOID</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                         <span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN4032"><span class='Ref_to_Parameter'>leftop</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN4033"><span class='Ref_to_Parameter'>prefix_const</span></a><span class='Delimiter'>, 
</span>                         <a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN4032"><span class='Ref_to_Parameter'>collation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="indxpath.c.html#LN4035"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN138"><span class='Ref_to_Macro'>list_make1</span></a><span class='Parentheses'>(</span><a href="../../../include/optimizer/restrictinfo.h.html#LN20"><span class='Ref_to_Macro'>make_simple_restrictinfo</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN4038"><span class='Ref_To_Local'>expr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/*------- 
     * If we can create a string larger than the prefix, we can say 
     * "x &LT; greaterstr".  NB: we rely on make_greater_string() to generate 
     * a guaranteed-greater string, not just a probably-greater string. 
     * In general this is only guaranteed in C locale, so we'd better be 
     * using a C-locale index collation. 
     *------- 
     */ 
</span>    <a href="indxpath.c.html#LN4037"><span class='Ref_To_Local'>oproid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN70"><span class='Ref_to_Proto'>get_opfamily_member</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN4032"><span class='Ref_to_Parameter'>opfamily</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN4036"><span class='Ref_To_Local'>datatype</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN4036"><span class='Ref_To_Local'>datatype</span></a><span class='Delimiter'>, 
</span>                                 <a href="../../../include/access/stratnum.h.html#LN28"><span class='Ref_to_Const'>BTLessStrategyNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN4037"><span class='Ref_To_Local'>oproid</span></a> <span class='Operator'>== </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"no &LT; operator for opfamily %u"</span><span class='Delimiter'>, </span><a href="indxpath.c.html#LN4032"><span class='Ref_to_Parameter'>opfamily</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN92"><span class='Ref_to_Proto'>fmgr_info</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/lsyscache.h.html#LN98"><span class='Ref_to_Proto'>get_opcode</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN4037"><span class='Ref_To_Local'>oproid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="indxpath.c.html#LN4039"><span class='Ref_To_Local'>ltproc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="indxpath.c.html#LN4040"><span class='Ref_To_Local'>greaterstr</span></a> <span class='Operator'>= </span><a href="../../../include/utils/selfuncs.h.html#LN181"><span class='Ref_to_Proto'>make_greater_string</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN4033"><span class='Ref_to_Parameter'>prefix_const</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="indxpath.c.html#LN4039"><span class='Ref_To_Local'>ltproc</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN4032"><span class='Ref_to_Parameter'>collation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN4040"><span class='Ref_To_Local'>greaterstr</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="indxpath.c.html#LN4038"><span class='Ref_To_Local'>expr</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/clauses.h.html#LN29"><span class='Ref_to_Proto'>make_opclause</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN4037"><span class='Ref_To_Local'>oproid</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN17"><span class='Ref_to_Const'>BOOLOID</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                             <span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN4032"><span class='Ref_to_Parameter'>leftop</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN4040"><span class='Ref_To_Local'>greaterstr</span></a><span class='Delimiter'>, 
</span>                             <a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN4032"><span class='Ref_to_Parameter'>collation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="indxpath.c.html#LN4035"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN4035"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="../../../include/optimizer/restrictinfo.h.html#LN20"><span class='Ref_to_Macro'>make_simple_restrictinfo</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN4038"><span class='Ref_To_Local'>expr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="indxpath.c.html#LN4035"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end prefix_quals &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Given a leftop and a rightop, and an inet-family sup/sub operator, 
 * generate suitable indexqual condition(s).  expr_op is the original 
 * operator, and opfamily is the index opfamily. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN4158"></a><span class='Declare_Function'>network_prefix_quals</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>leftop</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>expr_op</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>opfamily</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>rightop</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4160"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>is_eq</span><span class='Delimiter'>; 
</span><a name="LN4161"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>datatype</span><span class='Delimiter'>; 
</span><a name="LN4162"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>opr1oid</span><span class='Delimiter'>; 
</span><a name="LN4163"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>opr2oid</span><span class='Delimiter'>; 
</span><a name="LN4164"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>opr1right</span><span class='Delimiter'>; 
</span><a name="LN4165"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>opr2right</span><span class='Delimiter'>; 
</span><a name="LN4166"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN4167"></a>    <a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>expr</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN4158"><span class='Ref_to_Parameter'>expr_op</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1178"><span class='Ref_to_Const'>OID_INET_SUB_OP</span></a><span class='Operator'>: 
</span>            <a href="indxpath.c.html#LN4161"><span class='Ref_To_Local'>datatype</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN46"><span class='Ref_to_Const'>INETOID</span></a><span class='Delimiter'>; 
</span>            <a href="indxpath.c.html#LN4160"><span class='Ref_To_Local'>is_eq</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1181"><span class='Ref_to_Const'>OID_INET_SUBEQ_OP</span></a><span class='Operator'>: 
</span>            <a href="indxpath.c.html#LN4161"><span class='Ref_To_Local'>datatype</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN46"><span class='Ref_to_Const'>INETOID</span></a><span class='Delimiter'>; 
</span>            <a href="indxpath.c.html#LN4160"><span class='Ref_To_Local'>is_eq</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected operator: %u"</span><span class='Delimiter'>, </span><a href="indxpath.c.html#LN4158"><span class='Ref_to_Parameter'>expr_op</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * create clause "key &GT;= network_scan_first( rightop )", or "&GT;" if the 
     * operator disallows equality. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN4160"><span class='Ref_To_Local'>is_eq</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="indxpath.c.html#LN4162"><span class='Ref_To_Local'>opr1oid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN70"><span class='Ref_to_Proto'>get_opfamily_member</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN4158"><span class='Ref_to_Parameter'>opfamily</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN4161"><span class='Ref_To_Local'>datatype</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN4161"><span class='Ref_To_Local'>datatype</span></a><span class='Delimiter'>, 
</span>                                      <a href="../../../include/access/stratnum.h.html#LN31"><span class='Ref_to_Const'>BTGreaterEqualStrategyNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN4162"><span class='Ref_To_Local'>opr1oid</span></a> <span class='Operator'>== </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"no &GT;= operator for opfamily %u"</span><span class='Delimiter'>, </span><a href="indxpath.c.html#LN4158"><span class='Ref_to_Parameter'>opfamily</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="indxpath.c.html#LN4162"><span class='Ref_To_Local'>opr1oid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN70"><span class='Ref_to_Proto'>get_opfamily_member</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN4158"><span class='Ref_to_Parameter'>opfamily</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN4161"><span class='Ref_To_Local'>datatype</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN4161"><span class='Ref_To_Local'>datatype</span></a><span class='Delimiter'>, 
</span>                                      <a href="../../../include/access/stratnum.h.html#LN32"><span class='Ref_to_Const'>BTGreaterStrategyNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN4162"><span class='Ref_To_Local'>opr1oid</span></a> <span class='Operator'>== </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"no &GT; operator for opfamily %u"</span><span class='Delimiter'>, </span><a href="indxpath.c.html#LN4158"><span class='Ref_to_Parameter'>opfamily</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="indxpath.c.html#LN4164"><span class='Ref_To_Local'>opr1right</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN106"><span class='Ref_to_Proto'>network_scan_first</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN4158"><span class='Ref_to_Parameter'>rightop</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="indxpath.c.html#LN4167"><span class='Ref_To_Local'>expr</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/clauses.h.html#LN29"><span class='Ref_to_Proto'>make_opclause</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN4162"><span class='Ref_To_Local'>opr1oid</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN17"><span class='Ref_to_Const'>BOOLOID</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                         <span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN4158"><span class='Ref_to_Parameter'>leftop</span></a><span class='Delimiter'>, 
</span>                         <span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/makefuncs.h.html#LN49"><span class='Ref_to_Proto'>makeConst</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN4161"><span class='Ref_To_Local'>datatype</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                            <a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><span class='Comment_Single_Line'>/* not collatable */ 
</span>                                            <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="indxpath.c.html#LN4164"><span class='Ref_To_Local'>opr1right</span></a><span class='Delimiter'>, 
</span>                                            <span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="indxpath.c.html#LN4166"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN138"><span class='Ref_to_Macro'>list_make1</span></a><span class='Parentheses'>(</span><a href="../../../include/optimizer/restrictinfo.h.html#LN20"><span class='Ref_to_Macro'>make_simple_restrictinfo</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN4167"><span class='Ref_To_Local'>expr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* create clause "key &LT;= network_scan_last( rightop )" */ 
</span> 
    <a href="indxpath.c.html#LN4163"><span class='Ref_To_Local'>opr2oid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN70"><span class='Ref_to_Proto'>get_opfamily_member</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN4158"><span class='Ref_to_Parameter'>opfamily</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN4161"><span class='Ref_To_Local'>datatype</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN4161"><span class='Ref_To_Local'>datatype</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../../include/access/stratnum.h.html#LN29"><span class='Ref_to_Const'>BTLessEqualStrategyNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN4163"><span class='Ref_To_Local'>opr2oid</span></a> <span class='Operator'>== </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"no &LT;= operator for opfamily %u"</span><span class='Delimiter'>, </span><a href="indxpath.c.html#LN4158"><span class='Ref_to_Parameter'>opfamily</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="indxpath.c.html#LN4165"><span class='Ref_To_Local'>opr2right</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN107"><span class='Ref_to_Proto'>network_scan_last</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN4158"><span class='Ref_to_Parameter'>rightop</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="indxpath.c.html#LN4167"><span class='Ref_To_Local'>expr</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/clauses.h.html#LN29"><span class='Ref_to_Proto'>make_opclause</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN4163"><span class='Ref_To_Local'>opr2oid</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN17"><span class='Ref_to_Const'>BOOLOID</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                         <span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="indxpath.c.html#LN4158"><span class='Ref_to_Parameter'>leftop</span></a><span class='Delimiter'>, 
</span>                         <span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/makefuncs.h.html#LN49"><span class='Ref_to_Proto'>makeConst</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN4161"><span class='Ref_To_Local'>datatype</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                            <a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><span class='Comment_Single_Line'>/* not collatable */ 
</span>                                            <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="indxpath.c.html#LN4165"><span class='Ref_To_Local'>opr2right</span></a><span class='Delimiter'>, 
</span>                                            <span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="indxpath.c.html#LN4166"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN4166"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="../../../include/optimizer/restrictinfo.h.html#LN20"><span class='Ref_to_Macro'>make_simple_restrictinfo</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN4167"><span class='Ref_To_Local'>expr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="indxpath.c.html#LN4166"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end network_prefix_quals &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Handy subroutines for match_special_index_operator() and friends. 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Generate a Datum of the appropriate type from a C string. 
 * Note that all of the supported types are pass-by-ref, so the 
 * returned value should be pfree'd if no longer needed. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4245"></a><span class='Declare_Function'>string_to_datum</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>datatype</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * We cheat a little by assuming that CStringGetTextDatum() will do for 
     * bpchar and varchar constants too... 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN4245"><span class='Ref_to_Parameter'>datatype</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN20"><span class='Ref_to_Const'>NAMEOID</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="../../utils/adt/name.c.html#LN44"><span class='Ref_to_Func'>namein</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN4245"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN4245"><span class='Ref_to_Parameter'>datatype</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN18"><span class='Ref_to_Const'>BYTEAOID</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="../../utils/adt/varlena.c.html#LN253"><span class='Ref_to_Func'>byteain</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN4245"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> <a href="../../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN4245"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Generate a Const node of the appropriate type from a C string. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a> <span class='Operator'>* 
</span><a name="LN4263"></a><span class='Declare_Function'>string_to_const</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>datatype</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4265"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>conval</span> <span class='Operator'>= </span><a href="indxpath.c.html#LN189"><span class='Ref_to_Proto'>string_to_datum</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN4263"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN4263"><span class='Ref_to_Parameter'>datatype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4266"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>collation</span><span class='Delimiter'>; 
</span><a name="LN4267"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>constlen</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We only need to support a few datatypes here, so hard-wire properties 
     * instead of incurring the expense of catalog lookups. 
     */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="indxpath.c.html#LN4263"><span class='Ref_to_Parameter'>datatype</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN49"><span class='Ref_to_Const'>VARCHAROID</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN48"><span class='Ref_to_Const'>BPCHAROID</span></a><span class='Operator'>: 
</span>            <a href="indxpath.c.html#LN4266"><span class='Ref_To_Local'>collation</span></a> <span class='Operator'>= </span><a href="../../../include/catalog/pg_collation.h.html#LN74"><span class='Ref_to_Const'>DEFAULT_COLLATION_OID</span></a><span class='Delimiter'>; 
</span>            <a href="indxpath.c.html#LN4267"><span class='Ref_To_Local'>constlen</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN20"><span class='Ref_to_Const'>NAMEOID</span></a><span class='Operator'>: 
</span>            <a href="indxpath.c.html#LN4266"><span class='Ref_To_Local'>collation</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>            <a href="indxpath.c.html#LN4267"><span class='Ref_To_Local'>constlen</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/include/sqlda-native.h.html#LN15"><span class='Ref_to_Const'>NAMEDATALEN</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN18"><span class='Ref_to_Const'>BYTEAOID</span></a><span class='Operator'>: 
</span>            <a href="indxpath.c.html#LN4266"><span class='Ref_To_Local'>collation</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>            <a href="indxpath.c.html#LN4267"><span class='Ref_To_Local'>constlen</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected datatype in string_to_const: %u"</span><span class='Delimiter'>, 
</span>                 <a href="indxpath.c.html#LN4263"><span class='Ref_to_Parameter'>datatype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch datatype &raquo; </span> 
 
    <span class='Control'>return</span> <a href="../../../include/nodes/makefuncs.h.html#LN49"><span class='Ref_to_Proto'>makeConst</span></a><span class='Parentheses'>(</span><a href="indxpath.c.html#LN4263"><span class='Ref_to_Parameter'>datatype</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="indxpath.c.html#LN4266"><span class='Ref_To_Local'>collation</span></a><span class='Delimiter'>, </span><a href="indxpath.c.html#LN4267"><span class='Ref_To_Local'>constlen</span></a><span class='Delimiter'>, 
</span>                     <a href="indxpath.c.html#LN4265"><span class='Ref_To_Local'>conval</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end string_to_const &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>