<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\optimizer\plan\setrefs.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\optimizer\plan\setrefs.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:42 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * setrefs.c 
 *    Post-processing of a completed plan tree: fix references to subplan 
 *    vars, compute regproc values for operators, etc 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/optimizer/plan/setrefs.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/transam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"nodes/makefuncs.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"nodes/nodeFuncs.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/pathnode.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/planmain.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/planner.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/tlist.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"tcop/utility.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/syscache.h"</span> 
 
 
<span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN32"></a>    <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a>       <span class='Declare_Member'>varno</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* RT index of Var */ 
</span><a name="LN33"></a>    <a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Member'>varattno</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* attr number of Var */ 
</span><a name="LN34"></a>    <a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Member'>resno</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* TLE position of Var */ 
</span><a name="LN35"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>tlist_vinfo</span><span class='Delimiter'>; 
</span> 
<span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN39"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>tlist</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* underlying target list */ 
</span><a name="LN40"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>num_vars</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* number of plain Var tlist entries */ 
</span><a name="LN41"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>has_ph_vars</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* are there PlaceHolderVar entries? */ 
</span><a name="LN42"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>has_non_vars</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* are there other entries? */ 
</span><a name="LN43"></a>    <a href="setrefs.c.html#LN30"><span class='Ref_to_Typedef'>tlist_vinfo</span></a> <span class='Declare_Member'>vars</span><span class='Delimiter'>[</span>FLEXIBLE_ARRAY_MEMBER<span class='Delimiter'>];</span>    <span class='Comment_Single_Line'>/* has num_vars entries */ 
</span><a name="LN44"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>indexed_tlist</span><span class='Delimiter'>; 
</span> 
<span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN48"></a>    <a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Member'>root</span><span class='Delimiter'>; 
</span><a name="LN49"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>rtoffset</span><span class='Delimiter'>; 
</span><a name="LN50"></a>} <span class='Declare_Typedef'>fix_scan_expr_context</span><span class='Delimiter'>; 
</span> 
<span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN54"></a>    <a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Member'>root</span><span class='Delimiter'>; 
</span><a name="LN55"></a>    <a href="setrefs.c.html#LN37"><span class='Ref_to_Typedef'>indexed_tlist</span></a> <span class='Operator'>*</span><span class='Declare_Member'>outer_itlist</span><span class='Delimiter'>; 
</span><a name="LN56"></a>    <a href="setrefs.c.html#LN37"><span class='Ref_to_Typedef'>indexed_tlist</span></a> <span class='Operator'>*</span><span class='Declare_Member'>inner_itlist</span><span class='Delimiter'>; 
</span><a name="LN57"></a>    <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a>       <span class='Declare_Member'>acceptable_rel</span><span class='Delimiter'>; 
</span><a name="LN58"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>rtoffset</span><span class='Delimiter'>; 
</span><a name="LN59"></a>} <span class='Declare_Typedef'>fix_join_expr_context</span><span class='Delimiter'>; 
</span> 
<span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN63"></a>    <a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Member'>root</span><span class='Delimiter'>; 
</span><a name="LN64"></a>    <a href="setrefs.c.html#LN37"><span class='Ref_to_Typedef'>indexed_tlist</span></a> <span class='Operator'>*</span><span class='Declare_Member'>subplan_itlist</span><span class='Delimiter'>; 
</span><a name="LN65"></a>    <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a>       <span class='Declare_Member'>newvarno</span><span class='Delimiter'>; 
</span><a name="LN66"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>rtoffset</span><span class='Delimiter'>; 
</span><a name="LN67"></a>} <span class='Declare_Typedef'>fix_upper_expr_context</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Check if a Const node is a regclass value.  We accept plain OID too, 
 * since a regclass Const will get folded to that type if it's an argument 
 * to oideq or similar operators.  (This might result in some extraneous 
 * values in a plan's list of relation dependencies, but the worst result 
 * would be occasional useless replans.) 
 */ 
</span><a name="LN76"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>ISREGCLASSCONST</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>con</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>(((</span><a href="setrefs.c.html#LN76"><span class='Ref_to_Parameter'>con</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>consttype <span class='Operator'>== </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN63"><span class='Ref_to_Const'>REGCLASSOID</span></a> <span class='Operator'>|| </span><span class='Parentheses'>(</span><a href="setrefs.c.html#LN76"><span class='Ref_to_Parameter'>con</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>consttype <span class='Operator'>== </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN27"><span class='Ref_to_Const'>OIDOID</span></a><span class='Parentheses'>)</span> <span class='Operator'>&& \ 
</span>     <span class='Operator'>!</span><span class='Parentheses'>(</span><a href="setrefs.c.html#LN76"><span class='Ref_to_Parameter'>con</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>constisnull<span class='Parentheses'>)</span> 
 
<a name="LN80"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>fix_scan_list</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>lst</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>rtoffset</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>((</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>)</span> <a href="setrefs.c.html#LN101"><span class='Ref_to_Proto'>fix_scan_expr</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN80"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="setrefs.c.html#LN80"><span class='Ref_to_Parameter'>lst</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="setrefs.c.html#LN80"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>))</span> 
 
<a name="LN83"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>add_rtes_to_flat_rtable</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>recursing</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN84"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>flatten_unplanned_rtes</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN91"><span class='Ref_to_Struct'>PlannerGlobal</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>glob</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rte</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN85"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>flatten_rtes_walker</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN91"><span class='Ref_to_Struct'>PlannerGlobal</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>glob</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN86"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>add_rte_to_flat_rtable</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN91"><span class='Ref_to_Struct'>PlannerGlobal</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>glob</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rte</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN87"></a><span class='Keyword'>static </span><a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>set_plan_refs</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>plan</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>rtoffset</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN88"></a><span class='Keyword'>static </span><a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>set_indexonlyscan_references</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN89"></a>                             <a href="../../../include/nodes/plannodes.h.html#LN414"><span class='Ref_to_Struct'>IndexOnlyScan</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>plan</span><span class='Delimiter'>, 
</span><a name="LN90"></a>                             <span class='Keyword'>int </span><span class='Declare_Parameter'>rtoffset</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN91"></a><span class='Keyword'>static </span><a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>set_subqueryscan_references</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN92"></a>                            <a href="../../../include/nodes/plannodes.h.html#LN494"><span class='Ref_to_Struct'>SubqueryScan</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>plan</span><span class='Delimiter'>, 
</span><a name="LN93"></a>                            <span class='Keyword'>int </span><span class='Declare_Parameter'>rtoffset</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN94"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>trivial_subqueryscan</span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN494"><span class='Ref_to_Struct'>SubqueryScan</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>plan</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN95"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>set_foreignscan_references</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN96"></a>                           <a href="../../../include/nodes/plannodes.h.html#LN594"><span class='Ref_to_Struct'>ForeignScan</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fscan</span><span class='Delimiter'>, 
</span><a name="LN97"></a>                           <span class='Keyword'>int </span><span class='Declare_Parameter'>rtoffset</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN98"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>set_customscan_references</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN99"></a>                          <a href="../../../include/nodes/plannodes.h.html#LN623"><span class='Ref_to_Struct'>CustomScan</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cscan</span><span class='Delimiter'>, 
</span><a name="LN100"></a>                          <span class='Keyword'>int </span><span class='Declare_Parameter'>rtoffset</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN101"></a><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>fix_scan_expr</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>rtoffset</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN102"></a><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>fix_scan_expr_mutator</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><a href="setrefs.c.html#LN46"><span class='Ref_to_Typedef'>fix_scan_expr_context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN103"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>fix_scan_expr_walker</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><a href="setrefs.c.html#LN46"><span class='Ref_to_Typedef'>fix_scan_expr_context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN104"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>set_join_references</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/plannodes.h.html#LN665"><span class='Ref_to_Struct'>Join</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>join</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>rtoffset</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN105"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>set_upper_references</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>plan</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>rtoffset</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN106"></a><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>convert_combining_aggrefs</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN107"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>set_dummy_tlist_references</span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>plan</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>rtoffset</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN108"></a><span class='Keyword'>static </span><a href="setrefs.c.html#LN37"><span class='Ref_to_Typedef'>indexed_tlist</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>build_tlist_index</span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tlist</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN109"></a><span class='Keyword'>static </span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>search_indexed_tlist_for_var</span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Delimiter'>, 
</span><a name="LN110"></a>                             <a href="setrefs.c.html#LN37"><span class='Ref_to_Typedef'>indexed_tlist</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>itlist</span><span class='Delimiter'>, 
</span><a name="LN111"></a>                             <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>newvarno</span><span class='Delimiter'>, 
</span><a name="LN112"></a>                             <span class='Keyword'>int </span><span class='Declare_Parameter'>rtoffset</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN113"></a><span class='Keyword'>static </span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>search_indexed_tlist_for_non_var</span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, 
</span><a name="LN114"></a>                                 <a href="setrefs.c.html#LN37"><span class='Ref_to_Typedef'>indexed_tlist</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>itlist</span><span class='Delimiter'>, 
</span><a name="LN115"></a>                                 <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>newvarno</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN116"></a><span class='Keyword'>static </span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>search_indexed_tlist_for_sortgroupref</span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, 
</span><a name="LN117"></a>                                      <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>sortgroupref</span><span class='Delimiter'>, 
</span><a name="LN118"></a>                                      <a href="setrefs.c.html#LN37"><span class='Ref_to_Typedef'>indexed_tlist</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>itlist</span><span class='Delimiter'>, 
</span><a name="LN119"></a>                                      <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>newvarno</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN120"></a><span class='Keyword'>static </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>fix_join_expr</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN121"></a>              <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>clauses</span><span class='Delimiter'>, 
</span><a name="LN122"></a>              <a href="setrefs.c.html#LN37"><span class='Ref_to_Typedef'>indexed_tlist</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>outer_itlist</span><span class='Delimiter'>, 
</span><a name="LN123"></a>              <a href="setrefs.c.html#LN37"><span class='Ref_to_Typedef'>indexed_tlist</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>inner_itlist</span><span class='Delimiter'>, 
</span><a name="LN124"></a>              <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>acceptable_rel</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>rtoffset</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN125"></a><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>fix_join_expr_mutator</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, 
</span><a name="LN126"></a>                      <a href="setrefs.c.html#LN52"><span class='Ref_to_Typedef'>fix_join_expr_context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN127"></a><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>fix_upper_expr</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN128"></a>               <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, 
</span><a name="LN129"></a>               <a href="setrefs.c.html#LN37"><span class='Ref_to_Typedef'>indexed_tlist</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>subplan_itlist</span><span class='Delimiter'>, 
</span><a name="LN130"></a>               <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>newvarno</span><span class='Delimiter'>, 
</span><a name="LN131"></a>               <span class='Keyword'>int </span><span class='Declare_Parameter'>rtoffset</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN132"></a><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>fix_upper_expr_mutator</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, 
</span><a name="LN133"></a>                       <a href="setrefs.c.html#LN61"><span class='Ref_to_Typedef'>fix_upper_expr_context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN134"></a><span class='Keyword'>static </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>set_returning_clause_references</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN135"></a>                                <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rlist</span><span class='Delimiter'>, 
</span><a name="LN136"></a>                                <a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>topplan</span><span class='Delimiter'>, 
</span><a name="LN137"></a>                                <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>resultRelation</span><span class='Delimiter'>, 
</span><a name="LN138"></a>                                <span class='Keyword'>int </span><span class='Declare_Parameter'>rtoffset</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN139"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>extract_query_dependencies_walker</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, 
</span><a name="LN140"></a>                                  <a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/***************************************************************************** 
 * 
 *      SUBPLAN REFERENCES 
 * 
 *****************************************************************************/ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * set_plan_references 
 * 
 * This is the final processing pass of the planner/optimizer.  The plan 
 * tree is complete; we just have to adjust some representational details 
 * for the convenience of the executor: 
 * 
 * 1. We flatten the various subquery rangetables into a single list, and 
 * zero out RangeTblEntry fields that are not useful to the executor. 
 * 
 * 2. We adjust Vars in scan nodes to be consistent with the flat rangetable. 
 * 
 * 3. We adjust Vars in upper plan nodes to refer to the outputs of their 
 * subplans. 
 * 
 * 4. Aggrefs in Agg plan nodes need to be adjusted in some cases involving 
 * partial aggregation or minmax aggregate optimization. 
 * 
 * 5. PARAM_MULTIEXPR Params are replaced by regular PARAM_EXEC Params, 
 * now that we have finished planning all MULTIEXPR subplans. 
 * 
 * 6. We compute regproc OIDs for operators (ie, we look up the function 
 * that implements each op). 
 * 
 * 7. We create lists of specific objects that the plan depends on. 
 * This will be used by plancache.c to drive invalidation of cached plans. 
 * Relation dependencies are represented by OIDs, and everything else by 
 * PlanInvalItems (this distinction is motivated by the shared-inval APIs). 
 * Currently, relations and user-defined functions are the only types of 
 * objects that are explicitly tracked this way. 
 * 
 * 8. We assign every plan node in the tree a unique ID. 
 * 
 * We also perform one final optimization step, which is to delete 
 * SubqueryScan plan nodes that aren't doing anything useful (ie, have 
 * no qual and a no-op targetlist).  The reason for doing this last is that 
 * it can't readily be done before set_plan_references, because it would 
 * break set_upper_references: the Vars in the subquery's top tlist 
 * wouldn't match up with the Vars in the outer plan tree.  The SubqueryScan 
 * serves a necessary function as a buffer between outer query and subquery 
 * variable numbering ... but after we've flattened the rangetable this is 
 * no longer a problem, since then there's only one rtindex namespace. 
 * 
 * set_plan_references recursively traverses the whole plan tree. 
 * 
 * The return value is normally the same Plan node passed in, but can be 
 * different when the passed-in Plan is a SubqueryScan we decide isn't needed. 
 * 
 * The flattened rangetable entries are appended to root-&GT;glob-&GT;finalrtable. 
 * Also, rowmarks entries are appended to root-&GT;glob-&GT;finalrowmarks, and the 
 * RT indexes of ModifyTable result relations to root-&GT;glob-&GT;resultRelations. 
 * Plan dependencies are appended to root-&GT;glob-&GT;relationOids (for relations) 
 * and root-&GT;glob-&GT;invalItems (for everything else). 
 * 
 * Notice that we modify Plan nodes in-place, but use expression_tree_mutator 
 * to process targetlist and qual expressions.  We can assume that the Plan 
 * nodes were just built by the planner and are not multiply referenced, but 
 * it's not so safe to assume that for expression tree nodes. 
 */ 
</span><a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>* 
</span><a name="LN208"></a><span class='Declare_Function'>set_plan_references</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>plan</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN210"></a>    <a href="../../../include/nodes/relation.h.html#LN91"><span class='Ref_to_Struct'>PlannerGlobal</span></a> <span class='Operator'>*</span><span class='Declare_Local'>glob</span> <span class='Operator'>= </span><a href="setrefs.c.html#LN208"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Delimiter'>; 
</span><a name="LN211"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>rtoffset</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN210"><span class='Ref_To_Local'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN103"><span class='Ref_to_Member'>finalrtable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN212"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Add all the query's RTEs to the flattened rangetable.  The live ones 
     * will have their rangetable indexes increased by rtoffset.  (Additional 
     * RTEs, not referenced by the Plan tree, might get added after those.) 
     */ 
</span>    <a href="setrefs.c.html#LN83"><span class='Ref_to_Proto'>add_rtes_to_flat_rtable</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN208"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Adjust RT indexes of PlanRowMarks and add to final rowmarks list 
     */ 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN212"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN208"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN255"><span class='Ref_to_Member'>rowMarks</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN226"></a>        <a href="../../../include/nodes/plannodes.h.html#LN1002"><span class='Ref_to_Struct'>PlanRowMark</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rc</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN108"><span class='Ref_to_Macro'>lfirst_node</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN1002"><span class='Ref_to_Struct'>PlanRowMark</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN212"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN227"></a>        <a href="../../../include/nodes/plannodes.h.html#LN1002"><span class='Ref_to_Struct'>PlanRowMark</span></a> <span class='Operator'>*</span><span class='Declare_Local'>newrc</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* flat copy is enough since all fields are scalars */ 
</span>        <a href="setrefs.c.html#LN227"><span class='Ref_To_Local'>newrc</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN1002"><span class='Ref_to_Struct'>PlanRowMark</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN1002"><span class='Ref_to_Struct'>PlanRowMark</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><a href="setrefs.c.html#LN227"><span class='Ref_To_Local'>newrc</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN226"><span class='Ref_To_Local'>rc</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN1002"><span class='Ref_to_Struct'>PlanRowMark</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* adjust indexes ... but *not* the rowmarkId */ 
</span>        <a href="setrefs.c.html#LN227"><span class='Ref_To_Local'>newrc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN1005"><span class='Ref_to_Member'>rti</span></a> <span class='Operator'>+= </span><a href="setrefs.c.html#LN211"><span class='Ref_To_Local'>rtoffset</span></a><span class='Delimiter'>; 
</span>        <a href="setrefs.c.html#LN227"><span class='Ref_To_Local'>newrc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN1006"><span class='Ref_to_Member'>prti</span></a> <span class='Operator'>+= </span><a href="setrefs.c.html#LN211"><span class='Ref_To_Local'>rtoffset</span></a><span class='Delimiter'>; 
</span> 
        <a href="setrefs.c.html#LN210"><span class='Ref_To_Local'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN105"><span class='Ref_to_Member'>finalrowmarks</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN210"><span class='Ref_To_Local'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN105"><span class='Ref_to_Member'>finalrowmarks</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN227"><span class='Ref_To_Local'>newrc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Now fix the Plan tree */ 
</span>    <span class='Control'>return</span> <a href="setrefs.c.html#LN87"><span class='Ref_to_Proto'>set_plan_refs</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN208"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN208"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN211"><span class='Ref_To_Local'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end set_plan_references &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Extract RangeTblEntries from the plan's rangetable, and add to flat rtable 
 * 
 * This can recurse into subquery plans; "recursing" is true if so. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN250"></a><span class='Declare_Function'>add_rtes_to_flat_rtable</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>recursing</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN252"></a>    <a href="../../../include/nodes/relation.h.html#LN91"><span class='Ref_to_Struct'>PlannerGlobal</span></a> <span class='Operator'>*</span><span class='Declare_Local'>glob</span> <span class='Operator'>= </span><a href="setrefs.c.html#LN250"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Delimiter'>; 
</span><a name="LN253"></a>    <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a>       <span class='Declare_Local'>rti</span><span class='Delimiter'>; 
</span><a name="LN254"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Add the query's own RTEs to the flattened rangetable. 
     * 
     * At top level, we must add all RTEs so that their indexes in the 
     * flattened rangetable match up with their original indexes.  When 
     * recursing, we only care about extracting relation RTEs. 
     */ 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN254"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN250"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN134"><span class='Ref_to_Member'>rtable</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN265"></a>        <a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rte</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN254"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="setrefs.c.html#LN250"><span class='Ref_to_Parameter'>recursing</span></a> <span class='Operator'>|| </span><a href="setrefs.c.html#LN265"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN936"><span class='Ref_to_Member'>rtekind</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/parsenodes.h.html#LN922"><span class='Ref_to_EnumConst'>RTE_RELATION</span></a><span class='Parentheses'>) 
</span>            <a href="setrefs.c.html#LN86"><span class='Ref_to_Proto'>add_rte_to_flat_rtable</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN252"><span class='Ref_To_Local'>glob</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN265"><span class='Ref_To_Local'>rte</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If there are any dead subqueries, they are not referenced in the Plan 
     * tree, so we must add RTEs contained in them to the flattened rtable 
     * separately.  (If we failed to do this, the executor would not perform 
     * expected permission checks for tables mentioned in such subqueries.) 
     * 
     * Note: this pass over the rangetable can't be combined with the previous 
     * one, because that would mess up the numbering of the live RTEs in the 
     * flattened rangetable. 
     */ 
</span>    <a href="setrefs.c.html#LN253"><span class='Ref_To_Local'>rti</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN254"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN250"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN134"><span class='Ref_to_Member'>rtable</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN284"></a>        <a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rte</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN254"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We should ignore inheritance-parent RTEs: their contents have been 
         * pulled up into our rangetable already.  Also ignore any subquery 
         * RTEs without matching RelOptInfos, as they likewise have been 
         * pulled up. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN284"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN936"><span class='Ref_to_Member'>rtekind</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/parsenodes.h.html#LN923"><span class='Ref_to_EnumConst'>RTE_SUBQUERY</span></a> <span class='Operator'>&& !</span><a href="setrefs.c.html#LN284"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1025"><span class='Ref_to_Member'>inh</span></a> <span class='Operator'>&& 
</span>            <a href="setrefs.c.html#LN253"><span class='Ref_To_Local'>rti</span></a> <span class='Operator'>&LT; </span><a href="setrefs.c.html#LN250"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN179"><span class='Ref_to_Member'>simple_rel_array_size</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN295"></a>            <a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rel</span> <span class='Operator'>= </span><a href="setrefs.c.html#LN250"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN178"><span class='Ref_to_Member'>simple_rel_array</span></a><span class='Delimiter'>[</span><a href="setrefs.c.html#LN253"><span class='Ref_To_Local'>rti</span></a><span class='Delimiter'>]; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN295"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="setrefs.c.html#LN295"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN552"><span class='Ref_to_Member'>relid</span></a> <span class='Operator'>== </span><a href="setrefs.c.html#LN253"><span class='Ref_To_Local'>rti</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* sanity check on array */ 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * The subquery might never have been planned at all, if it 
                 * was excluded on the basis of self-contradictory constraints 
                 * in our query level.  In this case apply 
                 * flatten_unplanned_rtes. 
                 * 
                 * If it was planned but the result rel is dummy, we assume 
                 * that it has been omitted from our plan tree (see 
                 * set_subquery_pathlist), and recurse to pull up its RTEs. 
                 * 
                 * Otherwise, it should be represented by a SubqueryScan node 
                 * somewhere in our plan tree, and we'll pull up its RTEs when 
                 * we process that plan node. 
                 * 
                 * However, if we're recursing, then we should pull up RTEs 
                 * whether the subquery is dummy or not, because we've found 
                 * that some upper query level is treating this one as dummy, 
                 * and so we won't scan this level's plan tree at all. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN295"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN566"><span class='Ref_to_Member'>subroot</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <a href="setrefs.c.html#LN84"><span class='Ref_to_Proto'>flatten_unplanned_rtes</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN252"><span class='Ref_To_Local'>glob</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN284"><span class='Ref_To_Local'>rte</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN250"><span class='Ref_to_Parameter'>recursing</span></a> <span class='Operator'>|| 
</span>                         <a href="../../../include/nodes/relation.h.html#LN1186"><span class='Ref_to_Macro'>IS_DUMMY_REL</span></a><span class='Parentheses'>(</span><a href="../../../include/optimizer/pathnode.h.html#LN270"><span class='Ref_to_Proto'>fetch_upper_rel</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN295"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN566"><span class='Ref_to_Member'>subroot</span></a><span class='Delimiter'>, 
</span>                                                      <a href="../../../include/nodes/relation.h.html#LN77"><span class='Ref_to_EnumConst'>UPPERREL_FINAL</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)))</span> 
                    <a href="setrefs.c.html#LN83"><span class='Ref_to_Proto'>add_rtes_to_flat_rtable</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN295"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN566"><span class='Ref_to_Member'>subroot</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if rel!=NULL &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if rte-&GT;rtekind==RTE_SUB... &raquo; </span> 
        <a href="setrefs.c.html#LN253"><span class='Ref_To_Local'>rti</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end add_rtes_to_flat_rtable &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Extract RangeTblEntries from a subquery that was never planned at all 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN336"></a><span class='Declare_Function'>flatten_unplanned_rtes</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN91"><span class='Ref_to_Struct'>PlannerGlobal</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>glob</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rte</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Use query_tree_walker to find all RTEs in the parse tree */ 
</span>    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../../include/nodes/nodeFuncs.h.html#LN57"><span class='Ref_to_Proto'>query_tree_walker</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN336"><span class='Ref_to_Parameter'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN954"><span class='Ref_to_Member'>subquery</span></a><span class='Delimiter'>, 
</span>                             <a href="setrefs.c.html#LN85"><span class='Ref_to_Proto'>flatten_rtes_walker</span></a><span class='Delimiter'>, 
</span>                             <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN336"><span class='Ref_to_Parameter'>glob</span></a><span class='Delimiter'>, 
</span>                             <a href="../../../include/nodes/nodeFuncs.h.html#LN24"><span class='Ref_to_Const'>QTW_EXAMINE_RTES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static bool 
</span><a name="LN346"></a><span class='Declare_Function'>flatten_rtes_walker</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN91"><span class='Ref_to_Struct'>PlannerGlobal</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>glob</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN346"><span class='Ref_to_Parameter'>node</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN346"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN352"></a>        <a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rte</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN346"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* As above, we need only save relation RTEs */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN352"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN936"><span class='Ref_to_Member'>rtekind</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/parsenodes.h.html#LN922"><span class='Ref_to_EnumConst'>RTE_RELATION</span></a><span class='Parentheses'>) 
</span>            <a href="setrefs.c.html#LN86"><span class='Ref_to_Proto'>add_rte_to_flat_rtable</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN346"><span class='Ref_to_Parameter'>glob</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN352"><span class='Ref_To_Local'>rte</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN346"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Recurse into subselects */ 
</span>        <span class='Control'>return</span> <a href="../../../include/nodes/nodeFuncs.h.html#LN57"><span class='Ref_to_Proto'>query_tree_walker</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN346"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, 
</span>                                 <a href="setrefs.c.html#LN85"><span class='Ref_to_Proto'>flatten_rtes_walker</span></a><span class='Delimiter'>, 
</span>                                 <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN346"><span class='Ref_to_Parameter'>glob</span></a><span class='Delimiter'>, 
</span>                                 <a href="../../../include/nodes/nodeFuncs.h.html#LN24"><span class='Ref_to_Const'>QTW_EXAMINE_RTES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="../../../include/nodes/nodeFuncs.h.html#LN52"><span class='Ref_to_Proto'>expression_tree_walker</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN346"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN85"><span class='Ref_to_Proto'>flatten_rtes_walker</span></a><span class='Delimiter'>, 
</span>                                  <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN346"><span class='Ref_to_Parameter'>glob</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end flatten_rtes_walker &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Add (a copy of) the given RTE to the final rangetable 
 * 
 * In the flat rangetable, we zero out substructure pointers that are not 
 * needed by the executor; this reduces the storage space and copying cost 
 * for cached plans.  We keep only the ctename, alias and eref Alias fields, 
 * which are needed by EXPLAIN, and the selectedCols, insertedCols and 
 * updatedCols bitmaps, which are needed for executor-startup permissions 
 * checking and for trigger event checking. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN382"></a><span class='Declare_Function'>add_rte_to_flat_rtable</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN91"><span class='Ref_to_Struct'>PlannerGlobal</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>glob</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rte</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN384"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>newrte</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* flat copy to duplicate all the scalar fields */ 
</span>    <a href="setrefs.c.html#LN384"><span class='Ref_To_Local'>newrte</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="setrefs.c.html#LN384"><span class='Ref_To_Local'>newrte</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN382"><span class='Ref_to_Parameter'>rte</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* zap unneeded sub-structure */ 
</span>    <a href="setrefs.c.html#LN384"><span class='Ref_To_Local'>newrte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN949"><span class='Ref_to_Member'>tablesample</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="setrefs.c.html#LN384"><span class='Ref_To_Local'>newrte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN954"><span class='Ref_to_Member'>subquery</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="setrefs.c.html#LN384"><span class='Ref_To_Local'>newrte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN975"><span class='Ref_to_Member'>joinaliasvars</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="setrefs.c.html#LN384"><span class='Ref_To_Local'>newrte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN985"><span class='Ref_to_Member'>functions</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="setrefs.c.html#LN384"><span class='Ref_To_Local'>newrte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN991"><span class='Ref_to_Member'>tablefunc</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="setrefs.c.html#LN384"><span class='Ref_To_Local'>newrte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN996"><span class='Ref_to_Member'>values_lists</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="setrefs.c.html#LN384"><span class='Ref_To_Local'>newrte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1012"><span class='Ref_to_Member'>coltypes</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="setrefs.c.html#LN384"><span class='Ref_To_Local'>newrte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1013"><span class='Ref_to_Member'>coltypmods</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="setrefs.c.html#LN384"><span class='Ref_To_Local'>newrte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1014"><span class='Ref_to_Member'>colcollations</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="setrefs.c.html#LN384"><span class='Ref_To_Local'>newrte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1032"><span class='Ref_to_Member'>securityQuals</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <a href="setrefs.c.html#LN382"><span class='Ref_to_Parameter'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN103"><span class='Ref_to_Member'>finalrtable</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN382"><span class='Ref_to_Parameter'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN103"><span class='Ref_to_Member'>finalrtable</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN384"><span class='Ref_To_Local'>newrte</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check for RT index overflow; it's very unlikely, but if it did happen, 
     * the executor would get confused by varnos that match the special varno 
     * values. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN156"><span class='Ref_to_Macro'>IS_SPECIAL_VARNO</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN382"><span class='Ref_to_Parameter'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN103"><span class='Ref_to_Member'>finalrtable</span></a><span class='Parentheses'>)))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_PROGRAM_LIMIT_EXCEEDED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"too many range table entries"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If it's a plain relation RTE, add the table to relationOids. 
     * 
     * We do this even though the RTE might be unreferenced in the plan tree; 
     * this would correspond to cases such as views that were expanded, child 
     * tables that were eliminated by constraint exclusion, etc. Schema 
     * invalidation on such a rel must still force rebuilding of the plan. 
     * 
     * Note we don't bother to avoid making duplicate list entries.  We could, 
     * but it would probably cost more cycles than it would save. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN384"><span class='Ref_To_Local'>newrte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN936"><span class='Ref_to_Member'>rtekind</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/parsenodes.h.html#LN922"><span class='Ref_to_EnumConst'>RTE_RELATION</span></a><span class='Parentheses'>) 
</span>        <a href="setrefs.c.html#LN382"><span class='Ref_to_Parameter'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN112"><span class='Ref_to_Member'>relationOids</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN382"><span class='Ref_to_Parameter'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN112"><span class='Ref_to_Member'>relationOids</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN384"><span class='Ref_To_Local'>newrte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN947"><span class='Ref_to_Member'>relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end add_rte_to_flat_rtable &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * set_plan_refs: recurse through the Plan nodes of a single subquery level 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>* 
</span><a name="LN433"></a><span class='Declare_Function'>set_plan_refs</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>plan</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>rtoffset</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN435"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Assign this node a unique ID. */ 
</span>    <a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN142"><span class='Ref_to_Member'>plan_node_id</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN122"><span class='Ref_to_Member'>lastPlanNodeId</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Plan-type-specific fixes 
     */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN513"><span class='Ref_to_Macro'>nodeTag</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN53"><span class='Ref_to_EnumConst'>T_SeqScan</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN450"></a>                <a href="../../../include/nodes/plannodes.h.html#LN335"><span class='Ref_to_Typedef'>SeqScan</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>splan</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN335"><span class='Ref_to_Typedef'>SeqScan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>; 
</span> 
                <a href="setrefs.c.html#LN450"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN328"><span class='Ref_to_Member'>scanrelid</span></a> <span class='Operator'>+= </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Delimiter'>; 
</span>                <a href="setrefs.c.html#LN450"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a> <span class='Operator'>= 
</span>                    <a href="setrefs.c.html#LN80"><span class='Ref_to_Macro'>fix_scan_list</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN450"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="setrefs.c.html#LN450"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a> <span class='Operator'>= 
</span>                    <a href="setrefs.c.html#LN80"><span class='Ref_to_Macro'>fix_scan_list</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN450"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN54"><span class='Ref_to_EnumConst'>T_SampleScan</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN461"></a>                <a href="../../../include/nodes/plannodes.h.html#LN341"><span class='Ref_to_Struct'>SampleScan</span></a> <span class='Operator'>*</span><span class='Declare_Local'>splan</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN341"><span class='Ref_to_Struct'>SampleScan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>; 
</span> 
                <a href="setrefs.c.html#LN461"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN343"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN328"><span class='Ref_to_Member'>scanrelid</span></a> <span class='Operator'>+= </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Delimiter'>; 
</span>                <a href="setrefs.c.html#LN461"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN343"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a> <span class='Operator'>= 
</span>                    <a href="setrefs.c.html#LN80"><span class='Ref_to_Macro'>fix_scan_list</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN461"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN343"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="setrefs.c.html#LN461"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN343"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a> <span class='Operator'>= 
</span>                    <a href="setrefs.c.html#LN80"><span class='Ref_to_Macro'>fix_scan_list</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN461"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN343"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="setrefs.c.html#LN461"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN345"><span class='Ref_to_Member'>tablesample</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN1071"><span class='Ref_to_Struct'>TableSampleClause</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>                    <a href="setrefs.c.html#LN101"><span class='Ref_to_Proto'>fix_scan_expr</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN461"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN345"><span class='Ref_to_Member'>tablesample</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN55"><span class='Ref_to_EnumConst'>T_IndexScan</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN474"></a>                <a href="../../../include/nodes/plannodes.h.html#LN385"><span class='Ref_to_Struct'>IndexScan</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>splan</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN385"><span class='Ref_to_Struct'>IndexScan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>; 
</span> 
                <a href="setrefs.c.html#LN474"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN387"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN328"><span class='Ref_to_Member'>scanrelid</span></a> <span class='Operator'>+= </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Delimiter'>; 
</span>                <a href="setrefs.c.html#LN474"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN387"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a> <span class='Operator'>= 
</span>                    <a href="setrefs.c.html#LN80"><span class='Ref_to_Macro'>fix_scan_list</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN474"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN387"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="setrefs.c.html#LN474"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN387"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a> <span class='Operator'>= 
</span>                    <a href="setrefs.c.html#LN80"><span class='Ref_to_Macro'>fix_scan_list</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN474"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN387"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="setrefs.c.html#LN474"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN389"><span class='Ref_to_Member'>indexqual</span></a> <span class='Operator'>= 
</span>                    <a href="setrefs.c.html#LN80"><span class='Ref_to_Macro'>fix_scan_list</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN474"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN389"><span class='Ref_to_Member'>indexqual</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="setrefs.c.html#LN474"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN390"><span class='Ref_to_Member'>indexqualorig</span></a> <span class='Operator'>= 
</span>                    <a href="setrefs.c.html#LN80"><span class='Ref_to_Macro'>fix_scan_list</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN474"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN390"><span class='Ref_to_Member'>indexqualorig</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="setrefs.c.html#LN474"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN391"><span class='Ref_to_Member'>indexorderby</span></a> <span class='Operator'>= 
</span>                    <a href="setrefs.c.html#LN80"><span class='Ref_to_Macro'>fix_scan_list</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN474"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN391"><span class='Ref_to_Member'>indexorderby</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="setrefs.c.html#LN474"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN392"><span class='Ref_to_Member'>indexorderbyorig</span></a> <span class='Operator'>= 
</span>                    <a href="setrefs.c.html#LN80"><span class='Ref_to_Macro'>fix_scan_list</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN474"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN392"><span class='Ref_to_Member'>indexorderbyorig</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN56"><span class='Ref_to_EnumConst'>T_IndexOnlyScan</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN493"></a>                <a href="../../../include/nodes/plannodes.h.html#LN414"><span class='Ref_to_Struct'>IndexOnlyScan</span></a> <span class='Operator'>*</span><span class='Declare_Local'>splan</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN414"><span class='Ref_to_Struct'>IndexOnlyScan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>; 
</span> 
                <span class='Control'>return</span> <a href="setrefs.c.html#LN88"><span class='Ref_to_Proto'>set_indexonlyscan_references</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN493"><span class='Ref_To_Local'>splan</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN57"><span class='Ref_to_EnumConst'>T_BitmapIndexScan</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN500"></a>                <a href="../../../include/nodes/plannodes.h.html#LN441"><span class='Ref_to_Struct'>BitmapIndexScan</span></a> <span class='Operator'>*</span><span class='Declare_Local'>splan</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN441"><span class='Ref_to_Struct'>BitmapIndexScan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>; 
</span> 
                <a href="setrefs.c.html#LN500"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN443"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN328"><span class='Ref_to_Member'>scanrelid</span></a> <span class='Operator'>+= </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* no need to fix targetlist and qual */ 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="setrefs.c.html#LN500"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN443"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="setrefs.c.html#LN500"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN443"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="setrefs.c.html#LN500"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN446"><span class='Ref_to_Member'>indexqual</span></a> <span class='Operator'>= 
</span>                    <a href="setrefs.c.html#LN80"><span class='Ref_to_Macro'>fix_scan_list</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN500"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN446"><span class='Ref_to_Member'>indexqual</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="setrefs.c.html#LN500"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN447"><span class='Ref_to_Member'>indexqualorig</span></a> <span class='Operator'>= 
</span>                    <a href="setrefs.c.html#LN80"><span class='Ref_to_Macro'>fix_scan_list</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN500"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN447"><span class='Ref_to_Member'>indexqualorig</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN58"><span class='Ref_to_EnumConst'>T_BitmapHeapScan</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN514"></a>                <a href="../../../include/nodes/plannodes.h.html#LN459"><span class='Ref_to_Struct'>BitmapHeapScan</span></a> <span class='Operator'>*</span><span class='Declare_Local'>splan</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN459"><span class='Ref_to_Struct'>BitmapHeapScan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>; 
</span> 
                <a href="setrefs.c.html#LN514"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN461"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN328"><span class='Ref_to_Member'>scanrelid</span></a> <span class='Operator'>+= </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Delimiter'>; 
</span>                <a href="setrefs.c.html#LN514"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN461"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a> <span class='Operator'>= 
</span>                    <a href="setrefs.c.html#LN80"><span class='Ref_to_Macro'>fix_scan_list</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN514"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN461"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="setrefs.c.html#LN514"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN461"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a> <span class='Operator'>= 
</span>                    <a href="setrefs.c.html#LN80"><span class='Ref_to_Macro'>fix_scan_list</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN514"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN461"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="setrefs.c.html#LN514"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN462"><span class='Ref_to_Member'>bitmapqualorig</span></a> <span class='Operator'>= 
</span>                    <a href="setrefs.c.html#LN80"><span class='Ref_to_Macro'>fix_scan_list</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN514"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN462"><span class='Ref_to_Member'>bitmapqualorig</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN59"><span class='Ref_to_EnumConst'>T_TidScan</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN527"></a>                <a href="../../../include/nodes/plannodes.h.html#LN472"><span class='Ref_to_Struct'>TidScan</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>splan</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN472"><span class='Ref_to_Struct'>TidScan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>; 
</span> 
                <a href="setrefs.c.html#LN527"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN474"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN328"><span class='Ref_to_Member'>scanrelid</span></a> <span class='Operator'>+= </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Delimiter'>; 
</span>                <a href="setrefs.c.html#LN527"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN474"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a> <span class='Operator'>= 
</span>                    <a href="setrefs.c.html#LN80"><span class='Ref_to_Macro'>fix_scan_list</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN527"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN474"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="setrefs.c.html#LN527"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN474"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a> <span class='Operator'>= 
</span>                    <a href="setrefs.c.html#LN80"><span class='Ref_to_Macro'>fix_scan_list</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN527"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN474"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="setrefs.c.html#LN527"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN475"><span class='Ref_to_Member'>tidquals</span></a> <span class='Operator'>= 
</span>                    <a href="setrefs.c.html#LN80"><span class='Ref_to_Macro'>fix_scan_list</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN527"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN475"><span class='Ref_to_Member'>tidquals</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN60"><span class='Ref_to_EnumConst'>T_SubqueryScan</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* Needs special treatment, see comments below */ 
</span>            <span class='Control'>return</span> <a href="setrefs.c.html#LN91"><span class='Ref_to_Proto'>set_subqueryscan_references</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                               <span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN494"><span class='Ref_to_Struct'>SubqueryScan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>, 
</span>                                               <a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN61"><span class='Ref_to_EnumConst'>T_FunctionScan</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN545"></a>                <a href="../../../include/nodes/plannodes.h.html#LN504"><span class='Ref_to_Struct'>FunctionScan</span></a> <span class='Operator'>*</span><span class='Declare_Local'>splan</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN504"><span class='Ref_to_Struct'>FunctionScan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>; 
</span> 
                <a href="setrefs.c.html#LN545"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN506"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN328"><span class='Ref_to_Member'>scanrelid</span></a> <span class='Operator'>+= </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Delimiter'>; 
</span>                <a href="setrefs.c.html#LN545"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN506"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a> <span class='Operator'>= 
</span>                    <a href="setrefs.c.html#LN80"><span class='Ref_to_Macro'>fix_scan_list</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN545"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN506"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="setrefs.c.html#LN545"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN506"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a> <span class='Operator'>= 
</span>                    <a href="setrefs.c.html#LN80"><span class='Ref_to_Macro'>fix_scan_list</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN545"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN506"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="setrefs.c.html#LN545"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN507"><span class='Ref_to_Member'>functions</span></a> <span class='Operator'>= 
</span>                    <a href="setrefs.c.html#LN80"><span class='Ref_to_Macro'>fix_scan_list</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN545"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN507"><span class='Ref_to_Member'>functions</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN63"><span class='Ref_to_EnumConst'>T_TableFuncScan</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN558"></a>                <a href="../../../include/nodes/plannodes.h.html#LN525"><span class='Ref_to_Struct'>TableFuncScan</span></a> <span class='Operator'>*</span><span class='Declare_Local'>splan</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN525"><span class='Ref_to_Struct'>TableFuncScan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>; 
</span> 
                <a href="setrefs.c.html#LN558"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN527"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN328"><span class='Ref_to_Member'>scanrelid</span></a> <span class='Operator'>+= </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Delimiter'>; 
</span>                <a href="setrefs.c.html#LN558"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN527"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a> <span class='Operator'>= 
</span>                    <a href="setrefs.c.html#LN80"><span class='Ref_to_Macro'>fix_scan_list</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN558"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN527"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="setrefs.c.html#LN558"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN527"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a> <span class='Operator'>= 
</span>                    <a href="setrefs.c.html#LN80"><span class='Ref_to_Macro'>fix_scan_list</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN558"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN527"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="setrefs.c.html#LN558"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN528"><span class='Ref_to_Member'>tablefunc</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN78"><span class='Ref_to_Struct'>TableFunc</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>                    <a href="setrefs.c.html#LN101"><span class='Ref_to_Proto'>fix_scan_expr</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN558"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN528"><span class='Ref_to_Member'>tablefunc</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN62"><span class='Ref_to_EnumConst'>T_ValuesScan</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN571"></a>                <a href="../../../include/nodes/plannodes.h.html#LN515"><span class='Ref_to_Struct'>ValuesScan</span></a> <span class='Operator'>*</span><span class='Declare_Local'>splan</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN515"><span class='Ref_to_Struct'>ValuesScan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>; 
</span> 
                <a href="setrefs.c.html#LN571"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN517"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN328"><span class='Ref_to_Member'>scanrelid</span></a> <span class='Operator'>+= </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Delimiter'>; 
</span>                <a href="setrefs.c.html#LN571"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN517"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a> <span class='Operator'>= 
</span>                    <a href="setrefs.c.html#LN80"><span class='Ref_to_Macro'>fix_scan_list</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN571"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN517"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="setrefs.c.html#LN571"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN517"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a> <span class='Operator'>= 
</span>                    <a href="setrefs.c.html#LN80"><span class='Ref_to_Macro'>fix_scan_list</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN571"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN517"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="setrefs.c.html#LN571"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN518"><span class='Ref_to_Member'>values_lists</span></a> <span class='Operator'>= 
</span>                    <a href="setrefs.c.html#LN80"><span class='Ref_to_Macro'>fix_scan_list</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN571"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN518"><span class='Ref_to_Member'>values_lists</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN64"><span class='Ref_to_EnumConst'>T_CteScan</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN584"></a>                <a href="../../../include/nodes/plannodes.h.html#LN535"><span class='Ref_to_Struct'>CteScan</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>splan</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN535"><span class='Ref_to_Struct'>CteScan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>; 
</span> 
                <a href="setrefs.c.html#LN584"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN537"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN328"><span class='Ref_to_Member'>scanrelid</span></a> <span class='Operator'>+= </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Delimiter'>; 
</span>                <a href="setrefs.c.html#LN584"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN537"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a> <span class='Operator'>= 
</span>                    <a href="setrefs.c.html#LN80"><span class='Ref_to_Macro'>fix_scan_list</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN584"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN537"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="setrefs.c.html#LN584"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN537"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a> <span class='Operator'>= 
</span>                    <a href="setrefs.c.html#LN80"><span class='Ref_to_Macro'>fix_scan_list</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN584"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN537"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN65"><span class='Ref_to_EnumConst'>T_NamedTuplestoreScan</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN595"></a>                <a href="../../../include/nodes/plannodes.h.html#LN546"><span class='Ref_to_Struct'>NamedTuplestoreScan</span></a> <span class='Operator'>*</span><span class='Declare_Local'>splan</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN546"><span class='Ref_to_Struct'>NamedTuplestoreScan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>; 
</span> 
                <a href="setrefs.c.html#LN595"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN548"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN328"><span class='Ref_to_Member'>scanrelid</span></a> <span class='Operator'>+= </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Delimiter'>; 
</span>                <a href="setrefs.c.html#LN595"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN548"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a> <span class='Operator'>= 
</span>                    <a href="setrefs.c.html#LN80"><span class='Ref_to_Macro'>fix_scan_list</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN595"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN548"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="setrefs.c.html#LN595"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN548"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a> <span class='Operator'>= 
</span>                    <a href="setrefs.c.html#LN80"><span class='Ref_to_Macro'>fix_scan_list</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN595"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN548"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN66"><span class='Ref_to_EnumConst'>T_WorkTableScan</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN606"></a>                <a href="../../../include/nodes/plannodes.h.html#LN556"><span class='Ref_to_Struct'>WorkTableScan</span></a> <span class='Operator'>*</span><span class='Declare_Local'>splan</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN556"><span class='Ref_to_Struct'>WorkTableScan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>; 
</span> 
                <a href="setrefs.c.html#LN606"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN558"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN328"><span class='Ref_to_Member'>scanrelid</span></a> <span class='Operator'>+= </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Delimiter'>; 
</span>                <a href="setrefs.c.html#LN606"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN558"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a> <span class='Operator'>= 
</span>                    <a href="setrefs.c.html#LN80"><span class='Ref_to_Macro'>fix_scan_list</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN606"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN558"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="setrefs.c.html#LN606"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN558"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a> <span class='Operator'>= 
</span>                    <a href="setrefs.c.html#LN80"><span class='Ref_to_Macro'>fix_scan_list</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN606"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN558"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN67"><span class='Ref_to_EnumConst'>T_ForeignScan</span></a><span class='Operator'>: 
</span>            <a href="setrefs.c.html#LN95"><span class='Ref_to_Proto'>set_foreignscan_references</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN594"><span class='Ref_to_Struct'>ForeignScan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN68"><span class='Ref_to_EnumConst'>T_CustomScan</span></a><span class='Operator'>: 
</span>            <a href="setrefs.c.html#LN98"><span class='Ref_to_Proto'>set_customscan_references</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN623"><span class='Ref_to_Struct'>CustomScan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN70"><span class='Ref_to_EnumConst'>T_NestLoop</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN71"><span class='Ref_to_EnumConst'>T_MergeJoin</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN72"><span class='Ref_to_EnumConst'>T_HashJoin</span></a><span class='Operator'>: 
</span>            <a href="setrefs.c.html#LN104"><span class='Ref_to_Proto'>set_join_references</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN665"><span class='Ref_to_Struct'>Join</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN79"><span class='Ref_to_EnumConst'>T_Gather</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN80"><span class='Ref_to_EnumConst'>T_GatherMerge</span></a><span class='Operator'>: 
</span>            <a href="setrefs.c.html#LN105"><span class='Ref_to_Proto'>set_upper_references</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN81"><span class='Ref_to_EnumConst'>T_Hash</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN73"><span class='Ref_to_EnumConst'>T_Material</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN74"><span class='Ref_to_EnumConst'>T_Sort</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN78"><span class='Ref_to_EnumConst'>T_Unique</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN82"><span class='Ref_to_EnumConst'>T_SetOp</span></a><span class='Operator'>: 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * These plan types don't actually bother to evaluate their 
             * targetlists, because they just return their unmodified input 
             * tuples.  Even though the targetlist won't be used by the 
             * executor, we fix it up for possible use by EXPLAIN (not to 
             * mention ease of debugging --- wrong varnos are very confusing). 
             */ 
</span>            <a href="setrefs.c.html#LN107"><span class='Ref_to_Proto'>set_dummy_tlist_references</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Since these plan types don't check quals either, we should not 
             * find any qual expression attached to them. 
             */ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN83"><span class='Ref_to_EnumConst'>T_LockRows</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN656"></a>                <a href="../../../include/nodes/plannodes.h.html#LN899"><span class='Ref_to_Struct'>LockRows</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>splan</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN899"><span class='Ref_to_Struct'>LockRows</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Like the plan types above, LockRows doesn't evaluate its 
                 * tlist or quals.  But we have to fix up the RT indexes in 
                 * its rowmarks. 
                 */ 
</span>                <a href="setrefs.c.html#LN107"><span class='Ref_to_Proto'>set_dummy_tlist_references</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="setrefs.c.html#LN656"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN901"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN435"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN656"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN902"><span class='Ref_to_Member'>rowMarks</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN668"></a>                    <a href="../../../include/nodes/plannodes.h.html#LN1002"><span class='Ref_to_Struct'>PlanRowMark</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rc</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN1002"><span class='Ref_to_Struct'>PlanRowMark</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN435"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <a href="setrefs.c.html#LN668"><span class='Ref_To_Local'>rc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN1005"><span class='Ref_to_Member'>rti</span></a> <span class='Operator'>+= </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Delimiter'>; 
</span>                    <a href="setrefs.c.html#LN668"><span class='Ref_To_Local'>rc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN1006"><span class='Ref_to_Member'>prti</span></a> <span class='Operator'>+= </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN84"><span class='Ref_to_EnumConst'>T_Limit</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN677"></a>                <a href="../../../include/nodes/plannodes.h.html#LN913"><span class='Ref_to_Struct'>Limit</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>splan</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN913"><span class='Ref_to_Struct'>Limit</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Like the plan types above, Limit doesn't evaluate its tlist 
                 * or quals.  It does have live expressions for limit/offset, 
                 * however; and those cannot contain subplan variable refs, so 
                 * fix_scan_expr works for them. 
                 */ 
</span>                <a href="setrefs.c.html#LN107"><span class='Ref_to_Proto'>set_dummy_tlist_references</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="setrefs.c.html#LN677"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN915"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="setrefs.c.html#LN677"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN916"><span class='Ref_to_Member'>limitOffset</span></a> <span class='Operator'>= 
</span>                    <a href="setrefs.c.html#LN101"><span class='Ref_to_Proto'>fix_scan_expr</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN677"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN916"><span class='Ref_to_Member'>limitOffset</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="setrefs.c.html#LN677"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN917"><span class='Ref_to_Member'>limitCount</span></a> <span class='Operator'>= 
</span>                    <a href="setrefs.c.html#LN101"><span class='Ref_to_Proto'>fix_scan_expr</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN677"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN917"><span class='Ref_to_Member'>limitCount</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN76"><span class='Ref_to_EnumConst'>T_Agg</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN696"></a>                <a href="../../../include/nodes/plannodes.h.html#LN781"><span class='Ref_to_Struct'>Agg</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>agg</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN781"><span class='Ref_to_Struct'>Agg</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * If this node is combining partial-aggregation results, we 
                 * must convert its Aggrefs to contain references to the 
                 * partial-aggregate subexpressions that will be available 
                 * from the child plan node. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN766"><span class='Ref_to_Macro'>DO_AGGSPLIT_COMBINE</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN696"><span class='Ref_To_Local'>agg</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN785"><span class='Ref_to_Member'>aggsplit</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>                        <a href="setrefs.c.html#LN106"><span class='Ref_to_Proto'>convert_combining_aggrefs</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Delimiter'>, 
</span>                                                  <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>                        <a href="setrefs.c.html#LN106"><span class='Ref_to_Proto'>convert_combining_aggrefs</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a><span class='Delimiter'>, 
</span>                                                  <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <a href="setrefs.c.html#LN105"><span class='Ref_to_Proto'>set_upper_references</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN75"><span class='Ref_to_EnumConst'>T_Group</span></a><span class='Operator'>: 
</span>            <a href="setrefs.c.html#LN105"><span class='Ref_to_Proto'>set_upper_references</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN77"><span class='Ref_to_EnumConst'>T_WindowAgg</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN722"></a>                <a href="../../../include/nodes/plannodes.h.html#LN800"><span class='Ref_to_Struct'>WindowAgg</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>wplan</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN800"><span class='Ref_to_Struct'>WindowAgg</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>; 
</span> 
                <a href="setrefs.c.html#LN105"><span class='Ref_to_Proto'>set_upper_references</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Like Limit node limit/offset expressions, WindowAgg has 
                 * frame offset expressions, which cannot contain subplan 
                 * variable refs, so fix_scan_expr works for them. 
                 */ 
</span>                <a href="setrefs.c.html#LN722"><span class='Ref_To_Local'>wplan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN811"><span class='Ref_to_Member'>startOffset</span></a> <span class='Operator'>= 
</span>                    <a href="setrefs.c.html#LN101"><span class='Ref_to_Proto'>fix_scan_expr</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN722"><span class='Ref_To_Local'>wplan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN811"><span class='Ref_to_Member'>startOffset</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="setrefs.c.html#LN722"><span class='Ref_To_Local'>wplan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN812"><span class='Ref_to_Member'>endOffset</span></a> <span class='Operator'>= 
</span>                    <a href="setrefs.c.html#LN101"><span class='Ref_to_Proto'>fix_scan_expr</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN722"><span class='Ref_To_Local'>wplan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN812"><span class='Ref_to_Member'>endOffset</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN44"><span class='Ref_to_EnumConst'>T_Result</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN739"></a>                <a href="../../../include/nodes/plannodes.h.html#LN187"><span class='Ref_to_Struct'>Result</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>splan</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN187"><span class='Ref_to_Struct'>Result</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Result may or may not have a subplan; if not, it's more 
                 * like a scan node than an upper node. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN739"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN189"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN145"><span class='Ref_to_Member'>lefttree</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <a href="setrefs.c.html#LN105"><span class='Ref_to_Proto'>set_upper_references</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="setrefs.c.html#LN739"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN189"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a> <span class='Operator'>= 
</span>                        <a href="setrefs.c.html#LN80"><span class='Ref_to_Macro'>fix_scan_list</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN739"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN189"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="setrefs.c.html#LN739"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN189"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a> <span class='Operator'>= 
</span>                        <a href="setrefs.c.html#LN80"><span class='Ref_to_Macro'>fix_scan_list</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN739"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN189"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Comment_Multi_Line'>/* resconstantqual can't contain any subplan variable refs */ 
</span>                <a href="setrefs.c.html#LN739"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN190"><span class='Ref_to_Member'>resconstantqual</span></a> <span class='Operator'>= 
</span>                    <a href="setrefs.c.html#LN101"><span class='Ref_to_Proto'>fix_scan_expr</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN739"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN190"><span class='Ref_to_Member'>resconstantqual</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN45"><span class='Ref_to_EnumConst'>T_ProjectSet</span></a><span class='Operator'>: 
</span>            <a href="setrefs.c.html#LN105"><span class='Ref_to_Proto'>set_upper_references</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN46"><span class='Ref_to_EnumConst'>T_ModifyTable</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN764"></a>                <a href="../../../include/nodes/plannodes.h.html#LN213"><span class='Ref_to_Struct'>ModifyTable</span></a> <span class='Operator'>*</span><span class='Declare_Local'>splan</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN213"><span class='Ref_to_Struct'>ModifyTable</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>; 
</span> 
                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="setrefs.c.html#LN764"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN215"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="setrefs.c.html#LN764"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN215"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="setrefs.c.html#LN764"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN225"><span class='Ref_to_Member'>withCheckOptionLists</span></a> <span class='Operator'>= 
</span>                    <a href="setrefs.c.html#LN80"><span class='Ref_to_Macro'>fix_scan_list</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN764"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN225"><span class='Ref_to_Member'>withCheckOptionLists</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN764"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN226"><span class='Ref_to_Member'>returningLists</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN774"></a>                    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>newRL</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN775"></a>                    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lcrl</span><span class='Delimiter'>, 
</span><a name="LN776"></a>                               <span class='Operator'>*</span><span class='Declare_Local'>lcrr</span><span class='Delimiter'>, 
</span><a name="LN777"></a>                               <span class='Operator'>*</span><span class='Declare_Local'>lcp</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * Pass each per-subplan returningList through 
                     * set_returning_clause_references(). 
                     */ 
</span>                    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN764"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN226"><span class='Ref_to_Member'>returningLists</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN764"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN221"><span class='Ref_to_Member'>resultRelations</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN764"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN226"><span class='Ref_to_Member'>returningLists</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN764"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN224"><span class='Ref_to_Member'>plans</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <a href="../../../include/nodes/pg_list.h.html#LN202"><span class='Ref_to_Macro'>forthree</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN775"><span class='Ref_To_Local'>lcrl</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN764"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN226"><span class='Ref_to_Member'>returningLists</span></a><span class='Delimiter'>, 
</span>                             <a href="setrefs.c.html#LN776"><span class='Ref_To_Local'>lcrr</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN764"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN221"><span class='Ref_to_Member'>resultRelations</span></a><span class='Delimiter'>, 
</span>                             <a href="setrefs.c.html#LN777"><span class='Ref_To_Local'>lcp</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN764"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN224"><span class='Ref_to_Member'>plans</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span><a name="LN789"></a>                        <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>rlist</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN775"><span class='Ref_To_Local'>lcrl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN790"></a>                        <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a>       <span class='Declare_Local'>resultrel</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN106"><span class='Ref_to_Macro'>lfirst_int</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN776"><span class='Ref_To_Local'>lcrr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN791"></a>                        <a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>subplan</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN777"><span class='Ref_To_Local'>lcp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                        <a href="setrefs.c.html#LN789"><span class='Ref_To_Local'>rlist</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN134"><span class='Ref_to_Proto'>set_returning_clause_references</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                                                <a href="setrefs.c.html#LN789"><span class='Ref_To_Local'>rlist</span></a><span class='Delimiter'>, 
</span>                                                                <a href="setrefs.c.html#LN791"><span class='Ref_To_Local'>subplan</span></a><span class='Delimiter'>, 
</span>                                                                <a href="setrefs.c.html#LN790"><span class='Ref_To_Local'>resultrel</span></a><span class='Delimiter'>, 
</span>                                                                <a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="setrefs.c.html#LN774"><span class='Ref_To_Local'>newRL</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN774"><span class='Ref_To_Local'>newRL</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN789"><span class='Ref_To_Local'>rlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <a href="setrefs.c.html#LN764"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN226"><span class='Ref_to_Member'>returningLists</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN774"><span class='Ref_To_Local'>newRL</span></a><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * Set up the visible plan targetlist as being the same as 
                     * the first RETURNING list. This is for the use of 
                     * EXPLAIN; the executor won't pay any attention to the 
                     * targetlist.  We postpone this step until here so that 
                     * we don't have to do set_returning_clause_references() 
                     * twice on identical targetlists. 
                     */ 
</span>                    <a href="setrefs.c.html#LN764"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN215"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN774"><span class='Ref_To_Local'>newRL</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if splan-&GT;returningLists &raquo; </span> 
 
                <span class='Comment_Multi_Line'>/* 
                 * We treat ModifyTable with ON CONFLICT as a form of 'pseudo 
                 * join', where the inner side is the EXCLUDED tuple. 
                 * Therefore use fix_join_expr to setup the relevant variables 
                 * to INNER_VAR. We explicitly don't create any OUTER_VARs as 
                 * those are already used by RETURNING and it seems better to 
                 * be non-conflicting. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN764"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN233"><span class='Ref_to_Member'>onConflictSet</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN823"></a>                    <a href="setrefs.c.html#LN37"><span class='Ref_to_Typedef'>indexed_tlist</span></a> <span class='Operator'>*</span><span class='Declare_Local'>itlist</span><span class='Delimiter'>; 
</span> 
                    <a href="setrefs.c.html#LN823"><span class='Ref_To_Local'>itlist</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN108"><span class='Ref_to_Proto'>build_tlist_index</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN764"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN236"><span class='Ref_to_Member'>exclRelTlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <a href="setrefs.c.html#LN764"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN233"><span class='Ref_to_Member'>onConflictSet</span></a> <span class='Operator'>= 
</span>                        <a href="setrefs.c.html#LN120"><span class='Ref_to_Proto'>fix_join_expr</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN764"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN233"><span class='Ref_to_Member'>onConflictSet</span></a><span class='Delimiter'>, 
</span>                                      <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="setrefs.c.html#LN823"><span class='Ref_To_Local'>itlist</span></a><span class='Delimiter'>, 
</span>                                      <a href="../../../include/nodes/pg_list.h.html#LN111"><span class='Ref_to_Macro'>linitial_int</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN764"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN221"><span class='Ref_to_Member'>resultRelations</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                      <a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <a href="setrefs.c.html#LN764"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN234"><span class='Ref_to_Member'>onConflictWhere</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>                        <a href="setrefs.c.html#LN120"><span class='Ref_to_Proto'>fix_join_expr</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN764"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN234"><span class='Ref_to_Member'>onConflictWhere</span></a><span class='Delimiter'>, 
</span>                                      <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="setrefs.c.html#LN823"><span class='Ref_To_Local'>itlist</span></a><span class='Delimiter'>, 
</span>                                      <a href="../../../include/nodes/pg_list.h.html#LN111"><span class='Ref_to_Macro'>linitial_int</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN764"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN221"><span class='Ref_to_Member'>resultRelations</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                      <a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN823"><span class='Ref_To_Local'>itlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <a href="setrefs.c.html#LN764"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN236"><span class='Ref_to_Member'>exclRelTlist</span></a> <span class='Operator'>= 
</span>                        <a href="setrefs.c.html#LN80"><span class='Ref_to_Macro'>fix_scan_list</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN764"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN236"><span class='Ref_to_Member'>exclRelTlist</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if splan-&GT;onConflictSet &raquo; </span> 
 
                <a href="setrefs.c.html#LN764"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN218"><span class='Ref_to_Member'>nominalRelation</span></a> <span class='Operator'>+= </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Delimiter'>; 
</span>                <a href="setrefs.c.html#LN764"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN235"><span class='Ref_to_Member'>exclRelRTI</span></a> <span class='Operator'>+= </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Delimiter'>; 
</span> 
                <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN435"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN764"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN220"><span class='Ref_to_Member'>partitioned_rels</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../../include/nodes/pg_list.h.html#LN106"><span class='Ref_to_Macro'>lfirst_int</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN435"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>) </span><span class='Operator'>+= </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN435"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN764"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN221"><span class='Ref_to_Member'>resultRelations</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../../include/nodes/pg_list.h.html#LN106"><span class='Ref_to_Macro'>lfirst_int</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN435"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>) </span><span class='Operator'>+= </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN435"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN764"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN229"><span class='Ref_to_Member'>rowMarks</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN858"></a>                    <a href="../../../include/nodes/plannodes.h.html#LN1002"><span class='Ref_to_Struct'>PlanRowMark</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rc</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN1002"><span class='Ref_to_Struct'>PlanRowMark</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN435"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <a href="setrefs.c.html#LN858"><span class='Ref_To_Local'>rc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN1005"><span class='Ref_to_Member'>rti</span></a> <span class='Operator'>+= </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Delimiter'>; 
</span>                    <a href="setrefs.c.html#LN858"><span class='Ref_To_Local'>rc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN1006"><span class='Ref_to_Member'>prti</span></a> <span class='Operator'>+= </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN435"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN764"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN224"><span class='Ref_to_Member'>plans</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN435"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>) </span><span class='Operator'>= </span><a href="setrefs.c.html#LN87"><span class='Ref_to_Proto'>set_plan_refs</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                              <span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN435"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                              <a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Append this ModifyTable node's final result relation RT 
                 * index(es) to the global list for the plan, and set its 
                 * resultRelIndex to reflect their starting position in the 
                 * global list. 
                 */ 
</span>                <a href="setrefs.c.html#LN764"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN222"><span class='Ref_to_Member'>resultRelIndex</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN107"><span class='Ref_to_Member'>resultRelations</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN107"><span class='Ref_to_Member'>resultRelations</span></a> <span class='Operator'>= 
</span>                    <a href="../../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN107"><span class='Ref_to_Member'>resultRelations</span></a><span class='Delimiter'>, 
</span>                                <a href="../../../include/nodes/pg_list.h.html#LN268"><span class='Ref_to_Proto'>list_copy</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN764"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN221"><span class='Ref_to_Member'>resultRelations</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * If the main target relation is a partitioned table, the 
                 * following list contains the RT indexes of partitioned child 
                 * relations including the root, which are not included in the 
                 * above list.  We also keep RT indexes of the roots 
                 * separately to be identitied as such during the executor 
                 * initialization. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN764"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN220"><span class='Ref_to_Member'>partitioned_rels</span></a> <span class='Operator'>!= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN109"><span class='Ref_to_Member'>nonleafResultRelations</span></a> <span class='Operator'>= 
</span>                        <a href="../../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN109"><span class='Ref_to_Member'>nonleafResultRelations</span></a><span class='Delimiter'>, 
</span>                                    <a href="../../../include/nodes/pg_list.h.html#LN268"><span class='Ref_to_Proto'>list_copy</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN764"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN220"><span class='Ref_to_Member'>partitioned_rels</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <span class='Comment_Multi_Line'>/* Remember where this root will be in the global list. */ 
</span>                    <a href="setrefs.c.html#LN764"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN223"><span class='Ref_to_Member'>rootResultRelIndex</span></a> <span class='Operator'>= 
</span>                        <a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN110"><span class='Ref_to_Member'>rootResultRelations</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN110"><span class='Ref_to_Member'>rootResultRelations</span></a> <span class='Operator'>= 
</span>                        <a href="../../nodes/list.c.html#LN144"><span class='Ref_to_Func'>lappend_int</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN110"><span class='Ref_to_Member'>rootResultRelations</span></a><span class='Delimiter'>, 
</span>                                    <a href="../../../include/nodes/pg_list.h.html#LN111"><span class='Ref_to_Macro'>linitial_int</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN764"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN220"><span class='Ref_to_Member'>partitioned_rels</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN47"><span class='Ref_to_EnumConst'>T_Append</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN905"></a>                <a href="../../../include/nodes/plannodes.h.html#LN244"><span class='Ref_to_Struct'>Append</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>splan</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN244"><span class='Ref_to_Struct'>Append</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Append, like Sort et al, doesn't actually evaluate its 
                 * targetlist or check quals. 
                 */ 
</span>                <a href="setrefs.c.html#LN107"><span class='Ref_to_Proto'>set_dummy_tlist_references</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="setrefs.c.html#LN905"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN246"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN435"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN905"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN248"><span class='Ref_to_Member'>partitioned_rels</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../../include/nodes/pg_list.h.html#LN106"><span class='Ref_to_Macro'>lfirst_int</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN435"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>) </span><span class='Operator'>+= </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN435"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN905"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN249"><span class='Ref_to_Member'>appendplans</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN435"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>) </span><span class='Operator'>= </span><a href="setrefs.c.html#LN87"><span class='Ref_to_Proto'>set_plan_refs</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                              <span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN435"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                              <a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN48"><span class='Ref_to_EnumConst'>T_MergeAppend</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN927"></a>                <a href="../../../include/nodes/plannodes.h.html#LN257"><span class='Ref_to_Struct'>MergeAppend</span></a> <span class='Operator'>*</span><span class='Declare_Local'>splan</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN257"><span class='Ref_to_Struct'>MergeAppend</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * MergeAppend, like Sort et al, doesn't actually evaluate its 
                 * targetlist or check quals. 
                 */ 
</span>                <a href="setrefs.c.html#LN107"><span class='Ref_to_Proto'>set_dummy_tlist_references</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="setrefs.c.html#LN927"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN259"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN435"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN927"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN261"><span class='Ref_to_Member'>partitioned_rels</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../../include/nodes/pg_list.h.html#LN106"><span class='Ref_to_Macro'>lfirst_int</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN435"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>) </span><span class='Operator'>+= </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN435"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN927"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN262"><span class='Ref_to_Member'>mergeplans</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN435"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>) </span><span class='Operator'>= </span><a href="setrefs.c.html#LN87"><span class='Ref_to_Proto'>set_plan_refs</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                              <span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN435"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                              <a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN49"><span class='Ref_to_EnumConst'>T_RecursiveUnion</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* This doesn't evaluate targetlist or check quals either */ 
</span>            <a href="setrefs.c.html#LN107"><span class='Ref_to_Proto'>set_dummy_tlist_references</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN50"><span class='Ref_to_EnumConst'>T_BitmapAnd</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN954"></a>                <a href="../../../include/nodes/plannodes.h.html#LN299"><span class='Ref_to_Struct'>BitmapAnd</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>splan</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN299"><span class='Ref_to_Struct'>BitmapAnd</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* BitmapAnd works like Append, but has no tlist */ 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="setrefs.c.html#LN954"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN301"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="setrefs.c.html#LN954"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN301"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN435"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN954"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN302"><span class='Ref_to_Member'>bitmapplans</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN435"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>) </span><span class='Operator'>= </span><a href="setrefs.c.html#LN87"><span class='Ref_to_Proto'>set_plan_refs</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                              <span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN435"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                              <a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN51"><span class='Ref_to_EnumConst'>T_BitmapOr</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN969"></a>                <a href="../../../include/nodes/plannodes.h.html#LN313"><span class='Ref_to_Struct'>BitmapOr</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>splan</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN313"><span class='Ref_to_Struct'>BitmapOr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* BitmapOr works like Append, but has no tlist */ 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="setrefs.c.html#LN969"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN315"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="setrefs.c.html#LN969"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN315"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN435"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN969"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN317"><span class='Ref_to_Member'>bitmapplans</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN435"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>) </span><span class='Operator'>= </span><a href="setrefs.c.html#LN87"><span class='Ref_to_Proto'>set_plan_refs</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                              <span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN435"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                              <a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized node type: %d"</span><span class='Delimiter'>, 
</span>                 <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="../../../include/nodes/nodes.h.html#LN513"><span class='Ref_to_Macro'>nodeTag</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch nodeTag(plan) &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Now recurse into child plans, if any 
     * 
     * NOTE: it is essential that we recurse into child plans AFTER we set 
     * subplan references in this plan's tlist and quals.  If we did the 
     * reference-adjustments bottom-up, then we would fail to match this 
     * plan's var nodes against the already-modified nodes of the children. 
     */ 
</span>    <a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN145"><span class='Ref_to_Member'>lefttree</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN87"><span class='Ref_to_Proto'>set_plan_refs</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN145"><span class='Ref_to_Member'>lefttree</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN146"><span class='Ref_to_Member'>righttree</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN87"><span class='Ref_to_Proto'>set_plan_refs</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN146"><span class='Ref_to_Member'>righttree</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="setrefs.c.html#LN433"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end set_plan_refs &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * set_indexonlyscan_references 
 *      Do set_plan_references processing on an IndexOnlyScan 
 * 
 * This is unlike the handling of a plain IndexScan because we have to 
 * convert Vars referencing the heap into Vars referencing the index. 
 * We can use the fix_upper_expr machinery for that, by working from a 
 * targetlist describing the index columns. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>* 
</span><a name="LN1012"></a><span class='Declare_Function'>set_indexonlyscan_references</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN1013"></a>                             <a href="../../../include/nodes/plannodes.h.html#LN414"><span class='Ref_to_Struct'>IndexOnlyScan</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>plan</span><span class='Delimiter'>, 
</span><a name="LN1014"></a>                             <span class='Keyword'>int </span><span class='Declare_Parameter'>rtoffset</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1016"></a>    <a href="setrefs.c.html#LN37"><span class='Ref_to_Typedef'>indexed_tlist</span></a> <span class='Operator'>*</span><span class='Declare_Local'>index_itlist</span><span class='Delimiter'>; 
</span> 
    <a href="setrefs.c.html#LN1016"><span class='Ref_To_Local'>index_itlist</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN108"><span class='Ref_to_Proto'>build_tlist_index</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1013"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN420"><span class='Ref_to_Member'>indextlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="setrefs.c.html#LN1013"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN416"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN328"><span class='Ref_to_Member'>scanrelid</span></a> <span class='Operator'>+= </span><a href="setrefs.c.html#LN1014"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Delimiter'>; 
</span>    <a href="setrefs.c.html#LN1013"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN416"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>        <a href="setrefs.c.html#LN127"><span class='Ref_to_Proto'>fix_upper_expr</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1012"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                       <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1013"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN416"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Delimiter'>, 
</span>                       <a href="setrefs.c.html#LN1016"><span class='Ref_To_Local'>index_itlist</span></a><span class='Delimiter'>, 
</span>                       <a href="../../../include/nodes/primnodes.h.html#LN154"><span class='Ref_to_Const'>INDEX_VAR</span></a><span class='Delimiter'>, 
</span>                       <a href="setrefs.c.html#LN1014"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="setrefs.c.html#LN1013"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN416"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>        <a href="setrefs.c.html#LN127"><span class='Ref_to_Proto'>fix_upper_expr</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1012"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                       <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1013"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN416"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a><span class='Delimiter'>, 
</span>                       <a href="setrefs.c.html#LN1016"><span class='Ref_To_Local'>index_itlist</span></a><span class='Delimiter'>, 
</span>                       <a href="../../../include/nodes/primnodes.h.html#LN154"><span class='Ref_to_Const'>INDEX_VAR</span></a><span class='Delimiter'>, 
</span>                       <a href="setrefs.c.html#LN1014"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* indexqual is already transformed to reference index columns */ 
</span>    <a href="setrefs.c.html#LN1013"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN418"><span class='Ref_to_Member'>indexqual</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN80"><span class='Ref_to_Macro'>fix_scan_list</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1012"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1013"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN418"><span class='Ref_to_Member'>indexqual</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1014"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* indexorderby is already transformed to reference index columns */ 
</span>    <a href="setrefs.c.html#LN1013"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN419"><span class='Ref_to_Member'>indexorderby</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN80"><span class='Ref_to_Macro'>fix_scan_list</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1012"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1013"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN419"><span class='Ref_to_Member'>indexorderby</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1014"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* indextlist must NOT be transformed to reference index columns */ 
</span>    <a href="setrefs.c.html#LN1013"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN420"><span class='Ref_to_Member'>indextlist</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN80"><span class='Ref_to_Macro'>fix_scan_list</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1012"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1013"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN420"><span class='Ref_to_Member'>indextlist</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1014"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1016"><span class='Ref_To_Local'>index_itlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1013"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end set_indexonlyscan_references &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * set_subqueryscan_references 
 *      Do set_plan_references processing on a SubqueryScan 
 * 
 * We try to strip out the SubqueryScan entirely; if we can't, we have 
 * to do the normal processing on it. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>* 
</span><a name="LN1053"></a><span class='Declare_Function'>set_subqueryscan_references</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN1054"></a>                            <a href="../../../include/nodes/plannodes.h.html#LN494"><span class='Ref_to_Struct'>SubqueryScan</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>plan</span><span class='Delimiter'>, 
</span><a name="LN1055"></a>                            <span class='Keyword'>int </span><span class='Declare_Parameter'>rtoffset</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1057"></a>    <a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN1058"></a>    <a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Need to look up the subquery's RelOptInfo, since we need its subroot */ 
</span>    <a href="setrefs.c.html#LN1057"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../util/relnode.c.html#LN241"><span class='Ref_to_Func'>find_base_rel</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1053"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1054"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN496"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN328"><span class='Ref_to_Member'>scanrelid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Recursively process the subplan */ 
</span>    <a href="setrefs.c.html#LN1054"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN497"><span class='Ref_to_Member'>subplan</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/planmain.h.html#LN115"><span class='Ref_to_Proto'>set_plan_references</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1057"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN566"><span class='Ref_to_Member'>subroot</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1054"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN497"><span class='Ref_to_Member'>subplan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN94"><span class='Ref_to_Proto'>trivial_subqueryscan</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1054"><span class='Ref_to_Parameter'>plan</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * We can omit the SubqueryScan node and just pull up the subplan. 
         */ 
</span><a name="LN1071"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lp</span><span class='Delimiter'>, 
</span><a name="LN1072"></a>                   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
        <a href="setrefs.c.html#LN1058"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN1054"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN497"><span class='Ref_to_Member'>subplan</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* We have to be sure we don't lose any initplans */ 
</span>        <a href="setrefs.c.html#LN1058"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN147"><span class='Ref_to_Member'>initPlan</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1054"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN496"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN147"><span class='Ref_to_Member'>initPlan</span></a><span class='Delimiter'>, 
</span>                                       <a href="setrefs.c.html#LN1058"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN147"><span class='Ref_to_Member'>initPlan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We also have to transfer the SubqueryScan's result-column names 
         * into the subplan, else columns sent to client will be improperly 
         * labeled if this is the topmost plan level.  Copy the "source 
         * column" information too. 
         */ 
</span>        <a href="../../../include/nodes/pg_list.h.html#LN179"><span class='Ref_to_Macro'>forboth</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1071"><span class='Ref_To_Local'>lp</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1054"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN496"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1072"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1058"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1088"></a>            <a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ptle</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1071"><span class='Ref_To_Local'>lp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1089"></a>            <a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctle</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1072"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="setrefs.c.html#LN1089"><span class='Ref_To_Local'>ctle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1368"><span class='Ref_to_Member'>resname</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN1088"><span class='Ref_To_Local'>ptle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1368"><span class='Ref_to_Member'>resname</span></a><span class='Delimiter'>; 
</span>            <a href="setrefs.c.html#LN1089"><span class='Ref_To_Local'>ctle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1371"><span class='Ref_to_Member'>resorigtbl</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN1088"><span class='Ref_To_Local'>ptle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1371"><span class='Ref_to_Member'>resorigtbl</span></a><span class='Delimiter'>; 
</span>            <a href="setrefs.c.html#LN1089"><span class='Ref_To_Local'>ctle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1372"><span class='Ref_to_Member'>resorigcol</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN1088"><span class='Ref_To_Local'>ptle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1372"><span class='Ref_to_Member'>resorigcol</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if trivial_subqueryscan(... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Keep the SubqueryScan node.  We have to do the processing that 
         * set_plan_references would otherwise have done on it.  Notice we do 
         * not do set_upper_references() here, because a SubqueryScan will 
         * always have been created with correct references to its subplan's 
         * outputs to begin with. 
         */ 
</span>        <a href="setrefs.c.html#LN1054"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN496"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN328"><span class='Ref_to_Member'>scanrelid</span></a> <span class='Operator'>+= </span><a href="setrefs.c.html#LN1055"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Delimiter'>; 
</span>        <a href="setrefs.c.html#LN1054"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN496"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a> <span class='Operator'>= 
</span>            <a href="setrefs.c.html#LN80"><span class='Ref_to_Macro'>fix_scan_list</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1053"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1054"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN496"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1055"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="setrefs.c.html#LN1054"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN496"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a> <span class='Operator'>= 
</span>            <a href="setrefs.c.html#LN80"><span class='Ref_to_Macro'>fix_scan_list</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1053"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1054"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN496"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1055"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="setrefs.c.html#LN1058"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1054"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="setrefs.c.html#LN1058"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end set_subqueryscan_references &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * trivial_subqueryscan 
 *      Detect whether a SubqueryScan can be deleted from the plan tree. 
 * 
 * We can delete it if it has no qual to check and the targetlist just 
 * regurgitates the output of the child plan. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1125"></a><span class='Declare_Function'>trivial_subqueryscan</span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN494"><span class='Ref_to_Struct'>SubqueryScan</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>plan</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1127"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>attrno</span><span class='Delimiter'>; 
</span><a name="LN1128"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lp</span><span class='Delimiter'>, 
</span><a name="LN1129"></a>               <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN1125"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN496"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a> <span class='Operator'>!= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1125"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN496"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Parentheses'>) </span><span class='Operator'>!= 
</span>        <a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1125"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN497"><span class='Ref_to_Member'>subplan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* tlists not same length */ 
</span> 
    <a href="setrefs.c.html#LN1127"><span class='Ref_To_Local'>attrno</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN179"><span class='Ref_to_Macro'>forboth</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1128"><span class='Ref_To_Local'>lp</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1125"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN496"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1129"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1125"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN497"><span class='Ref_to_Member'>subplan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1141"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ptle</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1128"><span class='Ref_To_Local'>lp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1142"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctle</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1129"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN1141"><span class='Ref_To_Local'>ptle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1373"><span class='Ref_to_Member'>resjunk</span></a> <span class='Operator'>!= </span><a href="setrefs.c.html#LN1142"><span class='Ref_To_Local'>ctle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1373"><span class='Ref_to_Member'>resjunk</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* tlist doesn't match junk status */ 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We accept either a Var referencing the corresponding element of the 
         * subplan tlist, or a Const equaling the subplan element. See 
         * generate_setop_tlist() for motivation. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN1141"><span class='Ref_To_Local'>ptle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a> <span class='Operator'>&& </span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1141"><span class='Ref_To_Local'>ptle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN1154"></a>            <a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>var</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1141"><span class='Ref_To_Local'>ptle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Delimiter'>; 
</span> 
            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1154"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN165"><span class='Ref_to_Member'>varno</span></a> <span class='Operator'>== </span><a href="setrefs.c.html#LN1125"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN496"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN328"><span class='Ref_to_Member'>scanrelid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1154"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN172"><span class='Ref_to_Member'>varlevelsup</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN1154"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN167"><span class='Ref_to_Member'>varattno</span></a> <span class='Operator'>!= </span><a href="setrefs.c.html#LN1127"><span class='Ref_To_Local'>attrno</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* out of order */ 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN1141"><span class='Ref_To_Local'>ptle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a> <span class='Operator'>&& </span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1141"><span class='Ref_To_Local'>ptle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/nodes.h.html#LN626"><span class='Ref_to_Proto'>equal</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1141"><span class='Ref_To_Local'>ptle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1142"><span class='Ref_To_Local'>ctle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <a href="setrefs.c.html#LN1127"><span class='Ref_To_Local'>attrno</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end trivial_subqueryscan &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * set_foreignscan_references 
 *     Do set_plan_references processing on a ForeignScan 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1180"></a><span class='Declare_Function'>set_foreignscan_references</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN1181"></a>                           <a href="../../../include/nodes/plannodes.h.html#LN594"><span class='Ref_to_Struct'>ForeignScan</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fscan</span><span class='Delimiter'>, 
</span><a name="LN1182"></a>                           <span class='Keyword'>int </span><span class='Declare_Parameter'>rtoffset</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Adjust scanrelid if it's valid */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN1181"><span class='Ref_to_Parameter'>fscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN596"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN328"><span class='Ref_to_Member'>scanrelid</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="setrefs.c.html#LN1181"><span class='Ref_to_Parameter'>fscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN596"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN328"><span class='Ref_to_Member'>scanrelid</span></a> <span class='Operator'>+= </span><a href="setrefs.c.html#LN1182"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN1181"><span class='Ref_to_Parameter'>fscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN601"><span class='Ref_to_Member'>fdw_scan_tlist</span></a> <span class='Operator'>!= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a> <span class='Operator'>|| </span><a href="setrefs.c.html#LN1181"><span class='Ref_to_Parameter'>fscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN596"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN328"><span class='Ref_to_Member'>scanrelid</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Adjust tlist, qual, fdw_exprs, fdw_recheck_quals to reference 
         * foreign scan tuple 
         */ 
</span><a name="LN1194"></a>        <a href="setrefs.c.html#LN37"><span class='Ref_to_Typedef'>indexed_tlist</span></a> <span class='Operator'>*</span><span class='Declare_Local'>itlist</span> <span class='Operator'>= </span><a href="setrefs.c.html#LN108"><span class='Ref_to_Proto'>build_tlist_index</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1181"><span class='Ref_to_Parameter'>fscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN601"><span class='Ref_to_Member'>fdw_scan_tlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="setrefs.c.html#LN1181"><span class='Ref_to_Parameter'>fscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN596"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>            <a href="setrefs.c.html#LN127"><span class='Ref_to_Proto'>fix_upper_expr</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1180"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                           <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1181"><span class='Ref_to_Parameter'>fscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN596"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Delimiter'>, 
</span>                           <a href="setrefs.c.html#LN1194"><span class='Ref_To_Local'>itlist</span></a><span class='Delimiter'>, 
</span>                           <a href="../../../include/nodes/primnodes.h.html#LN154"><span class='Ref_to_Const'>INDEX_VAR</span></a><span class='Delimiter'>, 
</span>                           <a href="setrefs.c.html#LN1182"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="setrefs.c.html#LN1181"><span class='Ref_to_Parameter'>fscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN596"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>            <a href="setrefs.c.html#LN127"><span class='Ref_to_Proto'>fix_upper_expr</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1180"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                           <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1181"><span class='Ref_to_Parameter'>fscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN596"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a><span class='Delimiter'>, 
</span>                           <a href="setrefs.c.html#LN1194"><span class='Ref_To_Local'>itlist</span></a><span class='Delimiter'>, 
</span>                           <a href="../../../include/nodes/primnodes.h.html#LN154"><span class='Ref_to_Const'>INDEX_VAR</span></a><span class='Delimiter'>, 
</span>                           <a href="setrefs.c.html#LN1182"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="setrefs.c.html#LN1181"><span class='Ref_to_Parameter'>fscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN599"><span class='Ref_to_Member'>fdw_exprs</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>            <a href="setrefs.c.html#LN127"><span class='Ref_to_Proto'>fix_upper_expr</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1180"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                           <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1181"><span class='Ref_to_Parameter'>fscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN599"><span class='Ref_to_Member'>fdw_exprs</span></a><span class='Delimiter'>, 
</span>                           <a href="setrefs.c.html#LN1194"><span class='Ref_To_Local'>itlist</span></a><span class='Delimiter'>, 
</span>                           <a href="../../../include/nodes/primnodes.h.html#LN154"><span class='Ref_to_Const'>INDEX_VAR</span></a><span class='Delimiter'>, 
</span>                           <a href="setrefs.c.html#LN1182"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="setrefs.c.html#LN1181"><span class='Ref_to_Parameter'>fscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN602"><span class='Ref_to_Member'>fdw_recheck_quals</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>            <a href="setrefs.c.html#LN127"><span class='Ref_to_Proto'>fix_upper_expr</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1180"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                           <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1181"><span class='Ref_to_Parameter'>fscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN602"><span class='Ref_to_Member'>fdw_recheck_quals</span></a><span class='Delimiter'>, 
</span>                           <a href="setrefs.c.html#LN1194"><span class='Ref_To_Local'>itlist</span></a><span class='Delimiter'>, 
</span>                           <a href="../../../include/nodes/primnodes.h.html#LN154"><span class='Ref_to_Const'>INDEX_VAR</span></a><span class='Delimiter'>, 
</span>                           <a href="setrefs.c.html#LN1182"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1194"><span class='Ref_To_Local'>itlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* fdw_scan_tlist itself just needs fix_scan_list() adjustments */ 
</span>        <a href="setrefs.c.html#LN1181"><span class='Ref_to_Parameter'>fscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN601"><span class='Ref_to_Member'>fdw_scan_tlist</span></a> <span class='Operator'>= 
</span>            <a href="setrefs.c.html#LN80"><span class='Ref_to_Macro'>fix_scan_list</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1180"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1181"><span class='Ref_to_Parameter'>fscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN601"><span class='Ref_to_Member'>fdw_scan_tlist</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1182"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if fscan-&GT;fdw_scan_tlist... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Adjust tlist, qual, fdw_exprs, fdw_recheck_quals in the standard 
         * way 
         */ 
</span>        <a href="setrefs.c.html#LN1181"><span class='Ref_to_Parameter'>fscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN596"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a> <span class='Operator'>= 
</span>            <a href="setrefs.c.html#LN80"><span class='Ref_to_Macro'>fix_scan_list</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1180"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1181"><span class='Ref_to_Parameter'>fscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN596"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1182"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="setrefs.c.html#LN1181"><span class='Ref_to_Parameter'>fscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN596"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a> <span class='Operator'>= 
</span>            <a href="setrefs.c.html#LN80"><span class='Ref_to_Macro'>fix_scan_list</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1180"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1181"><span class='Ref_to_Parameter'>fscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN596"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1182"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="setrefs.c.html#LN1181"><span class='Ref_to_Parameter'>fscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN599"><span class='Ref_to_Member'>fdw_exprs</span></a> <span class='Operator'>= 
</span>            <a href="setrefs.c.html#LN80"><span class='Ref_to_Macro'>fix_scan_list</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1180"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1181"><span class='Ref_to_Parameter'>fscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN599"><span class='Ref_to_Member'>fdw_exprs</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1182"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="setrefs.c.html#LN1181"><span class='Ref_to_Parameter'>fscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN602"><span class='Ref_to_Member'>fdw_recheck_quals</span></a> <span class='Operator'>= 
</span>            <a href="setrefs.c.html#LN80"><span class='Ref_to_Macro'>fix_scan_list</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1180"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1181"><span class='Ref_to_Parameter'>fscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN602"><span class='Ref_to_Member'>fdw_recheck_quals</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1182"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Adjust fs_relids if needed */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN1182"><span class='Ref_to_Parameter'>rtoffset</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1244"></a>        <a href="../../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>tempset</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1245"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>x</span> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="setrefs.c.html#LN1245"><span class='Ref_To_Local'>x</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN98"><span class='Ref_to_Proto'>bms_next_member</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1181"><span class='Ref_to_Parameter'>fscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN604"><span class='Ref_to_Member'>fs_relids</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1245"><span class='Ref_To_Local'>x</span></a><span class='Parentheses'>))</span> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="setrefs.c.html#LN1244"><span class='Ref_To_Local'>tempset</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN89"><span class='Ref_to_Proto'>bms_add_member</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1244"><span class='Ref_To_Local'>tempset</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1245"><span class='Ref_To_Local'>x</span></a> <span class='Operator'>+ </span><a href="setrefs.c.html#LN1182"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="setrefs.c.html#LN1181"><span class='Ref_to_Parameter'>fscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN604"><span class='Ref_to_Member'>fs_relids</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN1244"><span class='Ref_To_Local'>tempset</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end set_foreignscan_references &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * set_customscan_references 
 *     Do set_plan_references processing on a CustomScan 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1258"></a><span class='Declare_Function'>set_customscan_references</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN1259"></a>                          <a href="../../../include/nodes/plannodes.h.html#LN623"><span class='Ref_to_Struct'>CustomScan</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cscan</span><span class='Delimiter'>, 
</span><a name="LN1260"></a>                          <span class='Keyword'>int </span><span class='Declare_Parameter'>rtoffset</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1262"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Adjust scanrelid if it's valid */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN1259"><span class='Ref_to_Parameter'>cscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN625"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN328"><span class='Ref_to_Member'>scanrelid</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="setrefs.c.html#LN1259"><span class='Ref_to_Parameter'>cscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN625"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN328"><span class='Ref_to_Member'>scanrelid</span></a> <span class='Operator'>+= </span><a href="setrefs.c.html#LN1260"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN1259"><span class='Ref_to_Parameter'>cscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN631"><span class='Ref_to_Member'>custom_scan_tlist</span></a> <span class='Operator'>!= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a> <span class='Operator'>|| </span><a href="setrefs.c.html#LN1259"><span class='Ref_to_Parameter'>cscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN625"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN328"><span class='Ref_to_Member'>scanrelid</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Adjust tlist, qual, custom_exprs to reference custom scan tuple */ 
</span><a name="LN1271"></a>        <a href="setrefs.c.html#LN37"><span class='Ref_to_Typedef'>indexed_tlist</span></a> <span class='Operator'>*</span><span class='Declare_Local'>itlist</span> <span class='Operator'>= </span><a href="setrefs.c.html#LN108"><span class='Ref_to_Proto'>build_tlist_index</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1259"><span class='Ref_to_Parameter'>cscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN631"><span class='Ref_to_Member'>custom_scan_tlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="setrefs.c.html#LN1259"><span class='Ref_to_Parameter'>cscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN625"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>            <a href="setrefs.c.html#LN127"><span class='Ref_to_Proto'>fix_upper_expr</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1258"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                           <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1259"><span class='Ref_to_Parameter'>cscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN625"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Delimiter'>, 
</span>                           <a href="setrefs.c.html#LN1271"><span class='Ref_To_Local'>itlist</span></a><span class='Delimiter'>, 
</span>                           <a href="../../../include/nodes/primnodes.h.html#LN154"><span class='Ref_to_Const'>INDEX_VAR</span></a><span class='Delimiter'>, 
</span>                           <a href="setrefs.c.html#LN1260"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="setrefs.c.html#LN1259"><span class='Ref_to_Parameter'>cscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN625"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>            <a href="setrefs.c.html#LN127"><span class='Ref_to_Proto'>fix_upper_expr</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1258"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                           <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1259"><span class='Ref_to_Parameter'>cscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN625"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a><span class='Delimiter'>, 
</span>                           <a href="setrefs.c.html#LN1271"><span class='Ref_To_Local'>itlist</span></a><span class='Delimiter'>, 
</span>                           <a href="../../../include/nodes/primnodes.h.html#LN154"><span class='Ref_to_Const'>INDEX_VAR</span></a><span class='Delimiter'>, 
</span>                           <a href="setrefs.c.html#LN1260"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="setrefs.c.html#LN1259"><span class='Ref_to_Parameter'>cscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN629"><span class='Ref_to_Member'>custom_exprs</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>            <a href="setrefs.c.html#LN127"><span class='Ref_to_Proto'>fix_upper_expr</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1258"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                           <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1259"><span class='Ref_to_Parameter'>cscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN629"><span class='Ref_to_Member'>custom_exprs</span></a><span class='Delimiter'>, 
</span>                           <a href="setrefs.c.html#LN1271"><span class='Ref_To_Local'>itlist</span></a><span class='Delimiter'>, 
</span>                           <a href="../../../include/nodes/primnodes.h.html#LN154"><span class='Ref_to_Const'>INDEX_VAR</span></a><span class='Delimiter'>, 
</span>                           <a href="setrefs.c.html#LN1260"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1271"><span class='Ref_To_Local'>itlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* custom_scan_tlist itself just needs fix_scan_list() adjustments */ 
</span>        <a href="setrefs.c.html#LN1259"><span class='Ref_to_Parameter'>cscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN631"><span class='Ref_to_Member'>custom_scan_tlist</span></a> <span class='Operator'>= 
</span>            <a href="setrefs.c.html#LN80"><span class='Ref_to_Macro'>fix_scan_list</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1258"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1259"><span class='Ref_to_Parameter'>cscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN631"><span class='Ref_to_Member'>custom_scan_tlist</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1260"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if cscan-&GT;custom_scan_tl... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Adjust tlist, qual, custom_exprs in the standard way */ 
</span>        <a href="setrefs.c.html#LN1259"><span class='Ref_to_Parameter'>cscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN625"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a> <span class='Operator'>= 
</span>            <a href="setrefs.c.html#LN80"><span class='Ref_to_Macro'>fix_scan_list</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1258"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1259"><span class='Ref_to_Parameter'>cscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN625"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1260"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="setrefs.c.html#LN1259"><span class='Ref_to_Parameter'>cscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN625"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a> <span class='Operator'>= 
</span>            <a href="setrefs.c.html#LN80"><span class='Ref_to_Macro'>fix_scan_list</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1258"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1259"><span class='Ref_to_Parameter'>cscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN625"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1260"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="setrefs.c.html#LN1259"><span class='Ref_to_Parameter'>cscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN629"><span class='Ref_to_Member'>custom_exprs</span></a> <span class='Operator'>= 
</span>            <a href="setrefs.c.html#LN80"><span class='Ref_to_Macro'>fix_scan_list</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1258"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1259"><span class='Ref_to_Parameter'>cscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN629"><span class='Ref_to_Member'>custom_exprs</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1260"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Adjust child plan-nodes recursively, if needed */ 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1262"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1259"><span class='Ref_to_Parameter'>cscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN628"><span class='Ref_to_Member'>custom_plans</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1262"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>) </span><span class='Operator'>= </span><a href="setrefs.c.html#LN87"><span class='Ref_to_Proto'>set_plan_refs</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1258"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1262"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1260"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Adjust custom_relids if needed */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN1260"><span class='Ref_to_Parameter'>rtoffset</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1316"></a>        <a href="../../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>tempset</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1317"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>x</span> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="setrefs.c.html#LN1317"><span class='Ref_To_Local'>x</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN98"><span class='Ref_to_Proto'>bms_next_member</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1259"><span class='Ref_to_Parameter'>cscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN633"><span class='Ref_to_Member'>custom_relids</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1317"><span class='Ref_To_Local'>x</span></a><span class='Parentheses'>))</span> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="setrefs.c.html#LN1316"><span class='Ref_To_Local'>tempset</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN89"><span class='Ref_to_Proto'>bms_add_member</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1316"><span class='Ref_To_Local'>tempset</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1317"><span class='Ref_To_Local'>x</span></a> <span class='Operator'>+ </span><a href="setrefs.c.html#LN1260"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="setrefs.c.html#LN1259"><span class='Ref_to_Parameter'>cscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN633"><span class='Ref_to_Member'>custom_relids</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN1316"><span class='Ref_To_Local'>tempset</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end set_customscan_references &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * copyVar 
 *      Copy a Var node. 
 * 
 * fix_scan_expr and friends do this enough times that it's worth having 
 * a bespoke routine instead of using the generic copyObject() function. 
 */ 
</span><span class='Keyword'>static inline </span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>* 
</span><a name="LN1333"></a><span class='Declare_Function'>copyVar</span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1335"></a>    <a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>newvar</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="setrefs.c.html#LN1335"><span class='Ref_To_Local'>newvar</span></a> <span class='Operator'>= *</span><a href="setrefs.c.html#LN1333"><span class='Ref_to_Parameter'>var</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="setrefs.c.html#LN1335"><span class='Ref_To_Local'>newvar</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * fix_expr_common 
 *      Do generic set_plan_references processing on an expression node 
 * 
 * This is code that is common to all variants of expression-fixing. 
 * We must look up operator opcode info for OpExpr and related nodes, 
 * add OIDs from regclass Const nodes into root-&GT;glob-&GT;relationOids, and 
 * add PlanInvalItems for user-defined functions into root-&GT;glob-&GT;invalItems. 
 * We also fill in column index lists for GROUPING() expressions. 
 * 
 * We assume it's okay to update opcode info in-place.  So this could possibly 
 * scribble on the planner's input data structures, but it's OK. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1355"></a><span class='Declare_Function'>fix_expr_common</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* We assume callers won't call us on a NULL pointer */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1355"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN290"><span class='Ref_to_Struct'>Aggref</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../include/optimizer/planmain.h.html#LN116"><span class='Ref_to_Proto'>record_plan_function_dependency</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1355"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                        <span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN290"><span class='Ref_to_Struct'>Aggref</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1355"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>aggfnoid<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1355"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN351"><span class='Ref_to_Struct'>WindowFunc</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../include/optimizer/planmain.h.html#LN116"><span class='Ref_to_Proto'>record_plan_function_dependency</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1355"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                        <span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN351"><span class='Ref_to_Struct'>WindowFunc</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1355"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>winfnoid<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1355"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN444"><span class='Ref_to_Struct'>FuncExpr</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../include/optimizer/planmain.h.html#LN116"><span class='Ref_to_Proto'>record_plan_function_dependency</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1355"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                        <span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN444"><span class='Ref_to_Struct'>FuncExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1355"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>funcid<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1355"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN491"><span class='Ref_to_Struct'>OpExpr</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../include/nodes/nodeFuncs.h.html#LN46"><span class='Ref_to_Proto'>set_opfuncid</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN491"><span class='Ref_to_Struct'>OpExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1355"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/optimizer/planmain.h.html#LN116"><span class='Ref_to_Proto'>record_plan_function_dependency</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1355"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                        <span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN491"><span class='Ref_to_Struct'>OpExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1355"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>opfuncid<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1355"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN514"><span class='Ref_to_Typedef'>DistinctExpr</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../include/nodes/nodeFuncs.h.html#LN46"><span class='Ref_to_Proto'>set_opfuncid</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN491"><span class='Ref_to_Struct'>OpExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1355"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* rely on struct equivalence */ 
</span>        <a href="../../../include/optimizer/planmain.h.html#LN116"><span class='Ref_to_Proto'>record_plan_function_dependency</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1355"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                        <span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN514"><span class='Ref_to_Typedef'>DistinctExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1355"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>opfuncid<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1355"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN522"><span class='Ref_to_Typedef'>NullIfExpr</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../include/nodes/nodeFuncs.h.html#LN46"><span class='Ref_to_Proto'>set_opfuncid</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN491"><span class='Ref_to_Struct'>OpExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1355"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* rely on struct equivalence */ 
</span>        <a href="../../../include/optimizer/planmain.h.html#LN116"><span class='Ref_to_Proto'>record_plan_function_dependency</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1355"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                        <span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN522"><span class='Ref_to_Typedef'>NullIfExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1355"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>opfuncid<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1355"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN534"><span class='Ref_to_Struct'>ScalarArrayOpExpr</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../include/nodes/nodeFuncs.h.html#LN47"><span class='Ref_to_Proto'>set_sa_opfuncid</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN534"><span class='Ref_to_Struct'>ScalarArrayOpExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1355"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/optimizer/planmain.h.html#LN116"><span class='Ref_to_Proto'>record_plan_function_dependency</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1355"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                     <span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN534"><span class='Ref_to_Struct'>ScalarArrayOpExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1355"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>opfuncid<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1355"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN829"><span class='Ref_to_Struct'>ArrayCoerceExpr</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(((</span><a href="../../../include/nodes/primnodes.h.html#LN829"><span class='Ref_to_Struct'>ArrayCoerceExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1355"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>elemfuncid<span class='Parentheses'>))</span> 
            <a href="../../../include/optimizer/planmain.h.html#LN116"><span class='Ref_to_Proto'>record_plan_function_dependency</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1355"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                     <span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN829"><span class='Ref_to_Struct'>ArrayCoerceExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1355"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>elemfuncid<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1355"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1405"></a>        <a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>con</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1355"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Check for regclass reference */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN76"><span class='Ref_to_Macro'>ISREGCLASSCONST</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1405"><span class='Ref_To_Local'>con</span></a><span class='Parentheses'>))</span> 
            <a href="setrefs.c.html#LN1355"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN112"><span class='Ref_to_Member'>relationOids</span></a> <span class='Operator'>= 
</span>                <a href="../../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1355"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN112"><span class='Ref_to_Member'>relationOids</span></a><span class='Delimiter'>, 
</span>                            <a href="../../../include/postgres.h.html#LN505"><span class='Ref_to_Macro'>DatumGetObjectId</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1405"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN195"><span class='Ref_to_Member'>constvalue</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1355"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN337"><span class='Ref_to_Struct'>GroupingFunc</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1415"></a>        <a href="../../../include/nodes/primnodes.h.html#LN337"><span class='Ref_to_Struct'>GroupingFunc</span></a> <span class='Operator'>*</span><span class='Declare_Local'>g</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN337"><span class='Ref_to_Struct'>GroupingFunc</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1355"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span><a name="LN1416"></a>        <a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a> <span class='Operator'>*</span><span class='Declare_Local'>grouping_map</span> <span class='Operator'>= </span><a href="setrefs.c.html#LN1355"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN283"><span class='Ref_to_Member'>grouping_map</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* If there are no grouping sets, we don't need this. */ 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1416"><span class='Ref_To_Local'>grouping_map</span></a> <span class='Operator'>|| </span><a href="setrefs.c.html#LN1415"><span class='Ref_To_Local'>g</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN343"><span class='Ref_to_Member'>cols</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN1416"><span class='Ref_To_Local'>grouping_map</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1424"></a>            <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span><a name="LN1425"></a>            <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>cols</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
            <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1424"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1415"><span class='Ref_To_Local'>g</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN342"><span class='Ref_to_Member'>refs</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="setrefs.c.html#LN1425"><span class='Ref_To_Local'>cols</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN144"><span class='Ref_to_Func'>lappend_int</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1425"><span class='Ref_To_Local'>cols</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1416"><span class='Ref_To_Local'>grouping_map</span></a><span class='Delimiter'>[</span><a href="../../../include/nodes/pg_list.h.html#LN106"><span class='Ref_to_Macro'>lfirst_int</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1424"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="setrefs.c.html#LN1415"><span class='Ref_To_Local'>g</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN343"><span class='Ref_to_Member'>cols</span></a> <span class='Operator'>|| </span><a href="../../../include/nodes/nodes.h.html#LN626"><span class='Ref_to_Proto'>equal</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1425"><span class='Ref_To_Local'>cols</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1415"><span class='Ref_To_Local'>g</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN343"><span class='Ref_to_Member'>cols</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="setrefs.c.html#LN1415"><span class='Ref_To_Local'>g</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN343"><span class='Ref_to_Member'>cols</span></a><span class='Parentheses'>) 
</span>                <a href="setrefs.c.html#LN1415"><span class='Ref_To_Local'>g</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN343"><span class='Ref_to_Member'>cols</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN1425"><span class='Ref_To_Local'>cols</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IsA(node,GroupingFunc... &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end fix_expr_common &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * fix_param_node 
 *      Do set_plan_references processing on a Param 
 * 
 * If it's a PARAM_MULTIEXPR, replace it with the appropriate Param from 
 * root-&GT;multiexpr_params; otherwise no change is needed. 
 * Just for paranoia's sake, we make a copy of the node in either case. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>* 
</span><a name="LN1449"></a><span class='Declare_Function'>fix_param_node</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN240"><span class='Ref_to_Struct'>Param</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>p</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN1449"><span class='Ref_to_Parameter'>p</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN243"><span class='Ref_to_Member'>paramkind</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/primnodes.h.html#LN237"><span class='Ref_to_EnumConst'>PARAM_MULTIEXPR</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1453"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>subqueryid</span> <span class='Operator'>= </span><a href="setrefs.c.html#LN1449"><span class='Ref_to_Parameter'>p</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN244"><span class='Ref_to_Member'>paramid</span></a> <span class='Operator'>&GT;&GT; </span><span class='Number'>16</span><span class='Delimiter'>; 
</span><a name="LN1454"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>colno</span> <span class='Operator'>= </span><a href="setrefs.c.html#LN1449"><span class='Ref_to_Parameter'>p</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN244"><span class='Ref_to_Member'>paramid</span></a> <span class='Operator'>& </span><span class='Number'>0xFFFF</span><span class='Delimiter'>; 
</span><a name="LN1455"></a>        <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>params</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN1453"><span class='Ref_To_Local'>subqueryid</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            <a href="setrefs.c.html#LN1453"><span class='Ref_To_Local'>subqueryid</span></a> <span class='Operator'>&GT; </span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1449"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN231"><span class='Ref_to_Member'>multiexpr_params</span></a><span class='Parentheses'>))</span> 
            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected PARAM_MULTIEXPR ID: %d"</span><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1449"><span class='Ref_to_Parameter'>p</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN244"><span class='Ref_to_Member'>paramid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="setrefs.c.html#LN1455"><span class='Ref_To_Local'>params</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN223"><span class='Ref_to_Proto'>list_nth</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1449"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN231"><span class='Ref_to_Member'>multiexpr_params</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1453"><span class='Ref_To_Local'>subqueryid</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN1454"><span class='Ref_To_Local'>colno</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="setrefs.c.html#LN1454"><span class='Ref_To_Local'>colno</span></a> <span class='Operator'>&GT; </span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1455"><span class='Ref_To_Local'>params</span></a><span class='Parentheses'>))</span> 
            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected PARAM_MULTIEXPR ID: %d"</span><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1449"><span class='Ref_to_Parameter'>p</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN244"><span class='Ref_to_Member'>paramid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="../../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN223"><span class='Ref_to_Proto'>list_nth</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1455"><span class='Ref_To_Local'>params</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1454"><span class='Ref_To_Local'>colno</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1449"><span class='Ref_to_Parameter'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * fix_scan_expr 
 *      Do set_plan_references processing on a scan-level expression 
 * 
 * This consists of incrementing all Vars' varnos by rtoffset, 
 * replacing PARAM_MULTIEXPR Params, expanding PlaceHolderVars, 
 * replacing Aggref nodes that should be replaced by initplan output Params, 
 * looking up operator opcode info for OpExpr and related nodes, 
 * and adding OIDs from regclass Const nodes into root-&GT;glob-&GT;relationOids. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>* 
</span><a name="LN1479"></a><span class='Declare_Function'>fix_scan_expr</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>rtoffset</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1481"></a>    <a href="setrefs.c.html#LN46"><span class='Ref_to_Typedef'>fix_scan_expr_context</span></a> <span class='Declare_Local'>context</span><span class='Delimiter'>; 
</span> 
    <a href="setrefs.c.html#LN1481"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="setrefs.c.html#LN48"><span class='Ref_to_Member'>root</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN1479"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>; 
</span>    <a href="setrefs.c.html#LN1481"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="setrefs.c.html#LN49"><span class='Ref_to_Member'>rtoffset</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN1479"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN1479"><span class='Ref_to_Parameter'>rtoffset</span></a> <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        <a href="setrefs.c.html#LN1479"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN231"><span class='Ref_to_Member'>multiexpr_params</span></a> <span class='Operator'>!= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a> <span class='Operator'>|| 
</span>        <a href="setrefs.c.html#LN1479"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN118"><span class='Ref_to_Member'>lastPHId</span></a> <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        <a href="setrefs.c.html#LN1479"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN284"><span class='Ref_to_Member'>minmax_aggs</span></a> <span class='Operator'>!= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>return</span> <a href="setrefs.c.html#LN102"><span class='Ref_to_Proto'>fix_scan_expr_mutator</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1479"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="setrefs.c.html#LN1481"><span class='Ref_To_Local'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * If rtoffset == 0, we don't need to change any Vars, and if there 
         * are no MULTIEXPR subqueries then we don't need to replace 
         * PARAM_MULTIEXPR Params, and if there are no placeholders anywhere 
         * we won't need to remove them, and if there are no minmax Aggrefs we 
         * won't need to replace them.  Then it's OK to just scribble on the 
         * input node tree instead of copying (since the only change, filling 
         * in any unset opfuncid fields, is harmless).  This saves just enough 
         * cycles to be noticeable on trivial queries. 
         */ 
</span>        <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN103"><span class='Ref_to_Proto'>fix_scan_expr_walker</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1479"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="setrefs.c.html#LN1481"><span class='Ref_To_Local'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="setrefs.c.html#LN1479"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end fix_scan_expr &raquo; </span> 
 
<span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>* 
</span><a name="LN1511"></a><span class='Declare_Function'>fix_scan_expr_mutator</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><a href="setrefs.c.html#LN46"><span class='Ref_to_Typedef'>fix_scan_expr_context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN1511"><span class='Ref_to_Parameter'>node</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1511"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1517"></a>        <a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>var</span> <span class='Operator'>= </span><a href="setrefs.c.html#LN1332"><span class='Ref_to_Func'>copyVar</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1511"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1517"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN172"><span class='Ref_to_Member'>varlevelsup</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We should not see any Vars marked INNER_VAR or OUTER_VAR.  But an 
         * indexqual expression could contain INDEX_VAR Vars. 
         */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1517"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN165"><span class='Ref_to_Member'>varno</span></a> <span class='Operator'>!= </span><a href="../../../include/nodes/primnodes.h.html#LN152"><span class='Ref_to_Const'>INNER_VAR</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1517"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN165"><span class='Ref_to_Member'>varno</span></a> <span class='Operator'>!= </span><a href="../../../include/nodes/primnodes.h.html#LN153"><span class='Ref_to_Const'>OUTER_VAR</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/primnodes.h.html#LN156"><span class='Ref_to_Macro'>IS_SPECIAL_VARNO</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1517"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN165"><span class='Ref_to_Member'>varno</span></a><span class='Parentheses'>))</span> 
            <a href="setrefs.c.html#LN1517"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN165"><span class='Ref_to_Member'>varno</span></a> <span class='Operator'>+= </span><a href="setrefs.c.html#LN1511"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN49"><span class='Ref_to_Member'>rtoffset</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN1517"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN175"><span class='Ref_to_Member'>varnoold</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="setrefs.c.html#LN1517"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN175"><span class='Ref_to_Member'>varnoold</span></a> <span class='Operator'>+= </span><a href="setrefs.c.html#LN1511"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN49"><span class='Ref_to_Member'>rtoffset</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1517"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1511"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN240"><span class='Ref_to_Struct'>Param</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="setrefs.c.html#LN1448"><span class='Ref_to_Func'>fix_param_node</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1511"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN48"><span class='Ref_to_Member'>root</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN240"><span class='Ref_to_Struct'>Param</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1511"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1511"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN290"><span class='Ref_to_Struct'>Aggref</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1537"></a>        <a href="../../../include/nodes/primnodes.h.html#LN290"><span class='Ref_to_Struct'>Aggref</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>aggref</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN290"><span class='Ref_to_Struct'>Aggref</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1511"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* See if the Aggref should be replaced by a Param */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN1511"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN48"><span class='Ref_to_Member'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN284"><span class='Ref_to_Member'>minmax_aggs</span></a> <span class='Operator'>!= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a> <span class='Operator'>&& 
</span>            <a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1537"><span class='Ref_To_Local'>aggref</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN300"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><a name="LN1543"></a>            <a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>curTarget</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1537"><span class='Ref_To_Local'>aggref</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN300"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1544"></a>            <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
            <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1544"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1511"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN48"><span class='Ref_to_Member'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN284"><span class='Ref_to_Member'>minmax_aggs</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1548"></a>                <a href="../../../include/nodes/relation.h.html#LN2074"><span class='Ref_to_Struct'>MinMaxAggInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>mminfo</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN2074"><span class='Ref_to_Struct'>MinMaxAggInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1544"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN1548"><span class='Ref_To_Local'>mminfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN2078"><span class='Ref_to_Member'>aggfnoid</span></a> <span class='Operator'>== </span><a href="setrefs.c.html#LN1537"><span class='Ref_To_Local'>aggref</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN293"><span class='Ref_to_Member'>aggfnoid</span></a> <span class='Operator'>&& 
</span>                    <a href="../../../include/nodes/nodes.h.html#LN626"><span class='Ref_to_Proto'>equal</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1548"><span class='Ref_To_Local'>mminfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN2080"><span class='Ref_to_Member'>target</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1543"><span class='Ref_To_Local'>curTarget</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1548"><span class='Ref_To_Local'>mminfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN2084"><span class='Ref_to_Member'>param</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* If no match, just fall through to process it normally */ 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IsA(node,Aggref) &raquo; </span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1511"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1272"><span class='Ref_to_Struct'>CurrentOfExpr</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1559"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1272"><span class='Ref_to_Struct'>CurrentOfExpr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cexpr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1272"><span class='Ref_to_Struct'>CurrentOfExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1511"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1559"><span class='Ref_To_Local'>cexpr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1275"><span class='Ref_to_Member'>cvarno</span></a> <span class='Operator'>!= </span><a href="../../../include/nodes/primnodes.h.html#LN152"><span class='Ref_to_Const'>INNER_VAR</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1559"><span class='Ref_To_Local'>cexpr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1275"><span class='Ref_to_Member'>cvarno</span></a> <span class='Operator'>!= </span><a href="../../../include/nodes/primnodes.h.html#LN153"><span class='Ref_to_Const'>OUTER_VAR</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/primnodes.h.html#LN156"><span class='Ref_to_Macro'>IS_SPECIAL_VARNO</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1559"><span class='Ref_To_Local'>cexpr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1275"><span class='Ref_to_Member'>cvarno</span></a><span class='Parentheses'>))</span> 
            <a href="setrefs.c.html#LN1559"><span class='Ref_To_Local'>cexpr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1275"><span class='Ref_to_Member'>cvarno</span></a> <span class='Operator'>+= </span><a href="setrefs.c.html#LN1511"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN49"><span class='Ref_to_Member'>rtoffset</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1559"><span class='Ref_To_Local'>cexpr</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1511"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN1846"><span class='Ref_to_Struct'>PlaceHolderVar</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* At scan level, we should always just evaluate the contained expr */ 
</span><a name="LN1570"></a>        <a href="../../../include/nodes/relation.h.html#LN1846"><span class='Ref_to_Struct'>PlaceHolderVar</span></a> <span class='Operator'>*</span><span class='Declare_Local'>phv</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1846"><span class='Ref_to_Struct'>PlaceHolderVar</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1511"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>return</span> <a href="setrefs.c.html#LN102"><span class='Ref_to_Proto'>fix_scan_expr_mutator</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1570"><span class='Ref_To_Local'>phv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1849"><span class='Ref_to_Member'>phexpr</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1511"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="setrefs.c.html#LN1354"><span class='Ref_to_Func'>fix_expr_common</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1511"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN48"><span class='Ref_to_Member'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1511"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="../../../include/nodes/nodeFuncs.h.html#LN54"><span class='Ref_to_Proto'>expression_tree_mutator</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1511"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN102"><span class='Ref_to_Proto'>fix_scan_expr_mutator</span></a><span class='Delimiter'>, 
</span>                                   <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1511"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end fix_scan_expr_mutator &raquo; </span> 
 
<span class='Keyword'>static bool 
</span><a name="LN1580"></a><span class='Declare_Function'>fix_scan_expr_walker</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><a href="setrefs.c.html#LN46"><span class='Ref_to_Typedef'>fix_scan_expr_context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN1580"><span class='Ref_to_Parameter'>node</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1580"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN1846"><span class='Ref_to_Struct'>PlaceHolderVar</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="setrefs.c.html#LN1354"><span class='Ref_to_Func'>fix_expr_common</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1580"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN48"><span class='Ref_to_Member'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1580"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="../../../include/nodes/nodeFuncs.h.html#LN52"><span class='Ref_to_Proto'>expression_tree_walker</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1580"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN103"><span class='Ref_to_Proto'>fix_scan_expr_walker</span></a><span class='Delimiter'>, 
</span>                                  <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1580"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * set_join_references 
 *    Modify the target list and quals of a join node to reference its 
 *    subplans, by setting the varnos to OUTER_VAR or INNER_VAR and setting 
 *    attno values to the result domain number of either the corresponding 
 *    outer or inner join tuple item.  Also perform opcode lookup for these 
 *    expressions, and add regclass OIDs to root-&GT;glob-&GT;relationOids. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1599"></a><span class='Declare_Function'>set_join_references</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/plannodes.h.html#LN665"><span class='Ref_to_Struct'>Join</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>join</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>rtoffset</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1601"></a>    <a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>outer_plan</span> <span class='Operator'>= </span><a href="setrefs.c.html#LN1599"><span class='Ref_to_Parameter'>join</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN667"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN145"><span class='Ref_to_Member'>lefttree</span></a><span class='Delimiter'>; 
</span><a name="LN1602"></a>    <a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>inner_plan</span> <span class='Operator'>= </span><a href="setrefs.c.html#LN1599"><span class='Ref_to_Parameter'>join</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN667"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN146"><span class='Ref_to_Member'>righttree</span></a><span class='Delimiter'>; 
</span><a name="LN1603"></a>    <a href="setrefs.c.html#LN37"><span class='Ref_to_Typedef'>indexed_tlist</span></a> <span class='Operator'>*</span><span class='Declare_Local'>outer_itlist</span><span class='Delimiter'>; 
</span><a name="LN1604"></a>    <a href="setrefs.c.html#LN37"><span class='Ref_to_Typedef'>indexed_tlist</span></a> <span class='Operator'>*</span><span class='Declare_Local'>inner_itlist</span><span class='Delimiter'>; 
</span> 
    <a href="setrefs.c.html#LN1603"><span class='Ref_To_Local'>outer_itlist</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN108"><span class='Ref_to_Proto'>build_tlist_index</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1601"><span class='Ref_To_Local'>outer_plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="setrefs.c.html#LN1604"><span class='Ref_To_Local'>inner_itlist</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN108"><span class='Ref_to_Proto'>build_tlist_index</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1602"><span class='Ref_To_Local'>inner_plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * First process the joinquals (including merge or hash clauses).  These 
     * are logically below the join so they can always use all values 
     * available from the input tlists.  It's okay to also handle 
     * NestLoopParams now, because those couldn't refer to nullable 
     * subexpressions. 
     */ 
</span>    <a href="setrefs.c.html#LN1599"><span class='Ref_to_Parameter'>join</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN670"><span class='Ref_to_Member'>joinqual</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN120"><span class='Ref_to_Proto'>fix_join_expr</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1599"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                   <a href="setrefs.c.html#LN1599"><span class='Ref_to_Parameter'>join</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN670"><span class='Ref_to_Member'>joinqual</span></a><span class='Delimiter'>, 
</span>                                   <a href="setrefs.c.html#LN1603"><span class='Ref_To_Local'>outer_itlist</span></a><span class='Delimiter'>, 
</span>                                   <a href="setrefs.c.html#LN1604"><span class='Ref_To_Local'>inner_itlist</span></a><span class='Delimiter'>, 
</span>                                   <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                   <a href="setrefs.c.html#LN1599"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Now do join-type-specific stuff */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1599"><span class='Ref_to_Parameter'>join</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/plannodes.h.html#LN684"><span class='Ref_to_Struct'>NestLoop</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1626"></a>        <a href="../../../include/nodes/plannodes.h.html#LN684"><span class='Ref_to_Struct'>NestLoop</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>nl</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN684"><span class='Ref_to_Struct'>NestLoop</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1599"><span class='Ref_to_Parameter'>join</span></a><span class='Delimiter'>; 
</span><a name="LN1627"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1627"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1626"><span class='Ref_To_Local'>nl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN687"><span class='Ref_to_Member'>nestParams</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1631"></a>            <a href="../../../include/nodes/plannodes.h.html#LN690"><span class='Ref_to_Struct'>NestLoopParam</span></a> <span class='Operator'>*</span><span class='Declare_Local'>nlp</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN690"><span class='Ref_to_Struct'>NestLoopParam</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1627"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="setrefs.c.html#LN1631"><span class='Ref_To_Local'>nlp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN694"><span class='Ref_to_Member'>paramval</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN127"><span class='Ref_to_Proto'>fix_upper_expr</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1599"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                                   <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1631"><span class='Ref_To_Local'>nlp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN694"><span class='Ref_to_Member'>paramval</span></a><span class='Delimiter'>, 
</span>                                                   <a href="setrefs.c.html#LN1603"><span class='Ref_To_Local'>outer_itlist</span></a><span class='Delimiter'>, 
</span>                                                   <a href="../../../include/nodes/primnodes.h.html#LN153"><span class='Ref_to_Const'>OUTER_VAR</span></a><span class='Delimiter'>, 
</span>                                                   <a href="setrefs.c.html#LN1599"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Check we replaced any PlaceHolderVar with simple Var */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1631"><span class='Ref_To_Local'>nlp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN694"><span class='Ref_to_Member'>paramval</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>                  <a href="setrefs.c.html#LN1631"><span class='Ref_To_Local'>nlp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN694"><span class='Ref_to_Member'>paramval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN165"><span class='Ref_to_Member'>varno</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/primnodes.h.html#LN153"><span class='Ref_to_Const'>OUTER_VAR</span></a><span class='Parentheses'>))</span> 
                <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"NestLoopParam was not reduced to a simple Var"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IsA(join,NestLoop) &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1599"><span class='Ref_to_Parameter'>join</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/plannodes.h.html#LN708"><span class='Ref_to_Struct'>MergeJoin</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1646"></a>        <a href="../../../include/nodes/plannodes.h.html#LN708"><span class='Ref_to_Struct'>MergeJoin</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>mj</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN708"><span class='Ref_to_Struct'>MergeJoin</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1599"><span class='Ref_to_Parameter'>join</span></a><span class='Delimiter'>; 
</span> 
        <a href="setrefs.c.html#LN1646"><span class='Ref_To_Local'>mj</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN712"><span class='Ref_to_Member'>mergeclauses</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN120"><span class='Ref_to_Proto'>fix_join_expr</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1599"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                         <a href="setrefs.c.html#LN1646"><span class='Ref_To_Local'>mj</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN712"><span class='Ref_to_Member'>mergeclauses</span></a><span class='Delimiter'>, 
</span>                                         <a href="setrefs.c.html#LN1603"><span class='Ref_To_Local'>outer_itlist</span></a><span class='Delimiter'>, 
</span>                                         <a href="setrefs.c.html#LN1604"><span class='Ref_To_Local'>inner_itlist</span></a><span class='Delimiter'>, 
</span>                                         <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                         <a href="setrefs.c.html#LN1599"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1599"><span class='Ref_to_Parameter'>join</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/plannodes.h.html#LN724"><span class='Ref_to_Struct'>HashJoin</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1657"></a>        <a href="../../../include/nodes/plannodes.h.html#LN724"><span class='Ref_to_Struct'>HashJoin</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>hj</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN724"><span class='Ref_to_Struct'>HashJoin</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1599"><span class='Ref_to_Parameter'>join</span></a><span class='Delimiter'>; 
</span> 
        <a href="setrefs.c.html#LN1657"><span class='Ref_To_Local'>hj</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN727"><span class='Ref_to_Member'>hashclauses</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN120"><span class='Ref_to_Proto'>fix_join_expr</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1599"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                        <a href="setrefs.c.html#LN1657"><span class='Ref_To_Local'>hj</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN727"><span class='Ref_to_Member'>hashclauses</span></a><span class='Delimiter'>, 
</span>                                        <a href="setrefs.c.html#LN1603"><span class='Ref_To_Local'>outer_itlist</span></a><span class='Delimiter'>, 
</span>                                        <a href="setrefs.c.html#LN1604"><span class='Ref_To_Local'>inner_itlist</span></a><span class='Delimiter'>, 
</span>                                        <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                        <a href="setrefs.c.html#LN1599"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now we need to fix up the targetlist and qpqual, which are logically 
     * above the join.  This means they should not re-use any input expression 
     * that was computed in the nullable side of an outer join.  Vars and 
     * PlaceHolderVars are fine, so we can implement this restriction just by 
     * clearing has_non_vars in the indexed_tlist structs. 
     * 
     * XXX This is a grotty workaround for the fact that we don't clearly 
     * distinguish between a Var appearing below an outer join and the "same" 
     * Var appearing above it.  If we did, we'd not need to hack the matching 
     * rules this way. 
     */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN1599"><span class='Ref_to_Parameter'>join</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN668"><span class='Ref_to_Member'>jointype</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN678"><span class='Ref_to_EnumConst'>JOIN_LEFT</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN691"><span class='Ref_to_EnumConst'>JOIN_SEMI</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN692"><span class='Ref_to_EnumConst'>JOIN_ANTI</span></a><span class='Operator'>: 
</span>            <a href="setrefs.c.html#LN1604"><span class='Ref_To_Local'>inner_itlist</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN42"><span class='Ref_to_Member'>has_non_vars</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN680"><span class='Ref_to_EnumConst'>JOIN_RIGHT</span></a><span class='Operator'>: 
</span>            <a href="setrefs.c.html#LN1603"><span class='Ref_To_Local'>outer_itlist</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN42"><span class='Ref_to_Member'>has_non_vars</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN679"><span class='Ref_to_EnumConst'>JOIN_FULL</span></a><span class='Operator'>: 
</span>            <a href="setrefs.c.html#LN1603"><span class='Ref_To_Local'>outer_itlist</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN42"><span class='Ref_to_Member'>has_non_vars</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="setrefs.c.html#LN1604"><span class='Ref_To_Local'>inner_itlist</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN42"><span class='Ref_to_Member'>has_non_vars</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="setrefs.c.html#LN1599"><span class='Ref_to_Parameter'>join</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN667"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN120"><span class='Ref_to_Proto'>fix_join_expr</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1599"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                          <a href="setrefs.c.html#LN1599"><span class='Ref_to_Parameter'>join</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN667"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Delimiter'>, 
</span>                                          <a href="setrefs.c.html#LN1603"><span class='Ref_To_Local'>outer_itlist</span></a><span class='Delimiter'>, 
</span>                                          <a href="setrefs.c.html#LN1604"><span class='Ref_To_Local'>inner_itlist</span></a><span class='Delimiter'>, 
</span>                                          <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                          <a href="setrefs.c.html#LN1599"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="setrefs.c.html#LN1599"><span class='Ref_to_Parameter'>join</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN667"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN120"><span class='Ref_to_Proto'>fix_join_expr</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1599"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                    <a href="setrefs.c.html#LN1599"><span class='Ref_to_Parameter'>join</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN667"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a><span class='Delimiter'>, 
</span>                                    <a href="setrefs.c.html#LN1603"><span class='Ref_To_Local'>outer_itlist</span></a><span class='Delimiter'>, 
</span>                                    <a href="setrefs.c.html#LN1604"><span class='Ref_To_Local'>inner_itlist</span></a><span class='Delimiter'>, 
</span>                                    <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                    <a href="setrefs.c.html#LN1599"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1603"><span class='Ref_To_Local'>outer_itlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1604"><span class='Ref_To_Local'>inner_itlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end set_join_references &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * set_upper_references 
 *    Update the targetlist and quals of an upper-level plan node 
 *    to refer to the tuples returned by its lefttree subplan. 
 *    Also perform opcode lookup for these expressions, and 
 *    add regclass OIDs to root-&GT;glob-&GT;relationOids. 
 * 
 * This is used for single-input plan types like Agg, Group, Result. 
 * 
 * In most cases, we have to match up individual Vars in the tlist and 
 * qual expressions with elements of the subplan's tlist (which was 
 * generated by flattening these selfsame expressions, so it should have all 
 * the required variables).  There is an important exception, however: 
 * depending on where we are in the plan tree, sort/group columns may have 
 * been pushed into the subplan tlist unflattened.  If these values are also 
 * needed in the output then we want to reference the subplan tlist element 
 * rather than recomputing the expression. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1733"></a><span class='Declare_Function'>set_upper_references</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>plan</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>rtoffset</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1735"></a>    <a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>subplan</span> <span class='Operator'>= </span><a href="setrefs.c.html#LN1733"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN145"><span class='Ref_to_Member'>lefttree</span></a><span class='Delimiter'>; 
</span><a name="LN1736"></a>    <a href="setrefs.c.html#LN37"><span class='Ref_to_Typedef'>indexed_tlist</span></a> <span class='Operator'>*</span><span class='Declare_Local'>subplan_itlist</span><span class='Delimiter'>; 
</span><a name="LN1737"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>output_targetlist</span><span class='Delimiter'>; 
</span><a name="LN1738"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
    <a href="setrefs.c.html#LN1736"><span class='Ref_To_Local'>subplan_itlist</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN108"><span class='Ref_to_Proto'>build_tlist_index</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1735"><span class='Ref_To_Local'>subplan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="setrefs.c.html#LN1737"><span class='Ref_To_Local'>output_targetlist</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1738"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1733"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1745"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tle</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1738"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1746"></a>        <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>newexpr</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* If it's a non-Var sort/group item, first try to match by sortref */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN1745"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1369"><span class='Ref_to_Member'>ressortgroupref</span></a> <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>&& !</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1745"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="setrefs.c.html#LN1746"><span class='Ref_To_Local'>newexpr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>                <a href="setrefs.c.html#LN116"><span class='Ref_to_Proto'>search_indexed_tlist_for_sortgroupref</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1745"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Delimiter'>, 
</span>                                                      <a href="setrefs.c.html#LN1745"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1369"><span class='Ref_to_Member'>ressortgroupref</span></a><span class='Delimiter'>, 
</span>                                                      <a href="setrefs.c.html#LN1736"><span class='Ref_To_Local'>subplan_itlist</span></a><span class='Delimiter'>, 
</span>                                                      <a href="../../../include/nodes/primnodes.h.html#LN153"><span class='Ref_to_Const'>OUTER_VAR</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="setrefs.c.html#LN1746"><span class='Ref_To_Local'>newexpr</span></a><span class='Parentheses'>) 
</span>                <a href="setrefs.c.html#LN1746"><span class='Ref_To_Local'>newexpr</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN127"><span class='Ref_to_Proto'>fix_upper_expr</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1733"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                         <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1745"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Delimiter'>, 
</span>                                         <a href="setrefs.c.html#LN1736"><span class='Ref_To_Local'>subplan_itlist</span></a><span class='Delimiter'>, 
</span>                                         <a href="../../../include/nodes/primnodes.h.html#LN153"><span class='Ref_to_Const'>OUTER_VAR</span></a><span class='Delimiter'>, 
</span>                                         <a href="setrefs.c.html#LN1733"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="setrefs.c.html#LN1746"><span class='Ref_To_Local'>newexpr</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN127"><span class='Ref_to_Proto'>fix_upper_expr</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1733"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                     <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1745"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Delimiter'>, 
</span>                                     <a href="setrefs.c.html#LN1736"><span class='Ref_To_Local'>subplan_itlist</span></a><span class='Delimiter'>, 
</span>                                     <a href="../../../include/nodes/primnodes.h.html#LN153"><span class='Ref_to_Const'>OUTER_VAR</span></a><span class='Delimiter'>, 
</span>                                     <a href="setrefs.c.html#LN1733"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="setrefs.c.html#LN1745"><span class='Ref_To_Local'>tle</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/makefuncs.h.html#LN45"><span class='Ref_to_Proto'>flatCopyTargetEntry</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1745"><span class='Ref_To_Local'>tle</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="setrefs.c.html#LN1745"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1746"><span class='Ref_To_Local'>newexpr</span></a><span class='Delimiter'>; 
</span>        <a href="setrefs.c.html#LN1737"><span class='Ref_To_Local'>output_targetlist</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1737"><span class='Ref_To_Local'>output_targetlist</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1745"><span class='Ref_To_Local'>tle</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="setrefs.c.html#LN1733"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN1737"><span class='Ref_To_Local'>output_targetlist</span></a><span class='Delimiter'>; 
</span> 
    <a href="setrefs.c.html#LN1733"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>        <a href="setrefs.c.html#LN127"><span class='Ref_to_Proto'>fix_upper_expr</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1733"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                       <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1733"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a><span class='Delimiter'>, 
</span>                       <a href="setrefs.c.html#LN1736"><span class='Ref_To_Local'>subplan_itlist</span></a><span class='Delimiter'>, 
</span>                       <a href="../../../include/nodes/primnodes.h.html#LN153"><span class='Ref_to_Const'>OUTER_VAR</span></a><span class='Delimiter'>, 
</span>                       <a href="setrefs.c.html#LN1733"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1736"><span class='Ref_To_Local'>subplan_itlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end set_upper_references &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Recursively scan an expression tree and convert Aggrefs to the proper 
 * intermediate form for combining aggregates.  This means (1) replacing each 
 * one's argument list with a single argument that is the original Aggref 
 * modified to show partial aggregation and (2) changing the upper Aggref to 
 * show combining aggregation. 
 * 
 * After this step, set_upper_references will replace the partial Aggrefs 
 * with Vars referencing the lower Agg plan node's outputs, so that the final 
 * form seen by the executor is a combining Aggref with a Var as input. 
 * 
 * It's rather messy to postpone this step until setrefs.c; ideally it'd be 
 * done in createplan.c.  The difficulty is that once we modify the Aggref 
 * expressions, they will no longer be equal() to their original form and 
 * so cross-plan-node-level matches will fail.  So this has to happen after 
 * the plan node above the Agg has resolved its subplan references. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>* 
</span><a name="LN1803"></a><span class='Declare_Function'>convert_combining_aggrefs</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN1803"><span class='Ref_to_Parameter'>node</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1803"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN290"><span class='Ref_to_Struct'>Aggref</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1809"></a>        <a href="../../../include/nodes/primnodes.h.html#LN290"><span class='Ref_to_Struct'>Aggref</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>orig_agg</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN290"><span class='Ref_to_Struct'>Aggref</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1803"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span><a name="LN1810"></a>        <a href="../../../include/nodes/primnodes.h.html#LN290"><span class='Ref_to_Struct'>Aggref</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>child_agg</span><span class='Delimiter'>; 
</span><a name="LN1811"></a>        <a href="../../../include/nodes/primnodes.h.html#LN290"><span class='Ref_to_Struct'>Aggref</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>parent_agg</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Assert we've not chosen to partial-ize any unsupported cases */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1809"><span class='Ref_To_Local'>orig_agg</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN301"><span class='Ref_to_Member'>aggorder</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1809"><span class='Ref_To_Local'>orig_agg</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN302"><span class='Ref_to_Member'>aggdistinct</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Since aggregate calls can't be nested, we needn't recurse into the 
         * arguments.  But for safety, flat-copy the Aggref node itself rather 
         * than modifying it in-place. 
         */ 
</span>        <a href="setrefs.c.html#LN1810"><span class='Ref_To_Local'>child_agg</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN290"><span class='Ref_to_Struct'>Aggref</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><a href="setrefs.c.html#LN1810"><span class='Ref_To_Local'>child_agg</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1809"><span class='Ref_To_Local'>orig_agg</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN290"><span class='Ref_to_Struct'>Aggref</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * For the parent Aggref, we want to copy all the fields of the 
         * original aggregate *except* the args list, which we'll replace 
         * below, and the aggfilter expression, which should be applied only 
         * by the child not the parent.  Rather than explicitly knowing about 
         * all the other fields here, we can momentarily modify child_agg to 
         * provide a suitable source for copyObject. 
         */ 
</span>        <a href="setrefs.c.html#LN1810"><span class='Ref_To_Local'>child_agg</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN300"><span class='Ref_to_Member'>args</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>        <a href="setrefs.c.html#LN1810"><span class='Ref_To_Local'>child_agg</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN303"><span class='Ref_to_Member'>aggfilter</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="setrefs.c.html#LN1811"><span class='Ref_To_Local'>parent_agg</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1810"><span class='Ref_To_Local'>child_agg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="setrefs.c.html#LN1810"><span class='Ref_To_Local'>child_agg</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN300"><span class='Ref_to_Member'>args</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN1809"><span class='Ref_To_Local'>orig_agg</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN300"><span class='Ref_to_Member'>args</span></a><span class='Delimiter'>; 
</span>        <a href="setrefs.c.html#LN1810"><span class='Ref_To_Local'>child_agg</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN303"><span class='Ref_to_Member'>aggfilter</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN1809"><span class='Ref_To_Local'>orig_agg</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN303"><span class='Ref_to_Member'>aggfilter</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Now, set up child_agg to represent the first phase of partial 
         * aggregation.  For now, assume serialization is required. 
         */ 
</span>        <a href="../../../include/optimizer/planner.h.html#LN48"><span class='Ref_to_Proto'>mark_partial_aggref</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1810"><span class='Ref_To_Local'>child_agg</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/nodes.h.html#LN760"><span class='Ref_to_EnumConst'>AGGSPLIT_INITIAL_SERIAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * And set up parent_agg to represent the second phase. 
         */ 
</span>        <a href="setrefs.c.html#LN1811"><span class='Ref_To_Local'>parent_agg</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN300"><span class='Ref_to_Member'>args</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN138"><span class='Ref_to_Macro'>list_make1</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/makefuncs.h.html#LN40"><span class='Ref_to_Proto'>makeTargetEntry</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1810"><span class='Ref_To_Local'>child_agg</span></a><span class='Delimiter'>, 
</span>                                                      <span class='Number'>1</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../../include/optimizer/planner.h.html#LN48"><span class='Ref_to_Proto'>mark_partial_aggref</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1811"><span class='Ref_To_Local'>parent_agg</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/nodes.h.html#LN762"><span class='Ref_to_EnumConst'>AGGSPLIT_FINAL_DESERIAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1811"><span class='Ref_To_Local'>parent_agg</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IsA(node,Aggref) &raquo; </span> 
    <span class='Control'>return</span> <a href="../../../include/nodes/nodeFuncs.h.html#LN54"><span class='Ref_to_Proto'>expression_tree_mutator</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1803"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN106"><span class='Ref_to_Proto'>convert_combining_aggrefs</span></a><span class='Delimiter'>, 
</span>                                   <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1803"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end convert_combining_aggrefs &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * set_dummy_tlist_references 
 *    Replace the targetlist of an upper-level plan node with a simple 
 *    list of OUTER_VAR references to its child. 
 * 
 * This is used for plan types like Sort and Append that don't evaluate 
 * their targetlists.  Although the executor doesn't care at all what's in 
 * the tlist, EXPLAIN needs it to be realistic. 
 * 
 * Note: we could almost use set_upper_references() here, but it fails for 
 * Append for lack of a lefttree subplan.  Single-purpose code is faster 
 * anyway. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1872"></a><span class='Declare_Function'>set_dummy_tlist_references</span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>plan</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>rtoffset</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1874"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>output_targetlist</span><span class='Delimiter'>; 
</span><a name="LN1875"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
    <a href="setrefs.c.html#LN1874"><span class='Ref_To_Local'>output_targetlist</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1875"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1872"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1880"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tle</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1875"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1881"></a>        <a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>oldvar</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1880"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Delimiter'>; 
</span><a name="LN1882"></a>        <a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>newvar</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * As in search_indexed_tlist_for_non_var(), we prefer to keep Consts 
         * as Consts, not Vars referencing Consts.  Here, there's no speed 
         * advantage to be had, but it makes EXPLAIN output look cleaner, and 
         * again it avoids confusing the executor. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1881"><span class='Ref_To_Local'>oldvar</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* just reuse the existing TLE node */ 
</span>            <a href="setrefs.c.html#LN1874"><span class='Ref_To_Local'>output_targetlist</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1874"><span class='Ref_To_Local'>output_targetlist</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1880"><span class='Ref_To_Local'>tle</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="setrefs.c.html#LN1882"><span class='Ref_To_Local'>newvar</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/makefuncs.h.html#LN25"><span class='Ref_to_Proto'>makeVar</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN153"><span class='Ref_to_Const'>OUTER_VAR</span></a><span class='Delimiter'>, 
</span>                         <a href="setrefs.c.html#LN1880"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1367"><span class='Ref_to_Member'>resno</span></a><span class='Delimiter'>, 
</span>                         <a href="../../../include/nodes/nodeFuncs.h.html#LN31"><span class='Ref_to_Proto'>exprType</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1881"><span class='Ref_To_Local'>oldvar</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../../include/nodes/nodeFuncs.h.html#LN32"><span class='Ref_to_Proto'>exprTypmod</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1881"><span class='Ref_To_Local'>oldvar</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../../include/nodes/nodeFuncs.h.html#LN38"><span class='Ref_to_Proto'>exprCollation</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1881"><span class='Ref_To_Local'>oldvar</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1881"><span class='Ref_To_Local'>oldvar</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="setrefs.c.html#LN1882"><span class='Ref_To_Local'>newvar</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN175"><span class='Ref_to_Member'>varnoold</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN1881"><span class='Ref_To_Local'>oldvar</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN165"><span class='Ref_to_Member'>varno</span></a> <span class='Operator'>+ </span><a href="setrefs.c.html#LN1872"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Delimiter'>; 
</span>            <a href="setrefs.c.html#LN1882"><span class='Ref_To_Local'>newvar</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN176"><span class='Ref_to_Member'>varoattno</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN1881"><span class='Ref_To_Local'>oldvar</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN167"><span class='Ref_to_Member'>varattno</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="setrefs.c.html#LN1882"><span class='Ref_To_Local'>newvar</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN175"><span class='Ref_to_Member'>varnoold</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* wasn't ever a plain Var */ 
</span>            <a href="setrefs.c.html#LN1882"><span class='Ref_To_Local'>newvar</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN176"><span class='Ref_to_Member'>varoattno</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="setrefs.c.html#LN1880"><span class='Ref_To_Local'>tle</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/makefuncs.h.html#LN45"><span class='Ref_to_Proto'>flatCopyTargetEntry</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1880"><span class='Ref_To_Local'>tle</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="setrefs.c.html#LN1880"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1882"><span class='Ref_To_Local'>newvar</span></a><span class='Delimiter'>; 
</span>        <a href="setrefs.c.html#LN1874"><span class='Ref_To_Local'>output_targetlist</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1874"><span class='Ref_To_Local'>output_targetlist</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1880"><span class='Ref_To_Local'>tle</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="setrefs.c.html#LN1872"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN1874"><span class='Ref_To_Local'>output_targetlist</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* We don't touch plan-&GT;qual here */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end set_dummy_tlist_references &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * build_tlist_index --- build an index data structure for a child tlist 
 * 
 * In most cases, subplan tlists will be "flat" tlists with only Vars, 
 * so we try to optimize that case by extracting information about Vars 
 * in advance.  Matching a parent tlist to a child is still an O(N^2) 
 * operation, but at least with a much smaller constant factor than plain 
 * tlist_member() searches. 
 * 
 * The result of this function is an indexed_tlist struct to pass to 
 * search_indexed_tlist_for_var() or search_indexed_tlist_for_non_var(). 
 * When done, the indexed_tlist may be freed with a single pfree(). 
 */ 
</span><span class='Keyword'>static </span><a href="setrefs.c.html#LN37"><span class='Ref_to_Typedef'>indexed_tlist</span></a> <span class='Operator'>* 
</span><a name="LN1938"></a><span class='Declare_Function'>build_tlist_index</span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tlist</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1940"></a>    <a href="setrefs.c.html#LN37"><span class='Ref_to_Typedef'>indexed_tlist</span></a> <span class='Operator'>*</span><span class='Declare_Local'>itlist</span><span class='Delimiter'>; 
</span><a name="LN1941"></a>    <a href="setrefs.c.html#LN30"><span class='Ref_to_Typedef'>tlist_vinfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>vinfo</span><span class='Delimiter'>; 
</span><a name="LN1942"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Create data structure with enough slots for all tlist entries */ 
</span>    <a href="setrefs.c.html#LN1940"><span class='Ref_To_Local'>itlist</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="setrefs.c.html#LN37"><span class='Ref_to_Typedef'>indexed_tlist</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN37"><span class='Ref_to_Typedef'>indexed_tlist</span></a><span class='Delimiter'>, </span><a href="../../regex/regexec.c.html#LN102"><span class='Ref_to_Struct'>vars</span></a><span class='Parentheses'>) </span><span class='Operator'>+ 
</span>               <a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1938"><span class='Ref_to_Parameter'>tlist</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="setrefs.c.html#LN30"><span class='Ref_to_Typedef'>tlist_vinfo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="setrefs.c.html#LN1940"><span class='Ref_To_Local'>itlist</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN39"><span class='Ref_to_Member'>tlist</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN1938"><span class='Ref_to_Parameter'>tlist</span></a><span class='Delimiter'>; 
</span>    <a href="setrefs.c.html#LN1940"><span class='Ref_To_Local'>itlist</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN41"><span class='Ref_to_Member'>has_ph_vars</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="setrefs.c.html#LN1940"><span class='Ref_To_Local'>itlist</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN42"><span class='Ref_to_Member'>has_non_vars</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Find the Vars and fill in the index array */ 
</span>    <a href="setrefs.c.html#LN1941"><span class='Ref_To_Local'>vinfo</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN1940"><span class='Ref_To_Local'>itlist</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN43"><span class='Ref_to_Member'>vars</span></a><span class='Delimiter'>; 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1942"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1938"><span class='Ref_to_Parameter'>tlist</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1957"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tle</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1942"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN1957"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a> <span class='Operator'>&& </span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1957"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN1961"></a>            <a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>var</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN1957"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Delimiter'>; 
</span> 
            <a href="setrefs.c.html#LN1941"><span class='Ref_To_Local'>vinfo</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN32"><span class='Ref_to_Member'>varno</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN1961"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN165"><span class='Ref_to_Member'>varno</span></a><span class='Delimiter'>; 
</span>            <a href="setrefs.c.html#LN1941"><span class='Ref_To_Local'>vinfo</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN33"><span class='Ref_to_Member'>varattno</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN1961"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN167"><span class='Ref_to_Member'>varattno</span></a><span class='Delimiter'>; 
</span>            <a href="setrefs.c.html#LN1941"><span class='Ref_To_Local'>vinfo</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN34"><span class='Ref_to_Member'>resno</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN1957"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1367"><span class='Ref_to_Member'>resno</span></a><span class='Delimiter'>; 
</span>            <a href="setrefs.c.html#LN1941"><span class='Ref_To_Local'>vinfo</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN1957"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a> <span class='Operator'>&& </span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1957"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN1846"><span class='Ref_to_Struct'>PlaceHolderVar</span></a><span class='Parentheses'>))</span> 
            <a href="setrefs.c.html#LN1940"><span class='Ref_To_Local'>itlist</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN41"><span class='Ref_to_Member'>has_ph_vars</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="setrefs.c.html#LN1940"><span class='Ref_To_Local'>itlist</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN42"><span class='Ref_to_Member'>has_non_vars</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="setrefs.c.html#LN1940"><span class='Ref_To_Local'>itlist</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN40"><span class='Ref_to_Member'>num_vars</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1941"><span class='Ref_To_Local'>vinfo</span></a> <span class='Operator'>- </span><a href="setrefs.c.html#LN1940"><span class='Ref_To_Local'>itlist</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN43"><span class='Ref_to_Member'>vars</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="setrefs.c.html#LN1940"><span class='Ref_To_Local'>itlist</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end build_tlist_index &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * build_tlist_index_other_vars --- build a restricted tlist index 
 * 
 * This is like build_tlist_index, but we only index tlist entries that 
 * are Vars belonging to some rel other than the one specified.  We will set 
 * has_ph_vars (allowing PlaceHolderVars to be matched), but not has_non_vars 
 * (so nothing other than Vars and PlaceHolderVars can be matched). 
 */ 
</span><span class='Keyword'>static </span><a href="setrefs.c.html#LN37"><span class='Ref_to_Typedef'>indexed_tlist</span></a> <span class='Operator'>* 
</span><a name="LN1988"></a><span class='Declare_Function'>build_tlist_index_other_vars</span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tlist</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>ignore_rel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1990"></a>    <a href="setrefs.c.html#LN37"><span class='Ref_to_Typedef'>indexed_tlist</span></a> <span class='Operator'>*</span><span class='Declare_Local'>itlist</span><span class='Delimiter'>; 
</span><a name="LN1991"></a>    <a href="setrefs.c.html#LN30"><span class='Ref_to_Typedef'>tlist_vinfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>vinfo</span><span class='Delimiter'>; 
</span><a name="LN1992"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Create data structure with enough slots for all tlist entries */ 
</span>    <a href="setrefs.c.html#LN1990"><span class='Ref_To_Local'>itlist</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="setrefs.c.html#LN37"><span class='Ref_to_Typedef'>indexed_tlist</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN37"><span class='Ref_to_Typedef'>indexed_tlist</span></a><span class='Delimiter'>, </span><a href="../../regex/regexec.c.html#LN102"><span class='Ref_to_Struct'>vars</span></a><span class='Parentheses'>) </span><span class='Operator'>+ 
</span>               <a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1988"><span class='Ref_to_Parameter'>tlist</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="setrefs.c.html#LN30"><span class='Ref_to_Typedef'>tlist_vinfo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="setrefs.c.html#LN1990"><span class='Ref_To_Local'>itlist</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN39"><span class='Ref_to_Member'>tlist</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN1988"><span class='Ref_to_Parameter'>tlist</span></a><span class='Delimiter'>; 
</span>    <a href="setrefs.c.html#LN1990"><span class='Ref_To_Local'>itlist</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN41"><span class='Ref_to_Member'>has_ph_vars</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="setrefs.c.html#LN1990"><span class='Ref_To_Local'>itlist</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN42"><span class='Ref_to_Member'>has_non_vars</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Find the desired Vars and fill in the index array */ 
</span>    <a href="setrefs.c.html#LN1991"><span class='Ref_To_Local'>vinfo</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN1990"><span class='Ref_To_Local'>itlist</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN43"><span class='Ref_to_Member'>vars</span></a><span class='Delimiter'>; 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1992"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN1988"><span class='Ref_to_Parameter'>tlist</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2007"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tle</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1992"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN2007"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a> <span class='Operator'>&& </span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2007"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN2011"></a>            <a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>var</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN2007"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN2011"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN165"><span class='Ref_to_Member'>varno</span></a> <span class='Operator'>!= </span><a href="setrefs.c.html#LN1988"><span class='Ref_to_Parameter'>ignore_rel</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="setrefs.c.html#LN1991"><span class='Ref_To_Local'>vinfo</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN32"><span class='Ref_to_Member'>varno</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN2011"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN165"><span class='Ref_to_Member'>varno</span></a><span class='Delimiter'>; 
</span>                <a href="setrefs.c.html#LN1991"><span class='Ref_To_Local'>vinfo</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN33"><span class='Ref_to_Member'>varattno</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN2011"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN167"><span class='Ref_to_Member'>varattno</span></a><span class='Delimiter'>; 
</span>                <a href="setrefs.c.html#LN1991"><span class='Ref_To_Local'>vinfo</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN34"><span class='Ref_to_Member'>resno</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN2007"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1367"><span class='Ref_to_Member'>resno</span></a><span class='Delimiter'>; 
</span>                <a href="setrefs.c.html#LN1991"><span class='Ref_To_Local'>vinfo</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN2007"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a> <span class='Operator'>&& </span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2007"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN1846"><span class='Ref_to_Struct'>PlaceHolderVar</span></a><span class='Parentheses'>))</span> 
            <a href="setrefs.c.html#LN1990"><span class='Ref_To_Local'>itlist</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN41"><span class='Ref_to_Member'>has_ph_vars</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="setrefs.c.html#LN1990"><span class='Ref_To_Local'>itlist</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN40"><span class='Ref_to_Member'>num_vars</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="setrefs.c.html#LN1991"><span class='Ref_To_Local'>vinfo</span></a> <span class='Operator'>- </span><a href="setrefs.c.html#LN1990"><span class='Ref_To_Local'>itlist</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN43"><span class='Ref_to_Member'>vars</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="setrefs.c.html#LN1990"><span class='Ref_To_Local'>itlist</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end build_tlist_index_other_vars &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * search_indexed_tlist_for_var --- find a Var in an indexed tlist 
 * 
 * If a match is found, return a copy of the given Var with suitably 
 * modified varno/varattno (to wit, newvarno and the resno of the TLE entry). 
 * Also ensure that varnoold is incremented by rtoffset. 
 * If no match, return NULL. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>* 
</span><a name="LN2039"></a><span class='Declare_Function'>search_indexed_tlist_for_var</span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Delimiter'>, </span><a href="setrefs.c.html#LN37"><span class='Ref_to_Typedef'>indexed_tlist</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>itlist</span><span class='Delimiter'>, 
</span><a name="LN2040"></a>                             <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>newvarno</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>rtoffset</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2042"></a>    <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a>       <span class='Declare_Local'>varno</span> <span class='Operator'>= </span><a href="setrefs.c.html#LN2039"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN165"><span class='Ref_to_Member'>varno</span></a><span class='Delimiter'>; 
</span><a name="LN2043"></a>    <a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>varattno</span> <span class='Operator'>= </span><a href="setrefs.c.html#LN2039"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN167"><span class='Ref_to_Member'>varattno</span></a><span class='Delimiter'>; 
</span><a name="LN2044"></a>    <a href="setrefs.c.html#LN30"><span class='Ref_to_Typedef'>tlist_vinfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>vinfo</span><span class='Delimiter'>; 
</span><a name="LN2045"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <a href="setrefs.c.html#LN2044"><span class='Ref_To_Local'>vinfo</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN2039"><span class='Ref_to_Parameter'>itlist</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN43"><span class='Ref_to_Member'>vars</span></a><span class='Delimiter'>; 
</span>    <a href="setrefs.c.html#LN2045"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN2039"><span class='Ref_to_Parameter'>itlist</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN40"><span class='Ref_to_Member'>num_vars</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN2045"><span class='Ref_To_Local'>i</span></a><span class='Operator'>-- &GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN2044"><span class='Ref_To_Local'>vinfo</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN32"><span class='Ref_to_Member'>varno</span></a> <span class='Operator'>== </span><a href="setrefs.c.html#LN2042"><span class='Ref_To_Local'>varno</span></a> <span class='Operator'>&& </span><a href="setrefs.c.html#LN2044"><span class='Ref_To_Local'>vinfo</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN33"><span class='Ref_to_Member'>varattno</span></a> <span class='Operator'>== </span><a href="setrefs.c.html#LN2043"><span class='Ref_To_Local'>varattno</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Found a match */ 
</span><a name="LN2054"></a>            <a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>newvar</span> <span class='Operator'>= </span><a href="setrefs.c.html#LN1332"><span class='Ref_to_Func'>copyVar</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2039"><span class='Ref_to_Parameter'>var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="setrefs.c.html#LN2054"><span class='Ref_To_Local'>newvar</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN165"><span class='Ref_to_Member'>varno</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN2040"><span class='Ref_to_Parameter'>newvarno</span></a><span class='Delimiter'>; 
</span>            <a href="setrefs.c.html#LN2054"><span class='Ref_To_Local'>newvar</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN167"><span class='Ref_to_Member'>varattno</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN2044"><span class='Ref_To_Local'>vinfo</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN34"><span class='Ref_to_Member'>resno</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN2054"><span class='Ref_To_Local'>newvar</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN175"><span class='Ref_to_Member'>varnoold</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="setrefs.c.html#LN2054"><span class='Ref_To_Local'>newvar</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN175"><span class='Ref_to_Member'>varnoold</span></a> <span class='Operator'>+= </span><a href="setrefs.c.html#LN2040"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <a href="setrefs.c.html#LN2054"><span class='Ref_To_Local'>newvar</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="setrefs.c.html#LN2044"><span class='Ref_To_Local'>vinfo</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>                <span class='Comment_Single_Line'>/* no match */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end search_indexed_tlist_for_var &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * search_indexed_tlist_for_non_var --- find a non-Var in an indexed tlist 
 * 
 * If a match is found, return a Var constructed to reference the tlist item. 
 * If no match, return NULL. 
 * 
 * NOTE: it is a waste of time to call this unless itlist-&GT;has_ph_vars or 
 * itlist-&GT;has_non_vars.  Furthermore, set_join_references() relies on being 
 * able to prevent matching of non-Vars by clearing itlist-&GT;has_non_vars, 
 * so there's a correctness reason not to call it unless that's set. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>* 
</span><a name="LN2079"></a><span class='Declare_Function'>search_indexed_tlist_for_non_var</span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, 
</span><a name="LN2080"></a>                                 <a href="setrefs.c.html#LN37"><span class='Ref_to_Typedef'>indexed_tlist</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>itlist</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>newvarno</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2082"></a>    <a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tle</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If it's a simple Const, replacing it with a Var is silly, even if there 
     * happens to be an identical Const below; a Var is more expensive to 
     * execute than a Const.  What's more, replacing it could confuse some 
     * places in the executor that expect to see simple Consts for, eg, 
     * dropped columns. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2079"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="setrefs.c.html#LN2082"><span class='Ref_To_Local'>tle</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/tlist.h.html#LN19"><span class='Ref_to_Proto'>tlist_member</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2079"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN2080"><span class='Ref_to_Parameter'>itlist</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN39"><span class='Ref_to_Member'>tlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN2082"><span class='Ref_To_Local'>tle</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Found a matching subplan output expression */ 
</span><a name="LN2098"></a>        <a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>newvar</span><span class='Delimiter'>; 
</span> 
        <a href="setrefs.c.html#LN2098"><span class='Ref_To_Local'>newvar</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/makefuncs.h.html#LN32"><span class='Ref_to_Proto'>makeVarFromTargetEntry</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2080"><span class='Ref_to_Parameter'>newvarno</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN2082"><span class='Ref_To_Local'>tle</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="setrefs.c.html#LN2098"><span class='Ref_To_Local'>newvar</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN175"><span class='Ref_to_Member'>varnoold</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* wasn't ever a plain Var */ 
</span>        <a href="setrefs.c.html#LN2098"><span class='Ref_To_Local'>newvar</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN176"><span class='Ref_to_Member'>varoattno</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="setrefs.c.html#LN2098"><span class='Ref_To_Local'>newvar</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>                <span class='Comment_Single_Line'>/* no match */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end search_indexed_tlist_for_non_var &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * search_indexed_tlist_for_sortgroupref --- find a sort/group expression 
 *      (which is assumed not to be just a Var) 
 * 
 * If a match is found, return a Var constructed to reference the tlist item. 
 * If no match, return NULL. 
 * 
 * This is needed to ensure that we select the right subplan TLE in cases 
 * where there are multiple textually-equal()-but-volatile sort expressions. 
 * And it's also faster than search_indexed_tlist_for_non_var. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>* 
</span><a name="LN2120"></a><span class='Declare_Function'>search_indexed_tlist_for_sortgroupref</span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, 
</span><a name="LN2121"></a>                                      <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>sortgroupref</span><span class='Delimiter'>, 
</span><a name="LN2122"></a>                                      <a href="setrefs.c.html#LN37"><span class='Ref_to_Typedef'>indexed_tlist</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>itlist</span><span class='Delimiter'>, 
</span><a name="LN2123"></a>                                      <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>newvarno</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2125"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2125"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN2122"><span class='Ref_to_Parameter'>itlist</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN39"><span class='Ref_to_Member'>tlist</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2129"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tle</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2125"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* The equal() check should be redundant, but let's be paranoid */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN2129"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1369"><span class='Ref_to_Member'>ressortgroupref</span></a> <span class='Operator'>== </span><a href="setrefs.c.html#LN2121"><span class='Ref_to_Parameter'>sortgroupref</span></a> <span class='Operator'>&& 
</span>            <a href="../../../include/nodes/nodes.h.html#LN626"><span class='Ref_to_Proto'>equal</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2120"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN2129"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Found a matching subplan output expression */ 
</span><a name="LN2136"></a>            <a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>newvar</span><span class='Delimiter'>; 
</span> 
            <a href="setrefs.c.html#LN2136"><span class='Ref_To_Local'>newvar</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/makefuncs.h.html#LN32"><span class='Ref_to_Proto'>makeVarFromTargetEntry</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2123"><span class='Ref_to_Parameter'>newvarno</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN2129"><span class='Ref_To_Local'>tle</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="setrefs.c.html#LN2136"><span class='Ref_To_Local'>newvar</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN175"><span class='Ref_to_Member'>varnoold</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* wasn't ever a plain Var */ 
</span>            <a href="setrefs.c.html#LN2136"><span class='Ref_To_Local'>newvar</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN176"><span class='Ref_to_Member'>varoattno</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <a href="setrefs.c.html#LN2136"><span class='Ref_To_Local'>newvar</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>                <span class='Comment_Single_Line'>/* no match */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end search_indexed_tlist_for_sortgroupref &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * fix_join_expr 
 *     Create a new set of targetlist entries or join qual clauses by 
 *     changing the varno/varattno values of variables in the clauses 
 *     to reference target list values from the outer and inner join 
 *     relation target lists.  Also perform opcode lookup and add 
 *     regclass OIDs to root-&GT;glob-&GT;relationOids. 
 * 
 * This is used in three different scenarios: 
 * 1) a normal join clause, where all the Vars in the clause *must* be 
 *    replaced by OUTER_VAR or INNER_VAR references.  In this case 
 *    acceptable_rel should be zero so that any failure to match a Var will be 
 *    reported as an error. 
 * 2) RETURNING clauses, which may contain both Vars of the target relation 
 *    and Vars of other relations. In this case we want to replace the 
 *    other-relation Vars by OUTER_VAR references, while leaving target Vars 
 *    alone. Thus inner_itlist = NULL and acceptable_rel = the ID of the 
 *    target relation should be passed. 
 * 3) ON CONFLICT UPDATE SET/WHERE clauses.  Here references to EXCLUDED are 
 *    to be replaced with INNER_VAR references, while leaving target Vars (the 
 *    to-be-updated relation) alone. Correspondingly inner_itlist is to be 
 *    EXCLUDED elements, outer_itlist = NULL and acceptable_rel the target 
 *    relation. 
 * 
 * 'clauses' is the targetlist or list of join clauses 
 * 'outer_itlist' is the indexed target list of the outer join relation, 
 *      or NULL 
 * 'inner_itlist' is the indexed target list of the inner join relation, 
 *      or NULL 
 * 'acceptable_rel' is either zero or the rangetable index of a relation 
 *      whose Vars may appear in the clause without provoking an error 
 * 'rtoffset': how much to increment varnoold by 
 * 
 * Returns the new expression tree.  The original clause structure is 
 * not modified. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN2184"></a><span class='Declare_Function'>fix_join_expr</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN2185"></a>              <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>clauses</span><span class='Delimiter'>, 
</span><a name="LN2186"></a>              <a href="setrefs.c.html#LN37"><span class='Ref_to_Typedef'>indexed_tlist</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>outer_itlist</span><span class='Delimiter'>, 
</span><a name="LN2187"></a>              <a href="setrefs.c.html#LN37"><span class='Ref_to_Typedef'>indexed_tlist</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>inner_itlist</span><span class='Delimiter'>, 
</span><a name="LN2188"></a>              <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>acceptable_rel</span><span class='Delimiter'>, 
</span><a name="LN2189"></a>              <span class='Keyword'>int </span><span class='Declare_Parameter'>rtoffset</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2191"></a>    <a href="setrefs.c.html#LN52"><span class='Ref_to_Typedef'>fix_join_expr_context</span></a> <span class='Declare_Local'>context</span><span class='Delimiter'>; 
</span> 
    <a href="setrefs.c.html#LN2191"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="setrefs.c.html#LN54"><span class='Ref_to_Member'>root</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN2184"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>; 
</span>    <a href="setrefs.c.html#LN2191"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="setrefs.c.html#LN55"><span class='Ref_to_Member'>outer_itlist</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN2186"><span class='Ref_to_Parameter'>outer_itlist</span></a><span class='Delimiter'>; 
</span>    <a href="setrefs.c.html#LN2191"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="setrefs.c.html#LN56"><span class='Ref_to_Member'>inner_itlist</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN2187"><span class='Ref_to_Parameter'>inner_itlist</span></a><span class='Delimiter'>; 
</span>    <a href="setrefs.c.html#LN2191"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="setrefs.c.html#LN57"><span class='Ref_to_Member'>acceptable_rel</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN2188"><span class='Ref_to_Parameter'>acceptable_rel</span></a><span class='Delimiter'>; 
</span>    <a href="setrefs.c.html#LN2191"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="setrefs.c.html#LN58"><span class='Ref_to_Member'>rtoffset</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN2189"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN125"><span class='Ref_to_Proto'>fix_join_expr_mutator</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN2185"><span class='Ref_to_Parameter'>clauses</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="setrefs.c.html#LN2191"><span class='Ref_To_Local'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>* 
</span><a name="LN2202"></a><span class='Declare_Function'>fix_join_expr_mutator</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><a href="setrefs.c.html#LN52"><span class='Ref_to_Typedef'>fix_join_expr_context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2204"></a>    <a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>newvar</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN2202"><span class='Ref_to_Parameter'>node</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2202"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2210"></a>        <a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>var</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN2202"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Look for the var in the input tlists, first in the outer */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN2202"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN55"><span class='Ref_to_Member'>outer_itlist</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="setrefs.c.html#LN2204"><span class='Ref_To_Local'>newvar</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN109"><span class='Ref_to_Proto'>search_indexed_tlist_for_var</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2210"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, 
</span>                                                  <a href="setrefs.c.html#LN2202"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN55"><span class='Ref_to_Member'>outer_itlist</span></a><span class='Delimiter'>, 
</span>                                                  <a href="../../../include/nodes/primnodes.h.html#LN153"><span class='Ref_to_Const'>OUTER_VAR</span></a><span class='Delimiter'>, 
</span>                                                  <a href="setrefs.c.html#LN2202"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN58"><span class='Ref_to_Member'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN2204"><span class='Ref_To_Local'>newvar</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN2204"><span class='Ref_To_Local'>newvar</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* then in the inner. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN2202"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN56"><span class='Ref_to_Member'>inner_itlist</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="setrefs.c.html#LN2204"><span class='Ref_To_Local'>newvar</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN109"><span class='Ref_to_Proto'>search_indexed_tlist_for_var</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2210"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, 
</span>                                                  <a href="setrefs.c.html#LN2202"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN56"><span class='Ref_to_Member'>inner_itlist</span></a><span class='Delimiter'>, 
</span>                                                  <a href="../../../include/nodes/primnodes.h.html#LN152"><span class='Ref_to_Const'>INNER_VAR</span></a><span class='Delimiter'>, 
</span>                                                  <a href="setrefs.c.html#LN2202"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN58"><span class='Ref_to_Member'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN2204"><span class='Ref_To_Local'>newvar</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN2204"><span class='Ref_To_Local'>newvar</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* If it's for acceptable_rel, adjust and return it */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN2210"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN165"><span class='Ref_to_Member'>varno</span></a> <span class='Operator'>== </span><a href="setrefs.c.html#LN2202"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN57"><span class='Ref_to_Member'>acceptable_rel</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="setrefs.c.html#LN2210"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN1332"><span class='Ref_to_Func'>copyVar</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2210"><span class='Ref_To_Local'>var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="setrefs.c.html#LN2210"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN165"><span class='Ref_to_Member'>varno</span></a> <span class='Operator'>+= </span><a href="setrefs.c.html#LN2202"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN58"><span class='Ref_to_Member'>rtoffset</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN2210"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN175"><span class='Ref_to_Member'>varnoold</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="setrefs.c.html#LN2210"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN175"><span class='Ref_to_Member'>varnoold</span></a> <span class='Operator'>+= </span><a href="setrefs.c.html#LN2202"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN58"><span class='Ref_to_Member'>rtoffset</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN2210"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* No referent found for Var */ 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"variable not found in subplan target lists"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IsA(node,Var) &raquo; </span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2202"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN1846"><span class='Ref_to_Struct'>PlaceHolderVar</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2249"></a>        <a href="../../../include/nodes/relation.h.html#LN1846"><span class='Ref_to_Struct'>PlaceHolderVar</span></a> <span class='Operator'>*</span><span class='Declare_Local'>phv</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1846"><span class='Ref_to_Struct'>PlaceHolderVar</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN2202"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* See if the PlaceHolderVar has bubbled up from a lower plan node */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN2202"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN55"><span class='Ref_to_Member'>outer_itlist</span></a> <span class='Operator'>&& </span><a href="setrefs.c.html#LN2202"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN55"><span class='Ref_to_Member'>outer_itlist</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN41"><span class='Ref_to_Member'>has_ph_vars</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="setrefs.c.html#LN2204"><span class='Ref_To_Local'>newvar</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN113"><span class='Ref_to_Proto'>search_indexed_tlist_for_non_var</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN2249"><span class='Ref_To_Local'>phv</span></a><span class='Delimiter'>, 
</span>                                                      <a href="setrefs.c.html#LN2202"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN55"><span class='Ref_to_Member'>outer_itlist</span></a><span class='Delimiter'>, 
</span>                                                      <a href="../../../include/nodes/primnodes.h.html#LN153"><span class='Ref_to_Const'>OUTER_VAR</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN2204"><span class='Ref_To_Local'>newvar</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN2204"><span class='Ref_To_Local'>newvar</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN2202"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN56"><span class='Ref_to_Member'>inner_itlist</span></a> <span class='Operator'>&& </span><a href="setrefs.c.html#LN2202"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN56"><span class='Ref_to_Member'>inner_itlist</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN41"><span class='Ref_to_Member'>has_ph_vars</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="setrefs.c.html#LN2204"><span class='Ref_To_Local'>newvar</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN113"><span class='Ref_to_Proto'>search_indexed_tlist_for_non_var</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN2249"><span class='Ref_To_Local'>phv</span></a><span class='Delimiter'>, 
</span>                                                      <a href="setrefs.c.html#LN2202"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN56"><span class='Ref_to_Member'>inner_itlist</span></a><span class='Delimiter'>, 
</span>                                                      <a href="../../../include/nodes/primnodes.h.html#LN152"><span class='Ref_to_Const'>INNER_VAR</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN2204"><span class='Ref_To_Local'>newvar</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN2204"><span class='Ref_To_Local'>newvar</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* If not supplied by input plans, evaluate the contained expr */ 
</span>        <span class='Control'>return</span> <a href="setrefs.c.html#LN125"><span class='Ref_to_Proto'>fix_join_expr_mutator</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN2249"><span class='Ref_To_Local'>phv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1849"><span class='Ref_to_Member'>phexpr</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN2202"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IsA(node,PlaceHolderV... &raquo; </span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2202"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN240"><span class='Ref_to_Struct'>Param</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="setrefs.c.html#LN1448"><span class='Ref_to_Func'>fix_param_node</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2202"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN54"><span class='Ref_to_Member'>root</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN240"><span class='Ref_to_Struct'>Param</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN2202"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Try matching more complex expressions too, if tlists have any */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN2202"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN55"><span class='Ref_to_Member'>outer_itlist</span></a> <span class='Operator'>&& </span><a href="setrefs.c.html#LN2202"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN55"><span class='Ref_to_Member'>outer_itlist</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN42"><span class='Ref_to_Member'>has_non_vars</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="setrefs.c.html#LN2204"><span class='Ref_To_Local'>newvar</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN113"><span class='Ref_to_Proto'>search_indexed_tlist_for_non_var</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN2202"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, 
</span>                                                  <a href="setrefs.c.html#LN2202"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN55"><span class='Ref_to_Member'>outer_itlist</span></a><span class='Delimiter'>, 
</span>                                                  <a href="../../../include/nodes/primnodes.h.html#LN153"><span class='Ref_to_Const'>OUTER_VAR</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN2204"><span class='Ref_To_Local'>newvar</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN2204"><span class='Ref_To_Local'>newvar</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN2202"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN56"><span class='Ref_to_Member'>inner_itlist</span></a> <span class='Operator'>&& </span><a href="setrefs.c.html#LN2202"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN56"><span class='Ref_to_Member'>inner_itlist</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN42"><span class='Ref_to_Member'>has_non_vars</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="setrefs.c.html#LN2204"><span class='Ref_To_Local'>newvar</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN113"><span class='Ref_to_Proto'>search_indexed_tlist_for_non_var</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN2202"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, 
</span>                                                  <a href="setrefs.c.html#LN2202"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN56"><span class='Ref_to_Member'>inner_itlist</span></a><span class='Delimiter'>, 
</span>                                                  <a href="../../../include/nodes/primnodes.h.html#LN152"><span class='Ref_to_Const'>INNER_VAR</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN2204"><span class='Ref_To_Local'>newvar</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN2204"><span class='Ref_To_Local'>newvar</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="setrefs.c.html#LN1354"><span class='Ref_to_Func'>fix_expr_common</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2202"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN54"><span class='Ref_to_Member'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN2202"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="../../../include/nodes/nodeFuncs.h.html#LN54"><span class='Ref_to_Proto'>expression_tree_mutator</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2202"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, 
</span>                                   <a href="setrefs.c.html#LN125"><span class='Ref_to_Proto'>fix_join_expr_mutator</span></a><span class='Delimiter'>, 
</span>                                   <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN2202"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end fix_join_expr_mutator &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * fix_upper_expr 
 *      Modifies an expression tree so that all Var nodes reference outputs 
 *      of a subplan.  Also looks for Aggref nodes that should be replaced 
 *      by initplan output Params.  Also performs opcode lookup, and adds 
 *      regclass OIDs to root-&GT;glob-&GT;relationOids. 
 * 
 * This is used to fix up target and qual expressions of non-join upper-level 
 * plan nodes, as well as index-only scan nodes. 
 * 
 * An error is raised if no matching var can be found in the subplan tlist 
 * --- so this routine should only be applied to nodes whose subplans' 
 * targetlists were generated by flattening the expressions used in the 
 * parent node. 
 * 
 * If itlist-&GT;has_non_vars is true, then we try to match whole subexpressions 
 * against elements of the subplan tlist, so that we can avoid recomputing 
 * expressions that were already computed by the subplan.  (This is relatively 
 * expensive, so we don't want to try it in the common case where the 
 * subplan tlist is just a flattened list of Vars.) 
 * 
 * 'node': the tree to be fixed (a target item or qual) 
 * 'subplan_itlist': indexed target list for subplan (or index) 
 * 'newvarno': varno to use for Vars referencing tlist elements 
 * 'rtoffset': how much to increment varnoold by 
 * 
 * The resulting tree is a copy of the original in which all Var nodes have 
 * varno = newvarno, varattno = resno of corresponding targetlist element. 
 * The original tree is not modified. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>* 
</span><a name="LN2328"></a><span class='Declare_Function'>fix_upper_expr</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN2329"></a>               <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, 
</span><a name="LN2330"></a>               <a href="setrefs.c.html#LN37"><span class='Ref_to_Typedef'>indexed_tlist</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>subplan_itlist</span><span class='Delimiter'>, 
</span><a name="LN2331"></a>               <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>newvarno</span><span class='Delimiter'>, 
</span><a name="LN2332"></a>               <span class='Keyword'>int </span><span class='Declare_Parameter'>rtoffset</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2334"></a>    <a href="setrefs.c.html#LN61"><span class='Ref_to_Typedef'>fix_upper_expr_context</span></a> <span class='Declare_Local'>context</span><span class='Delimiter'>; 
</span> 
    <a href="setrefs.c.html#LN2334"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="setrefs.c.html#LN63"><span class='Ref_to_Member'>root</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN2328"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>; 
</span>    <a href="setrefs.c.html#LN2334"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="setrefs.c.html#LN64"><span class='Ref_to_Member'>subplan_itlist</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN2330"><span class='Ref_to_Parameter'>subplan_itlist</span></a><span class='Delimiter'>; 
</span>    <a href="setrefs.c.html#LN2334"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="setrefs.c.html#LN65"><span class='Ref_to_Member'>newvarno</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN2331"><span class='Ref_to_Parameter'>newvarno</span></a><span class='Delimiter'>; 
</span>    <a href="setrefs.c.html#LN2334"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="setrefs.c.html#LN66"><span class='Ref_to_Member'>rtoffset</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN2332"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="setrefs.c.html#LN132"><span class='Ref_to_Proto'>fix_upper_expr_mutator</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2329"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="setrefs.c.html#LN2334"><span class='Ref_To_Local'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>* 
</span><a name="LN2344"></a><span class='Declare_Function'>fix_upper_expr_mutator</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><a href="setrefs.c.html#LN61"><span class='Ref_to_Typedef'>fix_upper_expr_context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2346"></a>    <a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>newvar</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN2344"><span class='Ref_to_Parameter'>node</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2344"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2352"></a>        <a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>var</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN2344"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
        <a href="setrefs.c.html#LN2346"><span class='Ref_To_Local'>newvar</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN109"><span class='Ref_to_Proto'>search_indexed_tlist_for_var</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2352"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, 
</span>                                              <a href="setrefs.c.html#LN2344"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN64"><span class='Ref_to_Member'>subplan_itlist</span></a><span class='Delimiter'>, 
</span>                                              <a href="setrefs.c.html#LN2344"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN65"><span class='Ref_to_Member'>newvarno</span></a><span class='Delimiter'>, 
</span>                                              <a href="setrefs.c.html#LN2344"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN66"><span class='Ref_to_Member'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="setrefs.c.html#LN2346"><span class='Ref_To_Local'>newvar</span></a><span class='Parentheses'>) 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"variable not found in subplan target list"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN2346"><span class='Ref_To_Local'>newvar</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2344"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN1846"><span class='Ref_to_Struct'>PlaceHolderVar</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2364"></a>        <a href="../../../include/nodes/relation.h.html#LN1846"><span class='Ref_to_Struct'>PlaceHolderVar</span></a> <span class='Operator'>*</span><span class='Declare_Local'>phv</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1846"><span class='Ref_to_Struct'>PlaceHolderVar</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN2344"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* See if the PlaceHolderVar has bubbled up from a lower plan node */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN2344"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN64"><span class='Ref_to_Member'>subplan_itlist</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN41"><span class='Ref_to_Member'>has_ph_vars</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="setrefs.c.html#LN2346"><span class='Ref_To_Local'>newvar</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN113"><span class='Ref_to_Proto'>search_indexed_tlist_for_non_var</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN2364"><span class='Ref_To_Local'>phv</span></a><span class='Delimiter'>, 
</span>                                                      <a href="setrefs.c.html#LN2344"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN64"><span class='Ref_to_Member'>subplan_itlist</span></a><span class='Delimiter'>, 
</span>                                                      <a href="setrefs.c.html#LN2344"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN65"><span class='Ref_to_Member'>newvarno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN2346"><span class='Ref_To_Local'>newvar</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN2346"><span class='Ref_To_Local'>newvar</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* If not supplied by input plan, evaluate the contained expr */ 
</span>        <span class='Control'>return</span> <a href="setrefs.c.html#LN132"><span class='Ref_to_Proto'>fix_upper_expr_mutator</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN2364"><span class='Ref_To_Local'>phv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1849"><span class='Ref_to_Member'>phexpr</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN2344"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2344"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN240"><span class='Ref_to_Struct'>Param</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="setrefs.c.html#LN1448"><span class='Ref_to_Func'>fix_param_node</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2344"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN63"><span class='Ref_to_Member'>root</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN240"><span class='Ref_to_Struct'>Param</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN2344"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2344"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN290"><span class='Ref_to_Struct'>Aggref</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2382"></a>        <a href="../../../include/nodes/primnodes.h.html#LN290"><span class='Ref_to_Struct'>Aggref</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>aggref</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN290"><span class='Ref_to_Struct'>Aggref</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN2344"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* See if the Aggref should be replaced by a Param */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN2344"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN63"><span class='Ref_to_Member'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN284"><span class='Ref_to_Member'>minmax_aggs</span></a> <span class='Operator'>!= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a> <span class='Operator'>&& 
</span>            <a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2382"><span class='Ref_To_Local'>aggref</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN300"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><a name="LN2388"></a>            <a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>curTarget</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2382"><span class='Ref_To_Local'>aggref</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN300"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2389"></a>            <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
            <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2389"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN2344"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN63"><span class='Ref_to_Member'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN284"><span class='Ref_to_Member'>minmax_aggs</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2393"></a>                <a href="../../../include/nodes/relation.h.html#LN2074"><span class='Ref_to_Struct'>MinMaxAggInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>mminfo</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN2074"><span class='Ref_to_Struct'>MinMaxAggInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2389"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN2393"><span class='Ref_To_Local'>mminfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN2078"><span class='Ref_to_Member'>aggfnoid</span></a> <span class='Operator'>== </span><a href="setrefs.c.html#LN2382"><span class='Ref_To_Local'>aggref</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN293"><span class='Ref_to_Member'>aggfnoid</span></a> <span class='Operator'>&& 
</span>                    <a href="../../../include/nodes/nodes.h.html#LN626"><span class='Ref_to_Proto'>equal</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2393"><span class='Ref_To_Local'>mminfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN2080"><span class='Ref_to_Member'>target</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN2388"><span class='Ref_To_Local'>curTarget</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2393"><span class='Ref_To_Local'>mminfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN2084"><span class='Ref_to_Member'>param</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* If no match, just fall through to process it normally */ 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IsA(node,Aggref) &raquo; </span> 
    <span class='Comment_Multi_Line'>/* Try matching more complex expressions too, if tlist has any */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN2344"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN64"><span class='Ref_to_Member'>subplan_itlist</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN42"><span class='Ref_to_Member'>has_non_vars</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="setrefs.c.html#LN2346"><span class='Ref_To_Local'>newvar</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN113"><span class='Ref_to_Proto'>search_indexed_tlist_for_non_var</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN2344"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, 
</span>                                                  <a href="setrefs.c.html#LN2344"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN64"><span class='Ref_to_Member'>subplan_itlist</span></a><span class='Delimiter'>, 
</span>                                                  <a href="setrefs.c.html#LN2344"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN65"><span class='Ref_to_Member'>newvarno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN2346"><span class='Ref_To_Local'>newvar</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN2346"><span class='Ref_To_Local'>newvar</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="setrefs.c.html#LN1354"><span class='Ref_to_Func'>fix_expr_common</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2344"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="setrefs.c.html#LN63"><span class='Ref_to_Member'>root</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN2344"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="../../../include/nodes/nodeFuncs.h.html#LN54"><span class='Ref_to_Proto'>expression_tree_mutator</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2344"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, 
</span>                                   <a href="setrefs.c.html#LN132"><span class='Ref_to_Proto'>fix_upper_expr_mutator</span></a><span class='Delimiter'>, 
</span>                                   <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN2344"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end fix_upper_expr_mutator &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * set_returning_clause_references 
 *      Perform setrefs.c's work on a RETURNING targetlist 
 * 
 * If the query involves more than just the result table, we have to 
 * adjust any Vars that refer to other tables to reference junk tlist 
 * entries in the top subplan's targetlist.  Vars referencing the result 
 * table should be left alone, however (the executor will evaluate them 
 * using the actual heap tuple, after firing triggers if any).  In the 
 * adjusted RETURNING list, result-table Vars will have their original 
 * varno (plus rtoffset), but Vars for other rels will have varno OUTER_VAR. 
 * 
 * We also must perform opcode lookup and add regclass OIDs to 
 * root-&GT;glob-&GT;relationOids. 
 * 
 * 'rlist': the RETURNING targetlist to be fixed 
 * 'topplan': the top subplan node that will be just below the ModifyTable 
 *      node (note it's not yet passed through set_plan_refs) 
 * 'resultRelation': RT index of the associated result relation 
 * 'rtoffset': how much to increment varnos by 
 * 
 * Note: the given 'root' is for the parent query level, not the 'topplan'. 
 * This does not matter currently since we only access the dependency-item 
 * lists in root-&GT;glob, but it would need some hacking if we wanted a root 
 * that actually matches the subplan. 
 * 
 * Note: resultRelation is not yet adjusted by rtoffset. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN2446"></a><span class='Declare_Function'>set_returning_clause_references</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN2447"></a>                                <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rlist</span><span class='Delimiter'>, 
</span><a name="LN2448"></a>                                <a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>topplan</span><span class='Delimiter'>, 
</span><a name="LN2449"></a>                                <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>resultRelation</span><span class='Delimiter'>, 
</span><a name="LN2450"></a>                                <span class='Keyword'>int </span><span class='Declare_Parameter'>rtoffset</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2452"></a>    <a href="setrefs.c.html#LN37"><span class='Ref_to_Typedef'>indexed_tlist</span></a> <span class='Operator'>*</span><span class='Declare_Local'>itlist</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We can perform the desired Var fixup by abusing the fix_join_expr 
     * machinery that formerly handled inner indexscan fixup.  We search the 
     * top plan's targetlist for Vars of non-result relations, and use 
     * fix_join_expr to convert RETURNING Vars into references to those tlist 
     * entries, while leaving result-rel Vars as-is. 
     * 
     * PlaceHolderVars will also be sought in the targetlist, but no 
     * more-complex expressions will be.  Note that it is not possible for a 
     * PlaceHolderVar to refer to the result relation, since the result is 
     * never below an outer join.  If that case could happen, we'd have to be 
     * prepared to pick apart the PlaceHolderVar and evaluate its contained 
     * expression instead. 
     */ 
</span>    <a href="setrefs.c.html#LN2452"><span class='Ref_To_Local'>itlist</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN1987"><span class='Ref_to_Func'>build_tlist_index_other_vars</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2448"><span class='Ref_to_Parameter'>topplan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN2449"><span class='Ref_to_Parameter'>resultRelation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="setrefs.c.html#LN2447"><span class='Ref_to_Parameter'>rlist</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN120"><span class='Ref_to_Proto'>fix_join_expr</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2446"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                          <a href="setrefs.c.html#LN2447"><span class='Ref_to_Parameter'>rlist</span></a><span class='Delimiter'>, 
</span>                          <a href="setrefs.c.html#LN2452"><span class='Ref_To_Local'>itlist</span></a><span class='Delimiter'>, 
</span>                          <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                          <a href="setrefs.c.html#LN2449"><span class='Ref_to_Parameter'>resultRelation</span></a><span class='Delimiter'>, 
</span>                          <a href="setrefs.c.html#LN2450"><span class='Ref_to_Parameter'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2452"><span class='Ref_To_Local'>itlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="setrefs.c.html#LN2447"><span class='Ref_to_Parameter'>rlist</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end set_returning_clause_references &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/***************************************************************************** 
 *                  QUERY DEPENDENCY MANAGEMENT 
 *****************************************************************************/ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * record_plan_function_dependency 
 *      Mark the current plan as depending on a particular function. 
 * 
 * This is exported so that the function-inlining code can record a 
 * dependency on a function that it's removed from the plan tree. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN2495"></a><span class='Declare_Function'>record_plan_function_dependency</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>funcid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * For performance reasons, we don't bother to track built-in functions; 
     * we just assume they'll never change (or at least not in ways that'd 
     * invalidate plans using them).  For this purpose we can consider a 
     * built-in function to be one with OID less than FirstBootstrapObjectId. 
     * Note that the OID generator guarantees never to generate such an OID 
     * after startup, even at OID wraparound. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN2495"><span class='Ref_to_Parameter'>funcid</span></a> <span class='Operator'>&GT;= </span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>) </span><a href="../../../include/access/transam.h.html#LN92"><span class='Ref_to_Const'>FirstBootstrapObjectId</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2507"></a>        <a href="../../../include/nodes/plannodes.h.html#LN1025"><span class='Ref_to_Struct'>PlanInvalItem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>inval_item</span> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN1025"><span class='Ref_to_Struct'>PlanInvalItem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * It would work to use any syscache on pg_proc, but the easiest is 
         * PROCOID since we already have the function's OID at hand.  Note 
         * that plancache.c knows we use PROCOID. 
         */ 
</span>        <a href="setrefs.c.html#LN2507"><span class='Ref_To_Local'>inval_item</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN1028"><span class='Ref_to_Member'>cacheId</span></a> <span class='Operator'>= </span><a href="../../../include/utils/syscache.h.html#LN76"><span class='Ref_to_EnumConst'>PROCOID</span></a><span class='Delimiter'>; 
</span>        <a href="setrefs.c.html#LN2507"><span class='Ref_To_Local'>inval_item</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN1029"><span class='Ref_to_Member'>hashValue</span></a> <span class='Operator'>= </span><a href="../../../include/utils/syscache.h.html#LN191"><span class='Ref_to_Macro'>GetSysCacheHashValue1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN76"><span class='Ref_to_EnumConst'>PROCOID</span></a><span class='Delimiter'>, 
</span>                                                   <a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2495"><span class='Ref_to_Parameter'>funcid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="setrefs.c.html#LN2495"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN114"><span class='Ref_to_Member'>invalItems</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2495"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN114"><span class='Ref_to_Member'>invalItems</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN2507"><span class='Ref_To_Local'>inval_item</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end record_plan_function_dependency &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * extract_query_dependencies 
 *      Given a rewritten, but not yet planned, query or queries 
 *      (i.e. a Query node or list of Query nodes), extract dependencies 
 *      just as set_plan_references would do.  Also detect whether any 
 *      rewrite steps were affected by RLS. 
 * 
 * This is needed by plancache.c to handle invalidation of cached unplanned 
 * queries. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN2533"></a><span class='Declare_Function'>extract_query_dependencies</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>query</span><span class='Delimiter'>, 
</span><a name="LN2534"></a>                           <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>relationOids</span><span class='Delimiter'>, 
</span><a name="LN2535"></a>                           <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>invalItems</span><span class='Delimiter'>, 
</span><a name="LN2536"></a>                           <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>hasRowSecurity</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2538"></a>    <a href="../../../include/nodes/relation.h.html#LN91"><span class='Ref_to_Struct'>PlannerGlobal</span></a> <span class='Declare_Local'>glob</span><span class='Delimiter'>; 
</span><a name="LN2539"></a>    <a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Declare_Local'>root</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Make up dummy planner state so we can use this module's machinery */ 
</span>    <a href="../../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="setrefs.c.html#LN2538"><span class='Ref_To_Local'>glob</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2538"><span class='Ref_To_Local'>glob</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="setrefs.c.html#LN2538"><span class='Ref_To_Local'>glob</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN93"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN215"><span class='Ref_to_EnumConst'>T_PlannerGlobal</span></a><span class='Delimiter'>; 
</span>    <a href="setrefs.c.html#LN2538"><span class='Ref_To_Local'>glob</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN112"><span class='Ref_to_Member'>relationOids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="setrefs.c.html#LN2538"><span class='Ref_To_Local'>glob</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN114"><span class='Ref_to_Member'>invalItems</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Hack: we use glob.dependsOnRole to collect hasRowSecurity flags */ 
</span>    <a href="setrefs.c.html#LN2538"><span class='Ref_To_Local'>glob</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN126"><span class='Ref_to_Member'>dependsOnRole</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="setrefs.c.html#LN2539"><span class='Ref_To_Local'>root</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2539"><span class='Ref_To_Local'>root</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="setrefs.c.html#LN2539"><span class='Ref_To_Local'>root</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN152"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN214"><span class='Ref_to_EnumConst'>T_PlannerInfo</span></a><span class='Delimiter'>; 
</span>    <a href="setrefs.c.html#LN2539"><span class='Ref_To_Local'>root</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a> <span class='Operator'>= &</span><a href="setrefs.c.html#LN2538"><span class='Ref_To_Local'>glob</span></a><span class='Delimiter'>; 
</span> 
    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN139"><span class='Ref_to_Proto'>extract_query_dependencies_walker</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2533"><span class='Ref_to_Parameter'>query</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="setrefs.c.html#LN2539"><span class='Ref_To_Local'>root</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="setrefs.c.html#LN2534"><span class='Ref_to_Parameter'>relationOids</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN2538"><span class='Ref_To_Local'>glob</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN112"><span class='Ref_to_Member'>relationOids</span></a><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="setrefs.c.html#LN2535"><span class='Ref_to_Parameter'>invalItems</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN2538"><span class='Ref_To_Local'>glob</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN114"><span class='Ref_to_Member'>invalItems</span></a><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="setrefs.c.html#LN2536"><span class='Ref_to_Parameter'>hasRowSecurity</span></a> <span class='Operator'>= </span><a href="setrefs.c.html#LN2538"><span class='Ref_To_Local'>glob</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN126"><span class='Ref_to_Member'>dependsOnRole</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end extract_query_dependencies &raquo; </span> 
 
<span class='Keyword'>static bool 
</span><a name="LN2561"></a><span class='Declare_Function'>extract_query_dependencies_walker</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN2561"><span class='Ref_to_Parameter'>node</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2561"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN1846"><span class='Ref_to_Struct'>PlaceHolderVar</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Extract function dependencies and check for regclass Consts */ 
</span>    <a href="setrefs.c.html#LN1354"><span class='Ref_to_Func'>fix_expr_common</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2561"><span class='Ref_to_Parameter'>context</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN2561"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2561"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2570"></a>        <a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>query</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN2561"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span><a name="LN2571"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN2570"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN109"><span class='Ref_to_Member'>commandType</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/nodes.h.html#LN654"><span class='Ref_to_EnumConst'>CMD_UTILITY</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Ignore utility statements, except those (such as EXPLAIN) that 
             * contain a parsed-but-not-planned query. 
             */ 
</span>            <a href="setrefs.c.html#LN2570"><span class='Ref_To_Local'>query</span></a> <span class='Operator'>= </span><a href="../../../include/tcop/utility.h.html#LN46"><span class='Ref_to_Proto'>UtilityContainsQuery</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2570"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN117"><span class='Ref_to_Member'>utilityStmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN2570"><span class='Ref_To_Local'>query</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Remember if any Query has RLS quals applied by rewriter */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN2570"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN130"><span class='Ref_to_Member'>hasRowSecurity</span></a><span class='Parentheses'>) 
</span>            <a href="setrefs.c.html#LN2561"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN126"><span class='Ref_to_Member'>dependsOnRole</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Collect relation OIDs in this Query's rtable */ 
</span>        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2571"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN2570"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN134"><span class='Ref_to_Member'>rtable</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2591"></a>            <a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rte</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2571"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN2591"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN936"><span class='Ref_to_Member'>rtekind</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/parsenodes.h.html#LN922"><span class='Ref_to_EnumConst'>RTE_RELATION</span></a><span class='Parentheses'>) 
</span>                <a href="setrefs.c.html#LN2561"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN112"><span class='Ref_to_Member'>relationOids</span></a> <span class='Operator'>= 
</span>                    <a href="../../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2561"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN112"><span class='Ref_to_Member'>relationOids</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN2591"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN947"><span class='Ref_to_Member'>relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="setrefs.c.html#LN2591"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN936"><span class='Ref_to_Member'>rtekind</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/parsenodes.h.html#LN929"><span class='Ref_to_EnumConst'>RTE_NAMEDTUPLESTORE</span></a> <span class='Operator'>&& 
</span>                     <a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2591"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN947"><span class='Ref_to_Member'>relid</span></a><span class='Parentheses'>))</span> 
                <a href="setrefs.c.html#LN2561"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN112"><span class='Ref_to_Member'>relationOids</span></a> <span class='Operator'>= 
</span>                    <a href="../../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2561"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN112"><span class='Ref_to_Member'>relationOids</span></a><span class='Delimiter'>, 
</span>                                <a href="setrefs.c.html#LN2591"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN947"><span class='Ref_to_Member'>relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* And recurse into the query's subexpressions */ 
</span>        <span class='Control'>return</span> <a href="../../../include/nodes/nodeFuncs.h.html#LN57"><span class='Ref_to_Proto'>query_tree_walker</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2570"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN139"><span class='Ref_to_Proto'>extract_query_dependencies_walker</span></a><span class='Delimiter'>, 
</span>                                 <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN2561"><span class='Ref_to_Parameter'>context</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IsA(node,Query) &raquo; </span> 
    <span class='Control'>return</span> <a href="../../../include/nodes/nodeFuncs.h.html#LN52"><span class='Ref_to_Proto'>expression_tree_walker</span></a><span class='Parentheses'>(</span><a href="setrefs.c.html#LN2561"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="setrefs.c.html#LN139"><span class='Ref_to_Proto'>extract_query_dependencies_walker</span></a><span class='Delimiter'>, 
</span>                                  <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="setrefs.c.html#LN2561"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end extract_query_dependencies_walker &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>