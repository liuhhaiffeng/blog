<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\optimizer\plan\subselect.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\optimizer\plan\subselect.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:42 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * subselect.c 
 *    Planning routines for subselects and parameters. 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * IDENTIFICATION 
 *    src/backend/optimizer/plan/subselect.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_operator.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"executor/executor.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"nodes/makefuncs.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"nodes/nodeFuncs.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/clauses.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/cost.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/pathnode.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/planmain.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/planner.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/prep.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/subselect.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/var.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parse_relation.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"rewrite/rewriteManip.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/syscache.h"</span> 
 
 
<a name="LN37"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>convert_testexpr_context</span> 
<span class='Delimiter'>{ 
</span><a name="LN39"></a>    <a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Member'>root</span><span class='Delimiter'>; 
</span><a name="LN40"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>subst_nodes</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* Nodes to substitute for Params */ 
</span><a name="LN41"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>convert_testexpr_context</span><span class='Delimiter'>; 
</span> 
<a name="LN43"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>process_sublinks_context</span> 
<span class='Delimiter'>{ 
</span><a name="LN45"></a>    <a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Member'>root</span><span class='Delimiter'>; 
</span><a name="LN46"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>isTopQual</span><span class='Delimiter'>; 
</span><a name="LN47"></a>} <span class='Declare_Typedef'>process_sublinks_context</span><span class='Delimiter'>; 
</span> 
<a name="LN49"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>finalize_primnode_context</span> 
<span class='Delimiter'>{ 
</span><a name="LN51"></a>    <a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Member'>root</span><span class='Delimiter'>; 
</span><a name="LN52"></a>    <a href="../../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a>  <span class='Operator'>*</span><span class='Declare_Member'>paramids</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* Non-local PARAM_EXEC paramids found */ 
</span><a name="LN53"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>finalize_primnode_context</span><span class='Delimiter'>; 
</span> 
 
<a name="LN56"></a><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>build_subplan</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>plan</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>subroot</span><span class='Delimiter'>, 
</span><a name="LN57"></a>              <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>plan_params</span><span class='Delimiter'>, 
</span><a name="LN58"></a>              <a href="../../../include/nodes/primnodes.h.html#LN616"><span class='Ref_to_Enum'>SubLinkType</span></a> <span class='Declare_Parameter'>subLinkType</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>subLinkId</span><span class='Delimiter'>, 
</span><a name="LN59"></a>              <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>testexpr</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>adjust_testexpr</span><span class='Delimiter'>, 
</span><a name="LN60"></a>              <span class='Keyword'>bool </span><span class='Declare_Parameter'>unknownEqFalse</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN61"></a><span class='Keyword'>static </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>generate_subquery_params</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tlist</span><span class='Delimiter'>, 
</span><a name="LN62"></a>                         <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>paramIds</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN63"></a><span class='Keyword'>static </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>generate_subquery_vars</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tlist</span><span class='Delimiter'>, 
</span><a name="LN64"></a>                       <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>varno</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN65"></a><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>convert_testexpr</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN66"></a>                 <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>testexpr</span><span class='Delimiter'>, 
</span><a name="LN67"></a>                 <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>subst_nodes</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN68"></a><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>convert_testexpr_mutator</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, 
</span><a name="LN69"></a>                         <a href="subselect.c.html#LN37"><span class='Ref_to_Struct'>convert_testexpr_context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN70"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>subplan_is_hashable</span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>plan</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN71"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>testexpr_is_hashable</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>testexpr</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN72"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>hash_ok_operator</span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN491"><span class='Ref_to_Struct'>OpExpr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>expr</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN73"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>simplify_EXISTS_query</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>query</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN74"></a><span class='Keyword'>static </span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>convert_EXISTS_to_ANY</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>subselect</span><span class='Delimiter'>, 
</span><a name="LN75"></a>                      <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>testexpr</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>paramIds</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN76"></a><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>replace_correlation_vars_mutator</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN77"></a><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>process_sublinks_mutator</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, 
</span><a name="LN78"></a>                         <a href="subselect.c.html#LN43"><span class='Ref_to_Struct'>process_sublinks_context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN79"></a><span class='Keyword'>static </span><a href="../../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>finalize_plan</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN80"></a>              <a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>plan</span><span class='Delimiter'>, 
</span><a name="LN81"></a>              <a href="../../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>valid_params</span><span class='Delimiter'>, 
</span><a name="LN82"></a>              <a href="../../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>scan_params</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN83"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>finalize_primnode</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><a href="subselect.c.html#LN49"><span class='Ref_to_Struct'>finalize_primnode_context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN84"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>finalize_agg_primnode</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><a href="subselect.c.html#LN49"><span class='Ref_to_Struct'>finalize_primnode_context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Select a PARAM_EXEC number to identify the given Var as a parameter for 
 * the current subquery, or for a nestloop's inner scan. 
 * If the Var already has a param in the current context, return that one. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN93"></a><span class='Declare_Function'>assign_param_for_var</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN95"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>ppl</span><span class='Delimiter'>; 
</span><a name="LN96"></a>    <a href="../../../include/nodes/relation.h.html#LN2134"><span class='Ref_to_Struct'>PlannerParamItem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pitem</span><span class='Delimiter'>; 
</span><a name="LN97"></a>    <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a>       <span class='Declare_Local'>levelsup</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Find the query level the Var belongs to */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN97"><span class='Ref_To_Local'>levelsup</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN93"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN172"><span class='Ref_to_Member'>varlevelsup</span></a><span class='Delimiter'>; </span><a href="subselect.c.html#LN97"><span class='Ref_To_Local'>levelsup</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="subselect.c.html#LN97"><span class='Ref_To_Local'>levelsup</span></a><span class='Operator'>--</span><span class='Parentheses'>) 
</span>        <a href="subselect.c.html#LN93"><span class='Ref_to_Parameter'>root</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN93"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN160"><span class='Ref_to_Member'>parent_root</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If there's already a matching PlannerParamItem there, just use it */ 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN95"><span class='Ref_To_Local'>ppl</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN93"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN168"><span class='Ref_to_Member'>plan_params</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="subselect.c.html#LN96"><span class='Ref_To_Local'>pitem</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN2134"><span class='Ref_to_Struct'>PlannerParamItem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN95"><span class='Ref_To_Local'>ppl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN96"><span class='Ref_To_Local'>pitem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN2138"><span class='Ref_to_Member'>item</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN109"></a>            <a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>pvar</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN96"><span class='Ref_To_Local'>pitem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN2138"><span class='Ref_to_Member'>item</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * This comparison must match _equalVar(), except for ignoring 
             * varlevelsup.  Note that _equalVar() ignores the location. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN109"><span class='Ref_To_Local'>pvar</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN165"><span class='Ref_to_Member'>varno</span></a> <span class='Operator'>== </span><a href="subselect.c.html#LN93"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN165"><span class='Ref_to_Member'>varno</span></a> <span class='Operator'>&& 
</span>                <a href="subselect.c.html#LN109"><span class='Ref_To_Local'>pvar</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN167"><span class='Ref_to_Member'>varattno</span></a> <span class='Operator'>== </span><a href="subselect.c.html#LN93"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN167"><span class='Ref_to_Member'>varattno</span></a> <span class='Operator'>&& 
</span>                <a href="subselect.c.html#LN109"><span class='Ref_To_Local'>pvar</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN169"><span class='Ref_to_Member'>vartype</span></a> <span class='Operator'>== </span><a href="subselect.c.html#LN93"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN169"><span class='Ref_to_Member'>vartype</span></a> <span class='Operator'>&& 
</span>                <a href="subselect.c.html#LN109"><span class='Ref_To_Local'>pvar</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN170"><span class='Ref_to_Member'>vartypmod</span></a> <span class='Operator'>== </span><a href="subselect.c.html#LN93"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN170"><span class='Ref_to_Member'>vartypmod</span></a> <span class='Operator'>&& 
</span>                <a href="subselect.c.html#LN109"><span class='Ref_To_Local'>pvar</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN171"><span class='Ref_to_Member'>varcollid</span></a> <span class='Operator'>== </span><a href="subselect.c.html#LN93"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN171"><span class='Ref_to_Member'>varcollid</span></a> <span class='Operator'>&& 
</span>                <a href="subselect.c.html#LN109"><span class='Ref_To_Local'>pvar</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN175"><span class='Ref_to_Member'>varnoold</span></a> <span class='Operator'>== </span><a href="subselect.c.html#LN93"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN175"><span class='Ref_to_Member'>varnoold</span></a> <span class='Operator'>&& 
</span>                <a href="subselect.c.html#LN109"><span class='Ref_To_Local'>pvar</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN176"><span class='Ref_to_Member'>varoattno</span></a> <span class='Operator'>== </span><a href="subselect.c.html#LN93"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN176"><span class='Ref_to_Member'>varoattno</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <a href="subselect.c.html#LN96"><span class='Ref_To_Local'>pitem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN2139"><span class='Ref_to_Member'>paramId</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Nope, so make a new one */ 
</span>    <a href="subselect.c.html#LN93"><span class='Ref_to_Parameter'>var</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN93"><span class='Ref_to_Parameter'>var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN93"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN172"><span class='Ref_to_Member'>varlevelsup</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="subselect.c.html#LN96"><span class='Ref_To_Local'>pitem</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN2134"><span class='Ref_to_Struct'>PlannerParamItem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN96"><span class='Ref_To_Local'>pitem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN2138"><span class='Ref_to_Member'>item</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN93"><span class='Ref_to_Parameter'>var</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN96"><span class='Ref_To_Local'>pitem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN2139"><span class='Ref_to_Member'>paramId</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN93"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN116"><span class='Ref_to_Member'>nParamExec</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <a href="subselect.c.html#LN93"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN168"><span class='Ref_to_Member'>plan_params</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN93"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN168"><span class='Ref_to_Member'>plan_params</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN96"><span class='Ref_To_Local'>pitem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="subselect.c.html#LN96"><span class='Ref_To_Local'>pitem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN2139"><span class='Ref_to_Member'>paramId</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end assign_param_for_var &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Generate a Param node to replace the given Var, 
 * which is expected to have varlevelsup &GT; 0 (ie, it is not local). 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/primnodes.h.html#LN240"><span class='Ref_to_Struct'>Param</span></a> <span class='Operator'>* 
</span><a name="LN144"></a><span class='Declare_Function'>replace_outer_var</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN146"></a>    <a href="../../../include/nodes/primnodes.h.html#LN240"><span class='Ref_to_Struct'>Param</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>retval</span><span class='Delimiter'>; 
</span><a name="LN147"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="subselect.c.html#LN144"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN172"><span class='Ref_to_Member'>varlevelsup</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="subselect.c.html#LN144"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN172"><span class='Ref_to_Member'>varlevelsup</span></a> <span class='Operator'>&LT; </span><a href="subselect.c.html#LN144"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN158"><span class='Ref_to_Member'>query_level</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Find the Var in the appropriate plan_params, or add it if not present */ 
</span>    <a href="subselect.c.html#LN147"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN92"><span class='Ref_to_Func'>assign_param_for_var</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN144"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN144"><span class='Ref_to_Parameter'>var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="subselect.c.html#LN146"><span class='Ref_To_Local'>retval</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN240"><span class='Ref_to_Struct'>Param</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN146"><span class='Ref_To_Local'>retval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN243"><span class='Ref_to_Member'>paramkind</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/primnodes.h.html#LN235"><span class='Ref_to_EnumConst'>PARAM_EXEC</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN146"><span class='Ref_To_Local'>retval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN244"><span class='Ref_to_Member'>paramid</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN147"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN146"><span class='Ref_To_Local'>retval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN245"><span class='Ref_to_Member'>paramtype</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN144"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN169"><span class='Ref_to_Member'>vartype</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN146"><span class='Ref_To_Local'>retval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN246"><span class='Ref_to_Member'>paramtypmod</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN144"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN170"><span class='Ref_to_Member'>vartypmod</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN146"><span class='Ref_To_Local'>retval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN247"><span class='Ref_to_Member'>paramcollid</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN144"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN171"><span class='Ref_to_Member'>varcollid</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN146"><span class='Ref_To_Local'>retval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN248"><span class='Ref_to_Member'>location</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN144"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN177"><span class='Ref_to_Member'>location</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="subselect.c.html#LN146"><span class='Ref_To_Local'>retval</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end replace_outer_var &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Generate a Param node to replace the given Var, which will be supplied 
 * from an upper NestLoop join node. 
 * 
 * This is effectively the same as replace_outer_var, except that we expect 
 * the Var to be local to the current query level. 
 */ 
</span><a href="../../../include/nodes/primnodes.h.html#LN240"><span class='Ref_to_Struct'>Param</span></a> <span class='Operator'>* 
</span><a name="LN173"></a><span class='Declare_Function'>assign_nestloop_param_var</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN175"></a>    <a href="../../../include/nodes/primnodes.h.html#LN240"><span class='Ref_to_Struct'>Param</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>retval</span><span class='Delimiter'>; 
</span><a name="LN176"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="subselect.c.html#LN173"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN172"><span class='Ref_to_Member'>varlevelsup</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="subselect.c.html#LN176"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN92"><span class='Ref_to_Func'>assign_param_for_var</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN173"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN173"><span class='Ref_to_Parameter'>var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="subselect.c.html#LN175"><span class='Ref_To_Local'>retval</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN240"><span class='Ref_to_Struct'>Param</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN175"><span class='Ref_To_Local'>retval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN243"><span class='Ref_to_Member'>paramkind</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/primnodes.h.html#LN235"><span class='Ref_to_EnumConst'>PARAM_EXEC</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN175"><span class='Ref_To_Local'>retval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN244"><span class='Ref_to_Member'>paramid</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN176"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN175"><span class='Ref_To_Local'>retval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN245"><span class='Ref_to_Member'>paramtype</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN173"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN169"><span class='Ref_to_Member'>vartype</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN175"><span class='Ref_To_Local'>retval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN246"><span class='Ref_to_Member'>paramtypmod</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN173"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN170"><span class='Ref_to_Member'>vartypmod</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN175"><span class='Ref_To_Local'>retval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN247"><span class='Ref_to_Member'>paramcollid</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN173"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN171"><span class='Ref_to_Member'>varcollid</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN175"><span class='Ref_To_Local'>retval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN248"><span class='Ref_to_Member'>location</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN173"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN177"><span class='Ref_to_Member'>location</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="subselect.c.html#LN175"><span class='Ref_To_Local'>retval</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end assign_nestloop_param_var &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Select a PARAM_EXEC number to identify the given PlaceHolderVar as a 
 * parameter for the current subquery, or for a nestloop's inner scan. 
 * If the PHV already has a param in the current context, return that one. 
 * 
 * This is just like assign_param_for_var, except for PlaceHolderVars. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN201"></a><span class='Declare_Function'>assign_param_for_placeholdervar</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN1846"><span class='Ref_to_Struct'>PlaceHolderVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>phv</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN203"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>ppl</span><span class='Delimiter'>; 
</span><a name="LN204"></a>    <a href="../../../include/nodes/relation.h.html#LN2134"><span class='Ref_to_Struct'>PlannerParamItem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pitem</span><span class='Delimiter'>; 
</span><a name="LN205"></a>    <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a>       <span class='Declare_Local'>levelsup</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Find the query level the PHV belongs to */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN205"><span class='Ref_To_Local'>levelsup</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN201"><span class='Ref_to_Parameter'>phv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1852"><span class='Ref_to_Member'>phlevelsup</span></a><span class='Delimiter'>; </span><a href="subselect.c.html#LN205"><span class='Ref_To_Local'>levelsup</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="subselect.c.html#LN205"><span class='Ref_To_Local'>levelsup</span></a><span class='Operator'>--</span><span class='Parentheses'>) 
</span>        <a href="subselect.c.html#LN201"><span class='Ref_to_Parameter'>root</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN201"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN160"><span class='Ref_to_Member'>parent_root</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If there's already a matching PlannerParamItem there, just use it */ 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN203"><span class='Ref_To_Local'>ppl</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN201"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN168"><span class='Ref_to_Member'>plan_params</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="subselect.c.html#LN204"><span class='Ref_To_Local'>pitem</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN2134"><span class='Ref_to_Struct'>PlannerParamItem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN203"><span class='Ref_To_Local'>ppl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN204"><span class='Ref_To_Local'>pitem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN2138"><span class='Ref_to_Member'>item</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN1846"><span class='Ref_to_Struct'>PlaceHolderVar</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN217"></a>            <a href="../../../include/nodes/relation.h.html#LN1846"><span class='Ref_to_Struct'>PlaceHolderVar</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pphv</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1846"><span class='Ref_to_Struct'>PlaceHolderVar</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN204"><span class='Ref_To_Local'>pitem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN2138"><span class='Ref_to_Member'>item</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* We assume comparing the PHIDs is sufficient */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN217"><span class='Ref_To_Local'>pphv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1851"><span class='Ref_to_Member'>phid</span></a> <span class='Operator'>== </span><a href="subselect.c.html#LN201"><span class='Ref_to_Parameter'>phv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1851"><span class='Ref_to_Member'>phid</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <a href="subselect.c.html#LN204"><span class='Ref_To_Local'>pitem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN2139"><span class='Ref_to_Member'>paramId</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Nope, so make a new one */ 
</span>    <a href="subselect.c.html#LN201"><span class='Ref_to_Parameter'>phv</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN201"><span class='Ref_to_Parameter'>phv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN201"><span class='Ref_to_Parameter'>phv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1852"><span class='Ref_to_Member'>phlevelsup</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/rewrite/rewriteManip.h.html#LN44"><span class='Ref_to_Proto'>IncrementVarSublevelsUp</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>)</span> <a href="subselect.c.html#LN201"><span class='Ref_to_Parameter'>phv</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Parentheses'>((</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN201"><span class='Ref_to_Parameter'>phv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1852"><span class='Ref_to_Member'>phlevelsup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="subselect.c.html#LN201"><span class='Ref_to_Parameter'>phv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1852"><span class='Ref_to_Member'>phlevelsup</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="subselect.c.html#LN204"><span class='Ref_To_Local'>pitem</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN2134"><span class='Ref_to_Struct'>PlannerParamItem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN204"><span class='Ref_To_Local'>pitem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN2138"><span class='Ref_to_Member'>item</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN201"><span class='Ref_to_Parameter'>phv</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN204"><span class='Ref_To_Local'>pitem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN2139"><span class='Ref_to_Member'>paramId</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN201"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN116"><span class='Ref_to_Member'>nParamExec</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <a href="subselect.c.html#LN201"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN168"><span class='Ref_to_Member'>plan_params</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN201"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN168"><span class='Ref_to_Member'>plan_params</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN204"><span class='Ref_To_Local'>pitem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="subselect.c.html#LN204"><span class='Ref_To_Local'>pitem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN2139"><span class='Ref_to_Member'>paramId</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end assign_param_for_placeholdervar &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Generate a Param node to replace the given PlaceHolderVar, 
 * which is expected to have phlevelsup &GT; 0 (ie, it is not local). 
 * 
 * This is just like replace_outer_var, except for PlaceHolderVars. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/primnodes.h.html#LN240"><span class='Ref_to_Struct'>Param</span></a> <span class='Operator'>* 
</span><a name="LN249"></a><span class='Declare_Function'>replace_outer_placeholdervar</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN1846"><span class='Ref_to_Struct'>PlaceHolderVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>phv</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN251"></a>    <a href="../../../include/nodes/primnodes.h.html#LN240"><span class='Ref_to_Struct'>Param</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>retval</span><span class='Delimiter'>; 
</span><a name="LN252"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="subselect.c.html#LN249"><span class='Ref_to_Parameter'>phv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1852"><span class='Ref_to_Member'>phlevelsup</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="subselect.c.html#LN249"><span class='Ref_to_Parameter'>phv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1852"><span class='Ref_to_Member'>phlevelsup</span></a> <span class='Operator'>&LT; </span><a href="subselect.c.html#LN249"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN158"><span class='Ref_to_Member'>query_level</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Find the PHV in the appropriate plan_params, or add it if not present */ 
</span>    <a href="subselect.c.html#LN252"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN200"><span class='Ref_to_Func'>assign_param_for_placeholdervar</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN249"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN249"><span class='Ref_to_Parameter'>phv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="subselect.c.html#LN251"><span class='Ref_To_Local'>retval</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN240"><span class='Ref_to_Struct'>Param</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN251"><span class='Ref_To_Local'>retval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN243"><span class='Ref_to_Member'>paramkind</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/primnodes.h.html#LN235"><span class='Ref_to_EnumConst'>PARAM_EXEC</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN251"><span class='Ref_To_Local'>retval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN244"><span class='Ref_to_Member'>paramid</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN252"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN251"><span class='Ref_To_Local'>retval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN245"><span class='Ref_to_Member'>paramtype</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodeFuncs.h.html#LN31"><span class='Ref_to_Proto'>exprType</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN249"><span class='Ref_to_Parameter'>phv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1849"><span class='Ref_to_Member'>phexpr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN251"><span class='Ref_To_Local'>retval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN246"><span class='Ref_to_Member'>paramtypmod</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodeFuncs.h.html#LN32"><span class='Ref_to_Proto'>exprTypmod</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN249"><span class='Ref_to_Parameter'>phv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1849"><span class='Ref_to_Member'>phexpr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN251"><span class='Ref_To_Local'>retval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN247"><span class='Ref_to_Member'>paramcollid</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodeFuncs.h.html#LN38"><span class='Ref_to_Proto'>exprCollation</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN249"><span class='Ref_to_Parameter'>phv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1849"><span class='Ref_to_Member'>phexpr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN251"><span class='Ref_To_Local'>retval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN248"><span class='Ref_to_Member'>location</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="subselect.c.html#LN251"><span class='Ref_To_Local'>retval</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end replace_outer_placeholdervar &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Generate a Param node to replace the given PlaceHolderVar, which will be 
 * supplied from an upper NestLoop join node. 
 * 
 * This is just like assign_nestloop_param_var, except for PlaceHolderVars. 
 */ 
</span><a href="../../../include/nodes/primnodes.h.html#LN240"><span class='Ref_to_Struct'>Param</span></a> <span class='Operator'>* 
</span><a name="LN277"></a><span class='Declare_Function'>assign_nestloop_param_placeholdervar</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN1846"><span class='Ref_to_Struct'>PlaceHolderVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>phv</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN279"></a>    <a href="../../../include/nodes/primnodes.h.html#LN240"><span class='Ref_to_Struct'>Param</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>retval</span><span class='Delimiter'>; 
</span><a name="LN280"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="subselect.c.html#LN277"><span class='Ref_to_Parameter'>phv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1852"><span class='Ref_to_Member'>phlevelsup</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="subselect.c.html#LN280"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN200"><span class='Ref_to_Func'>assign_param_for_placeholdervar</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN277"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN277"><span class='Ref_to_Parameter'>phv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="subselect.c.html#LN279"><span class='Ref_To_Local'>retval</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN240"><span class='Ref_to_Struct'>Param</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN279"><span class='Ref_To_Local'>retval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN243"><span class='Ref_to_Member'>paramkind</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/primnodes.h.html#LN235"><span class='Ref_to_EnumConst'>PARAM_EXEC</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN279"><span class='Ref_To_Local'>retval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN244"><span class='Ref_to_Member'>paramid</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN280"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN279"><span class='Ref_To_Local'>retval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN245"><span class='Ref_to_Member'>paramtype</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodeFuncs.h.html#LN31"><span class='Ref_to_Proto'>exprType</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN277"><span class='Ref_to_Parameter'>phv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1849"><span class='Ref_to_Member'>phexpr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN279"><span class='Ref_To_Local'>retval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN246"><span class='Ref_to_Member'>paramtypmod</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodeFuncs.h.html#LN32"><span class='Ref_to_Proto'>exprTypmod</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN277"><span class='Ref_to_Parameter'>phv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1849"><span class='Ref_to_Member'>phexpr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN279"><span class='Ref_To_Local'>retval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN247"><span class='Ref_to_Member'>paramcollid</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodeFuncs.h.html#LN38"><span class='Ref_to_Proto'>exprCollation</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN277"><span class='Ref_to_Parameter'>phv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1849"><span class='Ref_to_Member'>phexpr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN279"><span class='Ref_To_Local'>retval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN248"><span class='Ref_to_Member'>location</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="subselect.c.html#LN279"><span class='Ref_To_Local'>retval</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end assign_nestloop_param_placeholdervar &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Generate a Param node to replace the given Aggref 
 * which is expected to have agglevelsup &GT; 0 (ie, it is not local). 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/primnodes.h.html#LN240"><span class='Ref_to_Struct'>Param</span></a> <span class='Operator'>* 
</span><a name="LN302"></a><span class='Declare_Function'>replace_outer_agg</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN290"><span class='Ref_to_Struct'>Aggref</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>agg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN304"></a>    <a href="../../../include/nodes/primnodes.h.html#LN240"><span class='Ref_to_Struct'>Param</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>retval</span><span class='Delimiter'>; 
</span><a name="LN305"></a>    <a href="../../../include/nodes/relation.h.html#LN2134"><span class='Ref_to_Struct'>PlannerParamItem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pitem</span><span class='Delimiter'>; 
</span><a name="LN306"></a>    <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a>       <span class='Declare_Local'>levelsup</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="subselect.c.html#LN302"><span class='Ref_to_Parameter'>agg</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN308"><span class='Ref_to_Member'>agglevelsup</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="subselect.c.html#LN302"><span class='Ref_to_Parameter'>agg</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN308"><span class='Ref_to_Member'>agglevelsup</span></a> <span class='Operator'>&LT; </span><a href="subselect.c.html#LN302"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN158"><span class='Ref_to_Member'>query_level</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Find the query level the Aggref belongs to */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN306"><span class='Ref_To_Local'>levelsup</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN302"><span class='Ref_to_Parameter'>agg</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN308"><span class='Ref_to_Member'>agglevelsup</span></a><span class='Delimiter'>; </span><a href="subselect.c.html#LN306"><span class='Ref_To_Local'>levelsup</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="subselect.c.html#LN306"><span class='Ref_To_Local'>levelsup</span></a><span class='Operator'>--</span><span class='Parentheses'>) 
</span>        <a href="subselect.c.html#LN302"><span class='Ref_to_Parameter'>root</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN302"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN160"><span class='Ref_to_Member'>parent_root</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * It does not seem worthwhile to try to match duplicate outer aggs. Just 
     * make a new slot every time. 
     */ 
</span>    <a href="subselect.c.html#LN302"><span class='Ref_to_Parameter'>agg</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN302"><span class='Ref_to_Parameter'>agg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/rewrite/rewriteManip.h.html#LN44"><span class='Ref_to_Proto'>IncrementVarSublevelsUp</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>)</span> <a href="subselect.c.html#LN302"><span class='Ref_to_Parameter'>agg</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Parentheses'>((</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN302"><span class='Ref_to_Parameter'>agg</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN308"><span class='Ref_to_Member'>agglevelsup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="subselect.c.html#LN302"><span class='Ref_to_Parameter'>agg</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN308"><span class='Ref_to_Member'>agglevelsup</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="subselect.c.html#LN305"><span class='Ref_To_Local'>pitem</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN2134"><span class='Ref_to_Struct'>PlannerParamItem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN305"><span class='Ref_To_Local'>pitem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN2138"><span class='Ref_to_Member'>item</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN302"><span class='Ref_to_Parameter'>agg</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN305"><span class='Ref_To_Local'>pitem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN2139"><span class='Ref_to_Member'>paramId</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN302"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN116"><span class='Ref_to_Member'>nParamExec</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <a href="subselect.c.html#LN302"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN168"><span class='Ref_to_Member'>plan_params</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN302"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN168"><span class='Ref_to_Member'>plan_params</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN305"><span class='Ref_To_Local'>pitem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="subselect.c.html#LN304"><span class='Ref_To_Local'>retval</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN240"><span class='Ref_to_Struct'>Param</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN304"><span class='Ref_To_Local'>retval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN243"><span class='Ref_to_Member'>paramkind</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/primnodes.h.html#LN235"><span class='Ref_to_EnumConst'>PARAM_EXEC</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN304"><span class='Ref_To_Local'>retval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN244"><span class='Ref_to_Member'>paramid</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN305"><span class='Ref_To_Local'>pitem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN2139"><span class='Ref_to_Member'>paramId</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN304"><span class='Ref_To_Local'>retval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN245"><span class='Ref_to_Member'>paramtype</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN302"><span class='Ref_to_Parameter'>agg</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN294"><span class='Ref_to_Member'>aggtype</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN304"><span class='Ref_To_Local'>retval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN246"><span class='Ref_to_Member'>paramtypmod</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN304"><span class='Ref_To_Local'>retval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN247"><span class='Ref_to_Member'>paramcollid</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN302"><span class='Ref_to_Parameter'>agg</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN295"><span class='Ref_to_Member'>aggcollid</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN304"><span class='Ref_To_Local'>retval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN248"><span class='Ref_to_Member'>location</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN302"><span class='Ref_to_Parameter'>agg</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN310"><span class='Ref_to_Member'>location</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="subselect.c.html#LN304"><span class='Ref_To_Local'>retval</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end replace_outer_agg &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Generate a Param node to replace the given GroupingFunc expression which is 
 * expected to have agglevelsup &GT; 0 (ie, it is not local). 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/primnodes.h.html#LN240"><span class='Ref_to_Struct'>Param</span></a> <span class='Operator'>* 
</span><a name="LN344"></a><span class='Declare_Function'>replace_outer_grouping</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN337"><span class='Ref_to_Struct'>GroupingFunc</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>grp</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN346"></a>    <a href="../../../include/nodes/primnodes.h.html#LN240"><span class='Ref_to_Struct'>Param</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>retval</span><span class='Delimiter'>; 
</span><a name="LN347"></a>    <a href="../../../include/nodes/relation.h.html#LN2134"><span class='Ref_to_Struct'>PlannerParamItem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pitem</span><span class='Delimiter'>; 
</span><a name="LN348"></a>    <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a>       <span class='Declare_Local'>levelsup</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="subselect.c.html#LN344"><span class='Ref_to_Parameter'>grp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN344"><span class='Ref_to_Member'>agglevelsup</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="subselect.c.html#LN344"><span class='Ref_to_Parameter'>grp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN344"><span class='Ref_to_Member'>agglevelsup</span></a> <span class='Operator'>&LT; </span><a href="subselect.c.html#LN344"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN158"><span class='Ref_to_Member'>query_level</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Find the query level the GroupingFunc belongs to */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN348"><span class='Ref_To_Local'>levelsup</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN344"><span class='Ref_to_Parameter'>grp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN344"><span class='Ref_to_Member'>agglevelsup</span></a><span class='Delimiter'>; </span><a href="subselect.c.html#LN348"><span class='Ref_To_Local'>levelsup</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="subselect.c.html#LN348"><span class='Ref_To_Local'>levelsup</span></a><span class='Operator'>--</span><span class='Parentheses'>) 
</span>        <a href="subselect.c.html#LN344"><span class='Ref_to_Parameter'>root</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN344"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN160"><span class='Ref_to_Member'>parent_root</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * It does not seem worthwhile to try to match duplicate outer aggs. Just 
     * make a new slot every time. 
     */ 
</span>    <a href="subselect.c.html#LN344"><span class='Ref_to_Parameter'>grp</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN344"><span class='Ref_to_Parameter'>grp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/rewrite/rewriteManip.h.html#LN44"><span class='Ref_to_Proto'>IncrementVarSublevelsUp</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>)</span> <a href="subselect.c.html#LN344"><span class='Ref_to_Parameter'>grp</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Parentheses'>((</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN344"><span class='Ref_to_Parameter'>grp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN344"><span class='Ref_to_Member'>agglevelsup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="subselect.c.html#LN344"><span class='Ref_to_Parameter'>grp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN344"><span class='Ref_to_Member'>agglevelsup</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="subselect.c.html#LN347"><span class='Ref_To_Local'>pitem</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN2134"><span class='Ref_to_Struct'>PlannerParamItem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN347"><span class='Ref_To_Local'>pitem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN2138"><span class='Ref_to_Member'>item</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN344"><span class='Ref_to_Parameter'>grp</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN347"><span class='Ref_To_Local'>pitem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN2139"><span class='Ref_to_Member'>paramId</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN344"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN116"><span class='Ref_to_Member'>nParamExec</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <a href="subselect.c.html#LN344"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN168"><span class='Ref_to_Member'>plan_params</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN344"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN168"><span class='Ref_to_Member'>plan_params</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN347"><span class='Ref_To_Local'>pitem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="subselect.c.html#LN346"><span class='Ref_To_Local'>retval</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN240"><span class='Ref_to_Struct'>Param</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN346"><span class='Ref_To_Local'>retval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN243"><span class='Ref_to_Member'>paramkind</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/primnodes.h.html#LN235"><span class='Ref_to_EnumConst'>PARAM_EXEC</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN346"><span class='Ref_To_Local'>retval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN244"><span class='Ref_to_Member'>paramid</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN347"><span class='Ref_To_Local'>pitem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN2139"><span class='Ref_to_Member'>paramId</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN346"><span class='Ref_To_Local'>retval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN245"><span class='Ref_to_Member'>paramtype</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodeFuncs.h.html#LN31"><span class='Ref_to_Proto'>exprType</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN344"><span class='Ref_to_Parameter'>grp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN346"><span class='Ref_To_Local'>retval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN246"><span class='Ref_to_Member'>paramtypmod</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN346"><span class='Ref_To_Local'>retval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN247"><span class='Ref_to_Member'>paramcollid</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN346"><span class='Ref_To_Local'>retval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN248"><span class='Ref_to_Member'>location</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN344"><span class='Ref_to_Parameter'>grp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN345"><span class='Ref_to_Member'>location</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="subselect.c.html#LN346"><span class='Ref_To_Local'>retval</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end replace_outer_grouping &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Generate a new Param node that will not conflict with any other. 
 * 
 * This is used to create Params representing subplan outputs. 
 * We don't need to build a PlannerParamItem for such a Param, but we do 
 * need to record the PARAM_EXEC slot number as being allocated. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/primnodes.h.html#LN240"><span class='Ref_to_Struct'>Param</span></a> <span class='Operator'>* 
</span><a name="LN389"></a><span class='Declare_Function'>generate_new_param</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>paramtype</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>paramtypmod</span><span class='Delimiter'>, 
</span><a name="LN390"></a>                   <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>paramcollation</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN392"></a>    <a href="../../../include/nodes/primnodes.h.html#LN240"><span class='Ref_to_Struct'>Param</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>retval</span><span class='Delimiter'>; 
</span> 
    <a href="subselect.c.html#LN392"><span class='Ref_To_Local'>retval</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN240"><span class='Ref_to_Struct'>Param</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN392"><span class='Ref_To_Local'>retval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN243"><span class='Ref_to_Member'>paramkind</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/primnodes.h.html#LN235"><span class='Ref_to_EnumConst'>PARAM_EXEC</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN392"><span class='Ref_To_Local'>retval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN244"><span class='Ref_to_Member'>paramid</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN389"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN116"><span class='Ref_to_Member'>nParamExec</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN392"><span class='Ref_To_Local'>retval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN245"><span class='Ref_to_Member'>paramtype</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN389"><span class='Ref_to_Parameter'>paramtype</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN392"><span class='Ref_To_Local'>retval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN246"><span class='Ref_to_Member'>paramtypmod</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN389"><span class='Ref_to_Parameter'>paramtypmod</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN392"><span class='Ref_To_Local'>retval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN247"><span class='Ref_to_Member'>paramcollid</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN390"><span class='Ref_to_Parameter'>paramcollation</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN392"><span class='Ref_To_Local'>retval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN248"><span class='Ref_to_Member'>location</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="subselect.c.html#LN392"><span class='Ref_To_Local'>retval</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Assign a (nonnegative) PARAM_EXEC ID for a special parameter (one that 
 * is not actually used to carry a value at runtime).  Such parameters are 
 * used for special runtime signaling purposes, such as connecting a 
 * recursive union node to its worktable scan node or forcing plan 
 * re-evaluation within the EvalPlanQual mechanism.  No actual Param node 
 * exists with this ID, however. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN414"></a><span class='Declare_Function'>SS_assign_special_param</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="subselect.c.html#LN414"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN116"><span class='Ref_to_Member'>nParamExec</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Get the datatype/typmod/collation of the first column of the plan's output. 
 * 
 * This information is stored for ARRAY_SUBLINK execution and for 
 * exprType()/exprTypmod()/exprCollation(), which have no way to get at the 
 * plan associated with a SubPlan node.  We really only need the info for 
 * EXPR_SUBLINK and ARRAY_SUBLINK subplans, but for consistency we save it 
 * always. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN429"></a><span class='Declare_Function'>get_first_col_type</span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>plan</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>coltype</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>coltypmod</span><span class='Delimiter'>, 
</span><a name="LN430"></a>                   <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>colcollation</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* In cases such as EXISTS, tlist might be empty; arbitrarily use VOID */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN429"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN435"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tent</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN113"><span class='Ref_to_Macro'>linitial_node</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN429"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="subselect.c.html#LN435"><span class='Ref_To_Local'>tent</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1373"><span class='Ref_to_Member'>resjunk</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Operator'>*</span><a href="subselect.c.html#LN429"><span class='Ref_to_Parameter'>coltype</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodeFuncs.h.html#LN31"><span class='Ref_to_Proto'>exprType</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN435"><span class='Ref_To_Local'>tent</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="subselect.c.html#LN429"><span class='Ref_to_Parameter'>coltypmod</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodeFuncs.h.html#LN32"><span class='Ref_to_Proto'>exprTypmod</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN435"><span class='Ref_To_Local'>tent</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="subselect.c.html#LN430"><span class='Ref_to_Parameter'>colcollation</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodeFuncs.h.html#LN38"><span class='Ref_to_Proto'>exprCollation</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN435"><span class='Ref_To_Local'>tent</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Operator'>*</span><a href="subselect.c.html#LN429"><span class='Ref_to_Parameter'>coltype</span></a> <span class='Operator'>= </span><a href="../../../include/catalog/pg_type.h.html#LN689"><span class='Ref_to_Const'>VOIDOID</span></a><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="subselect.c.html#LN429"><span class='Ref_to_Parameter'>coltypmod</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="subselect.c.html#LN430"><span class='Ref_to_Parameter'>colcollation</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_first_col_type &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Convert a SubLink (as created by the parser) into a SubPlan. 
 * 
 * We are given the SubLink's contained query, type, ID, and testexpr.  We are 
 * also told if this expression appears at top level of a WHERE/HAVING qual. 
 * 
 * Note: we assume that the testexpr has been AND/OR flattened (actually, 
 * it's been through eval_const_expressions), but not converted to 
 * implicit-AND form; and any SubLinks in it should already have been 
 * converted to SubPlans.  The subquery is as yet untouched, however. 
 * 
 * The result is whatever we need to substitute in place of the SubLink node 
 * in the executable expression.  If we're going to do the subplan as a 
 * regular subplan, this will be the constructed SubPlan node.  If we're going 
 * to do the subplan as an InitPlan, the SubPlan node instead goes into 
 * root-&GT;init_plans, and what we return here is an expression tree 
 * representing the InitPlan's result: usually just a Param node representing 
 * a single scalar result, but possibly a row comparison tree containing 
 * multiple Param nodes, or for a MULTIEXPR subquery a simple NULL constant 
 * (since the real output Params are elsewhere in the tree, and the MULTIEXPR 
 * subquery itself is in a resjunk tlist entry whose value is uninteresting). 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>* 
</span><a name="LN473"></a><span class='Declare_Function'>make_subplan</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>orig_subquery</span><span class='Delimiter'>, 
</span><a name="LN474"></a>             <a href="../../../include/nodes/primnodes.h.html#LN616"><span class='Ref_to_Enum'>SubLinkType</span></a> <span class='Declare_Parameter'>subLinkType</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>subLinkId</span><span class='Delimiter'>, 
</span><a name="LN475"></a>             <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>testexpr</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isTopQual</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN477"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>subquery</span><span class='Delimiter'>; 
</span><a name="LN478"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>simple_exists</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN479"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>tuple_fraction</span><span class='Delimiter'>; 
</span><a name="LN480"></a>    <a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>subroot</span><span class='Delimiter'>; 
</span><a name="LN481"></a>    <a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>final_rel</span><span class='Delimiter'>; 
</span><a name="LN482"></a>    <a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>best_path</span><span class='Delimiter'>; 
</span><a name="LN483"></a>    <a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>plan</span><span class='Delimiter'>; 
</span><a name="LN484"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>plan_params</span><span class='Delimiter'>; 
</span><a name="LN485"></a>    <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Copy the source Query node.  This is a quick and dirty kluge to resolve 
     * the fact that the parser can generate trees with multiple links to the 
     * same sub-Query node, but the planner wants to scribble on the Query. 
     * Try to clean this up when we do querytree redesign... 
     */ 
</span>    <a href="subselect.c.html#LN477"><span class='Ref_To_Local'>subquery</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN473"><span class='Ref_to_Parameter'>orig_subquery</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If it's an EXISTS subplan, we might be able to simplify it. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN474"><span class='Ref_to_Parameter'>subLinkType</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/primnodes.h.html#LN618"><span class='Ref_to_EnumConst'>EXISTS_SUBLINK</span></a><span class='Parentheses'>) 
</span>        <a href="subselect.c.html#LN478"><span class='Ref_To_Local'>simple_exists</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN73"><span class='Ref_to_Proto'>simplify_EXISTS_query</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN473"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN477"><span class='Ref_To_Local'>subquery</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * For an EXISTS subplan, tell lower-level planner to expect that only the 
     * first tuple will be retrieved.  For ALL and ANY subplans, we will be 
     * able to stop evaluating if the test condition fails or matches, so very 
     * often not all the tuples will be retrieved; for lack of a better idea, 
     * specify 50% retrieval.  For EXPR, MULTIEXPR, and ROWCOMPARE subplans, 
     * use default behavior (we're only expecting one row out, anyway). 
     * 
     * NOTE: if you change these numbers, also change cost_subplan() in 
     * path/costsize.c. 
     * 
     * XXX If an ANY subplan is uncorrelated, build_subplan may decide to hash 
     * its output.  In that case it would've been better to specify full 
     * retrieval.  At present, however, we can only check hashability after 
     * we've made the subplan :-(.  (Determining whether it'll fit in work_mem 
     * is the really hard part.)  Therefore, we don't want to be too 
     * optimistic about the percentage of tuples retrieved, for fear of 
     * selecting a plan that's bad for the materialization case. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN474"><span class='Ref_to_Parameter'>subLinkType</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/primnodes.h.html#LN618"><span class='Ref_to_EnumConst'>EXISTS_SUBLINK</span></a><span class='Parentheses'>) 
</span>        <a href="subselect.c.html#LN479"><span class='Ref_To_Local'>tuple_fraction</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* just like a LIMIT 1 */ 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN474"><span class='Ref_to_Parameter'>subLinkType</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/primnodes.h.html#LN619"><span class='Ref_to_EnumConst'>ALL_SUBLINK</span></a> <span class='Operator'>|| 
</span>             <a href="subselect.c.html#LN474"><span class='Ref_to_Parameter'>subLinkType</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/primnodes.h.html#LN620"><span class='Ref_to_EnumConst'>ANY_SUBLINK</span></a><span class='Parentheses'>) 
</span>        <a href="subselect.c.html#LN479"><span class='Ref_To_Local'>tuple_fraction</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>5</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* 50% */ 
</span>    <span class='Control'>else</span> 
        <a href="subselect.c.html#LN479"><span class='Ref_To_Local'>tuple_fraction</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* default behavior */ 
</span> 
    <span class='Comment_Multi_Line'>/* plan_params should not be in use in current query level */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="subselect.c.html#LN473"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN168"><span class='Ref_to_Member'>plan_params</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Generate Paths for the subquery */ 
</span>    <a href="subselect.c.html#LN480"><span class='Ref_To_Local'>subroot</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/planner.h.html#LN39"><span class='Ref_to_Proto'>subquery_planner</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN473"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN477"><span class='Ref_To_Local'>subquery</span></a><span class='Delimiter'>, 
</span>                               <a href="subselect.c.html#LN473"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                               <span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="subselect.c.html#LN479"><span class='Ref_To_Local'>tuple_fraction</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Isolate the params needed by this specific subplan */ 
</span>    <a href="subselect.c.html#LN484"><span class='Ref_To_Local'>plan_params</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN473"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN168"><span class='Ref_to_Member'>plan_params</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN473"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN168"><span class='Ref_to_Member'>plan_params</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Select best Path and turn it into a Plan.  At least for now, there 
     * seems no reason to postpone doing that. 
     */ 
</span>    <a href="subselect.c.html#LN481"><span class='Ref_To_Local'>final_rel</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/pathnode.h.html#LN270"><span class='Ref_to_Proto'>fetch_upper_rel</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN480"><span class='Ref_To_Local'>subroot</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN77"><span class='Ref_to_EnumConst'>UPPERREL_FINAL</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN482"><span class='Ref_To_Local'>best_path</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/planner.h.html#LN50"><span class='Ref_to_Proto'>get_cheapest_fractional_path</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN481"><span class='Ref_To_Local'>final_rel</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN479"><span class='Ref_To_Local'>tuple_fraction</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="subselect.c.html#LN483"><span class='Ref_To_Local'>plan</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/planmain.h.html#LN49"><span class='Ref_to_Proto'>create_plan</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN480"><span class='Ref_To_Local'>subroot</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN482"><span class='Ref_To_Local'>best_path</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* And convert to SubPlan or InitPlan format. */ 
</span>    <a href="subselect.c.html#LN485"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN56"><span class='Ref_to_Proto'>build_subplan</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN473"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN483"><span class='Ref_To_Local'>plan</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN480"><span class='Ref_To_Local'>subroot</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN484"><span class='Ref_To_Local'>plan_params</span></a><span class='Delimiter'>, 
</span>                           <a href="subselect.c.html#LN474"><span class='Ref_to_Parameter'>subLinkType</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN474"><span class='Ref_to_Parameter'>subLinkId</span></a><span class='Delimiter'>, 
</span>                           <a href="subselect.c.html#LN475"><span class='Ref_to_Parameter'>testexpr</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="subselect.c.html#LN475"><span class='Ref_to_Parameter'>isTopQual</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If it's a correlated EXISTS with an unimportant targetlist, we might be 
     * able to transform it to the equivalent of an IN and then implement it 
     * by hashing.  We don't have enough information yet to tell which way is 
     * likely to be better (it depends on the expected number of executions of 
     * the EXISTS qual, and we are much too early in planning the outer query 
     * to be able to guess that).  So we generate both plans, if possible, and 
     * leave it to the executor to decide which to use. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN478"><span class='Ref_To_Local'>simple_exists</span></a> <span class='Operator'>&& </span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN485"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN678"><span class='Ref_to_Struct'>SubPlan</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN565"></a>        <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>newtestexpr</span><span class='Delimiter'>; 
</span><a name="LN566"></a>        <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>paramIds</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Make a second copy of the original subquery */ 
</span>        <a href="subselect.c.html#LN477"><span class='Ref_To_Local'>subquery</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN473"><span class='Ref_to_Parameter'>orig_subquery</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* and re-simplify */ 
</span>        <a href="subselect.c.html#LN478"><span class='Ref_To_Local'>simple_exists</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN73"><span class='Ref_to_Proto'>simplify_EXISTS_query</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN473"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN477"><span class='Ref_To_Local'>subquery</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="subselect.c.html#LN478"><span class='Ref_To_Local'>simple_exists</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* See if it can be converted to an ANY query */ 
</span>        <a href="subselect.c.html#LN477"><span class='Ref_To_Local'>subquery</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN74"><span class='Ref_to_Proto'>convert_EXISTS_to_ANY</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN473"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN477"><span class='Ref_To_Local'>subquery</span></a><span class='Delimiter'>, 
</span>                                         <span class='Operator'>&</span><a href="subselect.c.html#LN565"><span class='Ref_To_Local'>newtestexpr</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="subselect.c.html#LN566"><span class='Ref_To_Local'>paramIds</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN477"><span class='Ref_To_Local'>subquery</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Generate Paths for the ANY subquery; we'll need all rows */ 
</span>            <a href="subselect.c.html#LN480"><span class='Ref_To_Local'>subroot</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/planner.h.html#LN39"><span class='Ref_to_Proto'>subquery_planner</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN473"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN477"><span class='Ref_To_Local'>subquery</span></a><span class='Delimiter'>, 
</span>                                       <a href="subselect.c.html#LN473"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                       <span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Isolate the params needed by this specific subplan */ 
</span>            <a href="subselect.c.html#LN484"><span class='Ref_To_Local'>plan_params</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN473"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN168"><span class='Ref_to_Member'>plan_params</span></a><span class='Delimiter'>; 
</span>            <a href="subselect.c.html#LN473"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN168"><span class='Ref_to_Member'>plan_params</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Select best Path and turn it into a Plan */ 
</span>            <a href="subselect.c.html#LN481"><span class='Ref_To_Local'>final_rel</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/pathnode.h.html#LN270"><span class='Ref_to_Proto'>fetch_upper_rel</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN480"><span class='Ref_To_Local'>subroot</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN77"><span class='Ref_to_EnumConst'>UPPERREL_FINAL</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="subselect.c.html#LN482"><span class='Ref_To_Local'>best_path</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN481"><span class='Ref_To_Local'>final_rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN542"><span class='Ref_to_Member'>cheapest_total_path</span></a><span class='Delimiter'>; 
</span> 
            <a href="subselect.c.html#LN483"><span class='Ref_To_Local'>plan</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/planmain.h.html#LN49"><span class='Ref_to_Proto'>create_plan</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN480"><span class='Ref_To_Local'>subroot</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN482"><span class='Ref_To_Local'>best_path</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Now we can check if it'll fit in work_mem */ 
</span>            <span class='Comment_Multi_Line'>/* XXX can we check this at the Path stage? */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN70"><span class='Ref_to_Proto'>subplan_is_hashable</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN483"><span class='Ref_To_Local'>plan</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span><a name="LN597"></a>                <a href="../../../include/nodes/primnodes.h.html#LN678"><span class='Ref_to_Struct'>SubPlan</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>hashplan</span><span class='Delimiter'>; 
</span><a name="LN598"></a>                <a href="../../../include/nodes/primnodes.h.html#LN722"><span class='Ref_to_Struct'>AlternativeSubPlan</span></a> <span class='Operator'>*</span><span class='Declare_Local'>asplan</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* OK, convert to SubPlan format. */ 
</span>                <a href="subselect.c.html#LN597"><span class='Ref_To_Local'>hashplan</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN575"><span class='Ref_to_Macro'>castNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN678"><span class='Ref_to_Struct'>SubPlan</span></a><span class='Delimiter'>, 
</span>                                    <a href="subselect.c.html#LN56"><span class='Ref_to_Proto'>build_subplan</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN473"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN483"><span class='Ref_To_Local'>plan</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN480"><span class='Ref_To_Local'>subroot</span></a><span class='Delimiter'>, 
</span>                                                  <a href="subselect.c.html#LN484"><span class='Ref_To_Local'>plan_params</span></a><span class='Delimiter'>, 
</span>                                                  <a href="../../../include/nodes/primnodes.h.html#LN620"><span class='Ref_to_EnumConst'>ANY_SUBLINK</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                                  <a href="subselect.c.html#LN565"><span class='Ref_To_Local'>newtestexpr</span></a><span class='Delimiter'>, 
</span>                                                  <span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* Check we got what we expected */ 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="subselect.c.html#LN597"><span class='Ref_To_Local'>hashplan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN707"><span class='Ref_to_Member'>parParam</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="subselect.c.html#LN597"><span class='Ref_To_Local'>hashplan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN696"><span class='Ref_to_Member'>useHashTable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* build_subplan won't have filled in paramIds */ 
</span>                <a href="subselect.c.html#LN597"><span class='Ref_To_Local'>hashplan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN685"><span class='Ref_to_Member'>paramIds</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN566"><span class='Ref_To_Local'>paramIds</span></a><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Leave it to the executor to decide which plan to use */ 
</span>                <a href="subselect.c.html#LN598"><span class='Ref_To_Local'>asplan</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN722"><span class='Ref_to_Struct'>AlternativeSubPlan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="subselect.c.html#LN598"><span class='Ref_To_Local'>asplan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN725"><span class='Ref_to_Member'>subplans</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN139"><span class='Ref_to_Macro'>list_make2</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN485"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN597"><span class='Ref_To_Local'>hashplan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="subselect.c.html#LN485"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN598"><span class='Ref_To_Local'>asplan</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if subplan_is_hashable(p... &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if subquery &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if simple_exists&&IsA(re... &raquo; </span> 
 
    <span class='Control'>return</span> <a href="subselect.c.html#LN485"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end make_subplan &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Build a SubPlan node given the raw inputs --- subroutine for make_subplan 
 * 
 * Returns either the SubPlan, or a replacement expression if we decide to 
 * make it an InitPlan, as explained in the comments for make_subplan. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>* 
</span><a name="LN631"></a><span class='Declare_Function'>build_subplan</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>plan</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>subroot</span><span class='Delimiter'>, 
</span><a name="LN632"></a>              <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>plan_params</span><span class='Delimiter'>, 
</span><a name="LN633"></a>              <a href="../../../include/nodes/primnodes.h.html#LN616"><span class='Ref_to_Enum'>SubLinkType</span></a> <span class='Declare_Parameter'>subLinkType</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>subLinkId</span><span class='Delimiter'>, 
</span><a name="LN634"></a>              <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>testexpr</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>adjust_testexpr</span><span class='Delimiter'>, 
</span><a name="LN635"></a>              <span class='Keyword'>bool </span><span class='Declare_Parameter'>unknownEqFalse</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN637"></a>    <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN638"></a>    <a href="../../../include/nodes/primnodes.h.html#LN678"><span class='Ref_to_Struct'>SubPlan</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>splan</span><span class='Delimiter'>; 
</span><a name="LN639"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isInitPlan</span><span class='Delimiter'>; 
</span><a name="LN640"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Initialize the SubPlan node.  Note plan_id, plan_name, and cost fields 
     * are set further down. 
     */ 
</span>    <a href="subselect.c.html#LN638"><span class='Ref_To_Local'>splan</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN678"><span class='Ref_to_Struct'>SubPlan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN638"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN682"><span class='Ref_to_Member'>subLinkType</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN633"><span class='Ref_to_Parameter'>subLinkType</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN638"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN684"><span class='Ref_to_Member'>testexpr</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN638"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN685"><span class='Ref_to_Member'>paramIds</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN428"><span class='Ref_to_Func'>get_first_col_type</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN631"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="subselect.c.html#LN638"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN691"><span class='Ref_to_Member'>firstColType</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="subselect.c.html#LN638"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN692"><span class='Ref_to_Member'>firstColTypmod</span></a><span class='Delimiter'>, 
</span>                       <span class='Operator'>&</span><a href="subselect.c.html#LN638"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN693"><span class='Ref_to_Member'>firstColCollation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN638"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN696"><span class='Ref_to_Member'>useHashTable</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN638"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN698"><span class='Ref_to_Member'>unknownEqFalse</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN635"><span class='Ref_to_Parameter'>unknownEqFalse</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN638"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN701"><span class='Ref_to_Member'>parallel_safe</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN631"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN137"><span class='Ref_to_Member'>parallel_safe</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN638"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN705"><span class='Ref_to_Member'>setParam</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN638"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN707"><span class='Ref_to_Member'>parParam</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN638"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN708"><span class='Ref_to_Member'>args</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Make parParam and args lists of param IDs and expressions that current 
     * query level will pass to this child plan. 
     */ 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN640"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN632"><span class='Ref_to_Parameter'>plan_params</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN665"></a>        <a href="../../../include/nodes/relation.h.html#LN2134"><span class='Ref_to_Struct'>PlannerParamItem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pitem</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN2134"><span class='Ref_to_Struct'>PlannerParamItem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN640"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN666"></a>        <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>arg</span> <span class='Operator'>= </span><a href="subselect.c.html#LN665"><span class='Ref_To_Local'>pitem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN2138"><span class='Ref_to_Member'>item</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * The Var, PlaceHolderVar, or Aggref has already been adjusted to 
         * have the correct varlevelsup, phlevelsup, or agglevelsup. 
         * 
         * If it's a PlaceHolderVar or Aggref, its arguments might contain 
         * SubLinks, which have not yet been processed (see the comments for 
         * SS_replace_correlation_vars).  Do that now. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN666"><span class='Ref_To_Local'>arg</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN1846"><span class='Ref_to_Struct'>PlaceHolderVar</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>            <a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN666"><span class='Ref_To_Local'>arg</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN290"><span class='Ref_to_Struct'>Aggref</span></a><span class='Parentheses'>))</span> 
            <a href="subselect.c.html#LN666"><span class='Ref_To_Local'>arg</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/subselect.h.html#LN26"><span class='Ref_to_Proto'>SS_process_sublinks</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN631"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN666"><span class='Ref_To_Local'>arg</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="subselect.c.html#LN638"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN707"><span class='Ref_to_Member'>parParam</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN144"><span class='Ref_to_Func'>lappend_int</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN638"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN707"><span class='Ref_to_Member'>parParam</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN665"><span class='Ref_To_Local'>pitem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN2139"><span class='Ref_to_Member'>paramId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="subselect.c.html#LN638"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN708"><span class='Ref_to_Member'>args</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN638"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN708"><span class='Ref_to_Member'>args</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN666"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Un-correlated or undirect correlated plans of EXISTS, EXPR, ARRAY, 
     * ROWCOMPARE, or MULTIEXPR types can be used as initPlans.  For EXISTS, 
     * EXPR, or ARRAY, we return a Param referring to the result of evaluating 
     * the initPlan.  For ROWCOMPARE, we must modify the testexpr tree to 
     * contain PARAM_EXEC Params instead of the PARAM_SUBLINK Params emitted 
     * by the parser, and then return that tree.  For MULTIEXPR, we return a 
     * null constant: the resjunk targetlist item containing the SubLink does 
     * not need to return anything useful, since the referencing Params are 
     * elsewhere. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN638"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN707"><span class='Ref_to_Member'>parParam</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a> <span class='Operator'>&& </span><a href="subselect.c.html#LN633"><span class='Ref_to_Parameter'>subLinkType</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/primnodes.h.html#LN618"><span class='Ref_to_EnumConst'>EXISTS_SUBLINK</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN697"></a>        <a href="../../../include/nodes/primnodes.h.html#LN240"><span class='Ref_to_Struct'>Param</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>prm</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="subselect.c.html#LN634"><span class='Ref_to_Parameter'>testexpr</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="subselect.c.html#LN697"><span class='Ref_To_Local'>prm</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN388"><span class='Ref_to_Func'>generate_new_param</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN631"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN17"><span class='Ref_to_Const'>BOOLOID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="subselect.c.html#LN638"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN705"><span class='Ref_to_Member'>setParam</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN144"><span class='Ref_to_Macro'>list_make1_int</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN697"><span class='Ref_To_Local'>prm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN244"><span class='Ref_to_Member'>paramid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="subselect.c.html#LN639"><span class='Ref_To_Local'>isInitPlan</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="subselect.c.html#LN637"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN697"><span class='Ref_To_Local'>prm</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN638"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN707"><span class='Ref_to_Member'>parParam</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a> <span class='Operator'>&& </span><a href="subselect.c.html#LN633"><span class='Ref_to_Parameter'>subLinkType</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/primnodes.h.html#LN622"><span class='Ref_to_EnumConst'>EXPR_SUBLINK</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN707"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>te</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN631"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN708"></a>        <a href="../../../include/nodes/primnodes.h.html#LN240"><span class='Ref_to_Struct'>Param</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>prm</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="subselect.c.html#LN707"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1373"><span class='Ref_to_Member'>resjunk</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="subselect.c.html#LN634"><span class='Ref_to_Parameter'>testexpr</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="subselect.c.html#LN708"><span class='Ref_To_Local'>prm</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN388"><span class='Ref_to_Func'>generate_new_param</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN631"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                 <a href="../../../include/nodes/nodeFuncs.h.html#LN31"><span class='Ref_to_Proto'>exprType</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN707"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../../../include/nodes/nodeFuncs.h.html#LN32"><span class='Ref_to_Proto'>exprTypmod</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN707"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../../../include/nodes/nodeFuncs.h.html#LN38"><span class='Ref_to_Proto'>exprCollation</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN707"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="subselect.c.html#LN638"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN705"><span class='Ref_to_Member'>setParam</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN144"><span class='Ref_to_Macro'>list_make1_int</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN708"><span class='Ref_To_Local'>prm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN244"><span class='Ref_to_Member'>paramid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="subselect.c.html#LN639"><span class='Ref_To_Local'>isInitPlan</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="subselect.c.html#LN637"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN708"><span class='Ref_To_Local'>prm</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN638"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN707"><span class='Ref_to_Member'>parParam</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a> <span class='Operator'>&& </span><a href="subselect.c.html#LN633"><span class='Ref_to_Parameter'>subLinkType</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/primnodes.h.html#LN624"><span class='Ref_to_EnumConst'>ARRAY_SUBLINK</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN722"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>te</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN631"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN723"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>arraytype</span><span class='Delimiter'>; 
</span><a name="LN724"></a>        <a href="../../../include/nodes/primnodes.h.html#LN240"><span class='Ref_to_Struct'>Param</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>prm</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="subselect.c.html#LN722"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1373"><span class='Ref_to_Member'>resjunk</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="subselect.c.html#LN634"><span class='Ref_to_Parameter'>testexpr</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="subselect.c.html#LN723"><span class='Ref_To_Local'>arraytype</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN159"><span class='Ref_to_Proto'>get_promoted_array_type</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/nodeFuncs.h.html#LN31"><span class='Ref_to_Proto'>exprType</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN722"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN723"><span class='Ref_To_Local'>arraytype</span></a><span class='Parentheses'>))</span> 
            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not find array type for datatype %s"</span><span class='Delimiter'>, 
</span>                 <a href="../../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/nodeFuncs.h.html#LN31"><span class='Ref_to_Proto'>exprType</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN722"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="subselect.c.html#LN724"><span class='Ref_To_Local'>prm</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN388"><span class='Ref_to_Func'>generate_new_param</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN631"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                 <a href="subselect.c.html#LN723"><span class='Ref_To_Local'>arraytype</span></a><span class='Delimiter'>, 
</span>                                 <a href="../../../include/nodes/nodeFuncs.h.html#LN32"><span class='Ref_to_Proto'>exprTypmod</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN722"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../../../include/nodes/nodeFuncs.h.html#LN38"><span class='Ref_to_Proto'>exprCollation</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN722"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="subselect.c.html#LN638"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN705"><span class='Ref_to_Member'>setParam</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN144"><span class='Ref_to_Macro'>list_make1_int</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN724"><span class='Ref_To_Local'>prm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN244"><span class='Ref_to_Member'>paramid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="subselect.c.html#LN639"><span class='Ref_To_Local'>isInitPlan</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="subselect.c.html#LN637"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN724"><span class='Ref_To_Local'>prm</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if splan-&GT;parParam==NIL&... &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN638"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN707"><span class='Ref_to_Member'>parParam</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a> <span class='Operator'>&& </span><a href="subselect.c.html#LN633"><span class='Ref_to_Parameter'>subLinkType</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/primnodes.h.html#LN621"><span class='Ref_to_EnumConst'>ROWCOMPARE_SUBLINK</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Adjust the Params */ 
</span><a name="LN743"></a>        <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>params</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="subselect.c.html#LN634"><span class='Ref_to_Parameter'>testexpr</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="subselect.c.html#LN743"><span class='Ref_To_Local'>params</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN61"><span class='Ref_to_Proto'>generate_subquery_params</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN631"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                          <a href="subselect.c.html#LN631"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Delimiter'>, 
</span>                                          <span class='Operator'>&</span><a href="subselect.c.html#LN638"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN685"><span class='Ref_to_Member'>paramIds</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="subselect.c.html#LN637"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN65"><span class='Ref_to_Proto'>convert_testexpr</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN631"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                  <a href="subselect.c.html#LN634"><span class='Ref_to_Parameter'>testexpr</span></a><span class='Delimiter'>, 
</span>                                  <a href="subselect.c.html#LN743"><span class='Ref_To_Local'>params</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="subselect.c.html#LN638"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN705"><span class='Ref_to_Member'>setParam</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN268"><span class='Ref_to_Proto'>list_copy</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN638"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN685"><span class='Ref_to_Member'>paramIds</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="subselect.c.html#LN639"><span class='Ref_To_Local'>isInitPlan</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * The executable expression is returned to become part of the outer 
         * plan's expression tree; it is not kept in the initplan node. 
         */ 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if splan-&GT;parParam==NIL&... &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN633"><span class='Ref_to_Parameter'>subLinkType</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/primnodes.h.html#LN623"><span class='Ref_to_EnumConst'>MULTIEXPR_SUBLINK</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Whether it's an initplan or not, it needs to set a PARAM_EXEC Param 
         * for each output column. 
         */ 
</span><a name="LN766"></a>        <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>params</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="subselect.c.html#LN634"><span class='Ref_to_Parameter'>testexpr</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="subselect.c.html#LN766"><span class='Ref_To_Local'>params</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN61"><span class='Ref_to_Proto'>generate_subquery_params</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN631"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                          <a href="subselect.c.html#LN631"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Delimiter'>, 
</span>                                          <span class='Operator'>&</span><a href="subselect.c.html#LN638"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN705"><span class='Ref_to_Member'>setParam</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Save the list of replacement Params in the n'th cell of 
         * root-&GT;multiexpr_params; setrefs.c will use it to replace 
         * PARAM_MULTIEXPR Params. 
         */ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN631"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN231"><span class='Ref_to_Member'>multiexpr_params</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><a href="subselect.c.html#LN633"><span class='Ref_to_Parameter'>subLinkId</span></a><span class='Parentheses'>)</span> 
            <a href="subselect.c.html#LN631"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN231"><span class='Ref_to_Member'>multiexpr_params</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN631"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN231"><span class='Ref_to_Member'>multiexpr_params</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="subselect.c.html#LN640"><span class='Ref_To_Local'>lc</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN222"><span class='Ref_to_Proto'>list_nth_cell</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN631"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN231"><span class='Ref_to_Member'>multiexpr_params</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN633"><span class='Ref_to_Parameter'>subLinkId</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN640"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN640"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>) </span><span class='Operator'>= </span><a href="subselect.c.html#LN766"><span class='Ref_To_Local'>params</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* It can be an initplan if there are no parParams. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN638"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN707"><span class='Ref_to_Member'>parParam</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="subselect.c.html#LN639"><span class='Ref_To_Local'>isInitPlan</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="subselect.c.html#LN637"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/makefuncs.h.html#LN57"><span class='Ref_to_Proto'>makeNullConst</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_type.h.html#LN679"><span class='Ref_to_Const'>RECORDOID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="subselect.c.html#LN639"><span class='Ref_To_Local'>isInitPlan</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="subselect.c.html#LN637"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN638"><span class='Ref_To_Local'>splan</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if subLinkType==MULTIEXP... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Adjust the Params in the testexpr, unless caller said it's not 
         * needed. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN634"><span class='Ref_to_Parameter'>testexpr</span></a> <span class='Operator'>&& </span><a href="subselect.c.html#LN634"><span class='Ref_to_Parameter'>adjust_testexpr</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN804"></a>            <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>params</span><span class='Delimiter'>; 
</span> 
            <a href="subselect.c.html#LN804"><span class='Ref_To_Local'>params</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN61"><span class='Ref_to_Proto'>generate_subquery_params</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN631"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                              <a href="subselect.c.html#LN631"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Delimiter'>, 
</span>                                              <span class='Operator'>&</span><a href="subselect.c.html#LN638"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN685"><span class='Ref_to_Member'>paramIds</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="subselect.c.html#LN638"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN684"><span class='Ref_to_Member'>testexpr</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN65"><span class='Ref_to_Proto'>convert_testexpr</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN631"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                               <a href="subselect.c.html#LN634"><span class='Ref_to_Parameter'>testexpr</span></a><span class='Delimiter'>, 
</span>                                               <a href="subselect.c.html#LN804"><span class='Ref_To_Local'>params</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="subselect.c.html#LN638"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN684"><span class='Ref_to_Member'>testexpr</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN634"><span class='Ref_to_Parameter'>testexpr</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We can't convert subplans of ALL_SUBLINK or ANY_SUBLINK types to 
         * initPlans, even when they are uncorrelated or undirect correlated, 
         * because we need to scan the output of the subplan for each outer 
         * tuple.  But if it's a not-direct-correlated IN (= ANY) test, we 
         * might be able to use a hashtable to avoid comparing all the tuples. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN633"><span class='Ref_to_Parameter'>subLinkType</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/primnodes.h.html#LN620"><span class='Ref_to_EnumConst'>ANY_SUBLINK</span></a> <span class='Operator'>&& 
</span>            <a href="subselect.c.html#LN638"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN707"><span class='Ref_to_Member'>parParam</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a> <span class='Operator'>&& 
</span>            <a href="subselect.c.html#LN70"><span class='Ref_to_Proto'>subplan_is_hashable</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN631"><span class='Ref_to_Parameter'>plan</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>            <a href="subselect.c.html#LN71"><span class='Ref_to_Proto'>testexpr_is_hashable</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN638"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN684"><span class='Ref_to_Member'>testexpr</span></a><span class='Parentheses'>))</span> 
            <a href="subselect.c.html#LN638"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN696"><span class='Ref_to_Member'>useHashTable</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Otherwise, we have the option to tack a Material node onto the top 
         * of the subplan, to reduce the cost of reading it repeatedly.  This 
         * is pointless for a direct-correlated subplan, since we'd have to 
         * recompute its results each time anyway.  For uncorrelated/undirect 
         * correlated subplans, we add Material unless the subplan's top plan 
         * node would materialize its output anyway.  Also, if enable_material 
         * is false, then the user does not want us to materialize anything 
         * unnecessarily, so we don't. 
         */ 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN638"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN707"><span class='Ref_to_Member'>parParam</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a> <span class='Operator'>&& </span><a href="../path/costsize.c.html#LN125"><span class='Ref_to_Global_Var'>enable_material</span></a> <span class='Operator'>&& 
</span>                 <span class='Operator'>!</span><a href="../../../include/executor/executor.h.html#LN101"><span class='Ref_to_Proto'>ExecMaterializesOutput</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN513"><span class='Ref_to_Macro'>nodeTag</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN631"><span class='Ref_to_Parameter'>plan</span></a><span class='Parentheses'>)))</span> 
            <a href="subselect.c.html#LN631"><span class='Ref_to_Parameter'>plan</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/planmain.h.html#LN54"><span class='Ref_to_Proto'>materialize_finished_plan</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN631"><span class='Ref_to_Parameter'>plan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="subselect.c.html#LN637"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN638"><span class='Ref_To_Local'>splan</span></a><span class='Delimiter'>; 
</span>        <a href="subselect.c.html#LN639"><span class='Ref_To_Local'>isInitPlan</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Add the subplan and its PlannerInfo to the global lists. 
     */ 
</span>    <a href="subselect.c.html#LN631"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN97"><span class='Ref_to_Member'>subplans</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN631"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN97"><span class='Ref_to_Member'>subplans</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN631"><span class='Ref_to_Parameter'>plan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN631"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN99"><span class='Ref_to_Member'>subroots</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN631"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN99"><span class='Ref_to_Member'>subroots</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN631"><span class='Ref_to_Parameter'>subroot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN638"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN687"><span class='Ref_to_Member'>plan_id</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN631"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN97"><span class='Ref_to_Member'>subplans</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN639"><span class='Ref_To_Local'>isInitPlan</span></a><span class='Parentheses'>) 
</span>        <a href="subselect.c.html#LN631"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN227"><span class='Ref_to_Member'>init_plans</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN631"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN227"><span class='Ref_to_Member'>init_plans</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN638"><span class='Ref_To_Local'>splan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * A parameterless subplan (not initplan) should be prepared to handle 
     * REWIND efficiently.  If it has direct parameters then there's no point 
     * since it'll be reset on each scan anyway; and if it's an initplan then 
     * there's no point since it won't get re-run without parameter changes 
     * anyway.  The input of a hashed subplan doesn't need REWIND either. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN638"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN707"><span class='Ref_to_Member'>parParam</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a> <span class='Operator'>&& !</span><a href="subselect.c.html#LN639"><span class='Ref_To_Local'>isInitPlan</span></a> <span class='Operator'>&& !</span><a href="subselect.c.html#LN638"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN696"><span class='Ref_to_Member'>useHashTable</span></a><span class='Parentheses'>) 
</span>        <a href="subselect.c.html#LN631"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN101"><span class='Ref_to_Member'>rewindPlanIDs</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN89"><span class='Ref_to_Proto'>bms_add_member</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN631"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN101"><span class='Ref_to_Member'>rewindPlanIDs</span></a><span class='Delimiter'>, 
</span>                                                   <a href="subselect.c.html#LN638"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN687"><span class='Ref_to_Member'>plan_id</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Label the subplan for EXPLAIN purposes */ 
</span>    <a href="subselect.c.html#LN638"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN689"><span class='Ref_to_Member'>plan_name</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Number'>32</span> <span class='Operator'>+ </span><span class='Number'>12</span> <span class='Operator'>* </span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN638"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN705"><span class='Ref_to_Member'>setParam</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN638"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN689"><span class='Ref_to_Member'>plan_name</span></a><span class='Delimiter'>, </span><span class='String'>"%s %d"</span><span class='Delimiter'>, 
</span>            <a href="subselect.c.html#LN639"><span class='Ref_To_Local'>isInitPlan</span></a> <span class='Operator'>? </span><span class='String'>"InitPlan"</span> <span class='Operator'>: </span><span class='String'>"SubPlan"</span><span class='Delimiter'>, 
</span>            <a href="subselect.c.html#LN638"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN687"><span class='Ref_to_Member'>plan_id</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN638"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN705"><span class='Ref_to_Member'>setParam</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN875"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>ptr</span> <span class='Operator'>= </span><a href="subselect.c.html#LN638"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN689"><span class='Ref_to_Member'>plan_name</span></a> <span class='Operator'>+ </span>strlen<span class='Parentheses'>(</span><a href="subselect.c.html#LN638"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN689"><span class='Ref_to_Member'>plan_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="subselect.c.html#LN875"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>+= </span><a href="../../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN875"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>, </span><span class='String'>" (returns "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN640"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN638"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN705"><span class='Ref_to_Member'>setParam</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="subselect.c.html#LN875"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>+= </span><a href="../../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN875"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>, </span><span class='String'>"$%d%s"</span><span class='Delimiter'>, 
</span>                           <a href="../../../include/nodes/pg_list.h.html#LN106"><span class='Ref_to_Macro'>lfirst_int</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN640"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="../../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN640"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='String'>","</span> <span class='Operator'>: </span><span class='String'>")"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Lastly, fill in the cost estimates for use later */ 
</span>    <a href="../../../include/optimizer/cost.h.html#LN156"><span class='Ref_to_Proto'>cost_subplan</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN631"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN638"><span class='Ref_To_Local'>splan</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN631"><span class='Ref_to_Parameter'>plan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="subselect.c.html#LN637"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end build_subplan &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * generate_subquery_params: build a list of Params representing the output 
 * columns of a sublink's sub-select, given the sub-select's targetlist. 
 * 
 * We also return an integer list of the paramids of the Params. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN899"></a><span class='Declare_Function'>generate_subquery_params</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tlist</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>paramIds</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN901"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN902"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>ids</span><span class='Delimiter'>; 
</span><a name="LN903"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <a href="subselect.c.html#LN901"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN902"><span class='Ref_To_Local'>ids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN903"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN899"><span class='Ref_to_Parameter'>tlist</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN908"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tent</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN903"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN909"></a>        <a href="../../../include/nodes/primnodes.h.html#LN240"><span class='Ref_to_Struct'>Param</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>param</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN908"><span class='Ref_To_Local'>tent</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1373"><span class='Ref_to_Member'>resjunk</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <a href="subselect.c.html#LN909"><span class='Ref_To_Local'>param</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN388"><span class='Ref_to_Func'>generate_new_param</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN899"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                   <a href="../../../include/nodes/nodeFuncs.h.html#LN31"><span class='Ref_to_Proto'>exprType</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN908"><span class='Ref_To_Local'>tent</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                   <a href="../../../include/nodes/nodeFuncs.h.html#LN32"><span class='Ref_to_Proto'>exprTypmod</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN908"><span class='Ref_To_Local'>tent</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                   <a href="../../../include/nodes/nodeFuncs.h.html#LN38"><span class='Ref_to_Proto'>exprCollation</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN908"><span class='Ref_To_Local'>tent</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="subselect.c.html#LN901"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN901"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN909"><span class='Ref_To_Local'>param</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="subselect.c.html#LN902"><span class='Ref_To_Local'>ids</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN144"><span class='Ref_to_Func'>lappend_int</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN902"><span class='Ref_To_Local'>ids</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN909"><span class='Ref_To_Local'>param</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN244"><span class='Ref_to_Member'>paramid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Operator'>*</span><a href="subselect.c.html#LN899"><span class='Ref_to_Parameter'>paramIds</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN902"><span class='Ref_To_Local'>ids</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="subselect.c.html#LN901"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end generate_subquery_params &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * generate_subquery_vars: build a list of Vars representing the output 
 * columns of a sublink's sub-select, given the sub-select's targetlist. 
 * The Vars have the specified varno (RTE index). 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN932"></a><span class='Declare_Function'>generate_subquery_vars</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tlist</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>varno</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN934"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN935"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <a href="subselect.c.html#LN934"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN935"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN932"><span class='Ref_to_Parameter'>tlist</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN940"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tent</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN935"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN941"></a>        <a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>var</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN940"><span class='Ref_To_Local'>tent</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1373"><span class='Ref_to_Member'>resjunk</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <a href="subselect.c.html#LN941"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/makefuncs.h.html#LN32"><span class='Ref_to_Proto'>makeVarFromTargetEntry</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN932"><span class='Ref_to_Parameter'>varno</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN940"><span class='Ref_To_Local'>tent</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="subselect.c.html#LN934"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN934"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN941"><span class='Ref_To_Local'>var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="subselect.c.html#LN934"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end generate_subquery_vars &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * convert_testexpr: convert the testexpr given by the parser into 
 * actually executable form.  This entails replacing PARAM_SUBLINK Params 
 * with Params or Vars representing the results of the sub-select.  The 
 * nodes to be substituted are passed in as the List result from 
 * generate_subquery_params or generate_subquery_vars. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>* 
</span><a name="LN961"></a><span class='Declare_Function'>convert_testexpr</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN962"></a>                 <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>testexpr</span><span class='Delimiter'>, 
</span><a name="LN963"></a>                 <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>subst_nodes</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN965"></a>    <a href="subselect.c.html#LN37"><span class='Ref_to_Struct'>convert_testexpr_context</span></a> <span class='Declare_Local'>context</span><span class='Delimiter'>; 
</span> 
    <a href="subselect.c.html#LN965"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN39"><span class='Ref_to_Member'>root</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN961"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN965"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN40"><span class='Ref_to_Member'>subst_nodes</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN963"><span class='Ref_to_Parameter'>subst_nodes</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="subselect.c.html#LN68"><span class='Ref_to_Proto'>convert_testexpr_mutator</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN962"><span class='Ref_to_Parameter'>testexpr</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="subselect.c.html#LN965"><span class='Ref_To_Local'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>* 
</span><a name="LN973"></a><span class='Declare_Function'>convert_testexpr_mutator</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, 
</span><a name="LN974"></a>                         <a href="subselect.c.html#LN37"><span class='Ref_to_Struct'>convert_testexpr_context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN973"><span class='Ref_to_Parameter'>node</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN973"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN240"><span class='Ref_to_Struct'>Param</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN980"></a>        <a href="../../../include/nodes/primnodes.h.html#LN240"><span class='Ref_to_Struct'>Param</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>param</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN240"><span class='Ref_to_Struct'>Param</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN973"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN980"><span class='Ref_To_Local'>param</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN243"><span class='Ref_to_Member'>paramkind</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/primnodes.h.html#LN236"><span class='Ref_to_EnumConst'>PARAM_SUBLINK</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN980"><span class='Ref_To_Local'>param</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN244"><span class='Ref_to_Member'>paramid</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                <a href="subselect.c.html#LN980"><span class='Ref_To_Local'>param</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN244"><span class='Ref_to_Member'>paramid</span></a> <span class='Operator'>&GT; </span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN974"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="subselect.c.html#LN40"><span class='Ref_to_Member'>subst_nodes</span></a><span class='Parentheses'>))</span> 
                <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected PARAM_SUBLINK ID: %d"</span><span class='Delimiter'>, </span><a href="subselect.c.html#LN980"><span class='Ref_To_Local'>param</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN244"><span class='Ref_to_Member'>paramid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * We copy the list item to avoid having doubly-linked 
             * substructure in the modified parse tree.  This is probably 
             * unnecessary when it's a Param, but be safe. 
             */ 
</span>            <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN223"><span class='Ref_to_Proto'>list_nth</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN974"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="subselect.c.html#LN40"><span class='Ref_to_Member'>subst_nodes</span></a><span class='Delimiter'>, 
</span>                                                <a href="subselect.c.html#LN980"><span class='Ref_To_Local'>param</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN244"><span class='Ref_to_Member'>paramid</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN973"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN629"><span class='Ref_to_Struct'>SubLink</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * If we come across a nested SubLink, it is neither necessary nor 
         * correct to recurse into it: any PARAM_SUBLINKs we might find inside 
         * belong to the inner SubLink not the outer. So just return it as-is. 
         * 
         * This reasoning depends on the assumption that nothing will pull 
         * subexpressions into or out of the testexpr field of a SubLink, at 
         * least not without replacing PARAM_SUBLINKs first.  If we did want 
         * to do that we'd need to rethink the parser-output representation 
         * altogether, since currently PARAM_SUBLINKs are only unique per 
         * SubLink not globally across the query.  The whole point of 
         * replacing them with Vars or PARAM_EXEC nodes is to make them 
         * globally unique before they escape from the SubLink's testexpr. 
         * 
         * Note: this can't happen when called during SS_process_sublinks, 
         * because that recursively processes inner SubLinks first.  It can 
         * happen when called from convert_ANY_sublink_to_join, though. 
         */ 
</span>        <span class='Control'>return</span> <a href="subselect.c.html#LN973"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IsA(node,SubLink) &raquo; </span> 
    <span class='Control'>return</span> <a href="../../../include/nodes/nodeFuncs.h.html#LN54"><span class='Ref_to_Proto'>expression_tree_mutator</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN973"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, 
</span>                                   <a href="subselect.c.html#LN68"><span class='Ref_to_Proto'>convert_testexpr_mutator</span></a><span class='Delimiter'>, 
</span>                                   <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN974"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end convert_testexpr_mutator &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * subplan_is_hashable: can we implement an ANY subplan by hashing? 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1028"></a><span class='Declare_Function'>subplan_is_hashable</span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>plan</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1030"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>subquery_size</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The estimated size of the subquery result must fit in work_mem. (Note: 
     * we use heap tuple overhead here even though the tuples will actually be 
     * stored as MinimalTuples; this provides some fudge factor for hashtable 
     * overhead.) 
     */ 
</span>    <a href="subselect.c.html#LN1030"><span class='Ref_To_Local'>subquery_size</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN1028"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN130"><span class='Ref_to_Member'>plan_rows</span></a> <span class='Operator'>* 
</span>        <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN587"><span class='Ref_to_Macro'>MAXALIGN</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1028"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN131"><span class='Ref_to_Member'>plan_width</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="../../../include/c.h.html#LN587"><span class='Ref_to_Macro'>MAXALIGN</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN169"><span class='Ref_to_Const'>SizeofHeapTupleHeader</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN1030"><span class='Ref_To_Local'>subquery_size</span></a> <span class='Operator'>&GT; </span><a href="../../utils/init/globals.c.html#LN112"><span class='Ref_to_Global_Var'>work_mem</span></a> <span class='Operator'>* </span><span class='Number'>1024L</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * testexpr_is_hashable: is an ANY SubLink's test expression hashable? 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1050"></a><span class='Declare_Function'>testexpr_is_hashable</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>testexpr</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * The testexpr must be a single OpExpr, or an AND-clause containing only 
     * OpExprs. 
     * 
     * The combining operators must be hashable and strict. The need for 
     * hashability is obvious, since we want to use hashing. Without 
     * strictness, behavior in the presence of nulls is too unpredictable.  We 
     * actually must assume even more than plain strictness: they can't yield 
     * NULL for non-null inputs, either (see nodeSubplan.c).  However, hash 
     * indexes and hash joins assume that too. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN1050"><span class='Ref_to_Parameter'>testexpr</span></a> <span class='Operator'>&& </span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1050"><span class='Ref_to_Parameter'>testexpr</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN491"><span class='Ref_to_Struct'>OpExpr</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN72"><span class='Ref_to_Proto'>hash_ok_operator</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN491"><span class='Ref_to_Struct'>OpExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN1050"><span class='Ref_to_Parameter'>testexpr</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/optimizer/clauses.h.html#LN42"><span class='Ref_to_Proto'>and_clause</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1050"><span class='Ref_to_Parameter'>testexpr</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1070"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1070"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN557"><span class='Ref_to_Struct'>BoolExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN1050"><span class='Ref_to_Parameter'>testexpr</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>args<span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><a name="LN1074"></a>            <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>andarg</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1070"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1074"><span class='Ref_To_Local'>andarg</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN491"><span class='Ref_to_Struct'>OpExpr</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="subselect.c.html#LN72"><span class='Ref_to_Proto'>hash_ok_operator</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN491"><span class='Ref_to_Struct'>OpExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN1074"><span class='Ref_To_Local'>andarg</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end testexpr_is_hashable &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Check expression is hashable + strict 
 * 
 * We could use op_hashjoinable() and op_strict(), but do it like this to 
 * avoid a redundant cache lookup. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1094"></a><span class='Declare_Function'>hash_ok_operator</span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN491"><span class='Ref_to_Struct'>OpExpr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>expr</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1096"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>opid</span> <span class='Operator'>= </span><a href="subselect.c.html#LN1094"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN494"><span class='Ref_to_Member'>opno</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* quick out if not a binary operator */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1094"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN500"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>2</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN1096"><span class='Ref_To_Local'>opid</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_operator.h.html#LN775"><span class='Ref_to_Const'>ARRAY_EQ_OP</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* array_eq is strict, but must check input type to ensure hashable */ 
</span>        <span class='Comment_Multi_Line'>/* XXX record_eq will need same treatment when it becomes hashable */ 
</span><a name="LN1105"></a>        <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>leftarg</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1094"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN500"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>return</span> <a href="../../../include/utils/lsyscache.h.html#LN103"><span class='Ref_to_Proto'>op_hashjoinable</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1096"><span class='Ref_To_Local'>opid</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/nodeFuncs.h.html#LN31"><span class='Ref_to_Proto'>exprType</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1105"><span class='Ref_To_Local'>leftarg</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* else must look up the operator properties */ 
</span><a name="LN1112"></a>        <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN1113"></a>        <a href="../../../include/catalog/pg_operator.h.html#LN56"><span class='Ref_to_Typedef'>Form_pg_operator</span></a> <span class='Declare_Local'>optup</span><span class='Delimiter'>; 
</span> 
        <a href="subselect.c.html#LN1112"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN71"><span class='Ref_to_EnumConst'>OPEROID</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1096"><span class='Ref_To_Local'>opid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1112"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for operator %u"</span><span class='Delimiter'>, </span><a href="subselect.c.html#LN1096"><span class='Ref_To_Local'>opid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="subselect.c.html#LN1113"><span class='Ref_To_Local'>optup</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_operator.h.html#LN56"><span class='Ref_to_Typedef'>Form_pg_operator</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1112"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="subselect.c.html#LN1113"><span class='Ref_To_Local'>optup</span></a><span class='Operator'>-&GT;</span>oprcanhash <span class='Operator'>|| !</span><a href="../../../include/utils/lsyscache.h.html#LN117"><span class='Ref_to_Proto'>func_strict</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1113"><span class='Ref_To_Local'>optup</span></a><span class='Operator'>-&GT;</span>oprcode<span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1112"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1112"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end hash_ok_operator &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * SS_process_ctes: process a query's WITH list 
 * 
 * We plan each interesting WITH item and convert it to an initplan. 
 * A side effect is to fill in root-&GT;cte_plan_ids with a list that 
 * parallels root-&GT;parse-&GT;cteList and provides the subplan ID for 
 * each CTE's initplan. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1139"></a><span class='Declare_Function'>SS_process_ctes</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1141"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="subselect.c.html#LN1139"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN229"><span class='Ref_to_Member'>cte_plan_ids</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1141"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN1139"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN132"><span class='Ref_to_Member'>cteList</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1147"></a>        <a href="../../../include/nodes/parsenodes.h.html#LN1339"><span class='Ref_to_Struct'>CommonTableExpr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cte</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN1339"><span class='Ref_to_Struct'>CommonTableExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1141"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1148"></a>        <a href="../../../include/nodes/nodes.h.html#LN647"><span class='Ref_to_Enum'>CmdType</span></a>     <span class='Declare_Local'>cmdType</span> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN1147"><span class='Ref_To_Local'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1345"><span class='Ref_to_Member'>ctequery</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>commandType<span class='Delimiter'>; 
</span><a name="LN1149"></a>        <a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>subquery</span><span class='Delimiter'>; 
</span><a name="LN1150"></a>        <a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>subroot</span><span class='Delimiter'>; 
</span><a name="LN1151"></a>        <a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>final_rel</span><span class='Delimiter'>; 
</span><a name="LN1152"></a>        <a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>best_path</span><span class='Delimiter'>; 
</span><a name="LN1153"></a>        <a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>plan</span><span class='Delimiter'>; 
</span><a name="LN1154"></a>        <a href="../../../include/nodes/primnodes.h.html#LN678"><span class='Ref_to_Struct'>SubPlan</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>splan</span><span class='Delimiter'>; 
</span><a name="LN1155"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>paramid</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Ignore SELECT CTEs that are not actually referenced anywhere. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN1147"><span class='Ref_To_Local'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1349"><span class='Ref_to_Member'>cterefcount</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="subselect.c.html#LN1148"><span class='Ref_To_Local'>cmdType</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/nodes.h.html#LN650"><span class='Ref_to_EnumConst'>CMD_SELECT</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Make a dummy entry in cte_plan_ids */ 
</span>            <a href="subselect.c.html#LN1139"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN229"><span class='Ref_to_Member'>cte_plan_ids</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN144"><span class='Ref_to_Func'>lappend_int</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1139"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN229"><span class='Ref_to_Member'>cte_plan_ids</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Copy the source Query node.  Probably not necessary, but let's keep 
         * this similar to make_subplan. 
         */ 
</span>        <a href="subselect.c.html#LN1149"><span class='Ref_To_Local'>subquery</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1147"><span class='Ref_To_Local'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1345"><span class='Ref_to_Member'>ctequery</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* plan_params should not be in use in current query level */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="subselect.c.html#LN1139"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN168"><span class='Ref_to_Member'>plan_params</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Generate Paths for the CTE query.  Always plan for full retrieval 
         * --- we don't have enough info to predict otherwise. 
         */ 
</span>        <a href="subselect.c.html#LN1150"><span class='Ref_To_Local'>subroot</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/planner.h.html#LN39"><span class='Ref_to_Proto'>subquery_planner</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1139"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN1149"><span class='Ref_To_Local'>subquery</span></a><span class='Delimiter'>, 
</span>                                   <a href="subselect.c.html#LN1139"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                   <a href="subselect.c.html#LN1147"><span class='Ref_To_Local'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1348"><span class='Ref_to_Member'>cterecursive</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Since the current query level doesn't yet contain any RTEs, it 
         * should not be possible for the CTE to have requested parameters of 
         * this level. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN1139"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN168"><span class='Ref_to_Member'>plan_params</span></a><span class='Parentheses'>) 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected outer reference in CTE query"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Select best Path and turn it into a Plan.  At least for now, there 
         * seems no reason to postpone doing that. 
         */ 
</span>        <a href="subselect.c.html#LN1151"><span class='Ref_To_Local'>final_rel</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/pathnode.h.html#LN270"><span class='Ref_to_Proto'>fetch_upper_rel</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1150"><span class='Ref_To_Local'>subroot</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN77"><span class='Ref_to_EnumConst'>UPPERREL_FINAL</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="subselect.c.html#LN1152"><span class='Ref_To_Local'>best_path</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN1151"><span class='Ref_To_Local'>final_rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN542"><span class='Ref_to_Member'>cheapest_total_path</span></a><span class='Delimiter'>; 
</span> 
        <a href="subselect.c.html#LN1153"><span class='Ref_To_Local'>plan</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/planmain.h.html#LN49"><span class='Ref_to_Proto'>create_plan</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1150"><span class='Ref_To_Local'>subroot</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN1152"><span class='Ref_To_Local'>best_path</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Make a SubPlan node for it.  This is just enough unlike 
         * build_subplan that we can't share code. 
         * 
         * Note plan_id, plan_name, and cost fields are set further down. 
         */ 
</span>        <a href="subselect.c.html#LN1154"><span class='Ref_To_Local'>splan</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN678"><span class='Ref_to_Struct'>SubPlan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="subselect.c.html#LN1154"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN682"><span class='Ref_to_Member'>subLinkType</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/primnodes.h.html#LN625"><span class='Ref_to_EnumConst'>CTE_SUBLINK</span></a><span class='Delimiter'>; 
</span>        <a href="subselect.c.html#LN1154"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN684"><span class='Ref_to_Member'>testexpr</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="subselect.c.html#LN1154"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN685"><span class='Ref_to_Member'>paramIds</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>        <a href="subselect.c.html#LN428"><span class='Ref_to_Func'>get_first_col_type</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1153"><span class='Ref_To_Local'>plan</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="subselect.c.html#LN1154"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN691"><span class='Ref_to_Member'>firstColType</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="subselect.c.html#LN1154"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN692"><span class='Ref_to_Member'>firstColTypmod</span></a><span class='Delimiter'>, 
</span>                           <span class='Operator'>&</span><a href="subselect.c.html#LN1154"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN693"><span class='Ref_to_Member'>firstColCollation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="subselect.c.html#LN1154"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN696"><span class='Ref_to_Member'>useHashTable</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="subselect.c.html#LN1154"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN698"><span class='Ref_to_Member'>unknownEqFalse</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * CTE scans are not considered for parallelism (cf 
         * set_rel_consider_parallel), and even if they were, initPlans aren't 
         * parallel-safe. 
         */ 
</span>        <a href="subselect.c.html#LN1154"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN701"><span class='Ref_to_Member'>parallel_safe</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="subselect.c.html#LN1154"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN705"><span class='Ref_to_Member'>setParam</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>        <a href="subselect.c.html#LN1154"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN707"><span class='Ref_to_Member'>parParam</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>        <a href="subselect.c.html#LN1154"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN708"><span class='Ref_to_Member'>args</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * The node can't have any inputs (since it's an initplan), so the 
         * parParam and args lists remain empty.  (It could contain references 
         * to earlier CTEs' output param IDs, but CTE outputs are not 
         * propagated via the args list.) 
         */ 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Assign a param ID to represent the CTE's output.  No ordinary 
         * "evaluation" of this param slot ever happens, but we use the param 
         * ID for setParam/chgParam signaling just as if the CTE plan were 
         * returning a simple scalar output.  (Also, the executor abuses the 
         * ParamExecData slot for this param ID for communication among 
         * multiple CteScan nodes that might be scanning this CTE.) 
         */ 
</span>        <a href="subselect.c.html#LN1155"><span class='Ref_To_Local'>paramid</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/subselect.h.html#LN40"><span class='Ref_to_Proto'>SS_assign_special_param</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1139"><span class='Ref_to_Parameter'>root</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="subselect.c.html#LN1154"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN705"><span class='Ref_to_Member'>setParam</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN144"><span class='Ref_to_Macro'>list_make1_int</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1155"><span class='Ref_To_Local'>paramid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Add the subplan and its PlannerInfo to the global lists. 
         */ 
</span>        <a href="subselect.c.html#LN1139"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN97"><span class='Ref_to_Member'>subplans</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1139"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN97"><span class='Ref_to_Member'>subplans</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN1153"><span class='Ref_To_Local'>plan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="subselect.c.html#LN1139"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN99"><span class='Ref_to_Member'>subroots</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1139"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN99"><span class='Ref_to_Member'>subroots</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN1150"><span class='Ref_To_Local'>subroot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="subselect.c.html#LN1154"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN687"><span class='Ref_to_Member'>plan_id</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1139"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN97"><span class='Ref_to_Member'>subplans</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="subselect.c.html#LN1139"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN227"><span class='Ref_to_Member'>init_plans</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1139"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN227"><span class='Ref_to_Member'>init_plans</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN1154"><span class='Ref_To_Local'>splan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="subselect.c.html#LN1139"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN229"><span class='Ref_to_Member'>cte_plan_ids</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN144"><span class='Ref_to_Func'>lappend_int</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1139"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN229"><span class='Ref_to_Member'>cte_plan_ids</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN1154"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN687"><span class='Ref_to_Member'>plan_id</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Label the subplan for EXPLAIN purposes */ 
</span>        <a href="subselect.c.html#LN1154"><span class='Ref_To_Local'>splan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN689"><span class='Ref_to_Member'>plan_name</span></a> <span class='Operator'>= </span><a href="../../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"CTE %s"</span><span class='Delimiter'>, </span><a href="subselect.c.html#LN1147"><span class='Ref_To_Local'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1342"><span class='Ref_to_Member'>ctename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Lastly, fill in the cost estimates for use later */ 
</span>        <a href="../../../include/optimizer/cost.h.html#LN156"><span class='Ref_to_Proto'>cost_subplan</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1139"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN1154"><span class='Ref_To_Local'>splan</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN1153"><span class='Ref_To_Local'>plan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end SS_process_ctes &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * convert_ANY_sublink_to_join: try to convert an ANY SubLink to a join 
 * 
 * The caller has found an ANY SubLink at the top level of one of the query's 
 * qual clauses, but has not checked the properties of the SubLink further. 
 * Decide whether it is appropriate to process this SubLink in join style. 
 * If so, form a JoinExpr and return it.  Return NULL if the SubLink cannot 
 * be converted to a join. 
 * 
 * The only non-obvious input parameter is available_rels: this is the set 
 * of query rels that can safely be referenced in the sublink expression. 
 * (We must restrict this to avoid changing the semantics when a sublink 
 * is present in an outer join's ON qual.)  The conversion must fail if 
 * the converted qual would reference any but these parent-query relids. 
 * 
 * On success, the returned JoinExpr has larg = NULL and rarg = the jointree 
 * item representing the pulled-up subquery.  The caller must set larg to 
 * represent the relation(s) on the lefthand side of the new join, and insert 
 * the JoinExpr into the upper query's jointree at an appropriate place 
 * (typically, where the lefthand relation(s) had been).  Note that the 
 * passed-in SubLink must also be removed from its original position in the 
 * query quals, since the quals of the returned JoinExpr replace it. 
 * (Notionally, we replace the SubLink with a constant TRUE, then elide the 
 * redundant constant from the qual.) 
 * 
 * On success, the caller is also responsible for recursively applying 
 * pull_up_sublinks processing to the rarg and quals of the returned JoinExpr. 
 * (On failure, there is no need to do anything, since pull_up_sublinks will 
 * be applied when we recursively plan the sub-select.) 
 * 
 * Side effects of a successful conversion include adding the SubLink's 
 * subselect to the query's rangetable, so that it can be referenced in 
 * the JoinExpr's rarg. 
 */ 
</span><a href="../../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a> <span class='Operator'>* 
</span><a name="LN1298"></a><span class='Declare_Function'>convert_ANY_sublink_to_join</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN629"><span class='Ref_to_Struct'>SubLink</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>sublink</span><span class='Delimiter'>, 
</span><a name="LN1299"></a>                            <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>available_rels</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1301"></a>    <a href="../../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN1302"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>parse</span> <span class='Operator'>= </span><a href="subselect.c.html#LN1298"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Delimiter'>; 
</span><a name="LN1303"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>subselect</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN1298"><span class='Ref_to_Parameter'>sublink</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN636"><span class='Ref_to_Member'>subselect</span></a><span class='Delimiter'>; 
</span><a name="LN1304"></a>    <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a>      <span class='Declare_Local'>upper_varnos</span><span class='Delimiter'>; 
</span><a name="LN1305"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>rtindex</span><span class='Delimiter'>; 
</span><a name="LN1306"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rte</span><span class='Delimiter'>; 
</span><a name="LN1307"></a>    <a href="../../../include/nodes/primnodes.h.html#LN1415"><span class='Ref_to_Struct'>RangeTblRef</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rtr</span><span class='Delimiter'>; 
</span><a name="LN1308"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>subquery_vars</span><span class='Delimiter'>; 
</span><a name="LN1309"></a>    <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>quals</span><span class='Delimiter'>; 
</span><a name="LN1310"></a>    <a href="../../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pstate</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="subselect.c.html#LN1298"><span class='Ref_to_Parameter'>sublink</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN632"><span class='Ref_to_Member'>subLinkType</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/primnodes.h.html#LN620"><span class='Ref_to_EnumConst'>ANY_SUBLINK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The sub-select must not refer to any Vars of the parent query. (Vars of 
     * higher levels should be okay, though.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/optimizer/var.h.html#LN34"><span class='Ref_to_Proto'>contain_vars_of_level</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN1303"><span class='Ref_To_Local'>subselect</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The test expression must contain some Vars of the parent query, else 
     * it's not gonna be a join.  (Note that it won't have Vars referring to 
     * the subquery, rather Params.) 
     */ 
</span>    <a href="subselect.c.html#LN1304"><span class='Ref_To_Local'>upper_varnos</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/var.h.html#LN29"><span class='Ref_to_Proto'>pull_varnos</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1298"><span class='Ref_to_Parameter'>sublink</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN634"><span class='Ref_to_Member'>testexpr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/bitmapset.h.html#LN85"><span class='Ref_to_Proto'>bms_is_empty</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1304"><span class='Ref_To_Local'>upper_varnos</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * However, it can't refer to anything outside available_rels. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/bitmapset.h.html#LN73"><span class='Ref_to_Proto'>bms_is_subset</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1304"><span class='Ref_To_Local'>upper_varnos</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN1299"><span class='Ref_to_Parameter'>available_rels</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The combining operators and left-hand expressions mustn't be volatile. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/optimizer/clauses.h.html#LN60"><span class='Ref_to_Proto'>contain_volatile_functions</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1298"><span class='Ref_to_Parameter'>sublink</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN634"><span class='Ref_to_Member'>testexpr</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Create a dummy ParseState for addRangeTableEntryForSubquery */ 
</span>    <a href="subselect.c.html#LN1310"><span class='Ref_To_Local'>pstate</span></a> <span class='Operator'>= </span><a href="../../parser/parse_node.c.html#LN42"><span class='Ref_to_Func'>make_parsestate</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Okay, pull up the sub-select into upper range table. 
     * 
     * We rely here on the assumption that the outer query has no references 
     * to the inner (necessarily true, other than the Vars that we build 
     * below). Therefore this is a lot easier than what pull_up_subqueries has 
     * to go through. 
     */ 
</span>    <a href="subselect.c.html#LN1306"><span class='Ref_To_Local'>rte</span></a> <span class='Operator'>= </span><a href="../../../include/parser/parse_relation.h.html#LN74"><span class='Ref_to_Proto'>addRangeTableEntryForSubquery</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1310"><span class='Ref_To_Local'>pstate</span></a><span class='Delimiter'>, 
</span>                                        <a href="subselect.c.html#LN1303"><span class='Ref_To_Local'>subselect</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../../include/nodes/makefuncs.h.html#LN63"><span class='Ref_to_Proto'>makeAlias</span></a><span class='Parentheses'>(</span><span class='String'>"ANY_subquery"</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                        <span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                        <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN1302"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN134"><span class='Ref_to_Member'>rtable</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1302"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN134"><span class='Ref_to_Member'>rtable</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN1306"><span class='Ref_To_Local'>rte</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN1305"><span class='Ref_To_Local'>rtindex</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1302"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN134"><span class='Ref_to_Member'>rtable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Form a RangeTblRef for the pulled-up sub-select. 
     */ 
</span>    <a href="subselect.c.html#LN1307"><span class='Ref_To_Local'>rtr</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1415"><span class='Ref_to_Struct'>RangeTblRef</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN1307"><span class='Ref_To_Local'>rtr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1418"><span class='Ref_to_Member'>rtindex</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN1305"><span class='Ref_To_Local'>rtindex</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Build a list of Vars representing the subselect outputs. 
     */ 
</span>    <a href="subselect.c.html#LN1308"><span class='Ref_To_Local'>subquery_vars</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN63"><span class='Ref_to_Proto'>generate_subquery_vars</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1298"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                           <a href="subselect.c.html#LN1303"><span class='Ref_To_Local'>subselect</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN137"><span class='Ref_to_Member'>targetList</span></a><span class='Delimiter'>, 
</span>                                           <a href="subselect.c.html#LN1305"><span class='Ref_To_Local'>rtindex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Build the new join's qual expression, replacing Params with these Vars. 
     */ 
</span>    <a href="subselect.c.html#LN1309"><span class='Ref_To_Local'>quals</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN65"><span class='Ref_to_Proto'>convert_testexpr</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1298"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN1298"><span class='Ref_to_Parameter'>sublink</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN634"><span class='Ref_to_Member'>testexpr</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN1308"><span class='Ref_To_Local'>subquery_vars</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * And finally, build the JoinExpr node. 
     */ 
</span>    <a href="subselect.c.html#LN1301"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN1301"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1447"><span class='Ref_to_Member'>jointype</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN691"><span class='Ref_to_EnumConst'>JOIN_SEMI</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN1301"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1448"><span class='Ref_to_Member'>isNatural</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN1301"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1449"><span class='Ref_to_Member'>larg</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* caller must fill this in */ 
</span>    <a href="subselect.c.html#LN1301"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1450"><span class='Ref_to_Member'>rarg</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN1307"><span class='Ref_To_Local'>rtr</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN1301"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1451"><span class='Ref_to_Member'>usingClause</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN1301"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1452"><span class='Ref_to_Member'>quals</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN1309"><span class='Ref_To_Local'>quals</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN1301"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1453"><span class='Ref_to_Member'>alias</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN1301"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1454"><span class='Ref_to_Member'>rtindex</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* we don't need an RTE for it */ 
</span> 
    <span class='Control'>return</span> <a href="subselect.c.html#LN1301"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end convert_ANY_sublink_to_join &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * convert_EXISTS_sublink_to_join: try to convert an EXISTS SubLink to a join 
 * 
 * The API of this function is identical to convert_ANY_sublink_to_join's, 
 * except that we also support the case where the caller has found NOT EXISTS, 
 * so we need an additional input parameter "under_not". 
 */ 
</span><a href="../../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a> <span class='Operator'>* 
</span><a name="LN1403"></a><span class='Declare_Function'>convert_EXISTS_sublink_to_join</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN629"><span class='Ref_to_Struct'>SubLink</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>sublink</span><span class='Delimiter'>, 
</span><a name="LN1404"></a>                               <span class='Keyword'>bool </span><span class='Declare_Parameter'>under_not</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>available_rels</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1406"></a>    <a href="../../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN1407"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>parse</span> <span class='Operator'>= </span><a href="subselect.c.html#LN1403"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Delimiter'>; 
</span><a name="LN1408"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>subselect</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN1403"><span class='Ref_to_Parameter'>sublink</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN636"><span class='Ref_to_Member'>subselect</span></a><span class='Delimiter'>; 
</span><a name="LN1409"></a>    <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>whereClause</span><span class='Delimiter'>; 
</span><a name="LN1410"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>rtoffset</span><span class='Delimiter'>; 
</span><a name="LN1411"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>varno</span><span class='Delimiter'>; 
</span><a name="LN1412"></a>    <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a>      <span class='Declare_Local'>clause_varnos</span><span class='Delimiter'>; 
</span><a name="LN1413"></a>    <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a>      <span class='Declare_Local'>upper_varnos</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="subselect.c.html#LN1403"><span class='Ref_to_Parameter'>sublink</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN632"><span class='Ref_to_Member'>subLinkType</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/primnodes.h.html#LN618"><span class='Ref_to_EnumConst'>EXISTS_SUBLINK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Can't flatten if it contains WITH.  (We could arrange to pull up the 
     * WITH into the parent query's cteList, but that risks changing the 
     * semantics, since a WITH ought to be executed once per associated query 
     * call.)  Note that convert_ANY_sublink_to_join doesn't have to reject 
     * this case, since it just produces a subquery RTE that doesn't have to 
     * get flattened into the parent query. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN1408"><span class='Ref_To_Local'>subselect</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN132"><span class='Ref_to_Member'>cteList</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Copy the subquery so we can modify it safely (see comments in 
     * make_subplan). 
     */ 
</span>    <a href="subselect.c.html#LN1408"><span class='Ref_To_Local'>subselect</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1408"><span class='Ref_To_Local'>subselect</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * See if the subquery can be simplified based on the knowledge that it's 
     * being used in EXISTS().  If we aren't able to get rid of its 
     * targetlist, we have to fail, because the pullup operation leaves us 
     * with noplace to evaluate the targetlist. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="subselect.c.html#LN73"><span class='Ref_to_Proto'>simplify_EXISTS_query</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1403"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN1408"><span class='Ref_To_Local'>subselect</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The subquery must have a nonempty jointree, else we won't have a join. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN1408"><span class='Ref_To_Local'>subselect</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN135"><span class='Ref_to_Member'>jointree</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1469"><span class='Ref_to_Member'>fromlist</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Separate out the WHERE clause.  (We could theoretically also remove 
     * top-level plain JOIN/ON clauses, but it's probably not worth the 
     * trouble.) 
     */ 
</span>    <a href="subselect.c.html#LN1409"><span class='Ref_To_Local'>whereClause</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN1408"><span class='Ref_To_Local'>subselect</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN135"><span class='Ref_to_Member'>jointree</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1470"><span class='Ref_to_Member'>quals</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN1408"><span class='Ref_To_Local'>subselect</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN135"><span class='Ref_to_Member'>jointree</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1470"><span class='Ref_to_Member'>quals</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The rest of the sub-select must not refer to any Vars of the parent 
     * query.  (Vars of higher levels should be okay, though.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/optimizer/var.h.html#LN34"><span class='Ref_to_Proto'>contain_vars_of_level</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN1408"><span class='Ref_To_Local'>subselect</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * On the other hand, the WHERE clause must contain some Vars of the 
     * parent query, else it's not gonna be a join. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/optimizer/var.h.html#LN34"><span class='Ref_to_Proto'>contain_vars_of_level</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1409"><span class='Ref_To_Local'>whereClause</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We don't risk optimizing if the WHERE clause is volatile, either. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/optimizer/clauses.h.html#LN60"><span class='Ref_to_Proto'>contain_volatile_functions</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1409"><span class='Ref_To_Local'>whereClause</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Prepare to pull up the sub-select into top range table. 
     * 
     * We rely here on the assumption that the outer query has no references 
     * to the inner (necessarily true). Therefore this is a lot easier than 
     * what pull_up_subqueries has to go through. 
     * 
     * In fact, it's even easier than what convert_ANY_sublink_to_join has to 
     * do.  The machinations of simplify_EXISTS_query ensured that there is 
     * nothing interesting in the subquery except an rtable and jointree, and 
     * even the jointree FromExpr no longer has quals.  So we can just append 
     * the rtable to our own and use the FromExpr in our jointree. But first, 
     * adjust all level-zero varnos in the subquery to account for the rtable 
     * merger. 
     */ 
</span>    <a href="subselect.c.html#LN1410"><span class='Ref_To_Local'>rtoffset</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1407"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN134"><span class='Ref_to_Member'>rtable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/rewrite/rewriteManip.h.html#LN41"><span class='Ref_to_Proto'>OffsetVarNodes</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN1408"><span class='Ref_To_Local'>subselect</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN1410"><span class='Ref_To_Local'>rtoffset</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/rewrite/rewriteManip.h.html#LN41"><span class='Ref_to_Proto'>OffsetVarNodes</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1409"><span class='Ref_To_Local'>whereClause</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN1410"><span class='Ref_To_Local'>rtoffset</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Upper-level vars in subquery will now be one level closer to their 
     * parent than before; in particular, anything that had been level 1 
     * becomes level zero. 
     */ 
</span>    <a href="../../../include/rewrite/rewriteManip.h.html#LN44"><span class='Ref_to_Proto'>IncrementVarSublevelsUp</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN1408"><span class='Ref_To_Local'>subselect</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/rewrite/rewriteManip.h.html#LN44"><span class='Ref_to_Proto'>IncrementVarSublevelsUp</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1409"><span class='Ref_To_Local'>whereClause</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now that the WHERE clause is adjusted to match the parent query 
     * environment, we can easily identify all the level-zero rels it uses. 
     * The ones &LT;= rtoffset belong to the upper query; the ones &GT; rtoffset do 
     * not. 
     */ 
</span>    <a href="subselect.c.html#LN1412"><span class='Ref_To_Local'>clause_varnos</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/var.h.html#LN29"><span class='Ref_to_Proto'>pull_varnos</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1409"><span class='Ref_To_Local'>whereClause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN1413"><span class='Ref_To_Local'>upper_varnos</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="subselect.c.html#LN1411"><span class='Ref_To_Local'>varno</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN97"><span class='Ref_to_Proto'>bms_first_member</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1412"><span class='Ref_To_Local'>clause_varnos</span></a><span class='Parentheses'>))</span> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN1411"><span class='Ref_To_Local'>varno</span></a> <span class='Operator'>&LT;= </span><a href="subselect.c.html#LN1410"><span class='Ref_To_Local'>rtoffset</span></a><span class='Parentheses'>) 
</span>            <a href="subselect.c.html#LN1413"><span class='Ref_To_Local'>upper_varnos</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN89"><span class='Ref_to_Proto'>bms_add_member</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1413"><span class='Ref_To_Local'>upper_varnos</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN1411"><span class='Ref_To_Local'>varno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../../include/nodes/bitmapset.h.html#LN68"><span class='Ref_to_Proto'>bms_free</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1412"><span class='Ref_To_Local'>clause_varnos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/bitmapset.h.html#LN85"><span class='Ref_to_Proto'>bms_is_empty</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1413"><span class='Ref_To_Local'>upper_varnos</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now that we've got the set of upper-level varnos, we can make the last 
     * check: only available_rels can be referenced. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/bitmapset.h.html#LN73"><span class='Ref_to_Proto'>bms_is_subset</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1413"><span class='Ref_To_Local'>upper_varnos</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN1404"><span class='Ref_to_Parameter'>available_rels</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Now we can attach the modified subquery rtable to the parent */ 
</span>    <a href="subselect.c.html#LN1407"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN134"><span class='Ref_to_Member'>rtable</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1407"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN134"><span class='Ref_to_Member'>rtable</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN1408"><span class='Ref_To_Local'>subselect</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN134"><span class='Ref_to_Member'>rtable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * And finally, build the JoinExpr node. 
     */ 
</span>    <a href="subselect.c.html#LN1406"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN1406"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1447"><span class='Ref_to_Member'>jointype</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN1404"><span class='Ref_to_Parameter'>under_not</span></a> <span class='Operator'>? </span><a href="../../../include/nodes/nodes.h.html#LN692"><span class='Ref_to_EnumConst'>JOIN_ANTI</span></a> <span class='Operator'>: </span><a href="../../../include/nodes/nodes.h.html#LN691"><span class='Ref_to_EnumConst'>JOIN_SEMI</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN1406"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1448"><span class='Ref_to_Member'>isNatural</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN1406"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1449"><span class='Ref_to_Member'>larg</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* caller must fill this in */ 
</span>    <span class='Comment_Multi_Line'>/* flatten out the FromExpr node if it's useless */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1408"><span class='Ref_To_Local'>subselect</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN135"><span class='Ref_to_Member'>jointree</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1469"><span class='Ref_to_Member'>fromlist</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <a href="subselect.c.html#LN1406"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1450"><span class='Ref_to_Member'>rarg</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1408"><span class='Ref_To_Local'>subselect</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN135"><span class='Ref_to_Member'>jointree</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1469"><span class='Ref_to_Member'>fromlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="subselect.c.html#LN1406"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1450"><span class='Ref_to_Member'>rarg</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN1408"><span class='Ref_To_Local'>subselect</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN135"><span class='Ref_to_Member'>jointree</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN1406"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1451"><span class='Ref_to_Member'>usingClause</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN1406"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1452"><span class='Ref_to_Member'>quals</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN1409"><span class='Ref_To_Local'>whereClause</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN1406"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1453"><span class='Ref_to_Member'>alias</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN1406"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1454"><span class='Ref_to_Member'>rtindex</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* we don't need an RTE for it */ 
</span> 
    <span class='Control'>return</span> <a href="subselect.c.html#LN1406"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end convert_EXISTS_sublink_to_join &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * simplify_EXISTS_query: remove any useless stuff in an EXISTS's subquery 
 * 
 * The only thing that matters about an EXISTS query is whether it returns 
 * zero or more than zero rows.  Therefore, we can remove certain SQL features 
 * that won't affect that.  The only part that is really likely to matter in 
 * typical usage is simplifying the targetlist: it's a common habit to write 
 * "SELECT * FROM" even though there is no need to evaluate any columns. 
 * 
 * Note: by suppressing the targetlist we could cause an observable behavioral 
 * change, namely that any errors that might occur in evaluating the tlist 
 * won't occur, nor will other side-effects of volatile functions.  This seems 
 * unlikely to bother anyone in practice. 
 * 
 * Returns TRUE if was able to discard the targetlist, else FALSE. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1567"></a><span class='Declare_Function'>simplify_EXISTS_query</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>query</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * We don't try to simplify at all if the query uses set operations, 
     * aggregates, grouping sets, SRFs, modifying CTEs, HAVING, OFFSET, or FOR 
     * UPDATE/SHARE; none of these seem likely in normal usage and their 
     * possible effects are complex.  (Note: we could ignore an "OFFSET 0" 
     * clause, but that traditionally is used as an optimization fence, so we 
     * don't.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN1567"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN109"><span class='Ref_to_Member'>commandType</span></a> <span class='Operator'>!= </span><a href="../../../include/nodes/nodes.h.html#LN650"><span class='Ref_to_EnumConst'>CMD_SELECT</span></a> <span class='Operator'>|| 
</span>        <a href="subselect.c.html#LN1567"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN162"><span class='Ref_to_Member'>setOperations</span></a> <span class='Operator'>|| 
</span>        <a href="subselect.c.html#LN1567"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN122"><span class='Ref_to_Member'>hasAggs</span></a> <span class='Operator'>|| 
</span>        <a href="subselect.c.html#LN1567"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN147"><span class='Ref_to_Member'>groupingSets</span></a> <span class='Operator'>|| 
</span>        <a href="subselect.c.html#LN1567"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN123"><span class='Ref_to_Member'>hasWindowFuncs</span></a> <span class='Operator'>|| 
</span>        <a href="subselect.c.html#LN1567"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN124"><span class='Ref_to_Member'>hasTargetSRFs</span></a> <span class='Operator'>|| 
</span>        <a href="subselect.c.html#LN1567"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN128"><span class='Ref_to_Member'>hasModifyingCTE</span></a> <span class='Operator'>|| 
</span>        <a href="subselect.c.html#LN1567"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN149"><span class='Ref_to_Member'>havingQual</span></a> <span class='Operator'>|| 
</span>        <a href="subselect.c.html#LN1567"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN157"><span class='Ref_to_Member'>limitOffset</span></a> <span class='Operator'>|| 
</span>        <a href="subselect.c.html#LN1567"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN160"><span class='Ref_to_Member'>rowMarks</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * LIMIT with a constant positive (or NULL) value doesn't affect the 
     * semantics of EXISTS, so let's ignore such clauses.  This is worth doing 
     * because people accustomed to certain other DBMSes may be in the habit 
     * of writing EXISTS(SELECT ... LIMIT 1) as an optimization.  If there's a 
     * LIMIT with anything else as argument, though, we can't simplify. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN1567"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN158"><span class='Ref_to_Member'>limitCount</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * The LIMIT clause has not yet been through eval_const_expressions, 
         * so we have to apply that here.  It might seem like this is a waste 
         * of cycles, since the only case plausibly worth worrying about is 
         * "LIMIT 1" ... but what we'll actually see is "LIMIT int8(1::int4)", 
         * so we have to fold constants or we're not going to recognize it. 
         */ 
</span><a name="LN1605"></a>        <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>node</span> <span class='Operator'>= </span><a href="../../../include/optimizer/clauses.h.html#LN80"><span class='Ref_to_Proto'>eval_const_expressions</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1567"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN1567"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN158"><span class='Ref_to_Member'>limitCount</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1606"></a>        <a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>limit</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Might as well update the query if we simplified the clause. */ 
</span>        <a href="subselect.c.html#LN1567"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN158"><span class='Ref_to_Member'>limitCount</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN1605"><span class='Ref_To_Local'>node</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1605"><span class='Ref_To_Local'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <a href="subselect.c.html#LN1606"><span class='Ref_To_Local'>limit</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN1605"><span class='Ref_To_Local'>node</span></a><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="subselect.c.html#LN1606"><span class='Ref_To_Local'>limit</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN191"><span class='Ref_to_Member'>consttype</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN21"><span class='Ref_to_Const'>INT8OID</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="subselect.c.html#LN1606"><span class='Ref_To_Local'>limit</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN196"><span class='Ref_to_Member'>constisnull</span></a> <span class='Operator'>&& </span><a href="../../../include/postgres.h.html#LN610"><span class='Ref_to_Macro'>DatumGetInt64</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1606"><span class='Ref_To_Local'>limit</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN195"><span class='Ref_to_Member'>constvalue</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Whether or not the targetlist is safe, we can drop the LIMIT. */ 
</span>        <a href="subselect.c.html#LN1567"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN158"><span class='Ref_to_Member'>limitCount</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if query-&GT;limitCount &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Otherwise, we can throw away the targetlist, as well as any GROUP, 
     * WINDOW, DISTINCT, and ORDER BY clauses; none of those clauses will 
     * change a nonzero-rows result to zero rows or vice versa.  (Furthermore, 
     * since our parsetree representation of these clauses depends on the 
     * targetlist, we'd better throw them away if we drop the targetlist.) 
     */ 
</span>    <a href="subselect.c.html#LN1567"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN137"><span class='Ref_to_Member'>targetList</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN1567"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN145"><span class='Ref_to_Member'>groupClause</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN1567"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN151"><span class='Ref_to_Member'>windowClause</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN1567"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN153"><span class='Ref_to_Member'>distinctClause</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN1567"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN155"><span class='Ref_to_Member'>sortClause</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN1567"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN126"><span class='Ref_to_Member'>hasDistinctOn</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end simplify_EXISTS_query &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * convert_EXISTS_to_ANY: try to convert EXISTS to a hashable ANY sublink 
 * 
 * The subselect is expected to be a fresh copy that we can munge up, 
 * and to have been successfully passed through simplify_EXISTS_query. 
 * 
 * On success, the modified subselect is returned, and we store a suitable 
 * upper-level test expression at *testexpr, plus a list of the subselect's 
 * output Params at *paramIds.  (The test expression is already Param-ified 
 * and hence need not go through convert_testexpr, which is why we have to 
 * deal with the Param IDs specially.) 
 * 
 * On failure, returns NULL. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>* 
</span><a name="LN1655"></a><span class='Declare_Function'>convert_EXISTS_to_ANY</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>subselect</span><span class='Delimiter'>, 
</span><a name="LN1656"></a>                      <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>testexpr</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>paramIds</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1658"></a>    <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>whereClause</span><span class='Delimiter'>; 
</span><a name="LN1659"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>leftargs</span><span class='Delimiter'>, 
</span><a name="LN1660"></a>               <span class='Operator'>*</span><span class='Declare_Local'>rightargs</span><span class='Delimiter'>, 
</span><a name="LN1661"></a>               <span class='Operator'>*</span><span class='Declare_Local'>opids</span><span class='Delimiter'>, 
</span><a name="LN1662"></a>               <span class='Operator'>*</span><span class='Declare_Local'>opcollations</span><span class='Delimiter'>, 
</span><a name="LN1663"></a>               <span class='Operator'>*</span><span class='Declare_Local'>newWhere</span><span class='Delimiter'>, 
</span><a name="LN1664"></a>               <span class='Operator'>*</span><span class='Declare_Local'>tlist</span><span class='Delimiter'>, 
</span><a name="LN1665"></a>               <span class='Operator'>*</span><span class='Declare_Local'>testlist</span><span class='Delimiter'>, 
</span><a name="LN1666"></a>               <span class='Operator'>*</span><span class='Declare_Local'>paramids</span><span class='Delimiter'>; 
</span><a name="LN1667"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>, 
</span><a name="LN1668"></a>               <span class='Operator'>*</span><span class='Declare_Local'>rc</span><span class='Delimiter'>, 
</span><a name="LN1669"></a>               <span class='Operator'>*</span><span class='Declare_Local'>oc</span><span class='Delimiter'>, 
</span><a name="LN1670"></a>               <span class='Operator'>*</span><span class='Declare_Local'>cc</span><span class='Delimiter'>; 
</span><a name="LN1671"></a>    <a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>resno</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Query must not require a targetlist, since we have to insert a new one. 
     * Caller should have dealt with the case already. 
     */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="subselect.c.html#LN1655"><span class='Ref_to_Parameter'>subselect</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN137"><span class='Ref_to_Member'>targetList</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Separate out the WHERE clause.  (We could theoretically also remove 
     * top-level plain JOIN/ON clauses, but it's probably not worth the 
     * trouble.) 
     */ 
</span>    <a href="subselect.c.html#LN1658"><span class='Ref_To_Local'>whereClause</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN1655"><span class='Ref_to_Parameter'>subselect</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN135"><span class='Ref_to_Member'>jointree</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1470"><span class='Ref_to_Member'>quals</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN1655"><span class='Ref_to_Parameter'>subselect</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN135"><span class='Ref_to_Member'>jointree</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1470"><span class='Ref_to_Member'>quals</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The rest of the sub-select must not refer to any Vars of the parent 
     * query.  (Vars of higher levels should be okay, though.) 
     * 
     * Note: we need not check for Aggrefs separately because we know the 
     * sub-select is as yet unoptimized; any uplevel Aggref must therefore 
     * contain an uplevel Var reference.  This is not the case below ... 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/optimizer/var.h.html#LN34"><span class='Ref_to_Proto'>contain_vars_of_level</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN1655"><span class='Ref_to_Parameter'>subselect</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We don't risk optimizing if the WHERE clause is volatile, either. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/optimizer/clauses.h.html#LN60"><span class='Ref_to_Proto'>contain_volatile_functions</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1658"><span class='Ref_To_Local'>whereClause</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Clean up the WHERE clause by doing const-simplification etc on it. 
     * Aside from simplifying the processing we're about to do, this is 
     * important for being able to pull chunks of the WHERE clause up into the 
     * parent query.  Since we are invoked partway through the parent's 
     * preprocess_expression() work, earlier steps of preprocess_expression() 
     * wouldn't get applied to the pulled-up stuff unless we do them here. For 
     * the parts of the WHERE clause that get put back into the child query, 
     * this work is partially duplicative, but it shouldn't hurt. 
     * 
     * Note: we do not run flatten_join_alias_vars.  This is OK because any 
     * parent aliases were flattened already, and we're not going to pull any 
     * child Vars (of any description) into the parent. 
     * 
     * Note: passing the parent's root to eval_const_expressions is 
     * technically wrong, but we can get away with it since only the 
     * boundParams (if any) are used, and those would be the same in a 
     * subroot. 
     */ 
</span>    <a href="subselect.c.html#LN1658"><span class='Ref_To_Local'>whereClause</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/clauses.h.html#LN80"><span class='Ref_to_Proto'>eval_const_expressions</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1655"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN1658"><span class='Ref_To_Local'>whereClause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN1658"><span class='Ref_To_Local'>whereClause</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/optimizer/prep.h.html#LN35"><span class='Ref_to_Proto'>canonicalize_qual</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN1658"><span class='Ref_To_Local'>whereClause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN1658"><span class='Ref_To_Local'>whereClause</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/optimizer/clauses.h.html#LN46"><span class='Ref_to_Proto'>make_ands_implicit</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN1658"><span class='Ref_To_Local'>whereClause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We now have a flattened implicit-AND list of clauses, which we try to 
     * break apart into "outervar = innervar" hash clauses. Anything that 
     * can't be broken apart just goes back into the newWhere list.  Note that 
     * we aren't trying hard yet to ensure that we have only outer or only 
     * inner on each side; we'll check that if we get to the end. 
     */ 
</span>    <a href="subselect.c.html#LN1659"><span class='Ref_To_Local'>leftargs</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN1660"><span class='Ref_To_Local'>rightargs</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN1661"><span class='Ref_To_Local'>opids</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN1662"><span class='Ref_To_Local'>opcollations</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN1663"><span class='Ref_To_Local'>newWhere</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1667"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN1658"><span class='Ref_To_Local'>whereClause</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1737"></a>        <a href="../../../include/nodes/primnodes.h.html#LN491"><span class='Ref_to_Struct'>OpExpr</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>expr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN491"><span class='Ref_to_Struct'>OpExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1667"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1737"><span class='Ref_To_Local'>expr</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN491"><span class='Ref_to_Struct'>OpExpr</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>            <a href="subselect.c.html#LN72"><span class='Ref_to_Proto'>hash_ok_operator</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1737"><span class='Ref_To_Local'>expr</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN1742"></a>            <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>leftarg</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1737"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN500"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1743"></a>            <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>rightarg</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN115"><span class='Ref_to_Macro'>lsecond</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1737"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN500"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/optimizer/var.h.html#LN34"><span class='Ref_to_Proto'>contain_vars_of_level</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1742"><span class='Ref_To_Local'>leftarg</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="subselect.c.html#LN1659"><span class='Ref_To_Local'>leftargs</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1659"><span class='Ref_To_Local'>leftargs</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN1742"><span class='Ref_To_Local'>leftarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="subselect.c.html#LN1660"><span class='Ref_To_Local'>rightargs</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1660"><span class='Ref_To_Local'>rightargs</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN1743"><span class='Ref_To_Local'>rightarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="subselect.c.html#LN1661"><span class='Ref_To_Local'>opids</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1661"><span class='Ref_To_Local'>opids</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN1737"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN494"><span class='Ref_to_Member'>opno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="subselect.c.html#LN1662"><span class='Ref_To_Local'>opcollations</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1662"><span class='Ref_To_Local'>opcollations</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN1737"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN499"><span class='Ref_to_Member'>inputcollid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/optimizer/var.h.html#LN34"><span class='Ref_to_Proto'>contain_vars_of_level</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1743"><span class='Ref_To_Local'>rightarg</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * We must commute the clause to put the outer var on the 
                 * left, because the hashing code in nodeSubplan.c expects 
                 * that.  This probably shouldn't ever fail, since hashable 
                 * operators ought to have commutators, but be paranoid. 
                 */ 
</span>                <a href="subselect.c.html#LN1737"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN494"><span class='Ref_to_Member'>opno</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN106"><span class='Ref_to_Proto'>get_commutator</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1737"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN494"><span class='Ref_to_Member'>opno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1737"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN494"><span class='Ref_to_Member'>opno</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="subselect.c.html#LN72"><span class='Ref_to_Proto'>hash_ok_operator</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1737"><span class='Ref_To_Local'>expr</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="subselect.c.html#LN1659"><span class='Ref_To_Local'>leftargs</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1659"><span class='Ref_To_Local'>leftargs</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN1743"><span class='Ref_To_Local'>rightarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="subselect.c.html#LN1660"><span class='Ref_To_Local'>rightargs</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1660"><span class='Ref_To_Local'>rightargs</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN1742"><span class='Ref_To_Local'>leftarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="subselect.c.html#LN1661"><span class='Ref_To_Local'>opids</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1661"><span class='Ref_To_Local'>opids</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN1737"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN494"><span class='Ref_to_Member'>opno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="subselect.c.html#LN1662"><span class='Ref_To_Local'>opcollations</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1662"><span class='Ref_To_Local'>opcollations</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN1737"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN499"><span class='Ref_to_Member'>inputcollid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Comment_Multi_Line'>/* If no commutator, no chance to optimize the WHERE clause */ 
</span>                <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if contain_vars_of_level... &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IsA(expr,OpExpr)&&has... &raquo; </span> 
        <span class='Comment_Multi_Line'>/* Couldn't handle it as a hash clause */ 
</span>        <a href="subselect.c.html#LN1663"><span class='Ref_To_Local'>newWhere</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1663"><span class='Ref_To_Local'>newWhere</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN1737"><span class='Ref_To_Local'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we didn't find anything we could convert, fail. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN1659"><span class='Ref_To_Local'>leftargs</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * There mustn't be any parent Vars or Aggs in the stuff that we intend to 
     * put back into the child query.  Note: you might think we don't need to 
     * check for Aggs separately, because an uplevel Agg must contain an 
     * uplevel Var in its argument.  But it is possible that the uplevel Var 
     * got optimized away by eval_const_expressions.  Consider 
     * 
     * SUM(CASE WHEN false THEN uplevelvar ELSE 0 END) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/optimizer/var.h.html#LN34"><span class='Ref_to_Proto'>contain_vars_of_level</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN1663"><span class='Ref_To_Local'>newWhere</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span> <span class='Operator'>|| 
</span>        <a href="../../../include/optimizer/var.h.html#LN34"><span class='Ref_to_Proto'>contain_vars_of_level</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN1660"><span class='Ref_To_Local'>rightargs</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN1655"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN122"><span class='Ref_to_Member'>hasAggs</span></a> <span class='Operator'>&& 
</span>        <span class='Parentheses'>(</span><a href="../../../include/rewrite/rewriteManip.h.html#LN57"><span class='Ref_to_Proto'>contain_aggs_of_level</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN1663"><span class='Ref_To_Local'>newWhere</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span> <span class='Operator'>|| 
</span>         <a href="../../../include/rewrite/rewriteManip.h.html#LN57"><span class='Ref_to_Proto'>contain_aggs_of_level</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN1660"><span class='Ref_To_Local'>rightargs</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)))</span> 
        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * And there can't be any child Vars in the stuff we intend to pull up. 
     * (Note: we'd need to check for child Aggs too, except we know the child 
     * has no aggs at all because of simplify_EXISTS_query's check. The same 
     * goes for window functions.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/optimizer/var.h.html#LN34"><span class='Ref_to_Proto'>contain_vars_of_level</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN1659"><span class='Ref_To_Local'>leftargs</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Also reject sublinks in the stuff we intend to pull up.  (It might be 
     * possible to support this, but doesn't seem worth the complication.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/optimizer/clauses.h.html#LN57"><span class='Ref_to_Proto'>contain_subplans</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN1659"><span class='Ref_To_Local'>leftargs</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Okay, adjust the sublevelsup in the stuff we're pulling up. 
     */ 
</span>    <a href="../../../include/rewrite/rewriteManip.h.html#LN44"><span class='Ref_to_Proto'>IncrementVarSublevelsUp</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN1659"><span class='Ref_To_Local'>leftargs</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Put back any child-level-only WHERE clauses. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN1663"><span class='Ref_To_Local'>newWhere</span></a><span class='Parentheses'>) 
</span>        <a href="subselect.c.html#LN1655"><span class='Ref_to_Parameter'>subselect</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN135"><span class='Ref_to_Member'>jointree</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1470"><span class='Ref_to_Member'>quals</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/optimizer/clauses.h.html#LN45"><span class='Ref_to_Proto'>make_ands_explicit</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1663"><span class='Ref_To_Local'>newWhere</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Build a new targetlist for the child that emits the expressions we 
     * need.  Concurrently, build a testexpr for the parent using Params to 
     * reference the child outputs.  (Since we generate Params directly here, 
     * there will be no need to convert the testexpr in build_subplan.) 
     */ 
</span>    <a href="subselect.c.html#LN1664"><span class='Ref_To_Local'>tlist</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN1665"><span class='Ref_To_Local'>testlist</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN1666"><span class='Ref_To_Local'>paramids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN1671"><span class='Ref_To_Local'>resno</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* there's no "forfour" so we have to chase one of the lists manually */ 
</span>    <a href="subselect.c.html#LN1670"><span class='Ref_To_Local'>cc</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN75"><span class='Ref_to_Func'>list_head</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1662"><span class='Ref_To_Local'>opcollations</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN202"><span class='Ref_to_Macro'>forthree</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1667"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN1659"><span class='Ref_To_Local'>leftargs</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN1668"><span class='Ref_To_Local'>rc</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN1660"><span class='Ref_To_Local'>rightargs</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN1669"><span class='Ref_To_Local'>oc</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN1661"><span class='Ref_To_Local'>opids</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1840"></a>        <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>leftarg</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1667"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1841"></a>        <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>rightarg</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1668"><span class='Ref_To_Local'>rc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1842"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>opid</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1669"><span class='Ref_To_Local'>oc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1843"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>opcollation</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1670"><span class='Ref_To_Local'>cc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1844"></a>        <a href="../../../include/nodes/primnodes.h.html#LN240"><span class='Ref_to_Struct'>Param</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>param</span><span class='Delimiter'>; 
</span> 
        <a href="subselect.c.html#LN1670"><span class='Ref_To_Local'>cc</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1670"><span class='Ref_To_Local'>cc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="subselect.c.html#LN1844"><span class='Ref_To_Local'>param</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN388"><span class='Ref_to_Func'>generate_new_param</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1655"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                   <a href="../../../include/nodes/nodeFuncs.h.html#LN31"><span class='Ref_to_Proto'>exprType</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1841"><span class='Ref_To_Local'>rightarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                   <a href="../../../include/nodes/nodeFuncs.h.html#LN32"><span class='Ref_to_Proto'>exprTypmod</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1841"><span class='Ref_To_Local'>rightarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                   <a href="../../../include/nodes/nodeFuncs.h.html#LN38"><span class='Ref_to_Proto'>exprCollation</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1841"><span class='Ref_To_Local'>rightarg</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="subselect.c.html#LN1664"><span class='Ref_To_Local'>tlist</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1664"><span class='Ref_To_Local'>tlist</span></a><span class='Delimiter'>, 
</span>                        <a href="../../../include/nodes/makefuncs.h.html#LN40"><span class='Ref_to_Proto'>makeTargetEntry</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN1841"><span class='Ref_To_Local'>rightarg</span></a><span class='Delimiter'>, 
</span>                                        <a href="subselect.c.html#LN1671"><span class='Ref_To_Local'>resno</span></a><span class='Operator'>++</span><span class='Delimiter'>, 
</span>                                        <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                        <span class='Boolean'>false</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="subselect.c.html#LN1665"><span class='Ref_To_Local'>testlist</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1665"><span class='Ref_To_Local'>testlist</span></a><span class='Delimiter'>, 
</span>                           <a href="../../../include/optimizer/clauses.h.html#LN29"><span class='Ref_to_Proto'>make_opclause</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1842"><span class='Ref_To_Local'>opid</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN17"><span class='Ref_to_Const'>BOOLOID</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                         <span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN1840"><span class='Ref_To_Local'>leftarg</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN1844"><span class='Ref_To_Local'>param</span></a><span class='Delimiter'>, 
</span>                                         <a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN1843"><span class='Ref_To_Local'>opcollation</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="subselect.c.html#LN1666"><span class='Ref_To_Local'>paramids</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN144"><span class='Ref_to_Func'>lappend_int</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1666"><span class='Ref_To_Local'>paramids</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN1844"><span class='Ref_To_Local'>param</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN244"><span class='Ref_to_Member'>paramid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Put everything where it should go, and we're done */ 
</span>    <a href="subselect.c.html#LN1655"><span class='Ref_to_Parameter'>subselect</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN137"><span class='Ref_to_Member'>targetList</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN1664"><span class='Ref_To_Local'>tlist</span></a><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="subselect.c.html#LN1656"><span class='Ref_to_Parameter'>testexpr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/optimizer/clauses.h.html#LN45"><span class='Ref_to_Proto'>make_ands_explicit</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1665"><span class='Ref_To_Local'>testlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="subselect.c.html#LN1656"><span class='Ref_to_Parameter'>paramIds</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN1666"><span class='Ref_To_Local'>paramids</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="subselect.c.html#LN1655"><span class='Ref_to_Parameter'>subselect</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end convert_EXISTS_to_ANY &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Replace correlation vars (uplevel vars) with Params. 
 * 
 * Uplevel PlaceHolderVars and aggregates are replaced, too. 
 * 
 * Note: it is critical that this runs immediately after SS_process_sublinks. 
 * Since we do not recurse into the arguments of uplevel PHVs and aggregates, 
 * they will get copied to the appropriate subplan args list in the parent 
 * query with uplevel vars not replaced by Params, but only adjusted in level 
 * (see replace_outer_placeholdervar and replace_outer_agg).  That's exactly 
 * what we want for the vars of the parent level --- but if a PHV's or 
 * aggregate's argument contains any further-up variables, they have to be 
 * replaced with Params in their turn. That will happen when the parent level 
 * runs SS_replace_correlation_vars.  Therefore it must do so after expanding 
 * its sublinks to subplans.  And we don't want any steps in between, else 
 * those steps would never get applied to the argument expressions, either in 
 * the parent or the child level. 
 * 
 * Another fairly tricky thing going on here is the handling of SubLinks in 
 * the arguments of uplevel PHVs/aggregates.  Those are not touched inside the 
 * intermediate query level, either.  Instead, SS_process_sublinks recurses on 
 * them after copying the PHV or Aggref expression into the parent plan level 
 * (this is actually taken care of in build_subplan). 
 */ 
</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>* 
</span><a name="LN1897"></a><span class='Declare_Function'>SS_replace_correlation_vars</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>expr</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* No setup needed for tree walk, so away we go */ 
</span>    <span class='Control'>return</span> <a href="subselect.c.html#LN76"><span class='Ref_to_Proto'>replace_correlation_vars_mutator</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1897"><span class='Ref_to_Parameter'>expr</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN1897"><span class='Ref_to_Parameter'>root</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>* 
</span><a name="LN1904"></a><span class='Declare_Function'>replace_correlation_vars_mutator</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN1904"><span class='Ref_to_Parameter'>node</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1904"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(((</span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN1904"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>varlevelsup <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN143"><span class='Ref_to_Func'>replace_outer_var</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1904"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN1904"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1904"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN1846"><span class='Ref_to_Struct'>PlaceHolderVar</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(((</span><a href="../../../include/nodes/relation.h.html#LN1846"><span class='Ref_to_Struct'>PlaceHolderVar</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN1904"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>phlevelsup <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN248"><span class='Ref_to_Func'>replace_outer_placeholdervar</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1904"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                                    <span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1846"><span class='Ref_to_Struct'>PlaceHolderVar</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN1904"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1904"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN290"><span class='Ref_to_Struct'>Aggref</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(((</span><a href="../../../include/nodes/primnodes.h.html#LN290"><span class='Ref_to_Struct'>Aggref</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN1904"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>agglevelsup <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN301"><span class='Ref_to_Func'>replace_outer_agg</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1904"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN290"><span class='Ref_to_Struct'>Aggref</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN1904"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1904"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN337"><span class='Ref_to_Struct'>GroupingFunc</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(((</span><a href="../../../include/nodes/primnodes.h.html#LN337"><span class='Ref_to_Struct'>GroupingFunc</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN1904"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>agglevelsup <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN343"><span class='Ref_to_Func'>replace_outer_grouping</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1904"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN337"><span class='Ref_to_Struct'>GroupingFunc</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN1904"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="../../../include/nodes/nodeFuncs.h.html#LN54"><span class='Ref_to_Proto'>expression_tree_mutator</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1904"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, 
</span>                                   <a href="subselect.c.html#LN76"><span class='Ref_to_Proto'>replace_correlation_vars_mutator</span></a><span class='Delimiter'>, 
</span>                                   <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN1904"><span class='Ref_to_Parameter'>root</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end replace_correlation_vars_mutator &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Expand SubLinks to SubPlans in the given expression. 
 * 
 * The isQual argument tells whether or not this expression is a WHERE/HAVING 
 * qualifier expression.  If it is, any sublinks appearing at top level need 
 * not distinguish FALSE from UNKNOWN return values. 
 */ 
</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>* 
</span><a name="LN1942"></a><span class='Declare_Function'>SS_process_sublinks</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>expr</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isQual</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1944"></a>    <a href="subselect.c.html#LN43"><span class='Ref_to_Struct'>process_sublinks_context</span></a> <span class='Declare_Local'>context</span><span class='Delimiter'>; 
</span> 
    <a href="subselect.c.html#LN1944"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN45"><span class='Ref_to_Member'>root</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN1942"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN1944"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN46"><span class='Ref_to_Member'>isTopQual</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN1942"><span class='Ref_to_Parameter'>isQual</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="subselect.c.html#LN77"><span class='Ref_to_Proto'>process_sublinks_mutator</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1942"><span class='Ref_to_Parameter'>expr</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="subselect.c.html#LN1944"><span class='Ref_To_Local'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>* 
</span><a name="LN1952"></a><span class='Declare_Function'>process_sublinks_mutator</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><a href="subselect.c.html#LN43"><span class='Ref_to_Struct'>process_sublinks_context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1954"></a>    <a href="subselect.c.html#LN43"><span class='Ref_to_Struct'>process_sublinks_context</span></a> <span class='Declare_Local'>locContext</span><span class='Delimiter'>; 
</span> 
    <a href="subselect.c.html#LN1954"><span class='Ref_To_Local'>locContext</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN45"><span class='Ref_to_Member'>root</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN1952"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="subselect.c.html#LN45"><span class='Ref_to_Member'>root</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN1952"><span class='Ref_to_Parameter'>node</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1952"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN629"><span class='Ref_to_Struct'>SubLink</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1962"></a>        <a href="../../../include/nodes/primnodes.h.html#LN629"><span class='Ref_to_Struct'>SubLink</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>sublink</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN629"><span class='Ref_to_Struct'>SubLink</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN1952"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span><a name="LN1963"></a>        <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>testexpr</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * First, recursively process the lefthand-side expressions, if any. 
         * They're not top-level anymore. 
         */ 
</span>        <a href="subselect.c.html#LN1954"><span class='Ref_To_Local'>locContext</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN46"><span class='Ref_to_Member'>isTopQual</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="subselect.c.html#LN1963"><span class='Ref_To_Local'>testexpr</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN77"><span class='Ref_to_Proto'>process_sublinks_mutator</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1962"><span class='Ref_To_Local'>sublink</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN634"><span class='Ref_to_Member'>testexpr</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="subselect.c.html#LN1954"><span class='Ref_To_Local'>locContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Now build the SubPlan node and make the expr to return. 
         */ 
</span>        <span class='Control'>return</span> <a href="subselect.c.html#LN472"><span class='Ref_to_Func'>make_subplan</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1952"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="subselect.c.html#LN45"><span class='Ref_to_Member'>root</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN1962"><span class='Ref_To_Local'>sublink</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN636"><span class='Ref_to_Member'>subselect</span></a><span class='Delimiter'>, 
</span>                            <a href="subselect.c.html#LN1962"><span class='Ref_To_Local'>sublink</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN632"><span class='Ref_to_Member'>subLinkType</span></a><span class='Delimiter'>, 
</span>                            <a href="subselect.c.html#LN1962"><span class='Ref_To_Local'>sublink</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN633"><span class='Ref_to_Member'>subLinkId</span></a><span class='Delimiter'>, 
</span>                            <a href="subselect.c.html#LN1963"><span class='Ref_To_Local'>testexpr</span></a><span class='Delimiter'>, 
</span>                            <a href="subselect.c.html#LN1952"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="subselect.c.html#LN46"><span class='Ref_to_Member'>isTopQual</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IsA(node,SubLink) &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Don't recurse into the arguments of an outer PHV or aggregate here. Any 
     * SubLinks in the arguments have to be dealt with at the outer query 
     * level; they'll be handled when build_subplan collects the PHV or Aggref 
     * into the arguments to be passed down to the current subplan. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1952"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN1846"><span class='Ref_to_Struct'>PlaceHolderVar</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(((</span><a href="../../../include/nodes/relation.h.html#LN1846"><span class='Ref_to_Struct'>PlaceHolderVar</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN1952"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>phlevelsup <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <a href="subselect.c.html#LN1952"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1952"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN290"><span class='Ref_to_Struct'>Aggref</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(((</span><a href="../../../include/nodes/primnodes.h.html#LN290"><span class='Ref_to_Struct'>Aggref</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN1952"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>agglevelsup <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <a href="subselect.c.html#LN1952"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We should never see a SubPlan expression in the input (since this is 
     * the very routine that creates 'em to begin with).  We shouldn't find 
     * ourselves invoked directly on a Query, either. 
     */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1952"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN678"><span class='Ref_to_Struct'>SubPlan</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1952"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN722"><span class='Ref_to_Struct'>AlternativeSubPlan</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1952"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Because make_subplan() could return an AND or OR clause, we have to 
     * take steps to preserve AND/OR flatness of a qual.  We assume the input 
     * has been AND/OR flattened and so we need no recursion here. 
     * 
     * (Due to the coding here, we will not get called on the List subnodes of 
     * an AND; and the input is *not* yet in implicit-AND format.  So no check 
     * is needed for a bare List.) 
     * 
     * Anywhere within the top-level AND/OR clause structure, we can tell 
     * make_subplan() that NULL and FALSE are interchangeable.  So isTopQual 
     * propagates down in both cases.  (Note that this is unlike the meaning 
     * of "top level qual" used in most other places in Postgres.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/optimizer/clauses.h.html#LN42"><span class='Ref_to_Proto'>and_clause</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1952"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2025"></a>        <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>newargs</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN2026"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Still at qual top-level */ 
</span>        <a href="subselect.c.html#LN1954"><span class='Ref_To_Local'>locContext</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN46"><span class='Ref_to_Member'>isTopQual</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN1952"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="subselect.c.html#LN46"><span class='Ref_to_Member'>isTopQual</span></a><span class='Delimiter'>; 
</span> 
        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2026"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN557"><span class='Ref_to_Struct'>BoolExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN1952"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>args<span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><a name="LN2033"></a>            <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>newarg</span><span class='Delimiter'>; 
</span> 
            <a href="subselect.c.html#LN2033"><span class='Ref_To_Local'>newarg</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN77"><span class='Ref_to_Proto'>process_sublinks_mutator</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2026"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="subselect.c.html#LN1954"><span class='Ref_To_Local'>locContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/optimizer/clauses.h.html#LN42"><span class='Ref_to_Proto'>and_clause</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2033"><span class='Ref_To_Local'>newarg</span></a><span class='Parentheses'>))</span> 
                <a href="subselect.c.html#LN2025"><span class='Ref_To_Local'>newargs</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2025"><span class='Ref_To_Local'>newargs</span></a><span class='Delimiter'>, </span><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN557"><span class='Ref_to_Struct'>BoolExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2033"><span class='Ref_To_Local'>newarg</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>args<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="subselect.c.html#LN2025"><span class='Ref_To_Local'>newargs</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2025"><span class='Ref_To_Local'>newargs</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2033"><span class='Ref_To_Local'>newarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/optimizer/clauses.h.html#LN43"><span class='Ref_to_Proto'>make_andclause</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2025"><span class='Ref_To_Local'>newargs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if and_clause(node) &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/optimizer/clauses.h.html#LN39"><span class='Ref_to_Proto'>or_clause</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1952"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2046"></a>        <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>newargs</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN2047"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Still at qual top-level */ 
</span>        <a href="subselect.c.html#LN1954"><span class='Ref_To_Local'>locContext</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN46"><span class='Ref_to_Member'>isTopQual</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN1952"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="subselect.c.html#LN46"><span class='Ref_to_Member'>isTopQual</span></a><span class='Delimiter'>; 
</span> 
        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2047"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN557"><span class='Ref_to_Struct'>BoolExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN1952"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>args<span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><a name="LN2054"></a>            <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>newarg</span><span class='Delimiter'>; 
</span> 
            <a href="subselect.c.html#LN2054"><span class='Ref_To_Local'>newarg</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN77"><span class='Ref_to_Proto'>process_sublinks_mutator</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2047"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="subselect.c.html#LN1954"><span class='Ref_To_Local'>locContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/optimizer/clauses.h.html#LN39"><span class='Ref_to_Proto'>or_clause</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2054"><span class='Ref_To_Local'>newarg</span></a><span class='Parentheses'>))</span> 
                <a href="subselect.c.html#LN2046"><span class='Ref_To_Local'>newargs</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2046"><span class='Ref_To_Local'>newargs</span></a><span class='Delimiter'>, </span><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN557"><span class='Ref_to_Struct'>BoolExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2054"><span class='Ref_To_Local'>newarg</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>args<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="subselect.c.html#LN2046"><span class='Ref_To_Local'>newargs</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2046"><span class='Ref_To_Local'>newargs</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2054"><span class='Ref_To_Local'>newarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/optimizer/clauses.h.html#LN40"><span class='Ref_to_Proto'>make_orclause</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2046"><span class='Ref_To_Local'>newargs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if or_clause(node) &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * If we recurse down through anything other than an AND or OR node, we 
     * are definitely not at top qual level anymore. 
     */ 
</span>    <a href="subselect.c.html#LN1954"><span class='Ref_To_Local'>locContext</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN46"><span class='Ref_to_Member'>isTopQual</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../../include/nodes/nodeFuncs.h.html#LN54"><span class='Ref_to_Proto'>expression_tree_mutator</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN1952"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, 
</span>                                   <a href="subselect.c.html#LN77"><span class='Ref_to_Proto'>process_sublinks_mutator</span></a><span class='Delimiter'>, 
</span>                                   <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="subselect.c.html#LN1954"><span class='Ref_To_Local'>locContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end process_sublinks_mutator &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * SS_identify_outer_params - identify the Params available from outer levels 
 * 
 * This must be run after SS_replace_correlation_vars and SS_process_sublinks 
 * processing is complete in a given query level as well as all of its 
 * descendant levels (which means it's most practical to do it at the end of 
 * processing the query level).  We compute the set of paramIds that outer 
 * levels will make available to this level+descendants, and record it in 
 * root-&GT;outer_params for use while computing extParam/allParam sets in final 
 * plan cleanup.  (We can't just compute it then, because the upper levels' 
 * plan_params lists are transient and will be gone by then.) 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN2089"></a><span class='Declare_Function'>SS_identify_outer_params</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2091"></a>    <a href="../../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>outer_params</span><span class='Delimiter'>; 
</span><a name="LN2092"></a>    <a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>proot</span><span class='Delimiter'>; 
</span><a name="LN2093"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If no parameters have been assigned anywhere in the tree, we certainly 
     * don't need to do anything here. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN2089"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN116"><span class='Ref_to_Member'>nParamExec</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Scan all query levels above this one to see which parameters are due to 
     * be available from them, either because lower query levels have 
     * requested them (via plan_params) or because they will be available from 
     * initPlans of those levels. 
     */ 
</span>    <a href="subselect.c.html#LN2091"><span class='Ref_To_Local'>outer_params</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN2092"><span class='Ref_To_Local'>proot</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN2089"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN160"><span class='Ref_to_Member'>parent_root</span></a><span class='Delimiter'>; </span><a href="subselect.c.html#LN2092"><span class='Ref_To_Local'>proot</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><a href="subselect.c.html#LN2092"><span class='Ref_To_Local'>proot</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN2092"><span class='Ref_To_Local'>proot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN160"><span class='Ref_to_Member'>parent_root</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Include ordinary Var/PHV/Aggref params */ 
</span>        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2093"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2092"><span class='Ref_To_Local'>proot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN168"><span class='Ref_to_Member'>plan_params</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2114"></a>            <a href="../../../include/nodes/relation.h.html#LN2134"><span class='Ref_to_Struct'>PlannerParamItem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pitem</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN2134"><span class='Ref_to_Struct'>PlannerParamItem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2093"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="subselect.c.html#LN2091"><span class='Ref_To_Local'>outer_params</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN89"><span class='Ref_to_Proto'>bms_add_member</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2091"><span class='Ref_To_Local'>outer_params</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2114"><span class='Ref_To_Local'>pitem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN2139"><span class='Ref_to_Member'>paramId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* Include any outputs of outer-level initPlans */ 
</span>        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2093"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2092"><span class='Ref_To_Local'>proot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN227"><span class='Ref_to_Member'>init_plans</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2121"></a>            <a href="../../../include/nodes/primnodes.h.html#LN678"><span class='Ref_to_Struct'>SubPlan</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>initsubplan</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN678"><span class='Ref_to_Struct'>SubPlan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2093"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2122"></a>            <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l2</span><span class='Delimiter'>; 
</span> 
            <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2122"><span class='Ref_To_Local'>l2</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2121"><span class='Ref_To_Local'>initsubplan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN705"><span class='Ref_to_Member'>setParam</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="subselect.c.html#LN2091"><span class='Ref_To_Local'>outer_params</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN89"><span class='Ref_to_Proto'>bms_add_member</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2091"><span class='Ref_To_Local'>outer_params</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN106"><span class='Ref_to_Macro'>lfirst_int</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2122"><span class='Ref_To_Local'>l2</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* Include worktable ID, if a recursive query is being planned */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN2092"><span class='Ref_To_Local'>proot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN307"><span class='Ref_to_Member'>wt_param_id</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="subselect.c.html#LN2091"><span class='Ref_To_Local'>outer_params</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN89"><span class='Ref_to_Proto'>bms_add_member</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2091"><span class='Ref_To_Local'>outer_params</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2092"><span class='Ref_To_Local'>proot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN307"><span class='Ref_to_Member'>wt_param_id</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for proot=root-&GT;parent_ro... &raquo; </span> 
    <a href="subselect.c.html#LN2089"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN169"><span class='Ref_to_Member'>outer_params</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN2091"><span class='Ref_To_Local'>outer_params</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end SS_identify_outer_params &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * SS_charge_for_initplans - account for initplans in Path costs & parallelism 
 * 
 * If any initPlans have been created in the current query level, they will 
 * get attached to the Plan tree created from whichever Path we select from 
 * the given rel.  Increment all that rel's Paths' costs to account for them, 
 * and make sure the paths get marked as parallel-unsafe, since we can't 
 * currently transmit initPlans to parallel workers. 
 * 
 * This is separate from SS_attach_initplans because we might conditionally 
 * create more initPlans during create_plan(), depending on which Path we 
 * select.  However, Paths that would generate such initPlans are expected 
 * to have included their cost already. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN2151"></a><span class='Declare_Function'>SS_charge_for_initplans</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>final_rel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2153"></a>    <a href="../../../include/nodes/nodes.h.html#LN638"><span class='Ref_to_Typedef'>Cost</span></a>        <span class='Declare_Local'>initplan_cost</span><span class='Delimiter'>; 
</span><a name="LN2154"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Nothing to do if no initPlans */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN2151"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN227"><span class='Ref_to_Member'>init_plans</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Compute the cost increment just once, since it will be the same for all 
     * Paths.  We assume each initPlan gets run once during top plan startup. 
     * This is a conservative overestimate, since in fact an initPlan might be 
     * executed later than plan startup, or even not at all. 
     */ 
</span>    <a href="subselect.c.html#LN2153"><span class='Ref_To_Local'>initplan_cost</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2154"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2151"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN227"><span class='Ref_to_Member'>init_plans</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2169"></a>        <a href="../../../include/nodes/primnodes.h.html#LN678"><span class='Ref_to_Struct'>SubPlan</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>initsubplan</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN678"><span class='Ref_to_Struct'>SubPlan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2154"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="subselect.c.html#LN2153"><span class='Ref_To_Local'>initplan_cost</span></a> <span class='Operator'>+= </span><a href="subselect.c.html#LN2169"><span class='Ref_To_Local'>initsubplan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN710"><span class='Ref_to_Member'>startup_cost</span></a> <span class='Operator'>+ </span><a href="subselect.c.html#LN2169"><span class='Ref_To_Local'>initsubplan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN711"><span class='Ref_to_Member'>per_call_cost</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now adjust the costs and parallel_safe flags. 
     */ 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2154"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2151"><span class='Ref_to_Parameter'>final_rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN538"><span class='Ref_to_Member'>pathlist</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2179"></a>        <a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>path</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2154"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="subselect.c.html#LN2179"><span class='Ref_To_Local'>path</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN964"><span class='Ref_to_Member'>startup_cost</span></a> <span class='Operator'>+= </span><a href="subselect.c.html#LN2153"><span class='Ref_To_Local'>initplan_cost</span></a><span class='Delimiter'>; 
</span>        <a href="subselect.c.html#LN2179"><span class='Ref_To_Local'>path</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN965"><span class='Ref_to_Member'>total_cost</span></a> <span class='Operator'>+= </span><a href="subselect.c.html#LN2153"><span class='Ref_To_Local'>initplan_cost</span></a><span class='Delimiter'>; 
</span>        <a href="subselect.c.html#LN2179"><span class='Ref_To_Local'>path</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN958"><span class='Ref_to_Member'>parallel_safe</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* We needn't do set_cheapest() here, caller will do it */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end SS_charge_for_initplans &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * SS_attach_initplans - attach initplans to topmost plan node 
 * 
 * Attach any initplans created in the current query level to the specified 
 * plan node, which should normally be the topmost node for the query level. 
 * (In principle the initPlans could go in any node at or above where they're 
 * referenced; but there seems no reason to put them any lower than the 
 * topmost node, so we don't bother to track exactly where they came from.) 
 * We do not touch the plan node's cost; the initplans should have been 
 * accounted for in path costing. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN2201"></a><span class='Declare_Function'>SS_attach_initplans</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>plan</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="subselect.c.html#LN2201"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN147"><span class='Ref_to_Member'>initPlan</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN2201"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN227"><span class='Ref_to_Member'>init_plans</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * SS_finalize_plan - do final parameter processing for a completed Plan. 
 * 
 * This recursively computes the extParam and allParam sets for every Plan 
 * node in the given plan tree.  (Oh, and RangeTblFunction.funcparams too.) 
 * 
 * We assume that SS_finalize_plan has already been run on any initplans or 
 * subplans the plan tree could reference. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN2216"></a><span class='Declare_Function'>SS_finalize_plan</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>plan</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* No setup needed, just recurse through plan tree. */ 
</span>    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN79"><span class='Ref_to_Proto'>finalize_plan</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2216"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2216"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2216"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN169"><span class='Ref_to_Member'>outer_params</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Recursive processing of all nodes in the plan tree 
 * 
 * valid_params is the set of param IDs supplied by outer plan levels 
 * that are valid to reference in this plan node or its children. 
 * 
 * scan_params is a set of param IDs to force scan plan nodes to reference. 
 * This is for EvalPlanQual support, and is always NULL at the top of the 
 * recursion. 
 * 
 * The return value is the computed allParam set for the given Plan node. 
 * This is just an internal notational convenience: we can add a child 
 * plan's allParams to the set of param IDs of interest to this level 
 * in the same statement that recurses to that child. 
 * 
 * Do not scribble on caller's values of valid_params or scan_params! 
 * 
 * Note: although we attempt to deal with initPlans anywhere in the tree, the 
 * logic is not really right.  The problem is that a plan node might return an 
 * output Param of its initPlan as a targetlist item, in which case it's valid 
 * for the parent plan level to reference that same Param; the parent's usage 
 * will be converted into a Var referencing the child plan node by setrefs.c. 
 * But this function would see the parent's reference as out of scope and 
 * complain about it.  For now, this does not matter because the planner only 
 * attaches initPlans to the topmost plan node in a query level, so the case 
 * doesn't arise.  If we ever merge this processing into setrefs.c, maybe it 
 * can be handled more cleanly. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a> <span class='Operator'>* 
</span><a name="LN2251"></a><span class='Declare_Function'>finalize_plan</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>plan</span><span class='Delimiter'>, </span><a href="../../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>valid_params</span><span class='Delimiter'>, 
</span><a name="LN2252"></a>              <a href="../../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>scan_params</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2254"></a>    <a href="subselect.c.html#LN49"><span class='Ref_to_Struct'>finalize_primnode_context</span></a> <span class='Declare_Local'>context</span><span class='Delimiter'>; 
</span><a name="LN2255"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>locally_added_param</span><span class='Delimiter'>; 
</span><a name="LN2256"></a>    <a href="../../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>nestloop_params</span><span class='Delimiter'>; 
</span><a name="LN2257"></a>    <a href="../../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>initExtParam</span><span class='Delimiter'>; 
</span><a name="LN2258"></a>    <a href="../../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>initSetParam</span><span class='Delimiter'>; 
</span><a name="LN2259"></a>    <a href="../../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>child_params</span><span class='Delimiter'>; 
</span><a name="LN2260"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN51"><span class='Ref_to_Member'>root</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* initialize set to empty */ 
</span>    <a href="subselect.c.html#LN2255"><span class='Ref_To_Local'>locally_added_param</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* there isn't one */ 
</span>    <a href="subselect.c.html#LN2256"><span class='Ref_To_Local'>nestloop_params</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* there aren't any */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Examine any initPlans to determine the set of external params they 
     * reference and the set of output params they supply.  (We assume 
     * SS_finalize_plan was run on them already.) 
     */ 
</span>    <a href="subselect.c.html#LN2257"><span class='Ref_To_Local'>initExtParam</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN2258"><span class='Ref_To_Local'>initSetParam</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2260"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN147"><span class='Ref_to_Member'>initPlan</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2278"></a>        <a href="../../../include/nodes/primnodes.h.html#LN678"><span class='Ref_to_Struct'>SubPlan</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>initsubplan</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN678"><span class='Ref_to_Struct'>SubPlan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2260"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2279"></a>        <a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>initplan</span> <span class='Operator'>= </span><a href="../../../include/nodes/relation.h.html#LN136"><span class='Ref_to_Macro'>planner_subplan_get_plan</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2278"><span class='Ref_To_Local'>initsubplan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2280"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l2</span><span class='Delimiter'>; 
</span> 
        <a href="subselect.c.html#LN2257"><span class='Ref_To_Local'>initExtParam</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN91"><span class='Ref_to_Proto'>bms_add_members</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2257"><span class='Ref_To_Local'>initExtParam</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2279"><span class='Ref_To_Local'>initplan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN161"><span class='Ref_to_Member'>extParam</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2280"><span class='Ref_To_Local'>l2</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2278"><span class='Ref_To_Local'>initsubplan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN705"><span class='Ref_to_Member'>setParam</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="subselect.c.html#LN2258"><span class='Ref_To_Local'>initSetParam</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN89"><span class='Ref_to_Proto'>bms_add_member</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2258"><span class='Ref_To_Local'>initSetParam</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN106"><span class='Ref_to_Macro'>lfirst_int</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2280"><span class='Ref_To_Local'>l2</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Any setParams are validly referenceable in this node and children */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN2258"><span class='Ref_To_Local'>initSetParam</span></a><span class='Parentheses'>) 
</span>        <a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>valid_params</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN70"><span class='Ref_to_Proto'>bms_union</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>valid_params</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2258"><span class='Ref_To_Local'>initSetParam</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * When we call finalize_primnode, context.paramids sets are automatically 
     * merged together.  But when recursing to self, we have to do it the hard 
     * way.  We want the paramids set to include params in subplans as well as 
     * at this level. 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* Find params in targetlist and qual */ 
</span>    <a href="subselect.c.html#LN83"><span class='Ref_to_Proto'>finalize_primnode</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN83"><span class='Ref_to_Proto'>finalize_primnode</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check additional node-type-specific fields */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN513"><span class='Ref_to_Macro'>nodeTag</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN44"><span class='Ref_to_EnumConst'>T_Result</span></a><span class='Operator'>: 
</span>            <a href="subselect.c.html#LN83"><span class='Ref_to_Proto'>finalize_primnode</span></a><span class='Parentheses'>(((</span><a href="../../../include/nodes/plannodes.h.html#LN187"><span class='Ref_to_Struct'>Result</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>resconstantqual<span class='Delimiter'>, 
</span>                              <span class='Operator'>&</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN53"><span class='Ref_to_EnumConst'>T_SeqScan</span></a><span class='Operator'>: 
</span>            <a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN91"><span class='Ref_to_Proto'>bms_add_members</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2252"><span class='Ref_to_Parameter'>scan_params</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN54"><span class='Ref_to_EnumConst'>T_SampleScan</span></a><span class='Operator'>: 
</span>            <a href="subselect.c.html#LN83"><span class='Ref_to_Proto'>finalize_primnode</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>)</span> <span class='Parentheses'>((</span><a href="../../../include/nodes/plannodes.h.html#LN341"><span class='Ref_to_Struct'>SampleScan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>tablesample<span class='Delimiter'>, 
</span>                              <span class='Operator'>&</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN91"><span class='Ref_to_Proto'>bms_add_members</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2252"><span class='Ref_to_Parameter'>scan_params</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN55"><span class='Ref_to_EnumConst'>T_IndexScan</span></a><span class='Operator'>: 
</span>            <a href="subselect.c.html#LN83"><span class='Ref_to_Proto'>finalize_primnode</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>)</span> <span class='Parentheses'>((</span><a href="../../../include/nodes/plannodes.h.html#LN385"><span class='Ref_to_Struct'>IndexScan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>indexqual<span class='Delimiter'>, 
</span>                              <span class='Operator'>&</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="subselect.c.html#LN83"><span class='Ref_to_Proto'>finalize_primnode</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>)</span> <span class='Parentheses'>((</span><a href="../../../include/nodes/plannodes.h.html#LN385"><span class='Ref_to_Struct'>IndexScan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>indexorderby<span class='Delimiter'>, 
</span>                              <span class='Operator'>&</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * we need not look at indexqualorig, since it will have the same 
             * param references as indexqual.  Likewise, we can ignore 
             * indexorderbyorig. 
             */ 
</span>            <a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN91"><span class='Ref_to_Proto'>bms_add_members</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2252"><span class='Ref_to_Parameter'>scan_params</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN56"><span class='Ref_to_EnumConst'>T_IndexOnlyScan</span></a><span class='Operator'>: 
</span>            <a href="subselect.c.html#LN83"><span class='Ref_to_Proto'>finalize_primnode</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>)</span> <span class='Parentheses'>((</span><a href="../../../include/nodes/plannodes.h.html#LN414"><span class='Ref_to_Struct'>IndexOnlyScan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>indexqual<span class='Delimiter'>, 
</span>                              <span class='Operator'>&</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="subselect.c.html#LN83"><span class='Ref_to_Proto'>finalize_primnode</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>)</span> <span class='Parentheses'>((</span><a href="../../../include/nodes/plannodes.h.html#LN414"><span class='Ref_to_Struct'>IndexOnlyScan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>indexorderby<span class='Delimiter'>, 
</span>                              <span class='Operator'>&</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * we need not look at indextlist, since it cannot contain Params. 
             */ 
</span>            <a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN91"><span class='Ref_to_Proto'>bms_add_members</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2252"><span class='Ref_to_Parameter'>scan_params</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN57"><span class='Ref_to_EnumConst'>T_BitmapIndexScan</span></a><span class='Operator'>: 
</span>            <a href="subselect.c.html#LN83"><span class='Ref_to_Proto'>finalize_primnode</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>)</span> <span class='Parentheses'>((</span><a href="../../../include/nodes/plannodes.h.html#LN441"><span class='Ref_to_Struct'>BitmapIndexScan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>indexqual<span class='Delimiter'>, 
</span>                              <span class='Operator'>&</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * we need not look at indexqualorig, since it will have the same 
             * param references as indexqual. 
             */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN58"><span class='Ref_to_EnumConst'>T_BitmapHeapScan</span></a><span class='Operator'>: 
</span>            <a href="subselect.c.html#LN83"><span class='Ref_to_Proto'>finalize_primnode</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>)</span> <span class='Parentheses'>((</span><a href="../../../include/nodes/plannodes.h.html#LN459"><span class='Ref_to_Struct'>BitmapHeapScan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>bitmapqualorig<span class='Delimiter'>, 
</span>                              <span class='Operator'>&</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN91"><span class='Ref_to_Proto'>bms_add_members</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2252"><span class='Ref_to_Parameter'>scan_params</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN59"><span class='Ref_to_EnumConst'>T_TidScan</span></a><span class='Operator'>: 
</span>            <a href="subselect.c.html#LN83"><span class='Ref_to_Proto'>finalize_primnode</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>)</span> <span class='Parentheses'>((</span><a href="../../../include/nodes/plannodes.h.html#LN472"><span class='Ref_to_Struct'>TidScan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>tidquals<span class='Delimiter'>, 
</span>                              <span class='Operator'>&</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN91"><span class='Ref_to_Proto'>bms_add_members</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2252"><span class='Ref_to_Parameter'>scan_params</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN60"><span class='Ref_to_EnumConst'>T_SubqueryScan</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2372"></a>                <a href="../../../include/nodes/plannodes.h.html#LN494"><span class='Ref_to_Struct'>SubqueryScan</span></a> <span class='Operator'>*</span><span class='Declare_Local'>sscan</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN494"><span class='Ref_to_Struct'>SubqueryScan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>; 
</span><a name="LN2373"></a>                <a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* We must run SS_finalize_plan on the subquery */ 
</span>                <a href="subselect.c.html#LN2373"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../util/relnode.c.html#LN241"><span class='Ref_to_Func'>find_base_rel</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2372"><span class='Ref_To_Local'>sscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN496"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN328"><span class='Ref_to_Member'>scanrelid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../../include/optimizer/subselect.h.html#LN30"><span class='Ref_to_Proto'>SS_finalize_plan</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2373"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN566"><span class='Ref_to_Member'>subroot</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2372"><span class='Ref_To_Local'>sscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN497"><span class='Ref_to_Member'>subplan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Now we can add its extParams to the parent's params */ 
</span>                <a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN91"><span class='Ref_to_Proto'>bms_add_members</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a><span class='Delimiter'>, 
</span>                                                   <a href="subselect.c.html#LN2372"><span class='Ref_To_Local'>sscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN497"><span class='Ref_to_Member'>subplan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN161"><span class='Ref_to_Member'>extParam</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* We need scan_params too, though */ 
</span>                <a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN91"><span class='Ref_to_Proto'>bms_add_members</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a><span class='Delimiter'>, 
</span>                                                   <a href="subselect.c.html#LN2252"><span class='Ref_to_Parameter'>scan_params</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN61"><span class='Ref_to_EnumConst'>T_FunctionScan</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2390"></a>                <a href="../../../include/nodes/plannodes.h.html#LN504"><span class='Ref_to_Struct'>FunctionScan</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fscan</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN504"><span class='Ref_to_Struct'>FunctionScan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>; 
</span><a name="LN2391"></a>                <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Call finalize_primnode independently on each function 
                 * expression, so that we can record which params are 
                 * referenced in each, in order to decide which need 
                 * re-evaluating during rescan. 
                 */ 
</span>                <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2391"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2390"><span class='Ref_To_Local'>fscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN507"><span class='Ref_to_Member'>functions</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN2401"></a>                    <a href="../../../include/nodes/parsenodes.h.html#LN1051"><span class='Ref_to_Struct'>RangeTblFunction</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rtfunc</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN1051"><span class='Ref_to_Struct'>RangeTblFunction</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2391"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2402"></a>                    <a href="subselect.c.html#LN49"><span class='Ref_to_Struct'>finalize_primnode_context</span></a> <span class='Declare_Local'>funccontext</span><span class='Delimiter'>; 
</span> 
                    <a href="subselect.c.html#LN2402"><span class='Ref_To_Local'>funccontext</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Delimiter'>; 
</span>                    <a href="subselect.c.html#LN2402"><span class='Ref_To_Local'>funccontext</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
                    <a href="subselect.c.html#LN83"><span class='Ref_to_Proto'>finalize_primnode</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2401"><span class='Ref_To_Local'>rtfunc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1055"><span class='Ref_to_Member'>funcexpr</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="subselect.c.html#LN2402"><span class='Ref_To_Local'>funccontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* remember results for execution */ 
</span>                    <a href="subselect.c.html#LN2401"><span class='Ref_To_Local'>rtfunc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1063"><span class='Ref_to_Member'>funcparams</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN2402"><span class='Ref_To_Local'>funccontext</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* add the function's params to the overall set */ 
</span>                    <a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN91"><span class='Ref_to_Proto'>bms_add_members</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a><span class='Delimiter'>, 
</span>                                                       <a href="subselect.c.html#LN2402"><span class='Ref_To_Local'>funccontext</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN91"><span class='Ref_to_Proto'>bms_add_members</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a><span class='Delimiter'>, 
</span>                                                   <a href="subselect.c.html#LN2252"><span class='Ref_to_Parameter'>scan_params</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN63"><span class='Ref_to_EnumConst'>T_TableFuncScan</span></a><span class='Operator'>: 
</span>            <a href="subselect.c.html#LN83"><span class='Ref_to_Proto'>finalize_primnode</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>)</span> <span class='Parentheses'>((</span><a href="../../../include/nodes/plannodes.h.html#LN525"><span class='Ref_to_Struct'>TableFuncScan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>tablefunc<span class='Delimiter'>, 
</span>                              <span class='Operator'>&</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN91"><span class='Ref_to_Proto'>bms_add_members</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2252"><span class='Ref_to_Parameter'>scan_params</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN62"><span class='Ref_to_EnumConst'>T_ValuesScan</span></a><span class='Operator'>: 
</span>            <a href="subselect.c.html#LN83"><span class='Ref_to_Proto'>finalize_primnode</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>)</span> <span class='Parentheses'>((</span><a href="../../../include/nodes/plannodes.h.html#LN515"><span class='Ref_to_Struct'>ValuesScan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>values_lists<span class='Delimiter'>, 
</span>                              <span class='Operator'>&</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN91"><span class='Ref_to_Proto'>bms_add_members</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2252"><span class='Ref_to_Parameter'>scan_params</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN64"><span class='Ref_to_EnumConst'>T_CteScan</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * You might think we should add the node's cteParam to 
                 * paramids, but we shouldn't because that param is just a 
                 * linkage mechanism for multiple CteScan nodes for the same 
                 * CTE; it is never used for changed-param signaling.  What we 
                 * have to do instead is to find the referenced CTE plan and 
                 * incorporate its external paramids, so that the correct 
                 * things will happen if the CTE references outer-level 
                 * variables.  See test cases for bug #4902.  (We assume 
                 * SS_finalize_plan was run on the CTE plan already.) 
                 */ 
</span><a name="LN2447"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>plan_id</span> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../../include/nodes/plannodes.h.html#LN535"><span class='Ref_to_Struct'>CteScan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>ctePlanId<span class='Delimiter'>; 
</span><a name="LN2448"></a>                <a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>cteplan</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* so, do this ... */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN2447"><span class='Ref_To_Local'>plan_id</span></a> <span class='Operator'>&LT; </span><span class='Number'>1</span> <span class='Operator'>|| </span><a href="subselect.c.html#LN2447"><span class='Ref_To_Local'>plan_id</span></a> <span class='Operator'>&GT; </span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN97"><span class='Ref_to_Member'>subplans</span></a><span class='Parentheses'>))</span> 
                    <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not find plan for CteScan referencing plan ID %d"</span><span class='Delimiter'>, 
</span>                         <a href="subselect.c.html#LN2447"><span class='Ref_To_Local'>plan_id</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="subselect.c.html#LN2448"><span class='Ref_To_Local'>cteplan</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN223"><span class='Ref_to_Proto'>list_nth</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN97"><span class='Ref_to_Member'>subplans</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2447"><span class='Ref_To_Local'>plan_id</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a> <span class='Operator'>= 
</span>                    <a href="../../../include/nodes/bitmapset.h.html#LN91"><span class='Ref_to_Proto'>bms_add_members</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2448"><span class='Ref_To_Local'>cteplan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN161"><span class='Ref_to_Member'>extParam</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> NOT_USED 
                <span class='Comment_Multi_Line'>/* ... but not this */ 
</span>                <a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a> <span class='Operator'>= 
</span>                    <a href="../../../include/nodes/bitmapset.h.html#LN89"><span class='Ref_to_Proto'>bms_add_member</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a><span class='Delimiter'>, 
</span>                                   <span class='Parentheses'>((</span><a href="../../../include/nodes/plannodes.h.html#LN535"><span class='Ref_to_Struct'>CteScan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>cteParam<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
                <a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN91"><span class='Ref_to_Proto'>bms_add_members</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a><span class='Delimiter'>, 
</span>                                                   <a href="subselect.c.html#LN2252"><span class='Ref_to_Parameter'>scan_params</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN66"><span class='Ref_to_EnumConst'>T_WorkTableScan</span></a><span class='Operator'>: 
</span>            <a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a> <span class='Operator'>= 
</span>                <a href="../../../include/nodes/bitmapset.h.html#LN89"><span class='Ref_to_Proto'>bms_add_member</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a><span class='Delimiter'>, 
</span>                               <span class='Parentheses'>((</span><a href="../../../include/nodes/plannodes.h.html#LN556"><span class='Ref_to_Struct'>WorkTableScan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>wtParam<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN91"><span class='Ref_to_Proto'>bms_add_members</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2252"><span class='Ref_to_Parameter'>scan_params</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN65"><span class='Ref_to_EnumConst'>T_NamedTuplestoreScan</span></a><span class='Operator'>: 
</span>            <a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN91"><span class='Ref_to_Proto'>bms_add_members</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2252"><span class='Ref_to_Parameter'>scan_params</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN67"><span class='Ref_to_EnumConst'>T_ForeignScan</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2483"></a>                <a href="../../../include/nodes/plannodes.h.html#LN594"><span class='Ref_to_Struct'>ForeignScan</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fscan</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN594"><span class='Ref_to_Struct'>ForeignScan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>; 
</span> 
                <a href="subselect.c.html#LN83"><span class='Ref_to_Proto'>finalize_primnode</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2483"><span class='Ref_To_Local'>fscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN599"><span class='Ref_to_Member'>fdw_exprs</span></a><span class='Delimiter'>, 
</span>                                  <span class='Operator'>&</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="subselect.c.html#LN83"><span class='Ref_to_Proto'>finalize_primnode</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2483"><span class='Ref_To_Local'>fscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN602"><span class='Ref_to_Member'>fdw_recheck_quals</span></a><span class='Delimiter'>, 
</span>                                  <span class='Operator'>&</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* We assume fdw_scan_tlist cannot contain Params */ 
</span>                <a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN91"><span class='Ref_to_Proto'>bms_add_members</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a><span class='Delimiter'>, 
</span>                                                   <a href="subselect.c.html#LN2252"><span class='Ref_to_Parameter'>scan_params</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN68"><span class='Ref_to_EnumConst'>T_CustomScan</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2498"></a>                <a href="../../../include/nodes/plannodes.h.html#LN623"><span class='Ref_to_Struct'>CustomScan</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cscan</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN623"><span class='Ref_to_Struct'>CustomScan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>; 
</span><a name="LN2499"></a>                <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
                <a href="subselect.c.html#LN83"><span class='Ref_to_Proto'>finalize_primnode</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2498"><span class='Ref_To_Local'>cscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN629"><span class='Ref_to_Member'>custom_exprs</span></a><span class='Delimiter'>, 
</span>                                  <span class='Operator'>&</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* We assume custom_scan_tlist cannot contain Params */ 
</span>                <a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a> <span class='Operator'>= 
</span>                    <a href="../../../include/nodes/bitmapset.h.html#LN91"><span class='Ref_to_Proto'>bms_add_members</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2252"><span class='Ref_to_Parameter'>scan_params</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* child nodes if any */ 
</span>                <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2499"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2498"><span class='Ref_To_Local'>cscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN628"><span class='Ref_to_Member'>custom_plans</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a> <span class='Operator'>= 
</span>                        <a href="../../../include/nodes/bitmapset.h.html#LN91"><span class='Ref_to_Proto'>bms_add_members</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a><span class='Delimiter'>, 
</span>                                        <a href="subselect.c.html#LN79"><span class='Ref_to_Proto'>finalize_plan</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                                      <span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2499"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                      <a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>valid_params</span></a><span class='Delimiter'>, 
</span>                                                      <a href="subselect.c.html#LN2252"><span class='Ref_to_Parameter'>scan_params</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN46"><span class='Ref_to_EnumConst'>T_ModifyTable</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2522"></a>                <a href="../../../include/nodes/plannodes.h.html#LN213"><span class='Ref_to_Struct'>ModifyTable</span></a> <span class='Operator'>*</span><span class='Declare_Local'>mtplan</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN213"><span class='Ref_to_Struct'>ModifyTable</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>; 
</span><a name="LN2523"></a>                <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Force descendant scan nodes to reference epqParam */ 
</span>                <a href="subselect.c.html#LN2255"><span class='Ref_To_Local'>locally_added_param</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN2522"><span class='Ref_To_Local'>mtplan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN230"><span class='Ref_to_Member'>epqParam</span></a><span class='Delimiter'>; 
</span>                <a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>valid_params</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN89"><span class='Ref_to_Proto'>bms_add_member</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/bitmapset.h.html#LN65"><span class='Ref_to_Proto'>bms_copy</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>valid_params</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                              <a href="subselect.c.html#LN2255"><span class='Ref_To_Local'>locally_added_param</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="subselect.c.html#LN2252"><span class='Ref_to_Parameter'>scan_params</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN89"><span class='Ref_to_Proto'>bms_add_member</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/bitmapset.h.html#LN65"><span class='Ref_to_Proto'>bms_copy</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2252"><span class='Ref_to_Parameter'>scan_params</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                             <a href="subselect.c.html#LN2255"><span class='Ref_To_Local'>locally_added_param</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="subselect.c.html#LN83"><span class='Ref_to_Proto'>finalize_primnode</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2522"><span class='Ref_To_Local'>mtplan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN226"><span class='Ref_to_Member'>returningLists</span></a><span class='Delimiter'>, 
</span>                                  <span class='Operator'>&</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="subselect.c.html#LN83"><span class='Ref_to_Proto'>finalize_primnode</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2522"><span class='Ref_To_Local'>mtplan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN233"><span class='Ref_to_Member'>onConflictSet</span></a><span class='Delimiter'>, 
</span>                                  <span class='Operator'>&</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="subselect.c.html#LN83"><span class='Ref_to_Proto'>finalize_primnode</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2522"><span class='Ref_To_Local'>mtplan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN234"><span class='Ref_to_Member'>onConflictWhere</span></a><span class='Delimiter'>, 
</span>                                  <span class='Operator'>&</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* exclRelTlist contains only Vars, doesn't need examination */ 
</span>                <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2523"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2522"><span class='Ref_To_Local'>mtplan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN224"><span class='Ref_to_Member'>plans</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a> <span class='Operator'>= 
</span>                        <a href="../../../include/nodes/bitmapset.h.html#LN91"><span class='Ref_to_Proto'>bms_add_members</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a><span class='Delimiter'>, 
</span>                                        <a href="subselect.c.html#LN79"><span class='Ref_to_Proto'>finalize_plan</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                                      <span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2523"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                      <a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>valid_params</span></a><span class='Delimiter'>, 
</span>                                                      <a href="subselect.c.html#LN2252"><span class='Ref_to_Parameter'>scan_params</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN47"><span class='Ref_to_EnumConst'>T_Append</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2552"></a>                <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
                <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2552"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><span class='Parentheses'>((</span><a href="../../../include/nodes/plannodes.h.html#LN244"><span class='Ref_to_Struct'>Append</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>appendplans<span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a> <span class='Operator'>= 
</span>                        <a href="../../../include/nodes/bitmapset.h.html#LN91"><span class='Ref_to_Proto'>bms_add_members</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a><span class='Delimiter'>, 
</span>                                        <a href="subselect.c.html#LN79"><span class='Ref_to_Proto'>finalize_plan</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                                      <span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2552"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                      <a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>valid_params</span></a><span class='Delimiter'>, 
</span>                                                      <a href="subselect.c.html#LN2252"><span class='Ref_to_Parameter'>scan_params</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN48"><span class='Ref_to_EnumConst'>T_MergeAppend</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2568"></a>                <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
                <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2568"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><span class='Parentheses'>((</span><a href="../../../include/nodes/plannodes.h.html#LN257"><span class='Ref_to_Struct'>MergeAppend</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>mergeplans<span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a> <span class='Operator'>= 
</span>                        <a href="../../../include/nodes/bitmapset.h.html#LN91"><span class='Ref_to_Proto'>bms_add_members</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a><span class='Delimiter'>, 
</span>                                        <a href="subselect.c.html#LN79"><span class='Ref_to_Proto'>finalize_plan</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                                      <span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2568"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                      <a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>valid_params</span></a><span class='Delimiter'>, 
</span>                                                      <a href="subselect.c.html#LN2252"><span class='Ref_to_Parameter'>scan_params</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN50"><span class='Ref_to_EnumConst'>T_BitmapAnd</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2584"></a>                <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
                <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2584"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><span class='Parentheses'>((</span><a href="../../../include/nodes/plannodes.h.html#LN299"><span class='Ref_to_Struct'>BitmapAnd</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>bitmapplans<span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a> <span class='Operator'>= 
</span>                        <a href="../../../include/nodes/bitmapset.h.html#LN91"><span class='Ref_to_Proto'>bms_add_members</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a><span class='Delimiter'>, 
</span>                                        <a href="subselect.c.html#LN79"><span class='Ref_to_Proto'>finalize_plan</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                                      <span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2584"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                      <a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>valid_params</span></a><span class='Delimiter'>, 
</span>                                                      <a href="subselect.c.html#LN2252"><span class='Ref_to_Parameter'>scan_params</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN51"><span class='Ref_to_EnumConst'>T_BitmapOr</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2600"></a>                <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
                <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2600"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><span class='Parentheses'>((</span><a href="../../../include/nodes/plannodes.h.html#LN313"><span class='Ref_to_Struct'>BitmapOr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>bitmapplans<span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a> <span class='Operator'>= 
</span>                        <a href="../../../include/nodes/bitmapset.h.html#LN91"><span class='Ref_to_Proto'>bms_add_members</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a><span class='Delimiter'>, 
</span>                                        <a href="subselect.c.html#LN79"><span class='Ref_to_Proto'>finalize_plan</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                                      <span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2600"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                      <a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>valid_params</span></a><span class='Delimiter'>, 
</span>                                                      <a href="subselect.c.html#LN2252"><span class='Ref_to_Parameter'>scan_params</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN70"><span class='Ref_to_EnumConst'>T_NestLoop</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2616"></a>                <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
                <a href="subselect.c.html#LN83"><span class='Ref_to_Proto'>finalize_primnode</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>)</span> <span class='Parentheses'>((</span><a href="../../../include/nodes/plannodes.h.html#LN665"><span class='Ref_to_Struct'>Join</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>joinqual<span class='Delimiter'>, 
</span>                                  <span class='Operator'>&</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* collect set of params that will be passed to right child */ 
</span>                <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2616"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><span class='Parentheses'>((</span><a href="../../../include/nodes/plannodes.h.html#LN684"><span class='Ref_to_Struct'>NestLoop</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>nestParams<span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span><a name="LN2623"></a>                    <a href="../../../include/nodes/plannodes.h.html#LN690"><span class='Ref_to_Struct'>NestLoopParam</span></a> <span class='Operator'>*</span><span class='Declare_Local'>nlp</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN690"><span class='Ref_to_Struct'>NestLoopParam</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2616"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <a href="subselect.c.html#LN2256"><span class='Ref_To_Local'>nestloop_params</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN89"><span class='Ref_to_Proto'>bms_add_member</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2256"><span class='Ref_To_Local'>nestloop_params</span></a><span class='Delimiter'>, 
</span>                                                     <a href="subselect.c.html#LN2623"><span class='Ref_To_Local'>nlp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN693"><span class='Ref_to_Member'>paramno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN71"><span class='Ref_to_EnumConst'>T_MergeJoin</span></a><span class='Operator'>: 
</span>            <a href="subselect.c.html#LN83"><span class='Ref_to_Proto'>finalize_primnode</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>)</span> <span class='Parentheses'>((</span><a href="../../../include/nodes/plannodes.h.html#LN665"><span class='Ref_to_Struct'>Join</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>joinqual<span class='Delimiter'>, 
</span>                              <span class='Operator'>&</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="subselect.c.html#LN83"><span class='Ref_to_Proto'>finalize_primnode</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>)</span> <span class='Parentheses'>((</span><a href="../../../include/nodes/plannodes.h.html#LN708"><span class='Ref_to_Struct'>MergeJoin</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>mergeclauses<span class='Delimiter'>, 
</span>                              <span class='Operator'>&</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN72"><span class='Ref_to_EnumConst'>T_HashJoin</span></a><span class='Operator'>: 
</span>            <a href="subselect.c.html#LN83"><span class='Ref_to_Proto'>finalize_primnode</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>)</span> <span class='Parentheses'>((</span><a href="../../../include/nodes/plannodes.h.html#LN665"><span class='Ref_to_Struct'>Join</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>joinqual<span class='Delimiter'>, 
</span>                              <span class='Operator'>&</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="subselect.c.html#LN83"><span class='Ref_to_Proto'>finalize_primnode</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>)</span> <span class='Parentheses'>((</span><a href="../../../include/nodes/plannodes.h.html#LN724"><span class='Ref_to_Struct'>HashJoin</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>hashclauses<span class='Delimiter'>, 
</span>                              <span class='Operator'>&</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN84"><span class='Ref_to_EnumConst'>T_Limit</span></a><span class='Operator'>: 
</span>            <a href="subselect.c.html#LN83"><span class='Ref_to_Proto'>finalize_primnode</span></a><span class='Parentheses'>(((</span><a href="../../../include/nodes/plannodes.h.html#LN913"><span class='Ref_to_Struct'>Limit</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>limitOffset<span class='Delimiter'>, 
</span>                              <span class='Operator'>&</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="subselect.c.html#LN83"><span class='Ref_to_Proto'>finalize_primnode</span></a><span class='Parentheses'>(((</span><a href="../../../include/nodes/plannodes.h.html#LN913"><span class='Ref_to_Struct'>Limit</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>limitCount<span class='Delimiter'>, 
</span>                              <span class='Operator'>&</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN49"><span class='Ref_to_EnumConst'>T_RecursiveUnion</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* child nodes are allowed to reference wtParam */ 
</span>            <a href="subselect.c.html#LN2255"><span class='Ref_To_Local'>locally_added_param</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../../include/nodes/plannodes.h.html#LN279"><span class='Ref_to_Struct'>RecursiveUnion</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>wtParam<span class='Delimiter'>; 
</span>            <a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>valid_params</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN89"><span class='Ref_to_Proto'>bms_add_member</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/bitmapset.h.html#LN65"><span class='Ref_to_Proto'>bms_copy</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>valid_params</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                          <a href="subselect.c.html#LN2255"><span class='Ref_To_Local'>locally_added_param</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* wtParam does *not* get added to scan_params */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN83"><span class='Ref_to_EnumConst'>T_LockRows</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* Force descendant scan nodes to reference epqParam */ 
</span>            <a href="subselect.c.html#LN2255"><span class='Ref_To_Local'>locally_added_param</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../../include/nodes/plannodes.h.html#LN899"><span class='Ref_to_Struct'>LockRows</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>epqParam<span class='Delimiter'>; 
</span>            <a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>valid_params</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN89"><span class='Ref_to_Proto'>bms_add_member</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/bitmapset.h.html#LN65"><span class='Ref_to_Proto'>bms_copy</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>valid_params</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                          <a href="subselect.c.html#LN2255"><span class='Ref_To_Local'>locally_added_param</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="subselect.c.html#LN2252"><span class='Ref_to_Parameter'>scan_params</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN89"><span class='Ref_to_Proto'>bms_add_member</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/bitmapset.h.html#LN65"><span class='Ref_to_Proto'>bms_copy</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2252"><span class='Ref_to_Parameter'>scan_params</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                         <a href="subselect.c.html#LN2255"><span class='Ref_To_Local'>locally_added_param</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN76"><span class='Ref_to_EnumConst'>T_Agg</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2671"></a>                <a href="../../../include/nodes/plannodes.h.html#LN781"><span class='Ref_to_Struct'>Agg</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>agg</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN781"><span class='Ref_to_Struct'>Agg</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * AGG_HASHED plans need to know which Params are referenced 
                 * in aggregate calls.  Do a separate scan to identify them. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN2671"><span class='Ref_To_Local'>agg</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN784"><span class='Ref_to_Member'>aggstrategy</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/nodes.h.html#LN737"><span class='Ref_to_EnumConst'>AGG_HASHED</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN2679"></a>                    <a href="subselect.c.html#LN49"><span class='Ref_to_Struct'>finalize_primnode_context</span></a> <span class='Declare_Local'>aggcontext</span><span class='Delimiter'>; 
</span> 
                    <a href="subselect.c.html#LN2679"><span class='Ref_To_Local'>aggcontext</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN51"><span class='Ref_to_Member'>root</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>; 
</span>                    <a href="subselect.c.html#LN2679"><span class='Ref_To_Local'>aggcontext</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                    <a href="subselect.c.html#LN84"><span class='Ref_to_Proto'>finalize_agg_primnode</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2671"><span class='Ref_To_Local'>agg</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN783"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Delimiter'>, 
</span>                                          <span class='Operator'>&</span><a href="subselect.c.html#LN2679"><span class='Ref_To_Local'>aggcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="subselect.c.html#LN84"><span class='Ref_to_Proto'>finalize_agg_primnode</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2671"><span class='Ref_To_Local'>agg</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN783"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a><span class='Delimiter'>, 
</span>                                          <span class='Operator'>&</span><a href="subselect.c.html#LN2679"><span class='Ref_To_Local'>aggcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="subselect.c.html#LN2671"><span class='Ref_To_Local'>agg</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN790"><span class='Ref_to_Member'>aggParams</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN2679"><span class='Ref_To_Local'>aggcontext</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN77"><span class='Ref_to_EnumConst'>T_WindowAgg</span></a><span class='Operator'>: 
</span>            <a href="subselect.c.html#LN83"><span class='Ref_to_Proto'>finalize_primnode</span></a><span class='Parentheses'>(((</span><a href="../../../include/nodes/plannodes.h.html#LN800"><span class='Ref_to_Struct'>WindowAgg</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>startOffset<span class='Delimiter'>, 
</span>                              <span class='Operator'>&</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="subselect.c.html#LN83"><span class='Ref_to_Proto'>finalize_primnode</span></a><span class='Parentheses'>(((</span><a href="../../../include/nodes/plannodes.h.html#LN800"><span class='Ref_to_Struct'>WindowAgg</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>endOffset<span class='Delimiter'>, 
</span>                              <span class='Operator'>&</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN45"><span class='Ref_to_EnumConst'>T_ProjectSet</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN81"><span class='Ref_to_EnumConst'>T_Hash</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN73"><span class='Ref_to_EnumConst'>T_Material</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN74"><span class='Ref_to_EnumConst'>T_Sort</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN78"><span class='Ref_to_EnumConst'>T_Unique</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN79"><span class='Ref_to_EnumConst'>T_Gather</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN80"><span class='Ref_to_EnumConst'>T_GatherMerge</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN82"><span class='Ref_to_EnumConst'>T_SetOp</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN75"><span class='Ref_to_EnumConst'>T_Group</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* no node-type-specific fields need fixing */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized node type: %d"</span><span class='Delimiter'>, 
</span>                 <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="../../../include/nodes/nodes.h.html#LN513"><span class='Ref_to_Macro'>nodeTag</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch nodeTag(plan) &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Process left and right child plans, if any */ 
</span>    <a href="subselect.c.html#LN2259"><span class='Ref_To_Local'>child_params</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN79"><span class='Ref_to_Proto'>finalize_plan</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                 <a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN145"><span class='Ref_to_Member'>lefttree</span></a><span class='Delimiter'>, 
</span>                                 <a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>valid_params</span></a><span class='Delimiter'>, 
</span>                                 <a href="subselect.c.html#LN2252"><span class='Ref_to_Parameter'>scan_params</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN91"><span class='Ref_to_Proto'>bms_add_members</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2259"><span class='Ref_To_Local'>child_params</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN2256"><span class='Ref_To_Local'>nestloop_params</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* right child can reference nestloop_params as well as valid_params */ 
</span>        <a href="subselect.c.html#LN2259"><span class='Ref_To_Local'>child_params</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN79"><span class='Ref_to_Proto'>finalize_plan</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                     <a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN146"><span class='Ref_to_Member'>righttree</span></a><span class='Delimiter'>, 
</span>                                     <a href="../../../include/nodes/bitmapset.h.html#LN70"><span class='Ref_to_Proto'>bms_union</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2256"><span class='Ref_To_Local'>nestloop_params</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>valid_params</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                     <a href="subselect.c.html#LN2252"><span class='Ref_to_Parameter'>scan_params</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* ... and they don't count as parameters used at my level */ 
</span>        <a href="subselect.c.html#LN2259"><span class='Ref_To_Local'>child_params</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN72"><span class='Ref_to_Proto'>bms_difference</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2259"><span class='Ref_To_Local'>child_params</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2256"><span class='Ref_To_Local'>nestloop_params</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/nodes/bitmapset.h.html#LN68"><span class='Ref_to_Proto'>bms_free</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2256"><span class='Ref_To_Local'>nestloop_params</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* easy case */ 
</span>        <a href="subselect.c.html#LN2259"><span class='Ref_To_Local'>child_params</span></a> <span class='Operator'>= </span><a href="subselect.c.html#LN79"><span class='Ref_to_Proto'>finalize_plan</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                     <a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN146"><span class='Ref_to_Member'>righttree</span></a><span class='Delimiter'>, 
</span>                                     <a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>valid_params</span></a><span class='Delimiter'>, 
</span>                                     <a href="subselect.c.html#LN2252"><span class='Ref_to_Parameter'>scan_params</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN91"><span class='Ref_to_Proto'>bms_add_members</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2259"><span class='Ref_To_Local'>child_params</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Any locally generated parameter doesn't count towards its generating 
     * plan node's external dependencies.  (Note: if we changed valid_params 
     * and/or scan_params, we leak those bitmapsets; not worth the notational 
     * trouble to clean them up.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN2255"><span class='Ref_To_Local'>locally_added_param</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN90"><span class='Ref_to_Proto'>bms_del_member</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a><span class='Delimiter'>, 
</span>                                          <a href="subselect.c.html#LN2255"><span class='Ref_To_Local'>locally_added_param</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Now we have all the paramids referenced in this node and children */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/bitmapset.h.html#LN73"><span class='Ref_to_Proto'>bms_is_subset</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>valid_params</span></a><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"plan should not reference subplan's variable"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The plan node's allParam and extParam fields should include all its 
     * referenced paramids, plus contributions from any child initPlans. 
     * However, any setParams of the initPlans should not be present in the 
     * parent node's extParams, only in its allParams.  (It's possible that 
     * some initPlans have extParams that are setParams of other initPlans.) 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* allParam must include initplans' extParams and setParams */ 
</span>    <a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN162"><span class='Ref_to_Member'>allParam</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN70"><span class='Ref_to_Proto'>bms_union</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2257"><span class='Ref_To_Local'>initExtParam</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN162"><span class='Ref_to_Member'>allParam</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN91"><span class='Ref_to_Proto'>bms_add_members</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN162"><span class='Ref_to_Member'>allParam</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2258"><span class='Ref_To_Local'>initSetParam</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* extParam must include any initplan extParams */ 
</span>    <a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN161"><span class='Ref_to_Member'>extParam</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN70"><span class='Ref_to_Proto'>bms_union</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2254"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2257"><span class='Ref_To_Local'>initExtParam</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* but not any initplan setParams */ 
</span>    <a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN161"><span class='Ref_to_Member'>extParam</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN93"><span class='Ref_to_Proto'>bms_del_members</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN161"><span class='Ref_to_Member'>extParam</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2258"><span class='Ref_To_Local'>initSetParam</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * For speed at execution time, make sure extParam/allParam are actually 
     * NULL if they are empty sets. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/bitmapset.h.html#LN85"><span class='Ref_to_Proto'>bms_is_empty</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN161"><span class='Ref_to_Member'>extParam</span></a><span class='Parentheses'>))</span> 
        <a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN161"><span class='Ref_to_Member'>extParam</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/bitmapset.h.html#LN85"><span class='Ref_to_Proto'>bms_is_empty</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN162"><span class='Ref_to_Member'>allParam</span></a><span class='Parentheses'>))</span> 
        <a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN162"><span class='Ref_to_Member'>allParam</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="subselect.c.html#LN2251"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN162"><span class='Ref_to_Member'>allParam</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end finalize_plan &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * finalize_primnode: add IDs of all PARAM_EXEC params appearing in the given 
 * expression tree to the result set. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN2794"></a><span class='Declare_Function'>finalize_primnode</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><a href="subselect.c.html#LN49"><span class='Ref_to_Struct'>finalize_primnode_context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN2794"><span class='Ref_to_Parameter'>node</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2794"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN240"><span class='Ref_to_Struct'>Param</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(((</span><a href="../../../include/nodes/primnodes.h.html#LN240"><span class='Ref_to_Struct'>Param</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2794"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>paramkind <span class='Operator'>== </span><a href="../../../include/nodes/primnodes.h.html#LN235"><span class='Ref_to_EnumConst'>PARAM_EXEC</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><a name="LN2802"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>paramid</span> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN240"><span class='Ref_to_Struct'>Param</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2794"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>paramid<span class='Delimiter'>; 
</span> 
            <a href="subselect.c.html#LN2794"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN89"><span class='Ref_to_Proto'>bms_add_member</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2794"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2802"><span class='Ref_To_Local'>paramid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* no more to do here */ 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2794"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN678"><span class='Ref_to_Struct'>SubPlan</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2810"></a>        <a href="../../../include/nodes/primnodes.h.html#LN678"><span class='Ref_to_Struct'>SubPlan</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>subplan</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN678"><span class='Ref_to_Struct'>SubPlan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2794"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span><a name="LN2811"></a>        <a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>plan</span> <span class='Operator'>= </span><a href="../../../include/nodes/relation.h.html#LN136"><span class='Ref_to_Macro'>planner_subplan_get_plan</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2794"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="subselect.c.html#LN51"><span class='Ref_to_Member'>root</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2810"><span class='Ref_To_Local'>subplan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2812"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span><a name="LN2813"></a>        <a href="../../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>subparamids</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Recurse into the testexpr, but not into the Plan */ 
</span>        <a href="subselect.c.html#LN83"><span class='Ref_to_Proto'>finalize_primnode</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2810"><span class='Ref_To_Local'>subplan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN684"><span class='Ref_to_Member'>testexpr</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2794"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Remove any param IDs of output parameters of the subplan that were 
         * referenced in the testexpr.  These are not interesting for 
         * parameter change signaling since we always re-evaluate the subplan. 
         * Note that this wouldn't work too well if there might be uses of the 
         * same param IDs elsewhere in the plan, but that can't happen because 
         * generate_new_param never tries to merge params. 
         */ 
</span>        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2812"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2810"><span class='Ref_To_Local'>subplan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN685"><span class='Ref_to_Member'>paramIds</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="subselect.c.html#LN2794"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN90"><span class='Ref_to_Proto'>bms_del_member</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2794"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a><span class='Delimiter'>, 
</span>                                               <a href="../../../include/nodes/pg_list.h.html#LN106"><span class='Ref_to_Macro'>lfirst_int</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2812"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Also examine args list */ 
</span>        <a href="subselect.c.html#LN83"><span class='Ref_to_Proto'>finalize_primnode</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2810"><span class='Ref_To_Local'>subplan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN708"><span class='Ref_to_Member'>args</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2794"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Add params needed by the subplan to paramids, but excluding those 
         * we will pass down to it.  (We assume SS_finalize_plan was run on 
         * the subplan already.) 
         */ 
</span>        <a href="subselect.c.html#LN2813"><span class='Ref_To_Local'>subparamids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN65"><span class='Ref_to_Proto'>bms_copy</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2811"><span class='Ref_To_Local'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN161"><span class='Ref_to_Member'>extParam</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2812"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2810"><span class='Ref_To_Local'>subplan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN707"><span class='Ref_to_Member'>parParam</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="subselect.c.html#LN2813"><span class='Ref_To_Local'>subparamids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN90"><span class='Ref_to_Proto'>bms_del_member</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2813"><span class='Ref_To_Local'>subparamids</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN106"><span class='Ref_to_Macro'>lfirst_int</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2812"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="subselect.c.html#LN2794"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN94"><span class='Ref_to_Proto'>bms_join</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2794"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="subselect.c.html#LN52"><span class='Ref_to_Member'>paramids</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2813"><span class='Ref_To_Local'>subparamids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* no more to do here */ 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IsA(node,SubPlan) &raquo; </span> 
    <span class='Control'>return</span> <a href="../../../include/nodes/nodeFuncs.h.html#LN52"><span class='Ref_to_Proto'>expression_tree_walker</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2794"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN83"><span class='Ref_to_Proto'>finalize_primnode</span></a><span class='Delimiter'>, 
</span>                                  <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2794"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end finalize_primnode &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * finalize_agg_primnode: find all Aggref nodes in the given expression tree, 
 * and add IDs of all PARAM_EXEC params appearing within their aggregated 
 * arguments to the result set. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN2859"></a><span class='Declare_Function'>finalize_agg_primnode</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><a href="subselect.c.html#LN49"><span class='Ref_to_Struct'>finalize_primnode_context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subselect.c.html#LN2859"><span class='Ref_to_Parameter'>node</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2859"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN290"><span class='Ref_to_Struct'>Aggref</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2865"></a>        <a href="../../../include/nodes/primnodes.h.html#LN290"><span class='Ref_to_Struct'>Aggref</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>agg</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN290"><span class='Ref_to_Struct'>Aggref</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2859"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* we should not consider the direct arguments, if any */ 
</span>        <a href="subselect.c.html#LN83"><span class='Ref_to_Proto'>finalize_primnode</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2865"><span class='Ref_To_Local'>agg</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN300"><span class='Ref_to_Member'>args</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2859"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="subselect.c.html#LN83"><span class='Ref_to_Proto'>finalize_primnode</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2865"><span class='Ref_To_Local'>agg</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN303"><span class='Ref_to_Member'>aggfilter</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2859"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* there can't be any Aggrefs below here */ 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="../../../include/nodes/nodeFuncs.h.html#LN52"><span class='Ref_to_Proto'>expression_tree_walker</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2859"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN84"><span class='Ref_to_Proto'>finalize_agg_primnode</span></a><span class='Delimiter'>, 
</span>                                  <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="subselect.c.html#LN2859"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * SS_make_initplan_output_param - make a Param for an initPlan's output 
 * 
 * The plan is expected to return a scalar value of the given type/collation. 
 * 
 * Note that in some cases the initplan may not ever appear in the finished 
 * plan tree.  If that happens, we'll have wasted a PARAM_EXEC slot, which 
 * is no big deal. 
 */ 
</span><a href="../../../include/nodes/primnodes.h.html#LN240"><span class='Ref_to_Struct'>Param</span></a> <span class='Operator'>* 
</span><a name="LN2886"></a><span class='Declare_Function'>SS_make_initplan_output_param</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN2887"></a>                              <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>resulttype</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>resulttypmod</span><span class='Delimiter'>, 
</span><a name="LN2888"></a>                              <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>resultcollation</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="subselect.c.html#LN388"><span class='Ref_to_Func'>generate_new_param</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2886"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2887"><span class='Ref_to_Parameter'>resulttype</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2887"><span class='Ref_to_Parameter'>resulttypmod</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2888"><span class='Ref_to_Parameter'>resultcollation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * SS_make_initplan_from_plan - given a plan tree, make it an InitPlan 
 * 
 * We build an EXPR_SUBLINK SubPlan node and put it into the initplan 
 * list for the outer query level.  A Param that represents the initplan's 
 * output has already been assigned using SS_make_initplan_output_param. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN2901"></a><span class='Declare_Function'>SS_make_initplan_from_plan</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN2902"></a>                           <a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>subroot</span><span class='Delimiter'>, </span><a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>plan</span><span class='Delimiter'>, 
</span><a name="LN2903"></a>                           <a href="../../../include/nodes/primnodes.h.html#LN240"><span class='Ref_to_Struct'>Param</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>prm</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2905"></a>    <a href="../../../include/nodes/primnodes.h.html#LN678"><span class='Ref_to_Struct'>SubPlan</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>node</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Add the subplan and its PlannerInfo to the global lists. 
     */ 
</span>    <a href="subselect.c.html#LN2901"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN97"><span class='Ref_to_Member'>subplans</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2901"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN97"><span class='Ref_to_Member'>subplans</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2902"><span class='Ref_to_Parameter'>plan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN2901"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN99"><span class='Ref_to_Member'>subroots</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2901"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN99"><span class='Ref_to_Member'>subroots</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2902"><span class='Ref_to_Parameter'>subroot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Create a SubPlan node and add it to the outer list of InitPlans. Note 
     * it has to appear after any other InitPlans it might depend on (see 
     * comments in ExecReScan). 
     */ 
</span>    <a href="subselect.c.html#LN2905"><span class='Ref_To_Local'>node</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN678"><span class='Ref_to_Struct'>SubPlan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN2905"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN682"><span class='Ref_to_Member'>subLinkType</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/primnodes.h.html#LN622"><span class='Ref_to_EnumConst'>EXPR_SUBLINK</span></a><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN2905"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN687"><span class='Ref_to_Member'>plan_id</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2901"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN97"><span class='Ref_to_Member'>subplans</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN2905"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN689"><span class='Ref_to_Member'>plan_name</span></a> <span class='Operator'>= </span><a href="../../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"InitPlan %d (returns $%d)"</span><span class='Delimiter'>, 
</span>                               <a href="subselect.c.html#LN2905"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN687"><span class='Ref_to_Member'>plan_id</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2903"><span class='Ref_to_Parameter'>prm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN244"><span class='Ref_to_Member'>paramid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN428"><span class='Ref_to_Func'>get_first_col_type</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2902"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="subselect.c.html#LN2905"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN691"><span class='Ref_to_Member'>firstColType</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="subselect.c.html#LN2905"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN692"><span class='Ref_to_Member'>firstColTypmod</span></a><span class='Delimiter'>, 
</span>                       <span class='Operator'>&</span><a href="subselect.c.html#LN2905"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN693"><span class='Ref_to_Member'>firstColCollation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="subselect.c.html#LN2905"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN705"><span class='Ref_to_Member'>setParam</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN144"><span class='Ref_to_Macro'>list_make1_int</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2903"><span class='Ref_to_Parameter'>prm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN244"><span class='Ref_to_Member'>paramid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="subselect.c.html#LN2901"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN227"><span class='Ref_to_Member'>init_plans</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2901"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN227"><span class='Ref_to_Member'>init_plans</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2905"><span class='Ref_To_Local'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The node can't have any inputs (since it's an initplan), so the 
     * parParam and args lists remain empty. 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* Set costs of SubPlan using info from the plan tree */ 
</span>    <a href="../../../include/optimizer/cost.h.html#LN156"><span class='Ref_to_Proto'>cost_subplan</span></a><span class='Parentheses'>(</span><a href="subselect.c.html#LN2902"><span class='Ref_to_Parameter'>subroot</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2905"><span class='Ref_To_Local'>node</span></a><span class='Delimiter'>, </span><a href="subselect.c.html#LN2902"><span class='Ref_to_Parameter'>plan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end SS_make_initplan_from_plan &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>