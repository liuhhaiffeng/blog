<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\optimizer\prep\prepjointree.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\optimizer\prep\prepjointree.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:42 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * prepjointree.c 
 *    Planner preprocessing for subqueries and join tree manipulation. 
 * 
 * NOTE: the intended sequence for invoking these operations is 
 *      pull_up_sublinks 
 *      inline_set_returning_functions 
 *      pull_up_subqueries 
 *      flatten_simple_union_all 
 *      do expression preprocessing (including flattening JOIN alias vars) 
 *      reduce_outer_joins 
 * 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/optimizer/prep/prepjointree.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"nodes/makefuncs.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"nodes/nodeFuncs.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/clauses.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/placeholder.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/prep.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/subselect.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/tlist.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/var.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parse_relation.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parsetree.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"rewrite/rewriteManip.h"</span> 
 
 
<a name="LN39"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>pullup_replace_vars_context</span> 
<span class='Delimiter'>{ 
</span><a name="LN41"></a>    <a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Member'>root</span><span class='Delimiter'>; 
</span><a name="LN42"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>targetlist</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* tlist of subquery being pulled up */ 
</span><a name="LN43"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Member'>target_rte</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* RTE of subquery */ 
</span><a name="LN44"></a>    <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a>      <span class='Declare_Member'>relids</span><span class='Delimiter'>;</span>         <span class='Comment_Multi_Line'>/* relids within subquery, as numbered after 
                                 * pullup (set only if target_rte-&GT;lateral) */ 
</span><a name="LN46"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Member'>outer_hasSubLinks</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* -&GT; outer query's hasSubLinks */ 
</span><a name="LN47"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>varno</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* varno of subquery */ 
</span><a name="LN48"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>need_phvs</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* do we need PlaceHolderVars? */ 
</span><a name="LN49"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>wrap_non_vars</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* do we need 'em on *all* non-Vars? */ 
</span><a name="LN50"></a>    <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>      <span class='Operator'>**</span><span class='Declare_Member'>rv_cache</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* cache for results with PHVs */ 
</span><a name="LN51"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>pullup_replace_vars_context</span><span class='Delimiter'>; 
</span> 
<a name="LN53"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>reduce_outer_joins_state</span> 
<span class='Delimiter'>{ 
</span><a name="LN55"></a>    <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a>      <span class='Declare_Member'>relids</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* base relids within this subtree */ 
</span><a name="LN56"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>contains_outer</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* does subtree contain outer join(s)? */ 
</span><a name="LN57"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>sub_states</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* List of states for subtree components */ 
</span><a name="LN58"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>reduce_outer_joins_state</span><span class='Delimiter'>; 
</span> 
<a name="LN60"></a><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>pull_up_sublinks_jointree_recurse</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jtnode</span><span class='Delimiter'>, 
</span><a name="LN61"></a>                                  <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>relids</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN62"></a><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>pull_up_sublinks_qual_recurse</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, 
</span><a name="LN63"></a>                              <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>jtlink1</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>available_rels1</span><span class='Delimiter'>, 
</span><a name="LN64"></a>                              <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>jtlink2</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>available_rels2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN65"></a><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>pull_up_subqueries_recurse</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jtnode</span><span class='Delimiter'>, 
</span><a name="LN66"></a>                           <a href="../../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lowest_outer_join</span><span class='Delimiter'>, 
</span><a name="LN67"></a>                           <a href="../../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lowest_nulling_outer_join</span><span class='Delimiter'>, 
</span><a name="LN68"></a>                           <a href="../../../include/nodes/relation.h.html#LN1964"><span class='Ref_to_Struct'>AppendRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>containing_appendrel</span><span class='Delimiter'>, 
</span><a name="LN69"></a>                           <span class='Keyword'>bool </span><span class='Declare_Parameter'>deletion_ok</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN70"></a><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>pull_up_simple_subquery</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jtnode</span><span class='Delimiter'>, 
</span><a name="LN71"></a>                        <a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rte</span><span class='Delimiter'>, 
</span><a name="LN72"></a>                        <a href="../../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lowest_outer_join</span><span class='Delimiter'>, 
</span><a name="LN73"></a>                        <a href="../../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lowest_nulling_outer_join</span><span class='Delimiter'>, 
</span><a name="LN74"></a>                        <a href="../../../include/nodes/relation.h.html#LN1964"><span class='Ref_to_Struct'>AppendRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>containing_appendrel</span><span class='Delimiter'>, 
</span><a name="LN75"></a>                        <span class='Keyword'>bool </span><span class='Declare_Parameter'>deletion_ok</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN76"></a><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>pull_up_simple_union_all</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jtnode</span><span class='Delimiter'>, 
</span><a name="LN77"></a>                         <a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rte</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN78"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>pull_up_union_leaf_queries</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>setOp</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN79"></a>                           <span class='Keyword'>int </span><span class='Declare_Parameter'>parentRTindex</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>setOpQuery</span><span class='Delimiter'>, 
</span><a name="LN80"></a>                           <span class='Keyword'>int </span><span class='Declare_Parameter'>childRToffset</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN81"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>make_setop_translation_list</span><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>query</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>newvarno</span><span class='Delimiter'>, 
</span><a name="LN82"></a>                            <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>translated_vars</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN83"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>is_simple_subquery</span><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>subquery</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rte</span><span class='Delimiter'>, 
</span><a name="LN84"></a>                   <a href="../../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lowest_outer_join</span><span class='Delimiter'>, 
</span><a name="LN85"></a>                   <span class='Keyword'>bool </span><span class='Declare_Parameter'>deletion_ok</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN86"></a><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>pull_up_simple_values</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jtnode</span><span class='Delimiter'>, 
</span><a name="LN87"></a>                      <a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rte</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN88"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>is_simple_values</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rte</span><span class='Delimiter'>, 
</span><a name="LN89"></a>                 <span class='Keyword'>bool </span><span class='Declare_Parameter'>deletion_ok</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN90"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>is_simple_union_all</span><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>subquery</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN91"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>is_simple_union_all_recurse</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>setOp</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>setOpQuery</span><span class='Delimiter'>, 
</span><a name="LN92"></a>                            <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>colTypes</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN93"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>is_safe_append_member</span><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>subquery</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN94"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>jointree_contains_lateral_outer_refs</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jtnode</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>restricted</span><span class='Delimiter'>, 
</span><a name="LN95"></a>                                     <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>safe_upper_varnos</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN96"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>replace_vars_in_jointree</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jtnode</span><span class='Delimiter'>, 
</span><a name="LN97"></a>                         <a href="prepjointree.c.html#LN39"><span class='Ref_to_Struct'>pullup_replace_vars_context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Delimiter'>, 
</span><a name="LN98"></a>                         <a href="../../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lowest_nulling_outer_join</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN99"></a><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>pullup_replace_vars</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>expr</span><span class='Delimiter'>, 
</span><a name="LN100"></a>                    <a href="prepjointree.c.html#LN39"><span class='Ref_to_Struct'>pullup_replace_vars_context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN101"></a><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>pullup_replace_vars_callback</span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Delimiter'>, 
</span><a name="LN102"></a>                             <a href="../../../include/rewrite/rewriteManip.h.html#LN24"><span class='Ref_to_Struct'>replace_rte_variables_context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN103"></a><span class='Keyword'>static </span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>pullup_replace_vars_subquery</span><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>query</span><span class='Delimiter'>, 
</span><a name="LN104"></a>                             <a href="prepjointree.c.html#LN39"><span class='Ref_to_Struct'>pullup_replace_vars_context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN105"></a><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>pull_up_subqueries_cleanup</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jtnode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN106"></a><span class='Keyword'>static </span><a href="prepjointree.c.html#LN53"><span class='Ref_to_Struct'>reduce_outer_joins_state</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>reduce_outer_joins_pass1</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jtnode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN107"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>reduce_outer_joins_pass2</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jtnode</span><span class='Delimiter'>, 
</span><a name="LN108"></a>                         <a href="prepjointree.c.html#LN53"><span class='Ref_to_Struct'>reduce_outer_joins_state</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, 
</span><a name="LN109"></a>                         <a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN110"></a>                         <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>nonnullable_rels</span><span class='Delimiter'>, 
</span><a name="LN111"></a>                         <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>nonnullable_vars</span><span class='Delimiter'>, 
</span><a name="LN112"></a>                         <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>forced_null_vars</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN113"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>substitute_multiple_relids</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, 
</span><a name="LN114"></a>                           <span class='Keyword'>int </span><span class='Declare_Parameter'>varno</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>subrelids</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN115"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>fix_append_rel_relids</span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>append_rel_list</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>varno</span><span class='Delimiter'>, 
</span><a name="LN116"></a>                      <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>subrelids</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN117"></a><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>find_jointree_node_for_rel</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jtnode</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>relid</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * pull_up_sublinks 
 *      Attempt to pull up ANY and EXISTS SubLinks to be treated as 
 *      semijoins or anti-semijoins. 
 * 
 * A clause "foo op ANY (sub-SELECT)" can be processed by pulling the 
 * sub-SELECT up to become a rangetable entry and treating the implied 
 * comparisons as quals of a semijoin.  However, this optimization *only* 
 * works at the top level of WHERE or a JOIN/ON clause, because we cannot 
 * distinguish whether the ANY ought to return FALSE or NULL in cases 
 * involving NULL inputs.  Also, in an outer join's ON clause we can only 
 * do this if the sublink is degenerate (ie, references only the nullable 
 * side of the join).  In that case it is legal to push the semijoin 
 * down into the nullable side of the join.  If the sublink references any 
 * nonnullable-side variables then it would have to be evaluated as part 
 * of the outer join, which makes things way too complicated. 
 * 
 * Under similar conditions, EXISTS and NOT EXISTS clauses can be handled 
 * by pulling up the sub-SELECT and creating a semijoin or anti-semijoin. 
 * 
 * This routine searches for such clauses and does the necessary parsetree 
 * transformations if any are found. 
 * 
 * This routine has to run before preprocess_expression(), so the quals 
 * clauses are not yet reduced to implicit-AND format, and are not guaranteed 
 * to be AND/OR-flat either.  That means we need to recursively search through 
 * explicit AND clauses.  We stop as soon as we hit a non-AND item. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN149"></a><span class='Declare_Function'>pull_up_sublinks</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN151"></a>    <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>jtnode</span><span class='Delimiter'>; 
</span><a name="LN152"></a>    <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a>      <span class='Declare_Local'>relids</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Begin recursion through the jointree */ 
</span>    <a href="prepjointree.c.html#LN151"><span class='Ref_To_Local'>jtnode</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN60"><span class='Ref_to_Proto'>pull_up_sublinks_jointree_recurse</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN149"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                               <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN149"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN135"><span class='Ref_to_Member'>jointree</span></a><span class='Delimiter'>, 
</span>                                               <span class='Operator'>&</span><a href="prepjointree.c.html#LN152"><span class='Ref_To_Local'>relids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * root-&GT;parse-&GT;jointree must always be a FromExpr, so insert a dummy one 
     * if we got a bare RangeTblRef or JoinExpr out of the recursion. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN151"><span class='Ref_To_Local'>jtnode</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1466"><span class='Ref_to_Struct'>FromExpr</span></a><span class='Parentheses'>))</span> 
        <a href="prepjointree.c.html#LN149"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN135"><span class='Ref_to_Member'>jointree</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1466"><span class='Ref_to_Struct'>FromExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN151"><span class='Ref_To_Local'>jtnode</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="prepjointree.c.html#LN149"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN135"><span class='Ref_to_Member'>jointree</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/makefuncs.h.html#LN47"><span class='Ref_to_Proto'>makeFromExpr</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN138"><span class='Ref_to_Macro'>list_make1</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN151"><span class='Ref_To_Local'>jtnode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pull_up_sublinks &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Recurse through jointree nodes for pull_up_sublinks() 
 * 
 * In addition to returning the possibly-modified jointree node, we return 
 * a relids set of the contained rels into *relids. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>* 
</span><a name="LN176"></a><span class='Declare_Function'>pull_up_sublinks_jointree_recurse</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jtnode</span><span class='Delimiter'>, 
</span><a name="LN177"></a>                                  <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>relids</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN176"><span class='Ref_to_Parameter'>jtnode</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="prepjointree.c.html#LN177"><span class='Ref_to_Parameter'>relids</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN176"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1415"><span class='Ref_to_Struct'>RangeTblRef</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN185"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>varno</span> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN1415"><span class='Ref_to_Struct'>RangeTblRef</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN176"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>rtindex<span class='Delimiter'>; 
</span> 
        <span class='Operator'>*</span><a href="prepjointree.c.html#LN177"><span class='Ref_to_Parameter'>relids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN67"><span class='Ref_to_Proto'>bms_make_singleton</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN185"><span class='Ref_To_Local'>varno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* jtnode is returned unmodified */ 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN176"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1466"><span class='Ref_to_Struct'>FromExpr</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN192"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1466"><span class='Ref_to_Struct'>FromExpr</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>f</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1466"><span class='Ref_to_Struct'>FromExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN176"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>; 
</span><a name="LN193"></a>        <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>newfromlist</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN194"></a>        <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a>      <span class='Declare_Local'>frelids</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN195"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1466"><span class='Ref_to_Struct'>FromExpr</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>newf</span><span class='Delimiter'>; 
</span><a name="LN196"></a>        <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>jtlink</span><span class='Delimiter'>; 
</span><a name="LN197"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* First, recurse to process children and collect their relids */ 
</span>        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN197"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN192"><span class='Ref_To_Local'>f</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1469"><span class='Ref_to_Member'>fromlist</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN202"></a>            <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>newchild</span><span class='Delimiter'>; 
</span><a name="LN203"></a>            <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a>      <span class='Declare_Local'>childrelids</span><span class='Delimiter'>; 
</span> 
            <a href="prepjointree.c.html#LN202"><span class='Ref_To_Local'>newchild</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN60"><span class='Ref_to_Proto'>pull_up_sublinks_jointree_recurse</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN176"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                                         <a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN197"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                         <span class='Operator'>&</span><a href="prepjointree.c.html#LN203"><span class='Ref_To_Local'>childrelids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="prepjointree.c.html#LN193"><span class='Ref_To_Local'>newfromlist</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN193"><span class='Ref_To_Local'>newfromlist</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN202"><span class='Ref_To_Local'>newchild</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="prepjointree.c.html#LN194"><span class='Ref_To_Local'>frelids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN94"><span class='Ref_to_Proto'>bms_join</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN194"><span class='Ref_To_Local'>frelids</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN203"><span class='Ref_To_Local'>childrelids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* Build the replacement FromExpr; no quals yet */ 
</span>        <a href="prepjointree.c.html#LN195"><span class='Ref_To_Local'>newf</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/makefuncs.h.html#LN47"><span class='Ref_to_Proto'>makeFromExpr</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN193"><span class='Ref_To_Local'>newfromlist</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Set up a link representing the rebuilt jointree */ 
</span>        <a href="prepjointree.c.html#LN196"><span class='Ref_To_Local'>jtlink</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN195"><span class='Ref_To_Local'>newf</span></a><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Now process qual --- all children are available for use */ 
</span>        <a href="prepjointree.c.html#LN195"><span class='Ref_To_Local'>newf</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1470"><span class='Ref_to_Member'>quals</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN62"><span class='Ref_to_Proto'>pull_up_sublinks_qual_recurse</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN176"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN192"><span class='Ref_To_Local'>f</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1470"><span class='Ref_to_Member'>quals</span></a><span class='Delimiter'>, 
</span>                                                    <span class='Operator'>&</span><a href="prepjointree.c.html#LN196"><span class='Ref_To_Local'>jtlink</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN194"><span class='Ref_To_Local'>frelids</span></a><span class='Delimiter'>, 
</span>                                                    <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Note that the result will be either newf, or a stack of JoinExprs 
         * with newf at the base.  We rely on subsequent optimization steps to 
         * flatten this and rearrange the joins as needed. 
         * 
         * Although we could include the pulled-up subqueries in the returned 
         * relids, there's no need since upper quals couldn't refer to their 
         * outputs anyway. 
         */ 
</span>        <span class='Operator'>*</span><a href="prepjointree.c.html#LN177"><span class='Ref_to_Parameter'>relids</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN194"><span class='Ref_To_Local'>frelids</span></a><span class='Delimiter'>; 
</span>        <a href="prepjointree.c.html#LN176"><span class='Ref_to_Parameter'>jtnode</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN196"><span class='Ref_To_Local'>jtlink</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IsA(jtnode,FromExpr) &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN176"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN234"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>j</span><span class='Delimiter'>; 
</span><a name="LN235"></a>        <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a>      <span class='Declare_Local'>leftrelids</span><span class='Delimiter'>; 
</span><a name="LN236"></a>        <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a>      <span class='Declare_Local'>rightrelids</span><span class='Delimiter'>; 
</span><a name="LN237"></a>        <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>jtlink</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Make a modifiable copy of join node, but don't bother copying its 
         * subnodes (yet). 
         */ 
</span>        <a href="prepjointree.c.html#LN234"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><a href="prepjointree.c.html#LN234"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN176"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="prepjointree.c.html#LN237"><span class='Ref_To_Local'>jtlink</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN234"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Recurse to process children and collect their relids */ 
</span>        <a href="prepjointree.c.html#LN234"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1449"><span class='Ref_to_Member'>larg</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN60"><span class='Ref_to_Proto'>pull_up_sublinks_jointree_recurse</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN176"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN234"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1449"><span class='Ref_to_Member'>larg</span></a><span class='Delimiter'>, 
</span>                                                    <span class='Operator'>&</span><a href="prepjointree.c.html#LN235"><span class='Ref_To_Local'>leftrelids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepjointree.c.html#LN234"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1450"><span class='Ref_to_Member'>rarg</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN60"><span class='Ref_to_Proto'>pull_up_sublinks_jointree_recurse</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN176"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN234"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1450"><span class='Ref_to_Member'>rarg</span></a><span class='Delimiter'>, 
</span>                                                    <span class='Operator'>&</span><a href="prepjointree.c.html#LN236"><span class='Ref_To_Local'>rightrelids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Now process qual, showing appropriate child relids as available, 
         * and attach any pulled-up jointree items at the right place. In the 
         * inner-join case we put new JoinExprs above the existing one (much 
         * as for a FromExpr-style join).  In outer-join cases the new 
         * JoinExprs must go into the nullable side of the outer join. The 
         * point of the available_rels machinations is to ensure that we only 
         * pull up quals for which that's okay. 
         * 
         * We don't expect to see any pre-existing JOIN_SEMI or JOIN_ANTI 
         * nodes here. 
         */ 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN234"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1447"><span class='Ref_to_Member'>jointype</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN677"><span class='Ref_to_EnumConst'>JOIN_INNER</span></a><span class='Operator'>: 
</span>                <a href="prepjointree.c.html#LN234"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1452"><span class='Ref_to_Member'>quals</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN62"><span class='Ref_to_Proto'>pull_up_sublinks_qual_recurse</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN176"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN234"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1452"><span class='Ref_to_Member'>quals</span></a><span class='Delimiter'>, 
</span>                                                         <span class='Operator'>&</span><a href="prepjointree.c.html#LN237"><span class='Ref_To_Local'>jtlink</span></a><span class='Delimiter'>, 
</span>                                                         <a href="../../../include/nodes/bitmapset.h.html#LN70"><span class='Ref_to_Proto'>bms_union</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN235"><span class='Ref_To_Local'>leftrelids</span></a><span class='Delimiter'>, 
</span>                                                                <a href="prepjointree.c.html#LN236"><span class='Ref_To_Local'>rightrelids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                         <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN678"><span class='Ref_to_EnumConst'>JOIN_LEFT</span></a><span class='Operator'>: 
</span>                <a href="prepjointree.c.html#LN234"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1452"><span class='Ref_to_Member'>quals</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN62"><span class='Ref_to_Proto'>pull_up_sublinks_qual_recurse</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN176"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN234"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1452"><span class='Ref_to_Member'>quals</span></a><span class='Delimiter'>, 
</span>                                                         <span class='Operator'>&</span><a href="prepjointree.c.html#LN234"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1450"><span class='Ref_to_Member'>rarg</span></a><span class='Delimiter'>, 
</span>                                                         <a href="prepjointree.c.html#LN236"><span class='Ref_To_Local'>rightrelids</span></a><span class='Delimiter'>, 
</span>                                                         <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN679"><span class='Ref_to_EnumConst'>JOIN_FULL</span></a><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* can't do anything with full-join quals */ 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN680"><span class='Ref_to_EnumConst'>JOIN_RIGHT</span></a><span class='Operator'>: 
</span>                <a href="prepjointree.c.html#LN234"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1452"><span class='Ref_to_Member'>quals</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN62"><span class='Ref_to_Proto'>pull_up_sublinks_qual_recurse</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN176"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN234"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1452"><span class='Ref_to_Member'>quals</span></a><span class='Delimiter'>, 
</span>                                                         <span class='Operator'>&</span><a href="prepjointree.c.html#LN234"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1449"><span class='Ref_to_Member'>larg</span></a><span class='Delimiter'>, 
</span>                                                         <a href="prepjointree.c.html#LN235"><span class='Ref_To_Local'>leftrelids</span></a><span class='Delimiter'>, 
</span>                                                         <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized join type: %d"</span><span class='Delimiter'>, 
</span>                     <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN234"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1447"><span class='Ref_to_Member'>jointype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch j-&GT;jointype &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* 
         * Although we could include the pulled-up subqueries in the returned 
         * relids, there's no need since upper quals couldn't refer to their 
         * outputs anyway.  But we *do* need to include the join's own rtindex 
         * because we haven't yet collapsed join alias variables, so upper 
         * levels would mistakenly think they couldn't use references to this 
         * join. 
         */ 
</span>        <span class='Operator'>*</span><a href="prepjointree.c.html#LN177"><span class='Ref_to_Parameter'>relids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN94"><span class='Ref_to_Proto'>bms_join</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN235"><span class='Ref_To_Local'>leftrelids</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN236"><span class='Ref_To_Local'>rightrelids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN234"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1454"><span class='Ref_to_Member'>rtindex</span></a><span class='Parentheses'>) 
</span>            <span class='Operator'>*</span><a href="prepjointree.c.html#LN177"><span class='Ref_to_Parameter'>relids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN89"><span class='Ref_to_Proto'>bms_add_member</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="prepjointree.c.html#LN177"><span class='Ref_to_Parameter'>relids</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN234"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1454"><span class='Ref_to_Member'>rtindex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepjointree.c.html#LN176"><span class='Ref_to_Parameter'>jtnode</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN237"><span class='Ref_To_Local'>jtlink</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IsA(jtnode,JoinExpr) &raquo; </span> 
    <span class='Control'>else</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized node type: %d"</span><span class='Delimiter'>, 
</span>             <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="../../../include/nodes/nodes.h.html#LN513"><span class='Ref_to_Macro'>nodeTag</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN176"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="prepjointree.c.html#LN176"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pull_up_sublinks_jointree_recurse &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Recurse through top-level qual nodes for pull_up_sublinks() 
 * 
 * jtlink1 points to the link in the jointree where any new JoinExprs should 
 * be inserted if they reference available_rels1 (i.e., available_rels1 
 * denotes the relations present underneath jtlink1).  Optionally, jtlink2 can 
 * point to a second link where new JoinExprs should be inserted if they 
 * reference available_rels2 (pass NULL for both those arguments if not used). 
 * Note that SubLinks referencing both sets of variables cannot be optimized. 
 * If we find multiple pull-up-able SubLinks, they'll get stacked onto jtlink1 
 * and/or jtlink2 in the order we encounter them.  We rely on subsequent 
 * optimization to rearrange the stack if appropriate. 
 * 
 * Returns the replacement qual node, or NULL if the qual should be removed. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>* 
</span><a name="LN330"></a><span class='Declare_Function'>pull_up_sublinks_qual_recurse</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, 
</span><a name="LN331"></a>                              <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>jtlink1</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>available_rels1</span><span class='Delimiter'>, 
</span><a name="LN332"></a>                              <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>jtlink2</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>available_rels2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN330"><span class='Ref_to_Parameter'>node</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN330"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN629"><span class='Ref_to_Struct'>SubLink</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN338"></a>        <a href="../../../include/nodes/primnodes.h.html#LN629"><span class='Ref_to_Struct'>SubLink</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>sublink</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN629"><span class='Ref_to_Struct'>SubLink</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN330"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span><a name="LN339"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>j</span><span class='Delimiter'>; 
</span><a name="LN340"></a>        <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a>      <span class='Declare_Local'>child_rels</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Is it a convertible ANY or EXISTS clause? */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN338"><span class='Ref_To_Local'>sublink</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN632"><span class='Ref_to_Member'>subLinkType</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/primnodes.h.html#LN620"><span class='Ref_to_EnumConst'>ANY_SUBLINK</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="prepjointree.c.html#LN339"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/subselect.h.html#LN18"><span class='Ref_to_Proto'>convert_ANY_sublink_to_join</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN330"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN338"><span class='Ref_To_Local'>sublink</span></a><span class='Delimiter'>, 
</span>                                                 <a href="prepjointree.c.html#LN331"><span class='Ref_to_Parameter'>available_rels1</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Yes; insert the new join node into the join tree */ 
</span>                <a href="prepjointree.c.html#LN339"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1449"><span class='Ref_to_Member'>larg</span></a> <span class='Operator'>= *</span><a href="prepjointree.c.html#LN331"><span class='Ref_to_Parameter'>jtlink1</span></a><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><a href="prepjointree.c.html#LN331"><span class='Ref_to_Parameter'>jtlink1</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN339"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* Recursively process pulled-up jointree nodes */ 
</span>                <a href="prepjointree.c.html#LN339"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1450"><span class='Ref_to_Member'>rarg</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN60"><span class='Ref_to_Proto'>pull_up_sublinks_jointree_recurse</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN330"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                                            <a href="prepjointree.c.html#LN339"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1450"><span class='Ref_to_Member'>rarg</span></a><span class='Delimiter'>, 
</span>                                                            <span class='Operator'>&</span><a href="prepjointree.c.html#LN340"><span class='Ref_To_Local'>child_rels</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Now recursively process the pulled-up quals.  Any inserted 
                 * joins can get stacked onto either j-&GT;larg or j-&GT;rarg, 
                 * depending on which rels they reference. 
                 */ 
</span>                <a href="prepjointree.c.html#LN339"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1452"><span class='Ref_to_Member'>quals</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN62"><span class='Ref_to_Proto'>pull_up_sublinks_qual_recurse</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN330"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                                         <a href="prepjointree.c.html#LN339"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1452"><span class='Ref_to_Member'>quals</span></a><span class='Delimiter'>, 
</span>                                                         <span class='Operator'>&</span><a href="prepjointree.c.html#LN339"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1449"><span class='Ref_to_Member'>larg</span></a><span class='Delimiter'>, 
</span>                                                         <a href="prepjointree.c.html#LN331"><span class='Ref_to_Parameter'>available_rels1</span></a><span class='Delimiter'>, 
</span>                                                         <span class='Operator'>&</span><a href="prepjointree.c.html#LN339"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1450"><span class='Ref_to_Member'>rarg</span></a><span class='Delimiter'>, 
</span>                                                         <a href="prepjointree.c.html#LN340"><span class='Ref_To_Local'>child_rels</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* Return NULL representing constant TRUE */ 
</span>                <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if (j=convert_ANY_sublin... &raquo; </span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN332"><span class='Ref_to_Parameter'>available_rels2</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>                <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN339"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/subselect.h.html#LN18"><span class='Ref_to_Proto'>convert_ANY_sublink_to_join</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN330"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN338"><span class='Ref_To_Local'>sublink</span></a><span class='Delimiter'>, 
</span>                                                 <a href="prepjointree.c.html#LN332"><span class='Ref_to_Parameter'>available_rels2</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Yes; insert the new join node into the join tree */ 
</span>                <a href="prepjointree.c.html#LN339"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1449"><span class='Ref_to_Member'>larg</span></a> <span class='Operator'>= *</span><a href="prepjointree.c.html#LN332"><span class='Ref_to_Parameter'>jtlink2</span></a><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><a href="prepjointree.c.html#LN332"><span class='Ref_to_Parameter'>jtlink2</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN339"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* Recursively process pulled-up jointree nodes */ 
</span>                <a href="prepjointree.c.html#LN339"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1450"><span class='Ref_to_Member'>rarg</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN60"><span class='Ref_to_Proto'>pull_up_sublinks_jointree_recurse</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN330"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                                            <a href="prepjointree.c.html#LN339"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1450"><span class='Ref_to_Member'>rarg</span></a><span class='Delimiter'>, 
</span>                                                            <span class='Operator'>&</span><a href="prepjointree.c.html#LN340"><span class='Ref_To_Local'>child_rels</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Now recursively process the pulled-up quals.  Any inserted 
                 * joins can get stacked onto either j-&GT;larg or j-&GT;rarg, 
                 * depending on which rels they reference. 
                 */ 
</span>                <a href="prepjointree.c.html#LN339"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1452"><span class='Ref_to_Member'>quals</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN62"><span class='Ref_to_Proto'>pull_up_sublinks_qual_recurse</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN330"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                                         <a href="prepjointree.c.html#LN339"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1452"><span class='Ref_to_Member'>quals</span></a><span class='Delimiter'>, 
</span>                                                         <span class='Operator'>&</span><a href="prepjointree.c.html#LN339"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1449"><span class='Ref_to_Member'>larg</span></a><span class='Delimiter'>, 
</span>                                                         <a href="prepjointree.c.html#LN332"><span class='Ref_to_Parameter'>available_rels2</span></a><span class='Delimiter'>, 
</span>                                                         <span class='Operator'>&</span><a href="prepjointree.c.html#LN339"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1450"><span class='Ref_to_Member'>rarg</span></a><span class='Delimiter'>, 
</span>                                                         <a href="prepjointree.c.html#LN340"><span class='Ref_To_Local'>child_rels</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* Return NULL representing constant TRUE */ 
</span>                <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if available_rels2!=NULL... &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if sublink-&GT;subLinkType=... &raquo; </span> 
        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN338"><span class='Ref_To_Local'>sublink</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN632"><span class='Ref_to_Member'>subLinkType</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/primnodes.h.html#LN618"><span class='Ref_to_EnumConst'>EXISTS_SUBLINK</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="prepjointree.c.html#LN339"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/subselect.h.html#LN21"><span class='Ref_to_Proto'>convert_EXISTS_sublink_to_join</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN330"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN338"><span class='Ref_To_Local'>sublink</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                                    <a href="prepjointree.c.html#LN331"><span class='Ref_to_Parameter'>available_rels1</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Yes; insert the new join node into the join tree */ 
</span>                <a href="prepjointree.c.html#LN339"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1449"><span class='Ref_to_Member'>larg</span></a> <span class='Operator'>= *</span><a href="prepjointree.c.html#LN331"><span class='Ref_to_Parameter'>jtlink1</span></a><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><a href="prepjointree.c.html#LN331"><span class='Ref_to_Parameter'>jtlink1</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN339"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* Recursively process pulled-up jointree nodes */ 
</span>                <a href="prepjointree.c.html#LN339"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1450"><span class='Ref_to_Member'>rarg</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN60"><span class='Ref_to_Proto'>pull_up_sublinks_jointree_recurse</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN330"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                                            <a href="prepjointree.c.html#LN339"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1450"><span class='Ref_to_Member'>rarg</span></a><span class='Delimiter'>, 
</span>                                                            <span class='Operator'>&</span><a href="prepjointree.c.html#LN340"><span class='Ref_To_Local'>child_rels</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Now recursively process the pulled-up quals.  Any inserted 
                 * joins can get stacked onto either j-&GT;larg or j-&GT;rarg, 
                 * depending on which rels they reference. 
                 */ 
</span>                <a href="prepjointree.c.html#LN339"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1452"><span class='Ref_to_Member'>quals</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN62"><span class='Ref_to_Proto'>pull_up_sublinks_qual_recurse</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN330"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                                         <a href="prepjointree.c.html#LN339"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1452"><span class='Ref_to_Member'>quals</span></a><span class='Delimiter'>, 
</span>                                                         <span class='Operator'>&</span><a href="prepjointree.c.html#LN339"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1449"><span class='Ref_to_Member'>larg</span></a><span class='Delimiter'>, 
</span>                                                         <a href="prepjointree.c.html#LN331"><span class='Ref_to_Parameter'>available_rels1</span></a><span class='Delimiter'>, 
</span>                                                         <span class='Operator'>&</span><a href="prepjointree.c.html#LN339"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1450"><span class='Ref_to_Member'>rarg</span></a><span class='Delimiter'>, 
</span>                                                         <a href="prepjointree.c.html#LN340"><span class='Ref_To_Local'>child_rels</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* Return NULL representing constant TRUE */ 
</span>                <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if (j=convert_EXISTS_sub... &raquo; </span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN332"><span class='Ref_to_Parameter'>available_rels2</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>                <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN339"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/subselect.h.html#LN21"><span class='Ref_to_Proto'>convert_EXISTS_sublink_to_join</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN330"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN338"><span class='Ref_To_Local'>sublink</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                                    <a href="prepjointree.c.html#LN332"><span class='Ref_to_Parameter'>available_rels2</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Yes; insert the new join node into the join tree */ 
</span>                <a href="prepjointree.c.html#LN339"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1449"><span class='Ref_to_Member'>larg</span></a> <span class='Operator'>= *</span><a href="prepjointree.c.html#LN332"><span class='Ref_to_Parameter'>jtlink2</span></a><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><a href="prepjointree.c.html#LN332"><span class='Ref_to_Parameter'>jtlink2</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN339"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* Recursively process pulled-up jointree nodes */ 
</span>                <a href="prepjointree.c.html#LN339"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1450"><span class='Ref_to_Member'>rarg</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN60"><span class='Ref_to_Proto'>pull_up_sublinks_jointree_recurse</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN330"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                                            <a href="prepjointree.c.html#LN339"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1450"><span class='Ref_to_Member'>rarg</span></a><span class='Delimiter'>, 
</span>                                                            <span class='Operator'>&</span><a href="prepjointree.c.html#LN340"><span class='Ref_To_Local'>child_rels</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Now recursively process the pulled-up quals.  Any inserted 
                 * joins can get stacked onto either j-&GT;larg or j-&GT;rarg, 
                 * depending on which rels they reference. 
                 */ 
</span>                <a href="prepjointree.c.html#LN339"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1452"><span class='Ref_to_Member'>quals</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN62"><span class='Ref_to_Proto'>pull_up_sublinks_qual_recurse</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN330"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                                         <a href="prepjointree.c.html#LN339"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1452"><span class='Ref_to_Member'>quals</span></a><span class='Delimiter'>, 
</span>                                                         <span class='Operator'>&</span><a href="prepjointree.c.html#LN339"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1449"><span class='Ref_to_Member'>larg</span></a><span class='Delimiter'>, 
</span>                                                         <a href="prepjointree.c.html#LN332"><span class='Ref_to_Parameter'>available_rels2</span></a><span class='Delimiter'>, 
</span>                                                         <span class='Operator'>&</span><a href="prepjointree.c.html#LN339"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1450"><span class='Ref_to_Member'>rarg</span></a><span class='Delimiter'>, 
</span>                                                         <a href="prepjointree.c.html#LN340"><span class='Ref_To_Local'>child_rels</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* Return NULL representing constant TRUE */ 
</span>                <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if available_rels2!=NULL... &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if sublink-&GT;subLinkType=... &raquo; </span> 
        <span class='Comment_Multi_Line'>/* Else return it unmodified */ 
</span>        <span class='Control'>return</span> <a href="prepjointree.c.html#LN330"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IsA(node,SubLink) &raquo; </span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/optimizer/clauses.h.html#LN35"><span class='Ref_to_Proto'>not_clause</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN330"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* If the immediate argument of NOT is EXISTS, try to convert */ 
</span><a name="LN457"></a>        <a href="../../../include/nodes/primnodes.h.html#LN629"><span class='Ref_to_Struct'>SubLink</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>sublink</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN629"><span class='Ref_to_Struct'>SubLink</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/optimizer/clauses.h.html#LN37"><span class='Ref_to_Proto'>get_notclausearg</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN330"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN458"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>j</span><span class='Delimiter'>; 
</span><a name="LN459"></a>        <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a>      <span class='Declare_Local'>child_rels</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN457"><span class='Ref_To_Local'>sublink</span></a> <span class='Operator'>&& </span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN457"><span class='Ref_To_Local'>sublink</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN629"><span class='Ref_to_Struct'>SubLink</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN457"><span class='Ref_To_Local'>sublink</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN632"><span class='Ref_to_Member'>subLinkType</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/primnodes.h.html#LN618"><span class='Ref_to_EnumConst'>EXISTS_SUBLINK</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="prepjointree.c.html#LN458"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/subselect.h.html#LN21"><span class='Ref_to_Proto'>convert_EXISTS_sublink_to_join</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN330"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN457"><span class='Ref_To_Local'>sublink</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                                   <a href="prepjointree.c.html#LN331"><span class='Ref_to_Parameter'>available_rels1</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* Yes; insert the new join node into the join tree */ 
</span>                    <a href="prepjointree.c.html#LN458"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1449"><span class='Ref_to_Member'>larg</span></a> <span class='Operator'>= *</span><a href="prepjointree.c.html#LN331"><span class='Ref_to_Parameter'>jtlink1</span></a><span class='Delimiter'>; 
</span>                    <span class='Operator'>*</span><a href="prepjointree.c.html#LN331"><span class='Ref_to_Parameter'>jtlink1</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN458"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>; 
</span>                    <span class='Comment_Multi_Line'>/* Recursively process pulled-up jointree nodes */ 
</span>                    <a href="prepjointree.c.html#LN458"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1450"><span class='Ref_to_Member'>rarg</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN60"><span class='Ref_to_Proto'>pull_up_sublinks_jointree_recurse</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN330"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                                                <a href="prepjointree.c.html#LN458"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1450"><span class='Ref_to_Member'>rarg</span></a><span class='Delimiter'>, 
</span>                                                                <span class='Operator'>&</span><a href="prepjointree.c.html#LN459"><span class='Ref_To_Local'>child_rels</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * Now recursively process the pulled-up quals.  Because 
                     * we are underneath a NOT, we can't pull up sublinks that 
                     * reference the left-hand stuff, but it's still okay to 
                     * pull up sublinks referencing j-&GT;rarg. 
                     */ 
</span>                    <a href="prepjointree.c.html#LN458"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1452"><span class='Ref_to_Member'>quals</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN62"><span class='Ref_to_Proto'>pull_up_sublinks_qual_recurse</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN330"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                                             <a href="prepjointree.c.html#LN458"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1452"><span class='Ref_to_Member'>quals</span></a><span class='Delimiter'>, 
</span>                                                             <span class='Operator'>&</span><a href="prepjointree.c.html#LN458"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1450"><span class='Ref_to_Member'>rarg</span></a><span class='Delimiter'>, 
</span>                                                             <a href="prepjointree.c.html#LN459"><span class='Ref_To_Local'>child_rels</span></a><span class='Delimiter'>, 
</span>                                                             <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Comment_Multi_Line'>/* Return NULL representing constant TRUE */ 
</span>                    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if (j=convert_EXISTS_sub... &raquo; </span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN332"><span class='Ref_to_Parameter'>available_rels2</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>                    <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN458"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/subselect.h.html#LN21"><span class='Ref_to_Proto'>convert_EXISTS_sublink_to_join</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN330"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN457"><span class='Ref_To_Local'>sublink</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                                   <a href="prepjointree.c.html#LN332"><span class='Ref_to_Parameter'>available_rels2</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* Yes; insert the new join node into the join tree */ 
</span>                    <a href="prepjointree.c.html#LN458"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1449"><span class='Ref_to_Member'>larg</span></a> <span class='Operator'>= *</span><a href="prepjointree.c.html#LN332"><span class='Ref_to_Parameter'>jtlink2</span></a><span class='Delimiter'>; 
</span>                    <span class='Operator'>*</span><a href="prepjointree.c.html#LN332"><span class='Ref_to_Parameter'>jtlink2</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN458"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>; 
</span>                    <span class='Comment_Multi_Line'>/* Recursively process pulled-up jointree nodes */ 
</span>                    <a href="prepjointree.c.html#LN458"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1450"><span class='Ref_to_Member'>rarg</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN60"><span class='Ref_to_Proto'>pull_up_sublinks_jointree_recurse</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN330"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                                                <a href="prepjointree.c.html#LN458"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1450"><span class='Ref_to_Member'>rarg</span></a><span class='Delimiter'>, 
</span>                                                                <span class='Operator'>&</span><a href="prepjointree.c.html#LN459"><span class='Ref_To_Local'>child_rels</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * Now recursively process the pulled-up quals.  Because 
                     * we are underneath a NOT, we can't pull up sublinks that 
                     * reference the left-hand stuff, but it's still okay to 
                     * pull up sublinks referencing j-&GT;rarg. 
                     */ 
</span>                    <a href="prepjointree.c.html#LN458"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1452"><span class='Ref_to_Member'>quals</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN62"><span class='Ref_to_Proto'>pull_up_sublinks_qual_recurse</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN330"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                                             <a href="prepjointree.c.html#LN458"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1452"><span class='Ref_to_Member'>quals</span></a><span class='Delimiter'>, 
</span>                                                             <span class='Operator'>&</span><a href="prepjointree.c.html#LN458"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1450"><span class='Ref_to_Member'>rarg</span></a><span class='Delimiter'>, 
</span>                                                             <a href="prepjointree.c.html#LN459"><span class='Ref_To_Local'>child_rels</span></a><span class='Delimiter'>, 
</span>                                                             <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Comment_Multi_Line'>/* Return NULL representing constant TRUE */ 
</span>                    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if available_rels2!=NULL... &raquo; </span> 
            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if sublink-&GT;subLinkType=... &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if sublink&&IsA(sublink,... &raquo; </span> 
        <span class='Comment_Multi_Line'>/* Else return it unmodified */ 
</span>        <span class='Control'>return</span> <a href="prepjointree.c.html#LN330"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if not_clause(node) &raquo; </span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/optimizer/clauses.h.html#LN42"><span class='Ref_to_Proto'>and_clause</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN330"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Recurse into AND clause */ 
</span><a name="LN524"></a>        <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>newclauses</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN525"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN525"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN557"><span class='Ref_to_Struct'>BoolExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN330"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>args<span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><a name="LN529"></a>            <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>oldclause</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN525"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN530"></a>            <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>newclause</span><span class='Delimiter'>; 
</span> 
            <a href="prepjointree.c.html#LN530"><span class='Ref_To_Local'>newclause</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN62"><span class='Ref_to_Proto'>pull_up_sublinks_qual_recurse</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN330"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                                      <a href="prepjointree.c.html#LN529"><span class='Ref_To_Local'>oldclause</span></a><span class='Delimiter'>, 
</span>                                                      <a href="prepjointree.c.html#LN331"><span class='Ref_to_Parameter'>jtlink1</span></a><span class='Delimiter'>, 
</span>                                                      <a href="prepjointree.c.html#LN331"><span class='Ref_to_Parameter'>available_rels1</span></a><span class='Delimiter'>, 
</span>                                                      <a href="prepjointree.c.html#LN332"><span class='Ref_to_Parameter'>jtlink2</span></a><span class='Delimiter'>, 
</span>                                                      <a href="prepjointree.c.html#LN332"><span class='Ref_to_Parameter'>available_rels2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN530"><span class='Ref_To_Local'>newclause</span></a><span class='Parentheses'>) 
</span>                <a href="prepjointree.c.html#LN524"><span class='Ref_To_Local'>newclauses</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN524"><span class='Ref_To_Local'>newclauses</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN530"><span class='Ref_To_Local'>newclause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* We might have got back fewer clauses than we started with */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN524"><span class='Ref_To_Local'>newclauses</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN524"><span class='Ref_To_Local'>newclauses</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN524"><span class='Ref_To_Local'>newclauses</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/optimizer/clauses.h.html#LN43"><span class='Ref_to_Proto'>make_andclause</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN524"><span class='Ref_To_Local'>newclauses</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if and_clause(node) &raquo; </span> 
    <span class='Comment_Multi_Line'>/* Stop if not an AND */ 
</span>    <span class='Control'>return</span> <a href="prepjointree.c.html#LN330"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pull_up_sublinks_qual_recurse &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * inline_set_returning_functions 
 *      Attempt to "inline" set-returning functions in the FROM clause. 
 * 
 * If an RTE_FUNCTION rtable entry invokes a set-returning function that 
 * contains just a simple SELECT, we can convert the rtable entry to an 
 * RTE_SUBQUERY entry exposing the SELECT directly.  This is especially 
 * useful if the subquery can then be "pulled up" for further optimization, 
 * but we do it even if not, to reduce executor overhead. 
 * 
 * This has to be done before we have started to do any optimization of 
 * subqueries, else any such steps wouldn't get applied to subqueries 
 * obtained via inlining.  However, we do it after pull_up_sublinks 
 * so that we can inline any functions used in SubLink subselects. 
 * 
 * Like most of the planner, this feels free to scribble on its input data 
 * structure. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN572"></a><span class='Declare_Function'>inline_set_returning_functions</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN574"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>rt</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN574"><span class='Ref_To_Local'>rt</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN572"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN134"><span class='Ref_to_Member'>rtable</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN578"></a>        <a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rte</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN574"><span class='Ref_To_Local'>rt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN578"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN936"><span class='Ref_to_Member'>rtekind</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/parsenodes.h.html#LN925"><span class='Ref_to_EnumConst'>RTE_FUNCTION</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN582"></a>            <a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>funcquery</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Check safety of expansion, and expand if possible */ 
</span>            <a href="prepjointree.c.html#LN582"><span class='Ref_To_Local'>funcquery</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/clauses.h.html#LN84"><span class='Ref_to_Proto'>inline_set_returning_function</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN572"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN578"><span class='Ref_To_Local'>rte</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN582"><span class='Ref_To_Local'>funcquery</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Successful expansion, replace the rtable entry */ 
</span>                <a href="prepjointree.c.html#LN578"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN936"><span class='Ref_to_Member'>rtekind</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/parsenodes.h.html#LN923"><span class='Ref_to_EnumConst'>RTE_SUBQUERY</span></a><span class='Delimiter'>; 
</span>                <a href="prepjointree.c.html#LN578"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN954"><span class='Ref_to_Member'>subquery</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN582"><span class='Ref_To_Local'>funcquery</span></a><span class='Delimiter'>; 
</span>                <a href="prepjointree.c.html#LN578"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN985"><span class='Ref_to_Member'>functions</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end inline_set_returning_functions &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * pull_up_subqueries 
 *      Look for subqueries in the rangetable that can be pulled up into 
 *      the parent query.  If the subquery has no special features like 
 *      grouping/aggregation then we can merge it into the parent's jointree. 
 *      Also, subqueries that are simple UNION ALL structures can be 
 *      converted into "append relations". 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN606"></a><span class='Declare_Function'>pull_up_subqueries</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Top level of jointree must always be a FromExpr */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN606"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN135"><span class='Ref_to_Member'>jointree</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1466"><span class='Ref_to_Struct'>FromExpr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Reset flag saying we need a deletion cleanup pass */ 
</span>    <a href="prepjointree.c.html#LN606"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN300"><span class='Ref_to_Member'>hasDeletedRTEs</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Recursion starts with no containing join nor appendrel */ 
</span>    <a href="prepjointree.c.html#LN606"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN135"><span class='Ref_to_Member'>jointree</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1466"><span class='Ref_to_Struct'>FromExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>        <a href="prepjointree.c.html#LN65"><span class='Ref_to_Proto'>pull_up_subqueries_recurse</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN606"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN606"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN135"><span class='Ref_to_Member'>jointree</span></a><span class='Delimiter'>, 
</span>                                   <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Apply cleanup phase if necessary */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN606"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN300"><span class='Ref_to_Member'>hasDeletedRTEs</span></a><span class='Parentheses'>) 
</span>        <a href="prepjointree.c.html#LN606"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN135"><span class='Ref_to_Member'>jointree</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1466"><span class='Ref_to_Struct'>FromExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>            <a href="prepjointree.c.html#LN105"><span class='Ref_to_Proto'>pull_up_subqueries_cleanup</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN606"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN135"><span class='Ref_to_Member'>jointree</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN606"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN135"><span class='Ref_to_Member'>jointree</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1466"><span class='Ref_to_Struct'>FromExpr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * pull_up_subqueries_recurse 
 *      Recursive guts of pull_up_subqueries. 
 * 
 * This recursively processes the jointree and returns a modified jointree. 
 * Or, if it's valid to drop the current node from the jointree completely, 
 * it returns NULL. 
 * 
 * If this jointree node is within either side of an outer join, then 
 * lowest_outer_join references the lowest such JoinExpr node; otherwise 
 * it is NULL.  We use this to constrain the effects of LATERAL subqueries. 
 * 
 * If this jointree node is within the nullable side of an outer join, then 
 * lowest_nulling_outer_join references the lowest such JoinExpr node; 
 * otherwise it is NULL.  This forces use of the PlaceHolderVar mechanism for 
 * references to non-nullable targetlist items, but only for references above 
 * that join. 
 * 
 * If we are looking at a member subquery of an append relation, 
 * containing_appendrel describes that relation; else it is NULL. 
 * This forces use of the PlaceHolderVar mechanism for all non-Var targetlist 
 * items, and puts some additional restrictions on what can be pulled up. 
 * 
 * deletion_ok is TRUE if the caller can cope with us returning NULL for a 
 * deletable leaf node (for example, a VALUES RTE that could be pulled up). 
 * If it's FALSE, we'll avoid pullup in such cases. 
 * 
 * A tricky aspect of this code is that if we pull up a subquery we have 
 * to replace Vars that reference the subquery's outputs throughout the 
 * parent query, including quals attached to jointree nodes above the one 
 * we are currently processing!  We handle this by being careful not to 
 * change the jointree structure while recursing: no nodes other than leaf 
 * RangeTblRef entries and entirely-empty FromExprs will be replaced or 
 * deleted.  Also, we can't turn pullup_replace_vars loose on the whole 
 * jointree, because it'll return a mutated copy of the tree; we have to 
 * invoke it just on the quals, instead.  This behavior is what makes it 
 * reasonable to pass lowest_outer_join and lowest_nulling_outer_join as 
 * pointers rather than some more-indirect way of identifying the lowest 
 * OJs.  Likewise, we don't replace append_rel_list members but only their 
 * substructure, so the containing_appendrel reference is safe to use. 
 * 
 * Because of the rule that no jointree nodes with substructure can be 
 * replaced, we cannot fully handle the case of deleting nodes from the tree: 
 * when we delete one child of a JoinExpr, we need to replace the JoinExpr 
 * with a FromExpr, and that can't happen here.  Instead, we set the 
 * root-&GT;hasDeletedRTEs flag, which tells pull_up_subqueries() that an 
 * additional pass over the tree is needed to clean up. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>* 
</span><a name="LN672"></a><span class='Declare_Function'>pull_up_subqueries_recurse</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jtnode</span><span class='Delimiter'>, 
</span><a name="LN673"></a>                           <a href="../../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lowest_outer_join</span><span class='Delimiter'>, 
</span><a name="LN674"></a>                           <a href="../../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lowest_nulling_outer_join</span><span class='Delimiter'>, 
</span><a name="LN675"></a>                           <a href="../../../include/nodes/relation.h.html#LN1964"><span class='Ref_to_Struct'>AppendRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>containing_appendrel</span><span class='Delimiter'>, 
</span><a name="LN676"></a>                           <span class='Keyword'>bool </span><span class='Declare_Parameter'>deletion_ok</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN672"><span class='Ref_to_Parameter'>jtnode</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN672"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1415"><span class='Ref_to_Struct'>RangeTblRef</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN681"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>varno</span> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN1415"><span class='Ref_to_Struct'>RangeTblRef</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN672"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>rtindex<span class='Delimiter'>; 
</span><a name="LN682"></a>        <a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rte</span> <span class='Operator'>= </span><a href="../../../include/parser/parsetree.h.html#LN30"><span class='Ref_to_Macro'>rt_fetch</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN681"><span class='Ref_To_Local'>varno</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN672"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN134"><span class='Ref_to_Member'>rtable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Is this a subquery RTE, and if so, is the subquery simple enough to 
         * pull up? 
         * 
         * If we are looking at an append-relation member, we can't pull it up 
         * unless is_safe_append_member says so. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN682"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN936"><span class='Ref_to_Member'>rtekind</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/parsenodes.h.html#LN923"><span class='Ref_to_EnumConst'>RTE_SUBQUERY</span></a> <span class='Operator'>&& 
</span>            <a href="prepjointree.c.html#LN83"><span class='Ref_to_Proto'>is_simple_subquery</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN682"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN954"><span class='Ref_to_Member'>subquery</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN682"><span class='Ref_To_Local'>rte</span></a><span class='Delimiter'>, 
</span>                               <a href="prepjointree.c.html#LN673"><span class='Ref_to_Parameter'>lowest_outer_join</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN676"><span class='Ref_to_Parameter'>deletion_ok</span></a><span class='Parentheses'>)</span> <span class='Operator'>&& 
</span>            <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN675"><span class='Ref_to_Parameter'>containing_appendrel</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| 
</span>             <a href="prepjointree.c.html#LN93"><span class='Ref_to_Proto'>is_safe_append_member</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN682"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN954"><span class='Ref_to_Member'>subquery</span></a><span class='Parentheses'>)))</span> 
            <span class='Control'>return</span> <a href="prepjointree.c.html#LN70"><span class='Ref_to_Proto'>pull_up_simple_subquery</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN672"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN672"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN682"><span class='Ref_To_Local'>rte</span></a><span class='Delimiter'>, 
</span>                                           <a href="prepjointree.c.html#LN673"><span class='Ref_to_Parameter'>lowest_outer_join</span></a><span class='Delimiter'>, 
</span>                                           <a href="prepjointree.c.html#LN674"><span class='Ref_to_Parameter'>lowest_nulling_outer_join</span></a><span class='Delimiter'>, 
</span>                                           <a href="prepjointree.c.html#LN675"><span class='Ref_to_Parameter'>containing_appendrel</span></a><span class='Delimiter'>, 
</span>                                           <a href="prepjointree.c.html#LN676"><span class='Ref_to_Parameter'>deletion_ok</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Alternatively, is it a simple UNION ALL subquery?  If so, flatten 
         * into an "append relation". 
         * 
         * It's safe to do this regardless of whether this query is itself an 
         * appendrel member.  (If you're thinking we should try to flatten the 
         * two levels of appendrel together, you're right; but we handle that 
         * in set_append_rel_pathlist, not here.) 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN682"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN936"><span class='Ref_to_Member'>rtekind</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/parsenodes.h.html#LN923"><span class='Ref_to_EnumConst'>RTE_SUBQUERY</span></a> <span class='Operator'>&& 
</span>            <a href="prepjointree.c.html#LN90"><span class='Ref_to_Proto'>is_simple_union_all</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN682"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN954"><span class='Ref_to_Member'>subquery</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <a href="prepjointree.c.html#LN76"><span class='Ref_to_Proto'>pull_up_simple_union_all</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN672"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN672"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN682"><span class='Ref_To_Local'>rte</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Or perhaps it's a simple VALUES RTE? 
         * 
         * We don't allow VALUES pullup below an outer join nor into an 
         * appendrel (such cases are impossible anyway at the moment). 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN682"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN936"><span class='Ref_to_Member'>rtekind</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/parsenodes.h.html#LN927"><span class='Ref_to_EnumConst'>RTE_VALUES</span></a> <span class='Operator'>&& 
</span>            <a href="prepjointree.c.html#LN673"><span class='Ref_to_Parameter'>lowest_outer_join</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>            <a href="prepjointree.c.html#LN675"><span class='Ref_to_Parameter'>containing_appendrel</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>            <a href="prepjointree.c.html#LN88"><span class='Ref_to_Proto'>is_simple_values</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN672"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN682"><span class='Ref_To_Local'>rte</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN676"><span class='Ref_to_Parameter'>deletion_ok</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <a href="prepjointree.c.html#LN86"><span class='Ref_to_Proto'>pull_up_simple_values</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN672"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN672"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN682"><span class='Ref_To_Local'>rte</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Otherwise, do nothing at this node. */ 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IsA(jtnode,RangeTblRe... &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN672"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1466"><span class='Ref_to_Struct'>FromExpr</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN731"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1466"><span class='Ref_to_Struct'>FromExpr</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>f</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1466"><span class='Ref_to_Struct'>FromExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN672"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>; 
</span><a name="LN732"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>have_undeleted_child</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN733"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN675"><span class='Ref_to_Parameter'>containing_appendrel</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If the FromExpr has quals, it's not deletable even if its parent 
         * would allow deletion. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN731"><span class='Ref_To_Local'>f</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1470"><span class='Ref_to_Member'>quals</span></a><span class='Parentheses'>) 
</span>            <a href="prepjointree.c.html#LN676"><span class='Ref_to_Parameter'>deletion_ok</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN733"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN731"><span class='Ref_To_Local'>f</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1469"><span class='Ref_to_Member'>fromlist</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * In a non-deletable FromExpr, we can allow deletion of child 
             * nodes so long as at least one child remains; so it's okay 
             * either if any previous child survives, or if there's more to 
             * come.  If all children are deletable in themselves, we'll force 
             * the last one to remain unflattened. 
             * 
             * As a separate matter, we can allow deletion of all children of 
             * the top-level FromExpr in a query, since that's a special case 
             * anyway. 
             */ 
</span><a name="LN757"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>sub_deletion_ok</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN676"><span class='Ref_to_Parameter'>deletion_ok</span></a> <span class='Operator'>|| 
</span>                                           <a href="prepjointree.c.html#LN732"><span class='Ref_To_Local'>have_undeleted_child</span></a> <span class='Operator'>|| 
</span>                                           <a href="../../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN733"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>|| 
</span>                                           <a href="prepjointree.c.html#LN731"><span class='Ref_To_Local'>f</span></a> <span class='Operator'>== </span><a href="prepjointree.c.html#LN672"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN135"><span class='Ref_to_Member'>jointree</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN733"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>) </span><span class='Operator'>= </span><a href="prepjointree.c.html#LN65"><span class='Ref_to_Proto'>pull_up_subqueries_recurse</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN672"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN733"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                   <a href="prepjointree.c.html#LN673"><span class='Ref_to_Parameter'>lowest_outer_join</span></a><span class='Delimiter'>, 
</span>                                                   <a href="prepjointree.c.html#LN674"><span class='Ref_to_Parameter'>lowest_nulling_outer_join</span></a><span class='Delimiter'>, 
</span>                                                   <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                                   <a href="prepjointree.c.html#LN757"><span class='Ref_To_Local'>sub_deletion_ok</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN733"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
                <a href="prepjointree.c.html#LN732"><span class='Ref_To_Local'>have_undeleted_child</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN676"><span class='Ref_to_Parameter'>deletion_ok</span></a> <span class='Operator'>&& !</span><a href="prepjointree.c.html#LN732"><span class='Ref_To_Local'>have_undeleted_child</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* OK to delete this FromExpr entirely */ 
</span>            <a href="prepjointree.c.html#LN672"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN300"><span class='Ref_to_Member'>hasDeletedRTEs</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* probably is set already */ 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IsA(jtnode,FromExpr) &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN672"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN780"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>j</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN672"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN675"><span class='Ref_to_Parameter'>containing_appendrel</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Recurse, being careful to tell myself when inside outer join */ 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN780"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1447"><span class='Ref_to_Member'>jointype</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN677"><span class='Ref_to_EnumConst'>JOIN_INNER</span></a><span class='Operator'>: 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * INNER JOIN can allow deletion of either child node, but not 
                 * both.  So right child gets permission to delete only if 
                 * left child didn't get removed. 
                 */ 
</span>                <a href="prepjointree.c.html#LN780"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1449"><span class='Ref_to_Member'>larg</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN65"><span class='Ref_to_Proto'>pull_up_subqueries_recurse</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN672"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN780"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1449"><span class='Ref_to_Member'>larg</span></a><span class='Delimiter'>, 
</span>                                                     <a href="prepjointree.c.html#LN673"><span class='Ref_to_Parameter'>lowest_outer_join</span></a><span class='Delimiter'>, 
</span>                                                   <a href="prepjointree.c.html#LN674"><span class='Ref_to_Parameter'>lowest_nulling_outer_join</span></a><span class='Delimiter'>, 
</span>                                                     <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                                     <span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="prepjointree.c.html#LN780"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1450"><span class='Ref_to_Member'>rarg</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN65"><span class='Ref_to_Proto'>pull_up_subqueries_recurse</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN672"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN780"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1450"><span class='Ref_to_Member'>rarg</span></a><span class='Delimiter'>, 
</span>                                                     <a href="prepjointree.c.html#LN673"><span class='Ref_to_Parameter'>lowest_outer_join</span></a><span class='Delimiter'>, 
</span>                                                   <a href="prepjointree.c.html#LN674"><span class='Ref_to_Parameter'>lowest_nulling_outer_join</span></a><span class='Delimiter'>, 
</span>                                                     <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                                     <a href="prepjointree.c.html#LN780"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1449"><span class='Ref_to_Member'>larg</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN678"><span class='Ref_to_EnumConst'>JOIN_LEFT</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN691"><span class='Ref_to_EnumConst'>JOIN_SEMI</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN692"><span class='Ref_to_EnumConst'>JOIN_ANTI</span></a><span class='Operator'>: 
</span>                <a href="prepjointree.c.html#LN780"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1449"><span class='Ref_to_Member'>larg</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN65"><span class='Ref_to_Proto'>pull_up_subqueries_recurse</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN672"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN780"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1449"><span class='Ref_to_Member'>larg</span></a><span class='Delimiter'>, 
</span>                                                     <a href="prepjointree.c.html#LN780"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>, 
</span>                                                   <a href="prepjointree.c.html#LN674"><span class='Ref_to_Parameter'>lowest_nulling_outer_join</span></a><span class='Delimiter'>, 
</span>                                                     <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                                     <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="prepjointree.c.html#LN780"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1450"><span class='Ref_to_Member'>rarg</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN65"><span class='Ref_to_Proto'>pull_up_subqueries_recurse</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN672"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN780"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1450"><span class='Ref_to_Member'>rarg</span></a><span class='Delimiter'>, 
</span>                                                     <a href="prepjointree.c.html#LN780"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>, 
</span>                                                     <a href="prepjointree.c.html#LN780"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>, 
</span>                                                     <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                                     <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN679"><span class='Ref_to_EnumConst'>JOIN_FULL</span></a><span class='Operator'>: 
</span>                <a href="prepjointree.c.html#LN780"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1449"><span class='Ref_to_Member'>larg</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN65"><span class='Ref_to_Proto'>pull_up_subqueries_recurse</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN672"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN780"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1449"><span class='Ref_to_Member'>larg</span></a><span class='Delimiter'>, 
</span>                                                     <a href="prepjointree.c.html#LN780"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>, 
</span>                                                     <a href="prepjointree.c.html#LN780"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>, 
</span>                                                     <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                                     <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="prepjointree.c.html#LN780"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1450"><span class='Ref_to_Member'>rarg</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN65"><span class='Ref_to_Proto'>pull_up_subqueries_recurse</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN672"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN780"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1450"><span class='Ref_to_Member'>rarg</span></a><span class='Delimiter'>, 
</span>                                                     <a href="prepjointree.c.html#LN780"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>, 
</span>                                                     <a href="prepjointree.c.html#LN780"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>, 
</span>                                                     <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                                     <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN680"><span class='Ref_to_EnumConst'>JOIN_RIGHT</span></a><span class='Operator'>: 
</span>                <a href="prepjointree.c.html#LN780"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1449"><span class='Ref_to_Member'>larg</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN65"><span class='Ref_to_Proto'>pull_up_subqueries_recurse</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN672"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN780"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1449"><span class='Ref_to_Member'>larg</span></a><span class='Delimiter'>, 
</span>                                                     <a href="prepjointree.c.html#LN780"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>, 
</span>                                                     <a href="prepjointree.c.html#LN780"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>, 
</span>                                                     <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                                     <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="prepjointree.c.html#LN780"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1450"><span class='Ref_to_Member'>rarg</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN65"><span class='Ref_to_Proto'>pull_up_subqueries_recurse</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN672"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN780"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1450"><span class='Ref_to_Member'>rarg</span></a><span class='Delimiter'>, 
</span>                                                     <a href="prepjointree.c.html#LN780"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>, 
</span>                                                   <a href="prepjointree.c.html#LN674"><span class='Ref_to_Parameter'>lowest_nulling_outer_join</span></a><span class='Delimiter'>, 
</span>                                                     <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                                     <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized join type: %d"</span><span class='Delimiter'>, 
</span>                     <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN780"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1447"><span class='Ref_to_Member'>jointype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch j-&GT;jointype &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IsA(jtnode,JoinExpr) &raquo; </span> 
    <span class='Control'>else</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized node type: %d"</span><span class='Delimiter'>, 
</span>             <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="../../../include/nodes/nodes.h.html#LN513"><span class='Ref_to_Macro'>nodeTag</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN672"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="prepjointree.c.html#LN672"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pull_up_subqueries_recurse &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * pull_up_simple_subquery 
 *      Attempt to pull up a single simple subquery. 
 * 
 * jtnode is a RangeTblRef that has been tentatively identified as a simple 
 * subquery by pull_up_subqueries.  We return the replacement jointree node, 
 * or NULL if the subquery can be deleted entirely, or jtnode itself if we 
 * determine that the subquery can't be pulled up after all. 
 * 
 * rte is the RangeTblEntry referenced by jtnode.  Remaining parameters are 
 * as for pull_up_subqueries_recurse. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>* 
</span><a name="LN867"></a><span class='Declare_Function'>pull_up_simple_subquery</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jtnode</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rte</span><span class='Delimiter'>, 
</span><a name="LN868"></a>                        <a href="../../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lowest_outer_join</span><span class='Delimiter'>, 
</span><a name="LN869"></a>                        <a href="../../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lowest_nulling_outer_join</span><span class='Delimiter'>, 
</span><a name="LN870"></a>                        <a href="../../../include/nodes/relation.h.html#LN1964"><span class='Ref_to_Struct'>AppendRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>containing_appendrel</span><span class='Delimiter'>, 
</span><a name="LN871"></a>                        <span class='Keyword'>bool </span><span class='Declare_Parameter'>deletion_ok</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN873"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>parse</span> <span class='Operator'>= </span><a href="prepjointree.c.html#LN867"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Delimiter'>; 
</span><a name="LN874"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>varno</span> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN1415"><span class='Ref_to_Struct'>RangeTblRef</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN867"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>rtindex<span class='Delimiter'>; 
</span><a name="LN875"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>subquery</span><span class='Delimiter'>; 
</span><a name="LN876"></a>    <a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>subroot</span><span class='Delimiter'>; 
</span><a name="LN877"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>rtoffset</span><span class='Delimiter'>; 
</span><a name="LN878"></a>    <a href="prepjointree.c.html#LN39"><span class='Ref_to_Struct'>pullup_replace_vars_context</span></a> <span class='Declare_Local'>rvcontext</span><span class='Delimiter'>; 
</span><a name="LN879"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Need a modifiable copy of the subquery to hack on.  Even if we didn't 
     * sometimes choose not to pull up below, we must do this to avoid 
     * problems if the same subquery is referenced from multiple jointree 
     * items (which can't happen normally, but might after rule rewriting). 
     */ 
</span>    <a href="prepjointree.c.html#LN875"><span class='Ref_To_Local'>subquery</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN867"><span class='Ref_to_Parameter'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN954"><span class='Ref_to_Member'>subquery</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Create a PlannerInfo data structure for this subquery. 
     * 
     * NOTE: the next few steps should match the first processing in 
     * subquery_planner().  Can we refactor to avoid code duplication, or 
     * would that just make things uglier? 
     */ 
</span>    <a href="prepjointree.c.html#LN876"><span class='Ref_To_Local'>subroot</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="prepjointree.c.html#LN876"><span class='Ref_To_Local'>subroot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN875"><span class='Ref_To_Local'>subquery</span></a><span class='Delimiter'>; 
</span>    <a href="prepjointree.c.html#LN876"><span class='Ref_To_Local'>subroot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN867"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Delimiter'>; 
</span>    <a href="prepjointree.c.html#LN876"><span class='Ref_To_Local'>subroot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN158"><span class='Ref_to_Member'>query_level</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN867"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN158"><span class='Ref_to_Member'>query_level</span></a><span class='Delimiter'>; 
</span>    <a href="prepjointree.c.html#LN876"><span class='Ref_To_Local'>subroot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN160"><span class='Ref_to_Member'>parent_root</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN867"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN160"><span class='Ref_to_Member'>parent_root</span></a><span class='Delimiter'>; 
</span>    <a href="prepjointree.c.html#LN876"><span class='Ref_To_Local'>subroot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN168"><span class='Ref_to_Member'>plan_params</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="prepjointree.c.html#LN876"><span class='Ref_To_Local'>subroot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN169"><span class='Ref_to_Member'>outer_params</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="prepjointree.c.html#LN876"><span class='Ref_To_Local'>subroot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN286"><span class='Ref_to_Member'>planner_cxt</span></a> <span class='Operator'>= </span><a href="../../utils/mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>; 
</span>    <a href="prepjointree.c.html#LN876"><span class='Ref_To_Local'>subroot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN227"><span class='Ref_to_Member'>init_plans</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="prepjointree.c.html#LN876"><span class='Ref_To_Local'>subroot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN229"><span class='Ref_to_Member'>cte_plan_ids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="prepjointree.c.html#LN876"><span class='Ref_To_Local'>subroot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN231"><span class='Ref_to_Member'>multiexpr_params</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="prepjointree.c.html#LN876"><span class='Ref_To_Local'>subroot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN234"><span class='Ref_to_Member'>eq_classes</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="prepjointree.c.html#LN876"><span class='Ref_To_Local'>subroot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN251"><span class='Ref_to_Member'>append_rel_list</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="prepjointree.c.html#LN876"><span class='Ref_To_Local'>subroot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN255"><span class='Ref_to_Member'>rowMarks</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    memset<span class='Parentheses'>(</span><a href="prepjointree.c.html#LN876"><span class='Ref_To_Local'>subroot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN271"><span class='Ref_to_Member'>upper_rels</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN876"><span class='Ref_To_Local'>subroot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN271"><span class='Ref_to_Member'>upper_rels</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memset<span class='Parentheses'>(</span><a href="prepjointree.c.html#LN876"><span class='Ref_To_Local'>subroot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN274"><span class='Ref_to_Member'>upper_targets</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN876"><span class='Ref_To_Local'>subroot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN274"><span class='Ref_to_Member'>upper_targets</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="prepjointree.c.html#LN876"><span class='Ref_To_Local'>subroot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN280"><span class='Ref_to_Member'>processed_tlist</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="prepjointree.c.html#LN876"><span class='Ref_To_Local'>subroot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN283"><span class='Ref_to_Member'>grouping_map</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="prepjointree.c.html#LN876"><span class='Ref_To_Local'>subroot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN284"><span class='Ref_to_Member'>minmax_aggs</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="prepjointree.c.html#LN876"><span class='Ref_To_Local'>subroot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN293"><span class='Ref_to_Member'>qual_security_level</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="prepjointree.c.html#LN876"><span class='Ref_To_Local'>subroot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN296"><span class='Ref_to_Member'>hasInheritedTarget</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="prepjointree.c.html#LN876"><span class='Ref_To_Local'>subroot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN304"><span class='Ref_to_Member'>hasRecursion</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="prepjointree.c.html#LN876"><span class='Ref_To_Local'>subroot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN307"><span class='Ref_to_Member'>wt_param_id</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="prepjointree.c.html#LN876"><span class='Ref_To_Local'>subroot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN308"><span class='Ref_to_Member'>non_recursive_path</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* No CTEs to worry about */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN875"><span class='Ref_To_Local'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN132"><span class='Ref_to_Member'>cteList</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Pull up any SubLinks within the subquery's quals, so that we don't 
     * leave unoptimized SubLinks behind. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN875"><span class='Ref_To_Local'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN125"><span class='Ref_to_Member'>hasSubLinks</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/optimizer/prep.h.html#LN23"><span class='Ref_to_Proto'>pull_up_sublinks</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN876"><span class='Ref_To_Local'>subroot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Similarly, inline any set-returning functions in its rangetable. 
     */ 
</span>    <a href="../../../include/optimizer/prep.h.html#LN24"><span class='Ref_to_Proto'>inline_set_returning_functions</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN876"><span class='Ref_To_Local'>subroot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Recursively pull up the subquery's subqueries, so that 
     * pull_up_subqueries' processing is complete for its jointree and 
     * rangetable. 
     * 
     * Note: it's okay that the subquery's recursion starts with NULL for 
     * containing-join info, even if we are within an outer join in the upper 
     * query; the lower query starts with a clean slate for outer-join 
     * semantics.  Likewise, we needn't pass down appendrel state. 
     */ 
</span>    <a href="../../../include/optimizer/prep.h.html#LN25"><span class='Ref_to_Proto'>pull_up_subqueries</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN876"><span class='Ref_To_Local'>subroot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now we must recheck whether the subquery is still simple enough to pull 
     * up.  If not, abandon processing it. 
     * 
     * We don't really need to recheck all the conditions involved, but it's 
     * easier just to keep this "if" looking the same as the one in 
     * pull_up_subqueries_recurse. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN83"><span class='Ref_to_Proto'>is_simple_subquery</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN875"><span class='Ref_To_Local'>subquery</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN867"><span class='Ref_to_Parameter'>rte</span></a><span class='Delimiter'>, 
</span>                           <a href="prepjointree.c.html#LN868"><span class='Ref_to_Parameter'>lowest_outer_join</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN871"><span class='Ref_to_Parameter'>deletion_ok</span></a><span class='Parentheses'>)</span> <span class='Operator'>&& 
</span>        <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN870"><span class='Ref_to_Parameter'>containing_appendrel</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="prepjointree.c.html#LN93"><span class='Ref_to_Proto'>is_safe_append_member</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN875"><span class='Ref_To_Local'>subquery</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* good to go */ 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Give up, return unmodified RangeTblRef. 
         * 
         * Note: The work we just did will be redone when the subquery gets 
         * planned on its own.  Perhaps we could avoid that by storing the 
         * modified subquery back into the rangetable, but I'm not gonna risk 
         * it now. 
         */ 
</span>        <span class='Control'>return</span> <a href="prepjointree.c.html#LN867"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We must flatten any join alias Vars in the subquery's targetlist, 
     * because pulling up the subquery's subqueries might have changed their 
     * expansions into arbitrary expressions, which could affect 
     * pullup_replace_vars' decisions about whether PlaceHolderVar wrappers 
     * are needed for tlist entries.  (Likely it'd be better to do 
     * flatten_join_alias_vars on the whole query tree at some earlier stage, 
     * maybe even in the rewriter; but for now let's just fix this case here.) 
     */ 
</span>    <a href="prepjointree.c.html#LN875"><span class='Ref_To_Local'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN137"><span class='Ref_to_Member'>targetList</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>        <a href="../../../include/optimizer/var.h.html#LN37"><span class='Ref_to_Proto'>flatten_join_alias_vars</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN876"><span class='Ref_To_Local'>subroot</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN875"><span class='Ref_To_Local'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN137"><span class='Ref_to_Member'>targetList</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Adjust level-0 varnos in subquery so that we can append its rangetable 
     * to upper query's.  We have to fix the subquery's append_rel_list as 
     * well. 
     */ 
</span>    <a href="prepjointree.c.html#LN877"><span class='Ref_To_Local'>rtoffset</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN873"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN134"><span class='Ref_to_Member'>rtable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/rewrite/rewriteManip.h.html#LN41"><span class='Ref_to_Proto'>OffsetVarNodes</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN875"><span class='Ref_To_Local'>subquery</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN877"><span class='Ref_To_Local'>rtoffset</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/rewrite/rewriteManip.h.html#LN41"><span class='Ref_to_Proto'>OffsetVarNodes</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN876"><span class='Ref_To_Local'>subroot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN251"><span class='Ref_to_Member'>append_rel_list</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN877"><span class='Ref_To_Local'>rtoffset</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Upper-level vars in subquery are now one level closer to their parent 
     * than before. 
     */ 
</span>    <a href="../../../include/rewrite/rewriteManip.h.html#LN44"><span class='Ref_to_Proto'>IncrementVarSublevelsUp</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN875"><span class='Ref_To_Local'>subquery</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/rewrite/rewriteManip.h.html#LN44"><span class='Ref_to_Proto'>IncrementVarSublevelsUp</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN876"><span class='Ref_To_Local'>subroot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN251"><span class='Ref_to_Member'>append_rel_list</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The subquery's targetlist items are now in the appropriate form to 
     * insert into the top query, but if we are under an outer join then 
     * non-nullable items and lateral references may have to be turned into 
     * PlaceHolderVars.  If we are dealing with an appendrel member then 
     * anything that's not a simple Var has to be turned into a 
     * PlaceHolderVar.  Set up required context data for pullup_replace_vars. 
     */ 
</span>    <a href="prepjointree.c.html#LN878"><span class='Ref_To_Local'>rvcontext</span></a><span class='Operator'>.</span><a href="prepjointree.c.html#LN41"><span class='Ref_to_Member'>root</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN867"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>; 
</span>    <a href="prepjointree.c.html#LN878"><span class='Ref_To_Local'>rvcontext</span></a><span class='Operator'>.</span><a href="prepjointree.c.html#LN42"><span class='Ref_to_Member'>targetlist</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN875"><span class='Ref_To_Local'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN137"><span class='Ref_to_Member'>targetList</span></a><span class='Delimiter'>; 
</span>    <a href="prepjointree.c.html#LN878"><span class='Ref_To_Local'>rvcontext</span></a><span class='Operator'>.</span><a href="prepjointree.c.html#LN43"><span class='Ref_to_Member'>target_rte</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN867"><span class='Ref_to_Parameter'>rte</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN867"><span class='Ref_to_Parameter'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1024"><span class='Ref_to_Member'>lateral</span></a><span class='Parentheses'>) 
</span>        <a href="prepjointree.c.html#LN878"><span class='Ref_To_Local'>rvcontext</span></a><span class='Operator'>.</span><a href="prepjointree.c.html#LN44"><span class='Ref_to_Member'>relids</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/prep.h.html#LN28"><span class='Ref_to_Proto'>get_relids_in_jointree</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN875"><span class='Ref_To_Local'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN135"><span class='Ref_to_Member'>jointree</span></a><span class='Delimiter'>, 
</span>                                                  <span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span>    <span class='Comment_Single_Line'>/* won't need relids */ 
</span>        <a href="prepjointree.c.html#LN878"><span class='Ref_To_Local'>rvcontext</span></a><span class='Operator'>.</span><a href="prepjointree.c.html#LN44"><span class='Ref_to_Member'>relids</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="prepjointree.c.html#LN878"><span class='Ref_To_Local'>rvcontext</span></a><span class='Operator'>.</span><a href="prepjointree.c.html#LN46"><span class='Ref_to_Member'>outer_hasSubLinks</span></a> <span class='Operator'>= &</span><a href="prepjointree.c.html#LN873"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN125"><span class='Ref_to_Member'>hasSubLinks</span></a><span class='Delimiter'>; 
</span>    <a href="prepjointree.c.html#LN878"><span class='Ref_To_Local'>rvcontext</span></a><span class='Operator'>.</span><a href="prepjointree.c.html#LN47"><span class='Ref_to_Member'>varno</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN874"><span class='Ref_To_Local'>varno</span></a><span class='Delimiter'>; 
</span>    <a href="prepjointree.c.html#LN878"><span class='Ref_To_Local'>rvcontext</span></a><span class='Operator'>.</span><a href="prepjointree.c.html#LN48"><span class='Ref_to_Member'>need_phvs</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN869"><span class='Ref_to_Parameter'>lowest_nulling_outer_join</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>|| 
</span>                           <a href="prepjointree.c.html#LN870"><span class='Ref_to_Parameter'>containing_appendrel</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="prepjointree.c.html#LN878"><span class='Ref_To_Local'>rvcontext</span></a><span class='Operator'>.</span><a href="prepjointree.c.html#LN49"><span class='Ref_to_Member'>wrap_non_vars</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN870"><span class='Ref_to_Parameter'>containing_appendrel</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* initialize cache array with indexes 0 .. length(tlist) */ 
</span>    <a href="prepjointree.c.html#LN878"><span class='Ref_To_Local'>rvcontext</span></a><span class='Operator'>.</span><a href="prepjointree.c.html#LN50"><span class='Ref_to_Member'>rv_cache</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN875"><span class='Ref_To_Local'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN137"><span class='Ref_to_Member'>targetList</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span> <span class='Operator'>* 
</span>                                 <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Replace all of the top query's references to the subquery's outputs 
     * with copies of the adjusted subtlist items, being careful not to 
     * replace any of the jointree structure. (This'd be a lot cleaner if we 
     * could use query_tree_mutator.)  We have to use PHVs in the targetList, 
     * returningList, and havingQual, since those are certainly above any 
     * outer join.  replace_vars_in_jointree tracks its location in the 
     * jointree and uses PHVs or not appropriately. 
     */ 
</span>    <a href="prepjointree.c.html#LN873"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN137"><span class='Ref_to_Member'>targetList</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>        <a href="prepjointree.c.html#LN99"><span class='Ref_to_Proto'>pullup_replace_vars</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN873"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN137"><span class='Ref_to_Member'>targetList</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="prepjointree.c.html#LN878"><span class='Ref_To_Local'>rvcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="prepjointree.c.html#LN873"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN143"><span class='Ref_to_Member'>returningList</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>        <a href="prepjointree.c.html#LN99"><span class='Ref_to_Proto'>pullup_replace_vars</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN873"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN143"><span class='Ref_to_Member'>returningList</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="prepjointree.c.html#LN878"><span class='Ref_To_Local'>rvcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN873"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN141"><span class='Ref_to_Member'>onConflict</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="prepjointree.c.html#LN873"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN141"><span class='Ref_to_Member'>onConflict</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1494"><span class='Ref_to_Member'>onConflictSet</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>            <a href="prepjointree.c.html#LN99"><span class='Ref_to_Proto'>pullup_replace_vars</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN873"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN141"><span class='Ref_to_Member'>onConflict</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1494"><span class='Ref_to_Member'>onConflictSet</span></a><span class='Delimiter'>, 
</span>                                <span class='Operator'>&</span><a href="prepjointree.c.html#LN878"><span class='Ref_To_Local'>rvcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepjointree.c.html#LN873"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN141"><span class='Ref_to_Member'>onConflict</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1495"><span class='Ref_to_Member'>onConflictWhere</span></a> <span class='Operator'>= 
</span>            <a href="prepjointree.c.html#LN99"><span class='Ref_to_Proto'>pullup_replace_vars</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN873"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN141"><span class='Ref_to_Member'>onConflict</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1495"><span class='Ref_to_Member'>onConflictWhere</span></a><span class='Delimiter'>, 
</span>                                <span class='Operator'>&</span><a href="prepjointree.c.html#LN878"><span class='Ref_To_Local'>rvcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We assume ON CONFLICT's arbiterElems, arbiterWhere, exclRelTlist 
         * can't contain any references to a subquery 
         */ 
</span>    <span class='Delimiter'>} 
</span>    <a href="prepjointree.c.html#LN96"><span class='Ref_to_Proto'>replace_vars_in_jointree</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN873"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN135"><span class='Ref_to_Member'>jointree</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="prepjointree.c.html#LN878"><span class='Ref_To_Local'>rvcontext</span></a><span class='Delimiter'>, 
</span>                             <a href="prepjointree.c.html#LN869"><span class='Ref_to_Parameter'>lowest_nulling_outer_join</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN873"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN162"><span class='Ref_to_Member'>setOperations</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="prepjointree.c.html#LN873"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN149"><span class='Ref_to_Member'>havingQual</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN99"><span class='Ref_to_Proto'>pullup_replace_vars</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN873"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN149"><span class='Ref_to_Member'>havingQual</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="prepjointree.c.html#LN878"><span class='Ref_To_Local'>rvcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Replace references in the translated_vars lists of appendrels. When 
     * pulling up an appendrel member, we do not need PHVs in the list of the 
     * parent appendrel --- there isn't any outer join between. Elsewhere, use 
     * PHVs for safety.  (This analysis could be made tighter but it seems 
     * unlikely to be worth much trouble.) 
     */ 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN879"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN867"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN251"><span class='Ref_to_Member'>append_rel_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1069"></a>        <a href="../../../include/nodes/relation.h.html#LN1964"><span class='Ref_to_Struct'>AppendRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>appinfo</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1964"><span class='Ref_to_Struct'>AppendRelInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN879"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1070"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>save_need_phvs</span> <span class='Operator'>= </span><a href="prepjointree.c.html#LN878"><span class='Ref_To_Local'>rvcontext</span></a><span class='Operator'>.</span><a href="prepjointree.c.html#LN48"><span class='Ref_to_Member'>need_phvs</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1069"><span class='Ref_To_Local'>appinfo</span></a> <span class='Operator'>== </span><a href="prepjointree.c.html#LN870"><span class='Ref_to_Parameter'>containing_appendrel</span></a><span class='Parentheses'>) 
</span>            <a href="prepjointree.c.html#LN878"><span class='Ref_To_Local'>rvcontext</span></a><span class='Operator'>.</span><a href="prepjointree.c.html#LN48"><span class='Ref_to_Member'>need_phvs</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="prepjointree.c.html#LN1069"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN2002"><span class='Ref_to_Member'>translated_vars</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>            <a href="prepjointree.c.html#LN99"><span class='Ref_to_Proto'>pullup_replace_vars</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN1069"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN2002"><span class='Ref_to_Member'>translated_vars</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="prepjointree.c.html#LN878"><span class='Ref_To_Local'>rvcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepjointree.c.html#LN878"><span class='Ref_To_Local'>rvcontext</span></a><span class='Operator'>.</span><a href="prepjointree.c.html#LN48"><span class='Ref_to_Member'>need_phvs</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN1070"><span class='Ref_To_Local'>save_need_phvs</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Replace references in the joinaliasvars lists of join RTEs. 
     * 
     * You might think that we could avoid using PHVs for alias vars of joins 
     * below lowest_nulling_outer_join, but that doesn't work because the 
     * alias vars could be referenced above that join; we need the PHVs to be 
     * present in such references after the alias vars get flattened.  (It 
     * might be worth trying to be smarter here, someday.) 
     */ 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN879"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN873"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN134"><span class='Ref_to_Member'>rtable</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1090"></a>        <a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>otherrte</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN879"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1090"><span class='Ref_To_Local'>otherrte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN936"><span class='Ref_to_Member'>rtekind</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/parsenodes.h.html#LN924"><span class='Ref_to_EnumConst'>RTE_JOIN</span></a><span class='Parentheses'>) 
</span>            <a href="prepjointree.c.html#LN1090"><span class='Ref_To_Local'>otherrte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN975"><span class='Ref_to_Member'>joinaliasvars</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>                <a href="prepjointree.c.html#LN99"><span class='Ref_to_Proto'>pullup_replace_vars</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN1090"><span class='Ref_To_Local'>otherrte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN975"><span class='Ref_to_Member'>joinaliasvars</span></a><span class='Delimiter'>, 
</span>                                    <span class='Operator'>&</span><a href="prepjointree.c.html#LN878"><span class='Ref_To_Local'>rvcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the subquery had a LATERAL marker, propagate that to any of its 
     * child RTEs that could possibly now contain lateral cross-references. 
     * The children might or might not contain any actual lateral 
     * cross-references, but we have to mark the pulled-up child RTEs so that 
     * later planner stages will check for such. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN867"><span class='Ref_to_Parameter'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1024"><span class='Ref_to_Member'>lateral</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN879"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN875"><span class='Ref_To_Local'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN134"><span class='Ref_to_Member'>rtable</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1109"></a>            <a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>child_rte</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN879"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1109"><span class='Ref_To_Local'>child_rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN936"><span class='Ref_to_Member'>rtekind</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN922"><span class='Ref_to_EnumConst'>RTE_RELATION</span></a><span class='Operator'>: 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1109"><span class='Ref_To_Local'>child_rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN949"><span class='Ref_to_Member'>tablesample</span></a><span class='Parentheses'>) 
</span>                        <a href="prepjointree.c.html#LN1109"><span class='Ref_To_Local'>child_rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1024"><span class='Ref_to_Member'>lateral</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN923"><span class='Ref_to_EnumConst'>RTE_SUBQUERY</span></a><span class='Operator'>: 
</span>                <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN925"><span class='Ref_to_EnumConst'>RTE_FUNCTION</span></a><span class='Operator'>: 
</span>                <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN927"><span class='Ref_to_EnumConst'>RTE_VALUES</span></a><span class='Operator'>: 
</span>                <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN926"><span class='Ref_to_EnumConst'>RTE_TABLEFUNC</span></a><span class='Operator'>: 
</span>                    <a href="prepjointree.c.html#LN1109"><span class='Ref_To_Local'>child_rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1024"><span class='Ref_to_Member'>lateral</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN924"><span class='Ref_to_EnumConst'>RTE_JOIN</span></a><span class='Operator'>: 
</span>                <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN928"><span class='Ref_to_EnumConst'>RTE_CTE</span></a><span class='Operator'>: 
</span>                <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN929"><span class='Ref_to_EnumConst'>RTE_NAMEDTUPLESTORE</span></a><span class='Operator'>: 
</span>                    <span class='Comment_Multi_Line'>/* these can't contain any lateral references */ 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if rte-&GT;lateral &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Now append the adjusted rtable entries to upper query. (We hold off 
     * until after fixing the upper rtable entries; no point in running that 
     * code on the subquery ones too.) 
     */ 
</span>    <a href="prepjointree.c.html#LN873"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN134"><span class='Ref_to_Member'>rtable</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN873"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN134"><span class='Ref_to_Member'>rtable</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN875"><span class='Ref_To_Local'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN134"><span class='Ref_to_Member'>rtable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Pull up any FOR UPDATE/SHARE markers, too.  (OffsetVarNodes already 
     * adjusted the marker rtindexes, so just concat the lists.) 
     */ 
</span>    <a href="prepjointree.c.html#LN873"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN160"><span class='Ref_to_Member'>rowMarks</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN873"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN160"><span class='Ref_to_Member'>rowMarks</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN875"><span class='Ref_To_Local'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN160"><span class='Ref_to_Member'>rowMarks</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We also have to fix the relid sets of any PlaceHolderVar nodes in the 
     * parent query.  (This could perhaps be done by pullup_replace_vars(), 
     * but it seems cleaner to use two passes.)  Note in particular that any 
     * PlaceHolderVar nodes just created by pullup_replace_vars() will be 
     * adjusted, so having created them with the subquery's varno is correct. 
     * 
     * Likewise, relids appearing in AppendRelInfo nodes have to be fixed. We 
     * already checked that this won't require introducing multiple subrelids 
     * into the single-slot AppendRelInfo structs. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN873"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN125"><span class='Ref_to_Member'>hasSubLinks</span></a> <span class='Operator'>|| </span><a href="prepjointree.c.html#LN867"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN118"><span class='Ref_to_Member'>lastPHId</span></a> <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        <a href="prepjointree.c.html#LN867"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN251"><span class='Ref_to_Member'>append_rel_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1159"></a>        <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a>      <span class='Declare_Local'>subrelids</span><span class='Delimiter'>; 
</span> 
        <a href="prepjointree.c.html#LN1159"><span class='Ref_To_Local'>subrelids</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/prep.h.html#LN28"><span class='Ref_to_Proto'>get_relids_in_jointree</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN875"><span class='Ref_To_Local'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN135"><span class='Ref_to_Member'>jointree</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepjointree.c.html#LN113"><span class='Ref_to_Proto'>substitute_multiple_relids</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN873"><span class='Ref_To_Local'>parse</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN874"><span class='Ref_To_Local'>varno</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN1159"><span class='Ref_To_Local'>subrelids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepjointree.c.html#LN115"><span class='Ref_to_Proto'>fix_append_rel_relids</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN867"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN251"><span class='Ref_to_Member'>append_rel_list</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN874"><span class='Ref_To_Local'>varno</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN1159"><span class='Ref_To_Local'>subrelids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * And now add subquery's AppendRelInfos to our list. 
     */ 
</span>    <a href="prepjointree.c.html#LN867"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN251"><span class='Ref_to_Member'>append_rel_list</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN867"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN251"><span class='Ref_to_Member'>append_rel_list</span></a><span class='Delimiter'>, 
</span>                                        <a href="prepjointree.c.html#LN876"><span class='Ref_To_Local'>subroot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN251"><span class='Ref_to_Member'>append_rel_list</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We don't have to do the equivalent bookkeeping for outer-join info, 
     * because that hasn't been set up yet.  placeholder_list likewise. 
     */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN867"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN249"><span class='Ref_to_Member'>join_info_list</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN876"><span class='Ref_To_Local'>subroot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN249"><span class='Ref_to_Member'>join_info_list</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN867"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN257"><span class='Ref_to_Member'>placeholder_list</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN876"><span class='Ref_To_Local'>subroot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN257"><span class='Ref_to_Member'>placeholder_list</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Miscellaneous housekeeping. 
     * 
     * Although replace_rte_variables() faithfully updated parse-&GT;hasSubLinks 
     * if it copied any SubLinks out of the subquery's targetlist, we still 
     * could have SubLinks added to the query in the expressions of FUNCTION 
     * and VALUES RTEs copied up from the subquery.  So it's necessary to copy 
     * subquery-&GT;hasSubLinks anyway.  Perhaps this can be improved someday. 
     */ 
</span>    <a href="prepjointree.c.html#LN873"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN125"><span class='Ref_to_Member'>hasSubLinks</span></a> <span class='Operator'>|= </span><a href="prepjointree.c.html#LN875"><span class='Ref_To_Local'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN125"><span class='Ref_to_Member'>hasSubLinks</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If subquery had any RLS conditions, now main query does too */ 
</span>    <a href="prepjointree.c.html#LN873"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN130"><span class='Ref_to_Member'>hasRowSecurity</span></a> <span class='Operator'>|= </span><a href="prepjointree.c.html#LN875"><span class='Ref_To_Local'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN130"><span class='Ref_to_Member'>hasRowSecurity</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * subquery won't be pulled up if it hasAggs, hasWindowFuncs, or 
     * hasTargetSRFs, so no work needed on those flags 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Return the adjusted subquery jointree to replace the RangeTblRef entry 
     * in parent's jointree; or, if we're flattening a subquery with empty 
     * FROM list, return NULL to signal deletion of the subquery from the 
     * parent jointree (and set hasDeletedRTEs to ensure cleanup later). 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN875"><span class='Ref_To_Local'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN135"><span class='Ref_to_Member'>jointree</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1469"><span class='Ref_to_Member'>fromlist</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN871"><span class='Ref_to_Parameter'>deletion_ok</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN875"><span class='Ref_To_Local'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN135"><span class='Ref_to_Member'>jointree</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1470"><span class='Ref_to_Member'>quals</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepjointree.c.html#LN867"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN300"><span class='Ref_to_Member'>hasDeletedRTEs</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN875"><span class='Ref_To_Local'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN135"><span class='Ref_to_Member'>jointree</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pull_up_simple_subquery &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * pull_up_simple_union_all 
 *      Pull up a single simple UNION ALL subquery. 
 * 
 * jtnode is a RangeTblRef that has been identified as a simple UNION ALL 
 * subquery by pull_up_subqueries.  We pull up the leaf subqueries and 
 * build an "append relation" for the union set.  The result value is just 
 * jtnode, since we don't actually need to change the query jointree. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>* 
</span><a name="LN1227"></a><span class='Declare_Function'>pull_up_simple_union_all</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jtnode</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rte</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1229"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>varno</span> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN1415"><span class='Ref_to_Struct'>RangeTblRef</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN1227"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>rtindex<span class='Delimiter'>; 
</span><a name="LN1230"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>subquery</span> <span class='Operator'>= </span><a href="prepjointree.c.html#LN1227"><span class='Ref_to_Parameter'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN954"><span class='Ref_to_Member'>subquery</span></a><span class='Delimiter'>; 
</span><a name="LN1231"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>rtoffset</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1227"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN134"><span class='Ref_to_Member'>rtable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1232"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>rtable</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Make a modifiable copy of the subquery's rtable, so we can adjust 
     * upper-level Vars in it.  There are no such Vars in the setOperations 
     * tree proper, so fixing the rtable should be sufficient. 
     */ 
</span>    <a href="prepjointree.c.html#LN1232"><span class='Ref_To_Local'>rtable</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1230"><span class='Ref_To_Local'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN134"><span class='Ref_to_Member'>rtable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Upper-level vars in subquery are now one level closer to their parent 
     * than before.  We don't have to worry about offsetting varnos, though, 
     * because the UNION leaf queries can't cross-reference each other. 
     */ 
</span>    <a href="../../../include/rewrite/rewriteManip.h.html#LN46"><span class='Ref_to_Proto'>IncrementVarSublevelsUp_rtable</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1232"><span class='Ref_To_Local'>rtable</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the UNION ALL subquery had a LATERAL marker, propagate that to all 
     * its children.  The individual children might or might not contain any 
     * actual lateral cross-references, but we have to mark the pulled-up 
     * child RTEs so that later planner stages will check for such. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1227"><span class='Ref_to_Parameter'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1024"><span class='Ref_to_Member'>lateral</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1256"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>rt</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1256"><span class='Ref_To_Local'>rt</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN1232"><span class='Ref_To_Local'>rtable</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1260"></a>            <a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>child_rte</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1256"><span class='Ref_To_Local'>rt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1260"><span class='Ref_To_Local'>child_rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN936"><span class='Ref_to_Member'>rtekind</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/parsenodes.h.html#LN923"><span class='Ref_to_EnumConst'>RTE_SUBQUERY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="prepjointree.c.html#LN1260"><span class='Ref_To_Local'>child_rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1024"><span class='Ref_to_Member'>lateral</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Append child RTEs to parent rtable. 
     */ 
</span>    <a href="prepjointree.c.html#LN1227"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN134"><span class='Ref_to_Member'>rtable</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1227"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN134"><span class='Ref_to_Member'>rtable</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN1232"><span class='Ref_To_Local'>rtable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Recursively scan the subquery's setOperations tree and add 
     * AppendRelInfo nodes for leaf subqueries to the parent's 
     * append_rel_list.  Also apply pull_up_subqueries to the leaf subqueries. 
     */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1230"><span class='Ref_To_Local'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN162"><span class='Ref_to_Member'>setOperations</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="prepjointree.c.html#LN78"><span class='Ref_to_Proto'>pull_up_union_leaf_queries</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1230"><span class='Ref_To_Local'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN162"><span class='Ref_to_Member'>setOperations</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN1227"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN1229"><span class='Ref_To_Local'>varno</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN1230"><span class='Ref_To_Local'>subquery</span></a><span class='Delimiter'>, 
</span>                               <a href="prepjointree.c.html#LN1231"><span class='Ref_To_Local'>rtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Mark the parent as an append relation. 
     */ 
</span>    <a href="prepjointree.c.html#LN1227"><span class='Ref_to_Parameter'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1025"><span class='Ref_to_Member'>inh</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="prepjointree.c.html#LN1227"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pull_up_simple_union_all &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * pull_up_union_leaf_queries -- recursive guts of pull_up_simple_union_all 
 * 
 * Build an AppendRelInfo for each leaf query in the setop tree, and then 
 * apply pull_up_subqueries to the leaf query. 
 * 
 * Note that setOpQuery is the Query containing the setOp node, whose tlist 
 * contains references to all the setop output columns.  When called from 
 * pull_up_simple_union_all, this is *not* the same as root-&GT;parse, which is 
 * the parent Query we are pulling up into. 
 * 
 * parentRTindex is the appendrel parent's index in root-&GT;parse-&GT;rtable. 
 * 
 * The child RTEs have already been copied to the parent.  childRToffset 
 * tells us where in the parent's range table they were copied.  When called 
 * from flatten_simple_union_all, childRToffset is 0 since the child RTEs 
 * were already in root-&GT;parse-&GT;rtable and no RT index adjustment is needed. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1308"></a><span class='Declare_Function'>pull_up_union_leaf_queries</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>setOp</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>parentRTindex</span><span class='Delimiter'>, 
</span><a name="LN1309"></a>                           <a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>setOpQuery</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>childRToffset</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1308"><span class='Ref_to_Parameter'>setOp</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1415"><span class='Ref_to_Struct'>RangeTblRef</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1313"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1415"><span class='Ref_to_Struct'>RangeTblRef</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rtr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1415"><span class='Ref_to_Struct'>RangeTblRef</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN1308"><span class='Ref_to_Parameter'>setOp</span></a><span class='Delimiter'>; 
</span><a name="LN1314"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>childRTindex</span><span class='Delimiter'>; 
</span><a name="LN1315"></a>        <a href="../../../include/nodes/relation.h.html#LN1964"><span class='Ref_to_Struct'>AppendRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>appinfo</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Calculate the index in the parent's range table 
         */ 
</span>        <a href="prepjointree.c.html#LN1314"><span class='Ref_To_Local'>childRTindex</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN1309"><span class='Ref_to_Parameter'>childRToffset</span></a> <span class='Operator'>+ </span><a href="prepjointree.c.html#LN1313"><span class='Ref_To_Local'>rtr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1418"><span class='Ref_to_Member'>rtindex</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Build a suitable AppendRelInfo, and attach to parent's list. 
         */ 
</span>        <a href="prepjointree.c.html#LN1315"><span class='Ref_To_Local'>appinfo</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1964"><span class='Ref_to_Struct'>AppendRelInfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepjointree.c.html#LN1315"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1974"><span class='Ref_to_Member'>parent_relid</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN1308"><span class='Ref_to_Parameter'>parentRTindex</span></a><span class='Delimiter'>; 
</span>        <a href="prepjointree.c.html#LN1315"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1975"><span class='Ref_to_Member'>child_relid</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN1314"><span class='Ref_To_Local'>childRTindex</span></a><span class='Delimiter'>; 
</span>        <a href="prepjointree.c.html#LN1315"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1983"><span class='Ref_to_Member'>parent_reltype</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <a href="prepjointree.c.html#LN1315"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1984"><span class='Ref_to_Member'>child_reltype</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <a href="prepjointree.c.html#LN81"><span class='Ref_to_Proto'>make_setop_translation_list</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1309"><span class='Ref_to_Parameter'>setOpQuery</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN1314"><span class='Ref_To_Local'>childRTindex</span></a><span class='Delimiter'>, 
</span>                                    <span class='Operator'>&</span><a href="prepjointree.c.html#LN1315"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN2002"><span class='Ref_to_Member'>translated_vars</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepjointree.c.html#LN1315"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN2009"><span class='Ref_to_Member'>parent_reloid</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <a href="prepjointree.c.html#LN1308"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN251"><span class='Ref_to_Member'>append_rel_list</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1308"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN251"><span class='Ref_to_Member'>append_rel_list</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN1315"><span class='Ref_To_Local'>appinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Recursively apply pull_up_subqueries to the new child RTE.  (We 
         * must build the AppendRelInfo first, because this will modify it.) 
         * Note that we can pass NULL for containing-join info even if we're 
         * actually under an outer join, because the child's expressions 
         * aren't going to propagate up to the join.  Also, we ignore the 
         * possibility that pull_up_subqueries_recurse() returns a different 
         * jointree node than what we pass it; if it does, the important thing 
         * is that it replaced the child relid in the AppendRelInfo node. 
         */ 
</span>        <a href="prepjointree.c.html#LN1313"><span class='Ref_To_Local'>rtr</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1415"><span class='Ref_to_Struct'>RangeTblRef</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepjointree.c.html#LN1313"><span class='Ref_To_Local'>rtr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1418"><span class='Ref_to_Member'>rtindex</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN1314"><span class='Ref_To_Local'>childRTindex</span></a><span class='Delimiter'>; 
</span>        <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN65"><span class='Ref_to_Proto'>pull_up_subqueries_recurse</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1308"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN1313"><span class='Ref_To_Local'>rtr</span></a><span class='Delimiter'>, 
</span>                                          <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN1315"><span class='Ref_To_Local'>appinfo</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IsA(setOp,RangeTblRef... &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1308"><span class='Ref_to_Parameter'>setOp</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN1545"><span class='Ref_to_Struct'>SetOperationStmt</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1352"></a>        <a href="../../../include/nodes/parsenodes.h.html#LN1545"><span class='Ref_to_Struct'>SetOperationStmt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>op</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN1545"><span class='Ref_to_Struct'>SetOperationStmt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN1308"><span class='Ref_to_Parameter'>setOp</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Recurse to reach leaf queries */ 
</span>        <a href="prepjointree.c.html#LN78"><span class='Ref_to_Proto'>pull_up_union_leaf_queries</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1352"><span class='Ref_To_Local'>op</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1550"><span class='Ref_to_Member'>larg</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN1308"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN1308"><span class='Ref_to_Parameter'>parentRTindex</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN1309"><span class='Ref_to_Parameter'>setOpQuery</span></a><span class='Delimiter'>, 
</span>                                   <a href="prepjointree.c.html#LN1309"><span class='Ref_to_Parameter'>childRToffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepjointree.c.html#LN78"><span class='Ref_to_Proto'>pull_up_union_leaf_queries</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1352"><span class='Ref_To_Local'>op</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1551"><span class='Ref_to_Member'>rarg</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN1308"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN1308"><span class='Ref_to_Parameter'>parentRTindex</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN1309"><span class='Ref_to_Parameter'>setOpQuery</span></a><span class='Delimiter'>, 
</span>                                   <a href="prepjointree.c.html#LN1309"><span class='Ref_to_Parameter'>childRToffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized node type: %d"</span><span class='Delimiter'>, 
</span>             <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="../../../include/nodes/nodes.h.html#LN513"><span class='Ref_to_Macro'>nodeTag</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1308"><span class='Ref_to_Parameter'>setOp</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end pull_up_union_leaf_queries &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * make_setop_translation_list 
 *    Build the list of translations from parent Vars to child Vars for 
 *    a UNION ALL member.  (At this point it's just a simple list of 
 *    referencing Vars, but if we succeed in pulling up the member 
 *    subquery, the Vars will get replaced by pulled-up expressions.) 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1375"></a><span class='Declare_Function'>make_setop_translation_list</span><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>query</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>newvarno</span><span class='Delimiter'>, 
</span><a name="LN1376"></a>                            <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>translated_vars</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1378"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>vars</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN1379"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1379"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN1375"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN137"><span class='Ref_to_Member'>targetList</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1383"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tle</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1379"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1383"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1373"><span class='Ref_to_Member'>resjunk</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <a href="prepjointree.c.html#LN1378"><span class='Ref_To_Local'>vars</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1378"><span class='Ref_To_Local'>vars</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/makefuncs.h.html#LN32"><span class='Ref_to_Proto'>makeVarFromTargetEntry</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1375"><span class='Ref_to_Parameter'>newvarno</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN1383"><span class='Ref_To_Local'>tle</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Operator'>*</span><a href="prepjointree.c.html#LN1376"><span class='Ref_to_Parameter'>translated_vars</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN1378"><span class='Ref_To_Local'>vars</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * is_simple_subquery 
 *    Check a subquery in the range table to see if it's simple enough 
 *    to pull up into the parent query. 
 * 
 * rte is the RTE_SUBQUERY RangeTblEntry that contained the subquery. 
 * (Note subquery is not necessarily equal to rte-&GT;subquery; it could be a 
 * processed copy of that.) 
 * lowest_outer_join is the lowest outer join above the subquery, or NULL. 
 * deletion_ok is TRUE if it'd be okay to delete the subquery entirely. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1406"></a><span class='Declare_Function'>is_simple_subquery</span><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>subquery</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rte</span><span class='Delimiter'>, 
</span><a name="LN1407"></a>                   <a href="../../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lowest_outer_join</span><span class='Delimiter'>, 
</span><a name="LN1408"></a>                   <span class='Keyword'>bool </span><span class='Declare_Parameter'>deletion_ok</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * Let's just make sure it's a valid subselect ... 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1406"><span class='Ref_to_Parameter'>subquery</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>        <a href="prepjointree.c.html#LN1406"><span class='Ref_to_Parameter'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN109"><span class='Ref_to_Member'>commandType</span></a> <span class='Operator'>!= </span><a href="../../../include/nodes/nodes.h.html#LN650"><span class='Ref_to_EnumConst'>CMD_SELECT</span></a><span class='Parentheses'>)</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"subquery is bogus"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Can't currently pull up a query with setops (unless it's simple UNION 
     * ALL, which is handled by a different code path). Maybe after querytree 
     * redesign... 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1406"><span class='Ref_to_Parameter'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN162"><span class='Ref_to_Member'>setOperations</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Can't pull up a subquery involving grouping, aggregation, SRFs, 
     * sorting, limiting, or WITH.  (XXX WITH could possibly be allowed later) 
     * 
     * We also don't pull up a subquery that has explicit FOR UPDATE/SHARE 
     * clauses, because pullup would cause the locking to occur semantically 
     * higher than it should.  Implicit FOR UPDATE/SHARE is okay because in 
     * that case the locking was originally declared in the upper query 
     * anyway. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1406"><span class='Ref_to_Parameter'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN122"><span class='Ref_to_Member'>hasAggs</span></a> <span class='Operator'>|| 
</span>        <a href="prepjointree.c.html#LN1406"><span class='Ref_to_Parameter'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN123"><span class='Ref_to_Member'>hasWindowFuncs</span></a> <span class='Operator'>|| 
</span>        <a href="prepjointree.c.html#LN1406"><span class='Ref_to_Parameter'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN124"><span class='Ref_to_Member'>hasTargetSRFs</span></a> <span class='Operator'>|| 
</span>        <a href="prepjointree.c.html#LN1406"><span class='Ref_to_Parameter'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN145"><span class='Ref_to_Member'>groupClause</span></a> <span class='Operator'>|| 
</span>        <a href="prepjointree.c.html#LN1406"><span class='Ref_to_Parameter'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN147"><span class='Ref_to_Member'>groupingSets</span></a> <span class='Operator'>|| 
</span>        <a href="prepjointree.c.html#LN1406"><span class='Ref_to_Parameter'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN149"><span class='Ref_to_Member'>havingQual</span></a> <span class='Operator'>|| 
</span>        <a href="prepjointree.c.html#LN1406"><span class='Ref_to_Parameter'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN155"><span class='Ref_to_Member'>sortClause</span></a> <span class='Operator'>|| 
</span>        <a href="prepjointree.c.html#LN1406"><span class='Ref_to_Parameter'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN153"><span class='Ref_to_Member'>distinctClause</span></a> <span class='Operator'>|| 
</span>        <a href="prepjointree.c.html#LN1406"><span class='Ref_to_Parameter'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN157"><span class='Ref_to_Member'>limitOffset</span></a> <span class='Operator'>|| 
</span>        <a href="prepjointree.c.html#LN1406"><span class='Ref_to_Parameter'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN158"><span class='Ref_to_Member'>limitCount</span></a> <span class='Operator'>|| 
</span>        <a href="prepjointree.c.html#LN1406"><span class='Ref_to_Parameter'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN129"><span class='Ref_to_Member'>hasForUpdate</span></a> <span class='Operator'>|| 
</span>        <a href="prepjointree.c.html#LN1406"><span class='Ref_to_Parameter'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN132"><span class='Ref_to_Member'>cteList</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Don't pull up if the RTE represents a security-barrier view; we 
     * couldn't prevent information leakage once the RTE's Vars are scattered 
     * about in the upper query. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1406"><span class='Ref_to_Parameter'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN955"><span class='Ref_to_Member'>security_barrier</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Don't pull up a subquery with an empty jointree, unless it has no quals 
     * and deletion_ok is TRUE and we're not underneath an outer join. 
     * 
     * query_planner() will correctly generate a Result plan for a jointree 
     * that's totally empty, but we can't cope with an empty FromExpr 
     * appearing lower down in a jointree: we identify join rels via baserelid 
     * sets, so we couldn't distinguish a join containing such a FromExpr from 
     * one without it.  We can only handle such cases if the place where the 
     * subquery is linked is a FromExpr or inner JOIN that would still be 
     * nonempty after removal of the subquery, so that it's still identifiable 
     * via its contained baserelids.  Safe contexts are signaled by 
     * deletion_ok. 
     * 
     * But even in a safe context, we must keep the subquery if it has any 
     * quals, because it's unclear where to put them in the upper query. 
     * 
     * Also, we must forbid pullup if such a subquery is underneath an outer 
     * join, because then we might need to wrap its output columns with 
     * PlaceHolderVars, and the PHVs would then have empty relid sets meaning 
     * we couldn't tell where to evaluate them.  (This test is separate from 
     * the deletion_ok flag for possible future expansion: deletion_ok tells 
     * whether the immediate parent site in the jointree could cope, not 
     * whether we'd have PHV issues.  It's possible this restriction could be 
     * fixed by letting the PHVs use the relids of the parent jointree item, 
     * but that complication is for another day.) 
     * 
     * Note that deletion of a subquery is also dependent on the check below 
     * that its targetlist contains no set-returning functions.  Deletion from 
     * a FROM list or inner JOIN is okay only if the subquery must return 
     * exactly one row. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1406"><span class='Ref_to_Parameter'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN135"><span class='Ref_to_Member'>jointree</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1469"><span class='Ref_to_Member'>fromlist</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a> <span class='Operator'>&& 
</span>        <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1406"><span class='Ref_to_Parameter'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN135"><span class='Ref_to_Member'>jointree</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1470"><span class='Ref_to_Member'>quals</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>|| 
</span>         <span class='Operator'>!</span><a href="prepjointree.c.html#LN1408"><span class='Ref_to_Parameter'>deletion_ok</span></a> <span class='Operator'>|| 
</span>         <a href="prepjointree.c.html#LN1407"><span class='Ref_to_Parameter'>lowest_outer_join</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the subquery is LATERAL, check for pullup restrictions from that. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1406"><span class='Ref_to_Parameter'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1024"><span class='Ref_to_Member'>lateral</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1500"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>restricted</span><span class='Delimiter'>; 
</span><a name="LN1501"></a>        <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a>      <span class='Declare_Local'>safe_upper_varnos</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * The subquery's WHERE and JOIN/ON quals mustn't contain any lateral 
         * references to rels outside a higher outer join (including the case 
         * where the outer join is within the subquery itself).  In such a 
         * case, pulling up would result in a situation where we need to 
         * postpone quals from below an outer join to above it, which is 
         * probably completely wrong and in any case is a complication that 
         * doesn't seem worth addressing at the moment. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1407"><span class='Ref_to_Parameter'>lowest_outer_join</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="prepjointree.c.html#LN1500"><span class='Ref_To_Local'>restricted</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="prepjointree.c.html#LN1501"><span class='Ref_To_Local'>safe_upper_varnos</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/prep.h.html#LN28"><span class='Ref_to_Proto'>get_relids_in_jointree</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN1407"><span class='Ref_to_Parameter'>lowest_outer_join</span></a><span class='Delimiter'>, 
</span>                                                       <span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="prepjointree.c.html#LN1500"><span class='Ref_To_Local'>restricted</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="prepjointree.c.html#LN1501"><span class='Ref_To_Local'>safe_upper_varnos</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* doesn't matter */ 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN94"><span class='Ref_to_Proto'>jointree_contains_lateral_outer_refs</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN1406"><span class='Ref_to_Parameter'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN135"><span class='Ref_to_Member'>jointree</span></a><span class='Delimiter'>, 
</span>                                              <a href="prepjointree.c.html#LN1500"><span class='Ref_To_Local'>restricted</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN1501"><span class='Ref_To_Local'>safe_upper_varnos</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If there's an outer join above the LATERAL subquery, also disallow 
         * pullup if the subquery's targetlist has any references to rels 
         * outside the outer join, since these might get pulled into quals 
         * above the subquery (but in or below the outer join) and then lead 
         * to qual-postponement issues similar to the case checked for above. 
         * (We wouldn't need to prevent pullup if no such references appear in 
         * outer-query quals, but we don't have enough info here to check 
         * that.  Also, maybe this restriction could be removed if we forced 
         * such refs to be wrapped in PlaceHolderVars, even when they're below 
         * the nearest outer join?  But it's a pretty hokey usage, so not 
         * clear this is worth sweating over.) 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1407"><span class='Ref_to_Parameter'>lowest_outer_join</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1543"></a>            <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a>      <span class='Declare_Local'>lvarnos</span> <span class='Operator'>= </span><a href="../../../include/optimizer/var.h.html#LN30"><span class='Ref_to_Proto'>pull_varnos_of_level</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN1406"><span class='Ref_to_Parameter'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN137"><span class='Ref_to_Member'>targetList</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/bitmapset.h.html#LN73"><span class='Ref_to_Proto'>bms_is_subset</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1543"><span class='Ref_To_Local'>lvarnos</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN1501"><span class='Ref_To_Local'>safe_upper_varnos</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if rte-&GT;lateral &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Don't pull up a subquery that has any volatile functions in its 
     * targetlist.  Otherwise we might introduce multiple evaluations of these 
     * functions, if they get copied to multiple places in the upper query, 
     * leading to surprising results.  (Note: the PlaceHolderVar mechanism 
     * doesn't quite guarantee single evaluation; else we could pull up anyway 
     * and just wrap such items in PlaceHolderVars ...) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/optimizer/clauses.h.html#LN60"><span class='Ref_to_Proto'>contain_volatile_functions</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN1406"><span class='Ref_to_Parameter'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN137"><span class='Ref_to_Member'>targetList</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end is_simple_subquery &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * pull_up_simple_values 
 *      Pull up a single simple VALUES RTE. 
 * 
 * jtnode is a RangeTblRef that has been identified as a simple VALUES RTE 
 * by pull_up_subqueries.  We always return NULL indicating that the RTE 
 * can be deleted entirely (all failure cases should have been detected by 
 * is_simple_values()). 
 * 
 * rte is the RangeTblEntry referenced by jtnode.  Because of the limited 
 * possible usage of VALUES RTEs, we do not need the remaining parameters 
 * of pull_up_subqueries_recurse. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>* 
</span><a name="LN1578"></a><span class='Declare_Function'>pull_up_simple_values</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jtnode</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rte</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1580"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>parse</span> <span class='Operator'>= </span><a href="prepjointree.c.html#LN1578"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Delimiter'>; 
</span><a name="LN1581"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>varno</span> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN1415"><span class='Ref_to_Struct'>RangeTblRef</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN1578"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>rtindex<span class='Delimiter'>; 
</span><a name="LN1582"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>values_list</span><span class='Delimiter'>; 
</span><a name="LN1583"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>tlist</span><span class='Delimiter'>; 
</span><a name="LN1584"></a>    <a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>attrno</span><span class='Delimiter'>; 
</span><a name="LN1585"></a>    <a href="prepjointree.c.html#LN39"><span class='Ref_to_Struct'>pullup_replace_vars_context</span></a> <span class='Declare_Local'>rvcontext</span><span class='Delimiter'>; 
</span><a name="LN1586"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1578"><span class='Ref_to_Parameter'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN936"><span class='Ref_to_Member'>rtekind</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/parsenodes.h.html#LN927"><span class='Ref_to_EnumConst'>RTE_VALUES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1578"><span class='Ref_to_Parameter'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN996"><span class='Ref_to_Member'>values_lists</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Need a modifiable copy of the VALUES list to hack on, just in case it's 
     * multiply referenced. 
     */ 
</span>    <a href="prepjointree.c.html#LN1582"><span class='Ref_To_Local'>values_list</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1578"><span class='Ref_to_Parameter'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN996"><span class='Ref_to_Member'>values_lists</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The VALUES RTE can't contain any Vars of level zero, let alone any that 
     * are join aliases, so no need to flatten join alias Vars. 
     */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/optimizer/var.h.html#LN34"><span class='Ref_to_Proto'>contain_vars_of_level</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN1582"><span class='Ref_To_Local'>values_list</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Set up required context data for pullup_replace_vars.  In particular, 
     * we have to make the VALUES list look like a subquery targetlist. 
     */ 
</span>    <a href="prepjointree.c.html#LN1583"><span class='Ref_To_Local'>tlist</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="prepjointree.c.html#LN1584"><span class='Ref_To_Local'>attrno</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1586"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN1582"><span class='Ref_To_Local'>values_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="prepjointree.c.html#LN1583"><span class='Ref_To_Local'>tlist</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1583"><span class='Ref_To_Local'>tlist</span></a><span class='Delimiter'>, 
</span>                        <a href="../../../include/nodes/makefuncs.h.html#LN40"><span class='Ref_to_Proto'>makeTargetEntry</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1586"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                        <a href="prepjointree.c.html#LN1584"><span class='Ref_To_Local'>attrno</span></a><span class='Delimiter'>, 
</span>                                        <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                        <span class='Boolean'>false</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="prepjointree.c.html#LN1584"><span class='Ref_To_Local'>attrno</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="prepjointree.c.html#LN1585"><span class='Ref_To_Local'>rvcontext</span></a><span class='Operator'>.</span><a href="prepjointree.c.html#LN41"><span class='Ref_to_Member'>root</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN1578"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>; 
</span>    <a href="prepjointree.c.html#LN1585"><span class='Ref_To_Local'>rvcontext</span></a><span class='Operator'>.</span><a href="prepjointree.c.html#LN42"><span class='Ref_to_Member'>targetlist</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN1583"><span class='Ref_To_Local'>tlist</span></a><span class='Delimiter'>; 
</span>    <a href="prepjointree.c.html#LN1585"><span class='Ref_To_Local'>rvcontext</span></a><span class='Operator'>.</span><a href="prepjointree.c.html#LN43"><span class='Ref_to_Member'>target_rte</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN1578"><span class='Ref_to_Parameter'>rte</span></a><span class='Delimiter'>; 
</span>    <a href="prepjointree.c.html#LN1585"><span class='Ref_To_Local'>rvcontext</span></a><span class='Operator'>.</span><a href="prepjointree.c.html#LN44"><span class='Ref_to_Member'>relids</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="prepjointree.c.html#LN1585"><span class='Ref_To_Local'>rvcontext</span></a><span class='Operator'>.</span><a href="prepjointree.c.html#LN46"><span class='Ref_to_Member'>outer_hasSubLinks</span></a> <span class='Operator'>= &</span><a href="prepjointree.c.html#LN1580"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN125"><span class='Ref_to_Member'>hasSubLinks</span></a><span class='Delimiter'>; 
</span>    <a href="prepjointree.c.html#LN1585"><span class='Ref_To_Local'>rvcontext</span></a><span class='Operator'>.</span><a href="prepjointree.c.html#LN47"><span class='Ref_to_Member'>varno</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN1581"><span class='Ref_To_Local'>varno</span></a><span class='Delimiter'>; 
</span>    <a href="prepjointree.c.html#LN1585"><span class='Ref_To_Local'>rvcontext</span></a><span class='Operator'>.</span><a href="prepjointree.c.html#LN48"><span class='Ref_to_Member'>need_phvs</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="prepjointree.c.html#LN1585"><span class='Ref_To_Local'>rvcontext</span></a><span class='Operator'>.</span><a href="prepjointree.c.html#LN49"><span class='Ref_to_Member'>wrap_non_vars</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* initialize cache array with indexes 0 .. length(tlist) */ 
</span>    <a href="prepjointree.c.html#LN1585"><span class='Ref_To_Local'>rvcontext</span></a><span class='Operator'>.</span><a href="prepjointree.c.html#LN50"><span class='Ref_to_Member'>rv_cache</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1583"><span class='Ref_To_Local'>tlist</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span> <span class='Operator'>* 
</span>                                 <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Replace all of the top query's references to the RTE's outputs with 
     * copies of the adjusted VALUES expressions, being careful not to replace 
     * any of the jointree structure. (This'd be a lot cleaner if we could use 
     * query_tree_mutator.)  Much of this should be no-ops in the dummy Query 
     * that surrounds a VALUES RTE, but it's not enough code to be worth 
     * removing. 
     */ 
</span>    <a href="prepjointree.c.html#LN1580"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN137"><span class='Ref_to_Member'>targetList</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>        <a href="prepjointree.c.html#LN99"><span class='Ref_to_Proto'>pullup_replace_vars</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN1580"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN137"><span class='Ref_to_Member'>targetList</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="prepjointree.c.html#LN1585"><span class='Ref_To_Local'>rvcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="prepjointree.c.html#LN1580"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN143"><span class='Ref_to_Member'>returningList</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>        <a href="prepjointree.c.html#LN99"><span class='Ref_to_Proto'>pullup_replace_vars</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN1580"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN143"><span class='Ref_to_Member'>returningList</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="prepjointree.c.html#LN1585"><span class='Ref_To_Local'>rvcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1580"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN141"><span class='Ref_to_Member'>onConflict</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="prepjointree.c.html#LN1580"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN141"><span class='Ref_to_Member'>onConflict</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1494"><span class='Ref_to_Member'>onConflictSet</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>            <a href="prepjointree.c.html#LN99"><span class='Ref_to_Proto'>pullup_replace_vars</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN1580"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN141"><span class='Ref_to_Member'>onConflict</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1494"><span class='Ref_to_Member'>onConflictSet</span></a><span class='Delimiter'>, 
</span>                                <span class='Operator'>&</span><a href="prepjointree.c.html#LN1585"><span class='Ref_To_Local'>rvcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepjointree.c.html#LN1580"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN141"><span class='Ref_to_Member'>onConflict</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1495"><span class='Ref_to_Member'>onConflictWhere</span></a> <span class='Operator'>= 
</span>            <a href="prepjointree.c.html#LN99"><span class='Ref_to_Proto'>pullup_replace_vars</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1580"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN141"><span class='Ref_to_Member'>onConflict</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1495"><span class='Ref_to_Member'>onConflictWhere</span></a><span class='Delimiter'>, 
</span>                                <span class='Operator'>&</span><a href="prepjointree.c.html#LN1585"><span class='Ref_To_Local'>rvcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We assume ON CONFLICT's arbiterElems, arbiterWhere, exclRelTlist 
         * can't contain any references to a subquery 
         */ 
</span>    <span class='Delimiter'>} 
</span>    <a href="prepjointree.c.html#LN96"><span class='Ref_to_Proto'>replace_vars_in_jointree</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN1580"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN135"><span class='Ref_to_Member'>jointree</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="prepjointree.c.html#LN1585"><span class='Ref_To_Local'>rvcontext</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1580"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN162"><span class='Ref_to_Member'>setOperations</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="prepjointree.c.html#LN1580"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN149"><span class='Ref_to_Member'>havingQual</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN99"><span class='Ref_to_Proto'>pullup_replace_vars</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1580"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN149"><span class='Ref_to_Member'>havingQual</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="prepjointree.c.html#LN1585"><span class='Ref_To_Local'>rvcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * There should be no appendrels to fix, nor any join alias Vars, nor any 
     * outer joins and hence no PlaceHolderVars. 
     */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1578"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN251"><span class='Ref_to_Member'>append_rel_list</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1580"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN134"><span class='Ref_to_Member'>rtable</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1578"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN249"><span class='Ref_to_Member'>join_info_list</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1578"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN257"><span class='Ref_to_Member'>placeholder_list</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Return NULL to signal deletion of the VALUES RTE from the parent 
     * jointree (and set hasDeletedRTEs to ensure cleanup later). 
     */ 
</span>    <a href="prepjointree.c.html#LN1578"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN300"><span class='Ref_to_Member'>hasDeletedRTEs</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pull_up_simple_values &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * is_simple_values 
 *    Check a VALUES RTE in the range table to see if it's simple enough 
 *    to pull up into the parent query. 
 * 
 * rte is the RTE_VALUES RangeTblEntry to check. 
 * deletion_ok is TRUE if it'd be okay to delete the VALUES RTE entirely. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1686"></a><span class='Declare_Function'>is_simple_values</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rte</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>deletion_ok</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1686"><span class='Ref_to_Parameter'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN936"><span class='Ref_to_Member'>rtekind</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/parsenodes.h.html#LN927"><span class='Ref_to_EnumConst'>RTE_VALUES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We can only pull up a VALUES RTE if deletion_ok is TRUE.  It's 
     * basically the same case as a sub-select with empty FROM list; see 
     * comments in is_simple_subquery(). 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="prepjointree.c.html#LN1686"><span class='Ref_to_Parameter'>deletion_ok</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Also, there must be exactly one VALUES list, else it's not semantically 
     * correct to delete the VALUES RTE. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1686"><span class='Ref_to_Parameter'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN996"><span class='Ref_to_Member'>values_lists</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Because VALUES can't appear under an outer join (or at least, we won't 
     * try to pull it up if it does), we need not worry about LATERAL, nor 
     * about validity of PHVs for the VALUES' outputs. 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Don't pull up a VALUES that contains any set-returning or volatile 
     * functions.  Again, the considerations here are basically identical to 
     * restrictions on a subquery's targetlist. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodeFuncs.h.html#LN36"><span class='Ref_to_Proto'>expression_returns_set</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN1686"><span class='Ref_to_Parameter'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN996"><span class='Ref_to_Member'>values_lists</span></a><span class='Parentheses'>)</span> <span class='Operator'>|| 
</span>        <a href="../../../include/optimizer/clauses.h.html#LN60"><span class='Ref_to_Proto'>contain_volatile_functions</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN1686"><span class='Ref_to_Parameter'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN996"><span class='Ref_to_Member'>values_lists</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Do not pull up a VALUES that's not the only RTE in its parent query. 
     * This is actually the only case that the parser will generate at the 
     * moment, and assuming this is true greatly simplifies 
     * pull_up_simple_values(). 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1686"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN134"><span class='Ref_to_Member'>rtable</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span> <span class='Operator'>|| 
</span>        <a href="prepjointree.c.html#LN1686"><span class='Ref_to_Parameter'>rte</span></a> <span class='Operator'>!= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1686"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN134"><span class='Ref_to_Member'>rtable</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end is_simple_values &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * is_simple_union_all 
 *    Check a subquery to see if it's a simple UNION ALL. 
 * 
 * We require all the setops to be UNION ALL (no mixing) and there can't be 
 * any datatype coercions involved, ie, all the leaf queries must emit the 
 * same datatypes. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1742"></a><span class='Declare_Function'>is_simple_union_all</span><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>subquery</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1744"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN1545"><span class='Ref_to_Struct'>SetOperationStmt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>topop</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Let's just make sure it's a valid subselect ... */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1742"><span class='Ref_to_Parameter'>subquery</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>        <a href="prepjointree.c.html#LN1742"><span class='Ref_to_Parameter'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN109"><span class='Ref_to_Member'>commandType</span></a> <span class='Operator'>!= </span><a href="../../../include/nodes/nodes.h.html#LN650"><span class='Ref_to_EnumConst'>CMD_SELECT</span></a><span class='Parentheses'>)</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"subquery is bogus"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Is it a set-operation query at all? */ 
</span>    <a href="prepjointree.c.html#LN1744"><span class='Ref_To_Local'>topop</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN575"><span class='Ref_to_Macro'>castNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN1545"><span class='Ref_to_Struct'>SetOperationStmt</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN1742"><span class='Ref_to_Parameter'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN162"><span class='Ref_to_Member'>setOperations</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="prepjointree.c.html#LN1744"><span class='Ref_To_Local'>topop</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Can't handle ORDER BY, LIMIT/OFFSET, locking, or WITH */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1742"><span class='Ref_to_Parameter'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN155"><span class='Ref_to_Member'>sortClause</span></a> <span class='Operator'>|| 
</span>        <a href="prepjointree.c.html#LN1742"><span class='Ref_to_Parameter'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN157"><span class='Ref_to_Member'>limitOffset</span></a> <span class='Operator'>|| 
</span>        <a href="prepjointree.c.html#LN1742"><span class='Ref_to_Parameter'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN158"><span class='Ref_to_Member'>limitCount</span></a> <span class='Operator'>|| 
</span>        <a href="prepjointree.c.html#LN1742"><span class='Ref_to_Parameter'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN160"><span class='Ref_to_Member'>rowMarks</span></a> <span class='Operator'>|| 
</span>        <a href="prepjointree.c.html#LN1742"><span class='Ref_to_Parameter'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN132"><span class='Ref_to_Member'>cteList</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Recursively check the tree of set operations */ 
</span>    <span class='Control'>return</span> <a href="prepjointree.c.html#LN91"><span class='Ref_to_Proto'>is_simple_union_all_recurse</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN1744"><span class='Ref_To_Local'>topop</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN1742"><span class='Ref_to_Parameter'>subquery</span></a><span class='Delimiter'>, 
</span>                                       <a href="prepjointree.c.html#LN1744"><span class='Ref_To_Local'>topop</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1555"><span class='Ref_to_Member'>colTypes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end is_simple_union_all &raquo; </span> 
 
<span class='Keyword'>static bool 
</span><a name="LN1770"></a><span class='Declare_Function'>is_simple_union_all_recurse</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>setOp</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>setOpQuery</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>colTypes</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1770"><span class='Ref_to_Parameter'>setOp</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1415"><span class='Ref_to_Struct'>RangeTblRef</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1774"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1415"><span class='Ref_to_Struct'>RangeTblRef</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rtr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1415"><span class='Ref_to_Struct'>RangeTblRef</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN1770"><span class='Ref_to_Parameter'>setOp</span></a><span class='Delimiter'>; 
</span><a name="LN1775"></a>        <a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rte</span> <span class='Operator'>= </span><a href="../../../include/parser/parsetree.h.html#LN30"><span class='Ref_to_Macro'>rt_fetch</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1774"><span class='Ref_To_Local'>rtr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1418"><span class='Ref_to_Member'>rtindex</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN1770"><span class='Ref_to_Parameter'>setOpQuery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN134"><span class='Ref_to_Member'>rtable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1776"></a>        <a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>subquery</span> <span class='Operator'>= </span><a href="prepjointree.c.html#LN1775"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN954"><span class='Ref_to_Member'>subquery</span></a><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1776"><span class='Ref_To_Local'>subquery</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Leaf nodes are OK if they match the toplevel column types */ 
</span>        <span class='Comment_Multi_Line'>/* We don't have to compare typmods or collations here */ 
</span>        <span class='Control'>return</span> <a href="../../../include/optimizer/tlist.h.html#LN30"><span class='Ref_to_Proto'>tlist_same_datatypes</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1776"><span class='Ref_To_Local'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN137"><span class='Ref_to_Member'>targetList</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN1770"><span class='Ref_to_Parameter'>colTypes</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1770"><span class='Ref_to_Parameter'>setOp</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN1545"><span class='Ref_to_Struct'>SetOperationStmt</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1786"></a>        <a href="../../../include/nodes/parsenodes.h.html#LN1545"><span class='Ref_to_Struct'>SetOperationStmt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>op</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN1545"><span class='Ref_to_Struct'>SetOperationStmt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN1770"><span class='Ref_to_Parameter'>setOp</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Must be UNION ALL */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1786"><span class='Ref_To_Local'>op</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1548"><span class='Ref_to_Member'>op</span></a> <span class='Operator'>!= </span><a href="../../../include/nodes/parsenodes.h.html#LN1473"><span class='Ref_to_EnumConst'>SETOP_UNION</span></a> <span class='Operator'>|| !</span><a href="prepjointree.c.html#LN1786"><span class='Ref_To_Local'>op</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1549"><span class='Ref_to_Member'>all</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Recurse to check inputs */ 
</span>        <span class='Control'>return</span> <a href="prepjointree.c.html#LN91"><span class='Ref_to_Proto'>is_simple_union_all_recurse</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1786"><span class='Ref_To_Local'>op</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1550"><span class='Ref_to_Member'>larg</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN1770"><span class='Ref_to_Parameter'>setOpQuery</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN1770"><span class='Ref_to_Parameter'>colTypes</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>            <a href="prepjointree.c.html#LN91"><span class='Ref_to_Proto'>is_simple_union_all_recurse</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1786"><span class='Ref_To_Local'>op</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1551"><span class='Ref_to_Member'>rarg</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN1770"><span class='Ref_to_Parameter'>setOpQuery</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN1770"><span class='Ref_to_Parameter'>colTypes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized node type: %d"</span><span class='Delimiter'>, 
</span>             <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="../../../include/nodes/nodes.h.html#LN513"><span class='Ref_to_Macro'>nodeTag</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1770"><span class='Ref_to_Parameter'>setOp</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end is_simple_union_all_recurse &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * is_safe_append_member 
 *    Check a subquery that is a leaf of a UNION ALL appendrel to see if it's 
 *    safe to pull up. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1810"></a><span class='Declare_Function'>is_safe_append_member</span><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>subquery</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1812"></a>    <a href="../../../include/nodes/primnodes.h.html#LN1466"><span class='Ref_to_Struct'>FromExpr</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>jtnode</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * It's only safe to pull up the child if its jointree contains exactly 
     * one RTE, else the AppendRelInfo data structure breaks. The one base RTE 
     * could be buried in several levels of FromExpr, however. 
     * 
     * Also, the child can't have any WHERE quals because there's no place to 
     * put them in an appendrel.  (This is a bit annoying...) If we didn't 
     * need to check this, we'd just test whether get_relids_in_jointree() 
     * yields a singleton set, to be more consistent with the coding of 
     * fix_append_rel_relids(). 
     */ 
</span>    <a href="prepjointree.c.html#LN1812"><span class='Ref_To_Local'>jtnode</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN1810"><span class='Ref_to_Parameter'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN135"><span class='Ref_to_Member'>jointree</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1812"><span class='Ref_To_Local'>jtnode</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1466"><span class='Ref_to_Struct'>FromExpr</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1812"><span class='Ref_To_Local'>jtnode</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1470"><span class='Ref_to_Member'>quals</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1812"><span class='Ref_To_Local'>jtnode</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1469"><span class='Ref_to_Member'>fromlist</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="prepjointree.c.html#LN1812"><span class='Ref_To_Local'>jtnode</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1812"><span class='Ref_To_Local'>jtnode</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1469"><span class='Ref_to_Member'>fromlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1812"><span class='Ref_To_Local'>jtnode</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1415"><span class='Ref_to_Struct'>RangeTblRef</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end is_safe_append_member &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * jointree_contains_lateral_outer_refs 
 *      Check for disallowed lateral references in a jointree's quals 
 * 
 * If restricted is false, all level-1 Vars are allowed (but we still must 
 * search the jointree, since it might contain outer joins below which there 
 * will be restrictions).  If restricted is true, return TRUE when any qual 
 * in the jointree contains level-1 Vars coming from outside the rels listed 
 * in safe_upper_varnos. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1851"></a><span class='Declare_Function'>jointree_contains_lateral_outer_refs</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jtnode</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>restricted</span><span class='Delimiter'>, 
</span><a name="LN1852"></a>                                     <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>safe_upper_varnos</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1851"><span class='Ref_to_Parameter'>jtnode</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1851"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1415"><span class='Ref_to_Struct'>RangeTblRef</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1851"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1466"><span class='Ref_to_Struct'>FromExpr</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1860"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1466"><span class='Ref_to_Struct'>FromExpr</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>f</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1466"><span class='Ref_to_Struct'>FromExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN1851"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>; 
</span><a name="LN1861"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* First, recurse to check child joins */ 
</span>        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1861"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN1860"><span class='Ref_To_Local'>f</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1469"><span class='Ref_to_Member'>fromlist</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN94"><span class='Ref_to_Proto'>jointree_contains_lateral_outer_refs</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1861"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                     <a href="prepjointree.c.html#LN1851"><span class='Ref_to_Parameter'>restricted</span></a><span class='Delimiter'>, 
</span>                                                     <a href="prepjointree.c.html#LN1852"><span class='Ref_to_Parameter'>safe_upper_varnos</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Then check the top-level quals */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1851"><span class='Ref_to_Parameter'>restricted</span></a> <span class='Operator'>&& 
</span>            <span class='Operator'>!</span><a href="../../../include/nodes/bitmapset.h.html#LN73"><span class='Ref_to_Proto'>bms_is_subset</span></a><span class='Parentheses'>(</span><a href="../../../include/optimizer/var.h.html#LN30"><span class='Ref_to_Proto'>pull_varnos_of_level</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1860"><span class='Ref_To_Local'>f</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1470"><span class='Ref_to_Member'>quals</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="prepjointree.c.html#LN1852"><span class='Ref_to_Parameter'>safe_upper_varnos</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IsA(jtnode,FromExpr) &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1851"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1880"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>j</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN1851"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If this is an outer join, we mustn't allow any upper lateral 
         * references in or below it. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1880"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1447"><span class='Ref_to_Member'>jointype</span></a> <span class='Operator'>!= </span><a href="../../../include/nodes/nodes.h.html#LN677"><span class='Ref_to_EnumConst'>JOIN_INNER</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="prepjointree.c.html#LN1851"><span class='Ref_to_Parameter'>restricted</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="prepjointree.c.html#LN1852"><span class='Ref_to_Parameter'>safe_upper_varnos</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Check the child joins */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN94"><span class='Ref_to_Proto'>jointree_contains_lateral_outer_refs</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1880"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1449"><span class='Ref_to_Member'>larg</span></a><span class='Delimiter'>, 
</span>                                                 <a href="prepjointree.c.html#LN1851"><span class='Ref_to_Parameter'>restricted</span></a><span class='Delimiter'>, 
</span>                                                 <a href="prepjointree.c.html#LN1852"><span class='Ref_to_Parameter'>safe_upper_varnos</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN94"><span class='Ref_to_Proto'>jointree_contains_lateral_outer_refs</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1880"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1450"><span class='Ref_to_Member'>rarg</span></a><span class='Delimiter'>, 
</span>                                                 <a href="prepjointree.c.html#LN1851"><span class='Ref_to_Parameter'>restricted</span></a><span class='Delimiter'>, 
</span>                                                 <a href="prepjointree.c.html#LN1852"><span class='Ref_to_Parameter'>safe_upper_varnos</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Check the JOIN's qual clauses */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1851"><span class='Ref_to_Parameter'>restricted</span></a> <span class='Operator'>&& 
</span>            <span class='Operator'>!</span><a href="../../../include/nodes/bitmapset.h.html#LN73"><span class='Ref_to_Proto'>bms_is_subset</span></a><span class='Parentheses'>(</span><a href="../../../include/optimizer/var.h.html#LN30"><span class='Ref_to_Proto'>pull_varnos_of_level</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1880"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1452"><span class='Ref_to_Member'>quals</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="prepjointree.c.html#LN1852"><span class='Ref_to_Parameter'>safe_upper_varnos</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IsA(jtnode,JoinExpr) &raquo; </span> 
    <span class='Control'>else</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized node type: %d"</span><span class='Delimiter'>, 
</span>             <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="../../../include/nodes/nodes.h.html#LN513"><span class='Ref_to_Macro'>nodeTag</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1851"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end jointree_contains_lateral_outer_refs &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Helper routine for pull_up_subqueries: do pullup_replace_vars on every 
 * expression in the jointree, without changing the jointree structure itself. 
 * Ugly, but there's no other way... 
 * 
 * If we are at or below lowest_nulling_outer_join, we can suppress use of 
 * PlaceHolderVars wrapped around the replacement expressions. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1923"></a><span class='Declare_Function'>replace_vars_in_jointree</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jtnode</span><span class='Delimiter'>, 
</span><a name="LN1924"></a>                         <a href="prepjointree.c.html#LN39"><span class='Ref_to_Struct'>pullup_replace_vars_context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Delimiter'>, 
</span><a name="LN1925"></a>                         <a href="../../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lowest_nulling_outer_join</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1923"><span class='Ref_to_Parameter'>jtnode</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1923"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1415"><span class='Ref_to_Struct'>RangeTblRef</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * If the RangeTblRef refers to a LATERAL subquery (that isn't the 
         * same subquery we're pulling up), it might contain references to the 
         * target subquery, which we must replace.  We drive this from the 
         * jointree scan, rather than a scan of the rtable, for a couple of 
         * reasons: we can avoid processing no-longer-referenced RTEs, and we 
         * can use the appropriate setting of need_phvs depending on whether 
         * the RTE is above possibly-nulling outer joins or not. 
         */ 
</span><a name="LN1940"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>varno</span> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN1415"><span class='Ref_to_Struct'>RangeTblRef</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN1923"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>rtindex<span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1940"><span class='Ref_To_Local'>varno</span></a> <span class='Operator'>!= </span><a href="prepjointree.c.html#LN1924"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN47"><span class='Ref_to_Member'>varno</span></a><span class='Parentheses'>)</span>    <span class='Comment_Single_Line'>/* ignore target subquery itself */ 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1944"></a>            <a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rte</span> <span class='Operator'>= </span><a href="../../../include/parser/parsetree.h.html#LN30"><span class='Ref_to_Macro'>rt_fetch</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1940"><span class='Ref_To_Local'>varno</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN1924"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN41"><span class='Ref_to_Member'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN134"><span class='Ref_to_Member'>rtable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1944"><span class='Ref_To_Local'>rte</span></a> <span class='Operator'>!= </span><a href="prepjointree.c.html#LN1924"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN43"><span class='Ref_to_Member'>target_rte</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1944"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1024"><span class='Ref_to_Member'>lateral</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1944"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN936"><span class='Ref_to_Member'>rtekind</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN922"><span class='Ref_to_EnumConst'>RTE_RELATION</span></a><span class='Operator'>: 
</span>                        <span class='Comment_Multi_Line'>/* shouldn't be marked LATERAL unless tablesample */ 
</span>                        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1944"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN949"><span class='Ref_to_Member'>tablesample</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="prepjointree.c.html#LN1944"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN949"><span class='Ref_to_Member'>tablesample</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN1071"><span class='Ref_to_Struct'>TableSampleClause</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>                            <a href="prepjointree.c.html#LN99"><span class='Ref_to_Proto'>pullup_replace_vars</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN1944"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN949"><span class='Ref_to_Member'>tablesample</span></a><span class='Delimiter'>, 
</span>                                                <a href="prepjointree.c.html#LN1924"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN923"><span class='Ref_to_EnumConst'>RTE_SUBQUERY</span></a><span class='Operator'>: 
</span>                        <a href="prepjointree.c.html#LN1944"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN954"><span class='Ref_to_Member'>subquery</span></a> <span class='Operator'>= 
</span>                            <a href="prepjointree.c.html#LN103"><span class='Ref_to_Proto'>pullup_replace_vars_subquery</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1944"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN954"><span class='Ref_to_Member'>subquery</span></a><span class='Delimiter'>, 
</span>                                                         <a href="prepjointree.c.html#LN1924"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN925"><span class='Ref_to_EnumConst'>RTE_FUNCTION</span></a><span class='Operator'>: 
</span>                        <a href="prepjointree.c.html#LN1944"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN985"><span class='Ref_to_Member'>functions</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>                            <a href="prepjointree.c.html#LN99"><span class='Ref_to_Proto'>pullup_replace_vars</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN1944"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN985"><span class='Ref_to_Member'>functions</span></a><span class='Delimiter'>, 
</span>                                                <a href="prepjointree.c.html#LN1924"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN926"><span class='Ref_to_EnumConst'>RTE_TABLEFUNC</span></a><span class='Operator'>: 
</span>                        <a href="prepjointree.c.html#LN1944"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN991"><span class='Ref_to_Member'>tablefunc</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN78"><span class='Ref_to_Struct'>TableFunc</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>                            <a href="prepjointree.c.html#LN99"><span class='Ref_to_Proto'>pullup_replace_vars</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN1944"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN991"><span class='Ref_to_Member'>tablefunc</span></a><span class='Delimiter'>, 
</span>                                                <a href="prepjointree.c.html#LN1924"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN927"><span class='Ref_to_EnumConst'>RTE_VALUES</span></a><span class='Operator'>: 
</span>                        <a href="prepjointree.c.html#LN1944"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN996"><span class='Ref_to_Member'>values_lists</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>                            <a href="prepjointree.c.html#LN99"><span class='Ref_to_Proto'>pullup_replace_vars</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN1944"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN996"><span class='Ref_to_Member'>values_lists</span></a><span class='Delimiter'>, 
</span>                                                <a href="prepjointree.c.html#LN1924"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN924"><span class='Ref_to_EnumConst'>RTE_JOIN</span></a><span class='Operator'>: 
</span>                    <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN928"><span class='Ref_to_EnumConst'>RTE_CTE</span></a><span class='Operator'>: 
</span>                    <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN929"><span class='Ref_to_EnumConst'>RTE_NAMEDTUPLESTORE</span></a><span class='Operator'>: 
</span>                        <span class='Comment_Multi_Line'>/* these shouldn't be marked LATERAL */ 
</span>                        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch rte-&GT;rtekind &raquo; </span> 
            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if rte-&GT;lateral &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if varno!=context-&GT;varno &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IsA(jtnode,RangeTblRe... &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1923"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1466"><span class='Ref_to_Struct'>FromExpr</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1990"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1466"><span class='Ref_to_Struct'>FromExpr</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>f</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1466"><span class='Ref_to_Struct'>FromExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN1923"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>; 
</span><a name="LN1991"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1991"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN1990"><span class='Ref_To_Local'>f</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1469"><span class='Ref_to_Member'>fromlist</span></a><span class='Parentheses'>) 
</span><a name="LN1994"></a>            <span class='Declare_Local'>replace_vars_in_jointree</span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1991"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN1924"><span class='Ref_to_Parameter'>context</span></a><span class='Delimiter'>, 
</span>                                     <a href="prepjointree.c.html#LN1925"><span class='Ref_to_Parameter'>lowest_nulling_outer_join</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepjointree.c.html#LN1990"><span class='Ref_To_Local'>f</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1470"><span class='Ref_to_Member'>quals</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN99"><span class='Ref_to_Proto'>pullup_replace_vars</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1990"><span class='Ref_To_Local'>f</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1470"><span class='Ref_to_Member'>quals</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN1924"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1923"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2000"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>j</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN1923"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>; 
</span><a name="LN2001"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>save_need_phvs</span> <span class='Operator'>= </span><a href="prepjointree.c.html#LN1924"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN48"><span class='Ref_to_Member'>need_phvs</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2000"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>== </span><a href="prepjointree.c.html#LN1925"><span class='Ref_to_Parameter'>lowest_nulling_outer_join</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* no more PHVs in or below this join */ 
</span>            <a href="prepjointree.c.html#LN1924"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN48"><span class='Ref_to_Member'>need_phvs</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="prepjointree.c.html#LN1925"><span class='Ref_to_Parameter'>lowest_nulling_outer_join</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="prepjointree.c.html#LN96"><span class='Ref_to_Proto'>replace_vars_in_jointree</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2000"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1449"><span class='Ref_to_Member'>larg</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN1924"><span class='Ref_to_Parameter'>context</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN1925"><span class='Ref_to_Parameter'>lowest_nulling_outer_join</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepjointree.c.html#LN96"><span class='Ref_to_Proto'>replace_vars_in_jointree</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2000"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1450"><span class='Ref_to_Member'>rarg</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN1924"><span class='Ref_to_Parameter'>context</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN1925"><span class='Ref_to_Parameter'>lowest_nulling_outer_join</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepjointree.c.html#LN2000"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1452"><span class='Ref_to_Member'>quals</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN99"><span class='Ref_to_Proto'>pullup_replace_vars</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2000"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1452"><span class='Ref_to_Member'>quals</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN1924"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We don't bother to update the colvars list, since it won't be used 
         * again ... 
         */ 
</span>        <a href="prepjointree.c.html#LN1924"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN48"><span class='Ref_to_Member'>need_phvs</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN2001"><span class='Ref_To_Local'>save_need_phvs</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IsA(jtnode,JoinExpr) &raquo; </span> 
    <span class='Control'>else</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized node type: %d"</span><span class='Delimiter'>, 
</span>             <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="../../../include/nodes/nodes.h.html#LN513"><span class='Ref_to_Macro'>nodeTag</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN1923"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end replace_vars_in_jointree &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Apply pullup variable replacement throughout an expression tree 
 * 
 * Returns a modified copy of the tree, so this can't be used where we 
 * need to do in-place replacement. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>* 
</span><a name="LN2031"></a><span class='Declare_Function'>pullup_replace_vars</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>expr</span><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN39"><span class='Ref_to_Struct'>pullup_replace_vars_context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="../../../include/rewrite/rewriteManip.h.html#LN63"><span class='Ref_to_Proto'>replace_rte_variables</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2031"><span class='Ref_to_Parameter'>expr</span></a><span class='Delimiter'>, 
</span>                                 <a href="prepjointree.c.html#LN2031"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN47"><span class='Ref_to_Member'>varno</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                 <a href="prepjointree.c.html#LN101"><span class='Ref_to_Proto'>pullup_replace_vars_callback</span></a><span class='Delimiter'>, 
</span>                                 <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN2031"><span class='Ref_to_Parameter'>context</span></a><span class='Delimiter'>, 
</span>                                 <a href="prepjointree.c.html#LN2031"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN46"><span class='Ref_to_Member'>outer_hasSubLinks</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>* 
</span><a name="LN2041"></a><span class='Declare_Function'>pullup_replace_vars_callback</span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Delimiter'>, 
</span><a name="LN2042"></a>                             <a href="../../../include/rewrite/rewriteManip.h.html#LN24"><span class='Ref_to_Struct'>replace_rte_variables_context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2044"></a>    <a href="prepjointree.c.html#LN39"><span class='Ref_to_Struct'>pullup_replace_vars_context</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rcon</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN39"><span class='Ref_to_Struct'>pullup_replace_vars_context</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN2042"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/rewrite/rewriteManip.h.html#LN27"><span class='Ref_to_Member'>callback_arg</span></a><span class='Delimiter'>; 
</span><a name="LN2045"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>varattno</span> <span class='Operator'>= </span><a href="prepjointree.c.html#LN2041"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN167"><span class='Ref_to_Member'>varattno</span></a><span class='Delimiter'>; 
</span><a name="LN2046"></a>    <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>newnode</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If PlaceHolderVars are needed, we cache the modified expressions in 
     * rcon-&GT;rv_cache[].  This is not in hopes of any material speed gain 
     * within this function, but to avoid generating identical PHVs with 
     * different IDs.  That would result in duplicate evaluations at runtime, 
     * and possibly prevent optimizations that rely on recognizing different 
     * references to the same subquery output as being equal().  So it's worth 
     * a bit of extra effort to avoid it. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2044"><span class='Ref_To_Local'>rcon</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN48"><span class='Ref_to_Member'>need_phvs</span></a> <span class='Operator'>&& 
</span>        <a href="prepjointree.c.html#LN2045"><span class='Ref_To_Local'>varattno</span></a> <span class='Operator'>&GT;= </span><a href="../../../include/access/attnum.h.html#LN22"><span class='Ref_to_Const'>InvalidAttrNumber</span></a> <span class='Operator'>&& 
</span>        <a href="prepjointree.c.html#LN2045"><span class='Ref_To_Local'>varattno</span></a> <span class='Operator'>&LT;= </span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2044"><span class='Ref_To_Local'>rcon</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN42"><span class='Ref_to_Member'>targetlist</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>        <a href="prepjointree.c.html#LN2044"><span class='Ref_To_Local'>rcon</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN50"><span class='Ref_to_Member'>rv_cache</span></a><span class='Delimiter'>[</span><a href="prepjointree.c.html#LN2045"><span class='Ref_To_Local'>varattno</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Just copy the entry and fall through to adjust its varlevelsup */ 
</span>        <a href="prepjointree.c.html#LN2046"><span class='Ref_To_Local'>newnode</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2044"><span class='Ref_To_Local'>rcon</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN50"><span class='Ref_to_Member'>rv_cache</span></a><span class='Delimiter'>[</span><a href="prepjointree.c.html#LN2045"><span class='Ref_To_Local'>varattno</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2045"><span class='Ref_To_Local'>varattno</span></a> <span class='Operator'>== </span><a href="../../../include/access/attnum.h.html#LN22"><span class='Ref_to_Const'>InvalidAttrNumber</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Must expand whole-tuple reference into RowExpr */ 
</span><a name="LN2068"></a>        <a href="../../../include/nodes/primnodes.h.html#LN981"><span class='Ref_to_Struct'>RowExpr</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>rowexpr</span><span class='Delimiter'>; 
</span><a name="LN2069"></a>        <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>colnames</span><span class='Delimiter'>; 
</span><a name="LN2070"></a>        <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>fields</span><span class='Delimiter'>; 
</span><a name="LN2071"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>save_need_phvs</span> <span class='Operator'>= </span><a href="prepjointree.c.html#LN2044"><span class='Ref_To_Local'>rcon</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN48"><span class='Ref_to_Member'>need_phvs</span></a><span class='Delimiter'>; 
</span><a name="LN2072"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>save_sublevelsup</span> <span class='Operator'>= </span><a href="prepjointree.c.html#LN2042"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/rewrite/rewriteManip.h.html#LN29"><span class='Ref_to_Member'>sublevels_up</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If generating an expansion for a var of a named rowtype (ie, this 
         * is a plain relation RTE), then we must include dummy items for 
         * dropped columns.  If the var is RECORD (ie, this is a JOIN), then 
         * omit dropped columns. Either way, attach column names to the 
         * RowExpr for use of ruleutils.c. 
         * 
         * In order to be able to cache the results, we always generate the 
         * expansion with varlevelsup = 0, and then adjust if needed. 
         */ 
</span>        <a href="../../../include/parser/parse_relation.h.html#LN120"><span class='Ref_to_Proto'>expandRTE</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2044"><span class='Ref_To_Local'>rcon</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN43"><span class='Ref_to_Member'>target_rte</span></a><span class='Delimiter'>, 
</span>                  <a href="prepjointree.c.html#LN2041"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN165"><span class='Ref_to_Member'>varno</span></a><span class='Delimiter'>, </span><span class='Number'>0</span> <span class='Comment_Multi_Line'>/* not varlevelsup */ </span><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN2041"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN177"><span class='Ref_to_Member'>location</span></a><span class='Delimiter'>, 
</span>                  <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2041"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN169"><span class='Ref_to_Member'>vartype</span></a> <span class='Operator'>!= </span><a href="../../../include/catalog/pg_type.h.html#LN679"><span class='Ref_to_Const'>RECORDOID</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                  <span class='Operator'>&</span><a href="prepjointree.c.html#LN2069"><span class='Ref_To_Local'>colnames</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="prepjointree.c.html#LN2070"><span class='Ref_To_Local'>fields</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Adjust the generated per-field Vars, but don't insert PHVs */ 
</span>        <a href="prepjointree.c.html#LN2044"><span class='Ref_To_Local'>rcon</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN48"><span class='Ref_to_Member'>need_phvs</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="prepjointree.c.html#LN2042"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/rewrite/rewriteManip.h.html#LN29"><span class='Ref_to_Member'>sublevels_up</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* to match the expandRTE output */ 
</span>        <a href="prepjointree.c.html#LN2070"><span class='Ref_To_Local'>fields</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/rewrite/rewriteManip.h.html#LN68"><span class='Ref_to_Proto'>replace_rte_variables_mutator</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN2070"><span class='Ref_To_Local'>fields</span></a><span class='Delimiter'>, 
</span>                                                        <a href="prepjointree.c.html#LN2042"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepjointree.c.html#LN2044"><span class='Ref_To_Local'>rcon</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN48"><span class='Ref_to_Member'>need_phvs</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN2071"><span class='Ref_To_Local'>save_need_phvs</span></a><span class='Delimiter'>; 
</span>        <a href="prepjointree.c.html#LN2042"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/rewrite/rewriteManip.h.html#LN29"><span class='Ref_to_Member'>sublevels_up</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN2072"><span class='Ref_To_Local'>save_sublevelsup</span></a><span class='Delimiter'>; 
</span> 
        <a href="prepjointree.c.html#LN2068"><span class='Ref_To_Local'>rowexpr</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN981"><span class='Ref_to_Struct'>RowExpr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepjointree.c.html#LN2068"><span class='Ref_To_Local'>rowexpr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN984"><span class='Ref_to_Member'>args</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN2070"><span class='Ref_To_Local'>fields</span></a><span class='Delimiter'>; 
</span>        <a href="prepjointree.c.html#LN2068"><span class='Ref_To_Local'>rowexpr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN985"><span class='Ref_to_Member'>row_typeid</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN2041"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN169"><span class='Ref_to_Member'>vartype</span></a><span class='Delimiter'>; 
</span>        <a href="prepjointree.c.html#LN2068"><span class='Ref_To_Local'>rowexpr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN996"><span class='Ref_to_Member'>row_format</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/primnodes.h.html#LN438"><span class='Ref_to_EnumConst'>COERCE_IMPLICIT_CAST</span></a><span class='Delimiter'>; 
</span>        <a href="prepjointree.c.html#LN2068"><span class='Ref_To_Local'>rowexpr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN997"><span class='Ref_to_Member'>colnames</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN2069"><span class='Ref_To_Local'>colnames</span></a><span class='Delimiter'>; 
</span>        <a href="prepjointree.c.html#LN2068"><span class='Ref_To_Local'>rowexpr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN998"><span class='Ref_to_Member'>location</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN2041"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN177"><span class='Ref_to_Member'>location</span></a><span class='Delimiter'>; 
</span>        <a href="prepjointree.c.html#LN2046"><span class='Ref_To_Local'>newnode</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN2068"><span class='Ref_To_Local'>rowexpr</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Insert PlaceHolderVar if needed.  Notice that we are wrapping one 
         * PlaceHolderVar around the whole RowExpr, rather than putting one 
         * around each element of the row.  This is because we need the 
         * expression to yield NULL, not ROW(NULL,NULL,...) when it is forced 
         * to null by an outer join. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2044"><span class='Ref_To_Local'>rcon</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN48"><span class='Ref_to_Member'>need_phvs</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* RowExpr is certainly not strict, so always need PHV */ 
</span>            <a href="prepjointree.c.html#LN2046"><span class='Ref_To_Local'>newnode</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>                <a href="../../../include/optimizer/placeholder.h.html#LN19"><span class='Ref_to_Proto'>make_placeholder_expr</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2044"><span class='Ref_To_Local'>rcon</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN41"><span class='Ref_to_Member'>root</span></a><span class='Delimiter'>, 
</span>                                      <span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN2046"><span class='Ref_To_Local'>newnode</span></a><span class='Delimiter'>, 
</span>                                      <a href="../../../include/nodes/bitmapset.h.html#LN67"><span class='Ref_to_Proto'>bms_make_singleton</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2044"><span class='Ref_To_Local'>rcon</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN47"><span class='Ref_to_Member'>varno</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* cache it with the PHV, and with varlevelsup still zero */ 
</span>            <a href="prepjointree.c.html#LN2044"><span class='Ref_To_Local'>rcon</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN50"><span class='Ref_to_Member'>rv_cache</span></a><span class='Delimiter'>[</span><a href="../../../include/access/attnum.h.html#LN22"><span class='Ref_to_Const'>InvalidAttrNumber</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2046"><span class='Ref_To_Local'>newnode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if varattno==InvalidAttr... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Normal case referencing one targetlist element */ 
</span><a name="LN2125"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tle</span> <span class='Operator'>= </span><a href="../../../include/parser/parsetree.h.html#LN69"><span class='Ref_to_Proto'>get_tle_by_resno</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2044"><span class='Ref_To_Local'>rcon</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN42"><span class='Ref_to_Member'>targetlist</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN2045"><span class='Ref_To_Local'>varattno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2125"><span class='Ref_To_Local'>tle</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span>        <span class='Comment_Single_Line'>/* shouldn't happen */ 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not find attribute %d in subquery targetlist"</span><span class='Delimiter'>, 
</span>                 <a href="prepjointree.c.html#LN2045"><span class='Ref_To_Local'>varattno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Make a copy of the tlist item to return */ 
</span>        <a href="prepjointree.c.html#LN2046"><span class='Ref_To_Local'>newnode</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2125"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Insert PlaceHolderVar if needed */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2044"><span class='Ref_To_Local'>rcon</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN48"><span class='Ref_to_Member'>need_phvs</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2137"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>wrap</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2046"><span class='Ref_To_Local'>newnode</span></a> <span class='Operator'>&& </span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2046"><span class='Ref_To_Local'>newnode</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a><span class='Parentheses'>)</span> <span class='Operator'>&& 
</span>                <span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN2046"><span class='Ref_To_Local'>newnode</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>varlevelsup <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * Simple Vars always escape being wrapped, unless they are 
                 * lateral references to something outside the subquery being 
                 * pulled up.  (Even then, we could omit the PlaceHolderVar if 
                 * the referenced rel is under the same lowest outer join, but 
                 * it doesn't seem worth the trouble to check that.) 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2044"><span class='Ref_To_Local'>rcon</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN43"><span class='Ref_to_Member'>target_rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1024"><span class='Ref_to_Member'>lateral</span></a> <span class='Operator'>&& 
</span>                    <span class='Operator'>!</span><a href="../../../include/nodes/bitmapset.h.html#LN75"><span class='Ref_to_Proto'>bms_is_member</span></a><span class='Parentheses'>(((</span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN2046"><span class='Ref_To_Local'>newnode</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>varno<span class='Delimiter'>, </span><a href="prepjointree.c.html#LN2044"><span class='Ref_To_Local'>rcon</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN44"><span class='Ref_to_Member'>relids</span></a><span class='Parentheses'>))</span> 
                    <a href="prepjointree.c.html#LN2137"><span class='Ref_To_Local'>wrap</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="prepjointree.c.html#LN2137"><span class='Ref_To_Local'>wrap</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2046"><span class='Ref_To_Local'>newnode</span></a> <span class='Operator'>&& </span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2046"><span class='Ref_To_Local'>newnode</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN1846"><span class='Ref_to_Struct'>PlaceHolderVar</span></a><span class='Parentheses'>)</span> <span class='Operator'>&& 
</span>                     <span class='Parentheses'>((</span><a href="../../../include/nodes/relation.h.html#LN1846"><span class='Ref_to_Struct'>PlaceHolderVar</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN2046"><span class='Ref_To_Local'>newnode</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>phlevelsup <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* No need to wrap a PlaceHolderVar with another one, either */ 
</span>                <a href="prepjointree.c.html#LN2137"><span class='Ref_To_Local'>wrap</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2044"><span class='Ref_To_Local'>rcon</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN49"><span class='Ref_to_Member'>wrap_non_vars</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Wrap all non-Vars in a PlaceHolderVar */ 
</span>                <a href="prepjointree.c.html#LN2137"><span class='Ref_To_Local'>wrap</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * If it contains a Var of the subquery being pulled up, and 
                 * does not contain any non-strict constructs, then it's 
                 * certainly nullable so we don't need to insert a 
                 * PlaceHolderVar. 
                 * 
                 * This analysis could be tighter: in particular, a non-strict 
                 * construct hidden within a lower-level PlaceHolderVar is not 
                 * reason to add another PHV.  But for now it doesn't seem 
                 * worth the code to be more exact. 
                 * 
                 * Note: in future maybe we should insert a PlaceHolderVar 
                 * anyway, if the tlist item is expensive to evaluate? 
                 * 
                 * For a LATERAL subquery, we have to check the actual var 
                 * membership of the node, but if it's non-lateral then any 
                 * level-zero var must belong to the subquery. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="prepjointree.c.html#LN2044"><span class='Ref_To_Local'>rcon</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN43"><span class='Ref_to_Member'>target_rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1024"><span class='Ref_to_Member'>lateral</span></a> <span class='Operator'>? 
</span>                   <a href="../../../include/nodes/bitmapset.h.html#LN76"><span class='Ref_to_Proto'>bms_overlap</span></a><span class='Parentheses'>(</span><a href="../../../include/optimizer/var.h.html#LN29"><span class='Ref_to_Proto'>pull_varnos</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN2046"><span class='Ref_To_Local'>newnode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN2044"><span class='Ref_To_Local'>rcon</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN44"><span class='Ref_to_Member'>relids</span></a><span class='Parentheses'>)</span> <span class='Operator'>: 
</span>                     <a href="../../../include/optimizer/var.h.html#LN34"><span class='Ref_to_Proto'>contain_vars_of_level</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>)</span> <a href="prepjointree.c.html#LN2046"><span class='Ref_To_Local'>newnode</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>))</span> <span class='Operator'>&& 
</span>                    <span class='Operator'>!</span><a href="../../../include/optimizer/clauses.h.html#LN64"><span class='Ref_to_Proto'>contain_nonstrict_functions</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>)</span> <a href="prepjointree.c.html#LN2046"><span class='Ref_To_Local'>newnode</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* No wrap needed */ 
</span>                    <a href="prepjointree.c.html#LN2137"><span class='Ref_To_Local'>wrap</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* Else wrap it in a PlaceHolderVar */ 
</span>                    <a href="prepjointree.c.html#LN2137"><span class='Ref_To_Local'>wrap</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2137"><span class='Ref_To_Local'>wrap</span></a><span class='Parentheses'>) 
</span>                <a href="prepjointree.c.html#LN2046"><span class='Ref_To_Local'>newnode</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>                    <a href="../../../include/optimizer/placeholder.h.html#LN19"><span class='Ref_to_Proto'>make_placeholder_expr</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2044"><span class='Ref_To_Local'>rcon</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN41"><span class='Ref_to_Member'>root</span></a><span class='Delimiter'>, 
</span>                                          <span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN2046"><span class='Ref_To_Local'>newnode</span></a><span class='Delimiter'>, 
</span>                                          <a href="../../../include/nodes/bitmapset.h.html#LN67"><span class='Ref_to_Proto'>bms_make_singleton</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2044"><span class='Ref_To_Local'>rcon</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN47"><span class='Ref_to_Member'>varno</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Cache it if possible (ie, if the attno is in range, which it 
             * probably always should be).  We can cache the value even if we 
             * decided we didn't need a PHV, since this result will be 
             * suitable for any request that has need_phvs. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2045"><span class='Ref_To_Local'>varattno</span></a> <span class='Operator'>&GT; </span><a href="../../../include/access/attnum.h.html#LN22"><span class='Ref_to_Const'>InvalidAttrNumber</span></a> <span class='Operator'>&& 
</span>                <a href="prepjointree.c.html#LN2045"><span class='Ref_To_Local'>varattno</span></a> <span class='Operator'>&LT;= </span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2044"><span class='Ref_To_Local'>rcon</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN42"><span class='Ref_to_Member'>targetlist</span></a><span class='Parentheses'>))</span> 
                <a href="prepjointree.c.html#LN2044"><span class='Ref_To_Local'>rcon</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN50"><span class='Ref_to_Member'>rv_cache</span></a><span class='Delimiter'>[</span><a href="prepjointree.c.html#LN2045"><span class='Ref_To_Local'>varattno</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2046"><span class='Ref_To_Local'>newnode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if rcon-&GT;need_phvs &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Must adjust varlevelsup if tlist item is from higher query */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2041"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN172"><span class='Ref_to_Member'>varlevelsup</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/rewrite/rewriteManip.h.html#LN44"><span class='Ref_to_Proto'>IncrementVarSublevelsUp</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2046"><span class='Ref_To_Local'>newnode</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN2041"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN172"><span class='Ref_to_Member'>varlevelsup</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="prepjointree.c.html#LN2046"><span class='Ref_To_Local'>newnode</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pullup_replace_vars_callback &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Apply pullup variable replacement to a subquery 
 * 
 * This needs to be different from pullup_replace_vars() because 
 * replace_rte_variables will think that it shouldn't increment sublevels_up 
 * before entering the Query; so we need to call it with sublevels_up == 1. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>* 
</span><a name="LN2234"></a><span class='Declare_Function'>pullup_replace_vars_subquery</span><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>query</span><span class='Delimiter'>, 
</span><a name="LN2235"></a>                             <a href="prepjointree.c.html#LN39"><span class='Ref_to_Struct'>pullup_replace_vars_context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2234"><span class='Ref_to_Parameter'>query</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/rewrite/rewriteManip.h.html#LN63"><span class='Ref_to_Proto'>replace_rte_variables</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN2234"><span class='Ref_to_Parameter'>query</span></a><span class='Delimiter'>, 
</span>                                           <a href="prepjointree.c.html#LN2235"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN47"><span class='Ref_to_Member'>varno</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                           <a href="prepjointree.c.html#LN101"><span class='Ref_to_Proto'>pullup_replace_vars_callback</span></a><span class='Delimiter'>, 
</span>                                           <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN2235"><span class='Ref_to_Parameter'>context</span></a><span class='Delimiter'>, 
</span>                                           <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * pull_up_subqueries_cleanup 
 *      Recursively fix up jointree after deletion of some subqueries. 
 * 
 * The jointree now contains some NULL subtrees, which we need to get rid of. 
 * In a FromExpr, just rebuild the child-node list with null entries deleted. 
 * In an inner JOIN, replace the JoinExpr node with a one-child FromExpr. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>* 
</span><a name="LN2254"></a><span class='Declare_Function'>pull_up_subqueries_cleanup</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jtnode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2254"><span class='Ref_to_Parameter'>jtnode</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2254"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1415"><span class='Ref_to_Struct'>RangeTblRef</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Nothing to do at leaf nodes. */ 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2254"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1466"><span class='Ref_to_Struct'>FromExpr</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2263"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1466"><span class='Ref_to_Struct'>FromExpr</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>f</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1466"><span class='Ref_to_Struct'>FromExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN2254"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>; 
</span><a name="LN2264"></a>        <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>newfrom</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN2265"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2265"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN2263"><span class='Ref_To_Local'>f</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1469"><span class='Ref_to_Member'>fromlist</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2269"></a>            <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>child</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2265"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2269"><span class='Ref_To_Local'>child</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <a href="prepjointree.c.html#LN2269"><span class='Ref_To_Local'>child</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN105"><span class='Ref_to_Proto'>pull_up_subqueries_cleanup</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2269"><span class='Ref_To_Local'>child</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="prepjointree.c.html#LN2264"><span class='Ref_To_Local'>newfrom</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2264"><span class='Ref_To_Local'>newfrom</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN2269"><span class='Ref_To_Local'>child</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="prepjointree.c.html#LN2263"><span class='Ref_To_Local'>f</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1469"><span class='Ref_to_Member'>fromlist</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN2264"><span class='Ref_To_Local'>newfrom</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2254"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2280"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>j</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN2254"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2280"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1449"><span class='Ref_to_Member'>larg</span></a><span class='Parentheses'>) 
</span>            <a href="prepjointree.c.html#LN2280"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1449"><span class='Ref_to_Member'>larg</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN105"><span class='Ref_to_Proto'>pull_up_subqueries_cleanup</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2280"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1449"><span class='Ref_to_Member'>larg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2280"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1450"><span class='Ref_to_Member'>rarg</span></a><span class='Parentheses'>) 
</span>            <a href="prepjointree.c.html#LN2280"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1450"><span class='Ref_to_Member'>rarg</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN105"><span class='Ref_to_Proto'>pull_up_subqueries_cleanup</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2280"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1450"><span class='Ref_to_Member'>rarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2280"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1449"><span class='Ref_to_Member'>larg</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2280"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1447"><span class='Ref_to_Member'>jointype</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/nodes.h.html#LN677"><span class='Ref_to_EnumConst'>JOIN_INNER</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2280"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1450"><span class='Ref_to_Member'>rarg</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/makefuncs.h.html#LN47"><span class='Ref_to_Proto'>makeFromExpr</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN138"><span class='Ref_to_Macro'>list_make1</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2280"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1450"><span class='Ref_to_Member'>rarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN2280"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1452"><span class='Ref_to_Member'>quals</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2280"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1450"><span class='Ref_to_Member'>rarg</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2280"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1447"><span class='Ref_to_Member'>jointype</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/nodes.h.html#LN677"><span class='Ref_to_EnumConst'>JOIN_INNER</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/makefuncs.h.html#LN47"><span class='Ref_to_Proto'>makeFromExpr</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN138"><span class='Ref_to_Macro'>list_make1</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2280"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1449"><span class='Ref_to_Member'>larg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN2280"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1452"><span class='Ref_to_Member'>quals</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IsA(jtnode,JoinExpr) &raquo; </span> 
    <span class='Control'>else</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized node type: %d"</span><span class='Delimiter'>, 
</span>             <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="../../../include/nodes/nodes.h.html#LN513"><span class='Ref_to_Macro'>nodeTag</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2254"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="prepjointree.c.html#LN2254"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pull_up_subqueries_cleanup &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * flatten_simple_union_all 
 *      Try to optimize top-level UNION ALL structure into an appendrel 
 * 
 * If a query's setOperations tree consists entirely of simple UNION ALL 
 * operations, flatten it into an append relation, which we can process more 
 * intelligently than the general setops case.  Otherwise, do nothing. 
 * 
 * In most cases, this can succeed only for a top-level query, because for a 
 * subquery in FROM, the parent query's invocation of pull_up_subqueries would 
 * already have flattened the UNION via pull_up_simple_union_all.  But there 
 * are a few cases we can support here but not in that code path, for example 
 * when the subquery also contains ORDER BY. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN2320"></a><span class='Declare_Function'>flatten_simple_union_all</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2322"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>parse</span> <span class='Operator'>= </span><a href="prepjointree.c.html#LN2320"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Delimiter'>; 
</span><a name="LN2323"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN1545"><span class='Ref_to_Struct'>SetOperationStmt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>topop</span><span class='Delimiter'>; 
</span><a name="LN2324"></a>    <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>leftmostjtnode</span><span class='Delimiter'>; 
</span><a name="LN2325"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>leftmostRTI</span><span class='Delimiter'>; 
</span><a name="LN2326"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>leftmostRTE</span><span class='Delimiter'>; 
</span><a name="LN2327"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>childRTI</span><span class='Delimiter'>; 
</span><a name="LN2328"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>childRTE</span><span class='Delimiter'>; 
</span><a name="LN2329"></a>    <a href="../../../include/nodes/primnodes.h.html#LN1415"><span class='Ref_to_Struct'>RangeTblRef</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rtr</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Shouldn't be called unless query has setops */ 
</span>    <a href="prepjointree.c.html#LN2323"><span class='Ref_To_Local'>topop</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN575"><span class='Ref_to_Macro'>castNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN1545"><span class='Ref_to_Struct'>SetOperationStmt</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN2322"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN162"><span class='Ref_to_Member'>setOperations</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2323"><span class='Ref_To_Local'>topop</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Can't optimize away a recursive UNION */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2320"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN304"><span class='Ref_to_Member'>hasRecursion</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Recursively check the tree of set operations.  If not all UNION ALL 
     * with identical column types, punt. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="prepjointree.c.html#LN91"><span class='Ref_to_Proto'>is_simple_union_all_recurse</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN2323"><span class='Ref_To_Local'>topop</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN2322"><span class='Ref_To_Local'>parse</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN2323"><span class='Ref_To_Local'>topop</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1555"><span class='Ref_to_Member'>colTypes</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Locate the leftmost leaf query in the setops tree.  The upper query's 
     * Vars all refer to this RTE (see transformSetOperationStmt). 
     */ 
</span>    <a href="prepjointree.c.html#LN2324"><span class='Ref_To_Local'>leftmostjtnode</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN2323"><span class='Ref_To_Local'>topop</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1550"><span class='Ref_to_Member'>larg</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2324"><span class='Ref_To_Local'>leftmostjtnode</span></a> <span class='Operator'>&& </span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2324"><span class='Ref_To_Local'>leftmostjtnode</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN1545"><span class='Ref_to_Struct'>SetOperationStmt</span></a><span class='Parentheses'>))</span> 
        <a href="prepjointree.c.html#LN2324"><span class='Ref_To_Local'>leftmostjtnode</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../../include/nodes/parsenodes.h.html#LN1545"><span class='Ref_to_Struct'>SetOperationStmt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN2324"><span class='Ref_To_Local'>leftmostjtnode</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>larg<span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2324"><span class='Ref_To_Local'>leftmostjtnode</span></a> <span class='Operator'>&& </span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2324"><span class='Ref_To_Local'>leftmostjtnode</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1415"><span class='Ref_to_Struct'>RangeTblRef</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="prepjointree.c.html#LN2325"><span class='Ref_To_Local'>leftmostRTI</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN1415"><span class='Ref_to_Struct'>RangeTblRef</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN2324"><span class='Ref_To_Local'>leftmostjtnode</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>rtindex<span class='Delimiter'>; 
</span>    <a href="prepjointree.c.html#LN2326"><span class='Ref_To_Local'>leftmostRTE</span></a> <span class='Operator'>= </span><a href="../../../include/parser/parsetree.h.html#LN30"><span class='Ref_to_Macro'>rt_fetch</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2325"><span class='Ref_To_Local'>leftmostRTI</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN2322"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN134"><span class='Ref_to_Member'>rtable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2326"><span class='Ref_To_Local'>leftmostRTE</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN936"><span class='Ref_to_Member'>rtekind</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/parsenodes.h.html#LN923"><span class='Ref_to_EnumConst'>RTE_SUBQUERY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Make a copy of the leftmost RTE and add it to the rtable.  This copy 
     * will represent the leftmost leaf query in its capacity as a member of 
     * the appendrel.  The original will represent the appendrel as a whole. 
     * (We must do things this way because the upper query's Vars have to be 
     * seen as referring to the whole appendrel.) 
     */ 
</span>    <a href="prepjointree.c.html#LN2328"><span class='Ref_To_Local'>childRTE</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2326"><span class='Ref_To_Local'>leftmostRTE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="prepjointree.c.html#LN2322"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN134"><span class='Ref_to_Member'>rtable</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2322"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN134"><span class='Ref_to_Member'>rtable</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN2328"><span class='Ref_To_Local'>childRTE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="prepjointree.c.html#LN2327"><span class='Ref_To_Local'>childRTI</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2322"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN134"><span class='Ref_to_Member'>rtable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Modify the setops tree to reference the child copy */ 
</span>    <span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN1415"><span class='Ref_to_Struct'>RangeTblRef</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN2324"><span class='Ref_To_Local'>leftmostjtnode</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>rtindex <span class='Operator'>= </span><a href="prepjointree.c.html#LN2327"><span class='Ref_To_Local'>childRTI</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Modify the formerly-leftmost RTE to mark it as an appendrel parent */ 
</span>    <a href="prepjointree.c.html#LN2326"><span class='Ref_To_Local'>leftmostRTE</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1025"><span class='Ref_to_Member'>inh</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Form a RangeTblRef for the appendrel, and insert it into FROM.  The top 
     * Query of a setops tree should have had an empty FromClause initially. 
     */ 
</span>    <a href="prepjointree.c.html#LN2329"><span class='Ref_To_Local'>rtr</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1415"><span class='Ref_to_Struct'>RangeTblRef</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="prepjointree.c.html#LN2329"><span class='Ref_To_Local'>rtr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1418"><span class='Ref_to_Member'>rtindex</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN2325"><span class='Ref_To_Local'>leftmostRTI</span></a><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2322"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN135"><span class='Ref_to_Member'>jointree</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1469"><span class='Ref_to_Member'>fromlist</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="prepjointree.c.html#LN2322"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN135"><span class='Ref_to_Member'>jointree</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1469"><span class='Ref_to_Member'>fromlist</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN138"><span class='Ref_to_Macro'>list_make1</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2329"><span class='Ref_To_Local'>rtr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now pretend the query has no setops.  We must do this before trying to 
     * do subquery pullup, because of Assert in pull_up_simple_subquery. 
     */ 
</span>    <a href="prepjointree.c.html#LN2322"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN162"><span class='Ref_to_Member'>setOperations</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Build AppendRelInfo information, and apply pull_up_subqueries to the 
     * leaf queries of the UNION ALL.  (We must do that now because they 
     * weren't previously referenced by the jointree, and so were missed by 
     * the main invocation of pull_up_subqueries.) 
     */ 
</span>    <a href="prepjointree.c.html#LN78"><span class='Ref_to_Proto'>pull_up_union_leaf_queries</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN2323"><span class='Ref_To_Local'>topop</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN2320"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN2325"><span class='Ref_To_Local'>leftmostRTI</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN2322"><span class='Ref_To_Local'>parse</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end flatten_simple_union_all &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * reduce_outer_joins 
 *      Attempt to reduce outer joins to plain inner joins. 
 * 
 * The idea here is that given a query like 
 *      SELECT ... FROM a LEFT JOIN b ON (...) WHERE b.y = 42; 
 * we can reduce the LEFT JOIN to a plain JOIN if the "=" operator in WHERE 
 * is strict.  The strict operator will always return NULL, causing the outer 
 * WHERE to fail, on any row where the LEFT JOIN filled in NULLs for b's 
 * columns.  Therefore, there's no need for the join to produce null-extended 
 * rows in the first place --- which makes it a plain join not an outer join. 
 * (This scenario may not be very likely in a query written out by hand, but 
 * it's reasonably likely when pushing quals down into complex views.) 
 * 
 * More generally, an outer join can be reduced in strength if there is a 
 * strict qual above it in the qual tree that constrains a Var from the 
 * nullable side of the join to be non-null.  (For FULL joins this applies 
 * to each side separately.) 
 * 
 * Another transformation we apply here is to recognize cases like 
 *      SELECT ... FROM a LEFT JOIN b ON (a.x = b.y) WHERE b.y IS NULL; 
 * If the join clause is strict for b.y, then only null-extended rows could 
 * pass the upper WHERE, and we can conclude that what the query is really 
 * specifying is an anti-semijoin.  We change the join type from JOIN_LEFT 
 * to JOIN_ANTI.  The IS NULL clause then becomes redundant, and must be 
 * removed to prevent bogus selectivity calculations, but we leave it to 
 * distribute_qual_to_rels to get rid of such clauses. 
 * 
 * Also, we get rid of JOIN_RIGHT cases by flipping them around to become 
 * JOIN_LEFT.  This saves some code here and in some later planner routines, 
 * but the main reason to do it is to not need to invent a JOIN_REVERSE_ANTI 
 * join type. 
 * 
 * To ease recognition of strict qual clauses, we require this routine to be 
 * run after expression preprocessing (i.e., qual canonicalization and JOIN 
 * alias-var expansion). 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN2438"></a><span class='Declare_Function'>reduce_outer_joins</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2440"></a>    <a href="prepjointree.c.html#LN53"><span class='Ref_to_Struct'>reduce_outer_joins_state</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * To avoid doing strictness checks on more quals than necessary, we want 
     * to stop descending the jointree as soon as there are no outer joins 
     * below our current point.  This consideration forces a two-pass process. 
     * The first pass gathers information about which base rels appear below 
     * each side of each join clause, and about whether there are outer 
     * join(s) below each side of each join clause. The second pass examines 
     * qual clauses and changes join types as it descends the tree. 
     */ 
</span>    <a href="prepjointree.c.html#LN2440"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN106"><span class='Ref_to_Proto'>reduce_outer_joins_pass1</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN2438"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN135"><span class='Ref_to_Member'>jointree</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* planner.c shouldn't have called me if no outer joins */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2440"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| !</span><a href="prepjointree.c.html#LN2440"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN56"><span class='Ref_to_Member'>contains_outer</span></a><span class='Parentheses'>) 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"so where are the outer joins?"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="prepjointree.c.html#LN107"><span class='Ref_to_Proto'>reduce_outer_joins_pass2</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN2438"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN135"><span class='Ref_to_Member'>jointree</span></a><span class='Delimiter'>, 
</span>                             <a href="prepjointree.c.html#LN2440"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN2438"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end reduce_outer_joins &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * reduce_outer_joins_pass1 - phase 1 data collection 
 * 
 * Returns a state node describing the given jointree node. 
 */ 
</span><span class='Keyword'>static </span><a href="prepjointree.c.html#LN53"><span class='Ref_to_Struct'>reduce_outer_joins_state</span></a> <span class='Operator'>* 
</span><a name="LN2467"></a><span class='Declare_Function'>reduce_outer_joins_pass1</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jtnode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2469"></a>    <a href="prepjointree.c.html#LN53"><span class='Ref_to_Struct'>reduce_outer_joins_state</span></a> <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="prepjointree.c.html#LN2469"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN53"><span class='Ref_to_Struct'>reduce_outer_joins_state</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN53"><span class='Ref_to_Struct'>reduce_outer_joins_state</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="prepjointree.c.html#LN2469"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN55"><span class='Ref_to_Member'>relids</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="prepjointree.c.html#LN2469"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN56"><span class='Ref_to_Member'>contains_outer</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="prepjointree.c.html#LN2469"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN57"><span class='Ref_to_Member'>sub_states</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2467"><span class='Ref_to_Parameter'>jtnode</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="prepjointree.c.html#LN2469"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2467"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1415"><span class='Ref_to_Struct'>RangeTblRef</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2481"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>varno</span> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN1415"><span class='Ref_to_Struct'>RangeTblRef</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN2467"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>rtindex<span class='Delimiter'>; 
</span> 
        <a href="prepjointree.c.html#LN2469"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN55"><span class='Ref_to_Member'>relids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN67"><span class='Ref_to_Proto'>bms_make_singleton</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2481"><span class='Ref_To_Local'>varno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2467"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1466"><span class='Ref_to_Struct'>FromExpr</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2487"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1466"><span class='Ref_to_Struct'>FromExpr</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>f</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1466"><span class='Ref_to_Struct'>FromExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN2467"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>; 
</span><a name="LN2488"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2488"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN2487"><span class='Ref_To_Local'>f</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1469"><span class='Ref_to_Member'>fromlist</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2492"></a>            <a href="prepjointree.c.html#LN53"><span class='Ref_to_Struct'>reduce_outer_joins_state</span></a> <span class='Operator'>*</span><span class='Declare_Local'>sub_state</span><span class='Delimiter'>; 
</span> 
            <a href="prepjointree.c.html#LN2492"><span class='Ref_To_Local'>sub_state</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN106"><span class='Ref_to_Proto'>reduce_outer_joins_pass1</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2488"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="prepjointree.c.html#LN2469"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN55"><span class='Ref_to_Member'>relids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN91"><span class='Ref_to_Proto'>bms_add_members</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2469"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN55"><span class='Ref_to_Member'>relids</span></a><span class='Delimiter'>, 
</span>                                             <a href="prepjointree.c.html#LN2492"><span class='Ref_To_Local'>sub_state</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN55"><span class='Ref_to_Member'>relids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="prepjointree.c.html#LN2469"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN56"><span class='Ref_to_Member'>contains_outer</span></a> <span class='Operator'>|= </span><a href="prepjointree.c.html#LN2492"><span class='Ref_To_Local'>sub_state</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN56"><span class='Ref_to_Member'>contains_outer</span></a><span class='Delimiter'>; 
</span>            <a href="prepjointree.c.html#LN2469"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN57"><span class='Ref_to_Member'>sub_states</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2469"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN57"><span class='Ref_to_Member'>sub_states</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN2492"><span class='Ref_To_Local'>sub_state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2467"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2503"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>j</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN2467"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>; 
</span><a name="LN2504"></a>        <a href="prepjointree.c.html#LN53"><span class='Ref_to_Struct'>reduce_outer_joins_state</span></a> <span class='Operator'>*</span><span class='Declare_Local'>sub_state</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* join's own RT index is not wanted in result-&GT;relids */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN720"><span class='Ref_to_Macro'>IS_OUTER_JOIN</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2503"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1447"><span class='Ref_to_Member'>jointype</span></a><span class='Parentheses'>))</span> 
            <a href="prepjointree.c.html#LN2469"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN56"><span class='Ref_to_Member'>contains_outer</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <a href="prepjointree.c.html#LN2504"><span class='Ref_To_Local'>sub_state</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN106"><span class='Ref_to_Proto'>reduce_outer_joins_pass1</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2503"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1449"><span class='Ref_to_Member'>larg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepjointree.c.html#LN2469"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN55"><span class='Ref_to_Member'>relids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN91"><span class='Ref_to_Proto'>bms_add_members</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2469"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN55"><span class='Ref_to_Member'>relids</span></a><span class='Delimiter'>, 
</span>                                         <a href="prepjointree.c.html#LN2504"><span class='Ref_To_Local'>sub_state</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN55"><span class='Ref_to_Member'>relids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepjointree.c.html#LN2469"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN56"><span class='Ref_to_Member'>contains_outer</span></a> <span class='Operator'>|= </span><a href="prepjointree.c.html#LN2504"><span class='Ref_To_Local'>sub_state</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN56"><span class='Ref_to_Member'>contains_outer</span></a><span class='Delimiter'>; 
</span>        <a href="prepjointree.c.html#LN2469"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN57"><span class='Ref_to_Member'>sub_states</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2469"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN57"><span class='Ref_to_Member'>sub_states</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN2504"><span class='Ref_To_Local'>sub_state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="prepjointree.c.html#LN2504"><span class='Ref_To_Local'>sub_state</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN106"><span class='Ref_to_Proto'>reduce_outer_joins_pass1</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2503"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1450"><span class='Ref_to_Member'>rarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepjointree.c.html#LN2469"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN55"><span class='Ref_to_Member'>relids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN91"><span class='Ref_to_Proto'>bms_add_members</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2469"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN55"><span class='Ref_to_Member'>relids</span></a><span class='Delimiter'>, 
</span>                                         <a href="prepjointree.c.html#LN2504"><span class='Ref_To_Local'>sub_state</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN55"><span class='Ref_to_Member'>relids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepjointree.c.html#LN2469"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN56"><span class='Ref_to_Member'>contains_outer</span></a> <span class='Operator'>|= </span><a href="prepjointree.c.html#LN2504"><span class='Ref_To_Local'>sub_state</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN56"><span class='Ref_to_Member'>contains_outer</span></a><span class='Delimiter'>; 
</span>        <a href="prepjointree.c.html#LN2469"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN57"><span class='Ref_to_Member'>sub_states</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2469"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN57"><span class='Ref_to_Member'>sub_states</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN2504"><span class='Ref_To_Local'>sub_state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IsA(jtnode,JoinExpr) &raquo; </span> 
    <span class='Control'>else</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized node type: %d"</span><span class='Delimiter'>, 
</span>             <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="../../../include/nodes/nodes.h.html#LN513"><span class='Ref_to_Macro'>nodeTag</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2467"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="prepjointree.c.html#LN2469"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end reduce_outer_joins_pass1 &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * reduce_outer_joins_pass2 - phase 2 processing 
 * 
 *  jtnode: current jointree node 
 *  state: state data collected by phase 1 for this node 
 *  root: toplevel planner state 
 *  nonnullable_rels: set of base relids forced non-null by upper quals 
 *  nonnullable_vars: list of Vars forced non-null by upper quals 
 *  forced_null_vars: list of Vars forced null by upper quals 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2539"></a><span class='Declare_Function'>reduce_outer_joins_pass2</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jtnode</span><span class='Delimiter'>, 
</span><a name="LN2540"></a>                         <a href="prepjointree.c.html#LN53"><span class='Ref_to_Struct'>reduce_outer_joins_state</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, 
</span><a name="LN2541"></a>                         <a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN2542"></a>                         <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>nonnullable_rels</span><span class='Delimiter'>, 
</span><a name="LN2543"></a>                         <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>nonnullable_vars</span><span class='Delimiter'>, 
</span><a name="LN2544"></a>                         <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>forced_null_vars</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * pass 2 should never descend as far as an empty subnode or base rel, 
     * because it's only called on subtrees marked as contains_outer. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2539"><span class='Ref_to_Parameter'>jtnode</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"reached empty jointree"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2539"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1415"><span class='Ref_to_Struct'>RangeTblRef</span></a><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"reached base rel"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2539"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1466"><span class='Ref_to_Struct'>FromExpr</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2556"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1466"><span class='Ref_to_Struct'>FromExpr</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>f</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1466"><span class='Ref_to_Struct'>FromExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN2539"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>; 
</span><a name="LN2557"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span><a name="LN2558"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>s</span><span class='Delimiter'>; 
</span><a name="LN2559"></a>        <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a>      <span class='Declare_Local'>pass_nonnullable_rels</span><span class='Delimiter'>; 
</span><a name="LN2560"></a>        <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>pass_nonnullable_vars</span><span class='Delimiter'>; 
</span><a name="LN2561"></a>        <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>pass_forced_null_vars</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Scan quals to see if we can add any constraints */ 
</span>        <a href="prepjointree.c.html#LN2559"><span class='Ref_To_Local'>pass_nonnullable_rels</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/clauses.h.html#LN67"><span class='Ref_to_Proto'>find_nonnullable_rels</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2556"><span class='Ref_To_Local'>f</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1470"><span class='Ref_to_Member'>quals</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepjointree.c.html#LN2559"><span class='Ref_To_Local'>pass_nonnullable_rels</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN91"><span class='Ref_to_Proto'>bms_add_members</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2559"><span class='Ref_To_Local'>pass_nonnullable_rels</span></a><span class='Delimiter'>, 
</span>                                                <a href="prepjointree.c.html#LN2542"><span class='Ref_to_Parameter'>nonnullable_rels</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* NB: we rely on list_concat to not damage its second argument */ 
</span>        <a href="prepjointree.c.html#LN2560"><span class='Ref_To_Local'>pass_nonnullable_vars</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/clauses.h.html#LN68"><span class='Ref_to_Proto'>find_nonnullable_vars</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2556"><span class='Ref_To_Local'>f</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1470"><span class='Ref_to_Member'>quals</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepjointree.c.html#LN2560"><span class='Ref_To_Local'>pass_nonnullable_vars</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2560"><span class='Ref_To_Local'>pass_nonnullable_vars</span></a><span class='Delimiter'>, 
</span>                                            <a href="prepjointree.c.html#LN2543"><span class='Ref_to_Parameter'>nonnullable_vars</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepjointree.c.html#LN2561"><span class='Ref_To_Local'>pass_forced_null_vars</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/clauses.h.html#LN69"><span class='Ref_to_Proto'>find_forced_null_vars</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2556"><span class='Ref_To_Local'>f</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1470"><span class='Ref_to_Member'>quals</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepjointree.c.html#LN2561"><span class='Ref_To_Local'>pass_forced_null_vars</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2561"><span class='Ref_To_Local'>pass_forced_null_vars</span></a><span class='Delimiter'>, 
</span>                                            <a href="prepjointree.c.html#LN2544"><span class='Ref_to_Parameter'>forced_null_vars</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* And recurse --- but only into interesting subtrees */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2556"><span class='Ref_To_Local'>f</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1469"><span class='Ref_to_Member'>fromlist</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2540"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN57"><span class='Ref_to_Member'>sub_states</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../../include/nodes/pg_list.h.html#LN179"><span class='Ref_to_Macro'>forboth</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2557"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN2556"><span class='Ref_To_Local'>f</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1469"><span class='Ref_to_Member'>fromlist</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN2558"><span class='Ref_To_Local'>s</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN2540"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN57"><span class='Ref_to_Member'>sub_states</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2578"></a>            <a href="prepjointree.c.html#LN53"><span class='Ref_to_Struct'>reduce_outer_joins_state</span></a> <span class='Operator'>*</span><span class='Declare_Local'>sub_state</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2558"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2578"><span class='Ref_To_Local'>sub_state</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN56"><span class='Ref_to_Member'>contains_outer</span></a><span class='Parentheses'>) 
</span>                <a href="prepjointree.c.html#LN107"><span class='Ref_to_Proto'>reduce_outer_joins_pass2</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2557"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN2578"><span class='Ref_To_Local'>sub_state</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN2541"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                         <a href="prepjointree.c.html#LN2559"><span class='Ref_To_Local'>pass_nonnullable_rels</span></a><span class='Delimiter'>, 
</span>                                         <a href="prepjointree.c.html#LN2560"><span class='Ref_To_Local'>pass_nonnullable_vars</span></a><span class='Delimiter'>, 
</span>                                         <a href="prepjointree.c.html#LN2561"><span class='Ref_To_Local'>pass_forced_null_vars</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../../include/nodes/bitmapset.h.html#LN68"><span class='Ref_to_Proto'>bms_free</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2559"><span class='Ref_To_Local'>pass_nonnullable_rels</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* can't so easily clean up var lists, unfortunately */ 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IsA(jtnode,FromExpr) &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2539"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2591"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>j</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN2539"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>; 
</span><a name="LN2592"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>rtindex</span> <span class='Operator'>= </span><a href="prepjointree.c.html#LN2591"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1454"><span class='Ref_to_Member'>rtindex</span></a><span class='Delimiter'>; 
</span><a name="LN2593"></a>        <a href="../../../include/nodes/nodes.h.html#LN671"><span class='Ref_to_Enum'>JoinType</span></a>    <span class='Declare_Local'>jointype</span> <span class='Operator'>= </span><a href="prepjointree.c.html#LN2591"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1447"><span class='Ref_to_Member'>jointype</span></a><span class='Delimiter'>; 
</span><a name="LN2594"></a>        <a href="prepjointree.c.html#LN53"><span class='Ref_to_Struct'>reduce_outer_joins_state</span></a> <span class='Operator'>*</span><span class='Declare_Local'>left_state</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2540"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN57"><span class='Ref_to_Member'>sub_states</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2595"></a>        <a href="prepjointree.c.html#LN53"><span class='Ref_to_Struct'>reduce_outer_joins_state</span></a> <span class='Operator'>*</span><span class='Declare_Local'>right_state</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN115"><span class='Ref_to_Macro'>lsecond</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2540"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN57"><span class='Ref_to_Member'>sub_states</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2596"></a>        <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>local_nonnullable_vars</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN2597"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>computed_local_nonnullable_vars</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Can we simplify this join? */ 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2593"><span class='Ref_To_Local'>jointype</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN677"><span class='Ref_to_EnumConst'>JOIN_INNER</span></a><span class='Operator'>: 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN678"><span class='Ref_to_EnumConst'>JOIN_LEFT</span></a><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/bitmapset.h.html#LN76"><span class='Ref_to_Proto'>bms_overlap</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2542"><span class='Ref_to_Parameter'>nonnullable_rels</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN2595"><span class='Ref_To_Local'>right_state</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN55"><span class='Ref_to_Member'>relids</span></a><span class='Parentheses'>))</span> 
                    <a href="prepjointree.c.html#LN2593"><span class='Ref_To_Local'>jointype</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN677"><span class='Ref_to_EnumConst'>JOIN_INNER</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN680"><span class='Ref_to_EnumConst'>JOIN_RIGHT</span></a><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/bitmapset.h.html#LN76"><span class='Ref_to_Proto'>bms_overlap</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2542"><span class='Ref_to_Parameter'>nonnullable_rels</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN2594"><span class='Ref_To_Local'>left_state</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN55"><span class='Ref_to_Member'>relids</span></a><span class='Parentheses'>))</span> 
                    <a href="prepjointree.c.html#LN2593"><span class='Ref_To_Local'>jointype</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN677"><span class='Ref_to_EnumConst'>JOIN_INNER</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN679"><span class='Ref_to_EnumConst'>JOIN_FULL</span></a><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/bitmapset.h.html#LN76"><span class='Ref_to_Proto'>bms_overlap</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2542"><span class='Ref_to_Parameter'>nonnullable_rels</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN2594"><span class='Ref_To_Local'>left_state</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN55"><span class='Ref_to_Member'>relids</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/bitmapset.h.html#LN76"><span class='Ref_to_Proto'>bms_overlap</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2542"><span class='Ref_to_Parameter'>nonnullable_rels</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN2595"><span class='Ref_To_Local'>right_state</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN55"><span class='Ref_to_Member'>relids</span></a><span class='Parentheses'>))</span> 
                        <a href="prepjointree.c.html#LN2593"><span class='Ref_To_Local'>jointype</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN677"><span class='Ref_to_EnumConst'>JOIN_INNER</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> 
                        <a href="prepjointree.c.html#LN2593"><span class='Ref_To_Local'>jointype</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN678"><span class='Ref_to_EnumConst'>JOIN_LEFT</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/bitmapset.h.html#LN76"><span class='Ref_to_Proto'>bms_overlap</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2542"><span class='Ref_to_Parameter'>nonnullable_rels</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN2595"><span class='Ref_To_Local'>right_state</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN55"><span class='Ref_to_Member'>relids</span></a><span class='Parentheses'>))</span> 
                        <a href="prepjointree.c.html#LN2593"><span class='Ref_To_Local'>jointype</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN680"><span class='Ref_to_EnumConst'>JOIN_RIGHT</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN691"><span class='Ref_to_EnumConst'>JOIN_SEMI</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN692"><span class='Ref_to_EnumConst'>JOIN_ANTI</span></a><span class='Operator'>: 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * These could only have been introduced by pull_up_sublinks, 
                 * so there's no way that upper quals could refer to their 
                 * righthand sides, and no point in checking. 
                 */ 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized join type: %d"</span><span class='Delimiter'>, 
</span>                     <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN2593"><span class='Ref_To_Local'>jointype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch jointype &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* 
         * Convert JOIN_RIGHT to JOIN_LEFT.  Note that in the case where we 
         * reduced JOIN_FULL to JOIN_RIGHT, this will mean the JoinExpr no 
         * longer matches the internal ordering of any CoalesceExpr's built to 
         * represent merged join variables.  We don't care about that at 
         * present, but be wary of it ... 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2593"><span class='Ref_To_Local'>jointype</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/nodes.h.html#LN680"><span class='Ref_to_EnumConst'>JOIN_RIGHT</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2650"></a>            <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>tmparg</span><span class='Delimiter'>; 
</span> 
            <a href="prepjointree.c.html#LN2650"><span class='Ref_To_Local'>tmparg</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN2591"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1449"><span class='Ref_to_Member'>larg</span></a><span class='Delimiter'>; 
</span>            <a href="prepjointree.c.html#LN2591"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1449"><span class='Ref_to_Member'>larg</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN2591"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1450"><span class='Ref_to_Member'>rarg</span></a><span class='Delimiter'>; 
</span>            <a href="prepjointree.c.html#LN2591"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1450"><span class='Ref_to_Member'>rarg</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN2650"><span class='Ref_To_Local'>tmparg</span></a><span class='Delimiter'>; 
</span>            <a href="prepjointree.c.html#LN2593"><span class='Ref_To_Local'>jointype</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN678"><span class='Ref_to_EnumConst'>JOIN_LEFT</span></a><span class='Delimiter'>; 
</span>            <a href="prepjointree.c.html#LN2595"><span class='Ref_To_Local'>right_state</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2540"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN57"><span class='Ref_to_Member'>sub_states</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="prepjointree.c.html#LN2594"><span class='Ref_To_Local'>left_state</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN115"><span class='Ref_to_Macro'>lsecond</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2540"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN57"><span class='Ref_to_Member'>sub_states</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * See if we can reduce JOIN_LEFT to JOIN_ANTI.  This is the case if 
         * the join's own quals are strict for any var that was forced null by 
         * higher qual levels.  NOTE: there are other ways that we could 
         * detect an anti-join, in particular if we were to check whether Vars 
         * coming from the RHS must be non-null because of table constraints. 
         * That seems complicated and expensive though (in particular, one 
         * would have to be wary of lower outer joins). For the moment this 
         * seems sufficient. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2593"><span class='Ref_To_Local'>jointype</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/nodes.h.html#LN678"><span class='Ref_to_EnumConst'>JOIN_LEFT</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2672"></a>            <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>overlap</span><span class='Delimiter'>; 
</span> 
            <a href="prepjointree.c.html#LN2596"><span class='Ref_To_Local'>local_nonnullable_vars</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/clauses.h.html#LN68"><span class='Ref_to_Proto'>find_nonnullable_vars</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2591"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1452"><span class='Ref_to_Member'>quals</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="prepjointree.c.html#LN2597"><span class='Ref_To_Local'>computed_local_nonnullable_vars</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * It's not sufficient to check whether local_nonnullable_vars and 
             * forced_null_vars overlap: we need to know if the overlap 
             * includes any RHS variables. 
             */ 
</span>            <a href="prepjointree.c.html#LN2672"><span class='Ref_To_Local'>overlap</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN245"><span class='Ref_to_Proto'>list_intersection</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2596"><span class='Ref_To_Local'>local_nonnullable_vars</span></a><span class='Delimiter'>, 
</span>                                        <a href="prepjointree.c.html#LN2544"><span class='Ref_to_Parameter'>forced_null_vars</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2672"><span class='Ref_To_Local'>overlap</span></a> <span class='Operator'>!= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a> <span class='Operator'>&& 
</span>                <a href="../../../include/nodes/bitmapset.h.html#LN76"><span class='Ref_to_Proto'>bms_overlap</span></a><span class='Parentheses'>(</span><a href="../../../include/optimizer/var.h.html#LN29"><span class='Ref_to_Proto'>pull_varnos</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN2672"><span class='Ref_To_Local'>overlap</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="prepjointree.c.html#LN2595"><span class='Ref_To_Local'>right_state</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN55"><span class='Ref_to_Member'>relids</span></a><span class='Parentheses'>))</span> 
                <a href="prepjointree.c.html#LN2593"><span class='Ref_To_Local'>jointype</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN692"><span class='Ref_to_EnumConst'>JOIN_ANTI</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Apply the jointype change, if any, to both jointree node and RTE */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2592"><span class='Ref_To_Local'>rtindex</span></a> <span class='Operator'>&& </span><a href="prepjointree.c.html#LN2593"><span class='Ref_To_Local'>jointype</span></a> <span class='Operator'>!= </span><a href="prepjointree.c.html#LN2591"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1447"><span class='Ref_to_Member'>jointype</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2693"></a>            <a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rte</span> <span class='Operator'>= </span><a href="../../../include/parser/parsetree.h.html#LN30"><span class='Ref_to_Macro'>rt_fetch</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2592"><span class='Ref_To_Local'>rtindex</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN2541"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN134"><span class='Ref_to_Member'>rtable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2693"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN936"><span class='Ref_to_Member'>rtekind</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/parsenodes.h.html#LN924"><span class='Ref_to_EnumConst'>RTE_JOIN</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2693"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN974"><span class='Ref_to_Member'>jointype</span></a> <span class='Operator'>== </span><a href="prepjointree.c.html#LN2591"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1447"><span class='Ref_to_Member'>jointype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="prepjointree.c.html#LN2693"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN974"><span class='Ref_to_Member'>jointype</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN2593"><span class='Ref_To_Local'>jointype</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="prepjointree.c.html#LN2591"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1447"><span class='Ref_to_Member'>jointype</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN2593"><span class='Ref_To_Local'>jointype</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Only recurse if there's more to do below here */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2594"><span class='Ref_To_Local'>left_state</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN56"><span class='Ref_to_Member'>contains_outer</span></a> <span class='Operator'>|| </span><a href="prepjointree.c.html#LN2595"><span class='Ref_To_Local'>right_state</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN56"><span class='Ref_to_Member'>contains_outer</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2704"></a>            <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a>      <span class='Declare_Local'>local_nonnullable_rels</span><span class='Delimiter'>; 
</span><a name="LN2705"></a>            <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>local_forced_null_vars</span><span class='Delimiter'>; 
</span><a name="LN2706"></a>            <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a>      <span class='Declare_Local'>pass_nonnullable_rels</span><span class='Delimiter'>; 
</span><a name="LN2707"></a>            <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>pass_nonnullable_vars</span><span class='Delimiter'>; 
</span><a name="LN2708"></a>            <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>pass_forced_null_vars</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * If this join is (now) inner, we can add any constraints its 
             * quals provide to those we got from above.  But if it is outer, 
             * we can pass down the local constraints only into the nullable 
             * side, because an outer join never eliminates any rows from its 
             * non-nullable side.  Also, there is no point in passing upper 
             * constraints into the nullable side, since if there were any 
             * we'd have been able to reduce the join.  (In the case of upper 
             * forced-null constraints, we *must not* pass them into the 
             * nullable side --- they either applied here, or not.) The upshot 
             * is that we pass either the local or the upper constraints, 
             * never both, to the children of an outer join. 
             * 
             * Note that a SEMI join works like an inner join here: it's okay 
             * to pass down both local and upper constraints.  (There can't be 
             * any upper constraints affecting its inner side, but it's not 
             * worth having a separate code path to avoid passing them.) 
             * 
             * At a FULL join we just punt and pass nothing down --- is it 
             * possible to be smarter? 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2593"><span class='Ref_To_Local'>jointype</span></a> <span class='Operator'>!= </span><a href="../../../include/nodes/nodes.h.html#LN679"><span class='Ref_to_EnumConst'>JOIN_FULL</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="prepjointree.c.html#LN2704"><span class='Ref_To_Local'>local_nonnullable_rels</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/clauses.h.html#LN67"><span class='Ref_to_Proto'>find_nonnullable_rels</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2591"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1452"><span class='Ref_to_Member'>quals</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="prepjointree.c.html#LN2597"><span class='Ref_To_Local'>computed_local_nonnullable_vars</span></a><span class='Parentheses'>) 
</span>                    <a href="prepjointree.c.html#LN2596"><span class='Ref_To_Local'>local_nonnullable_vars</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/clauses.h.html#LN68"><span class='Ref_to_Proto'>find_nonnullable_vars</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2591"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1452"><span class='Ref_to_Member'>quals</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="prepjointree.c.html#LN2705"><span class='Ref_To_Local'>local_forced_null_vars</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/clauses.h.html#LN69"><span class='Ref_to_Proto'>find_forced_null_vars</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2591"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1452"><span class='Ref_to_Member'>quals</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2593"><span class='Ref_To_Local'>jointype</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/nodes.h.html#LN677"><span class='Ref_to_EnumConst'>JOIN_INNER</span></a> <span class='Operator'>|| </span><a href="prepjointree.c.html#LN2593"><span class='Ref_To_Local'>jointype</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/nodes.h.html#LN691"><span class='Ref_to_EnumConst'>JOIN_SEMI</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* OK to merge upper and local constraints */ 
</span>                    <a href="prepjointree.c.html#LN2704"><span class='Ref_To_Local'>local_nonnullable_rels</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN91"><span class='Ref_to_Proto'>bms_add_members</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2704"><span class='Ref_To_Local'>local_nonnullable_rels</span></a><span class='Delimiter'>, 
</span>                                                           <a href="prepjointree.c.html#LN2542"><span class='Ref_to_Parameter'>nonnullable_rels</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="prepjointree.c.html#LN2596"><span class='Ref_To_Local'>local_nonnullable_vars</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2596"><span class='Ref_To_Local'>local_nonnullable_vars</span></a><span class='Delimiter'>, 
</span>                                                         <a href="prepjointree.c.html#LN2543"><span class='Ref_to_Parameter'>nonnullable_vars</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="prepjointree.c.html#LN2705"><span class='Ref_To_Local'>local_forced_null_vars</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2705"><span class='Ref_To_Local'>local_forced_null_vars</span></a><span class='Delimiter'>, 
</span>                                                         <a href="prepjointree.c.html#LN2544"><span class='Ref_to_Parameter'>forced_null_vars</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* no use in calculating these */ 
</span>                <a href="prepjointree.c.html#LN2704"><span class='Ref_To_Local'>local_nonnullable_rels</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <a href="prepjointree.c.html#LN2705"><span class='Ref_To_Local'>local_forced_null_vars</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2594"><span class='Ref_To_Local'>left_state</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN56"><span class='Ref_to_Member'>contains_outer</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2593"><span class='Ref_To_Local'>jointype</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/nodes.h.html#LN677"><span class='Ref_to_EnumConst'>JOIN_INNER</span></a> <span class='Operator'>|| </span><a href="prepjointree.c.html#LN2593"><span class='Ref_To_Local'>jointype</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/nodes.h.html#LN691"><span class='Ref_to_EnumConst'>JOIN_SEMI</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* pass union of local and upper constraints */ 
</span>                    <a href="prepjointree.c.html#LN2706"><span class='Ref_To_Local'>pass_nonnullable_rels</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN2704"><span class='Ref_To_Local'>local_nonnullable_rels</span></a><span class='Delimiter'>; 
</span>                    <a href="prepjointree.c.html#LN2707"><span class='Ref_To_Local'>pass_nonnullable_vars</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN2596"><span class='Ref_To_Local'>local_nonnullable_vars</span></a><span class='Delimiter'>; 
</span>                    <a href="prepjointree.c.html#LN2708"><span class='Ref_To_Local'>pass_forced_null_vars</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN2705"><span class='Ref_To_Local'>local_forced_null_vars</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2593"><span class='Ref_To_Local'>jointype</span></a> <span class='Operator'>!= </span><a href="../../../include/nodes/nodes.h.html#LN679"><span class='Ref_to_EnumConst'>JOIN_FULL</span></a><span class='Parentheses'>) </span><span class='Comment_Single_Line'>/* ie, LEFT or ANTI */ 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* can't pass local constraints to non-nullable side */ 
</span>                    <a href="prepjointree.c.html#LN2706"><span class='Ref_To_Local'>pass_nonnullable_rels</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN2542"><span class='Ref_to_Parameter'>nonnullable_rels</span></a><span class='Delimiter'>; 
</span>                    <a href="prepjointree.c.html#LN2707"><span class='Ref_To_Local'>pass_nonnullable_vars</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN2543"><span class='Ref_to_Parameter'>nonnullable_vars</span></a><span class='Delimiter'>; 
</span>                    <a href="prepjointree.c.html#LN2708"><span class='Ref_To_Local'>pass_forced_null_vars</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN2544"><span class='Ref_to_Parameter'>forced_null_vars</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* no constraints pass through JOIN_FULL */ 
</span>                    <a href="prepjointree.c.html#LN2706"><span class='Ref_To_Local'>pass_nonnullable_rels</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                    <a href="prepjointree.c.html#LN2707"><span class='Ref_To_Local'>pass_nonnullable_vars</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>                    <a href="prepjointree.c.html#LN2708"><span class='Ref_To_Local'>pass_forced_null_vars</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="prepjointree.c.html#LN107"><span class='Ref_to_Proto'>reduce_outer_joins_pass2</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2591"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1449"><span class='Ref_to_Member'>larg</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN2594"><span class='Ref_To_Local'>left_state</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN2541"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                         <a href="prepjointree.c.html#LN2706"><span class='Ref_To_Local'>pass_nonnullable_rels</span></a><span class='Delimiter'>, 
</span>                                         <a href="prepjointree.c.html#LN2707"><span class='Ref_To_Local'>pass_nonnullable_vars</span></a><span class='Delimiter'>, 
</span>                                         <a href="prepjointree.c.html#LN2708"><span class='Ref_To_Local'>pass_forced_null_vars</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if left_state-&GT;contains_... &raquo; </span> 
 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2595"><span class='Ref_To_Local'>right_state</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN56"><span class='Ref_to_Member'>contains_outer</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2593"><span class='Ref_To_Local'>jointype</span></a> <span class='Operator'>!= </span><a href="../../../include/nodes/nodes.h.html#LN679"><span class='Ref_to_EnumConst'>JOIN_FULL</span></a><span class='Parentheses'>)</span>      <span class='Comment_Single_Line'>/* ie, INNER/LEFT/SEMI/ANTI */ 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* pass appropriate constraints, per comment above */ 
</span>                    <a href="prepjointree.c.html#LN2706"><span class='Ref_To_Local'>pass_nonnullable_rels</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN2704"><span class='Ref_To_Local'>local_nonnullable_rels</span></a><span class='Delimiter'>; 
</span>                    <a href="prepjointree.c.html#LN2707"><span class='Ref_To_Local'>pass_nonnullable_vars</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN2596"><span class='Ref_To_Local'>local_nonnullable_vars</span></a><span class='Delimiter'>; 
</span>                    <a href="prepjointree.c.html#LN2708"><span class='Ref_To_Local'>pass_forced_null_vars</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN2705"><span class='Ref_To_Local'>local_forced_null_vars</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* no constraints pass through JOIN_FULL */ 
</span>                    <a href="prepjointree.c.html#LN2706"><span class='Ref_To_Local'>pass_nonnullable_rels</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                    <a href="prepjointree.c.html#LN2707"><span class='Ref_To_Local'>pass_nonnullable_vars</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>                    <a href="prepjointree.c.html#LN2708"><span class='Ref_To_Local'>pass_forced_null_vars</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="prepjointree.c.html#LN107"><span class='Ref_to_Proto'>reduce_outer_joins_pass2</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2591"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1450"><span class='Ref_to_Member'>rarg</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN2595"><span class='Ref_To_Local'>right_state</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN2541"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                         <a href="prepjointree.c.html#LN2706"><span class='Ref_To_Local'>pass_nonnullable_rels</span></a><span class='Delimiter'>, 
</span>                                         <a href="prepjointree.c.html#LN2707"><span class='Ref_To_Local'>pass_nonnullable_vars</span></a><span class='Delimiter'>, 
</span>                                         <a href="prepjointree.c.html#LN2708"><span class='Ref_To_Local'>pass_forced_null_vars</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if right_state-&GT;contains... &raquo; </span> 
            <a href="../../../include/nodes/bitmapset.h.html#LN68"><span class='Ref_to_Proto'>bms_free</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2704"><span class='Ref_To_Local'>local_nonnullable_rels</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if left_state-&GT;contains_... &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IsA(jtnode,JoinExpr) &raquo; </span> 
    <span class='Control'>else</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized node type: %d"</span><span class='Delimiter'>, 
</span>             <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="../../../include/nodes/nodes.h.html#LN513"><span class='Ref_to_Macro'>nodeTag</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2539"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end reduce_outer_joins_pass2 &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * substitute_multiple_relids - adjust node relid sets after pulling up 
 * a subquery 
 * 
 * Find any PlaceHolderVar nodes in the given tree that reference the 
 * pulled-up relid, and change them to reference the replacement relid(s). 
 * 
 * NOTE: although this has the form of a walker, we cheat and modify the 
 * nodes in-place.  This should be OK since the tree was copied by 
 * pullup_replace_vars earlier.  Avoid scribbling on the original values of 
 * the bitmapsets, though, because expression_tree_mutator doesn't copy those. 
 */ 
</span> 
<span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN2828"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>varno</span><span class='Delimiter'>; 
</span><a name="LN2829"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>sublevels_up</span><span class='Delimiter'>; 
</span><a name="LN2830"></a>    <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a>      <span class='Declare_Member'>subrelids</span><span class='Delimiter'>; 
</span><a name="LN2831"></a>} <span class='Declare_Typedef'>substitute_multiple_relids_context</span><span class='Delimiter'>; 
</span> 
<span class='Keyword'>static bool 
</span><a name="LN2834"></a><span class='Declare_Function'>substitute_multiple_relids_walker</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, 
</span><a name="LN2835"></a>                                  <a href="prepjointree.c.html#LN2826"><span class='Ref_to_Typedef'>substitute_multiple_relids_context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2834"><span class='Ref_to_Parameter'>node</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2834"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN1846"><span class='Ref_to_Struct'>PlaceHolderVar</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2841"></a>        <a href="../../../include/nodes/relation.h.html#LN1846"><span class='Ref_to_Struct'>PlaceHolderVar</span></a> <span class='Operator'>*</span><span class='Declare_Local'>phv</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1846"><span class='Ref_to_Struct'>PlaceHolderVar</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN2834"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2841"><span class='Ref_To_Local'>phv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1852"><span class='Ref_to_Member'>phlevelsup</span></a> <span class='Operator'>== </span><a href="prepjointree.c.html#LN2835"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN2829"><span class='Ref_to_Member'>sublevels_up</span></a> <span class='Operator'>&& 
</span>            <a href="../../../include/nodes/bitmapset.h.html#LN75"><span class='Ref_to_Proto'>bms_is_member</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2835"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN2828"><span class='Ref_to_Member'>varno</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN2841"><span class='Ref_To_Local'>phv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1850"><span class='Ref_to_Member'>phrels</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="prepjointree.c.html#LN2841"><span class='Ref_To_Local'>phv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1850"><span class='Ref_to_Member'>phrels</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN70"><span class='Ref_to_Proto'>bms_union</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2841"><span class='Ref_To_Local'>phv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1850"><span class='Ref_to_Member'>phrels</span></a><span class='Delimiter'>, 
</span>                                    <a href="prepjointree.c.html#LN2835"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN2830"><span class='Ref_to_Member'>subrelids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="prepjointree.c.html#LN2841"><span class='Ref_To_Local'>phv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1850"><span class='Ref_to_Member'>phrels</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN90"><span class='Ref_to_Proto'>bms_del_member</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2841"><span class='Ref_To_Local'>phv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1850"><span class='Ref_to_Member'>phrels</span></a><span class='Delimiter'>, 
</span>                                         <a href="prepjointree.c.html#LN2835"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN2828"><span class='Ref_to_Member'>varno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* fall through to examine children */ 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2834"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Recurse into subselects */ 
</span><a name="LN2856"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
        <a href="prepjointree.c.html#LN2835"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN2829"><span class='Ref_to_Member'>sublevels_up</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="prepjointree.c.html#LN2856"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodeFuncs.h.html#LN57"><span class='Ref_to_Proto'>query_tree_walker</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN2834"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, 
</span>                                   <a href="prepjointree.c.html#LN2833"><span class='Ref_to_Func'>substitute_multiple_relids_walker</span></a><span class='Delimiter'>, 
</span>                                   <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN2835"><span class='Ref_to_Parameter'>context</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepjointree.c.html#LN2835"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="prepjointree.c.html#LN2829"><span class='Ref_to_Member'>sublevels_up</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="prepjointree.c.html#LN2856"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Comment_Multi_Line'>/* Shouldn't need to handle planner auxiliary nodes here */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2834"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN1913"><span class='Ref_to_Struct'>SpecialJoinInfo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2834"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN1964"><span class='Ref_to_Struct'>AppendRelInfo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2834"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN2057"><span class='Ref_to_Struct'>PlaceHolderInfo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2834"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN2074"><span class='Ref_to_Struct'>MinMaxAggInfo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../../include/nodes/nodeFuncs.h.html#LN52"><span class='Ref_to_Proto'>expression_tree_walker</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2834"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN2833"><span class='Ref_to_Func'>substitute_multiple_relids_walker</span></a><span class='Delimiter'>, 
</span>                                  <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN2835"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end substitute_multiple_relids_walker &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN2876"></a><span class='Declare_Function'>substitute_multiple_relids</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>varno</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>subrelids</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2878"></a>    <a href="prepjointree.c.html#LN2826"><span class='Ref_to_Typedef'>substitute_multiple_relids_context</span></a> <span class='Declare_Local'>context</span><span class='Delimiter'>; 
</span> 
    <a href="prepjointree.c.html#LN2878"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="prepjointree.c.html#LN2828"><span class='Ref_to_Member'>varno</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN2876"><span class='Ref_to_Parameter'>varno</span></a><span class='Delimiter'>; 
</span>    <a href="prepjointree.c.html#LN2878"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="prepjointree.c.html#LN2829"><span class='Ref_to_Member'>sublevels_up</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="prepjointree.c.html#LN2878"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="prepjointree.c.html#LN2830"><span class='Ref_to_Member'>subrelids</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN2876"><span class='Ref_to_Parameter'>subrelids</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Must be prepared to start with a Query or a bare expression tree. 
     */ 
</span>    <a href="../../../include/nodes/nodeFuncs.h.html#LN67"><span class='Ref_to_Proto'>query_or_expression_tree_walker</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2876"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, 
</span>                                    <a href="prepjointree.c.html#LN2833"><span class='Ref_to_Func'>substitute_multiple_relids_walker</span></a><span class='Delimiter'>, 
</span>                                    <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="prepjointree.c.html#LN2878"><span class='Ref_To_Local'>context</span></a><span class='Delimiter'>, 
</span>                                    <span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * fix_append_rel_relids: update RT-index fields of AppendRelInfo nodes 
 * 
 * When we pull up a subquery, any AppendRelInfo references to the subquery's 
 * RT index have to be replaced by the substituted relid (and there had better 
 * be only one).  We also need to apply substitute_multiple_relids to their 
 * translated_vars lists, since those might contain PlaceHolderVars. 
 * 
 * We assume we may modify the AppendRelInfo nodes in-place. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2904"></a><span class='Declare_Function'>fix_append_rel_relids</span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>append_rel_list</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>varno</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>subrelids</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2906"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span><a name="LN2907"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>subvarno</span> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We only want to extract the member relid once, but we mustn't fail 
     * immediately if there are multiple members; it could be that none of the 
     * AppendRelInfo nodes refer to it.  So compute it on first use. Note that 
     * bms_singleton_member will complain if set is not singleton. 
     */ 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2906"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN2904"><span class='Ref_to_Parameter'>append_rel_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2917"></a>        <a href="../../../include/nodes/relation.h.html#LN1964"><span class='Ref_to_Struct'>AppendRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>appinfo</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1964"><span class='Ref_to_Struct'>AppendRelInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2906"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* The parent_relid shouldn't ever be a pullup target */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2917"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1974"><span class='Ref_to_Member'>parent_relid</span></a> <span class='Operator'>!= </span><a href="prepjointree.c.html#LN2904"><span class='Ref_to_Parameter'>varno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2917"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1975"><span class='Ref_to_Member'>child_relid</span></a> <span class='Operator'>== </span><a href="prepjointree.c.html#LN2904"><span class='Ref_to_Parameter'>varno</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2907"><span class='Ref_To_Local'>subvarno</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="prepjointree.c.html#LN2907"><span class='Ref_To_Local'>subvarno</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN79"><span class='Ref_to_Proto'>bms_singleton_member</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2904"><span class='Ref_to_Parameter'>subrelids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="prepjointree.c.html#LN2917"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1975"><span class='Ref_to_Member'>child_relid</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN2907"><span class='Ref_To_Local'>subvarno</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Also finish fixups for its translated vars */ 
</span>        <a href="prepjointree.c.html#LN113"><span class='Ref_to_Proto'>substitute_multiple_relids</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN2917"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN2002"><span class='Ref_to_Member'>translated_vars</span></a><span class='Delimiter'>, 
</span>                                   <a href="prepjointree.c.html#LN2904"><span class='Ref_to_Parameter'>varno</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN2904"><span class='Ref_to_Parameter'>subrelids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end fix_append_rel_relids &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * get_relids_in_jointree: get set of RT indexes present in a jointree 
 * 
 * If include_joins is true, join RT indexes are included; if false, 
 * only base rels are included. 
 */ 
</span><a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> 
<a name="LN2942"></a><span class='Declare_Function'>get_relids_in_jointree</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jtnode</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>include_joins</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2944"></a>    <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a>      <span class='Declare_Local'>result</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2942"><span class='Ref_to_Parameter'>jtnode</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="prepjointree.c.html#LN2944"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2942"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1415"><span class='Ref_to_Struct'>RangeTblRef</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2950"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>varno</span> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN1415"><span class='Ref_to_Struct'>RangeTblRef</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN2942"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>rtindex<span class='Delimiter'>; 
</span> 
        <a href="prepjointree.c.html#LN2944"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN67"><span class='Ref_to_Proto'>bms_make_singleton</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2950"><span class='Ref_To_Local'>varno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2942"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1466"><span class='Ref_to_Struct'>FromExpr</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2956"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1466"><span class='Ref_to_Struct'>FromExpr</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>f</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1466"><span class='Ref_to_Struct'>FromExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN2942"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>; 
</span><a name="LN2957"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2957"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN2956"><span class='Ref_To_Local'>f</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1469"><span class='Ref_to_Member'>fromlist</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="prepjointree.c.html#LN2944"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN94"><span class='Ref_to_Proto'>bms_join</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2944"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                              <a href="../../../include/optimizer/prep.h.html#LN28"><span class='Ref_to_Proto'>get_relids_in_jointree</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2957"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                     <a href="prepjointree.c.html#LN2942"><span class='Ref_to_Parameter'>include_joins</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2942"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2968"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>j</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN2942"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>; 
</span> 
        <a href="prepjointree.c.html#LN2944"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/prep.h.html#LN28"><span class='Ref_to_Proto'>get_relids_in_jointree</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2968"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1449"><span class='Ref_to_Member'>larg</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN2942"><span class='Ref_to_Parameter'>include_joins</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepjointree.c.html#LN2944"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN94"><span class='Ref_to_Proto'>bms_join</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2944"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                          <a href="../../../include/optimizer/prep.h.html#LN28"><span class='Ref_to_Proto'>get_relids_in_jointree</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2968"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1450"><span class='Ref_to_Member'>rarg</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN2942"><span class='Ref_to_Parameter'>include_joins</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2942"><span class='Ref_to_Parameter'>include_joins</span></a> <span class='Operator'>&& </span><a href="prepjointree.c.html#LN2968"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1454"><span class='Ref_to_Member'>rtindex</span></a><span class='Parentheses'>) 
</span>            <a href="prepjointree.c.html#LN2944"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN89"><span class='Ref_to_Proto'>bms_add_member</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2944"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN2968"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1454"><span class='Ref_to_Member'>rtindex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized node type: %d"</span><span class='Delimiter'>, 
</span>             <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="../../../include/nodes/nodes.h.html#LN513"><span class='Ref_to_Macro'>nodeTag</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2942"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="prepjointree.c.html#LN2944"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_relids_in_jointree &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * get_relids_for_join: get set of base RT indexes making up a join 
 */ 
</span><a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> 
<a name="LN2986"></a><span class='Declare_Function'>get_relids_for_join</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>joinrelid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2988"></a>    <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>jtnode</span><span class='Delimiter'>; 
</span> 
    <a href="prepjointree.c.html#LN2988"><span class='Ref_To_Local'>jtnode</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN117"><span class='Ref_to_Proto'>find_jointree_node_for_rel</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN2986"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN135"><span class='Ref_to_Member'>jointree</span></a><span class='Delimiter'>, 
</span>                                        <a href="prepjointree.c.html#LN2986"><span class='Ref_to_Parameter'>joinrelid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="prepjointree.c.html#LN2988"><span class='Ref_To_Local'>jtnode</span></a><span class='Parentheses'>) 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not find join node %d"</span><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN2986"><span class='Ref_to_Parameter'>joinrelid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="../../../include/optimizer/prep.h.html#LN28"><span class='Ref_to_Proto'>get_relids_in_jointree</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN2988"><span class='Ref_To_Local'>jtnode</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * find_jointree_node_for_rel: locate jointree node for a base or join RT index 
 * 
 * Returns NULL if not found 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>* 
</span><a name="LN3003"></a><span class='Declare_Function'>find_jointree_node_for_rel</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jtnode</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>relid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN3003"><span class='Ref_to_Parameter'>jtnode</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN3003"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1415"><span class='Ref_to_Struct'>RangeTblRef</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN3009"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>varno</span> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN1415"><span class='Ref_to_Struct'>RangeTblRef</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN3003"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>rtindex<span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN3003"><span class='Ref_to_Parameter'>relid</span></a> <span class='Operator'>== </span><a href="prepjointree.c.html#LN3009"><span class='Ref_To_Local'>varno</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="prepjointree.c.html#LN3003"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN3003"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1466"><span class='Ref_to_Struct'>FromExpr</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN3016"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1466"><span class='Ref_to_Struct'>FromExpr</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>f</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1466"><span class='Ref_to_Struct'>FromExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN3003"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>; 
</span><a name="LN3017"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN3017"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN3016"><span class='Ref_To_Local'>f</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1469"><span class='Ref_to_Member'>fromlist</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="prepjointree.c.html#LN3003"><span class='Ref_to_Parameter'>jtnode</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN117"><span class='Ref_to_Proto'>find_jointree_node_for_rel</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN3017"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN3003"><span class='Ref_to_Parameter'>relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN3003"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <a href="prepjointree.c.html#LN3003"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN3003"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN3028"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>j</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepjointree.c.html#LN3003"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN3003"><span class='Ref_to_Parameter'>relid</span></a> <span class='Operator'>== </span><a href="prepjointree.c.html#LN3028"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1454"><span class='Ref_to_Member'>rtindex</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="prepjointree.c.html#LN3003"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>; 
</span>        <a href="prepjointree.c.html#LN3003"><span class='Ref_to_Parameter'>jtnode</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN117"><span class='Ref_to_Proto'>find_jointree_node_for_rel</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN3028"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1449"><span class='Ref_to_Member'>larg</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN3003"><span class='Ref_to_Parameter'>relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN3003"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="prepjointree.c.html#LN3003"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>; 
</span>        <a href="prepjointree.c.html#LN3003"><span class='Ref_to_Parameter'>jtnode</span></a> <span class='Operator'>= </span><a href="prepjointree.c.html#LN117"><span class='Ref_to_Proto'>find_jointree_node_for_rel</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN3028"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1450"><span class='Ref_to_Member'>rarg</span></a><span class='Delimiter'>, </span><a href="prepjointree.c.html#LN3003"><span class='Ref_to_Parameter'>relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepjointree.c.html#LN3003"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="prepjointree.c.html#LN3003"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized node type: %d"</span><span class='Delimiter'>, 
</span>             <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="../../../include/nodes/nodes.h.html#LN513"><span class='Ref_to_Macro'>nodeTag</span></a><span class='Parentheses'>(</span><a href="prepjointree.c.html#LN3003"><span class='Ref_to_Parameter'>jtnode</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end find_jointree_node_for_rel &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>