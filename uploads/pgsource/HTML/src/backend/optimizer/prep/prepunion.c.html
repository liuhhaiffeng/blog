<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\optimizer\prep\prepunion.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\optimizer\prep\prepunion.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:42 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * prepunion.c 
 *    Routines to plan set-operation queries.  The filename is a leftover 
 *    from a time when only UNIONs were implemented. 
 * 
 * There are two code paths in the planner for set-operation queries. 
 * If a subquery consists entirely of simple UNION ALL operations, it 
 * is converted into an "append relation".  Otherwise, it is handled 
 * by the general code in this module (plan_set_operations and its 
 * subroutines).  There is some support code here for the append-relation 
 * case, but most of the heavy lifting for that is done elsewhere, 
 * notably in prepjointree.c and allpaths.c. 
 * 
 * There is also some code here to support planning of queries that use 
 * inheritance (SELECT FROM foo*).  Inheritance trees are converted into 
 * append relations, and thenceforth share code with the UNION ALL case. 
 * 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/optimizer/prep/prepunion.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;limits.h&GT;</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/heapam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/sysattr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_inherits_fn.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"nodes/makefuncs.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"nodes/nodeFuncs.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/cost.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/pathnode.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/paths.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/planmain.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/planner.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/prep.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/tlist.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parse_coerce.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parsetree.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/rel.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/selfuncs.h"</span> 
 
 
<span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN56"></a>    <a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Member'>root</span><span class='Delimiter'>; 
</span><a name="LN57"></a>    <a href="../../../include/nodes/relation.h.html#LN1964"><span class='Ref_to_Struct'>AppendRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Member'>appinfo</span><span class='Delimiter'>; 
</span><a name="LN58"></a>} <span class='Declare_Typedef'>adjust_appendrel_attrs_context</span><span class='Delimiter'>; 
</span> 
<a name="LN60"></a><span class='Keyword'>static </span><a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>recurse_set_operations</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>setOp</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN61"></a>                       <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>colTypes</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>colCollations</span><span class='Delimiter'>, 
</span><a name="LN62"></a>                       <span class='Keyword'>bool </span><span class='Declare_Parameter'>junkOK</span><span class='Delimiter'>, 
</span><a name="LN63"></a>                       <span class='Keyword'>int </span><span class='Declare_Parameter'>flag</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>refnames_tlist</span><span class='Delimiter'>, 
</span><a name="LN64"></a>                       <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>pTargetList</span><span class='Delimiter'>, 
</span><a name="LN65"></a>                       <span class='Keyword'>double </span><span class='Operator'>*</span><span class='Declare_Parameter'>pNumGroups</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN66"></a><span class='Keyword'>static </span><a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>generate_recursion_path</span><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN1545"><span class='Ref_to_Struct'>SetOperationStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>setOp</span><span class='Delimiter'>, 
</span><a name="LN67"></a>                        <a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN68"></a>                        <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>refnames_tlist</span><span class='Delimiter'>, 
</span><a name="LN69"></a>                        <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>pTargetList</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN70"></a><span class='Keyword'>static </span><a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>generate_union_path</span><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN1545"><span class='Ref_to_Struct'>SetOperationStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>op</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN71"></a>                    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>refnames_tlist</span><span class='Delimiter'>, 
</span><a name="LN72"></a>                    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>pTargetList</span><span class='Delimiter'>, 
</span><a name="LN73"></a>                    <span class='Keyword'>double </span><span class='Operator'>*</span><span class='Declare_Parameter'>pNumGroups</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN74"></a><span class='Keyword'>static </span><a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>generate_nonunion_path</span><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN1545"><span class='Ref_to_Struct'>SetOperationStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>op</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN75"></a>                       <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>refnames_tlist</span><span class='Delimiter'>, 
</span><a name="LN76"></a>                       <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>pTargetList</span><span class='Delimiter'>, 
</span><a name="LN77"></a>                       <span class='Keyword'>double </span><span class='Operator'>*</span><span class='Declare_Parameter'>pNumGroups</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN78"></a><span class='Keyword'>static </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>recurse_union_children</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>setOp</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN79"></a>                       <a href="../../../include/nodes/parsenodes.h.html#LN1545"><span class='Ref_to_Struct'>SetOperationStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>top_union</span><span class='Delimiter'>, 
</span><a name="LN80"></a>                       <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>refnames_tlist</span><span class='Delimiter'>, 
</span><a name="LN81"></a>                       <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>tlist_list</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN82"></a><span class='Keyword'>static </span><a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>make_union_unique</span><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN1545"><span class='Ref_to_Struct'>SetOperationStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>op</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>path</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tlist</span><span class='Delimiter'>, 
</span><a name="LN83"></a>                  <a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN84"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>choose_hashed_setop</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>groupClauses</span><span class='Delimiter'>, 
</span><a name="LN85"></a>                    <a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>input_path</span><span class='Delimiter'>, 
</span><a name="LN86"></a>                    <span class='Keyword'>double </span><span class='Declare_Parameter'>dNumGroups</span><span class='Delimiter'>, </span><span class='Keyword'>double </span><span class='Declare_Parameter'>dNumOutputRows</span><span class='Delimiter'>, 
</span><a name="LN87"></a>                    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>construct</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN88"></a><span class='Keyword'>static </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>generate_setop_tlist</span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>colTypes</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>colCollations</span><span class='Delimiter'>, 
</span><a name="LN89"></a>                     <span class='Keyword'>int </span><span class='Declare_Parameter'>flag</span><span class='Delimiter'>, 
</span><a name="LN90"></a>                     <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>varno</span><span class='Delimiter'>, 
</span><a name="LN91"></a>                     <span class='Keyword'>bool </span><span class='Declare_Parameter'>hack_constants</span><span class='Delimiter'>, 
</span><a name="LN92"></a>                     <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>input_tlist</span><span class='Delimiter'>, 
</span><a name="LN93"></a>                     <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>refnames_tlist</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN94"></a><span class='Keyword'>static </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>generate_append_tlist</span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>colTypes</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>colCollations</span><span class='Delimiter'>, 
</span><a name="LN95"></a>                      <span class='Keyword'>bool </span><span class='Declare_Parameter'>flag</span><span class='Delimiter'>, 
</span><a name="LN96"></a>                      <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>input_tlists</span><span class='Delimiter'>, 
</span><a name="LN97"></a>                      <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>refnames_tlist</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN98"></a><span class='Keyword'>static </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>generate_setop_grouplist</span><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN1545"><span class='Ref_to_Struct'>SetOperationStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>op</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>targetlist</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN99"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>expand_inherited_rtentry</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rte</span><span class='Delimiter'>, 
</span><a name="LN100"></a>                         <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>rti</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN101"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>make_inh_translation_list</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>oldrelation</span><span class='Delimiter'>, 
</span><a name="LN102"></a>                          <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>newrelation</span><span class='Delimiter'>, 
</span><a name="LN103"></a>                          <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>newvarno</span><span class='Delimiter'>, 
</span><a name="LN104"></a>                          <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>translated_vars</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN105"></a><span class='Keyword'>static </span><a href="../../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>translate_col_privs</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>parent_privs</span><span class='Delimiter'>, 
</span><a name="LN106"></a>                    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>translated_vars</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN107"></a><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>adjust_appendrel_attrs_mutator</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, 
</span><a name="LN108"></a>                               <a href="prepunion.c.html#LN54"><span class='Ref_to_Typedef'>adjust_appendrel_attrs_context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN109"></a><span class='Keyword'>static </span><a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Prototype'>adjust_relid_set</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>relids</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>oldrelid</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>newrelid</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN110"></a><span class='Keyword'>static </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>adjust_inherited_tlist</span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tlist</span><span class='Delimiter'>, 
</span><a name="LN111"></a>                       <a href="../../../include/nodes/relation.h.html#LN1964"><span class='Ref_to_Struct'>AppendRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * plan_set_operations 
 * 
 *    Plans the queries for a tree of set operations (UNION/INTERSECT/EXCEPT) 
 * 
 * This routine only deals with the setOperations tree of the given query. 
 * Any top-level ORDER BY requested in root-&GT;parse-&GT;sortClause will be handled 
 * when we return to grouping_planner; likewise for LIMIT. 
 * 
 * What we return is an "upperrel" RelOptInfo containing at least one Path 
 * that implements the set-operation tree.  In addition, root-&GT;processed_tlist 
 * receives a targetlist representing the output of the topmost setop node. 
 */ 
</span><a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>* 
</span><a name="LN128"></a><span class='Declare_Function'>plan_set_operations</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN130"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>parse</span> <span class='Operator'>= </span><a href="prepunion.c.html#LN128"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Delimiter'>; 
</span><a name="LN131"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN1545"><span class='Ref_to_Struct'>SetOperationStmt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>topop</span> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN575"><span class='Ref_to_Macro'>castNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN1545"><span class='Ref_to_Struct'>SetOperationStmt</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN130"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN162"><span class='Ref_to_Member'>setOperations</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN132"></a>    <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>node</span><span class='Delimiter'>; 
</span><a name="LN133"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>leftmostRTE</span><span class='Delimiter'>; 
</span><a name="LN134"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>leftmostQuery</span><span class='Delimiter'>; 
</span><a name="LN135"></a>    <a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>setop_rel</span><span class='Delimiter'>; 
</span><a name="LN136"></a>    <a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>path</span><span class='Delimiter'>; 
</span><a name="LN137"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>top_tlist</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepunion.c.html#LN131"><span class='Ref_To_Local'>topop</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* check for unsupported stuff */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepunion.c.html#LN130"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN135"><span class='Ref_to_Member'>jointree</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1469"><span class='Ref_to_Member'>fromlist</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepunion.c.html#LN130"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN135"><span class='Ref_to_Member'>jointree</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1470"><span class='Ref_to_Member'>quals</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepunion.c.html#LN130"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN145"><span class='Ref_to_Member'>groupClause</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepunion.c.html#LN130"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN149"><span class='Ref_to_Member'>havingQual</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepunion.c.html#LN130"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN151"><span class='Ref_to_Member'>windowClause</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepunion.c.html#LN130"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN153"><span class='Ref_to_Member'>distinctClause</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We'll need to build RelOptInfos for each of the leaf subqueries, which 
     * are RTE_SUBQUERY rangetable entries in this Query.  Prepare the index 
     * arrays for that. 
     */ 
</span>    <a href="../util/relnode.c.html#LN60"><span class='Ref_to_Func'>setup_simple_rel_arrays</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN128"><span class='Ref_to_Parameter'>root</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Find the leftmost component Query.  We need to use its column names for 
     * all generated tlists (else SELECT INTO won't work right). 
     */ 
</span>    <a href="prepunion.c.html#LN132"><span class='Ref_To_Local'>node</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN131"><span class='Ref_To_Local'>topop</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1550"><span class='Ref_to_Member'>larg</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN132"><span class='Ref_To_Local'>node</span></a> <span class='Operator'>&& </span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN132"><span class='Ref_To_Local'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN1545"><span class='Ref_to_Struct'>SetOperationStmt</span></a><span class='Parentheses'>))</span> 
        <a href="prepunion.c.html#LN132"><span class='Ref_To_Local'>node</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../../include/nodes/parsenodes.h.html#LN1545"><span class='Ref_to_Struct'>SetOperationStmt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepunion.c.html#LN132"><span class='Ref_To_Local'>node</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>larg<span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepunion.c.html#LN132"><span class='Ref_To_Local'>node</span></a> <span class='Operator'>&& </span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN132"><span class='Ref_To_Local'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1415"><span class='Ref_to_Struct'>RangeTblRef</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="prepunion.c.html#LN133"><span class='Ref_To_Local'>leftmostRTE</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN128"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN187"><span class='Ref_to_Member'>simple_rte_array</span></a><span class='Delimiter'>[</span><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN1415"><span class='Ref_to_Struct'>RangeTblRef</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepunion.c.html#LN132"><span class='Ref_To_Local'>node</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>rtindex<span class='Delimiter'>]; 
</span>    <a href="prepunion.c.html#LN134"><span class='Ref_To_Local'>leftmostQuery</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN133"><span class='Ref_To_Local'>leftmostRTE</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN954"><span class='Ref_to_Member'>subquery</span></a><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepunion.c.html#LN134"><span class='Ref_To_Local'>leftmostQuery</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We return our results in the (SETOP, NULL) upperrel.  For the moment, 
     * this is also the parent rel of all Paths in the setop tree; we may well 
     * change that in future. 
     */ 
</span>    <a href="prepunion.c.html#LN135"><span class='Ref_To_Local'>setop_rel</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/pathnode.h.html#LN270"><span class='Ref_to_Proto'>fetch_upper_rel</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN128"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN72"><span class='Ref_to_EnumConst'>UPPERREL_SETOP</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We don't currently worry about setting setop_rel's consider_parallel 
     * flag, nor about allowing FDWs to contribute paths to it. 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the topmost node is a recursive union, it needs special processing. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN128"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN304"><span class='Ref_to_Member'>hasRecursion</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="prepunion.c.html#LN136"><span class='Ref_To_Local'>path</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN66"><span class='Ref_to_Proto'>generate_recursion_path</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN131"><span class='Ref_To_Local'>topop</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN128"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                       <a href="prepunion.c.html#LN134"><span class='Ref_To_Local'>leftmostQuery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN137"><span class='Ref_to_Member'>targetList</span></a><span class='Delimiter'>, 
</span>                                       <span class='Operator'>&</span><a href="prepunion.c.html#LN137"><span class='Ref_To_Local'>top_tlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Recurse on setOperations tree to generate paths for set ops. The 
         * final output path should have just the column types shown as the 
         * output from the top-level node, plus possibly resjunk working 
         * columns (we can rely on upper-level nodes to deal with that). 
         */ 
</span>        <a href="prepunion.c.html#LN136"><span class='Ref_To_Local'>path</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN60"><span class='Ref_to_Proto'>recurse_set_operations</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepunion.c.html#LN131"><span class='Ref_To_Local'>topop</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN128"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                      <a href="prepunion.c.html#LN131"><span class='Ref_To_Local'>topop</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1555"><span class='Ref_to_Member'>colTypes</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN131"><span class='Ref_To_Local'>topop</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1557"><span class='Ref_to_Member'>colCollations</span></a><span class='Delimiter'>, 
</span>                                      <span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                      <a href="prepunion.c.html#LN134"><span class='Ref_To_Local'>leftmostQuery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN137"><span class='Ref_to_Member'>targetList</span></a><span class='Delimiter'>, 
</span>                                      <span class='Operator'>&</span><a href="prepunion.c.html#LN137"><span class='Ref_To_Local'>top_tlist</span></a><span class='Delimiter'>, 
</span>                                      <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Must return the built tlist into root-&GT;processed_tlist. */ 
</span>    <a href="prepunion.c.html#LN128"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN280"><span class='Ref_to_Member'>processed_tlist</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN137"><span class='Ref_To_Local'>top_tlist</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Add only the final path to the SETOP upperrel. */ 
</span>    <a href="../../../include/optimizer/pathnode.h.html#LN27"><span class='Ref_to_Proto'>add_path</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN135"><span class='Ref_To_Local'>setop_rel</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN136"><span class='Ref_To_Local'>path</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Let extensions possibly add some more paths */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../plan/planner.c.html#LN68"><span class='Ref_to_Global_Var'>create_upper_paths_hook</span></a><span class='Parentheses'>) 
</span>        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="../plan/planner.c.html#LN68"><span class='Ref_to_Global_Var'>create_upper_paths_hook</span></a><span class='Parentheses'>) (</span><a href="prepunion.c.html#LN128"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN72"><span class='Ref_to_EnumConst'>UPPERREL_SETOP</span></a><span class='Delimiter'>, 
</span>                                    <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="prepunion.c.html#LN135"><span class='Ref_To_Local'>setop_rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Select cheapest path */ 
</span>    <a href="../../../include/optimizer/pathnode.h.html#LN26"><span class='Ref_to_Proto'>set_cheapest</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN135"><span class='Ref_To_Local'>setop_rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="prepunion.c.html#LN135"><span class='Ref_To_Local'>setop_rel</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end plan_set_operations &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * recurse_set_operations 
 *    Recursively handle one step in a tree of set operations 
 * 
 * colTypes: OID list of set-op's result column datatypes 
 * colCollations: OID list of set-op's result column collations 
 * junkOK: if true, child resjunk columns may be left in the result 
 * flag: if &GT;= 0, add a resjunk output column indicating value of flag 
 * refnames_tlist: targetlist to take column names from 
 * 
 * Returns a path for the subtree, as well as these output parameters: 
 * *pTargetList: receives the fully-fledged tlist for the subtree's top plan 
 * *pNumGroups: if not NULL, we estimate the number of distinct groups 
 *      in the result, and store it there 
 * 
 * The pTargetList output parameter is mostly redundant with the pathtarget 
 * of the returned path, but for the moment we need it because much of the 
 * logic in this file depends on flag columns being marked resjunk.  Pending 
 * a redesign of how that works, this is the easy way out. 
 * 
 * We don't have to care about typmods here: the only allowed difference 
 * between set-op input and output typmods is input is a specific typmod 
 * and output is -1, and that does not require a coercion. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>* 
</span><a name="LN247"></a><span class='Declare_Function'>recurse_set_operations</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>setOp</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN248"></a>                       <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>colTypes</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>colCollations</span><span class='Delimiter'>, 
</span><a name="LN249"></a>                       <span class='Keyword'>bool </span><span class='Declare_Parameter'>junkOK</span><span class='Delimiter'>, 
</span><a name="LN250"></a>                       <span class='Keyword'>int </span><span class='Declare_Parameter'>flag</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>refnames_tlist</span><span class='Delimiter'>, 
</span><a name="LN251"></a>                       <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>pTargetList</span><span class='Delimiter'>, 
</span><a name="LN252"></a>                       <span class='Keyword'>double </span><span class='Operator'>*</span><span class='Declare_Parameter'>pNumGroups</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN247"><span class='Ref_to_Parameter'>setOp</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1415"><span class='Ref_to_Struct'>RangeTblRef</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN256"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1415"><span class='Ref_to_Struct'>RangeTblRef</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rtr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1415"><span class='Ref_to_Struct'>RangeTblRef</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepunion.c.html#LN247"><span class='Ref_to_Parameter'>setOp</span></a><span class='Delimiter'>; 
</span><a name="LN257"></a>        <a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rte</span> <span class='Operator'>= </span><a href="prepunion.c.html#LN247"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN187"><span class='Ref_to_Member'>simple_rte_array</span></a><span class='Delimiter'>[</span><a href="prepunion.c.html#LN256"><span class='Ref_To_Local'>rtr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1418"><span class='Ref_to_Member'>rtindex</span></a><span class='Delimiter'>]; 
</span><a name="LN258"></a>        <a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>subquery</span> <span class='Operator'>= </span><a href="prepunion.c.html#LN257"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN954"><span class='Ref_to_Member'>subquery</span></a><span class='Delimiter'>; 
</span><a name="LN259"></a>        <a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN260"></a>        <a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>subroot</span><span class='Delimiter'>; 
</span><a name="LN261"></a>        <a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>final_rel</span><span class='Delimiter'>; 
</span><a name="LN262"></a>        <a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>subpath</span><span class='Delimiter'>; 
</span><a name="LN263"></a>        <a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>path</span><span class='Delimiter'>; 
</span><a name="LN264"></a>        <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>tlist</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepunion.c.html#LN258"><span class='Ref_To_Local'>subquery</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We need to build a RelOptInfo for each leaf subquery.  This isn't 
         * used for much here, but it carries the subroot data structures 
         * forward to setrefs.c processing. 
         */ 
</span>        <a href="prepunion.c.html#LN259"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../util/relnode.c.html#LN89"><span class='Ref_to_Func'>build_simple_rel</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN247"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN256"><span class='Ref_To_Local'>rtr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1418"><span class='Ref_to_Member'>rtindex</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* plan_params should not be in use in current query level */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepunion.c.html#LN247"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN168"><span class='Ref_to_Member'>plan_params</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Generate a subroot and Paths for the subquery */ 
</span>        <a href="prepunion.c.html#LN260"><span class='Ref_To_Local'>subroot</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN259"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN566"><span class='Ref_to_Member'>subroot</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/planner.h.html#LN39"><span class='Ref_to_Proto'>subquery_planner</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN247"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN258"><span class='Ref_To_Local'>subquery</span></a><span class='Delimiter'>, 
</span>                                                  <a href="prepunion.c.html#LN247"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                                  <span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                                  <a href="prepunion.c.html#LN247"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN290"><span class='Ref_to_Member'>tuple_fraction</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * It should not be possible for the primitive query to contain any 
         * cross-references to other primitive queries in the setop tree. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN247"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN168"><span class='Ref_to_Member'>plan_params</span></a><span class='Parentheses'>) 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected outer reference in set operation subquery"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Mark rel with estimated output rows, width, etc.  Note that we have 
         * to do this before generating outer-query paths, else 
         * cost_subqueryscan is not happy. 
         */ 
</span>        <a href="../../../include/optimizer/cost.h.html#LN181"><span class='Ref_to_Proto'>set_subquery_size_estimates</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN247"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN259"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * For the moment, we consider only a single Path for the subquery. 
         * This should change soon (make it look more like 
         * set_subquery_pathlist). 
         */ 
</span>        <a href="prepunion.c.html#LN261"><span class='Ref_To_Local'>final_rel</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/pathnode.h.html#LN270"><span class='Ref_to_Proto'>fetch_upper_rel</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN260"><span class='Ref_To_Local'>subroot</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN77"><span class='Ref_to_EnumConst'>UPPERREL_FINAL</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepunion.c.html#LN262"><span class='Ref_To_Local'>subpath</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/planner.h.html#LN50"><span class='Ref_to_Proto'>get_cheapest_fractional_path</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN261"><span class='Ref_To_Local'>final_rel</span></a><span class='Delimiter'>, 
</span>                                               <a href="prepunion.c.html#LN247"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN290"><span class='Ref_to_Member'>tuple_fraction</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Stick a SubqueryScanPath atop that. 
         * 
         * We don't bother to determine the subquery's output ordering since 
         * it won't be reflected in the set-op result anyhow; so just label 
         * the SubqueryScanPath with nil pathkeys.  (XXX that should change 
         * soon too, likely.) 
         */ 
</span>        <a href="prepunion.c.html#LN263"><span class='Ref_To_Local'>path</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/optimizer/pathnode.h.html#LN89"><span class='Ref_to_Proto'>create_subqueryscan_path</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN247"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN259"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN262"><span class='Ref_To_Local'>subpath</span></a><span class='Delimiter'>, 
</span>                                                 <a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Figure out the appropriate target list, and update the 
         * SubqueryScanPath with the PathTarget form of that. 
         */ 
</span>        <a href="prepunion.c.html#LN264"><span class='Ref_To_Local'>tlist</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN88"><span class='Ref_to_Proto'>generate_setop_tlist</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN248"><span class='Ref_to_Parameter'>colTypes</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN248"><span class='Ref_to_Parameter'>colCollations</span></a><span class='Delimiter'>, 
</span>                                     <a href="prepunion.c.html#LN250"><span class='Ref_to_Parameter'>flag</span></a><span class='Delimiter'>, 
</span>                                     <a href="prepunion.c.html#LN256"><span class='Ref_To_Local'>rtr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1418"><span class='Ref_to_Member'>rtindex</span></a><span class='Delimiter'>, 
</span>                                     <span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                     <a href="prepunion.c.html#LN260"><span class='Ref_To_Local'>subroot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN280"><span class='Ref_to_Member'>processed_tlist</span></a><span class='Delimiter'>, 
</span>                                     <a href="prepunion.c.html#LN250"><span class='Ref_to_Parameter'>refnames_tlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="prepunion.c.html#LN263"><span class='Ref_To_Local'>path</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/pathnode.h.html#LN157"><span class='Ref_to_Proto'>apply_projection_to_path</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN247"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN259"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN263"><span class='Ref_To_Local'>path</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../../include/optimizer/tlist.h.html#LN68"><span class='Ref_to_Macro'>create_pathtarget</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN247"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN264"><span class='Ref_To_Local'>tlist</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Return the fully-fledged tlist to caller, too */ 
</span>        <span class='Operator'>*</span><a href="prepunion.c.html#LN251"><span class='Ref_to_Parameter'>pTargetList</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN264"><span class='Ref_To_Local'>tlist</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Estimate number of groups if caller wants it.  If the subquery used 
         * grouping or aggregation, its output is probably mostly unique 
         * anyway; otherwise do statistical estimation. 
         * 
         * XXX you don't really want to know about this: we do the estimation 
         * using the subquery's original targetlist expressions, not the 
         * subroot-&GT;processed_tlist which might seem more appropriate.  The 
         * reason is that if the subquery is itself a setop, it may return a 
         * processed_tlist containing "varno 0" Vars generated by 
         * generate_append_tlist, and those would confuse estimate_num_groups 
         * mightily.  We ought to get rid of the "varno 0" hack, but that 
         * requires a redesign of the parsetree representation of setops, so 
         * that there can be an RTE corresponding to each setop's output. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN252"><span class='Ref_to_Parameter'>pNumGroups</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN258"><span class='Ref_To_Local'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN145"><span class='Ref_to_Member'>groupClause</span></a> <span class='Operator'>|| </span><a href="prepunion.c.html#LN258"><span class='Ref_To_Local'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN147"><span class='Ref_to_Member'>groupingSets</span></a> <span class='Operator'>|| 
</span>                <a href="prepunion.c.html#LN258"><span class='Ref_To_Local'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN153"><span class='Ref_to_Member'>distinctClause</span></a> <span class='Operator'>|| 
</span>                <a href="prepunion.c.html#LN260"><span class='Ref_To_Local'>subroot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN301"><span class='Ref_to_Member'>hasHavingQual</span></a> <span class='Operator'>|| </span><a href="prepunion.c.html#LN258"><span class='Ref_To_Local'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN122"><span class='Ref_to_Member'>hasAggs</span></a><span class='Parentheses'>) 
</span>                <span class='Operator'>*</span><a href="prepunion.c.html#LN252"><span class='Ref_to_Parameter'>pNumGroups</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN262"><span class='Ref_To_Local'>subpath</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN963"><span class='Ref_to_Member'>rows</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <span class='Operator'>*</span><a href="prepunion.c.html#LN252"><span class='Ref_to_Parameter'>pNumGroups</span></a> <span class='Operator'>= </span><a href="../../../include/utils/selfuncs.h.html#LN205"><span class='Ref_to_Proto'>estimate_num_groups</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN260"><span class='Ref_To_Local'>subroot</span></a><span class='Delimiter'>, 
</span>                                <a href="../../../include/optimizer/tlist.h.html#LN24"><span class='Ref_to_Proto'>get_tlist_exprs</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN258"><span class='Ref_To_Local'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN137"><span class='Ref_to_Member'>targetList</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                  <a href="prepunion.c.html#LN262"><span class='Ref_To_Local'>subpath</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN963"><span class='Ref_to_Member'>rows</span></a><span class='Delimiter'>, 
</span>                                                  <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepunion.c.html#LN263"><span class='Ref_To_Local'>path</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IsA(setOp,RangeTblRef... &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN247"><span class='Ref_to_Parameter'>setOp</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN1545"><span class='Ref_to_Struct'>SetOperationStmt</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN367"></a>        <a href="../../../include/nodes/parsenodes.h.html#LN1545"><span class='Ref_to_Struct'>SetOperationStmt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>op</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN1545"><span class='Ref_to_Struct'>SetOperationStmt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepunion.c.html#LN247"><span class='Ref_to_Parameter'>setOp</span></a><span class='Delimiter'>; 
</span><a name="LN368"></a>        <a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>path</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* UNIONs are much different from INTERSECT/EXCEPT */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN367"><span class='Ref_To_Local'>op</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1548"><span class='Ref_to_Member'>op</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/parsenodes.h.html#LN1473"><span class='Ref_to_EnumConst'>SETOP_UNION</span></a><span class='Parentheses'>) 
</span>            <a href="prepunion.c.html#LN368"><span class='Ref_To_Local'>path</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN70"><span class='Ref_to_Proto'>generate_union_path</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN367"><span class='Ref_To_Local'>op</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN247"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                       <a href="prepunion.c.html#LN250"><span class='Ref_to_Parameter'>refnames_tlist</span></a><span class='Delimiter'>, 
</span>                                       <a href="prepunion.c.html#LN251"><span class='Ref_to_Parameter'>pTargetList</span></a><span class='Delimiter'>, 
</span>                                       <a href="prepunion.c.html#LN252"><span class='Ref_to_Parameter'>pNumGroups</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="prepunion.c.html#LN368"><span class='Ref_To_Local'>path</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN74"><span class='Ref_to_Proto'>generate_nonunion_path</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN367"><span class='Ref_To_Local'>op</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN247"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                          <a href="prepunion.c.html#LN250"><span class='Ref_to_Parameter'>refnames_tlist</span></a><span class='Delimiter'>, 
</span>                                          <a href="prepunion.c.html#LN251"><span class='Ref_to_Parameter'>pTargetList</span></a><span class='Delimiter'>, 
</span>                                          <a href="prepunion.c.html#LN252"><span class='Ref_to_Parameter'>pNumGroups</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If necessary, add a Result node to project the caller-requested 
         * output columns. 
         * 
         * XXX you don't really want to know about this: setrefs.c will apply 
         * fix_upper_expr() to the Result node's tlist. This would fail if the 
         * Vars generated by generate_setop_tlist() were not exactly equal() 
         * to the corresponding tlist entries of the subplan. However, since 
         * the subplan was generated by generate_union_plan() or 
         * generate_nonunion_plan(), and hence its tlist was generated by 
         * generate_append_tlist(), this will work.  We just tell 
         * generate_setop_tlist() to use varno 0. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN250"><span class='Ref_to_Parameter'>flag</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            <span class='Operator'>!</span><a href="../../../include/optimizer/tlist.h.html#LN30"><span class='Ref_to_Proto'>tlist_same_datatypes</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="prepunion.c.html#LN251"><span class='Ref_to_Parameter'>pTargetList</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN248"><span class='Ref_to_Parameter'>colTypes</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN249"><span class='Ref_to_Parameter'>junkOK</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>            <span class='Operator'>!</span><a href="../../../include/optimizer/tlist.h.html#LN31"><span class='Ref_to_Proto'>tlist_same_collations</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="prepunion.c.html#LN251"><span class='Ref_to_Parameter'>pTargetList</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN248"><span class='Ref_to_Parameter'>colCollations</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN249"><span class='Ref_to_Parameter'>junkOK</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Operator'>*</span><a href="prepunion.c.html#LN251"><span class='Ref_to_Parameter'>pTargetList</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN88"><span class='Ref_to_Proto'>generate_setop_tlist</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN248"><span class='Ref_to_Parameter'>colTypes</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN248"><span class='Ref_to_Parameter'>colCollations</span></a><span class='Delimiter'>, 
</span>                                                <a href="prepunion.c.html#LN250"><span class='Ref_to_Parameter'>flag</span></a><span class='Delimiter'>, 
</span>                                                <span class='Number'>0</span><span class='Delimiter'>, 
</span>                                                <span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                                <span class='Operator'>*</span><a href="prepunion.c.html#LN251"><span class='Ref_to_Parameter'>pTargetList</span></a><span class='Delimiter'>, 
</span>                                                <a href="prepunion.c.html#LN250"><span class='Ref_to_Parameter'>refnames_tlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="prepunion.c.html#LN368"><span class='Ref_To_Local'>path</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/pathnode.h.html#LN157"><span class='Ref_to_Proto'>apply_projection_to_path</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN247"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                            <a href="prepunion.c.html#LN368"><span class='Ref_To_Local'>path</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN952"><span class='Ref_to_Member'>parent</span></a><span class='Delimiter'>, 
</span>                                            <a href="prepunion.c.html#LN368"><span class='Ref_To_Local'>path</span></a><span class='Delimiter'>, 
</span>                                            <a href="../../../include/optimizer/tlist.h.html#LN68"><span class='Ref_to_Macro'>create_pathtarget</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN247"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                                              <span class='Operator'>*</span><a href="prepunion.c.html#LN251"><span class='Ref_to_Parameter'>pTargetList</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>return</span> <a href="prepunion.c.html#LN368"><span class='Ref_To_Local'>path</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IsA(setOp,SetOperatio... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized node type: %d"</span><span class='Delimiter'>, 
</span>             <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="../../../include/nodes/nodes.h.html#LN513"><span class='Ref_to_Macro'>nodeTag</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN247"><span class='Ref_to_Parameter'>setOp</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="prepunion.c.html#LN251"><span class='Ref_to_Parameter'>pTargetList</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end recurse_set_operations &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Generate path for a recursive UNION node 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>* 
</span><a name="LN426"></a><span class='Declare_Function'>generate_recursion_path</span><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN1545"><span class='Ref_to_Struct'>SetOperationStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>setOp</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN427"></a>                        <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>refnames_tlist</span><span class='Delimiter'>, 
</span><a name="LN428"></a>                        <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>pTargetList</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN430"></a>    <a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>result_rel</span> <span class='Operator'>= </span><a href="../../../include/optimizer/pathnode.h.html#LN270"><span class='Ref_to_Proto'>fetch_upper_rel</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN426"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN72"><span class='Ref_to_EnumConst'>UPPERREL_SETOP</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN431"></a>    <a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>path</span><span class='Delimiter'>; 
</span><a name="LN432"></a>    <a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>lpath</span><span class='Delimiter'>; 
</span><a name="LN433"></a>    <a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>rpath</span><span class='Delimiter'>; 
</span><a name="LN434"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>lpath_tlist</span><span class='Delimiter'>; 
</span><a name="LN435"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>rpath_tlist</span><span class='Delimiter'>; 
</span><a name="LN436"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>tlist</span><span class='Delimiter'>; 
</span><a name="LN437"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>groupList</span><span class='Delimiter'>; 
</span><a name="LN438"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>dNumGroups</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Parser should have rejected other cases */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN426"><span class='Ref_to_Parameter'>setOp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1548"><span class='Ref_to_Member'>op</span></a> <span class='Operator'>!= </span><a href="../../../include/nodes/parsenodes.h.html#LN1473"><span class='Ref_to_EnumConst'>SETOP_UNION</span></a><span class='Parentheses'>) 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"only UNION queries can be recursive"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Worktable ID should be assigned */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepunion.c.html#LN426"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN307"><span class='Ref_to_Member'>wt_param_id</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Unlike a regular UNION node, process the left and right inputs 
     * separately without any intention of combining them into one Append. 
     */ 
</span>    <a href="prepunion.c.html#LN432"><span class='Ref_To_Local'>lpath</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN60"><span class='Ref_to_Proto'>recurse_set_operations</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN426"><span class='Ref_to_Parameter'>setOp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1550"><span class='Ref_to_Member'>larg</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN426"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                   <a href="prepunion.c.html#LN426"><span class='Ref_to_Parameter'>setOp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1555"><span class='Ref_to_Member'>colTypes</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN426"><span class='Ref_to_Parameter'>setOp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1557"><span class='Ref_to_Member'>colCollations</span></a><span class='Delimiter'>, 
</span>                                   <span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                   <a href="prepunion.c.html#LN427"><span class='Ref_to_Parameter'>refnames_tlist</span></a><span class='Delimiter'>, 
</span>                                   <span class='Operator'>&</span><a href="prepunion.c.html#LN434"><span class='Ref_To_Local'>lpath_tlist</span></a><span class='Delimiter'>, 
</span>                                   <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* The right path will want to look at the left one ... */ 
</span>    <a href="prepunion.c.html#LN426"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN308"><span class='Ref_to_Member'>non_recursive_path</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN432"><span class='Ref_To_Local'>lpath</span></a><span class='Delimiter'>; 
</span>    <a href="prepunion.c.html#LN433"><span class='Ref_To_Local'>rpath</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN60"><span class='Ref_to_Proto'>recurse_set_operations</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN426"><span class='Ref_to_Parameter'>setOp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1551"><span class='Ref_to_Member'>rarg</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN426"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                   <a href="prepunion.c.html#LN426"><span class='Ref_to_Parameter'>setOp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1555"><span class='Ref_to_Member'>colTypes</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN426"><span class='Ref_to_Parameter'>setOp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1557"><span class='Ref_to_Member'>colCollations</span></a><span class='Delimiter'>, 
</span>                                   <span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                   <a href="prepunion.c.html#LN427"><span class='Ref_to_Parameter'>refnames_tlist</span></a><span class='Delimiter'>, 
</span>                                   <span class='Operator'>&</span><a href="prepunion.c.html#LN435"><span class='Ref_To_Local'>rpath_tlist</span></a><span class='Delimiter'>, 
</span>                                   <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="prepunion.c.html#LN426"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN308"><span class='Ref_to_Member'>non_recursive_path</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Generate tlist for RecursiveUnion path node --- same as in Append cases 
     */ 
</span>    <a href="prepunion.c.html#LN436"><span class='Ref_To_Local'>tlist</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN94"><span class='Ref_to_Proto'>generate_append_tlist</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN426"><span class='Ref_to_Parameter'>setOp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1555"><span class='Ref_to_Member'>colTypes</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN426"><span class='Ref_to_Parameter'>setOp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1557"><span class='Ref_to_Member'>colCollations</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                  <a href="../../../include/nodes/pg_list.h.html#LN139"><span class='Ref_to_Macro'>list_make2</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN434"><span class='Ref_To_Local'>lpath_tlist</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN435"><span class='Ref_To_Local'>rpath_tlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                  <a href="prepunion.c.html#LN427"><span class='Ref_to_Parameter'>refnames_tlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="prepunion.c.html#LN428"><span class='Ref_to_Parameter'>pTargetList</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN436"><span class='Ref_To_Local'>tlist</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If UNION, identify the grouping operators 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN426"><span class='Ref_to_Parameter'>setOp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1549"><span class='Ref_to_Member'>all</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="prepunion.c.html#LN437"><span class='Ref_To_Local'>groupList</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>        <a href="prepunion.c.html#LN438"><span class='Ref_To_Local'>dNumGroups</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Identify the grouping semantics */ 
</span>        <a href="prepunion.c.html#LN437"><span class='Ref_To_Local'>groupList</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN98"><span class='Ref_to_Proto'>generate_setop_grouplist</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN426"><span class='Ref_to_Parameter'>setOp</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN436"><span class='Ref_To_Local'>tlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* We only support hashing here */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/optimizer/tlist.h.html#LN52"><span class='Ref_to_Proto'>grouping_is_hashable</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN437"><span class='Ref_To_Local'>groupList</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not implement recursive UNION"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"All column datatypes must be hashable."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * For the moment, take the number of distinct groups as equal to the 
         * total input size, ie, the worst case. 
         */ 
</span>        <a href="prepunion.c.html#LN438"><span class='Ref_To_Local'>dNumGroups</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN432"><span class='Ref_To_Local'>lpath</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN963"><span class='Ref_to_Member'>rows</span></a> <span class='Operator'>+ </span><a href="prepunion.c.html#LN433"><span class='Ref_To_Local'>rpath</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN963"><span class='Ref_to_Member'>rows</span></a> <span class='Operator'>* </span><span class='Number'>10</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * And make the path node. 
     */ 
</span>    <a href="prepunion.c.html#LN431"><span class='Ref_To_Local'>path</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/optimizer/pathnode.h.html#LN223"><span class='Ref_to_Proto'>create_recursiveunion_path</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN426"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                               <a href="prepunion.c.html#LN430"><span class='Ref_To_Local'>result_rel</span></a><span class='Delimiter'>, 
</span>                                               <a href="prepunion.c.html#LN432"><span class='Ref_To_Local'>lpath</span></a><span class='Delimiter'>, 
</span>                                               <a href="prepunion.c.html#LN433"><span class='Ref_To_Local'>rpath</span></a><span class='Delimiter'>, 
</span>                                               <a href="../../../include/optimizer/tlist.h.html#LN68"><span class='Ref_to_Macro'>create_pathtarget</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN426"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN436"><span class='Ref_To_Local'>tlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                               <a href="prepunion.c.html#LN437"><span class='Ref_To_Local'>groupList</span></a><span class='Delimiter'>, 
</span>                                               <a href="prepunion.c.html#LN426"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN307"><span class='Ref_to_Member'>wt_param_id</span></a><span class='Delimiter'>, 
</span>                                               <a href="prepunion.c.html#LN438"><span class='Ref_To_Local'>dNumGroups</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="prepunion.c.html#LN431"><span class='Ref_To_Local'>path</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end generate_recursion_path &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Generate path for a UNION or UNION ALL node 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>* 
</span><a name="LN521"></a><span class='Declare_Function'>generate_union_path</span><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN1545"><span class='Ref_to_Struct'>SetOperationStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>op</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN522"></a>                    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>refnames_tlist</span><span class='Delimiter'>, 
</span><a name="LN523"></a>                    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>pTargetList</span><span class='Delimiter'>, 
</span><a name="LN524"></a>                    <span class='Keyword'>double </span><span class='Operator'>*</span><span class='Declare_Parameter'>pNumGroups</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN526"></a>    <a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>result_rel</span> <span class='Operator'>= </span><a href="../../../include/optimizer/pathnode.h.html#LN270"><span class='Ref_to_Proto'>fetch_upper_rel</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN521"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN72"><span class='Ref_to_EnumConst'>UPPERREL_SETOP</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN527"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>save_fraction</span> <span class='Operator'>= </span><a href="prepunion.c.html#LN521"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN290"><span class='Ref_to_Member'>tuple_fraction</span></a><span class='Delimiter'>; 
</span><a name="LN528"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>pathlist</span><span class='Delimiter'>; 
</span><a name="LN529"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>child_tlists1</span><span class='Delimiter'>; 
</span><a name="LN530"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>child_tlists2</span><span class='Delimiter'>; 
</span><a name="LN531"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>tlist_list</span><span class='Delimiter'>; 
</span><a name="LN532"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>tlist</span><span class='Delimiter'>; 
</span><a name="LN533"></a>    <a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>path</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If plain UNION, tell children to fetch all tuples. 
     * 
     * Note: in UNION ALL, we pass the top-level tuple_fraction unmodified to 
     * each arm of the UNION ALL.  One could make a case for reducing the 
     * tuple fraction for later arms (discounting by the expected size of the 
     * earlier arms' results) but it seems not worth the trouble. The normal 
     * case where tuple_fraction isn't already zero is a LIMIT at top level, 
     * and passing it down as-is is usually enough to get the desired result 
     * of preferring fast-start plans. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="prepunion.c.html#LN521"><span class='Ref_to_Parameter'>op</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1549"><span class='Ref_to_Member'>all</span></a><span class='Parentheses'>) 
</span>        <a href="prepunion.c.html#LN521"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN290"><span class='Ref_to_Member'>tuple_fraction</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If any of my children are identical UNION nodes (same op, all-flag, and 
     * colTypes) then they can be merged into this node so that we generate 
     * only one Append and unique-ification for the lot.  Recurse to find such 
     * nodes and compute their children's paths. 
     */ 
</span>    <a href="prepunion.c.html#LN528"><span class='Ref_To_Local'>pathlist</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN78"><span class='Ref_to_Proto'>recurse_union_children</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN521"><span class='Ref_to_Parameter'>op</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1550"><span class='Ref_to_Member'>larg</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN521"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                                  <a href="prepunion.c.html#LN521"><span class='Ref_to_Parameter'>op</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN522"><span class='Ref_to_Parameter'>refnames_tlist</span></a><span class='Delimiter'>, 
</span>                                                  <span class='Operator'>&</span><a href="prepunion.c.html#LN529"><span class='Ref_To_Local'>child_tlists1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="prepunion.c.html#LN78"><span class='Ref_to_Proto'>recurse_union_children</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN521"><span class='Ref_to_Parameter'>op</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1551"><span class='Ref_to_Member'>rarg</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN521"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                                  <a href="prepunion.c.html#LN521"><span class='Ref_to_Parameter'>op</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN522"><span class='Ref_to_Parameter'>refnames_tlist</span></a><span class='Delimiter'>, 
</span>                                                  <span class='Operator'>&</span><a href="prepunion.c.html#LN530"><span class='Ref_To_Local'>child_tlists2</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="prepunion.c.html#LN531"><span class='Ref_To_Local'>tlist_list</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN529"><span class='Ref_To_Local'>child_tlists1</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN530"><span class='Ref_To_Local'>child_tlists2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Generate tlist for Append plan node. 
     * 
     * The tlist for an Append plan isn't important as far as the Append is 
     * concerned, but we must make it look real anyway for the benefit of the 
     * next plan level up. 
     */ 
</span>    <a href="prepunion.c.html#LN532"><span class='Ref_To_Local'>tlist</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN94"><span class='Ref_to_Proto'>generate_append_tlist</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN521"><span class='Ref_to_Parameter'>op</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1555"><span class='Ref_to_Member'>colTypes</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN521"><span class='Ref_to_Parameter'>op</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1557"><span class='Ref_to_Member'>colCollations</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                  <a href="prepunion.c.html#LN531"><span class='Ref_To_Local'>tlist_list</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN522"><span class='Ref_to_Parameter'>refnames_tlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="prepunion.c.html#LN523"><span class='Ref_to_Parameter'>pTargetList</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN532"><span class='Ref_To_Local'>tlist</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Append the child results together. 
     */ 
</span>    <a href="prepunion.c.html#LN533"><span class='Ref_To_Local'>path</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/optimizer/pathnode.h.html#LN65"><span class='Ref_to_Proto'>create_append_path</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN526"><span class='Ref_To_Local'>result_rel</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN528"><span class='Ref_To_Local'>pathlist</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* We have to manually jam the right tlist into the path; ick */ 
</span>    <a href="prepunion.c.html#LN533"><span class='Ref_To_Local'>path</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN953"><span class='Ref_to_Member'>pathtarget</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/tlist.h.html#LN68"><span class='Ref_to_Macro'>create_pathtarget</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN521"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN532"><span class='Ref_To_Local'>tlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * For UNION ALL, we just need the Append path.  For UNION, need to add 
     * node(s) to remove duplicates. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="prepunion.c.html#LN521"><span class='Ref_to_Parameter'>op</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1549"><span class='Ref_to_Member'>all</span></a><span class='Parentheses'>) 
</span>        <a href="prepunion.c.html#LN533"><span class='Ref_To_Local'>path</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN82"><span class='Ref_to_Proto'>make_union_unique</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN521"><span class='Ref_to_Parameter'>op</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN533"><span class='Ref_To_Local'>path</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN532"><span class='Ref_To_Local'>tlist</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN521"><span class='Ref_to_Parameter'>root</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Estimate number of groups if caller wants it.  For now we just assume 
     * the output is unique --- this is certainly true for the UNION case, and 
     * we want worst-case estimates anyway. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN524"><span class='Ref_to_Parameter'>pNumGroups</span></a><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="prepunion.c.html#LN524"><span class='Ref_to_Parameter'>pNumGroups</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN533"><span class='Ref_To_Local'>path</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN963"><span class='Ref_to_Member'>rows</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Undo effects of possibly forcing tuple_fraction to 0 */ 
</span>    <a href="prepunion.c.html#LN521"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN290"><span class='Ref_to_Member'>tuple_fraction</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN527"><span class='Ref_To_Local'>save_fraction</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="prepunion.c.html#LN533"><span class='Ref_To_Local'>path</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end generate_union_path &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Generate path for an INTERSECT, INTERSECT ALL, EXCEPT, or EXCEPT ALL node 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>* 
</span><a name="LN608"></a><span class='Declare_Function'>generate_nonunion_path</span><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN1545"><span class='Ref_to_Struct'>SetOperationStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>op</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN609"></a>                       <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>refnames_tlist</span><span class='Delimiter'>, 
</span><a name="LN610"></a>                       <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>pTargetList</span><span class='Delimiter'>, 
</span><a name="LN611"></a>                       <span class='Keyword'>double </span><span class='Operator'>*</span><span class='Declare_Parameter'>pNumGroups</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN613"></a>    <a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>result_rel</span> <span class='Operator'>= </span><a href="../../../include/optimizer/pathnode.h.html#LN270"><span class='Ref_to_Proto'>fetch_upper_rel</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN608"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN72"><span class='Ref_to_EnumConst'>UPPERREL_SETOP</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN614"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>save_fraction</span> <span class='Operator'>= </span><a href="prepunion.c.html#LN608"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN290"><span class='Ref_to_Member'>tuple_fraction</span></a><span class='Delimiter'>; 
</span><a name="LN615"></a>    <a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>lpath</span><span class='Delimiter'>, 
</span><a name="LN616"></a>               <span class='Operator'>*</span><span class='Declare_Local'>rpath</span><span class='Delimiter'>, 
</span><a name="LN617"></a>               <span class='Operator'>*</span><span class='Declare_Local'>path</span><span class='Delimiter'>; 
</span><a name="LN618"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>lpath_tlist</span><span class='Delimiter'>, 
</span><a name="LN619"></a>               <span class='Operator'>*</span><span class='Declare_Local'>rpath_tlist</span><span class='Delimiter'>, 
</span><a name="LN620"></a>               <span class='Operator'>*</span><span class='Declare_Local'>tlist_list</span><span class='Delimiter'>, 
</span><a name="LN621"></a>               <span class='Operator'>*</span><span class='Declare_Local'>tlist</span><span class='Delimiter'>, 
</span><a name="LN622"></a>               <span class='Operator'>*</span><span class='Declare_Local'>groupList</span><span class='Delimiter'>, 
</span><a name="LN623"></a>               <span class='Operator'>*</span><span class='Declare_Local'>pathlist</span><span class='Delimiter'>; 
</span><a name="LN624"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>dLeftGroups</span><span class='Delimiter'>, 
</span><a name="LN625"></a>                <span class='Declare_Local'>dRightGroups</span><span class='Delimiter'>, 
</span><a name="LN626"></a>                <span class='Declare_Local'>dNumGroups</span><span class='Delimiter'>, 
</span><a name="LN627"></a>                <span class='Declare_Local'>dNumOutputRows</span><span class='Delimiter'>; 
</span><a name="LN628"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>use_hash</span><span class='Delimiter'>; 
</span><a name="LN629"></a>    <a href="../../../include/nodes/nodes.h.html#LN777"><span class='Ref_to_Enum'>SetOpCmd</span></a>    <span class='Declare_Local'>cmd</span><span class='Delimiter'>; 
</span><a name="LN630"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>firstFlag</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Tell children to fetch all tuples. 
     */ 
</span>    <a href="prepunion.c.html#LN608"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN290"><span class='Ref_to_Member'>tuple_fraction</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Recurse on children, ensuring their outputs are marked */ 
</span>    <a href="prepunion.c.html#LN615"><span class='Ref_To_Local'>lpath</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN60"><span class='Ref_to_Proto'>recurse_set_operations</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN608"><span class='Ref_to_Parameter'>op</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1550"><span class='Ref_to_Member'>larg</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN608"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                   <a href="prepunion.c.html#LN608"><span class='Ref_to_Parameter'>op</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1555"><span class='Ref_to_Member'>colTypes</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN608"><span class='Ref_to_Parameter'>op</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1557"><span class='Ref_to_Member'>colCollations</span></a><span class='Delimiter'>, 
</span>                                   <span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                   <a href="prepunion.c.html#LN609"><span class='Ref_to_Parameter'>refnames_tlist</span></a><span class='Delimiter'>, 
</span>                                   <span class='Operator'>&</span><a href="prepunion.c.html#LN618"><span class='Ref_To_Local'>lpath_tlist</span></a><span class='Delimiter'>, 
</span>                                   <span class='Operator'>&</span><a href="prepunion.c.html#LN624"><span class='Ref_To_Local'>dLeftGroups</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="prepunion.c.html#LN616"><span class='Ref_To_Local'>rpath</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN60"><span class='Ref_to_Proto'>recurse_set_operations</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN608"><span class='Ref_to_Parameter'>op</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1551"><span class='Ref_to_Member'>rarg</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN608"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                   <a href="prepunion.c.html#LN608"><span class='Ref_to_Parameter'>op</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1555"><span class='Ref_to_Member'>colTypes</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN608"><span class='Ref_to_Parameter'>op</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1557"><span class='Ref_to_Member'>colCollations</span></a><span class='Delimiter'>, 
</span>                                   <span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                   <a href="prepunion.c.html#LN609"><span class='Ref_to_Parameter'>refnames_tlist</span></a><span class='Delimiter'>, 
</span>                                   <span class='Operator'>&</span><a href="prepunion.c.html#LN619"><span class='Ref_To_Local'>rpath_tlist</span></a><span class='Delimiter'>, 
</span>                                   <span class='Operator'>&</span><a href="prepunion.c.html#LN625"><span class='Ref_To_Local'>dRightGroups</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Undo effects of forcing tuple_fraction to 0 */ 
</span>    <a href="prepunion.c.html#LN608"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN290"><span class='Ref_to_Member'>tuple_fraction</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN614"><span class='Ref_To_Local'>save_fraction</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * For EXCEPT, we must put the left input first.  For INTERSECT, either 
     * order should give the same results, and we prefer to put the smaller 
     * input first in order to minimize the size of the hash table in the 
     * hashing case.  "Smaller" means the one with the fewer groups. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN608"><span class='Ref_to_Parameter'>op</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1548"><span class='Ref_to_Member'>op</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/parsenodes.h.html#LN1475"><span class='Ref_to_EnumConst'>SETOP_EXCEPT</span></a> <span class='Operator'>|| </span><a href="prepunion.c.html#LN624"><span class='Ref_To_Local'>dLeftGroups</span></a> <span class='Operator'>&LT;= </span><a href="prepunion.c.html#LN625"><span class='Ref_To_Local'>dRightGroups</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="prepunion.c.html#LN623"><span class='Ref_To_Local'>pathlist</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN139"><span class='Ref_to_Macro'>list_make2</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN615"><span class='Ref_To_Local'>lpath</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN616"><span class='Ref_To_Local'>rpath</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepunion.c.html#LN620"><span class='Ref_To_Local'>tlist_list</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN139"><span class='Ref_to_Macro'>list_make2</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN618"><span class='Ref_To_Local'>lpath_tlist</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN619"><span class='Ref_To_Local'>rpath_tlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepunion.c.html#LN630"><span class='Ref_To_Local'>firstFlag</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="prepunion.c.html#LN623"><span class='Ref_To_Local'>pathlist</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN139"><span class='Ref_to_Macro'>list_make2</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN616"><span class='Ref_To_Local'>rpath</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN615"><span class='Ref_To_Local'>lpath</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepunion.c.html#LN620"><span class='Ref_To_Local'>tlist_list</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN139"><span class='Ref_to_Macro'>list_make2</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN619"><span class='Ref_To_Local'>rpath_tlist</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN618"><span class='Ref_To_Local'>lpath_tlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepunion.c.html#LN630"><span class='Ref_To_Local'>firstFlag</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Generate tlist for Append plan node. 
     * 
     * The tlist for an Append plan isn't important as far as the Append is 
     * concerned, but we must make it look real anyway for the benefit of the 
     * next plan level up.  In fact, it has to be real enough that the flag 
     * column is shown as a variable not a constant, else setrefs.c will get 
     * confused. 
     */ 
</span>    <a href="prepunion.c.html#LN621"><span class='Ref_To_Local'>tlist</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN94"><span class='Ref_to_Proto'>generate_append_tlist</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN608"><span class='Ref_to_Parameter'>op</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1555"><span class='Ref_to_Member'>colTypes</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN608"><span class='Ref_to_Parameter'>op</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1557"><span class='Ref_to_Member'>colCollations</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                  <a href="prepunion.c.html#LN620"><span class='Ref_To_Local'>tlist_list</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN609"><span class='Ref_to_Parameter'>refnames_tlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="prepunion.c.html#LN610"><span class='Ref_to_Parameter'>pTargetList</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN621"><span class='Ref_To_Local'>tlist</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Append the child results together. 
     */ 
</span>    <a href="prepunion.c.html#LN617"><span class='Ref_To_Local'>path</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/optimizer/pathnode.h.html#LN65"><span class='Ref_to_Proto'>create_append_path</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN613"><span class='Ref_To_Local'>result_rel</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN623"><span class='Ref_To_Local'>pathlist</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* We have to manually jam the right tlist into the path; ick */ 
</span>    <a href="prepunion.c.html#LN617"><span class='Ref_To_Local'>path</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN953"><span class='Ref_to_Member'>pathtarget</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/tlist.h.html#LN68"><span class='Ref_to_Macro'>create_pathtarget</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN608"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN621"><span class='Ref_To_Local'>tlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Identify the grouping semantics */ 
</span>    <a href="prepunion.c.html#LN622"><span class='Ref_To_Local'>groupList</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN98"><span class='Ref_to_Proto'>generate_setop_grouplist</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN608"><span class='Ref_to_Parameter'>op</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN621"><span class='Ref_To_Local'>tlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* punt if nothing to group on (can this happen?) */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN622"><span class='Ref_To_Local'>groupList</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="prepunion.c.html#LN617"><span class='Ref_To_Local'>path</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Estimate number of distinct groups that we'll need hashtable entries 
     * for; this is the size of the left-hand input for EXCEPT, or the smaller 
     * input for INTERSECT.  Also estimate the number of eventual output rows. 
     * In non-ALL cases, we estimate each group produces one output row; in 
     * ALL cases use the relevant relation size.  These are worst-case 
     * estimates, of course, but we need to be conservative. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN608"><span class='Ref_to_Parameter'>op</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1548"><span class='Ref_to_Member'>op</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/parsenodes.h.html#LN1475"><span class='Ref_to_EnumConst'>SETOP_EXCEPT</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="prepunion.c.html#LN626"><span class='Ref_To_Local'>dNumGroups</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN624"><span class='Ref_To_Local'>dLeftGroups</span></a><span class='Delimiter'>; 
</span>        <a href="prepunion.c.html#LN627"><span class='Ref_To_Local'>dNumOutputRows</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN608"><span class='Ref_to_Parameter'>op</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1549"><span class='Ref_to_Member'>all</span></a> <span class='Operator'>? </span><a href="prepunion.c.html#LN615"><span class='Ref_To_Local'>lpath</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN963"><span class='Ref_to_Member'>rows</span></a> <span class='Operator'>: </span><a href="prepunion.c.html#LN626"><span class='Ref_To_Local'>dNumGroups</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="prepunion.c.html#LN626"><span class='Ref_To_Local'>dNumGroups</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN624"><span class='Ref_To_Local'>dLeftGroups</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN625"><span class='Ref_To_Local'>dRightGroups</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepunion.c.html#LN627"><span class='Ref_To_Local'>dNumOutputRows</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN608"><span class='Ref_to_Parameter'>op</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1549"><span class='Ref_to_Member'>all</span></a> <span class='Operator'>? </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN615"><span class='Ref_To_Local'>lpath</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN963"><span class='Ref_to_Member'>rows</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN616"><span class='Ref_To_Local'>rpath</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN963"><span class='Ref_to_Member'>rows</span></a><span class='Parentheses'>) </span><span class='Operator'>: </span><a href="prepunion.c.html#LN626"><span class='Ref_To_Local'>dNumGroups</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Decide whether to hash or sort, and add a sort node if needed. 
     */ 
</span>    <a href="prepunion.c.html#LN628"><span class='Ref_To_Local'>use_hash</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN84"><span class='Ref_to_Proto'>choose_hashed_setop</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN608"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN622"><span class='Ref_To_Local'>groupList</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN617"><span class='Ref_To_Local'>path</span></a><span class='Delimiter'>, 
</span>                                   <a href="prepunion.c.html#LN626"><span class='Ref_To_Local'>dNumGroups</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN627"><span class='Ref_To_Local'>dNumOutputRows</span></a><span class='Delimiter'>, 
</span>                       <span class='Parentheses'>(</span><a href="prepunion.c.html#LN608"><span class='Ref_to_Parameter'>op</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1548"><span class='Ref_to_Member'>op</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/parsenodes.h.html#LN1474"><span class='Ref_to_EnumConst'>SETOP_INTERSECT</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='String'>"INTERSECT"</span> <span class='Operator'>: </span><span class='String'>"EXCEPT"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="prepunion.c.html#LN628"><span class='Ref_To_Local'>use_hash</span></a><span class='Parentheses'>) 
</span>        <a href="prepunion.c.html#LN617"><span class='Ref_To_Local'>path</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/optimizer/pathnode.h.html#LN165"><span class='Ref_to_Proto'>create_sort_path</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN608"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                         <a href="prepunion.c.html#LN613"><span class='Ref_To_Local'>result_rel</span></a><span class='Delimiter'>, 
</span>                                         <a href="prepunion.c.html#LN617"><span class='Ref_To_Local'>path</span></a><span class='Delimiter'>, 
</span>                                         <a href="../../../include/optimizer/paths.h.html#LN205"><span class='Ref_to_Proto'>make_pathkeys_for_sortclauses</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN608"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                                                   <a href="prepunion.c.html#LN622"><span class='Ref_To_Local'>groupList</span></a><span class='Delimiter'>, 
</span>                                                                       <a href="prepunion.c.html#LN621"><span class='Ref_To_Local'>tlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                         <span class='Operator'>-</span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Finally, add a SetOp path node to generate the correct output. 
     */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN608"><span class='Ref_to_Parameter'>op</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1548"><span class='Ref_to_Member'>op</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN1474"><span class='Ref_to_EnumConst'>SETOP_INTERSECT</span></a><span class='Operator'>: 
</span>            <a href="prepunion.c.html#LN629"><span class='Ref_To_Local'>cmd</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN608"><span class='Ref_to_Parameter'>op</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1549"><span class='Ref_to_Member'>all</span></a> <span class='Operator'>? </span><a href="../../../include/nodes/nodes.h.html#LN780"><span class='Ref_to_EnumConst'>SETOPCMD_INTERSECT_ALL</span></a> <span class='Operator'>: </span><a href="../../../include/nodes/nodes.h.html#LN779"><span class='Ref_to_EnumConst'>SETOPCMD_INTERSECT</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN1475"><span class='Ref_to_EnumConst'>SETOP_EXCEPT</span></a><span class='Operator'>: 
</span>            <a href="prepunion.c.html#LN629"><span class='Ref_To_Local'>cmd</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN608"><span class='Ref_to_Parameter'>op</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1549"><span class='Ref_to_Member'>all</span></a> <span class='Operator'>? </span><a href="../../../include/nodes/nodes.h.html#LN782"><span class='Ref_to_EnumConst'>SETOPCMD_EXCEPT_ALL</span></a> <span class='Operator'>: </span><a href="../../../include/nodes/nodes.h.html#LN781"><span class='Ref_to_EnumConst'>SETOPCMD_EXCEPT</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized set op: %d"</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="prepunion.c.html#LN608"><span class='Ref_to_Parameter'>op</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1548"><span class='Ref_to_Member'>op</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="prepunion.c.html#LN629"><span class='Ref_To_Local'>cmd</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN779"><span class='Ref_to_EnumConst'>SETOPCMD_INTERSECT</span></a><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="prepunion.c.html#LN617"><span class='Ref_To_Local'>path</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/optimizer/pathnode.h.html#LN213"><span class='Ref_to_Proto'>create_setop_path</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN608"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                      <a href="prepunion.c.html#LN613"><span class='Ref_To_Local'>result_rel</span></a><span class='Delimiter'>, 
</span>                                      <a href="prepunion.c.html#LN617"><span class='Ref_To_Local'>path</span></a><span class='Delimiter'>, 
</span>                                      <a href="prepunion.c.html#LN629"><span class='Ref_To_Local'>cmd</span></a><span class='Delimiter'>, 
</span>                                      <a href="prepunion.c.html#LN628"><span class='Ref_To_Local'>use_hash</span></a> <span class='Operator'>? </span><a href="../../../include/nodes/nodes.h.html#LN788"><span class='Ref_to_EnumConst'>SETOP_HASHED</span></a> <span class='Operator'>: </span><a href="../../../include/nodes/nodes.h.html#LN787"><span class='Ref_to_EnumConst'>SETOP_SORTED</span></a><span class='Delimiter'>, 
</span>                                      <a href="prepunion.c.html#LN622"><span class='Ref_To_Local'>groupList</span></a><span class='Delimiter'>, 
</span>                                      <a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN608"><span class='Ref_to_Parameter'>op</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1555"><span class='Ref_to_Member'>colTypes</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                      <a href="prepunion.c.html#LN628"><span class='Ref_To_Local'>use_hash</span></a> <span class='Operator'>? </span><a href="prepunion.c.html#LN630"><span class='Ref_To_Local'>firstFlag</span></a> <span class='Operator'>: -</span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                      <a href="prepunion.c.html#LN626"><span class='Ref_To_Local'>dNumGroups</span></a><span class='Delimiter'>, 
</span>                                      <a href="prepunion.c.html#LN627"><span class='Ref_To_Local'>dNumOutputRows</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN611"><span class='Ref_to_Parameter'>pNumGroups</span></a><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="prepunion.c.html#LN611"><span class='Ref_to_Parameter'>pNumGroups</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN626"><span class='Ref_To_Local'>dNumGroups</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="prepunion.c.html#LN617"><span class='Ref_To_Local'>path</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end generate_nonunion_path &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Pull up children of a UNION node that are identically-propertied UNIONs. 
 * 
 * NOTE: we can also pull a UNION ALL up into a UNION, since the distinct 
 * output rows will be lost anyway. 
 * 
 * NOTE: currently, we ignore collations while determining if a child has 
 * the same properties.  This is semantically sound only so long as all 
 * collations have the same notion of equality.  It is valid from an 
 * implementation standpoint because we don't care about the ordering of 
 * a UNION child's result: UNION ALL results are always unordered, and 
 * generate_union_path will force a fresh sort if the top level is a UNION. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN784"></a><span class='Declare_Function'>recurse_union_children</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>setOp</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN785"></a>                       <a href="../../../include/nodes/parsenodes.h.html#LN1545"><span class='Ref_to_Struct'>SetOperationStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>top_union</span><span class='Delimiter'>, 
</span><a name="LN786"></a>                       <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>refnames_tlist</span><span class='Delimiter'>, 
</span><a name="LN787"></a>                       <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>tlist_list</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN789"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN790"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>child_tlist</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN784"><span class='Ref_to_Parameter'>setOp</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN1545"><span class='Ref_to_Struct'>SetOperationStmt</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN794"></a>        <a href="../../../include/nodes/parsenodes.h.html#LN1545"><span class='Ref_to_Struct'>SetOperationStmt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>op</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN1545"><span class='Ref_to_Struct'>SetOperationStmt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepunion.c.html#LN784"><span class='Ref_to_Parameter'>setOp</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN794"><span class='Ref_To_Local'>op</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1548"><span class='Ref_to_Member'>op</span></a> <span class='Operator'>== </span><a href="prepunion.c.html#LN785"><span class='Ref_to_Parameter'>top_union</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1548"><span class='Ref_to_Member'>op</span></a> <span class='Operator'>&& 
</span>            <span class='Parentheses'>(</span><a href="prepunion.c.html#LN794"><span class='Ref_To_Local'>op</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1549"><span class='Ref_to_Member'>all</span></a> <span class='Operator'>== </span><a href="prepunion.c.html#LN785"><span class='Ref_to_Parameter'>top_union</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1549"><span class='Ref_to_Member'>all</span></a> <span class='Operator'>|| </span><a href="prepunion.c.html#LN794"><span class='Ref_To_Local'>op</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1549"><span class='Ref_to_Member'>all</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>            <a href="../../../include/nodes/nodes.h.html#LN626"><span class='Ref_to_Proto'>equal</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN794"><span class='Ref_To_Local'>op</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1555"><span class='Ref_to_Member'>colTypes</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN785"><span class='Ref_to_Parameter'>top_union</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1555"><span class='Ref_to_Member'>colTypes</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Same UNION, so fold children into parent's subpath list */ 
</span><a name="LN801"></a>            <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>child_tlists1</span><span class='Delimiter'>; 
</span><a name="LN802"></a>            <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>child_tlists2</span><span class='Delimiter'>; 
</span> 
            <a href="prepunion.c.html#LN789"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN78"><span class='Ref_to_Proto'>recurse_union_children</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN794"><span class='Ref_To_Local'>op</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1550"><span class='Ref_to_Member'>larg</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN784"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                                        <a href="prepunion.c.html#LN785"><span class='Ref_to_Parameter'>top_union</span></a><span class='Delimiter'>, 
</span>                                                        <a href="prepunion.c.html#LN786"><span class='Ref_to_Parameter'>refnames_tlist</span></a><span class='Delimiter'>, 
</span>                                                        <span class='Operator'>&</span><a href="prepunion.c.html#LN801"><span class='Ref_To_Local'>child_tlists1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="prepunion.c.html#LN78"><span class='Ref_to_Proto'>recurse_union_children</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN794"><span class='Ref_To_Local'>op</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1551"><span class='Ref_to_Member'>rarg</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN784"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                                        <a href="prepunion.c.html#LN785"><span class='Ref_to_Parameter'>top_union</span></a><span class='Delimiter'>, 
</span>                                                        <a href="prepunion.c.html#LN786"><span class='Ref_to_Parameter'>refnames_tlist</span></a><span class='Delimiter'>, 
</span>                                                        <span class='Operator'>&</span><a href="prepunion.c.html#LN802"><span class='Ref_To_Local'>child_tlists2</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="prepunion.c.html#LN787"><span class='Ref_to_Parameter'>tlist_list</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN801"><span class='Ref_To_Local'>child_tlists1</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN802"><span class='Ref_To_Local'>child_tlists2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <a href="prepunion.c.html#LN789"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IsA(setOp,SetOperatio... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Not same, so plan this child separately. 
     * 
     * Note we disallow any resjunk columns in child results.  This is 
     * necessary since the Append node that implements the union won't do any 
     * projection, and upper levels will get confused if some of our output 
     * tuples have junk and some don't.  This case only arises when we have an 
     * EXCEPT or INTERSECT as child, else there won't be resjunk anyway. 
     */ 
</span>    <a href="prepunion.c.html#LN789"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN138"><span class='Ref_to_Macro'>list_make1</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN60"><span class='Ref_to_Proto'>recurse_set_operations</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN784"><span class='Ref_to_Parameter'>setOp</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN784"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                               <a href="prepunion.c.html#LN785"><span class='Ref_to_Parameter'>top_union</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1555"><span class='Ref_to_Member'>colTypes</span></a><span class='Delimiter'>, 
</span>                                               <a href="prepunion.c.html#LN785"><span class='Ref_to_Parameter'>top_union</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1557"><span class='Ref_to_Member'>colCollations</span></a><span class='Delimiter'>, 
</span>                                               <span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                               <a href="prepunion.c.html#LN786"><span class='Ref_to_Parameter'>refnames_tlist</span></a><span class='Delimiter'>, 
</span>                                               <span class='Operator'>&</span><a href="prepunion.c.html#LN790"><span class='Ref_To_Local'>child_tlist</span></a><span class='Delimiter'>, 
</span>                                               <span class='Null_Value'>NULL</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="prepunion.c.html#LN787"><span class='Ref_to_Parameter'>tlist_list</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN138"><span class='Ref_to_Macro'>list_make1</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN790"><span class='Ref_To_Local'>child_tlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="prepunion.c.html#LN789"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end recurse_union_children &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Add nodes to the given path tree to unique-ify the result of a UNION. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>* 
</span><a name="LN841"></a><span class='Declare_Function'>make_union_unique</span><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN1545"><span class='Ref_to_Struct'>SetOperationStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>op</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>path</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tlist</span><span class='Delimiter'>, 
</span><a name="LN842"></a>                  <a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN844"></a>    <a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>result_rel</span> <span class='Operator'>= </span><a href="../../../include/optimizer/pathnode.h.html#LN270"><span class='Ref_to_Proto'>fetch_upper_rel</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN842"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN72"><span class='Ref_to_EnumConst'>UPPERREL_SETOP</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN845"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>groupList</span><span class='Delimiter'>; 
</span><a name="LN846"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>dNumGroups</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Identify the grouping semantics */ 
</span>    <a href="prepunion.c.html#LN845"><span class='Ref_To_Local'>groupList</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN98"><span class='Ref_to_Proto'>generate_setop_grouplist</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN841"><span class='Ref_to_Parameter'>op</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN841"><span class='Ref_to_Parameter'>tlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* punt if nothing to group on (can this happen?) */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN845"><span class='Ref_To_Local'>groupList</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="prepunion.c.html#LN841"><span class='Ref_to_Parameter'>path</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * XXX for the moment, take the number of distinct groups as equal to the 
     * total input size, ie, the worst case.  This is too conservative, but we 
     * don't want to risk having the hashtable overrun memory; also, it's not 
     * clear how to get a decent estimate of the true size.  One should note 
     * as well the propensity of novices to write UNION rather than UNION ALL 
     * even when they don't expect any duplicates... 
     */ 
</span>    <a href="prepunion.c.html#LN846"><span class='Ref_To_Local'>dNumGroups</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN841"><span class='Ref_to_Parameter'>path</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN963"><span class='Ref_to_Member'>rows</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Decide whether to hash or sort */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN84"><span class='Ref_to_Proto'>choose_hashed_setop</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN842"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN845"><span class='Ref_To_Local'>groupList</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN841"><span class='Ref_to_Parameter'>path</span></a><span class='Delimiter'>, 
</span>                            <a href="prepunion.c.html#LN846"><span class='Ref_To_Local'>dNumGroups</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN846"><span class='Ref_To_Local'>dNumGroups</span></a><span class='Delimiter'>, 
</span>                            <span class='String'>"UNION"</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Hashed aggregate plan --- no sort needed */ 
</span>        <a href="prepunion.c.html#LN841"><span class='Ref_to_Parameter'>path</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/optimizer/pathnode.h.html#LN182"><span class='Ref_to_Proto'>create_agg_path</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN842"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                        <a href="prepunion.c.html#LN844"><span class='Ref_To_Local'>result_rel</span></a><span class='Delimiter'>, 
</span>                                        <a href="prepunion.c.html#LN841"><span class='Ref_to_Parameter'>path</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../../include/optimizer/tlist.h.html#LN68"><span class='Ref_to_Macro'>create_pathtarget</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN842"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN841"><span class='Ref_to_Parameter'>tlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                        <a href="../../../include/nodes/nodes.h.html#LN737"><span class='Ref_to_EnumConst'>AGG_HASHED</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../../include/nodes/nodes.h.html#LN758"><span class='Ref_to_EnumConst'>AGGSPLIT_SIMPLE</span></a><span class='Delimiter'>, 
</span>                                        <a href="prepunion.c.html#LN845"><span class='Ref_To_Local'>groupList</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, 
</span>                                        <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                        <a href="prepunion.c.html#LN846"><span class='Ref_To_Local'>dNumGroups</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Sort and Unique */ 
</span>        <a href="prepunion.c.html#LN841"><span class='Ref_to_Parameter'>path</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/optimizer/pathnode.h.html#LN165"><span class='Ref_to_Proto'>create_sort_path</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN842"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                         <a href="prepunion.c.html#LN844"><span class='Ref_To_Local'>result_rel</span></a><span class='Delimiter'>, 
</span>                                         <a href="prepunion.c.html#LN841"><span class='Ref_to_Parameter'>path</span></a><span class='Delimiter'>, 
</span>                                         <a href="../../../include/optimizer/paths.h.html#LN205"><span class='Ref_to_Proto'>make_pathkeys_for_sortclauses</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN842"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                                                   <a href="prepunion.c.html#LN845"><span class='Ref_To_Local'>groupList</span></a><span class='Delimiter'>, 
</span>                                                                       <a href="prepunion.c.html#LN841"><span class='Ref_to_Parameter'>tlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                         <span class='Operator'>-</span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* We have to manually jam the right tlist into the path; ick */ 
</span>        <a href="prepunion.c.html#LN841"><span class='Ref_to_Parameter'>path</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN953"><span class='Ref_to_Member'>pathtarget</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/tlist.h.html#LN68"><span class='Ref_to_Macro'>create_pathtarget</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN842"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN841"><span class='Ref_to_Parameter'>tlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepunion.c.html#LN841"><span class='Ref_to_Parameter'>path</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/optimizer/pathnode.h.html#LN177"><span class='Ref_to_Proto'>create_upper_unique_path</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN842"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                                 <a href="prepunion.c.html#LN844"><span class='Ref_To_Local'>result_rel</span></a><span class='Delimiter'>, 
</span>                                                 <a href="prepunion.c.html#LN841"><span class='Ref_to_Parameter'>path</span></a><span class='Delimiter'>, 
</span>                                                 <a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN841"><span class='Ref_to_Parameter'>path</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN967"><span class='Ref_to_Member'>pathkeys</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                 <a href="prepunion.c.html#LN846"><span class='Ref_To_Local'>dNumGroups</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="prepunion.c.html#LN841"><span class='Ref_to_Parameter'>path</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end make_union_unique &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * choose_hashed_setop - should we use hashing for a set operation? 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN908"></a><span class='Declare_Function'>choose_hashed_setop</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>groupClauses</span><span class='Delimiter'>, 
</span><a name="LN909"></a>                    <a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>input_path</span><span class='Delimiter'>, 
</span><a name="LN910"></a>                    <span class='Keyword'>double </span><span class='Declare_Parameter'>dNumGroups</span><span class='Delimiter'>, </span><span class='Keyword'>double </span><span class='Declare_Parameter'>dNumOutputRows</span><span class='Delimiter'>, 
</span><a name="LN911"></a>                    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>construct</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN913"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>numGroupCols</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN908"><span class='Ref_to_Parameter'>groupClauses</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN914"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>can_sort</span><span class='Delimiter'>; 
</span><a name="LN915"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>can_hash</span><span class='Delimiter'>; 
</span><a name="LN916"></a>    <a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>hashentrysize</span><span class='Delimiter'>; 
</span><a name="LN917"></a>    <a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a>        <span class='Declare_Local'>hashed_p</span><span class='Delimiter'>; 
</span><a name="LN918"></a>    <a href="../../../include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a>        <span class='Declare_Local'>sorted_p</span><span class='Delimiter'>; 
</span><a name="LN919"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>tuple_fraction</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check whether the operators support sorting or hashing */ 
</span>    <a href="prepunion.c.html#LN914"><span class='Ref_To_Local'>can_sort</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/tlist.h.html#LN51"><span class='Ref_to_Proto'>grouping_is_sortable</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN908"><span class='Ref_to_Parameter'>groupClauses</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="prepunion.c.html#LN915"><span class='Ref_To_Local'>can_hash</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/tlist.h.html#LN52"><span class='Ref_to_Proto'>grouping_is_hashable</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN908"><span class='Ref_to_Parameter'>groupClauses</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN915"><span class='Ref_To_Local'>can_hash</span></a> <span class='Operator'>&& </span><a href="prepunion.c.html#LN914"><span class='Ref_To_Local'>can_sort</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* we have a meaningful choice to make, continue ... */ 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN915"><span class='Ref_To_Local'>can_hash</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN914"><span class='Ref_To_Local'>can_sort</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <span class='Comment_Multi_Line'>/* translator: %s is UNION, INTERSECT, or EXCEPT */ 
</span>                 <a href="../../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not implement %s"</span><span class='Delimiter'>, </span><a href="prepunion.c.html#LN911"><span class='Ref_to_Parameter'>construct</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Some of the datatypes only support hashing, while others only support sorting."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Prefer sorting when enable_hashagg is off */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../path/costsize.c.html#LN123"><span class='Ref_to_Global_Var'>enable_hashagg</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Don't do it if it doesn't look like the hashtable will fit into 
     * work_mem. 
     */ 
</span>    <a href="prepunion.c.html#LN916"><span class='Ref_To_Local'>hashentrysize</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN587"><span class='Ref_to_Macro'>MAXALIGN</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN909"><span class='Ref_to_Parameter'>input_path</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN953"><span class='Ref_to_Member'>pathtarget</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN885"><span class='Ref_to_Member'>width</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="../../../include/c.h.html#LN587"><span class='Ref_to_Macro'>MAXALIGN</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN649"><span class='Ref_to_Const'>SizeofMinimalTupleHeader</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN916"><span class='Ref_To_Local'>hashentrysize</span></a> <span class='Operator'>* </span><a href="prepunion.c.html#LN910"><span class='Ref_to_Parameter'>dNumGroups</span></a> <span class='Operator'>&GT; </span><a href="../../utils/init/globals.c.html#LN112"><span class='Ref_to_Global_Var'>work_mem</span></a> <span class='Operator'>* </span><span class='Number'>1024L</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * See if the estimated cost is no more than doing it the other way. 
     * 
     * We need to consider input_plan + hashagg versus input_plan + sort + 
     * group.  Note that the actual result plan might involve a SetOp or 
     * Unique node, not Agg or Group, but the cost estimates for Agg and Group 
     * should be close enough for our purposes here. 
     * 
     * These path variables are dummies that just hold cost fields; we don't 
     * make actual Paths for these steps. 
     */ 
</span>    <a href="../../../include/optimizer/cost.h.html#LN114"><span class='Ref_to_Proto'>cost_agg</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="prepunion.c.html#LN917"><span class='Ref_To_Local'>hashed_p</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN908"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/nodes.h.html#LN737"><span class='Ref_to_EnumConst'>AGG_HASHED</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>             <a href="prepunion.c.html#LN913"><span class='Ref_To_Local'>numGroupCols</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN910"><span class='Ref_to_Parameter'>dNumGroups</span></a><span class='Delimiter'>, 
</span>             <a href="prepunion.c.html#LN909"><span class='Ref_to_Parameter'>input_path</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN964"><span class='Ref_to_Member'>startup_cost</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN909"><span class='Ref_to_Parameter'>input_path</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN965"><span class='Ref_to_Member'>total_cost</span></a><span class='Delimiter'>, 
</span>             <a href="prepunion.c.html#LN909"><span class='Ref_to_Parameter'>input_path</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN963"><span class='Ref_to_Member'>rows</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now for the sorted case.  Note that the input is *always* unsorted, 
     * since it was made by appending unrelated sub-relations together. 
     */ 
</span>    <a href="prepunion.c.html#LN918"><span class='Ref_To_Local'>sorted_p</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN964"><span class='Ref_to_Member'>startup_cost</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN909"><span class='Ref_to_Parameter'>input_path</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN964"><span class='Ref_to_Member'>startup_cost</span></a><span class='Delimiter'>; 
</span>    <a href="prepunion.c.html#LN918"><span class='Ref_To_Local'>sorted_p</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN965"><span class='Ref_to_Member'>total_cost</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN909"><span class='Ref_to_Parameter'>input_path</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN965"><span class='Ref_to_Member'>total_cost</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* XXX cost_sort doesn't actually look at pathkeys, so just pass NIL */ 
</span>    <a href="../../../include/optimizer/cost.h.html#LN103"><span class='Ref_to_Proto'>cost_sort</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="prepunion.c.html#LN918"><span class='Ref_To_Local'>sorted_p</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN908"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN918"><span class='Ref_To_Local'>sorted_p</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN965"><span class='Ref_to_Member'>total_cost</span></a><span class='Delimiter'>, 
</span>              <a href="prepunion.c.html#LN909"><span class='Ref_to_Parameter'>input_path</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN963"><span class='Ref_to_Member'>rows</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN909"><span class='Ref_to_Parameter'>input_path</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN953"><span class='Ref_to_Member'>pathtarget</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN885"><span class='Ref_to_Member'>width</span></a><span class='Delimiter'>, 
</span>              <span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="../../utils/init/globals.c.html#LN112"><span class='Ref_to_Global_Var'>work_mem</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/optimizer/cost.h.html#LN123"><span class='Ref_to_Proto'>cost_group</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="prepunion.c.html#LN918"><span class='Ref_To_Local'>sorted_p</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN908"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN913"><span class='Ref_To_Local'>numGroupCols</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN910"><span class='Ref_to_Parameter'>dNumGroups</span></a><span class='Delimiter'>, 
</span>               <a href="prepunion.c.html#LN918"><span class='Ref_To_Local'>sorted_p</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN964"><span class='Ref_to_Member'>startup_cost</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN918"><span class='Ref_To_Local'>sorted_p</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN965"><span class='Ref_to_Member'>total_cost</span></a><span class='Delimiter'>, 
</span>               <a href="prepunion.c.html#LN909"><span class='Ref_to_Parameter'>input_path</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN963"><span class='Ref_to_Member'>rows</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now make the decision using the top-level tuple fraction.  First we 
     * have to convert an absolute count (LIMIT) into fractional form. 
     */ 
</span>    <a href="prepunion.c.html#LN919"><span class='Ref_To_Local'>tuple_fraction</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN908"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN290"><span class='Ref_to_Member'>tuple_fraction</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN919"><span class='Ref_To_Local'>tuple_fraction</span></a> <span class='Operator'>&GT;= </span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="prepunion.c.html#LN919"><span class='Ref_To_Local'>tuple_fraction</span></a> <span class='Operator'>/= </span><a href="prepunion.c.html#LN910"><span class='Ref_to_Parameter'>dNumOutputRows</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/optimizer/pathnode.h.html#LN24"><span class='Ref_to_Proto'>compare_fractional_path_costs</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="prepunion.c.html#LN917"><span class='Ref_To_Local'>hashed_p</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="prepunion.c.html#LN918"><span class='Ref_To_Local'>sorted_p</span></a><span class='Delimiter'>, 
</span>                                      <a href="prepunion.c.html#LN919"><span class='Ref_To_Local'>tuple_fraction</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Hashed is cheaper, so use it */ 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end choose_hashed_setop &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Generate targetlist for a set-operation plan node 
 * 
 * colTypes: OID list of set-op's result column datatypes 
 * colCollations: OID list of set-op's result column collations 
 * flag: -1 if no flag column needed, 0 or 1 to create a const flag column 
 * varno: varno to use in generated Vars 
 * hack_constants: true to copy up constants (see comments in code) 
 * input_tlist: targetlist of this node's input node 
 * refnames_tlist: targetlist to take column names from 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN1011"></a><span class='Declare_Function'>generate_setop_tlist</span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>colTypes</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>colCollations</span><span class='Delimiter'>, 
</span><a name="LN1012"></a>                     <span class='Keyword'>int </span><span class='Declare_Parameter'>flag</span><span class='Delimiter'>, 
</span><a name="LN1013"></a>                     <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>varno</span><span class='Delimiter'>, 
</span><a name="LN1014"></a>                     <span class='Keyword'>bool </span><span class='Declare_Parameter'>hack_constants</span><span class='Delimiter'>, 
</span><a name="LN1015"></a>                     <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>input_tlist</span><span class='Delimiter'>, 
</span><a name="LN1016"></a>                     <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>refnames_tlist</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1018"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>tlist</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN1019"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>resno</span> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span><a name="LN1020"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>ctlc</span><span class='Delimiter'>, 
</span><a name="LN1021"></a>               <span class='Operator'>*</span><span class='Declare_Local'>cclc</span><span class='Delimiter'>, 
</span><a name="LN1022"></a>               <span class='Operator'>*</span><span class='Declare_Local'>itlc</span><span class='Delimiter'>, 
</span><a name="LN1023"></a>               <span class='Operator'>*</span><span class='Declare_Local'>rtlc</span><span class='Delimiter'>; 
</span><a name="LN1024"></a>    <a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tle</span><span class='Delimiter'>; 
</span><a name="LN1025"></a>    <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>expr</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* there's no forfour() so we must chase one list manually */ 
</span>    <a href="prepunion.c.html#LN1023"><span class='Ref_To_Local'>rtlc</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN75"><span class='Ref_to_Func'>list_head</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1016"><span class='Ref_to_Parameter'>refnames_tlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN202"><span class='Ref_to_Macro'>forthree</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1020"><span class='Ref_To_Local'>ctlc</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN1011"><span class='Ref_to_Parameter'>colTypes</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN1021"><span class='Ref_To_Local'>cclc</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN1011"><span class='Ref_to_Parameter'>colCollations</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN1022"><span class='Ref_To_Local'>itlc</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN1015"><span class='Ref_to_Parameter'>input_tlist</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1031"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>colType</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1020"><span class='Ref_To_Local'>ctlc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1032"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>colColl</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1021"><span class='Ref_To_Local'>cclc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1033"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>inputtle</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1022"><span class='Ref_To_Local'>itlc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1034"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>reftle</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1023"><span class='Ref_To_Local'>rtlc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="prepunion.c.html#LN1023"><span class='Ref_To_Local'>rtlc</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1023"><span class='Ref_To_Local'>rtlc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1033"><span class='Ref_To_Local'>inputtle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1367"><span class='Ref_to_Member'>resno</span></a> <span class='Operator'>== </span><a href="prepunion.c.html#LN1019"><span class='Ref_To_Local'>resno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1034"><span class='Ref_To_Local'>reftle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1367"><span class='Ref_to_Member'>resno</span></a> <span class='Operator'>== </span><a href="prepunion.c.html#LN1019"><span class='Ref_To_Local'>resno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="prepunion.c.html#LN1033"><span class='Ref_To_Local'>inputtle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1373"><span class='Ref_to_Member'>resjunk</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="prepunion.c.html#LN1034"><span class='Ref_To_Local'>reftle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1373"><span class='Ref_to_Member'>resjunk</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Generate columns referencing input columns and having appropriate 
         * data types and column names.  Insert datatype coercions where 
         * necessary. 
         * 
         * HACK: constants in the input's targetlist are copied up as-is 
         * rather than being referenced as subquery outputs.  This is mainly 
         * to ensure that when we try to coerce them to the output column's 
         * datatype, the right things happen for UNKNOWN constants.  But do 
         * this only at the first level of subquery-scan plans; we don't want 
         * phony constants appearing in the output tlists of upper-level 
         * nodes! 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN1014"><span class='Ref_to_Parameter'>hack_constants</span></a> <span class='Operator'>&& </span><a href="prepunion.c.html#LN1033"><span class='Ref_To_Local'>inputtle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a> <span class='Operator'>&& </span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1033"><span class='Ref_To_Local'>inputtle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a><span class='Parentheses'>))</span> 
            <a href="prepunion.c.html#LN1025"><span class='Ref_To_Local'>expr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepunion.c.html#LN1033"><span class='Ref_To_Local'>inputtle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="prepunion.c.html#LN1025"><span class='Ref_To_Local'>expr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/makefuncs.h.html#LN25"><span class='Ref_to_Proto'>makeVar</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1013"><span class='Ref_to_Parameter'>varno</span></a><span class='Delimiter'>, 
</span>                                    <a href="prepunion.c.html#LN1033"><span class='Ref_To_Local'>inputtle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1367"><span class='Ref_to_Member'>resno</span></a><span class='Delimiter'>, 
</span>                                    <a href="../../../include/nodes/nodeFuncs.h.html#LN31"><span class='Ref_to_Proto'>exprType</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepunion.c.html#LN1033"><span class='Ref_To_Local'>inputtle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                    <a href="../../../include/nodes/nodeFuncs.h.html#LN32"><span class='Ref_to_Proto'>exprTypmod</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepunion.c.html#LN1033"><span class='Ref_To_Local'>inputtle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                    <a href="../../../include/nodes/nodeFuncs.h.html#LN38"><span class='Ref_to_Proto'>exprCollation</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepunion.c.html#LN1033"><span class='Ref_To_Local'>inputtle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                    <span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodeFuncs.h.html#LN31"><span class='Ref_to_Proto'>exprType</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1025"><span class='Ref_To_Local'>expr</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="prepunion.c.html#LN1031"><span class='Ref_To_Local'>colType</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Note: it's not really cool to be applying coerce_to_common_type 
             * here; one notable point is that assign_expr_collations never 
             * gets run on any generated nodes.  For the moment that's not a 
             * problem because we force the correct exposed collation below. 
             * It would likely be best to make the parser generate the correct 
             * output tlist for every set-op to begin with, though. 
             */ 
</span>            <a href="prepunion.c.html#LN1025"><span class='Ref_To_Local'>expr</span></a> <span class='Operator'>= </span><a href="../../../include/parser/parse_coerce.h.html#LN70"><span class='Ref_to_Proto'>coerce_to_common_type</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>,</span>  <span class='Comment_Single_Line'>/* no UNKNOWNs here */ 
</span>                                         <a href="prepunion.c.html#LN1025"><span class='Ref_To_Local'>expr</span></a><span class='Delimiter'>, 
</span>                                         <a href="prepunion.c.html#LN1031"><span class='Ref_To_Local'>colType</span></a><span class='Delimiter'>, 
</span>                                         <span class='String'>"UNION/INTERSECT/EXCEPT"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Ensure the tlist entry's exposed collation matches the set-op. This 
         * is necessary because plan_set_operations() reports the result 
         * ordering as a list of SortGroupClauses, which don't carry collation 
         * themselves but just refer to tlist entries.  If we don't show the 
         * right collation then planner.c might do the wrong thing in 
         * higher-level queries. 
         * 
         * Note we use RelabelType, not CollateExpr, since this expression 
         * will reach the executor without any further processing. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodeFuncs.h.html#LN38"><span class='Ref_to_Proto'>exprCollation</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1025"><span class='Ref_To_Local'>expr</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="prepunion.c.html#LN1032"><span class='Ref_To_Local'>colColl</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="prepunion.c.html#LN1025"><span class='Ref_To_Local'>expr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/makefuncs.h.html#LN65"><span class='Ref_to_Proto'>makeRelabelType</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepunion.c.html#LN1025"><span class='Ref_To_Local'>expr</span></a><span class='Delimiter'>, 
</span>                                            <a href="../../../include/nodes/nodeFuncs.h.html#LN31"><span class='Ref_to_Proto'>exprType</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1025"><span class='Ref_To_Local'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                            <a href="../../../include/nodes/nodeFuncs.h.html#LN32"><span class='Ref_to_Proto'>exprTypmod</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1025"><span class='Ref_To_Local'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                            <a href="prepunion.c.html#LN1032"><span class='Ref_To_Local'>colColl</span></a><span class='Delimiter'>, 
</span>                                            <a href="../../../include/nodes/primnodes.h.html#LN438"><span class='Ref_to_EnumConst'>COERCE_IMPLICIT_CAST</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="prepunion.c.html#LN1024"><span class='Ref_To_Local'>tle</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/makefuncs.h.html#LN40"><span class='Ref_to_Proto'>makeTargetEntry</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepunion.c.html#LN1025"><span class='Ref_To_Local'>expr</span></a><span class='Delimiter'>, 
</span>                              <span class='Parentheses'>(</span><a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a><span class='Parentheses'>) </span><a href="prepunion.c.html#LN1019"><span class='Ref_To_Local'>resno</span></a><span class='Operator'>++</span><span class='Delimiter'>, 
</span>                              <a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1034"><span class='Ref_To_Local'>reftle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1368"><span class='Ref_to_Member'>resname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * By convention, all non-resjunk columns in a setop tree have 
         * ressortgroupref equal to their resno.  In some cases the ref isn't 
         * needed, but this is a cleaner way than modifying the tlist later. 
         */ 
</span>        <a href="prepunion.c.html#LN1024"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1369"><span class='Ref_to_Member'>ressortgroupref</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN1024"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1367"><span class='Ref_to_Member'>resno</span></a><span class='Delimiter'>; 
</span> 
        <a href="prepunion.c.html#LN1018"><span class='Ref_To_Local'>tlist</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1018"><span class='Ref_To_Local'>tlist</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN1024"><span class='Ref_To_Local'>tle</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN1012"><span class='Ref_to_Parameter'>flag</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Add a resjunk flag column */ 
</span>        <span class='Comment_Multi_Line'>/* flag value is the given constant */ 
</span>        <a href="prepunion.c.html#LN1025"><span class='Ref_To_Local'>expr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/makefuncs.h.html#LN49"><span class='Ref_to_Proto'>makeConst</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN24"><span class='Ref_to_Const'>INT4OID</span></a><span class='Delimiter'>, 
</span>                                  <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                  <a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, 
</span>                                  <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                  <a href="../../../include/postgres.h.html#LN484"><span class='Ref_to_Macro'>Int32GetDatum</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1012"><span class='Ref_to_Parameter'>flag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                  <span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                  <span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepunion.c.html#LN1024"><span class='Ref_To_Local'>tle</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/makefuncs.h.html#LN40"><span class='Ref_to_Proto'>makeTargetEntry</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepunion.c.html#LN1025"><span class='Ref_To_Local'>expr</span></a><span class='Delimiter'>, 
</span>                              <span class='Parentheses'>(</span><a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a><span class='Parentheses'>) </span><a href="prepunion.c.html#LN1019"><span class='Ref_To_Local'>resno</span></a><span class='Operator'>++</span><span class='Delimiter'>, 
</span>                              <a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><span class='String'>"flag"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepunion.c.html#LN1018"><span class='Ref_To_Local'>tlist</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1018"><span class='Ref_To_Local'>tlist</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN1024"><span class='Ref_To_Local'>tle</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="prepunion.c.html#LN1018"><span class='Ref_To_Local'>tlist</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end generate_setop_tlist &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Generate targetlist for a set-operation Append node 
 * 
 * colTypes: OID list of set-op's result column datatypes 
 * colCollations: OID list of set-op's result column collations 
 * flag: true to create a flag column copied up from subplans 
 * input_tlists: list of tlists for sub-plans of the Append 
 * refnames_tlist: targetlist to take column names from 
 * 
 * The entries in the Append's targetlist should always be simple Vars; 
 * we just have to make sure they have the right datatypes/typmods/collations. 
 * The Vars are always generated with varno 0. 
 * 
 * XXX a problem with the varno-zero approach is that set_pathtarget_cost_width 
 * cannot figure out a realistic width for the tlist we make here.  But we 
 * ought to refactor this code to produce a PathTarget directly, anyway. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN1156"></a><span class='Declare_Function'>generate_append_tlist</span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>colTypes</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>colCollations</span><span class='Delimiter'>, 
</span><a name="LN1157"></a>                      <span class='Keyword'>bool </span><span class='Declare_Parameter'>flag</span><span class='Delimiter'>, 
</span><a name="LN1158"></a>                      <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>input_tlists</span><span class='Delimiter'>, 
</span><a name="LN1159"></a>                      <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>refnames_tlist</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1161"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>tlist</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN1162"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>resno</span> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span><a name="LN1163"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>curColType</span><span class='Delimiter'>; 
</span><a name="LN1164"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>curColCollation</span><span class='Delimiter'>; 
</span><a name="LN1165"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>ref_tl_item</span><span class='Delimiter'>; 
</span><a name="LN1166"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>colindex</span><span class='Delimiter'>; 
</span><a name="LN1167"></a>    <a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tle</span><span class='Delimiter'>; 
</span><a name="LN1168"></a>    <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>expr</span><span class='Delimiter'>; 
</span><a name="LN1169"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>tlistl</span><span class='Delimiter'>; 
</span><a name="LN1170"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>colTypmods</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * First extract typmods to use. 
     * 
     * If the inputs all agree on type and typmod of a particular column, use 
     * that typmod; else use -1. 
     */ 
</span>    <a href="prepunion.c.html#LN1170"><span class='Ref_To_Local'>colTypmods</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1156"><span class='Ref_to_Parameter'>colTypes</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1169"><span class='Ref_To_Local'>tlistl</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN1158"><span class='Ref_to_Parameter'>input_tlists</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1182"></a>        <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>subtlist</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1169"><span class='Ref_To_Local'>tlistl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1183"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>subtlistl</span><span class='Delimiter'>; 
</span> 
        <a href="prepunion.c.html#LN1163"><span class='Ref_To_Local'>curColType</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN75"><span class='Ref_to_Func'>list_head</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1156"><span class='Ref_to_Parameter'>colTypes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepunion.c.html#LN1166"><span class='Ref_To_Local'>colindex</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1183"><span class='Ref_To_Local'>subtlistl</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN1182"><span class='Ref_To_Local'>subtlist</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1189"></a>            <a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>subtle</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1183"><span class='Ref_To_Local'>subtlistl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN1189"><span class='Ref_To_Local'>subtle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1373"><span class='Ref_to_Member'>resjunk</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1163"><span class='Ref_To_Local'>curColType</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodeFuncs.h.html#LN31"><span class='Ref_to_Proto'>exprType</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepunion.c.html#LN1189"><span class='Ref_To_Local'>subtle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>)</span> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1163"><span class='Ref_To_Local'>curColType</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* If first subplan, copy the typmod; else compare */ 
</span><a name="LN1197"></a>                <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>subtypmod</span> <span class='Operator'>= </span><a href="../../../include/nodes/nodeFuncs.h.html#LN32"><span class='Ref_to_Proto'>exprTypmod</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepunion.c.html#LN1189"><span class='Ref_To_Local'>subtle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN1169"><span class='Ref_To_Local'>tlistl</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN75"><span class='Ref_to_Func'>list_head</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1158"><span class='Ref_to_Parameter'>input_tlists</span></a><span class='Parentheses'>))</span> 
                    <a href="prepunion.c.html#LN1170"><span class='Ref_To_Local'>colTypmods</span></a><span class='Delimiter'>[</span><a href="prepunion.c.html#LN1166"><span class='Ref_To_Local'>colindex</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="prepunion.c.html#LN1197"><span class='Ref_To_Local'>subtypmod</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN1197"><span class='Ref_To_Local'>subtypmod</span></a> <span class='Operator'>!= </span><a href="prepunion.c.html#LN1170"><span class='Ref_To_Local'>colTypmods</span></a><span class='Delimiter'>[</span><a href="prepunion.c.html#LN1166"><span class='Ref_To_Local'>colindex</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>                    <a href="prepunion.c.html#LN1170"><span class='Ref_To_Local'>colTypmods</span></a><span class='Delimiter'>[</span><a href="prepunion.c.html#LN1166"><span class='Ref_To_Local'>colindex</span></a><span class='Delimiter'>] </span><span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* types disagree, so force typmod to -1 */ 
</span>                <a href="prepunion.c.html#LN1170"><span class='Ref_To_Local'>colTypmods</span></a><span class='Delimiter'>[</span><a href="prepunion.c.html#LN1166"><span class='Ref_To_Local'>colindex</span></a><span class='Delimiter'>] </span><span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="prepunion.c.html#LN1163"><span class='Ref_To_Local'>curColType</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1163"><span class='Ref_To_Local'>curColType</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="prepunion.c.html#LN1166"><span class='Ref_To_Local'>colindex</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1163"><span class='Ref_To_Local'>curColType</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now we can build the tlist for the Append. 
     */ 
</span>    <a href="prepunion.c.html#LN1166"><span class='Ref_To_Local'>colindex</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN202"><span class='Ref_to_Macro'>forthree</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1163"><span class='Ref_To_Local'>curColType</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN1156"><span class='Ref_to_Parameter'>colTypes</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN1164"><span class='Ref_To_Local'>curColCollation</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN1156"><span class='Ref_to_Parameter'>colCollations</span></a><span class='Delimiter'>, 
</span>             <a href="prepunion.c.html#LN1165"><span class='Ref_To_Local'>ref_tl_item</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN1159"><span class='Ref_to_Parameter'>refnames_tlist</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1222"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>colType</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1163"><span class='Ref_To_Local'>curColType</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1223"></a>        <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>colTypmod</span> <span class='Operator'>= </span><a href="prepunion.c.html#LN1170"><span class='Ref_To_Local'>colTypmods</span></a><span class='Delimiter'>[</span><a href="prepunion.c.html#LN1166"><span class='Ref_To_Local'>colindex</span></a><span class='Operator'>++</span><span class='Delimiter'>]; 
</span><a name="LN1224"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>colColl</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1164"><span class='Ref_To_Local'>curColCollation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1225"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>reftle</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1165"><span class='Ref_To_Local'>ref_tl_item</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1225"><span class='Ref_To_Local'>reftle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1367"><span class='Ref_to_Member'>resno</span></a> <span class='Operator'>== </span><a href="prepunion.c.html#LN1162"><span class='Ref_To_Local'>resno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="prepunion.c.html#LN1225"><span class='Ref_To_Local'>reftle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1373"><span class='Ref_to_Member'>resjunk</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepunion.c.html#LN1168"><span class='Ref_To_Local'>expr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/makefuncs.h.html#LN25"><span class='Ref_to_Proto'>makeVar</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                <a href="prepunion.c.html#LN1162"><span class='Ref_To_Local'>resno</span></a><span class='Delimiter'>, 
</span>                                <a href="prepunion.c.html#LN1222"><span class='Ref_To_Local'>colType</span></a><span class='Delimiter'>, 
</span>                                <a href="prepunion.c.html#LN1223"><span class='Ref_To_Local'>colTypmod</span></a><span class='Delimiter'>, 
</span>                                <a href="prepunion.c.html#LN1224"><span class='Ref_To_Local'>colColl</span></a><span class='Delimiter'>, 
</span>                                <span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepunion.c.html#LN1167"><span class='Ref_To_Local'>tle</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/makefuncs.h.html#LN40"><span class='Ref_to_Proto'>makeTargetEntry</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepunion.c.html#LN1168"><span class='Ref_To_Local'>expr</span></a><span class='Delimiter'>, 
</span>                              <span class='Parentheses'>(</span><a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a><span class='Parentheses'>) </span><a href="prepunion.c.html#LN1162"><span class='Ref_To_Local'>resno</span></a><span class='Operator'>++</span><span class='Delimiter'>, 
</span>                              <a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1225"><span class='Ref_To_Local'>reftle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1368"><span class='Ref_to_Member'>resname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * By convention, all non-resjunk columns in a setop tree have 
         * ressortgroupref equal to their resno.  In some cases the ref isn't 
         * needed, but this is a cleaner way than modifying the tlist later. 
         */ 
</span>        <a href="prepunion.c.html#LN1167"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1369"><span class='Ref_to_Member'>ressortgroupref</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN1167"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1367"><span class='Ref_to_Member'>resno</span></a><span class='Delimiter'>; 
</span> 
        <a href="prepunion.c.html#LN1161"><span class='Ref_To_Local'>tlist</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1161"><span class='Ref_To_Local'>tlist</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN1167"><span class='Ref_To_Local'>tle</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN1157"><span class='Ref_to_Parameter'>flag</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Add a resjunk flag column */ 
</span>        <span class='Comment_Multi_Line'>/* flag value is shown as copied up from subplan */ 
</span>        <a href="prepunion.c.html#LN1168"><span class='Ref_To_Local'>expr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/makefuncs.h.html#LN25"><span class='Ref_to_Proto'>makeVar</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                <a href="prepunion.c.html#LN1162"><span class='Ref_To_Local'>resno</span></a><span class='Delimiter'>, 
</span>                                <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN24"><span class='Ref_to_Const'>INT4OID</span></a><span class='Delimiter'>, 
</span>                                <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                <a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, 
</span>                                <span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepunion.c.html#LN1167"><span class='Ref_To_Local'>tle</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/makefuncs.h.html#LN40"><span class='Ref_to_Proto'>makeTargetEntry</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepunion.c.html#LN1168"><span class='Ref_To_Local'>expr</span></a><span class='Delimiter'>, 
</span>                              <span class='Parentheses'>(</span><a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a><span class='Parentheses'>) </span><a href="prepunion.c.html#LN1162"><span class='Ref_To_Local'>resno</span></a><span class='Operator'>++</span><span class='Delimiter'>, 
</span>                              <a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><span class='String'>"flag"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepunion.c.html#LN1161"><span class='Ref_To_Local'>tlist</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1161"><span class='Ref_To_Local'>tlist</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN1167"><span class='Ref_To_Local'>tle</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1170"><span class='Ref_To_Local'>colTypmods</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="prepunion.c.html#LN1161"><span class='Ref_To_Local'>tlist</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end generate_append_tlist &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * generate_setop_grouplist 
 *      Build a SortGroupClause list defining the sort/grouping properties 
 *      of the setop's output columns. 
 * 
 * Parse analysis already determined the properties and built a suitable 
 * list, except that the entries do not have sortgrouprefs set because 
 * the parser output representation doesn't include a tlist for each 
 * setop.  So what we need to do here is copy that list and install 
 * proper sortgrouprefs into it (copying those from the targetlist). 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN1284"></a><span class='Declare_Function'>generate_setop_grouplist</span><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN1545"><span class='Ref_to_Struct'>SetOperationStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>op</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>targetlist</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1286"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>grouplist</span> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1284"><span class='Ref_to_Parameter'>op</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1558"><span class='Ref_to_Member'>groupClauses</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1287"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lg</span><span class='Delimiter'>; 
</span><a name="LN1288"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lt</span><span class='Delimiter'>; 
</span> 
    <a href="prepunion.c.html#LN1287"><span class='Ref_To_Local'>lg</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN75"><span class='Ref_to_Func'>list_head</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1286"><span class='Ref_To_Local'>grouplist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1288"><span class='Ref_To_Local'>lt</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN1284"><span class='Ref_to_Parameter'>targetlist</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1293"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tle</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1288"><span class='Ref_To_Local'>lt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1294"></a>        <a href="../../../include/nodes/parsenodes.h.html#LN1161"><span class='Ref_to_Struct'>SortGroupClause</span></a> <span class='Operator'>*</span><span class='Declare_Local'>sgc</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN1293"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1373"><span class='Ref_to_Member'>resjunk</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* resjunk columns should not have sortgrouprefs */ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1293"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1369"><span class='Ref_to_Member'>ressortgroupref</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* ignore resjunk columns */ 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* non-resjunk columns should have sortgroupref = resno */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1293"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1369"><span class='Ref_to_Member'>ressortgroupref</span></a> <span class='Operator'>== </span><a href="prepunion.c.html#LN1293"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1367"><span class='Ref_to_Member'>resno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* non-resjunk columns should have grouping clauses */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1287"><span class='Ref_To_Local'>lg</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepunion.c.html#LN1294"><span class='Ref_To_Local'>sgc</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN1161"><span class='Ref_to_Struct'>SortGroupClause</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1287"><span class='Ref_To_Local'>lg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepunion.c.html#LN1287"><span class='Ref_To_Local'>lg</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1287"><span class='Ref_To_Local'>lg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1294"><span class='Ref_To_Local'>sgc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1164"><span class='Ref_to_Member'>tleSortGroupRef</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="prepunion.c.html#LN1294"><span class='Ref_To_Local'>sgc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1164"><span class='Ref_to_Member'>tleSortGroupRef</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN1293"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1369"><span class='Ref_to_Member'>ressortgroupref</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1287"><span class='Ref_To_Local'>lg</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="prepunion.c.html#LN1286"><span class='Ref_To_Local'>grouplist</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end generate_setop_grouplist &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * expand_inherited_tables 
 *      Expand each rangetable entry that represents an inheritance set 
 *      into an "append relation".  At the conclusion of this process, 
 *      the "inh" flag is set in all and only those RTEs that are append 
 *      relation parents. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1327"></a><span class='Declare_Function'>expand_inherited_tables</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1329"></a>    <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a>       <span class='Declare_Local'>nrtes</span><span class='Delimiter'>; 
</span><a name="LN1330"></a>    <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a>       <span class='Declare_Local'>rti</span><span class='Delimiter'>; 
</span><a name="LN1331"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>rl</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * expand_inherited_rtentry may add RTEs to parse-&GT;rtable; there is no 
     * need to scan them since they can't have inh=true.  So just scan as far 
     * as the original end of the rtable list. 
     */ 
</span>    <a href="prepunion.c.html#LN1329"><span class='Ref_To_Local'>nrtes</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1327"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN134"><span class='Ref_to_Member'>rtable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="prepunion.c.html#LN1331"><span class='Ref_To_Local'>rl</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN75"><span class='Ref_to_Func'>list_head</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1327"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN134"><span class='Ref_to_Member'>rtable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN1330"><span class='Ref_To_Local'>rti</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="prepunion.c.html#LN1330"><span class='Ref_To_Local'>rti</span></a> <span class='Operator'>&LT;= </span><a href="prepunion.c.html#LN1329"><span class='Ref_To_Local'>nrtes</span></a><span class='Delimiter'>; </span><a href="prepunion.c.html#LN1330"><span class='Ref_To_Local'>rti</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1342"></a>        <a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rte</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1331"><span class='Ref_To_Local'>rl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="prepunion.c.html#LN99"><span class='Ref_to_Proto'>expand_inherited_rtentry</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1327"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN1342"><span class='Ref_To_Local'>rte</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN1330"><span class='Ref_To_Local'>rti</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepunion.c.html#LN1331"><span class='Ref_To_Local'>rl</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1331"><span class='Ref_To_Local'>rl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end expand_inherited_tables &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * expand_inherited_rtentry 
 *      Check whether a rangetable entry represents an inheritance set. 
 *      If so, add entries for all the child tables to the query's 
 *      rangetable, and build AppendRelInfo nodes for all the child tables 
 *      and add them to root-&GT;append_rel_list.  If not, clear the entry's 
 *      "inh" flag to prevent later code from looking for AppendRelInfos. 
 * 
 * Note that the original RTE is considered to represent the whole 
 * inheritance set.  The first of the generated RTEs is an RTE for the same 
 * table, but with inh = false, to represent the parent table in its role 
 * as a simple member of the inheritance set. 
 * 
 * A childless table is never considered to be an inheritance set; therefore 
 * a parent RTE must always have at least two associated AppendRelInfos. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1366"></a><span class='Declare_Function'>expand_inherited_rtentry</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rte</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>rti</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1368"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>parse</span> <span class='Operator'>= </span><a href="prepunion.c.html#LN1366"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Delimiter'>; 
</span><a name="LN1369"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>parentOID</span><span class='Delimiter'>; 
</span><a name="LN1370"></a>    <a href="../../../include/nodes/plannodes.h.html#LN1002"><span class='Ref_to_Struct'>PlanRowMark</span></a> <span class='Operator'>*</span><span class='Declare_Local'>oldrc</span><span class='Delimiter'>; 
</span><a name="LN1371"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>oldrelation</span><span class='Delimiter'>; 
</span><a name="LN1372"></a>    <a href="../../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a>    <span class='Declare_Local'>lockmode</span><span class='Delimiter'>; 
</span><a name="LN1373"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>inhOIDs</span><span class='Delimiter'>; 
</span><a name="LN1374"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>appinfos</span><span class='Delimiter'>; 
</span><a name="LN1375"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span><a name="LN1376"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>need_append</span><span class='Delimiter'>; 
</span><a name="LN1377"></a>    <a href="../../../include/nodes/relation.h.html#LN2023"><span class='Ref_to_Struct'>PartitionedChildRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pcinfo</span><span class='Delimiter'>; 
</span><a name="LN1378"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>partitioned_child_rels</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Does RT entry allow inheritance? */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="prepunion.c.html#LN1366"><span class='Ref_to_Parameter'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1025"><span class='Ref_to_Member'>inh</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Ignore any already-expanded UNION ALL nodes */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN1366"><span class='Ref_to_Parameter'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN936"><span class='Ref_to_Member'>rtekind</span></a> <span class='Operator'>!= </span><a href="../../../include/nodes/parsenodes.h.html#LN922"><span class='Ref_to_EnumConst'>RTE_RELATION</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1366"><span class='Ref_to_Parameter'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN936"><span class='Ref_to_Member'>rtekind</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/parsenodes.h.html#LN923"><span class='Ref_to_EnumConst'>RTE_SUBQUERY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Comment_Multi_Line'>/* Fast path for common case of childless table */ 
</span>    <a href="prepunion.c.html#LN1369"><span class='Ref_To_Local'>parentOID</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN1366"><span class='Ref_to_Parameter'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN947"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/catalog/pg_inherits_fn.h.html#LN22"><span class='Ref_to_Proto'>has_subclass</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1369"><span class='Ref_To_Local'>parentOID</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Clear flag before returning */ 
</span>        <a href="prepunion.c.html#LN1366"><span class='Ref_to_Parameter'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1025"><span class='Ref_to_Member'>inh</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The rewriter should already have obtained an appropriate lock on each 
     * relation named in the query.  However, for each child relation we add 
     * to the query, we must obtain an appropriate lock, because this will be 
     * the first use of those relations in the parse/rewrite/plan pipeline. 
     * 
     * If the parent relation is the query's result relation, then we need 
     * RowExclusiveLock.  Otherwise, if it's accessed FOR UPDATE/SHARE, we 
     * need RowShareLock; otherwise AccessShareLock.  We can't just grab 
     * AccessShareLock because then the executor would be trying to upgrade 
     * the lock, leading to possible deadlocks.  (This code should match the 
     * parser and rewriter.) 
     */ 
</span>    <a href="prepunion.c.html#LN1370"><span class='Ref_To_Local'>oldrc</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/prep.h.html#LN45"><span class='Ref_to_Proto'>get_plan_rowmark</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1366"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN255"><span class='Ref_to_Member'>rowMarks</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN1366"><span class='Ref_to_Parameter'>rti</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN1366"><span class='Ref_to_Parameter'>rti</span></a> <span class='Operator'>== </span><a href="prepunion.c.html#LN1368"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN119"><span class='Ref_to_Member'>resultRelation</span></a><span class='Parentheses'>) 
</span>        <a href="prepunion.c.html#LN1372"><span class='Ref_To_Local'>lockmode</span></a> <span class='Operator'>= </span><a href="../../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN1370"><span class='Ref_To_Local'>oldrc</span></a> <span class='Operator'>&& </span><a href="../../../include/nodes/plannodes.h.html#LN961"><span class='Ref_to_Macro'>RowMarkRequiresRowShareLock</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1370"><span class='Ref_To_Local'>oldrc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN1008"><span class='Ref_to_Member'>markType</span></a><span class='Parentheses'>))</span> 
        <a href="prepunion.c.html#LN1372"><span class='Ref_To_Local'>lockmode</span></a> <span class='Operator'>= </span><a href="../../../include/storage/lockdefs.h.html#LN36"><span class='Ref_to_Const'>RowShareLock</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="prepunion.c.html#LN1372"><span class='Ref_To_Local'>lockmode</span></a> <span class='Operator'>= </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Scan for all members of inheritance set, acquire needed locks */ 
</span>    <a href="prepunion.c.html#LN1373"><span class='Ref_To_Local'>inhOIDs</span></a> <span class='Operator'>= </span><a href="../../../include/catalog/pg_inherits_fn.h.html#LN20"><span class='Ref_to_Proto'>find_all_inheritors</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1369"><span class='Ref_To_Local'>parentOID</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN1372"><span class='Ref_To_Local'>lockmode</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check that there's at least one descendant, else treat as no-child 
     * case.  This could happen despite above has_subclass() check, if table 
     * once had a child but no longer does. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1373"><span class='Ref_To_Local'>inhOIDs</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>2</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Clear flag before returning */ 
</span>        <a href="prepunion.c.html#LN1366"><span class='Ref_to_Parameter'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1025"><span class='Ref_to_Member'>inh</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If parent relation is selected FOR UPDATE/SHARE, we need to mark its 
     * PlanRowMark as isParent = true, and generate a new PlanRowMark for each 
     * child. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN1370"><span class='Ref_To_Local'>oldrc</span></a><span class='Parentheses'>) 
</span>        <a href="prepunion.c.html#LN1370"><span class='Ref_To_Local'>oldrc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN1012"><span class='Ref_to_Member'>isParent</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Must open the parent relation to examine its tupdesc.  We need not lock 
     * it; we assume the rewriter already did. 
     */ 
</span>    <a href="prepunion.c.html#LN1371"><span class='Ref_To_Local'>oldrelation</span></a> <span class='Operator'>= </span><a href="../../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1369"><span class='Ref_To_Local'>parentOID</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Scan the inheritance set and expand it */ 
</span>    <a href="prepunion.c.html#LN1374"><span class='Ref_To_Local'>appinfos</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="prepunion.c.html#LN1376"><span class='Ref_To_Local'>need_append</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1375"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN1373"><span class='Ref_To_Local'>inhOIDs</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1453"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>childOID</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1375"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1454"></a>        <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>newrelation</span><span class='Delimiter'>; 
</span><a name="LN1455"></a>        <a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>childrte</span><span class='Delimiter'>; 
</span><a name="LN1456"></a>        <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a>       <span class='Declare_Local'>childRTindex</span><span class='Delimiter'>; 
</span><a name="LN1457"></a>        <a href="../../../include/nodes/relation.h.html#LN1964"><span class='Ref_to_Struct'>AppendRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>appinfo</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Open rel if needed; we already have required locks */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN1453"><span class='Ref_To_Local'>childOID</span></a> <span class='Operator'>!= </span><a href="prepunion.c.html#LN1369"><span class='Ref_To_Local'>parentOID</span></a><span class='Parentheses'>) 
</span>            <a href="prepunion.c.html#LN1454"><span class='Ref_To_Local'>newrelation</span></a> <span class='Operator'>= </span><a href="../../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1453"><span class='Ref_To_Local'>childOID</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="prepunion.c.html#LN1454"><span class='Ref_To_Local'>newrelation</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN1371"><span class='Ref_To_Local'>oldrelation</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * It is possible that the parent table has children that are temp 
         * tables of other backends.  We cannot safely access such tables 
         * (because of buffering issues), and the best thing to do seems to be 
         * to silently ignore them. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN1453"><span class='Ref_To_Local'>childOID</span></a> <span class='Operator'>!= </span><a href="prepunion.c.html#LN1369"><span class='Ref_To_Local'>parentOID</span></a> <span class='Operator'>&& </span><a href="../../../include/utils/rel.h.html#LN533"><span class='Ref_to_Macro'>RELATION_IS_OTHER_TEMP</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1454"><span class='Ref_To_Local'>newrelation</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1454"><span class='Ref_To_Local'>newrelation</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN1372"><span class='Ref_To_Local'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Build an RTE for the child, and attach to query's rangetable list. 
         * We copy most fields of the parent's RTE, but replace relation OID 
         * and relkind, and set inh = false.  Also, set requiredPerms to zero 
         * since all required permissions checks are done on the original RTE. 
         * Likewise, set the child's securityQuals to empty, because we only 
         * want to apply the parent's RLS conditions regardless of what RLS 
         * properties individual children may have.  (This is an intentional 
         * choice to make inherited RLS work like regular permissions checks.) 
         * The parent securityQuals will be propagated to children along with 
         * other base restriction clauses, so we don't need to do it here. 
         */ 
</span>        <a href="prepunion.c.html#LN1455"><span class='Ref_To_Local'>childrte</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1366"><span class='Ref_to_Parameter'>rte</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepunion.c.html#LN1455"><span class='Ref_To_Local'>childrte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN947"><span class='Ref_to_Member'>relid</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN1453"><span class='Ref_To_Local'>childOID</span></a><span class='Delimiter'>; 
</span>        <a href="prepunion.c.html#LN1455"><span class='Ref_To_Local'>childrte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN948"><span class='Ref_to_Member'>relkind</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN1454"><span class='Ref_To_Local'>newrelation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind<span class='Delimiter'>; 
</span>        <a href="prepunion.c.html#LN1455"><span class='Ref_To_Local'>childrte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1025"><span class='Ref_to_Member'>inh</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="prepunion.c.html#LN1455"><span class='Ref_To_Local'>childrte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1027"><span class='Ref_to_Member'>requiredPerms</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="prepunion.c.html#LN1455"><span class='Ref_To_Local'>childrte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1032"><span class='Ref_to_Member'>securityQuals</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>        <a href="prepunion.c.html#LN1368"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN134"><span class='Ref_to_Member'>rtable</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1368"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN134"><span class='Ref_to_Member'>rtable</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN1455"><span class='Ref_To_Local'>childrte</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepunion.c.html#LN1456"><span class='Ref_To_Local'>childRTindex</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1368"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN134"><span class='Ref_to_Member'>rtable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Build an AppendRelInfo for this parent and child, unless the child 
         * is a partitioned table. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN1455"><span class='Ref_To_Local'>childrte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN948"><span class='Ref_to_Member'>relkind</span></a> <span class='Operator'>!= </span><a href="../../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="prepunion.c.html#LN1376"><span class='Ref_To_Local'>need_append</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="prepunion.c.html#LN1457"><span class='Ref_To_Local'>appinfo</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1964"><span class='Ref_to_Struct'>AppendRelInfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="prepunion.c.html#LN1457"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1974"><span class='Ref_to_Member'>parent_relid</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN1366"><span class='Ref_to_Parameter'>rti</span></a><span class='Delimiter'>; 
</span>            <a href="prepunion.c.html#LN1457"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1975"><span class='Ref_to_Member'>child_relid</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN1456"><span class='Ref_To_Local'>childRTindex</span></a><span class='Delimiter'>; 
</span>            <a href="prepunion.c.html#LN1457"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1983"><span class='Ref_to_Member'>parent_reltype</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN1371"><span class='Ref_To_Local'>oldrelation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>reltype<span class='Delimiter'>; 
</span>            <a href="prepunion.c.html#LN1457"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1984"><span class='Ref_to_Member'>child_reltype</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN1454"><span class='Ref_To_Local'>newrelation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>reltype<span class='Delimiter'>; 
</span>            <a href="prepunion.c.html#LN101"><span class='Ref_to_Proto'>make_inh_translation_list</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1371"><span class='Ref_To_Local'>oldrelation</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN1454"><span class='Ref_To_Local'>newrelation</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN1456"><span class='Ref_To_Local'>childRTindex</span></a><span class='Delimiter'>, 
</span>                                      <span class='Operator'>&</span><a href="prepunion.c.html#LN1457"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN2002"><span class='Ref_to_Member'>translated_vars</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="prepunion.c.html#LN1457"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN2009"><span class='Ref_to_Member'>parent_reloid</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN1369"><span class='Ref_To_Local'>parentOID</span></a><span class='Delimiter'>; 
</span>            <a href="prepunion.c.html#LN1374"><span class='Ref_To_Local'>appinfos</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1374"><span class='Ref_To_Local'>appinfos</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN1457"><span class='Ref_To_Local'>appinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Translate the column permissions bitmaps to the child's attnums 
             * (we have to build the translated_vars list before we can do 
             * this). But if this is the parent table, leave copyObject's 
             * result alone. 
             * 
             * Note: we need to do this even though the executor won't run any 
             * permissions checks on the child RTE.  The 
             * insertedCols/updatedCols bitmaps may be examined for 
             * trigger-firing purposes. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN1453"><span class='Ref_To_Local'>childOID</span></a> <span class='Operator'>!= </span><a href="prepunion.c.html#LN1369"><span class='Ref_To_Local'>parentOID</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="prepunion.c.html#LN1455"><span class='Ref_To_Local'>childrte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1029"><span class='Ref_to_Member'>selectedCols</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN105"><span class='Ref_to_Proto'>translate_col_privs</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1366"><span class='Ref_to_Parameter'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1029"><span class='Ref_to_Member'>selectedCols</span></a><span class='Delimiter'>, 
</span>                                                   <a href="prepunion.c.html#LN1457"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN2002"><span class='Ref_to_Member'>translated_vars</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="prepunion.c.html#LN1455"><span class='Ref_To_Local'>childrte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1030"><span class='Ref_to_Member'>insertedCols</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN105"><span class='Ref_to_Proto'>translate_col_privs</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1366"><span class='Ref_to_Parameter'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1030"><span class='Ref_to_Member'>insertedCols</span></a><span class='Delimiter'>, 
</span>                                                   <a href="prepunion.c.html#LN1457"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN2002"><span class='Ref_to_Member'>translated_vars</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="prepunion.c.html#LN1455"><span class='Ref_To_Local'>childrte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1031"><span class='Ref_to_Member'>updatedCols</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN105"><span class='Ref_to_Proto'>translate_col_privs</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1366"><span class='Ref_to_Parameter'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1031"><span class='Ref_to_Member'>updatedCols</span></a><span class='Delimiter'>, 
</span>                                                   <a href="prepunion.c.html#LN1457"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN2002"><span class='Ref_to_Member'>translated_vars</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if childrte-&GT;relkind!=RE... &raquo; </span> 
        <span class='Control'>else</span> 
            <a href="prepunion.c.html#LN1378"><span class='Ref_To_Local'>partitioned_child_rels</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN144"><span class='Ref_to_Func'>lappend_int</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1378"><span class='Ref_To_Local'>partitioned_child_rels</span></a><span class='Delimiter'>, 
</span>                                                 <a href="prepunion.c.html#LN1456"><span class='Ref_To_Local'>childRTindex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Build a PlanRowMark if parent is marked FOR UPDATE/SHARE. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN1370"><span class='Ref_To_Local'>oldrc</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1545"></a>            <a href="../../../include/nodes/plannodes.h.html#LN1002"><span class='Ref_to_Struct'>PlanRowMark</span></a> <span class='Operator'>*</span><span class='Declare_Local'>newrc</span> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN1002"><span class='Ref_to_Struct'>PlanRowMark</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="prepunion.c.html#LN1545"><span class='Ref_To_Local'>newrc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN1005"><span class='Ref_to_Member'>rti</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN1456"><span class='Ref_To_Local'>childRTindex</span></a><span class='Delimiter'>; 
</span>            <a href="prepunion.c.html#LN1545"><span class='Ref_To_Local'>newrc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN1006"><span class='Ref_to_Member'>prti</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN1366"><span class='Ref_to_Parameter'>rti</span></a><span class='Delimiter'>; 
</span>            <a href="prepunion.c.html#LN1545"><span class='Ref_To_Local'>newrc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN1007"><span class='Ref_to_Member'>rowmarkId</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN1370"><span class='Ref_To_Local'>oldrc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN1007"><span class='Ref_to_Member'>rowmarkId</span></a><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Reselect rowmark type, because relkind might not match parent */ 
</span>            <a href="prepunion.c.html#LN1545"><span class='Ref_To_Local'>newrc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN1008"><span class='Ref_to_Member'>markType</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/planner.h.html#LN45"><span class='Ref_to_Proto'>select_rowmark_type</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1455"><span class='Ref_To_Local'>childrte</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN1370"><span class='Ref_To_Local'>oldrc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN1010"><span class='Ref_to_Member'>strength</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="prepunion.c.html#LN1545"><span class='Ref_To_Local'>newrc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN1009"><span class='Ref_to_Member'>allMarkTypes</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><a href="prepunion.c.html#LN1545"><span class='Ref_To_Local'>newrc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN1008"><span class='Ref_to_Member'>markType</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="prepunion.c.html#LN1545"><span class='Ref_To_Local'>newrc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN1010"><span class='Ref_to_Member'>strength</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN1370"><span class='Ref_To_Local'>oldrc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN1010"><span class='Ref_to_Member'>strength</span></a><span class='Delimiter'>; 
</span>            <a href="prepunion.c.html#LN1545"><span class='Ref_To_Local'>newrc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN1011"><span class='Ref_to_Member'>waitPolicy</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN1370"><span class='Ref_To_Local'>oldrc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN1011"><span class='Ref_to_Member'>waitPolicy</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * We mark RowMarks for partitioned child tables as parent 
             * RowMarks so that the executor ignores them (except their 
             * existence means that the child tables be locked using 
             * appropriate mode). 
             */ 
</span>            <a href="prepunion.c.html#LN1545"><span class='Ref_To_Local'>newrc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN1012"><span class='Ref_to_Member'>isParent</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1455"><span class='Ref_To_Local'>childrte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN948"><span class='Ref_to_Member'>relkind</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Include child's rowmark type in parent's allMarkTypes */ 
</span>            <a href="prepunion.c.html#LN1370"><span class='Ref_To_Local'>oldrc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN1009"><span class='Ref_to_Member'>allMarkTypes</span></a> <span class='Operator'>|= </span><a href="prepunion.c.html#LN1545"><span class='Ref_To_Local'>newrc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN1009"><span class='Ref_to_Member'>allMarkTypes</span></a><span class='Delimiter'>; 
</span> 
            <a href="prepunion.c.html#LN1366"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN255"><span class='Ref_to_Member'>rowMarks</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1366"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN255"><span class='Ref_to_Member'>rowMarks</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN1545"><span class='Ref_To_Local'>newrc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if oldrc &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* Close child relations, but keep locks */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN1453"><span class='Ref_To_Local'>childOID</span></a> <span class='Operator'>!= </span><a href="prepunion.c.html#LN1369"><span class='Ref_To_Local'>parentOID</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1454"><span class='Ref_To_Local'>newrelation</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1371"><span class='Ref_To_Local'>oldrelation</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If all the children were temp tables or a partitioned parent did not 
     * have any leaf partitions, pretend it's a non-inheritance situation; we 
     * don't need Append node in that case.  The duplicate RTE we added for 
     * the parent table is harmless, so we don't bother to get rid of it; 
     * ditto for the useless PlanRowMark node. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="prepunion.c.html#LN1376"><span class='Ref_To_Local'>need_append</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Clear flag before returning */ 
</span>        <a href="prepunion.c.html#LN1366"><span class='Ref_to_Parameter'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1025"><span class='Ref_to_Member'>inh</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We keep a list of objects in root, each of which maps a partitioned 
     * parent RT index to the list of RT indexes of its partitioned child 
     * tables.  When creating an Append or a ModifyTable path for the parent, 
     * we copy the child RT index list verbatim to the path so that it could 
     * be carried over to the executor so that the latter could identify the 
     * partitioned child tables. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN1378"><span class='Ref_To_Local'>partitioned_child_rels</span></a> <span class='Operator'>!= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="prepunion.c.html#LN1377"><span class='Ref_To_Local'>pcinfo</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN2023"><span class='Ref_to_Struct'>PartitionedChildRelInfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1366"><span class='Ref_to_Parameter'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN948"><span class='Ref_to_Member'>relkind</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepunion.c.html#LN1377"><span class='Ref_To_Local'>pcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN2027"><span class='Ref_to_Member'>parent_relid</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN1366"><span class='Ref_to_Parameter'>rti</span></a><span class='Delimiter'>; 
</span>        <a href="prepunion.c.html#LN1377"><span class='Ref_To_Local'>pcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN2028"><span class='Ref_to_Member'>child_rels</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN1378"><span class='Ref_To_Local'>partitioned_child_rels</span></a><span class='Delimiter'>; 
</span>        <a href="prepunion.c.html#LN1366"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN253"><span class='Ref_to_Member'>pcinfo_list</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1366"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN253"><span class='Ref_to_Member'>pcinfo_list</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN1377"><span class='Ref_To_Local'>pcinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Otherwise, OK to add to root-&GT;append_rel_list */ 
</span>    <a href="prepunion.c.html#LN1366"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN251"><span class='Ref_to_Member'>append_rel_list</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1366"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN251"><span class='Ref_to_Member'>append_rel_list</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN1374"><span class='Ref_To_Local'>appinfos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end expand_inherited_rtentry &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * make_inh_translation_list 
 *    Build the list of translations from parent Vars to child Vars for 
 *    an inheritance child. 
 * 
 * For paranoia's sake, we match type/collation as well as attribute name. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1621"></a><span class='Declare_Function'>make_inh_translation_list</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>oldrelation</span><span class='Delimiter'>, </span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>newrelation</span><span class='Delimiter'>, 
</span><a name="LN1622"></a>                          <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>newvarno</span><span class='Delimiter'>, 
</span><a name="LN1623"></a>                          <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>translated_vars</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1625"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>vars</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN1626"></a>    <a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>old_tupdesc</span> <span class='Operator'>= </span><a href="../../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1621"><span class='Ref_to_Parameter'>oldrelation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1627"></a>    <a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>new_tupdesc</span> <span class='Operator'>= </span><a href="../../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1621"><span class='Ref_to_Parameter'>newrelation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1628"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>oldnatts</span> <span class='Operator'>= </span><a href="prepunion.c.html#LN1626"><span class='Ref_To_Local'>old_tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; 
</span><a name="LN1629"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>newnatts</span> <span class='Operator'>= </span><a href="prepunion.c.html#LN1627"><span class='Ref_To_Local'>new_tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; 
</span><a name="LN1630"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>old_attno</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN1630"><span class='Ref_To_Local'>old_attno</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="prepunion.c.html#LN1630"><span class='Ref_To_Local'>old_attno</span></a> <span class='Operator'>&LT; </span><a href="prepunion.c.html#LN1628"><span class='Ref_To_Local'>oldnatts</span></a><span class='Delimiter'>; </span><a href="prepunion.c.html#LN1630"><span class='Ref_To_Local'>old_attno</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1634"></a>        <a href="../../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>att</span><span class='Delimiter'>; 
</span><a name="LN1635"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>attname</span><span class='Delimiter'>; 
</span><a name="LN1636"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>atttypid</span><span class='Delimiter'>; 
</span><a name="LN1637"></a>        <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>atttypmod</span><span class='Delimiter'>; 
</span><a name="LN1638"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>attcollation</span><span class='Delimiter'>; 
</span><a name="LN1639"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>new_attno</span><span class='Delimiter'>; 
</span> 
        <a href="prepunion.c.html#LN1634"><span class='Ref_To_Local'>att</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN1626"><span class='Ref_To_Local'>old_tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="prepunion.c.html#LN1630"><span class='Ref_To_Local'>old_attno</span></a><span class='Delimiter'>]; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN1634"><span class='Ref_To_Local'>att</span></a><span class='Operator'>-&GT;</span>attisdropped<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Just put NULL into this list entry */ 
</span>            <a href="prepunion.c.html#LN1625"><span class='Ref_To_Local'>vars</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1625"><span class='Ref_To_Local'>vars</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="prepunion.c.html#LN1635"><span class='Ref_To_Local'>attname</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1634"><span class='Ref_To_Local'>att</span></a><span class='Operator'>-&GT;</span>attname<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepunion.c.html#LN1636"><span class='Ref_To_Local'>atttypid</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN1634"><span class='Ref_To_Local'>att</span></a><span class='Operator'>-&GT;</span>atttypid<span class='Delimiter'>; 
</span>        <a href="prepunion.c.html#LN1637"><span class='Ref_To_Local'>atttypmod</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN1634"><span class='Ref_To_Local'>att</span></a><span class='Operator'>-&GT;</span>atttypmod<span class='Delimiter'>; 
</span>        <a href="prepunion.c.html#LN1638"><span class='Ref_To_Local'>attcollation</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN1634"><span class='Ref_To_Local'>att</span></a><span class='Operator'>-&GT;</span>attcollation<span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * When we are generating the "translation list" for the parent table 
         * of an inheritance set, no need to search for matches. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN1621"><span class='Ref_to_Parameter'>oldrelation</span></a> <span class='Operator'>== </span><a href="prepunion.c.html#LN1621"><span class='Ref_to_Parameter'>newrelation</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="prepunion.c.html#LN1625"><span class='Ref_To_Local'>vars</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1625"><span class='Ref_To_Local'>vars</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/makefuncs.h.html#LN25"><span class='Ref_to_Proto'>makeVar</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1622"><span class='Ref_to_Parameter'>newvarno</span></a><span class='Delimiter'>, 
</span>                                         <span class='Parentheses'>(</span><a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a><span class='Parentheses'>) (</span><a href="prepunion.c.html#LN1630"><span class='Ref_To_Local'>old_attno</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                         <a href="prepunion.c.html#LN1636"><span class='Ref_To_Local'>atttypid</span></a><span class='Delimiter'>, 
</span>                                         <a href="prepunion.c.html#LN1637"><span class='Ref_To_Local'>atttypmod</span></a><span class='Delimiter'>, 
</span>                                         <a href="prepunion.c.html#LN1638"><span class='Ref_To_Local'>attcollation</span></a><span class='Delimiter'>, 
</span>                                         <span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Otherwise we have to search for the matching column by name. 
         * There's no guarantee it'll have the same column position, because 
         * of cases like ALTER TABLE ADD COLUMN and multiple inheritance. 
         * However, in simple cases it will be the same column number, so try 
         * that before we go groveling through all the columns. 
         * 
         * Note: the test for (att = ...) != NULL cannot fail, it's just a 
         * notational device to include the assignment into the if-clause. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN1630"><span class='Ref_To_Local'>old_attno</span></a> <span class='Operator'>&LT; </span><a href="prepunion.c.html#LN1629"><span class='Ref_To_Local'>newnatts</span></a> <span class='Operator'>&& 
</span>            <span class='Parentheses'>(</span><a href="prepunion.c.html#LN1634"><span class='Ref_To_Local'>att</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN1627"><span class='Ref_To_Local'>new_tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="prepunion.c.html#LN1630"><span class='Ref_To_Local'>old_attno</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>            <span class='Operator'>!</span><a href="prepunion.c.html#LN1634"><span class='Ref_To_Local'>att</span></a><span class='Operator'>-&GT;</span>attisdropped <span class='Operator'>&& </span><a href="prepunion.c.html#LN1634"><span class='Ref_To_Local'>att</span></a><span class='Operator'>-&GT;</span>attinhcount <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>            strcmp<span class='Parentheses'>(</span><a href="prepunion.c.html#LN1635"><span class='Ref_To_Local'>attname</span></a><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1634"><span class='Ref_To_Local'>att</span></a><span class='Operator'>-&GT;</span>attname<span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="prepunion.c.html#LN1639"><span class='Ref_To_Local'>new_attno</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN1630"><span class='Ref_To_Local'>old_attno</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN1639"><span class='Ref_To_Local'>new_attno</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="prepunion.c.html#LN1639"><span class='Ref_To_Local'>new_attno</span></a> <span class='Operator'>&LT; </span><a href="prepunion.c.html#LN1629"><span class='Ref_To_Local'>newnatts</span></a><span class='Delimiter'>; </span><a href="prepunion.c.html#LN1639"><span class='Ref_To_Local'>new_attno</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="prepunion.c.html#LN1634"><span class='Ref_To_Local'>att</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN1627"><span class='Ref_To_Local'>new_tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="prepunion.c.html#LN1639"><span class='Ref_To_Local'>new_attno</span></a><span class='Delimiter'>]; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="prepunion.c.html#LN1634"><span class='Ref_To_Local'>att</span></a><span class='Operator'>-&GT;</span>attisdropped <span class='Operator'>&& </span><a href="prepunion.c.html#LN1634"><span class='Ref_To_Local'>att</span></a><span class='Operator'>-&GT;</span>attinhcount <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>                    strcmp<span class='Parentheses'>(</span><a href="prepunion.c.html#LN1635"><span class='Ref_To_Local'>attname</span></a><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1634"><span class='Ref_To_Local'>att</span></a><span class='Operator'>-&GT;</span>attname<span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN1639"><span class='Ref_To_Local'>new_attno</span></a> <span class='Operator'>&GT;= </span><a href="prepunion.c.html#LN1629"><span class='Ref_To_Local'>newnatts</span></a><span class='Parentheses'>) 
</span>                <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not find inherited attribute \"%s\" of relation \"%s\""</span><span class='Delimiter'>, 
</span>                     <a href="prepunion.c.html#LN1635"><span class='Ref_To_Local'>attname</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1621"><span class='Ref_to_Parameter'>newrelation</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Found it, check type and collation match */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN1636"><span class='Ref_To_Local'>atttypid</span></a> <span class='Operator'>!= </span><a href="prepunion.c.html#LN1634"><span class='Ref_To_Local'>att</span></a><span class='Operator'>-&GT;</span>atttypid <span class='Operator'>|| </span><a href="prepunion.c.html#LN1637"><span class='Ref_To_Local'>atttypmod</span></a> <span class='Operator'>!= </span><a href="prepunion.c.html#LN1634"><span class='Ref_To_Local'>att</span></a><span class='Operator'>-&GT;</span>atttypmod<span class='Parentheses'>) 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"attribute \"%s\" of relation \"%s\" does not match parent's type"</span><span class='Delimiter'>, 
</span>                 <a href="prepunion.c.html#LN1635"><span class='Ref_To_Local'>attname</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1621"><span class='Ref_to_Parameter'>newrelation</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN1638"><span class='Ref_To_Local'>attcollation</span></a> <span class='Operator'>!= </span><a href="prepunion.c.html#LN1634"><span class='Ref_To_Local'>att</span></a><span class='Operator'>-&GT;</span>attcollation<span class='Parentheses'>) 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"attribute \"%s\" of relation \"%s\" does not match parent's collation"</span><span class='Delimiter'>, 
</span>                 <a href="prepunion.c.html#LN1635"><span class='Ref_To_Local'>attname</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1621"><span class='Ref_to_Parameter'>newrelation</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="prepunion.c.html#LN1625"><span class='Ref_To_Local'>vars</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1625"><span class='Ref_To_Local'>vars</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/makefuncs.h.html#LN25"><span class='Ref_to_Proto'>makeVar</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1622"><span class='Ref_to_Parameter'>newvarno</span></a><span class='Delimiter'>, 
</span>                                     <span class='Parentheses'>(</span><a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a><span class='Parentheses'>) (</span><a href="prepunion.c.html#LN1639"><span class='Ref_To_Local'>new_attno</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                     <a href="prepunion.c.html#LN1636"><span class='Ref_To_Local'>atttypid</span></a><span class='Delimiter'>, 
</span>                                     <a href="prepunion.c.html#LN1637"><span class='Ref_To_Local'>atttypmod</span></a><span class='Delimiter'>, 
</span>                                     <a href="prepunion.c.html#LN1638"><span class='Ref_To_Local'>attcollation</span></a><span class='Delimiter'>, 
</span>                                     <span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for old_attno=0;old_attno... &raquo; </span> 
 
    <span class='Operator'>*</span><a href="prepunion.c.html#LN1623"><span class='Ref_to_Parameter'>translated_vars</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN1625"><span class='Ref_To_Local'>vars</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end make_inh_translation_list &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * translate_col_privs 
 *    Translate a bitmapset representing per-column privileges from the 
 *    parent rel's attribute numbering to the child's. 
 * 
 * The only surprise here is that we don't translate a parent whole-row 
 * reference into a child whole-row reference.  That would mean requiring 
 * permissions on all child columns, which is overly strict, since the 
 * query is really only going to reference the inherited columns.  Instead 
 * we set the per-column bits for all inherited columns. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a> <span class='Operator'>* 
</span><a name="LN1728"></a><span class='Declare_Function'>translate_col_privs</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>parent_privs</span><span class='Delimiter'>, 
</span><a name="LN1729"></a>                    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>translated_vars</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1731"></a>    <a href="../../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>child_privs</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1732"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>whole_row</span><span class='Delimiter'>; 
</span><a name="LN1733"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>attno</span><span class='Delimiter'>; 
</span><a name="LN1734"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* System attributes have the same numbers in all tables */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN1733"><span class='Ref_To_Local'>attno</span></a> <span class='Operator'>= </span><a href="../../../include/access/sysattr.h.html#LN27"><span class='Ref_to_Const'>FirstLowInvalidHeapAttributeNumber</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="prepunion.c.html#LN1733"><span class='Ref_To_Local'>attno</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="prepunion.c.html#LN1733"><span class='Ref_To_Local'>attno</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/bitmapset.h.html#LN75"><span class='Ref_to_Proto'>bms_is_member</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1733"><span class='Ref_To_Local'>attno</span></a> <span class='Operator'>- </span><a href="../../../include/access/sysattr.h.html#LN27"><span class='Ref_to_Const'>FirstLowInvalidHeapAttributeNumber</span></a><span class='Delimiter'>, 
</span>                          <a href="prepunion.c.html#LN1728"><span class='Ref_to_Parameter'>parent_privs</span></a><span class='Parentheses'>))</span> 
            <a href="prepunion.c.html#LN1731"><span class='Ref_To_Local'>child_privs</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN89"><span class='Ref_to_Proto'>bms_add_member</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1731"><span class='Ref_To_Local'>child_privs</span></a><span class='Delimiter'>, 
</span>                                 <a href="prepunion.c.html#LN1733"><span class='Ref_To_Local'>attno</span></a> <span class='Operator'>- </span><a href="../../../include/access/sysattr.h.html#LN27"><span class='Ref_to_Const'>FirstLowInvalidHeapAttributeNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Check if parent has whole-row reference */ 
</span>    <a href="prepunion.c.html#LN1732"><span class='Ref_To_Local'>whole_row</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN75"><span class='Ref_to_Proto'>bms_is_member</span></a><span class='Parentheses'>(</span><a href="../../../include/access/attnum.h.html#LN22"><span class='Ref_to_Const'>InvalidAttrNumber</span></a> <span class='Operator'>- </span><a href="../../../include/access/sysattr.h.html#LN27"><span class='Ref_to_Const'>FirstLowInvalidHeapAttributeNumber</span></a><span class='Delimiter'>, 
</span>                              <a href="prepunion.c.html#LN1728"><span class='Ref_to_Parameter'>parent_privs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* And now translate the regular user attributes, using the vars list */ 
</span>    <a href="prepunion.c.html#LN1733"><span class='Ref_To_Local'>attno</span></a> <span class='Operator'>= </span><a href="../../../include/access/attnum.h.html#LN22"><span class='Ref_to_Const'>InvalidAttrNumber</span></a><span class='Delimiter'>; 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1734"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN1729"><span class='Ref_to_Parameter'>translated_vars</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1753"></a>        <a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>var</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN108"><span class='Ref_to_Macro'>lfirst_node</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN1734"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="prepunion.c.html#LN1733"><span class='Ref_To_Local'>attno</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN1753"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span>        <span class='Comment_Single_Line'>/* ignore dropped columns */ 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN1732"><span class='Ref_To_Local'>whole_row</span></a> <span class='Operator'>|| 
</span>            <a href="../../../include/nodes/bitmapset.h.html#LN75"><span class='Ref_to_Proto'>bms_is_member</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1733"><span class='Ref_To_Local'>attno</span></a> <span class='Operator'>- </span><a href="../../../include/access/sysattr.h.html#LN27"><span class='Ref_to_Const'>FirstLowInvalidHeapAttributeNumber</span></a><span class='Delimiter'>, 
</span>                          <a href="prepunion.c.html#LN1728"><span class='Ref_to_Parameter'>parent_privs</span></a><span class='Parentheses'>))</span> 
            <a href="prepunion.c.html#LN1731"><span class='Ref_To_Local'>child_privs</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN89"><span class='Ref_to_Proto'>bms_add_member</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1731"><span class='Ref_To_Local'>child_privs</span></a><span class='Delimiter'>, 
</span>                         <a href="prepunion.c.html#LN1753"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN167"><span class='Ref_to_Member'>varattno</span></a> <span class='Operator'>- </span><a href="../../../include/access/sysattr.h.html#LN27"><span class='Ref_to_Const'>FirstLowInvalidHeapAttributeNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="prepunion.c.html#LN1731"><span class='Ref_To_Local'>child_privs</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end translate_col_privs &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * adjust_appendrel_attrs 
 *    Copy the specified query or expression and translate Vars referring 
 *    to the parent rel of the specified AppendRelInfo to refer to the 
 *    child rel instead.  We also update rtindexes appearing outside Vars, 
 *    such as resultRelation and jointree relids. 
 * 
 * Note: this is only applied after conversion of sublinks to subplans, 
 * so we don't need to cope with recursion into sub-queries. 
 * 
 * Note: this is not hugely different from what pullup_replace_vars() does; 
 * maybe we should try to fold the two routines together. 
 */ 
</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>* 
</span><a name="LN1782"></a><span class='Declare_Function'>adjust_appendrel_attrs</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN1964"><span class='Ref_to_Struct'>AppendRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>appinfo</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1784"></a>    <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN1785"></a>    <a href="prepunion.c.html#LN54"><span class='Ref_to_Typedef'>adjust_appendrel_attrs_context</span></a> <span class='Declare_Local'>context</span><span class='Delimiter'>; 
</span> 
    <a href="prepunion.c.html#LN1785"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="prepunion.c.html#LN56"><span class='Ref_to_Member'>root</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN1782"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>; 
</span>    <a href="prepunion.c.html#LN1785"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="prepunion.c.html#LN57"><span class='Ref_to_Member'>appinfo</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN1782"><span class='Ref_to_Parameter'>appinfo</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Must be prepared to start with a Query or a bare expression tree. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN1782"><span class='Ref_to_Parameter'>node</span></a> <span class='Operator'>&& </span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1782"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1795"></a>        <a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>newnode</span><span class='Delimiter'>; 
</span> 
        <a href="prepunion.c.html#LN1795"><span class='Ref_To_Local'>newnode</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodeFuncs.h.html#LN59"><span class='Ref_to_Proto'>query_tree_mutator</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepunion.c.html#LN1782"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, 
</span>                                     <a href="prepunion.c.html#LN107"><span class='Ref_to_Proto'>adjust_appendrel_attrs_mutator</span></a><span class='Delimiter'>, 
</span>                                     <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="prepunion.c.html#LN1785"><span class='Ref_To_Local'>context</span></a><span class='Delimiter'>, 
</span>                                     <a href="../../../include/nodes/nodeFuncs.h.html#LN21"><span class='Ref_to_Const'>QTW_IGNORE_RC_SUBQUERIES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN1795"><span class='Ref_To_Local'>newnode</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN119"><span class='Ref_to_Member'>resultRelation</span></a> <span class='Operator'>== </span><a href="prepunion.c.html#LN1782"><span class='Ref_to_Parameter'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1974"><span class='Ref_to_Member'>parent_relid</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="prepunion.c.html#LN1795"><span class='Ref_To_Local'>newnode</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN119"><span class='Ref_to_Member'>resultRelation</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN1782"><span class='Ref_to_Parameter'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1975"><span class='Ref_to_Member'>child_relid</span></a><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Fix tlist resnos too, if it's inherited UPDATE */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN1795"><span class='Ref_To_Local'>newnode</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN109"><span class='Ref_to_Member'>commandType</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/nodes.h.html#LN651"><span class='Ref_to_EnumConst'>CMD_UPDATE</span></a><span class='Parentheses'>) 
</span>                <a href="prepunion.c.html#LN1795"><span class='Ref_To_Local'>newnode</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN137"><span class='Ref_to_Member'>targetList</span></a> <span class='Operator'>= 
</span>                    <a href="prepunion.c.html#LN110"><span class='Ref_to_Proto'>adjust_inherited_tlist</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1795"><span class='Ref_To_Local'>newnode</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN137"><span class='Ref_to_Member'>targetList</span></a><span class='Delimiter'>, 
</span>                                           <a href="prepunion.c.html#LN1782"><span class='Ref_to_Parameter'>appinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="prepunion.c.html#LN1784"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepunion.c.html#LN1795"><span class='Ref_To_Local'>newnode</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="prepunion.c.html#LN1784"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN107"><span class='Ref_to_Proto'>adjust_appendrel_attrs_mutator</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1782"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="prepunion.c.html#LN1785"><span class='Ref_To_Local'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="prepunion.c.html#LN1784"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end adjust_appendrel_attrs &raquo; </span> 
 
<span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>* 
</span><a name="LN1819"></a><span class='Declare_Function'>adjust_appendrel_attrs_mutator</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, 
</span><a name="LN1820"></a>                               <a href="prepunion.c.html#LN54"><span class='Ref_to_Typedef'>adjust_appendrel_attrs_context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1822"></a>    <a href="../../../include/nodes/relation.h.html#LN1964"><span class='Ref_to_Struct'>AppendRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>appinfo</span> <span class='Operator'>= </span><a href="prepunion.c.html#LN1820"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="prepunion.c.html#LN57"><span class='Ref_to_Member'>appinfo</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN1819"><span class='Ref_to_Parameter'>node</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1819"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1828"></a>        <a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>var</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1819"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN1828"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN172"><span class='Ref_to_Member'>varlevelsup</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>            <a href="prepunion.c.html#LN1828"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN165"><span class='Ref_to_Member'>varno</span></a> <span class='Operator'>== </span><a href="prepunion.c.html#LN1822"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1974"><span class='Ref_to_Member'>parent_relid</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="prepunion.c.html#LN1828"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN165"><span class='Ref_to_Member'>varno</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN1822"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1975"><span class='Ref_to_Member'>child_relid</span></a><span class='Delimiter'>; 
</span>            <a href="prepunion.c.html#LN1828"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN175"><span class='Ref_to_Member'>varnoold</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN1822"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1975"><span class='Ref_to_Member'>child_relid</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN1828"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN167"><span class='Ref_to_Member'>varattno</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1837"></a>                <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>newnode</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN1828"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN167"><span class='Ref_to_Member'>varattno</span></a> <span class='Operator'>&GT; </span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1822"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN2002"><span class='Ref_to_Member'>translated_vars</span></a><span class='Parentheses'>))</span> 
                    <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"attribute %d of relation \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                         <a href="prepunion.c.html#LN1828"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN167"><span class='Ref_to_Member'>varattno</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/lsyscache.h.html#LN124"><span class='Ref_to_Proto'>get_rel_name</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1822"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN2009"><span class='Ref_to_Member'>parent_reloid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="prepunion.c.html#LN1837"><span class='Ref_To_Local'>newnode</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN223"><span class='Ref_to_Proto'>list_nth</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1822"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN2002"><span class='Ref_to_Member'>translated_vars</span></a><span class='Delimiter'>, 
</span>                                              <a href="prepunion.c.html#LN1828"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN167"><span class='Ref_to_Member'>varattno</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN1837"><span class='Ref_To_Local'>newnode</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"attribute %d of relation \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                         <a href="prepunion.c.html#LN1828"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN167"><span class='Ref_to_Member'>varattno</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/lsyscache.h.html#LN124"><span class='Ref_to_Proto'>get_rel_name</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1822"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN2009"><span class='Ref_to_Member'>parent_reloid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <a href="prepunion.c.html#LN1837"><span class='Ref_To_Local'>newnode</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN1828"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN167"><span class='Ref_to_Member'>varattno</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * Whole-row Var: if we are dealing with named rowtypes, we 
                 * can use a whole-row Var for the child table plus a coercion 
                 * step to convert the tuple layout to the parent's rowtype. 
                 * Otherwise we have to generate a RowExpr. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1822"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1984"><span class='Ref_to_Member'>child_reltype</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1828"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN169"><span class='Ref_to_Member'>vartype</span></a> <span class='Operator'>== </span><a href="prepunion.c.html#LN1822"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1983"><span class='Ref_to_Member'>parent_reltype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN1822"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1983"><span class='Ref_to_Member'>parent_reltype</span></a> <span class='Operator'>!= </span><a href="prepunion.c.html#LN1822"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1984"><span class='Ref_to_Member'>child_reltype</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span><a name="LN1862"></a>                        <a href="../../../include/nodes/primnodes.h.html#LN854"><span class='Ref_to_Struct'>ConvertRowtypeExpr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>r</span> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN854"><span class='Ref_to_Struct'>ConvertRowtypeExpr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                        <a href="prepunion.c.html#LN1862"><span class='Ref_To_Local'>r</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN857"><span class='Ref_to_Member'>arg</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepunion.c.html#LN1828"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>; 
</span>                        <a href="prepunion.c.html#LN1862"><span class='Ref_To_Local'>r</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN858"><span class='Ref_to_Member'>resulttype</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN1822"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1983"><span class='Ref_to_Member'>parent_reltype</span></a><span class='Delimiter'>; 
</span>                        <a href="prepunion.c.html#LN1862"><span class='Ref_To_Local'>r</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN860"><span class='Ref_to_Member'>convertformat</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/primnodes.h.html#LN438"><span class='Ref_to_EnumConst'>COERCE_IMPLICIT_CAST</span></a><span class='Delimiter'>; 
</span>                        <a href="prepunion.c.html#LN1862"><span class='Ref_To_Local'>r</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN861"><span class='Ref_to_Member'>location</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                        <span class='Comment_Multi_Line'>/* Make sure the Var node has the right type ID, too */ 
</span>                        <a href="prepunion.c.html#LN1828"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN169"><span class='Ref_to_Member'>vartype</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN1822"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1984"><span class='Ref_to_Member'>child_reltype</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepunion.c.html#LN1862"><span class='Ref_To_Local'>r</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* 
                     * Build a RowExpr containing the translated variables. 
                     * 
                     * In practice var-&GT;vartype will always be RECORDOID here, 
                     * so we need to come up with some suitable column names. 
                     * We use the parent RTE's column names. 
                     * 
                     * Note: we can't get here for inheritance cases, so there 
                     * is no need to worry that translated_vars might contain 
                     * some dummy NULLs. 
                     */ 
</span><a name="LN1886"></a>                    <a href="../../../include/nodes/primnodes.h.html#LN981"><span class='Ref_to_Struct'>RowExpr</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>rowexpr</span><span class='Delimiter'>; 
</span><a name="LN1887"></a>                    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>fields</span><span class='Delimiter'>; 
</span><a name="LN1888"></a>                    <a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rte</span><span class='Delimiter'>; 
</span> 
                    <a href="prepunion.c.html#LN1888"><span class='Ref_To_Local'>rte</span></a> <span class='Operator'>= </span><a href="../../../include/parser/parsetree.h.html#LN30"><span class='Ref_to_Macro'>rt_fetch</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1822"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1974"><span class='Ref_to_Member'>parent_relid</span></a><span class='Delimiter'>, 
</span>                                   <a href="prepunion.c.html#LN1820"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="prepunion.c.html#LN56"><span class='Ref_to_Member'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN134"><span class='Ref_to_Member'>rtable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="prepunion.c.html#LN1887"><span class='Ref_To_Local'>fields</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1822"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN2002"><span class='Ref_to_Member'>translated_vars</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="prepunion.c.html#LN1886"><span class='Ref_To_Local'>rowexpr</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN981"><span class='Ref_to_Struct'>RowExpr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="prepunion.c.html#LN1886"><span class='Ref_To_Local'>rowexpr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN984"><span class='Ref_to_Member'>args</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN1887"><span class='Ref_To_Local'>fields</span></a><span class='Delimiter'>; 
</span>                    <a href="prepunion.c.html#LN1886"><span class='Ref_To_Local'>rowexpr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN985"><span class='Ref_to_Member'>row_typeid</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN1828"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN169"><span class='Ref_to_Member'>vartype</span></a><span class='Delimiter'>; 
</span>                    <a href="prepunion.c.html#LN1886"><span class='Ref_To_Local'>rowexpr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN996"><span class='Ref_to_Member'>row_format</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/primnodes.h.html#LN438"><span class='Ref_to_EnumConst'>COERCE_IMPLICIT_CAST</span></a><span class='Delimiter'>; 
</span>                    <a href="prepunion.c.html#LN1886"><span class='Ref_To_Local'>rowexpr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN997"><span class='Ref_to_Member'>colnames</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1888"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1023"><span class='Ref_to_Member'>eref</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN42"><span class='Ref_to_Member'>colnames</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="prepunion.c.html#LN1886"><span class='Ref_To_Local'>rowexpr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN998"><span class='Ref_to_Member'>location</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepunion.c.html#LN1886"><span class='Ref_To_Local'>rowexpr</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if var-&GT;varattno==0 &raquo; </span> 
            <span class='Comment_Multi_Line'>/* system attributes don't need any other translation */ 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if var-&GT;varlevelsup==0&&... &raquo; </span> 
        <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepunion.c.html#LN1828"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IsA(node,Var) &raquo; </span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1819"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1272"><span class='Ref_to_Struct'>CurrentOfExpr</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1909"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1272"><span class='Ref_to_Struct'>CurrentOfExpr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cexpr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1272"><span class='Ref_to_Struct'>CurrentOfExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1819"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN1909"><span class='Ref_To_Local'>cexpr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1275"><span class='Ref_to_Member'>cvarno</span></a> <span class='Operator'>== </span><a href="prepunion.c.html#LN1822"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1974"><span class='Ref_to_Member'>parent_relid</span></a><span class='Parentheses'>) 
</span>            <a href="prepunion.c.html#LN1909"><span class='Ref_To_Local'>cexpr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1275"><span class='Ref_to_Member'>cvarno</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN1822"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1975"><span class='Ref_to_Member'>child_relid</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepunion.c.html#LN1909"><span class='Ref_To_Local'>cexpr</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1819"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1415"><span class='Ref_to_Struct'>RangeTblRef</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1917"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1415"><span class='Ref_to_Struct'>RangeTblRef</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rtr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1415"><span class='Ref_to_Struct'>RangeTblRef</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1819"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN1917"><span class='Ref_To_Local'>rtr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1418"><span class='Ref_to_Member'>rtindex</span></a> <span class='Operator'>== </span><a href="prepunion.c.html#LN1822"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1974"><span class='Ref_to_Member'>parent_relid</span></a><span class='Parentheses'>) 
</span>            <a href="prepunion.c.html#LN1917"><span class='Ref_To_Local'>rtr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1418"><span class='Ref_to_Member'>rtindex</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN1822"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1975"><span class='Ref_to_Member'>child_relid</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepunion.c.html#LN1917"><span class='Ref_To_Local'>rtr</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1819"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Copy the JoinExpr node with correct mutation of subnodes */ 
</span><a name="LN1926"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>j</span><span class='Delimiter'>; 
</span> 
        <a href="prepunion.c.html#LN1926"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/nodeFuncs.h.html#LN54"><span class='Ref_to_Proto'>expression_tree_mutator</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1819"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, 
</span>                                              <a href="prepunion.c.html#LN107"><span class='Ref_to_Proto'>adjust_appendrel_attrs_mutator</span></a><span class='Delimiter'>, 
</span>                                                 <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepunion.c.html#LN1820"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* now fix JoinExpr's rtindex (probably never happens) */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN1926"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1454"><span class='Ref_to_Member'>rtindex</span></a> <span class='Operator'>== </span><a href="prepunion.c.html#LN1822"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1974"><span class='Ref_to_Member'>parent_relid</span></a><span class='Parentheses'>) 
</span>            <a href="prepunion.c.html#LN1926"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1454"><span class='Ref_to_Member'>rtindex</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN1822"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1975"><span class='Ref_to_Member'>child_relid</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepunion.c.html#LN1926"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1819"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN1846"><span class='Ref_to_Struct'>PlaceHolderVar</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Copy the PlaceHolderVar node with correct mutation of subnodes */ 
</span><a name="LN1939"></a>        <a href="../../../include/nodes/relation.h.html#LN1846"><span class='Ref_to_Struct'>PlaceHolderVar</span></a> <span class='Operator'>*</span><span class='Declare_Local'>phv</span><span class='Delimiter'>; 
</span> 
        <a href="prepunion.c.html#LN1939"><span class='Ref_To_Local'>phv</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1846"><span class='Ref_to_Struct'>PlaceHolderVar</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/nodeFuncs.h.html#LN54"><span class='Ref_to_Proto'>expression_tree_mutator</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1819"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, 
</span>                                              <a href="prepunion.c.html#LN107"><span class='Ref_to_Proto'>adjust_appendrel_attrs_mutator</span></a><span class='Delimiter'>, 
</span>                                                         <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepunion.c.html#LN1820"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* now fix PlaceHolderVar's relid sets */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN1939"><span class='Ref_To_Local'>phv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1852"><span class='Ref_to_Member'>phlevelsup</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="prepunion.c.html#LN1939"><span class='Ref_To_Local'>phv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1850"><span class='Ref_to_Member'>phrels</span></a> <span class='Operator'>= </span><a href="../../rewrite/rewriteManip.c.html#LN51"><span class='Ref_to_Proto'>adjust_relid_set</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1939"><span class='Ref_To_Local'>phv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1850"><span class='Ref_to_Member'>phrels</span></a><span class='Delimiter'>, 
</span>                                           <a href="prepunion.c.html#LN1822"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1974"><span class='Ref_to_Member'>parent_relid</span></a><span class='Delimiter'>, 
</span>                                           <a href="prepunion.c.html#LN1822"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1975"><span class='Ref_to_Member'>child_relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepunion.c.html#LN1939"><span class='Ref_To_Local'>phv</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Comment_Multi_Line'>/* Shouldn't need to handle planner auxiliary nodes here */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1819"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN1913"><span class='Ref_to_Struct'>SpecialJoinInfo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1819"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN1964"><span class='Ref_to_Struct'>AppendRelInfo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1819"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN2057"><span class='Ref_to_Struct'>PlaceHolderInfo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1819"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN2074"><span class='Ref_to_Struct'>MinMaxAggInfo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We have to process RestrictInfo nodes specially.  (Note: although 
     * set_append_rel_pathlist will hide RestrictInfos in the parent's 
     * baserestrictinfo list from us, it doesn't hide those in joininfo.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1819"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1964"></a>        <a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>oldinfo</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepunion.c.html#LN1819"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span><a name="LN1965"></a>        <a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>newinfo</span> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Copy all flat-copiable fields */ 
</span>        memcpy<span class='Parentheses'>(</span><a href="prepunion.c.html#LN1965"><span class='Ref_To_Local'>newinfo</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN1964"><span class='Ref_To_Local'>oldinfo</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Recursively fix the clause itself */ 
</span>        <a href="prepunion.c.html#LN1965"><span class='Ref_To_Local'>newinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1746"><span class='Ref_to_Member'>clause</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>            <a href="prepunion.c.html#LN107"><span class='Ref_to_Proto'>adjust_appendrel_attrs_mutator</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepunion.c.html#LN1964"><span class='Ref_To_Local'>oldinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1746"><span class='Ref_to_Member'>clause</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN1820"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* and the modified version, if an OR clause */ 
</span>        <a href="prepunion.c.html#LN1965"><span class='Ref_To_Local'>newinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1777"><span class='Ref_to_Member'>orclause</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>            <a href="prepunion.c.html#LN107"><span class='Ref_to_Proto'>adjust_appendrel_attrs_mutator</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepunion.c.html#LN1964"><span class='Ref_To_Local'>oldinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1777"><span class='Ref_to_Member'>orclause</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN1820"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* adjust relid sets too */ 
</span>        <a href="prepunion.c.html#LN1965"><span class='Ref_To_Local'>newinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1761"><span class='Ref_to_Member'>clause_relids</span></a> <span class='Operator'>= </span><a href="../../rewrite/rewriteManip.c.html#LN51"><span class='Ref_to_Proto'>adjust_relid_set</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1964"><span class='Ref_To_Local'>oldinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1761"><span class='Ref_to_Member'>clause_relids</span></a><span class='Delimiter'>, 
</span>                                                  <a href="prepunion.c.html#LN1822"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1974"><span class='Ref_to_Member'>parent_relid</span></a><span class='Delimiter'>, 
</span>                                                  <a href="prepunion.c.html#LN1822"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1975"><span class='Ref_to_Member'>child_relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepunion.c.html#LN1965"><span class='Ref_To_Local'>newinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1764"><span class='Ref_to_Member'>required_relids</span></a> <span class='Operator'>= </span><a href="../../rewrite/rewriteManip.c.html#LN51"><span class='Ref_to_Proto'>adjust_relid_set</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1964"><span class='Ref_To_Local'>oldinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1764"><span class='Ref_to_Member'>required_relids</span></a><span class='Delimiter'>, 
</span>                                                    <a href="prepunion.c.html#LN1822"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1974"><span class='Ref_to_Member'>parent_relid</span></a><span class='Delimiter'>, 
</span>                                                    <a href="prepunion.c.html#LN1822"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1975"><span class='Ref_to_Member'>child_relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepunion.c.html#LN1965"><span class='Ref_To_Local'>newinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1767"><span class='Ref_to_Member'>outer_relids</span></a> <span class='Operator'>= </span><a href="../../rewrite/rewriteManip.c.html#LN51"><span class='Ref_to_Proto'>adjust_relid_set</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1964"><span class='Ref_To_Local'>oldinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1767"><span class='Ref_to_Member'>outer_relids</span></a><span class='Delimiter'>, 
</span>                                                 <a href="prepunion.c.html#LN1822"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1974"><span class='Ref_to_Member'>parent_relid</span></a><span class='Delimiter'>, 
</span>                                                 <a href="prepunion.c.html#LN1822"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1975"><span class='Ref_to_Member'>child_relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepunion.c.html#LN1965"><span class='Ref_To_Local'>newinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1770"><span class='Ref_to_Member'>nullable_relids</span></a> <span class='Operator'>= </span><a href="../../rewrite/rewriteManip.c.html#LN51"><span class='Ref_to_Proto'>adjust_relid_set</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1964"><span class='Ref_To_Local'>oldinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1770"><span class='Ref_to_Member'>nullable_relids</span></a><span class='Delimiter'>, 
</span>                                                    <a href="prepunion.c.html#LN1822"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1974"><span class='Ref_to_Member'>parent_relid</span></a><span class='Delimiter'>, 
</span>                                                    <a href="prepunion.c.html#LN1822"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1975"><span class='Ref_to_Member'>child_relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepunion.c.html#LN1965"><span class='Ref_To_Local'>newinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1773"><span class='Ref_to_Member'>left_relids</span></a> <span class='Operator'>= </span><a href="../../rewrite/rewriteManip.c.html#LN51"><span class='Ref_to_Proto'>adjust_relid_set</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1964"><span class='Ref_To_Local'>oldinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1773"><span class='Ref_to_Member'>left_relids</span></a><span class='Delimiter'>, 
</span>                                                <a href="prepunion.c.html#LN1822"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1974"><span class='Ref_to_Member'>parent_relid</span></a><span class='Delimiter'>, 
</span>                                                <a href="prepunion.c.html#LN1822"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1975"><span class='Ref_to_Member'>child_relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepunion.c.html#LN1965"><span class='Ref_To_Local'>newinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1774"><span class='Ref_to_Member'>right_relids</span></a> <span class='Operator'>= </span><a href="../../rewrite/rewriteManip.c.html#LN51"><span class='Ref_to_Proto'>adjust_relid_set</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1964"><span class='Ref_To_Local'>oldinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1774"><span class='Ref_to_Member'>right_relids</span></a><span class='Delimiter'>, 
</span>                                                 <a href="prepunion.c.html#LN1822"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1974"><span class='Ref_to_Member'>parent_relid</span></a><span class='Delimiter'>, 
</span>                                                 <a href="prepunion.c.html#LN1822"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1975"><span class='Ref_to_Member'>child_relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Reset cached derivative fields, since these might need to have 
         * different values when considering the child relation.  Note we 
         * don't reset left_ec/right_ec: each child variable is implicitly 
         * equivalent to its parent, so still a member of the same EC if any. 
         */ 
</span>        <a href="prepunion.c.html#LN1965"><span class='Ref_To_Local'>newinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1783"><span class='Ref_to_Member'>eval_cost</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN44"><span class='Ref_to_Member'>startup</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="prepunion.c.html#LN1965"><span class='Ref_To_Local'>newinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1784"><span class='Ref_to_Member'>norm_selec</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="prepunion.c.html#LN1965"><span class='Ref_To_Local'>newinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1787"><span class='Ref_to_Member'>outer_selec</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="prepunion.c.html#LN1965"><span class='Ref_To_Local'>newinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1796"><span class='Ref_to_Member'>left_em</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="prepunion.c.html#LN1965"><span class='Ref_To_Local'>newinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1797"><span class='Ref_to_Member'>right_em</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="prepunion.c.html#LN1965"><span class='Ref_To_Local'>newinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1798"><span class='Ref_to_Member'>scansel_cache</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>        <a href="prepunion.c.html#LN1965"><span class='Ref_To_Local'>newinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1807"><span class='Ref_to_Member'>left_bucketsize</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="prepunion.c.html#LN1965"><span class='Ref_To_Local'>newinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1808"><span class='Ref_to_Member'>right_bucketsize</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepunion.c.html#LN1965"><span class='Ref_To_Local'>newinfo</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IsA(node,RestrictInfo... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * NOTE: we do not need to recurse into sublinks, because they should 
     * already have been converted to subplans before we see them. 
     */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1819"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN629"><span class='Ref_to_Struct'>SubLink</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1819"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../../include/nodes/nodeFuncs.h.html#LN54"><span class='Ref_to_Proto'>expression_tree_mutator</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN1819"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN107"><span class='Ref_to_Proto'>adjust_appendrel_attrs_mutator</span></a><span class='Delimiter'>, 
</span>                                   <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="prepunion.c.html#LN1820"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end adjust_appendrel_attrs_mutator &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Substitute newrelid for oldrelid in a Relid set 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> 
<a name="LN2031"></a><span class='Declare_Function'>adjust_relid_set</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>relids</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>oldrelid</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>newrelid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/bitmapset.h.html#LN75"><span class='Ref_to_Proto'>bms_is_member</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN2031"><span class='Ref_to_Parameter'>oldrelid</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN2031"><span class='Ref_to_Parameter'>relids</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Ensure we have a modifiable copy */ 
</span>        <a href="prepunion.c.html#LN2031"><span class='Ref_to_Parameter'>relids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN65"><span class='Ref_to_Proto'>bms_copy</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN2031"><span class='Ref_to_Parameter'>relids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Remove old, add new */ 
</span>        <a href="prepunion.c.html#LN2031"><span class='Ref_to_Parameter'>relids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN90"><span class='Ref_to_Proto'>bms_del_member</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN2031"><span class='Ref_to_Parameter'>relids</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN2031"><span class='Ref_to_Parameter'>oldrelid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepunion.c.html#LN2031"><span class='Ref_to_Parameter'>relids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN89"><span class='Ref_to_Proto'>bms_add_member</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN2031"><span class='Ref_to_Parameter'>relids</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN2031"><span class='Ref_to_Parameter'>newrelid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="prepunion.c.html#LN2031"><span class='Ref_to_Parameter'>relids</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Adjust the targetlist entries of an inherited UPDATE operation 
 * 
 * The expressions have already been fixed, but we have to make sure that 
 * the target resnos match the child table (they may not, in the case of 
 * a column that was added after-the-fact by ALTER TABLE).  In some cases 
 * this can force us to re-order the tlist to preserve resno ordering. 
 * (We do all this work in special cases so that preptlist.c is fast for 
 * the typical case.) 
 * 
 * The given tlist has already been through expression_tree_mutator; 
 * therefore the TargetEntry nodes are fresh copies that it's okay to 
 * scribble on. 
 * 
 * Note that this is not needed for INSERT because INSERT isn't inheritable. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN2061"></a><span class='Declare_Function'>adjust_inherited_tlist</span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tlist</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN1964"><span class='Ref_to_Struct'>AppendRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2063"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>changed_it</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN2064"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>tl</span><span class='Delimiter'>; 
</span><a name="LN2065"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>new_tlist</span><span class='Delimiter'>; 
</span><a name="LN2066"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>more</span><span class='Delimiter'>; 
</span><a name="LN2067"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>attrno</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* This should only happen for an inheritance case, not UNION ALL */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN2061"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN2009"><span class='Ref_to_Member'>parent_reloid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Scan tlist and update resnos to match attnums of child rel */ 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN2064"><span class='Ref_To_Local'>tl</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN2061"><span class='Ref_to_Parameter'>tlist</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2075"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tle</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN2064"><span class='Ref_To_Local'>tl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2076"></a>        <a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>childvar</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN2075"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1373"><span class='Ref_to_Member'>resjunk</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* ignore junk items */ 
</span> 
        <span class='Comment_Multi_Line'>/* Look up the translation of this column: it must be a Var */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN2075"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1367"><span class='Ref_to_Member'>resno</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            <a href="prepunion.c.html#LN2075"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1367"><span class='Ref_to_Member'>resno</span></a> <span class='Operator'>&GT; </span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN2061"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN2002"><span class='Ref_to_Member'>translated_vars</span></a><span class='Parentheses'>))</span> 
            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"attribute %d of relation \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                 <a href="prepunion.c.html#LN2075"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1367"><span class='Ref_to_Member'>resno</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/lsyscache.h.html#LN124"><span class='Ref_to_Proto'>get_rel_name</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN2061"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN2009"><span class='Ref_to_Member'>parent_reloid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="prepunion.c.html#LN2076"><span class='Ref_To_Local'>childvar</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN223"><span class='Ref_to_Proto'>list_nth</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN2061"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN2002"><span class='Ref_to_Member'>translated_vars</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN2075"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1367"><span class='Ref_to_Member'>resno</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN2076"><span class='Ref_To_Local'>childvar</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| !</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN2076"><span class='Ref_To_Local'>childvar</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a><span class='Parentheses'>))</span> 
            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"attribute %d of relation \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                 <a href="prepunion.c.html#LN2075"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1367"><span class='Ref_to_Member'>resno</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/lsyscache.h.html#LN124"><span class='Ref_to_Proto'>get_rel_name</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN2061"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN2009"><span class='Ref_to_Member'>parent_reloid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN2075"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1367"><span class='Ref_to_Member'>resno</span></a> <span class='Operator'>!= </span><a href="prepunion.c.html#LN2076"><span class='Ref_To_Local'>childvar</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN167"><span class='Ref_to_Member'>varattno</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="prepunion.c.html#LN2075"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1367"><span class='Ref_to_Member'>resno</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN2076"><span class='Ref_To_Local'>childvar</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN167"><span class='Ref_to_Member'>varattno</span></a><span class='Delimiter'>; 
</span>            <a href="prepunion.c.html#LN2063"><span class='Ref_To_Local'>changed_it</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we changed anything, re-sort the tlist by resno, and make sure 
     * resjunk entries have resnos above the last real resno.  The sort 
     * algorithm is a bit stupid, but for such a seldom-taken path, small is 
     * probably better than fast. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="prepunion.c.html#LN2063"><span class='Ref_To_Local'>changed_it</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="prepunion.c.html#LN2061"><span class='Ref_to_Parameter'>tlist</span></a><span class='Delimiter'>; 
</span> 
    <a href="prepunion.c.html#LN2065"><span class='Ref_To_Local'>new_tlist</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="prepunion.c.html#LN2066"><span class='Ref_To_Local'>more</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN2067"><span class='Ref_To_Local'>attrno</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="prepunion.c.html#LN2066"><span class='Ref_To_Local'>more</span></a><span class='Delimiter'>; </span><a href="prepunion.c.html#LN2067"><span class='Ref_To_Local'>attrno</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="prepunion.c.html#LN2066"><span class='Ref_To_Local'>more</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN2064"><span class='Ref_To_Local'>tl</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN2061"><span class='Ref_to_Parameter'>tlist</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2114"></a>            <a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tle</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN2064"><span class='Ref_To_Local'>tl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN2114"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1373"><span class='Ref_to_Member'>resjunk</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* ignore junk items */ 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN2114"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1367"><span class='Ref_to_Member'>resno</span></a> <span class='Operator'>== </span><a href="prepunion.c.html#LN2067"><span class='Ref_To_Local'>attrno</span></a><span class='Parentheses'>) 
</span>                <a href="prepunion.c.html#LN2065"><span class='Ref_To_Local'>new_tlist</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN2065"><span class='Ref_To_Local'>new_tlist</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN2114"><span class='Ref_To_Local'>tle</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prepunion.c.html#LN2114"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1367"><span class='Ref_to_Member'>resno</span></a> <span class='Operator'>&GT; </span><a href="prepunion.c.html#LN2067"><span class='Ref_To_Local'>attrno</span></a><span class='Parentheses'>) 
</span>                <a href="prepunion.c.html#LN2066"><span class='Ref_To_Local'>more</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN2064"><span class='Ref_To_Local'>tl</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN2061"><span class='Ref_to_Parameter'>tlist</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2128"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tle</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN2064"><span class='Ref_To_Local'>tl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="prepunion.c.html#LN2128"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1373"><span class='Ref_to_Member'>resjunk</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* here, ignore non-junk items */ 
</span> 
        <a href="prepunion.c.html#LN2128"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1367"><span class='Ref_to_Member'>resno</span></a> <span class='Operator'>= </span><a href="prepunion.c.html#LN2067"><span class='Ref_To_Local'>attrno</span></a><span class='Delimiter'>; 
</span>        <a href="prepunion.c.html#LN2065"><span class='Ref_To_Local'>new_tlist</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN2065"><span class='Ref_To_Local'>new_tlist</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN2128"><span class='Ref_To_Local'>tle</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="prepunion.c.html#LN2067"><span class='Ref_To_Local'>attrno</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="prepunion.c.html#LN2065"><span class='Ref_To_Local'>new_tlist</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end adjust_inherited_tlist &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * adjust_appendrel_attrs_multilevel 
 *    Apply Var translations from a toplevel appendrel parent down to a child. 
 * 
 * In some cases we need to translate expressions referencing a baserel 
 * to reference an appendrel child that's multiple levels removed from it. 
 */ 
</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>* 
</span><a name="LN2149"></a><span class='Declare_Function'>adjust_appendrel_attrs_multilevel</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, 
</span><a name="LN2150"></a>                                  <a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>child_rel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2152"></a>    <a href="../../../include/nodes/relation.h.html#LN1964"><span class='Ref_to_Struct'>AppendRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>appinfo</span> <span class='Operator'>= </span><a href="../../../include/optimizer/pathnode.h.html#LN272"><span class='Ref_to_Proto'>find_childrel_appendrelinfo</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN2149"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN2150"><span class='Ref_to_Parameter'>child_rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2153"></a>    <a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>parent_rel</span> <span class='Operator'>= </span><a href="../util/relnode.c.html#LN241"><span class='Ref_to_Func'>find_base_rel</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN2149"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN2152"><span class='Ref_To_Local'>appinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1974"><span class='Ref_to_Member'>parent_relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If parent is also a child, first recurse to apply its translations */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN515"><span class='Ref_to_Macro'>IS_OTHER_REL</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN2153"><span class='Ref_To_Local'>parent_rel</span></a><span class='Parentheses'>))</span> 
        <a href="prepunion.c.html#LN2149"><span class='Ref_to_Parameter'>node</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/prep.h.html#LN57"><span class='Ref_to_Proto'>adjust_appendrel_attrs_multilevel</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN2149"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN2149"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN2153"><span class='Ref_To_Local'>parent_rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="prepunion.c.html#LN2153"><span class='Ref_To_Local'>parent_rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN521"><span class='Ref_to_Member'>reloptkind</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/relation.h.html#LN493"><span class='Ref_to_EnumConst'>RELOPT_BASEREL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Now translate for this child */ 
</span>    <span class='Control'>return</span> <a href="../../../include/optimizer/prep.h.html#LN54"><span class='Ref_to_Proto'>adjust_appendrel_attrs</span></a><span class='Parentheses'>(</span><a href="prepunion.c.html#LN2149"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN2149"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="prepunion.c.html#LN2152"><span class='Ref_To_Local'>appinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>