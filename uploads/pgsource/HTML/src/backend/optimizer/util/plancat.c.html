<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\optimizer\util\plancat.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\optimizer\util\plancat.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:43 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * plancat.c 
 *     routines for accessing the system catalogs 
 * 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/optimizer/util/plancat.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;math.h&GT;</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/genam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/heapam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/nbtree.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/sysattr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/transam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xlog.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/catalog.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/dependency.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/heap.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/partition.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_am.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_statistic_ext.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"foreign/fdwapi.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"nodes/makefuncs.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/clauses.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/cost.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/plancat.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/predtest.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/prep.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parse_relation.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parsetree.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"rewrite/rewriteManip.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"statistics/statistics.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/bufmgr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/syscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/rel.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/snapmgr.h"</span> 
 
 
<span class='Comment_Multi_Line'>/* GUC parameter */ 
</span><a name="LN53"></a><span class='Keyword'>int</span>         <span class='Declare_Var'>constraint_exclusion</span> <span class='Operator'>= </span><a href="../../../include/optimizer/cost.h.html#LN37"><span class='Ref_to_EnumConst'>CONSTRAINT_EXCLUSION_PARTITION</span></a><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* Hook for plugins to get control in get_relation_info() */ 
</span><a name="LN56"></a><a href="../../../include/optimizer/plancat.h.html#LN20"><span class='Ref_to_Typedef'>get_relation_info_hook_type</span></a> <span class='Declare_Var'>get_relation_info_hook</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
 
<a name="LN59"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>get_relation_foreign_keys</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN60"></a>                          <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>inhparent</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN61"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>infer_collation_opclass_match</span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1287"><span class='Ref_to_Struct'>InferenceElem</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>elem</span><span class='Delimiter'>, </span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>idxRel</span><span class='Delimiter'>, 
</span><a name="LN62"></a>                              <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>idxExprs</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN63"></a><span class='Keyword'>static </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Prototype'>get_rel_data_width</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>attr_widths</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN64"></a><span class='Keyword'>static </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>get_relation_constraints</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN65"></a>                         <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relationObjectId</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN66"></a>                         <span class='Keyword'>bool </span><span class='Declare_Parameter'>include_notnull</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN67"></a><span class='Keyword'>static </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>build_index_tlist</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>index</span><span class='Delimiter'>, 
</span><a name="LN68"></a>                  <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>heapRelation</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN69"></a><span class='Keyword'>static </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>get_relation_statistics</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * get_relation_info - 
 *    Retrieves catalog information for a given relation. 
 * 
 * Given the Oid of the relation, return the following info into fields 
 * of the RelOptInfo struct: 
 * 
 *  min_attr    lowest valid AttrNumber 
 *  max_attr    highest valid AttrNumber 
 *  indexlist   list of IndexOptInfos for relation's indexes 
 *  statlist    list of StatisticExtInfo for relation's statistic objects 
 *  serverid    if it's a foreign table, the server OID 
 *  fdwroutine  if it's a foreign table, the FDW function pointers 
 *  pages       number of pages 
 *  tuples      number of tuples 
 *  rel_parallel_workers user-defined number of parallel workers 
 * 
 * Also, add information about the relation's foreign keys to root-&GT;fkey_list. 
 * 
 * Also, initialize the attr_needed[] and attr_widths[] arrays.  In most 
 * cases these are left as zeroes, but sometimes we need to compute attr 
 * widths here, and we may as well cache the results for costsize.c. 
 * 
 * If inhparent is true, all we need to do is set up the attr arrays: 
 * the RelOptInfo actually represents the appendrel formed by an inheritance 
 * tree, and so the parent rel's physical size and index information isn't 
 * important for it. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN100"></a><span class='Declare_Function'>get_relation_info</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relationObjectId</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>inhparent</span><span class='Delimiter'>, 
</span><a name="LN101"></a>                  <a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN103"></a>    <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a>       <span class='Declare_Local'>varno</span> <span class='Operator'>= </span><a href="plancat.c.html#LN101"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN552"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>; 
</span><a name="LN104"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>relation</span><span class='Delimiter'>; 
</span><a name="LN105"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>hasindex</span><span class='Delimiter'>; 
</span><a name="LN106"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>indexinfos</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We need not lock the relation since it was already locked, either by 
     * the rewriter or when expand_inherited_rtentry() added it to the query's 
     * rangetable. 
     */ 
</span>    <a href="plancat.c.html#LN104"><span class='Ref_To_Local'>relation</span></a> <span class='Operator'>= </span><a href="../../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN100"><span class='Ref_to_Parameter'>relationObjectId</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Temporary and unlogged relations are inaccessible during recovery. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/rel.h.html#LN505"><span class='Ref_to_Macro'>RelationNeedsWAL</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN104"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="../../../include/access/xlog.h.html#LN242"><span class='Ref_to_Proto'>RecoveryInProgress</span></a><span class='Parentheses'>())</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot access temporary or unlogged relations during recovery"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="plancat.c.html#LN101"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN555"><span class='Ref_to_Member'>min_attr</span></a> <span class='Operator'>= </span><a href="../../../include/access/sysattr.h.html#LN27"><span class='Ref_to_Const'>FirstLowInvalidHeapAttributeNumber</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="plancat.c.html#LN101"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN556"><span class='Ref_to_Member'>max_attr</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rel.h.html#LN422"><span class='Ref_to_Macro'>RelationGetNumberOfAttributes</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN104"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="plancat.c.html#LN101"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN553"><span class='Ref_to_Member'>reltablespace</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rel.h.html#LN410"><span class='Ref_to_Macro'>RelationGetForm</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN104"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>reltablespace<span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="plancat.c.html#LN101"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN556"><span class='Ref_to_Member'>max_attr</span></a> <span class='Operator'>&GT;= </span><a href="plancat.c.html#LN101"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN555"><span class='Ref_to_Member'>min_attr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="plancat.c.html#LN101"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN557"><span class='Ref_to_Member'>attr_needed</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>((</span><a href="plancat.c.html#LN101"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN556"><span class='Ref_to_Member'>max_attr</span></a> <span class='Operator'>- </span><a href="plancat.c.html#LN101"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN555"><span class='Ref_to_Member'>min_attr</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="plancat.c.html#LN101"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN558"><span class='Ref_to_Member'>attr_widths</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>((</span><a href="plancat.c.html#LN101"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN556"><span class='Ref_to_Member'>max_attr</span></a> <span class='Operator'>- </span><a href="plancat.c.html#LN101"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN555"><span class='Ref_to_Member'>min_attr</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Estimate relation size --- unless it's an inheritance parent, in which 
     * case the size will be computed later in set_append_rel_pathlist, and we 
     * must leave it zero for now to avoid bollixing the total_table_pages 
     * calculation. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="plancat.c.html#LN100"><span class='Ref_to_Parameter'>inhparent</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/optimizer/plancat.h.html#LN32"><span class='Ref_to_Proto'>estimate_rel_size</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN104"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN101"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN558"><span class='Ref_to_Member'>attr_widths</span></a> <span class='Operator'>- </span><a href="plancat.c.html#LN101"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN555"><span class='Ref_to_Member'>min_attr</span></a><span class='Delimiter'>, 
</span>                          <span class='Operator'>&</span><a href="plancat.c.html#LN101"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN563"><span class='Ref_to_Member'>pages</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="plancat.c.html#LN101"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN564"><span class='Ref_to_Member'>tuples</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="plancat.c.html#LN101"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN565"><span class='Ref_to_Member'>allvisfrac</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Retrieve the parallel_workers reloption, or -1 if not set. */ 
</span>    <a href="plancat.c.html#LN101"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN568"><span class='Ref_to_Member'>rel_parallel_workers</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rel.h.html#LN326"><span class='Ref_to_Macro'>RelationGetParallelWorkers</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN104"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Make list of indexes.  Ignore indexes on system catalogs if told to. 
     * Don't bother with indexes for an inheritance parent, either. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN100"><span class='Ref_to_Parameter'>inhparent</span></a> <span class='Operator'>|| 
</span>        <span class='Parentheses'>(</span><a href="../../utils/init/miscinit.c.html#LN72"><span class='Ref_to_Global_Var'>IgnoreSystemIndexes</span></a> <span class='Operator'>&& </span><a href="../../../include/catalog/catalog.h.html#LN29"><span class='Ref_to_Proto'>IsSystemRelation</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN104"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)))</span> 
        <a href="plancat.c.html#LN105"><span class='Ref_To_Local'>hasindex</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="plancat.c.html#LN105"><span class='Ref_To_Local'>hasindex</span></a> <span class='Operator'>= </span><a href="plancat.c.html#LN104"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relhasindex<span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN105"><span class='Ref_To_Local'>hasindex</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN156"></a>        <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>indexoidlist</span><span class='Delimiter'>; 
</span><a name="LN157"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span><a name="LN158"></a>        <a href="../../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a>    <span class='Declare_Local'>lmode</span><span class='Delimiter'>; 
</span> 
        <a href="plancat.c.html#LN156"><span class='Ref_To_Local'>indexoidlist</span></a> <span class='Operator'>= </span><a href="../../../include/utils/relcache.h.html#LN40"><span class='Ref_to_Proto'>RelationGetIndexList</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN104"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * For each index, we get the same type of lock that the executor will 
         * need, and do not release it.  This saves a couple of trips to the 
         * shared lock manager while not creating any real loss of 
         * concurrency, because no schema changes could be happening on the 
         * index while we hold lock on the parent rel, and neither lock type 
         * blocks any other kind of index operation. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN101"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN552"><span class='Ref_to_Member'>relid</span></a> <span class='Operator'>== </span><a href="plancat.c.html#LN100"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN119"><span class='Ref_to_Member'>resultRelation</span></a><span class='Parentheses'>) 
</span>            <a href="plancat.c.html#LN158"><span class='Ref_To_Local'>lmode</span></a> <span class='Operator'>= </span><a href="../../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="plancat.c.html#LN158"><span class='Ref_To_Local'>lmode</span></a> <span class='Operator'>= </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Delimiter'>; 
</span> 
        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN157"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN156"><span class='Ref_To_Local'>indexoidlist</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN177"></a>            <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>indexoid</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN157"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN178"></a>            <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>indexRelation</span><span class='Delimiter'>; 
</span><a name="LN179"></a>            <a href="../../../include/catalog/pg_index.h.html#LN66"><span class='Ref_to_Typedef'>Form_pg_index</span></a> <span class='Declare_Local'>index</span><span class='Delimiter'>; 
</span><a name="LN180"></a>            <a href="../../../include/access/amapi.h.html#LN158"><span class='Ref_to_Struct'>IndexAmRoutine</span></a> <span class='Operator'>*</span><span class='Declare_Local'>amroutine</span><span class='Delimiter'>; 
</span><a name="LN181"></a>            <a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>info</span><span class='Delimiter'>; 
</span><a name="LN182"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>ncolumns</span><span class='Delimiter'>; 
</span><a name="LN183"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Extract info from the relation descriptor for the index. 
             */ 
</span>            <a href="plancat.c.html#LN178"><span class='Ref_To_Local'>indexRelation</span></a> <span class='Operator'>= </span><a href="../../../include/access/genam.h.html#LN129"><span class='Ref_to_Proto'>index_open</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN177"><span class='Ref_To_Local'>indexoid</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN158"><span class='Ref_To_Local'>lmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="plancat.c.html#LN179"><span class='Ref_To_Local'>index</span></a> <span class='Operator'>= </span><a href="plancat.c.html#LN178"><span class='Ref_To_Local'>indexRelation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN158"><span class='Ref_to_Member'>rd_index</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Ignore invalid indexes, since they can't safely be used for 
             * queries.  Note that this is OK because the data structure we 
             * are constructing is only used by the planner --- the executor 
             * still needs to insert into "invalid" indexes, if they're marked 
             * IndexIsReady. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/catalog/pg_index.h.html#LN106"><span class='Ref_to_Macro'>IndexIsValid</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN179"><span class='Ref_To_Local'>index</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="../../../include/access/genam.h.html#LN130"><span class='Ref_to_Proto'>index_close</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN178"><span class='Ref_To_Local'>indexRelation</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * If the index is valid, but cannot yet be used, ignore it; but 
             * mark the plan we are generating as transient. See 
             * src/backend/access/heap/README.HOT for discussion. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN179"><span class='Ref_To_Local'>index</span></a><span class='Operator'>-&GT;</span>indcheckxmin <span class='Operator'>&& 
</span>                <span class='Operator'>!</span><a href="../../../include/access/transam.h.html#LN168"><span class='Ref_to_Proto'>TransactionIdPrecedes</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN306"><span class='Ref_to_Macro'>HeapTupleHeaderGetXmin</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN178"><span class='Ref_To_Local'>indexRelation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN160"><span class='Ref_to_Member'>rd_indextuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                       <a href="../../utils/time/snapmgr.c.html#LN163"><span class='Ref_to_Global_Var'>TransactionXmin</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="plancat.c.html#LN100"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN156"><span class='Ref_to_Member'>glob</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN124"><span class='Ref_to_Member'>transientPlan</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="../../../include/access/genam.h.html#LN130"><span class='Ref_to_Proto'>index_close</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN178"><span class='Ref_To_Local'>indexRelation</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN630"><span class='Ref_to_Member'>indexoid</span></a> <span class='Operator'>= </span><a href="plancat.c.html#LN179"><span class='Ref_To_Local'>index</span></a><span class='Operator'>-&GT;</span>indexrelid<span class='Delimiter'>; 
</span>            <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN631"><span class='Ref_to_Member'>reltablespace</span></a> <span class='Operator'>= 
</span>                <a href="../../../include/utils/rel.h.html#LN410"><span class='Ref_to_Macro'>RelationGetForm</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN178"><span class='Ref_To_Local'>indexRelation</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>reltablespace<span class='Delimiter'>; 
</span>            <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN632"><span class='Ref_to_Member'>rel</span></a> <span class='Operator'>= </span><a href="plancat.c.html#LN101"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>; 
</span>            <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN640"><span class='Ref_to_Member'>ncolumns</span></a> <span class='Operator'>= </span><a href="plancat.c.html#LN182"><span class='Ref_To_Local'>ncolumns</span></a> <span class='Operator'>= </span><a href="plancat.c.html#LN179"><span class='Ref_To_Local'>index</span></a><span class='Operator'>-&GT;</span>indnatts<span class='Delimiter'>; 
</span>            <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN641"><span class='Ref_to_Member'>indexkeys</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="plancat.c.html#LN182"><span class='Ref_To_Local'>ncolumns</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN642"><span class='Ref_to_Member'>indexcollations</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="plancat.c.html#LN182"><span class='Ref_To_Local'>ncolumns</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN643"><span class='Ref_to_Member'>opfamily</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="plancat.c.html#LN182"><span class='Ref_To_Local'>ncolumns</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN644"><span class='Ref_to_Member'>opcintype</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="plancat.c.html#LN182"><span class='Ref_To_Local'>ncolumns</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN648"><span class='Ref_to_Member'>canreturn</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="plancat.c.html#LN182"><span class='Ref_To_Local'>ncolumns</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN183"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="plancat.c.html#LN183"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="plancat.c.html#LN182"><span class='Ref_To_Local'>ncolumns</span></a><span class='Delimiter'>; </span><a href="plancat.c.html#LN183"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN641"><span class='Ref_to_Member'>indexkeys</span></a><span class='Delimiter'>[</span><a href="plancat.c.html#LN183"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="plancat.c.html#LN179"><span class='Ref_To_Local'>index</span></a><span class='Operator'>-&GT;</span>indkey<span class='Operator'>.</span>values<span class='Delimiter'>[</span><a href="plancat.c.html#LN183"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>                <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN642"><span class='Ref_to_Member'>indexcollations</span></a><span class='Delimiter'>[</span><a href="plancat.c.html#LN183"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="plancat.c.html#LN178"><span class='Ref_To_Local'>indexRelation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN192"><span class='Ref_to_Member'>rd_indcollation</span></a><span class='Delimiter'>[</span><a href="plancat.c.html#LN183"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>                <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN643"><span class='Ref_to_Member'>opfamily</span></a><span class='Delimiter'>[</span><a href="plancat.c.html#LN183"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="plancat.c.html#LN178"><span class='Ref_To_Local'>indexRelation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN181"><span class='Ref_to_Member'>rd_opfamily</span></a><span class='Delimiter'>[</span><a href="plancat.c.html#LN183"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>                <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN644"><span class='Ref_to_Member'>opcintype</span></a><span class='Delimiter'>[</span><a href="plancat.c.html#LN183"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="plancat.c.html#LN178"><span class='Ref_To_Local'>indexRelation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN182"><span class='Ref_to_Member'>rd_opcintype</span></a><span class='Delimiter'>[</span><a href="plancat.c.html#LN183"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>                <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN648"><span class='Ref_to_Member'>canreturn</span></a><span class='Delimiter'>[</span><a href="plancat.c.html#LN183"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/access/genam.h.html#LN171"><span class='Ref_to_Proto'>index_can_return</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN178"><span class='Ref_To_Local'>indexRelation</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN183"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN650"><span class='Ref_to_Member'>relam</span></a> <span class='Operator'>= </span><a href="plancat.c.html#LN178"><span class='Ref_To_Local'>indexRelation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relam<span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* We copy just the fields we need, not all of rd_amroutine */ 
</span>            <a href="plancat.c.html#LN180"><span class='Ref_To_Local'>amroutine</span></a> <span class='Operator'>= </span><a href="plancat.c.html#LN178"><span class='Ref_To_Local'>indexRelation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN180"><span class='Ref_to_Member'>rd_amroutine</span></a><span class='Delimiter'>; 
</span>            <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN668"><span class='Ref_to_Member'>amcanorderbyop</span></a> <span class='Operator'>= </span><a href="plancat.c.html#LN180"><span class='Ref_To_Local'>amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/amapi.h.html#LN172"><span class='Ref_to_Member'>amcanorderbyop</span></a><span class='Delimiter'>; 
</span>            <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN669"><span class='Ref_to_Member'>amoptionalkey</span></a> <span class='Operator'>= </span><a href="plancat.c.html#LN180"><span class='Ref_To_Local'>amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/amapi.h.html#LN180"><span class='Ref_to_Member'>amoptionalkey</span></a><span class='Delimiter'>; 
</span>            <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN670"><span class='Ref_to_Member'>amsearcharray</span></a> <span class='Operator'>= </span><a href="plancat.c.html#LN180"><span class='Ref_To_Local'>amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/amapi.h.html#LN182"><span class='Ref_to_Member'>amsearcharray</span></a><span class='Delimiter'>; 
</span>            <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN671"><span class='Ref_to_Member'>amsearchnulls</span></a> <span class='Operator'>= </span><a href="plancat.c.html#LN180"><span class='Ref_To_Local'>amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/amapi.h.html#LN184"><span class='Ref_to_Member'>amsearchnulls</span></a><span class='Delimiter'>; 
</span>            <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN674"><span class='Ref_to_Member'>amcanparallel</span></a> <span class='Operator'>= </span><a href="plancat.c.html#LN180"><span class='Ref_To_Local'>amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/amapi.h.html#LN192"><span class='Ref_to_Member'>amcanparallel</span></a><span class='Delimiter'>; 
</span>            <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN672"><span class='Ref_to_Member'>amhasgettuple</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plancat.c.html#LN180"><span class='Ref_To_Local'>amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/amapi.h.html#LN209"><span class='Ref_to_Member'>amgettuple</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN673"><span class='Ref_to_Member'>amhasgetbitmap</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plancat.c.html#LN180"><span class='Ref_To_Local'>amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/amapi.h.html#LN210"><span class='Ref_to_Member'>amgetbitmap</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN676"><span class='Ref_to_Member'>amcostestimate</span></a> <span class='Operator'>= </span><a href="plancat.c.html#LN180"><span class='Ref_To_Local'>amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/amapi.h.html#LN203"><span class='Ref_to_Member'>amcostestimate</span></a><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN676"><span class='Ref_to_Member'>amcostestimate</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Fetch the ordering information for the index, if any. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN650"><span class='Ref_to_Member'>relam</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_am.h.html#LN69"><span class='Ref_to_Const'>BTREE_AM_OID</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * If it's a btree index, we can use its opfamily OIDs 
                 * directly as the sort ordering opfamily OIDs. 
                 */ 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="plancat.c.html#LN180"><span class='Ref_To_Local'>amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/amapi.h.html#LN170"><span class='Ref_to_Member'>amcanorder</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN645"><span class='Ref_to_Member'>sortopfamily</span></a> <span class='Operator'>= </span><a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN643"><span class='Ref_to_Member'>opfamily</span></a><span class='Delimiter'>; 
</span>                <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN646"><span class='Ref_to_Member'>reverse_sort</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="plancat.c.html#LN182"><span class='Ref_To_Local'>ncolumns</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN647"><span class='Ref_to_Member'>nulls_first</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="plancat.c.html#LN182"><span class='Ref_To_Local'>ncolumns</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN183"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="plancat.c.html#LN183"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="plancat.c.html#LN182"><span class='Ref_To_Local'>ncolumns</span></a><span class='Delimiter'>; </span><a href="plancat.c.html#LN183"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN271"></a>                    <a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>       <span class='Declare_Local'>opt</span> <span class='Operator'>= </span><a href="plancat.c.html#LN178"><span class='Ref_To_Local'>indexRelation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN185"><span class='Ref_to_Member'>rd_indoption</span></a><span class='Delimiter'>[</span><a href="plancat.c.html#LN183"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
                    <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN646"><span class='Ref_to_Member'>reverse_sort</span></a><span class='Delimiter'>[</span><a href="plancat.c.html#LN183"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plancat.c.html#LN271"><span class='Ref_To_Local'>opt</span></a> <span class='Operator'>& </span><a href="../../../include/catalog/pg_index.h.html#LN98"><span class='Ref_to_Const'>INDOPTION_DESC</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                    <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN647"><span class='Ref_to_Member'>nulls_first</span></a><span class='Delimiter'>[</span><a href="plancat.c.html#LN183"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plancat.c.html#LN271"><span class='Ref_To_Local'>opt</span></a> <span class='Operator'>& </span><a href="../../../include/catalog/pg_index.h.html#LN99"><span class='Ref_to_Const'>INDOPTION_NULLS_FIRST</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if info-&GT;relam==BTREE_AM... &raquo; </span> 
            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN180"><span class='Ref_To_Local'>amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/amapi.h.html#LN170"><span class='Ref_to_Member'>amcanorder</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * Otherwise, identify the corresponding btree opfamilies by 
                 * trying to map this index's "&LT;" operators into btree.  Since 
                 * "&LT;" uniquely defines the behavior of a sort order, this is 
                 * a sufficient test. 
                 * 
                 * XXX This method is rather slow and also requires the 
                 * undesirable assumption that the other index AM numbers its 
                 * strategies the same as btree.  It'd be better to have a way 
                 * to explicitly declare the corresponding btree opfamily for 
                 * each opfamily of the other index type.  But given the lack 
                 * of current or foreseeable amcanorder index types, it's not 
                 * worth expending more effort on now. 
                 */ 
</span>                <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN645"><span class='Ref_to_Member'>sortopfamily</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="plancat.c.html#LN182"><span class='Ref_To_Local'>ncolumns</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN646"><span class='Ref_to_Member'>reverse_sort</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="plancat.c.html#LN182"><span class='Ref_To_Local'>ncolumns</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN647"><span class='Ref_to_Member'>nulls_first</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="plancat.c.html#LN182"><span class='Ref_To_Local'>ncolumns</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN183"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="plancat.c.html#LN183"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="plancat.c.html#LN182"><span class='Ref_To_Local'>ncolumns</span></a><span class='Delimiter'>; </span><a href="plancat.c.html#LN183"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN299"></a>                    <a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>       <span class='Declare_Local'>opt</span> <span class='Operator'>= </span><a href="plancat.c.html#LN178"><span class='Ref_To_Local'>indexRelation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN185"><span class='Ref_to_Member'>rd_indoption</span></a><span class='Delimiter'>[</span><a href="plancat.c.html#LN183"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span><a name="LN300"></a>                    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ltopr</span><span class='Delimiter'>; 
</span><a name="LN301"></a>                    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>btopfamily</span><span class='Delimiter'>; 
</span><a name="LN302"></a>                    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>btopcintype</span><span class='Delimiter'>; 
</span><a name="LN303"></a>                    <a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>       <span class='Declare_Local'>btstrategy</span><span class='Delimiter'>; 
</span> 
                    <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN646"><span class='Ref_to_Member'>reverse_sort</span></a><span class='Delimiter'>[</span><a href="plancat.c.html#LN183"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plancat.c.html#LN299"><span class='Ref_To_Local'>opt</span></a> <span class='Operator'>& </span><a href="../../../include/catalog/pg_index.h.html#LN98"><span class='Ref_to_Const'>INDOPTION_DESC</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                    <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN647"><span class='Ref_to_Member'>nulls_first</span></a><span class='Delimiter'>[</span><a href="plancat.c.html#LN183"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plancat.c.html#LN299"><span class='Ref_To_Local'>opt</span></a> <span class='Operator'>& </span><a href="../../../include/catalog/pg_index.h.html#LN99"><span class='Ref_to_Const'>INDOPTION_NULLS_FIRST</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
                    <a href="plancat.c.html#LN300"><span class='Ref_To_Local'>ltopr</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN70"><span class='Ref_to_Proto'>get_opfamily_member</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN643"><span class='Ref_to_Member'>opfamily</span></a><span class='Delimiter'>[</span><a href="plancat.c.html#LN183"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                                                <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN644"><span class='Ref_to_Member'>opcintype</span></a><span class='Delimiter'>[</span><a href="plancat.c.html#LN183"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                                                <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN644"><span class='Ref_to_Member'>opcintype</span></a><span class='Delimiter'>[</span><a href="plancat.c.html#LN183"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                                                <a href="../../../include/access/stratnum.h.html#LN28"><span class='Ref_to_Const'>BTLessStrategyNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN300"><span class='Ref_To_Local'>ltopr</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>                        <a href="../../../include/utils/lsyscache.h.html#LN72"><span class='Ref_to_Proto'>get_ordering_op_properties</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN300"><span class='Ref_To_Local'>ltopr</span></a><span class='Delimiter'>, 
</span>                                                   <span class='Operator'>&</span><a href="plancat.c.html#LN301"><span class='Ref_To_Local'>btopfamily</span></a><span class='Delimiter'>, 
</span>                                                   <span class='Operator'>&</span><a href="plancat.c.html#LN302"><span class='Ref_To_Local'>btopcintype</span></a><span class='Delimiter'>, 
</span>                                                   <span class='Operator'>&</span><a href="plancat.c.html#LN303"><span class='Ref_To_Local'>btstrategy</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>                        <a href="plancat.c.html#LN302"><span class='Ref_To_Local'>btopcintype</span></a> <span class='Operator'>== </span><a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN644"><span class='Ref_to_Member'>opcintype</span></a><span class='Delimiter'>[</span><a href="plancat.c.html#LN183"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>&& 
</span>                        <a href="plancat.c.html#LN303"><span class='Ref_To_Local'>btstrategy</span></a> <span class='Operator'>== </span><a href="../../../include/access/stratnum.h.html#LN28"><span class='Ref_to_Const'>BTLessStrategyNumber</span></a><span class='Parentheses'>)</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* Successful mapping */ 
</span>                        <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN645"><span class='Ref_to_Member'>sortopfamily</span></a><span class='Delimiter'>[</span><a href="plancat.c.html#LN183"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="plancat.c.html#LN301"><span class='Ref_To_Local'>btopfamily</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* Fail ... quietly treat index as unordered */ 
</span>                        <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN645"><span class='Ref_to_Member'>sortopfamily</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                        <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN646"><span class='Ref_to_Member'>reverse_sort</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                        <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN647"><span class='Ref_to_Member'>nulls_first</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;ncolumns;i++ &raquo; </span> 
            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if amroutine-&GT;amcanorder &raquo; </span> 
            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN645"><span class='Ref_to_Member'>sortopfamily</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN646"><span class='Ref_to_Member'>reverse_sort</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN647"><span class='Ref_to_Member'>nulls_first</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Fetch the index expressions and predicate, if any.  We must 
             * modify the copies we obtain from the relcache to have the 
             * correct varno for the parent relation, so that they match up 
             * correctly against qual clauses. 
             */ 
</span>            <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN652"><span class='Ref_to_Member'>indexprs</span></a> <span class='Operator'>= </span><a href="../../../include/utils/relcache.h.html#LN45"><span class='Ref_to_Proto'>RelationGetIndexExpressions</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN178"><span class='Ref_To_Local'>indexRelation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN653"><span class='Ref_to_Member'>indpred</span></a> <span class='Operator'>= </span><a href="../../../include/utils/relcache.h.html#LN46"><span class='Ref_to_Proto'>RelationGetIndexPredicate</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN178"><span class='Ref_To_Local'>indexRelation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN652"><span class='Ref_to_Member'>indexprs</span></a> <span class='Operator'>&& </span><a href="plancat.c.html#LN103"><span class='Ref_To_Local'>varno</span></a> <span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                <a href="../../../include/rewrite/rewriteManip.h.html#LN42"><span class='Ref_to_Proto'>ChangeVarNodes</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN652"><span class='Ref_to_Member'>indexprs</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="plancat.c.html#LN103"><span class='Ref_To_Local'>varno</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN653"><span class='Ref_to_Member'>indpred</span></a> <span class='Operator'>&& </span><a href="plancat.c.html#LN103"><span class='Ref_To_Local'>varno</span></a> <span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                <a href="../../../include/rewrite/rewriteManip.h.html#LN42"><span class='Ref_to_Proto'>ChangeVarNodes</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN653"><span class='Ref_to_Member'>indpred</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="plancat.c.html#LN103"><span class='Ref_To_Local'>varno</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Build targetlist using the completed indexprs data */ 
</span>            <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN655"><span class='Ref_to_Member'>indextlist</span></a> <span class='Operator'>= </span><a href="plancat.c.html#LN67"><span class='Ref_to_Proto'>build_index_tlist</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN100"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN104"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN657"><span class='Ref_to_Member'>indrestrictinfo</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* set later, in indxpath.c */ 
</span>            <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN662"><span class='Ref_to_Member'>predOK</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* set later, in indxpath.c */ 
</span>            <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN663"><span class='Ref_to_Member'>unique</span></a> <span class='Operator'>= </span><a href="plancat.c.html#LN179"><span class='Ref_To_Local'>index</span></a><span class='Operator'>-&GT;</span>indisunique<span class='Delimiter'>; 
</span>            <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN664"><span class='Ref_to_Member'>immediate</span></a> <span class='Operator'>= </span><a href="plancat.c.html#LN179"><span class='Ref_To_Local'>index</span></a><span class='Operator'>-&GT;</span>indimmediate<span class='Delimiter'>; 
</span>            <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN665"><span class='Ref_to_Member'>hypothetical</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Estimate the index size.  If it's not a partial index, we lock 
             * the number-of-tuples estimate to equal the parent table; if it 
             * is partial then we have to use the same methods as we would for 
             * a table, except we can be sure that the index is not larger 
             * than the table. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN653"><span class='Ref_to_Member'>indpred</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN635"><span class='Ref_to_Member'>pages</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN198"><span class='Ref_to_Macro'>RelationGetNumberOfBlocks</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN178"><span class='Ref_To_Local'>indexRelation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN636"><span class='Ref_to_Member'>tuples</span></a> <span class='Operator'>= </span><a href="plancat.c.html#LN101"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN564"><span class='Ref_to_Member'>tuples</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span><a name="LN376"></a>                <span class='Keyword'>double</span>      <span class='Declare_Local'>allvisfrac</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* dummy */ 
</span> 
                <a href="../../../include/optimizer/plancat.h.html#LN32"><span class='Ref_to_Proto'>estimate_rel_size</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN178"><span class='Ref_To_Local'>indexRelation</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                  <span class='Operator'>&</span><a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN635"><span class='Ref_to_Member'>pages</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN636"><span class='Ref_to_Member'>tuples</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="plancat.c.html#LN376"><span class='Ref_To_Local'>allvisfrac</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN636"><span class='Ref_to_Member'>tuples</span></a> <span class='Operator'>&GT; </span><a href="plancat.c.html#LN101"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN564"><span class='Ref_to_Member'>tuples</span></a><span class='Parentheses'>) 
</span>                    <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN636"><span class='Ref_to_Member'>tuples</span></a> <span class='Operator'>= </span><a href="plancat.c.html#LN101"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN564"><span class='Ref_to_Member'>tuples</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN650"><span class='Ref_to_Member'>relam</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_am.h.html#LN69"><span class='Ref_to_Const'>BTREE_AM_OID</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* For btrees, get tree height while we have the index open */ 
</span>                <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN637"><span class='Ref_to_Member'>tree_height</span></a> <span class='Operator'>= </span><a href="../../access/nbtree/nbtpage.c.html#LN433"><span class='Ref_to_Func'>_bt_getrootheight</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN178"><span class='Ref_To_Local'>indexRelation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* For other index types, just set it to "unknown" for now */ 
</span>                <a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN637"><span class='Ref_to_Member'>tree_height</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="../../../include/access/genam.h.html#LN130"><span class='Ref_to_Proto'>index_close</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN178"><span class='Ref_To_Local'>indexRelation</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="plancat.c.html#LN106"><span class='Ref_To_Local'>indexinfos</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN215"><span class='Ref_to_Proto'>lcons</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN181"><span class='Ref_To_Local'>info</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN106"><span class='Ref_To_Local'>indexinfos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN156"><span class='Ref_To_Local'>indexoidlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if hasindex &raquo; </span> 
 
    <a href="plancat.c.html#LN101"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN561"><span class='Ref_to_Member'>indexlist</span></a> <span class='Operator'>= </span><a href="plancat.c.html#LN106"><span class='Ref_To_Local'>indexinfos</span></a><span class='Delimiter'>; 
</span> 
    <a href="plancat.c.html#LN101"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN562"><span class='Ref_to_Member'>statlist</span></a> <span class='Operator'>= </span><a href="plancat.c.html#LN69"><span class='Ref_to_Proto'>get_relation_statistics</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN101"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN104"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Grab foreign-table info using the relcache, while we have it */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN104"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../../include/catalog/pg_class.h.html#LN166"><span class='Ref_to_Const'>RELKIND_FOREIGN_TABLE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="plancat.c.html#LN101"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN571"><span class='Ref_to_Member'>serverid</span></a> <span class='Operator'>= </span><a href="../../../include/foreign/fdwapi.h.html#LN233"><span class='Ref_to_Proto'>GetForeignServerIdByRelId</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN104"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="plancat.c.html#LN101"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN575"><span class='Ref_to_Member'>fdwroutine</span></a> <span class='Operator'>= </span><a href="../../../include/foreign/fdwapi.h.html#LN236"><span class='Ref_to_Proto'>GetFdwRoutineForRelation</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN104"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="plancat.c.html#LN101"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN571"><span class='Ref_to_Member'>serverid</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <a href="plancat.c.html#LN101"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN575"><span class='Ref_to_Member'>fdwroutine</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Collect info about relation's foreign keys, if relevant */ 
</span>    <a href="plancat.c.html#LN59"><span class='Ref_to_Proto'>get_relation_foreign_keys</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN100"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN101"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN104"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN100"><span class='Ref_to_Parameter'>inhparent</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN104"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Allow a plugin to editorialize on the info we obtained from the 
     * catalogs.  Actions might include altering the assumed relation size, 
     * removing an index, or adding a hypothetical index to the indexlist. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN56"><span class='Ref_to_Global_Var'>get_relation_info_hook</span></a><span class='Parentheses'>) 
</span>        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="plancat.c.html#LN56"><span class='Ref_to_Global_Var'>get_relation_info_hook</span></a><span class='Parentheses'>) (</span><a href="plancat.c.html#LN100"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN100"><span class='Ref_to_Parameter'>relationObjectId</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN100"><span class='Ref_to_Parameter'>inhparent</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN101"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_relation_info &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * get_relation_foreign_keys - 
 *    Retrieves foreign key information for a given relation. 
 * 
 * ForeignKeyOptInfos for relevant foreign keys are created and added to 
 * root-&GT;fkey_list.  We do this now while we have the relcache entry open. 
 * We could sometimes avoid making useless ForeignKeyOptInfos if we waited 
 * until all RelOptInfos have been built, but the cost of re-opening the 
 * relcache entries would probably exceed any savings. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN444"></a><span class='Declare_Function'>get_relation_foreign_keys</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN445"></a>                          <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>inhparent</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN447"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>rtable</span> <span class='Operator'>= </span><a href="plancat.c.html#LN444"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN134"><span class='Ref_to_Member'>rtable</span></a><span class='Delimiter'>; 
</span><a name="LN448"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>cachedfkeys</span><span class='Delimiter'>; 
</span><a name="LN449"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If it's not a baserel, we don't care about its FKs.  Also, if the query 
     * references only a single relation, we can skip the lookup since no FKs 
     * could satisfy the requirements below. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN444"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN521"><span class='Ref_to_Member'>reloptkind</span></a> <span class='Operator'>!= </span><a href="../../../include/nodes/relation.h.html#LN493"><span class='Ref_to_EnumConst'>RELOPT_BASEREL</span></a> <span class='Operator'>|| 
</span>        <a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN447"><span class='Ref_To_Local'>rtable</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>2</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If it's the parent of an inheritance tree, ignore its FKs.  We could 
     * make useful FK-based deductions if we found that all members of the 
     * inheritance tree have equivalent FK constraints, but detecting that 
     * would require code that hasn't been written. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN445"><span class='Ref_to_Parameter'>inhparent</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Extract data about relation's FKs from the relcache.  Note that this 
     * list belongs to the relcache and might disappear in a cache flush, so 
     * we must not do any further catalog access within this function. 
     */ 
</span>    <a href="plancat.c.html#LN448"><span class='Ref_To_Local'>cachedfkeys</span></a> <span class='Operator'>= </span><a href="../../../include/utils/relcache.h.html#LN39"><span class='Ref_to_Proto'>RelationGetFKeyList</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN445"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Figure out which FKs are of interest for this query, and create 
     * ForeignKeyOptInfos for them.  We want only FKs that reference some 
     * other RTE of the current query.  In queries containing self-joins, 
     * there might be more than one other RTE for a referenced table, and we 
     * should make a ForeignKeyOptInfo for each occurrence. 
     * 
     * Ideally, we would ignore RTEs that correspond to non-baserels, but it's 
     * too hard to identify those here, so we might end up making some useless 
     * ForeignKeyOptInfos.  If so, match_foreign_keys_to_quals() will remove 
     * them again. 
     */ 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN449"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN448"><span class='Ref_To_Local'>cachedfkeys</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN490"></a>        <a href="../../../include/utils/rel.h.html#LN235"><span class='Ref_to_Struct'>ForeignKeyCacheInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cachedfk</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN235"><span class='Ref_to_Struct'>ForeignKeyCacheInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN449"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN491"></a>        <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a>       <span class='Declare_Local'>rti</span><span class='Delimiter'>; 
</span><a name="LN492"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc2</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* conrelid should always be that of the table we're considering */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="plancat.c.html#LN490"><span class='Ref_To_Local'>cachedfk</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN238"><span class='Ref_to_Member'>conrelid</span></a> <span class='Operator'>== </span><a href="../../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN445"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Scan to find other RTEs matching confrelid */ 
</span>        <a href="plancat.c.html#LN491"><span class='Ref_To_Local'>rti</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN492"><span class='Ref_To_Local'>lc2</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN447"><span class='Ref_To_Local'>rtable</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN501"></a>            <a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rte</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN492"><span class='Ref_To_Local'>lc2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN502"></a>            <a href="../../../include/nodes/relation.h.html#LN687"><span class='Ref_to_Struct'>ForeignKeyOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>info</span><span class='Delimiter'>; 
</span> 
            <a href="plancat.c.html#LN491"><span class='Ref_To_Local'>rti</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Ignore if not the correct table */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN501"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN936"><span class='Ref_to_Member'>rtekind</span></a> <span class='Operator'>!= </span><a href="../../../include/nodes/parsenodes.h.html#LN922"><span class='Ref_to_EnumConst'>RTE_RELATION</span></a> <span class='Operator'>|| 
</span>                <a href="plancat.c.html#LN501"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN947"><span class='Ref_to_Member'>relid</span></a> <span class='Operator'>!= </span><a href="plancat.c.html#LN490"><span class='Ref_To_Local'>cachedfk</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN239"><span class='Ref_to_Member'>confrelid</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Ignore if it's an inheritance parent; doesn't really match */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN501"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1025"><span class='Ref_to_Member'>inh</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Ignore self-referential FKs; we only care about joins */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN491"><span class='Ref_To_Local'>rti</span></a> <span class='Operator'>== </span><a href="plancat.c.html#LN444"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN552"><span class='Ref_to_Member'>relid</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* OK, let's make an entry */ 
</span>            <a href="plancat.c.html#LN502"><span class='Ref_To_Local'>info</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN687"><span class='Ref_to_Struct'>ForeignKeyOptInfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="plancat.c.html#LN502"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN692"><span class='Ref_to_Member'>con_relid</span></a> <span class='Operator'>= </span><a href="plancat.c.html#LN444"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN552"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>; 
</span>            <a href="plancat.c.html#LN502"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN693"><span class='Ref_to_Member'>ref_relid</span></a> <span class='Operator'>= </span><a href="plancat.c.html#LN491"><span class='Ref_To_Local'>rti</span></a><span class='Delimiter'>; 
</span>            <a href="plancat.c.html#LN502"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN694"><span class='Ref_to_Member'>nkeys</span></a> <span class='Operator'>= </span><a href="plancat.c.html#LN490"><span class='Ref_To_Local'>cachedfk</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN240"><span class='Ref_to_Member'>nkeys</span></a><span class='Delimiter'>; 
</span>            memcpy<span class='Parentheses'>(</span><a href="plancat.c.html#LN502"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN695"><span class='Ref_to_Member'>conkey</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN490"><span class='Ref_To_Local'>cachedfk</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN242"><span class='Ref_to_Member'>conkey</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="plancat.c.html#LN502"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN695"><span class='Ref_to_Member'>conkey</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            memcpy<span class='Parentheses'>(</span><a href="plancat.c.html#LN502"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN696"><span class='Ref_to_Member'>confkey</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN490"><span class='Ref_To_Local'>cachedfk</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN243"><span class='Ref_to_Member'>confkey</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="plancat.c.html#LN502"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN696"><span class='Ref_to_Member'>confkey</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            memcpy<span class='Parentheses'>(</span><a href="plancat.c.html#LN502"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN697"><span class='Ref_to_Member'>conpfeqop</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN490"><span class='Ref_To_Local'>cachedfk</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN244"><span class='Ref_to_Member'>conpfeqop</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="plancat.c.html#LN502"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN697"><span class='Ref_to_Member'>conpfeqop</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* zero out fields to be filled by match_foreign_keys_to_quals */ 
</span>            <a href="plancat.c.html#LN502"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN700"><span class='Ref_to_Member'>nmatched_ec</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="plancat.c.html#LN502"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN701"><span class='Ref_to_Member'>nmatched_rcols</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="plancat.c.html#LN502"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN702"><span class='Ref_to_Member'>nmatched_ri</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            memset<span class='Parentheses'>(</span><a href="plancat.c.html#LN502"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN704"><span class='Ref_to_Member'>eclass</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="plancat.c.html#LN502"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN704"><span class='Ref_to_Member'>eclass</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            memset<span class='Parentheses'>(</span><a href="plancat.c.html#LN502"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN706"><span class='Ref_to_Member'>rinfos</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="plancat.c.html#LN502"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN706"><span class='Ref_to_Member'>rinfos</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <a href="plancat.c.html#LN444"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN259"><span class='Ref_to_Member'>fkey_list</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN444"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN259"><span class='Ref_to_Member'>fkey_list</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN502"><span class='Ref_To_Local'>info</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end get_relation_foreign_keys &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * infer_arbiter_indexes - 
 *    Determine the unique indexes used to arbitrate speculative insertion. 
 * 
 * Uses user-supplied inference clause expressions and predicate to match a 
 * unique index from those defined and ready on the heap relation (target). 
 * An exact match is required on columns/expressions (although they can appear 
 * in any order).  However, the predicate given by the user need only restrict 
 * insertion to a subset of some part of the table covered by some particular 
 * unique index (in particular, a partial unique index) in order to be 
 * inferred. 
 * 
 * The implementation does not consider which B-Tree operator class any 
 * particular available unique index attribute uses, unless one was specified 
 * in the inference specification. The same is true of collations.  In 
 * particular, there is no system dependency on the default operator class for 
 * the purposes of inference.  If no opclass (or collation) is specified, then 
 * all matching indexes (that may or may not match the default in terms of 
 * each attribute opclass/collation) are used for inference. 
 */ 
</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN557"></a><span class='Declare_Function'>infer_arbiter_indexes</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN559"></a>    <a href="../../../include/nodes/primnodes.h.html#LN1482"><span class='Ref_to_Struct'>OnConflictExpr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>onconflict</span> <span class='Operator'>= </span><a href="plancat.c.html#LN557"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN141"><span class='Ref_to_Member'>onConflict</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Iteration state */ 
</span><a name="LN562"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>relation</span><span class='Delimiter'>; 
</span><a name="LN563"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relationObjectId</span><span class='Delimiter'>; 
</span><a name="LN564"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>indexOidFromConstraint</span> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span><a name="LN565"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>indexList</span><span class='Delimiter'>; 
</span><a name="LN566"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Normalized inference attributes and inference expressions: */ 
</span><a name="LN569"></a>    <a href="../../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>inferAttrs</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN570"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>inferElems</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Results */ 
</span><a name="LN573"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>results</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Quickly return NIL for ON CONFLICT DO NOTHING without an inference 
     * specification or named constraint.  ON CONFLICT DO UPDATE statements 
     * must always provide one or the other (but parser ought to have caught 
     * that already). 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN559"><span class='Ref_To_Local'>onconflict</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1488"><span class='Ref_to_Member'>arbiterElems</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a> <span class='Operator'>&& 
</span>        <a href="plancat.c.html#LN559"><span class='Ref_To_Local'>onconflict</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1491"><span class='Ref_to_Member'>constraint</span></a> <span class='Operator'>== </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We need not lock the relation since it was already locked, either by 
     * the rewriter or when expand_inherited_rtentry() added it to the query's 
     * rangetable. 
     */ 
</span>    <a href="plancat.c.html#LN563"><span class='Ref_To_Local'>relationObjectId</span></a> <span class='Operator'>= </span><a href="../../../include/parser/parsetree.h.html#LN30"><span class='Ref_to_Macro'>rt_fetch</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN557"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN119"><span class='Ref_to_Member'>resultRelation</span></a><span class='Delimiter'>, 
</span>                                <a href="plancat.c.html#LN557"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN134"><span class='Ref_to_Member'>rtable</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>relid<span class='Delimiter'>; 
</span> 
    <a href="plancat.c.html#LN562"><span class='Ref_To_Local'>relation</span></a> <span class='Operator'>= </span><a href="../../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN563"><span class='Ref_To_Local'>relationObjectId</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Build normalized/BMS representation of plain indexed attributes, as 
     * well as a separate list of expression items.  This simplifies matching 
     * the cataloged definition of indexes. 
     */ 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN566"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN559"><span class='Ref_To_Local'>onconflict</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1488"><span class='Ref_to_Member'>arbiterElems</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN602"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1287"><span class='Ref_to_Struct'>InferenceElem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>elem</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1287"><span class='Ref_to_Struct'>InferenceElem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN566"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN603"></a>        <a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>var</span><span class='Delimiter'>; 
</span><a name="LN604"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>attno</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN602"><span class='Ref_To_Local'>elem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1290"><span class='Ref_to_Member'>expr</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* If not a plain Var, just shove it in inferElems for now */ 
</span>            <a href="plancat.c.html#LN570"><span class='Ref_To_Local'>inferElems</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN570"><span class='Ref_To_Local'>inferElems</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN602"><span class='Ref_To_Local'>elem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1290"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="plancat.c.html#LN603"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="plancat.c.html#LN602"><span class='Ref_To_Local'>elem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1290"><span class='Ref_to_Member'>expr</span></a><span class='Delimiter'>; 
</span>        <a href="plancat.c.html#LN604"><span class='Ref_To_Local'>attno</span></a> <span class='Operator'>= </span><a href="plancat.c.html#LN603"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN167"><span class='Ref_to_Member'>varattno</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN604"><span class='Ref_To_Local'>attno</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"whole row unique index inference specifications are not supported"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="plancat.c.html#LN569"><span class='Ref_To_Local'>inferAttrs</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN89"><span class='Ref_to_Proto'>bms_add_member</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN569"><span class='Ref_To_Local'>inferAttrs</span></a><span class='Delimiter'>, 
</span>                                 <a href="plancat.c.html#LN604"><span class='Ref_To_Local'>attno</span></a> <span class='Operator'>- </span><a href="../../../include/access/sysattr.h.html#LN27"><span class='Ref_to_Const'>FirstLowInvalidHeapAttributeNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Lookup named constraint's index.  This is not immediately returned 
     * because some additional sanity checks are required. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN559"><span class='Ref_To_Local'>onconflict</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1491"><span class='Ref_to_Member'>constraint</span></a> <span class='Operator'>!= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="plancat.c.html#LN564"><span class='Ref_To_Local'>indexOidFromConstraint</span></a> <span class='Operator'>= </span><a href="../../../include/catalog/dependency.h.html#LN244"><span class='Ref_to_Proto'>get_constraint_index</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN559"><span class='Ref_To_Local'>onconflict</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1491"><span class='Ref_to_Member'>constraint</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN564"><span class='Ref_To_Local'>indexOidFromConstraint</span></a> <span class='Operator'>== </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"constraint in ON CONFLICT clause has no associated index"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Using that representation, iterate through the list of indexes on the 
     * target relation to try and find a match 
     */ 
</span>    <a href="plancat.c.html#LN565"><span class='Ref_To_Local'>indexList</span></a> <span class='Operator'>= </span><a href="../../../include/utils/relcache.h.html#LN40"><span class='Ref_to_Proto'>RelationGetIndexList</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN562"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN566"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN565"><span class='Ref_To_Local'>indexList</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN647"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>indexoid</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN566"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN648"></a>        <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>idxRel</span><span class='Delimiter'>; 
</span><a name="LN649"></a>        <a href="../../../include/catalog/pg_index.h.html#LN66"><span class='Ref_to_Typedef'>Form_pg_index</span></a> <span class='Declare_Local'>idxForm</span><span class='Delimiter'>; 
</span><a name="LN650"></a>        <a href="../../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>indexedAttrs</span><span class='Delimiter'>; 
</span><a name="LN651"></a>        <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>idxExprs</span><span class='Delimiter'>; 
</span><a name="LN652"></a>        <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>predExprs</span><span class='Delimiter'>; 
</span><a name="LN653"></a>        <a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>natt</span><span class='Delimiter'>; 
</span><a name="LN654"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>el</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Extract info from the relation descriptor for the index.  We know 
         * that this is a target, so get lock type it is known will ultimately 
         * be required by the executor. 
         * 
         * Let executor complain about !indimmediate case directly, because 
         * enforcement needs to occur there anyway when an inference clause is 
         * omitted. 
         */ 
</span>        <a href="plancat.c.html#LN648"><span class='Ref_To_Local'>idxRel</span></a> <span class='Operator'>= </span><a href="../../../include/access/genam.h.html#LN129"><span class='Ref_to_Proto'>index_open</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN647"><span class='Ref_To_Local'>indexoid</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="plancat.c.html#LN649"><span class='Ref_To_Local'>idxForm</span></a> <span class='Operator'>= </span><a href="plancat.c.html#LN648"><span class='Ref_To_Local'>idxRel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN158"><span class='Ref_to_Member'>rd_index</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/catalog/pg_index.h.html#LN106"><span class='Ref_to_Macro'>IndexIsValid</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN649"><span class='Ref_To_Local'>idxForm</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="plancat.c.html#LN782"><span class='Ref_to_Label'>next</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Note that we do not perform a check against indcheckxmin (like e.g. 
         * get_relation_info()) here to eliminate candidates, because 
         * uniqueness checking only cares about the most recently committed 
         * tuple versions. 
         */ 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Look for match on "ON constraint_name" variant, which may not be 
         * unique constraint.  This can only be a constraint name. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN564"><span class='Ref_To_Local'>indexOidFromConstraint</span></a> <span class='Operator'>== </span><a href="plancat.c.html#LN649"><span class='Ref_To_Local'>idxForm</span></a><span class='Operator'>-&GT;</span>indexrelid<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="plancat.c.html#LN649"><span class='Ref_To_Local'>idxForm</span></a><span class='Operator'>-&GT;</span>indisunique <span class='Operator'>&& </span><a href="plancat.c.html#LN559"><span class='Ref_To_Local'>onconflict</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1485"><span class='Ref_to_Member'>action</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/nodes.h.html#LN801"><span class='Ref_to_EnumConst'>ONCONFLICT_UPDATE</span></a><span class='Parentheses'>) 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"ON CONFLICT DO UPDATE not supported with exclusion constraints"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <a href="plancat.c.html#LN573"><span class='Ref_To_Local'>results</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN573"><span class='Ref_To_Local'>results</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN649"><span class='Ref_To_Local'>idxForm</span></a><span class='Operator'>-&GT;</span>indexrelid<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN565"><span class='Ref_To_Local'>indexList</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/access/genam.h.html#LN130"><span class='Ref_to_Proto'>index_close</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN648"><span class='Ref_To_Local'>idxRel</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN562"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <a href="plancat.c.html#LN573"><span class='Ref_To_Local'>results</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN564"><span class='Ref_To_Local'>indexOidFromConstraint</span></a> <span class='Operator'>!= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* No point in further work for index in named constraint case */ 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="plancat.c.html#LN782"><span class='Ref_to_Label'>next</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Only considering conventional inference at this point (not named 
         * constraints), so index under consideration can be immediately 
         * skipped if it's not unique 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="plancat.c.html#LN649"><span class='Ref_To_Local'>idxForm</span></a><span class='Operator'>-&GT;</span>indisunique<span class='Parentheses'>) 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="plancat.c.html#LN782"><span class='Ref_to_Label'>next</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Build BMS representation of plain (non expression) index attrs */ 
</span>        <a href="plancat.c.html#LN650"><span class='Ref_To_Local'>indexedAttrs</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN653"><span class='Ref_To_Local'>natt</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="plancat.c.html#LN653"><span class='Ref_To_Local'>natt</span></a> <span class='Operator'>&LT; </span><a href="plancat.c.html#LN649"><span class='Ref_To_Local'>idxForm</span></a><span class='Operator'>-&GT;</span>indnatts<span class='Delimiter'>; </span><a href="plancat.c.html#LN653"><span class='Ref_To_Local'>natt</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN713"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>attno</span> <span class='Operator'>= </span><a href="plancat.c.html#LN648"><span class='Ref_To_Local'>idxRel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN158"><span class='Ref_to_Member'>rd_index</span></a><span class='Operator'>-&GT;</span>indkey<span class='Operator'>.</span>values<span class='Delimiter'>[</span><a href="plancat.c.html#LN653"><span class='Ref_To_Local'>natt</span></a><span class='Delimiter'>]; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN713"><span class='Ref_To_Local'>attno</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="plancat.c.html#LN650"><span class='Ref_To_Local'>indexedAttrs</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN89"><span class='Ref_to_Proto'>bms_add_member</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN650"><span class='Ref_To_Local'>indexedAttrs</span></a><span class='Delimiter'>, 
</span>                                 <a href="plancat.c.html#LN713"><span class='Ref_To_Local'>attno</span></a> <span class='Operator'>- </span><a href="../../../include/access/sysattr.h.html#LN27"><span class='Ref_to_Const'>FirstLowInvalidHeapAttributeNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Non-expression attributes (if any) must match */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/bitmapset.h.html#LN66"><span class='Ref_to_Proto'>bms_equal</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN650"><span class='Ref_To_Local'>indexedAttrs</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN569"><span class='Ref_To_Local'>inferAttrs</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="plancat.c.html#LN782"><span class='Ref_to_Label'>next</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Expression attributes (if any) must match */ 
</span>        <a href="plancat.c.html#LN651"><span class='Ref_To_Local'>idxExprs</span></a> <span class='Operator'>= </span><a href="../../../include/utils/relcache.h.html#LN45"><span class='Ref_to_Proto'>RelationGetIndexExpressions</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN648"><span class='Ref_To_Local'>idxRel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN654"><span class='Ref_To_Local'>el</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN559"><span class='Ref_To_Local'>onconflict</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1488"><span class='Ref_to_Member'>arbiterElems</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN728"></a>            <a href="../../../include/nodes/primnodes.h.html#LN1287"><span class='Ref_to_Struct'>InferenceElem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>elem</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1287"><span class='Ref_to_Struct'>InferenceElem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN654"><span class='Ref_To_Local'>el</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Ensure that collation/opclass aspects of inference expression 
             * element match.  Even though this loop is primarily concerned 
             * with matching expressions, it is a convenient point to check 
             * this for both expressions and ordinary (non-expression) 
             * attributes appearing as inference elements. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="plancat.c.html#LN61"><span class='Ref_to_Proto'>infer_collation_opclass_match</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN728"><span class='Ref_To_Local'>elem</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN648"><span class='Ref_To_Local'>idxRel</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN651"><span class='Ref_To_Local'>idxExprs</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="plancat.c.html#LN782"><span class='Ref_to_Label'>next</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Plain Vars don't factor into count of expression elements, and 
             * the question of whether or not they satisfy the index 
             * definition has already been considered (they must). 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN728"><span class='Ref_To_Local'>elem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1290"><span class='Ref_to_Member'>expr</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Might as well avoid redundant check in the rare cases where 
             * infer_collation_opclass_match() is required to do real work. 
             * Otherwise, check that element expression appears in cataloged 
             * index definition. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN728"><span class='Ref_To_Local'>elem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1291"><span class='Ref_to_Member'>infercollid</span></a> <span class='Operator'>!= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a> <span class='Operator'>|| 
</span>                <a href="plancat.c.html#LN728"><span class='Ref_To_Local'>elem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1292"><span class='Ref_to_Member'>inferopclass</span></a> <span class='Operator'>!= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a> <span class='Operator'>|| 
</span>                <a href="../../../include/nodes/pg_list.h.html#LN228"><span class='Ref_to_Proto'>list_member</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN651"><span class='Ref_To_Local'>idxExprs</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN728"><span class='Ref_To_Local'>elem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1290"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="plancat.c.html#LN782"><span class='Ref_to_Label'>next</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Now that all inference elements were matched, ensure that the 
         * expression elements from inference clause are not missing any 
         * cataloged expressions.  This does the right thing when unique 
         * indexes redundantly repeat the same attribute, or if attributes 
         * redundantly appear multiple times within an inference clause. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN250"><span class='Ref_to_Proto'>list_difference</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN651"><span class='Ref_To_Local'>idxExprs</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN570"><span class='Ref_To_Local'>inferElems</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span> 
            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="plancat.c.html#LN782"><span class='Ref_to_Label'>next</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If it's a partial index, its predicate must be implied by the ON 
         * CONFLICT's WHERE clause. 
         */ 
</span>        <a href="plancat.c.html#LN652"><span class='Ref_To_Local'>predExprs</span></a> <span class='Operator'>= </span><a href="../../../include/utils/relcache.h.html#LN46"><span class='Ref_to_Proto'>RelationGetIndexPredicate</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN648"><span class='Ref_To_Local'>idxRel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/optimizer/predtest.h.html#LN19"><span class='Ref_to_Proto'>predicate_implied_by</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN652"><span class='Ref_To_Local'>predExprs</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="plancat.c.html#LN559"><span class='Ref_To_Local'>onconflict</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1490"><span class='Ref_to_Member'>arbiterWhere</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="plancat.c.html#LN782"><span class='Ref_to_Label'>next</span></a><span class='Delimiter'>; 
</span> 
        <a href="plancat.c.html#LN573"><span class='Ref_To_Local'>results</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN573"><span class='Ref_To_Local'>results</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN649"><span class='Ref_To_Local'>idxForm</span></a><span class='Operator'>-&GT;</span>indexrelid<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN782"></a><span class='Label'>next</span><span class='Operator'>: 
</span>        <a href="../../../include/access/genam.h.html#LN130"><span class='Ref_to_Proto'>index_close</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN648"><span class='Ref_To_Local'>idxRel</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN565"><span class='Ref_To_Local'>indexList</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN562"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN573"><span class='Ref_To_Local'>results</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_COLUMN_REFERENCE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"there is no unique or exclusion constraint matching the ON CONFLICT specification"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="plancat.c.html#LN573"><span class='Ref_To_Local'>results</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end infer_arbiter_indexes &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * infer_collation_opclass_match - ensure infer element opclass/collation match 
 * 
 * Given unique index inference element from inference specification, if 
 * collation was specified, or if opclass was specified, verify that there is 
 * at least one matching indexed attribute (occasionally, there may be more). 
 * Skip this in the common case where inference specification does not include 
 * collation or opclass (instead matching everything, regardless of cataloged 
 * collation/opclass of indexed attribute). 
 * 
 * At least historically, Postgres has not offered collations or opclasses 
 * with alternative-to-default notions of equality, so these additional 
 * criteria should only be required infrequently. 
 * 
 * Don't give up immediately when an inference element matches some attribute 
 * cataloged as indexed but not matching additional opclass/collation 
 * criteria.  This is done so that the implementation is as forgiving as 
 * possible of redundancy within cataloged index attributes (or, less 
 * usefully, within inference specification elements).  If collations actually 
 * differ between apparently redundantly indexed attributes (redundant within 
 * or across indexes), then there really is no redundancy as such. 
 * 
 * Note that if an inference element specifies an opclass and a collation at 
 * once, both must match in at least one particular attribute within index 
 * catalog definition in order for that inference element to be considered 
 * inferred/satisfied. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN825"></a><span class='Declare_Function'>infer_collation_opclass_match</span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1287"><span class='Ref_to_Struct'>InferenceElem</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>elem</span><span class='Delimiter'>, </span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>idxRel</span><span class='Delimiter'>, 
</span><a name="LN826"></a>                              <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>idxExprs</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN828"></a>    <a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>natt</span><span class='Delimiter'>; 
</span><a name="LN829"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>inferopfamily</span> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* OID of opclass opfamily */ 
</span><a name="LN830"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>inferopcinputtype</span> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* OID of opclass input type */ 
</span><a name="LN831"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nplain</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* # plain attrs observed */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If inference specification element lacks collation/opclass, then no 
     * need to check for exact match. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN825"><span class='Ref_to_Parameter'>elem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1291"><span class='Ref_to_Member'>infercollid</span></a> <span class='Operator'>== </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a> <span class='Operator'>&& </span><a href="plancat.c.html#LN825"><span class='Ref_to_Parameter'>elem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1292"><span class='Ref_to_Member'>inferopclass</span></a> <span class='Operator'>== </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Lookup opfamily and input type, for matching indexes 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN825"><span class='Ref_to_Parameter'>elem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1292"><span class='Ref_to_Member'>inferopclass</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="plancat.c.html#LN829"><span class='Ref_To_Local'>inferopfamily</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN96"><span class='Ref_to_Proto'>get_opclass_family</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN825"><span class='Ref_to_Parameter'>elem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1292"><span class='Ref_to_Member'>inferopclass</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="plancat.c.html#LN830"><span class='Ref_To_Local'>inferopcinputtype</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN97"><span class='Ref_to_Proto'>get_opclass_input_type</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN825"><span class='Ref_to_Parameter'>elem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1292"><span class='Ref_to_Member'>inferopclass</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN828"><span class='Ref_To_Local'>natt</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="plancat.c.html#LN828"><span class='Ref_To_Local'>natt</span></a> <span class='Operator'>&LT;= </span><a href="plancat.c.html#LN825"><span class='Ref_to_Parameter'>idxRel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; </span><a href="plancat.c.html#LN828"><span class='Ref_To_Local'>natt</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN851"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>opfamily</span> <span class='Operator'>= </span><a href="plancat.c.html#LN825"><span class='Ref_to_Parameter'>idxRel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN181"><span class='Ref_to_Member'>rd_opfamily</span></a><span class='Delimiter'>[</span><a href="plancat.c.html#LN828"><span class='Ref_To_Local'>natt</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN852"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>opcinputtype</span> <span class='Operator'>= </span><a href="plancat.c.html#LN825"><span class='Ref_to_Parameter'>idxRel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN182"><span class='Ref_to_Member'>rd_opcintype</span></a><span class='Delimiter'>[</span><a href="plancat.c.html#LN828"><span class='Ref_To_Local'>natt</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN853"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>collation</span> <span class='Operator'>= </span><a href="plancat.c.html#LN825"><span class='Ref_to_Parameter'>idxRel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN192"><span class='Ref_to_Member'>rd_indcollation</span></a><span class='Delimiter'>[</span><a href="plancat.c.html#LN828"><span class='Ref_To_Local'>natt</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN854"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>attno</span> <span class='Operator'>= </span><a href="plancat.c.html#LN825"><span class='Ref_to_Parameter'>idxRel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN158"><span class='Ref_to_Member'>rd_index</span></a><span class='Operator'>-&GT;</span>indkey<span class='Operator'>.</span>values<span class='Delimiter'>[</span><a href="plancat.c.html#LN828"><span class='Ref_To_Local'>natt</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN854"><span class='Ref_To_Local'>attno</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="plancat.c.html#LN831"><span class='Ref_To_Local'>nplain</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN825"><span class='Ref_to_Parameter'>elem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1292"><span class='Ref_to_Member'>inferopclass</span></a> <span class='Operator'>!= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a> <span class='Operator'>&& 
</span>            <span class='Parentheses'>(</span><a href="plancat.c.html#LN829"><span class='Ref_To_Local'>inferopfamily</span></a> <span class='Operator'>!= </span><a href="plancat.c.html#LN851"><span class='Ref_To_Local'>opfamily</span></a> <span class='Operator'>|| </span><a href="plancat.c.html#LN830"><span class='Ref_To_Local'>inferopcinputtype</span></a> <span class='Operator'>!= </span><a href="plancat.c.html#LN852"><span class='Ref_To_Local'>opcinputtype</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Attribute needed to match opclass, but didn't */ 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN825"><span class='Ref_to_Parameter'>elem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1291"><span class='Ref_to_Member'>infercollid</span></a> <span class='Operator'>!= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a> <span class='Operator'>&& 
</span>            <a href="plancat.c.html#LN825"><span class='Ref_to_Parameter'>elem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1291"><span class='Ref_to_Member'>infercollid</span></a> <span class='Operator'>!= </span><a href="plancat.c.html#LN853"><span class='Ref_To_Local'>collation</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Attribute needed to match collation, but didn't */ 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* If one matching index att found, good enough -- return true */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN825"><span class='Ref_to_Parameter'>elem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1290"><span class='Ref_to_Member'>expr</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(((</span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="plancat.c.html#LN825"><span class='Ref_to_Parameter'>elem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1290"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>varattno <span class='Operator'>== </span><a href="plancat.c.html#LN854"><span class='Ref_To_Local'>attno</span></a><span class='Parentheses'>)</span> 
                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN854"><span class='Ref_To_Local'>attno</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN881"></a>            <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>nattExpr</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN223"><span class='Ref_to_Proto'>list_nth</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN826"><span class='Ref_to_Parameter'>idxExprs</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="plancat.c.html#LN828"><span class='Ref_To_Local'>natt</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="plancat.c.html#LN831"><span class='Ref_To_Local'>nplain</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Note that unlike routines like match_index_to_operand() we 
             * don't need to care about RelabelType.  Neither the index 
             * definition nor the inference clause should contain them. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN626"><span class='Ref_to_Proto'>equal</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN825"><span class='Ref_to_Parameter'>elem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1290"><span class='Ref_to_Member'>expr</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN881"><span class='Ref_To_Local'>nattExpr</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for natt=1;natt&LT;=idxRel-&GT;... &raquo; </span> 
 
    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end infer_collation_opclass_match &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * estimate_rel_size - estimate # pages and # tuples in a table or index 
 * 
 * We also estimate the fraction of the pages that are marked all-visible in 
 * the visibility map, for use in estimation of index-only scans. 
 * 
 * If attr_widths isn't NULL, it points to the zero-index entry of the 
 * relation's attr_widths[] cache; we fill this in if we have need to compute 
 * the attribute widths for estimation purposes. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN907"></a><span class='Declare_Function'>estimate_rel_size</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>attr_widths</span><span class='Delimiter'>, 
</span><a name="LN908"></a>                  <a href="../../../include/storage/block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pages</span><span class='Delimiter'>, </span><span class='Keyword'>double </span><span class='Operator'>*</span><span class='Declare_Parameter'>tuples</span><span class='Delimiter'>, </span><span class='Keyword'>double </span><span class='Operator'>*</span><span class='Declare_Parameter'>allvisfrac</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN910"></a>    <a href="../../../include/storage/block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Declare_Local'>curpages</span><span class='Delimiter'>; 
</span><a name="LN911"></a>    <a href="../../../include/storage/block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Declare_Local'>relpages</span><span class='Delimiter'>; 
</span><a name="LN912"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>reltuples</span><span class='Delimiter'>; 
</span><a name="LN913"></a>    <a href="../../../include/storage/block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Declare_Local'>relallvisible</span><span class='Delimiter'>; 
</span><a name="LN914"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>density</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN907"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_class.h.html#LN160"><span class='Ref_to_Const'>RELKIND_INDEX</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_class.h.html#LN164"><span class='Ref_to_Const'>RELKIND_MATVIEW</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_class.h.html#LN162"><span class='Ref_to_Const'>RELKIND_TOASTVALUE</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* it has storage, ok to call the smgr */ 
</span>            <a href="plancat.c.html#LN910"><span class='Ref_To_Local'>curpages</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN198"><span class='Ref_to_Macro'>RelationGetNumberOfBlocks</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN907"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * HACK: if the relation has never yet been vacuumed, use a 
             * minimum size estimate of 10 pages.  The idea here is to avoid 
             * assuming a newly-created table is really small, even if it 
             * currently is, because that may not be true once some data gets 
             * loaded into it.  Once a vacuum or analyze cycle has been done 
             * on it, it's more reasonable to believe the size is somewhat 
             * stable. 
             * 
             * (Note that this is only an issue if the plan gets cached and 
             * used again after the table has been filled.  What we're trying 
             * to avoid is using a nestloop-type plan on a table that has 
             * grown substantially since the plan was made.  Normally, 
             * autovacuum/autoanalyze will occur once enough inserts have 
             * happened and cause cached-plan invalidation; but that doesn't 
             * happen instantaneously, and it won't happen at all for cases 
             * such as temporary tables.) 
             * 
             * We approximate "never vacuumed" by "has relpages = 0", which 
             * means this will also fire on genuinely empty relations.  Not 
             * great, but fortunately that's a seldom-seen case in the real 
             * world, and it shouldn't degrade the quality of the plan too 
             * much anyway to err in this direction. 
             * 
             * There are two exceptions wherein we don't apply this heuristic. 
             * One is if the table has inheritance children.  Totally empty 
             * parent tables are quite common, so we should be willing to 
             * believe that they are empty.  Also, we don't apply the 10-page 
             * minimum to indexes. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN910"><span class='Ref_To_Local'>curpages</span></a> <span class='Operator'>&LT; </span><span class='Number'>10</span> <span class='Operator'>&& 
</span>                <a href="plancat.c.html#LN907"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relpages <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>                <span class='Operator'>!</span><a href="plancat.c.html#LN907"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relhassubclass <span class='Operator'>&& 
</span>                <a href="plancat.c.html#LN907"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../../include/catalog/pg_class.h.html#LN160"><span class='Ref_to_Const'>RELKIND_INDEX</span></a><span class='Parentheses'>) 
</span>                <a href="plancat.c.html#LN910"><span class='Ref_To_Local'>curpages</span></a> <span class='Operator'>= </span><span class='Number'>10</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* report estimated # pages */ 
</span>            <span class='Operator'>*</span><a href="plancat.c.html#LN908"><span class='Ref_to_Parameter'>pages</span></a> <span class='Operator'>= </span><a href="plancat.c.html#LN910"><span class='Ref_To_Local'>curpages</span></a><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* quick exit if rel is clearly empty */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN910"><span class='Ref_To_Local'>curpages</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Operator'>*</span><a href="plancat.c.html#LN908"><span class='Ref_to_Parameter'>tuples</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><a href="plancat.c.html#LN908"><span class='Ref_to_Parameter'>allvisfrac</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Comment_Multi_Line'>/* coerce values in pg_class to more desirable types */ 
</span>            <a href="plancat.c.html#LN911"><span class='Ref_To_Local'>relpages</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/storage/block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a><span class='Parentheses'>) </span><a href="plancat.c.html#LN907"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relpages<span class='Delimiter'>; 
</span>            <a href="plancat.c.html#LN912"><span class='Ref_To_Local'>reltuples</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="plancat.c.html#LN907"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>reltuples<span class='Delimiter'>; 
</span>            <a href="plancat.c.html#LN913"><span class='Ref_To_Local'>relallvisible</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/storage/block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a><span class='Parentheses'>) </span><a href="plancat.c.html#LN907"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relallvisible<span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * If it's an index, discount the metapage while estimating the 
             * number of tuples.  This is a kluge because it assumes more than 
             * it ought to about index structure.  Currently it's OK for 
             * btree, hash, and GIN indexes but suspect for GiST indexes. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN907"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../../include/catalog/pg_class.h.html#LN160"><span class='Ref_to_Const'>RELKIND_INDEX</span></a> <span class='Operator'>&& 
</span>                <a href="plancat.c.html#LN911"><span class='Ref_To_Local'>relpages</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="plancat.c.html#LN910"><span class='Ref_To_Local'>curpages</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>                <a href="plancat.c.html#LN911"><span class='Ref_To_Local'>relpages</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* estimate number of tuples from previous tuple density */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN911"><span class='Ref_To_Local'>relpages</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="plancat.c.html#LN914"><span class='Ref_To_Local'>density</span></a> <span class='Operator'>= </span><a href="plancat.c.html#LN912"><span class='Ref_To_Local'>reltuples</span></a> <span class='Operator'>/ </span><span class='Parentheses'>(</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="plancat.c.html#LN911"><span class='Ref_To_Local'>relpages</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * When we have no data because the relation was truncated, 
                 * estimate tuple width from attribute datatypes.  We assume 
                 * here that the pages are completely full, which is OK for 
                 * tables (since they've presumably not been VACUUMed yet) but 
                 * is probably an overestimate for indexes.  Fortunately 
                 * get_relation_info() can clamp the overestimate to the 
                 * parent table's size. 
                 * 
                 * Note: this code intentionally disregards alignment 
                 * considerations, because (a) that would be gilding the lily 
                 * considering how crude the estimate is, and (b) it creates 
                 * platform dependencies in the default plans which are kind 
                 * of a headache for regression testing. 
                 */ 
</span><a name="LN1008"></a>                <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>tuple_width</span><span class='Delimiter'>; 
</span> 
                <a href="plancat.c.html#LN1008"><span class='Ref_To_Local'>tuple_width</span></a> <span class='Operator'>= </span><a href="plancat.c.html#LN63"><span class='Ref_to_Proto'>get_rel_data_width</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN907"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN907"><span class='Ref_to_Parameter'>attr_widths</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="plancat.c.html#LN1008"><span class='Ref_To_Local'>tuple_width</span></a> <span class='Operator'>+= </span><a href="../../../include/c.h.html#LN587"><span class='Ref_to_Macro'>MAXALIGN</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN169"><span class='Ref_to_Const'>SizeofHeapTupleHeader</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="plancat.c.html#LN1008"><span class='Ref_To_Local'>tuple_width</span></a> <span class='Operator'>+= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/storage/itemid.h.html#LN23"><span class='Ref_to_Struct'>ItemIdData</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* note: integer division is intentional here */ 
</span>                <a href="plancat.c.html#LN914"><span class='Ref_To_Local'>density</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span>BLCKSZ <span class='Operator'>- </span><a href="../../../include/storage/bufpage.h.html#LN212"><span class='Ref_to_Const'>SizeOfPageHeaderData</span></a><span class='Parentheses'>) </span><span class='Operator'>/ </span><a href="plancat.c.html#LN1008"><span class='Ref_To_Local'>tuple_width</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
            <span class='Operator'>*</span><a href="plancat.c.html#LN908"><span class='Ref_to_Parameter'>tuples</span></a> <span class='Operator'>= </span><a href="../../../port/rint.c.html#LN20"><span class='Ref_to_Func'>rint</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN914"><span class='Ref_To_Local'>density</span></a> <span class='Operator'>* </span><span class='Parentheses'>(</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="plancat.c.html#LN910"><span class='Ref_To_Local'>curpages</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * We use relallvisible as-is, rather than scaling it up like we 
             * do for the pages and tuples counts, on the theory that any 
             * pages added since the last VACUUM are most likely not marked 
             * all-visible.  But costsize.c wants it converted to a fraction. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN913"><span class='Ref_To_Local'>relallvisible</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="plancat.c.html#LN910"><span class='Ref_To_Local'>curpages</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Operator'>*</span><a href="plancat.c.html#LN908"><span class='Ref_to_Parameter'>allvisfrac</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>((</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="plancat.c.html#LN913"><span class='Ref_To_Local'>relallvisible</span></a> <span class='Operator'>&GT;= </span><a href="plancat.c.html#LN910"><span class='Ref_To_Local'>curpages</span></a><span class='Parentheses'>)</span> 
                <span class='Operator'>*</span><a href="plancat.c.html#LN908"><span class='Ref_to_Parameter'>allvisfrac</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <span class='Operator'>*</span><a href="plancat.c.html#LN908"><span class='Ref_to_Parameter'>allvisfrac</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="plancat.c.html#LN913"><span class='Ref_To_Local'>relallvisible</span></a> <span class='Operator'>/ </span><a href="plancat.c.html#LN910"><span class='Ref_To_Local'>curpages</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_class.h.html#LN161"><span class='Ref_to_Const'>RELKIND_SEQUENCE</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* Sequences always have a known size */ 
</span>            <span class='Operator'>*</span><a href="plancat.c.html#LN908"><span class='Ref_to_Parameter'>pages</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="plancat.c.html#LN908"><span class='Ref_to_Parameter'>tuples</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="plancat.c.html#LN908"><span class='Ref_to_Parameter'>allvisfrac</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_class.h.html#LN166"><span class='Ref_to_Const'>RELKIND_FOREIGN_TABLE</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* Just use whatever's in pg_class */ 
</span>            <span class='Operator'>*</span><a href="plancat.c.html#LN908"><span class='Ref_to_Parameter'>pages</span></a> <span class='Operator'>= </span><a href="plancat.c.html#LN907"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relpages<span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="plancat.c.html#LN908"><span class='Ref_to_Parameter'>tuples</span></a> <span class='Operator'>= </span><a href="plancat.c.html#LN907"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>reltuples<span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="plancat.c.html#LN908"><span class='Ref_to_Parameter'>allvisfrac</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* else it has no disk storage; probably shouldn't get here? */ 
</span>            <span class='Operator'>*</span><a href="plancat.c.html#LN908"><span class='Ref_to_Parameter'>pages</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="plancat.c.html#LN908"><span class='Ref_to_Parameter'>tuples</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="plancat.c.html#LN908"><span class='Ref_to_Parameter'>allvisfrac</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch rel-&GT;rd_rel-&GT;relkind &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end estimate_rel_size &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * get_rel_data_width 
 * 
 * Estimate the average width of (the data part of) the relation's tuples. 
 * 
 * If attr_widths isn't NULL, it points to the zero-index entry of the 
 * relation's attr_widths[] cache; use and update that cache as appropriate. 
 * 
 * Currently we ignore dropped columns.  Ideally those should be included 
 * in the result, but we haven't got any way to get info about them; and 
 * since they might be mostly NULLs, treating them as zero-width is not 
 * necessarily the wrong thing anyway. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> 
<a name="LN1067"></a><span class='Declare_Function'>get_rel_data_width</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>attr_widths</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1069"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>tuple_width</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN1070"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN1070"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="plancat.c.html#LN1070"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT;= </span><a href="../../../include/utils/rel.h.html#LN422"><span class='Ref_to_Macro'>RelationGetNumberOfAttributes</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1067"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><a href="plancat.c.html#LN1070"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1074"></a>        <a href="../../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>att</span> <span class='Operator'>= </span><a href="plancat.c.html#LN1067"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="plancat.c.html#LN1070"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN1075"></a>        <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>item_width</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN1074"><span class='Ref_To_Local'>att</span></a><span class='Operator'>-&GT;</span>attisdropped<span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* use previously cached data, if any */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN1067"><span class='Ref_to_Parameter'>attr_widths</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="plancat.c.html#LN1067"><span class='Ref_to_Parameter'>attr_widths</span></a><span class='Delimiter'>[</span><a href="plancat.c.html#LN1070"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="plancat.c.html#LN1069"><span class='Ref_To_Local'>tuple_width</span></a> <span class='Operator'>+= </span><a href="plancat.c.html#LN1067"><span class='Ref_to_Parameter'>attr_widths</span></a><span class='Delimiter'>[</span><a href="plancat.c.html#LN1070"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* This should match set_rel_width() in costsize.c */ 
</span>        <a href="plancat.c.html#LN1075"><span class='Ref_To_Local'>item_width</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN171"><span class='Ref_to_Proto'>get_attavgwidth</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1067"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="plancat.c.html#LN1070"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN1075"><span class='Ref_To_Local'>item_width</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="plancat.c.html#LN1075"><span class='Ref_To_Local'>item_width</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN170"><span class='Ref_to_Proto'>get_typavgwidth</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1074"><span class='Ref_To_Local'>att</span></a><span class='Operator'>-&GT;</span>atttypid<span class='Delimiter'>, </span><a href="plancat.c.html#LN1074"><span class='Ref_To_Local'>att</span></a><span class='Operator'>-&GT;</span>atttypmod<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="plancat.c.html#LN1075"><span class='Ref_To_Local'>item_width</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN1067"><span class='Ref_to_Parameter'>attr_widths</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="plancat.c.html#LN1067"><span class='Ref_to_Parameter'>attr_widths</span></a><span class='Delimiter'>[</span><a href="plancat.c.html#LN1070"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="plancat.c.html#LN1075"><span class='Ref_To_Local'>item_width</span></a><span class='Delimiter'>; 
</span>        <a href="plancat.c.html#LN1069"><span class='Ref_To_Local'>tuple_width</span></a> <span class='Operator'>+= </span><a href="plancat.c.html#LN1075"><span class='Ref_To_Local'>item_width</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=1;i&LT;=RelationGetNum... &raquo; </span> 
 
    <span class='Control'>return</span> <a href="plancat.c.html#LN1069"><span class='Ref_To_Local'>tuple_width</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_rel_data_width &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * get_relation_data_width 
 * 
 * External API for get_rel_data_width: same behavior except we have to 
 * open the relcache entry. 
 */ 
</span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> 
<a name="LN1109"></a><span class='Declare_Function'>get_relation_data_width</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relid</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>attr_widths</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1111"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN1112"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>relation</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* As above, assume relation is already locked */ 
</span>    <a href="plancat.c.html#LN1112"><span class='Ref_To_Local'>relation</span></a> <span class='Operator'>= </span><a href="../../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1109"><span class='Ref_to_Parameter'>relid</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="plancat.c.html#LN1111"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="plancat.c.html#LN63"><span class='Ref_to_Proto'>get_rel_data_width</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1112"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN1109"><span class='Ref_to_Parameter'>attr_widths</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1112"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="plancat.c.html#LN1111"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * get_relation_constraints 
 * 
 * Retrieve the validated CHECK constraint expressions of the given relation. 
 * 
 * Returns a List (possibly empty) of constraint expressions.  Each one 
 * has been canonicalized, and its Vars are changed to have the varno 
 * indicated by rel-&GT;relid.  This allows the expressions to be easily 
 * compared to expressions taken from WHERE. 
 * 
 * If include_notnull is true, "col IS NOT NULL" expressions are generated 
 * and added to the result for each column that's marked attnotnull. 
 * 
 * Note: at present this is invoked at most once per relation per planner 
 * run, and in many cases it won't be invoked at all, so there seems no 
 * point in caching the data in RelOptInfo. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN1143"></a><span class='Declare_Function'>get_relation_constraints</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN1144"></a>                         <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relationObjectId</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN1145"></a>                         <span class='Keyword'>bool </span><span class='Declare_Parameter'>include_notnull</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1147"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN1148"></a>    <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a>       <span class='Declare_Local'>varno</span> <span class='Operator'>= </span><a href="plancat.c.html#LN1144"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN552"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>; 
</span><a name="LN1149"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>relation</span><span class='Delimiter'>; 
</span><a name="LN1150"></a>    <a href="../../../include/access/tupdesc.h.html#LN36"><span class='Ref_to_Typedef'>TupleConstr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>constr</span><span class='Delimiter'>; 
</span><a name="LN1151"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>pcqual</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We assume the relation has already been safely locked. 
     */ 
</span>    <a href="plancat.c.html#LN1149"><span class='Ref_To_Local'>relation</span></a> <span class='Operator'>= </span><a href="../../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1144"><span class='Ref_to_Parameter'>relationObjectId</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="plancat.c.html#LN1150"><span class='Ref_To_Local'>constr</span></a> <span class='Operator'>= </span><a href="plancat.c.html#LN1149"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN75"><span class='Ref_to_Member'>constr</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN1150"><span class='Ref_To_Local'>constr</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1161"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>num_check</span> <span class='Operator'>= </span><a href="plancat.c.html#LN1150"><span class='Ref_To_Local'>constr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN41"><span class='Ref_to_Member'>num_check</span></a><span class='Delimiter'>; 
</span><a name="LN1162"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN1162"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="plancat.c.html#LN1162"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="plancat.c.html#LN1161"><span class='Ref_To_Local'>num_check</span></a><span class='Delimiter'>; </span><a href="plancat.c.html#LN1162"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1166"></a>            <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>cexpr</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * If this constraint hasn't been fully validated yet, we must 
             * ignore it here. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="plancat.c.html#LN1150"><span class='Ref_To_Local'>constr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN39"><span class='Ref_to_Member'>check</span></a><span class='Delimiter'>[</span><a href="plancat.c.html#LN1162"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/tupdesc.h.html#LN31"><span class='Ref_to_Member'>ccvalid</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
            <a href="plancat.c.html#LN1166"><span class='Ref_To_Local'>cexpr</span></a> <span class='Operator'>= </span><a href="../../nodes/read.c.html#LN36"><span class='Ref_to_Func'>stringToNode</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1150"><span class='Ref_To_Local'>constr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN39"><span class='Ref_to_Member'>check</span></a><span class='Delimiter'>[</span><a href="plancat.c.html#LN1162"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/tupdesc.h.html#LN30"><span class='Ref_to_Member'>ccbin</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Run each expression through const-simplification and 
             * canonicalization.  This is not just an optimization, but is 
             * necessary, because we will be comparing it to 
             * similarly-processed qual clauses, and may fail to detect valid 
             * matches without this.  This must match the processing done to 
             * qual clauses in preprocess_expression()!  (We can skip the 
             * stuff involving subqueries, however, since we don't allow any 
             * in check constraints.) 
             */ 
</span>            <a href="plancat.c.html#LN1166"><span class='Ref_To_Local'>cexpr</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/clauses.h.html#LN80"><span class='Ref_to_Proto'>eval_const_expressions</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1143"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN1166"><span class='Ref_To_Local'>cexpr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="plancat.c.html#LN1166"><span class='Ref_To_Local'>cexpr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/optimizer/prep.h.html#LN35"><span class='Ref_to_Proto'>canonicalize_qual</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="plancat.c.html#LN1166"><span class='Ref_To_Local'>cexpr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Fix Vars to have the desired varno */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN1148"><span class='Ref_To_Local'>varno</span></a> <span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                <a href="../../../include/rewrite/rewriteManip.h.html#LN42"><span class='Ref_to_Proto'>ChangeVarNodes</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1166"><span class='Ref_To_Local'>cexpr</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="plancat.c.html#LN1148"><span class='Ref_To_Local'>varno</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Finally, convert to implicit-AND format (that is, a List) and 
             * append the resulting item(s) to our output list. 
             */ 
</span>            <a href="plancat.c.html#LN1147"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1147"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                                 <a href="../../../include/optimizer/clauses.h.html#LN46"><span class='Ref_to_Proto'>make_ands_implicit</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="plancat.c.html#LN1166"><span class='Ref_To_Local'>cexpr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;num_check;i++ &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* Add NOT NULL constraints in expression form, if requested */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN1145"><span class='Ref_to_Parameter'>include_notnull</span></a> <span class='Operator'>&& </span><a href="plancat.c.html#LN1150"><span class='Ref_To_Local'>constr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN42"><span class='Ref_to_Member'>has_not_null</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1206"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>natts</span> <span class='Operator'>= </span><a href="plancat.c.html#LN1149"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; 
</span> 
            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN1162"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="plancat.c.html#LN1162"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT;= </span><a href="plancat.c.html#LN1206"><span class='Ref_To_Local'>natts</span></a><span class='Delimiter'>; </span><a href="plancat.c.html#LN1162"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1210"></a>                <a href="../../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>att</span> <span class='Operator'>= </span><a href="plancat.c.html#LN1149"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="plancat.c.html#LN1162"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN1210"><span class='Ref_To_Local'>att</span></a><span class='Operator'>-&GT;</span>attnotnull <span class='Operator'>&& !</span><a href="plancat.c.html#LN1210"><span class='Ref_To_Local'>att</span></a><span class='Operator'>-&GT;</span>attisdropped<span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN1214"></a>                    <a href="../../../include/nodes/primnodes.h.html#LN1175"><span class='Ref_to_Struct'>NullTest</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>ntest</span> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1175"><span class='Ref_to_Struct'>NullTest</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <a href="plancat.c.html#LN1214"><span class='Ref_To_Local'>ntest</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1178"><span class='Ref_to_Member'>arg</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/makefuncs.h.html#LN25"><span class='Ref_to_Proto'>makeVar</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1148"><span class='Ref_To_Local'>varno</span></a><span class='Delimiter'>, 
</span>                                                  <a href="plancat.c.html#LN1162"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, 
</span>                                                  <a href="plancat.c.html#LN1210"><span class='Ref_To_Local'>att</span></a><span class='Operator'>-&GT;</span>atttypid<span class='Delimiter'>, 
</span>                                                  <a href="plancat.c.html#LN1210"><span class='Ref_To_Local'>att</span></a><span class='Operator'>-&GT;</span>atttypmod<span class='Delimiter'>, 
</span>                                                  <a href="plancat.c.html#LN1210"><span class='Ref_To_Local'>att</span></a><span class='Operator'>-&GT;</span>attcollation<span class='Delimiter'>, 
</span>                                                  <span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="plancat.c.html#LN1214"><span class='Ref_To_Local'>ntest</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1179"><span class='Ref_to_Member'>nulltesttype</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/primnodes.h.html#LN1172"><span class='Ref_to_EnumConst'>IS_NOT_NULL</span></a><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * argisrow=false is correct even for a composite column, 
                     * because attnotnull does not represent a SQL-spec IS NOT 
                     * NULL test in such a case, just IS DISTINCT FROM NULL. 
                     */ 
</span>                    <a href="plancat.c.html#LN1214"><span class='Ref_To_Local'>ntest</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1180"><span class='Ref_to_Member'>argisrow</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                    <a href="plancat.c.html#LN1214"><span class='Ref_To_Local'>ntest</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1181"><span class='Ref_to_Member'>location</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                    <a href="plancat.c.html#LN1147"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1147"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN1214"><span class='Ref_To_Local'>ntest</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if att-&GT;attnotnull&&!att... &raquo; </span> 
            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=1;i&LT;=natts;i++ &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if include_notnull&&cons... &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if constr!=NULL &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Append partition predicates, if any */ 
</span>    <a href="plancat.c.html#LN1151"><span class='Ref_To_Local'>pcqual</span></a> <span class='Operator'>= </span><a href="../../../include/catalog/partition.h.html#LN83"><span class='Ref_to_Proto'>RelationGetPartitionQual</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1149"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN1151"><span class='Ref_To_Local'>pcqual</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Run each expression through const-simplification and 
         * canonicalization similar to check constraints. 
         */ 
</span>        <a href="plancat.c.html#LN1151"><span class='Ref_To_Local'>pcqual</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/optimizer/clauses.h.html#LN80"><span class='Ref_to_Proto'>eval_const_expressions</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1143"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="plancat.c.html#LN1151"><span class='Ref_To_Local'>pcqual</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="plancat.c.html#LN1151"><span class='Ref_To_Local'>pcqual</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/optimizer/prep.h.html#LN35"><span class='Ref_to_Proto'>canonicalize_qual</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="plancat.c.html#LN1151"><span class='Ref_To_Local'>pcqual</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Fix Vars to have the desired varno */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN1148"><span class='Ref_To_Local'>varno</span></a> <span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <a href="../../../include/rewrite/rewriteManip.h.html#LN42"><span class='Ref_to_Proto'>ChangeVarNodes</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="plancat.c.html#LN1151"><span class='Ref_To_Local'>pcqual</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="plancat.c.html#LN1148"><span class='Ref_To_Local'>varno</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="plancat.c.html#LN1147"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1147"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN1151"><span class='Ref_To_Local'>pcqual</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1149"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="plancat.c.html#LN1147"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_relation_constraints &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * get_relation_statistics 
 *      Retrieve extended statistics defined on the table. 
 * 
 * Returns a List (possibly empty) of StatisticExtInfo objects describing 
 * the statistics.  Note that this doesn't load the actual statistics data, 
 * just the identifying metadata.  Only stats actually built are considered. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN1269"></a><span class='Declare_Function'>get_relation_statistics</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1271"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>statoidlist</span><span class='Delimiter'>; 
</span><a name="LN1272"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>stainfos</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN1273"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
    <a href="plancat.c.html#LN1271"><span class='Ref_To_Local'>statoidlist</span></a> <span class='Operator'>= </span><a href="../../../include/utils/relcache.h.html#LN41"><span class='Ref_to_Proto'>RelationGetStatExtList</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1269"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1273"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN1271"><span class='Ref_To_Local'>statoidlist</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1279"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>statOid</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1273"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1280"></a>        <a href="../../../include/catalog/pg_statistic_ext.h.html#LN60"><span class='Ref_to_Typedef'>Form_pg_statistic_ext</span></a> <span class='Declare_Local'>staForm</span><span class='Delimiter'>; 
</span><a name="LN1281"></a>        <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>htup</span><span class='Delimiter'>; 
</span><a name="LN1282"></a>        <a href="../../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>keys</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1283"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <a href="plancat.c.html#LN1281"><span class='Ref_To_Local'>htup</span></a> <span class='Operator'>= </span><a href="../../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN89"><span class='Ref_to_EnumConst'>STATEXTOID</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1279"><span class='Ref_To_Local'>statOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="plancat.c.html#LN1281"><span class='Ref_To_Local'>htup</span></a><span class='Parentheses'>) 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for statistics object %u"</span><span class='Delimiter'>, </span><a href="plancat.c.html#LN1279"><span class='Ref_To_Local'>statOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="plancat.c.html#LN1280"><span class='Ref_To_Local'>staForm</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_statistic_ext.h.html#LN60"><span class='Ref_to_Typedef'>Form_pg_statistic_ext</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1281"><span class='Ref_To_Local'>htup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * First, build the array of columns covered.  This is ultimately 
         * wasted if no stats within the object have actually been built, but 
         * it doesn't seem worth troubling over that case. 
         */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN1283"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="plancat.c.html#LN1283"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="plancat.c.html#LN1280"><span class='Ref_To_Local'>staForm</span></a><span class='Operator'>-&GT;</span>stxkeys<span class='Operator'>.</span>dim1<span class='Delimiter'>; </span><a href="plancat.c.html#LN1283"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <a href="plancat.c.html#LN1282"><span class='Ref_To_Local'>keys</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN89"><span class='Ref_to_Proto'>bms_add_member</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1282"><span class='Ref_To_Local'>keys</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN1280"><span class='Ref_To_Local'>staForm</span></a><span class='Operator'>-&GT;</span>stxkeys<span class='Operator'>.</span>values<span class='Delimiter'>[</span><a href="plancat.c.html#LN1283"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* add one StatisticExtInfo for each kind built */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/statistics/statistics.h.html#LN85"><span class='Ref_to_Proto'>statext_is_kind_built</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1281"><span class='Ref_To_Local'>htup</span></a><span class='Delimiter'>, </span><a href="../../../include/catalog/pg_statistic_ext.h.html#LN76"><span class='Ref_to_Const'>STATS_EXT_NDISTINCT</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN1301"></a>            <a href="../../../include/nodes/relation.h.html#LN716"><span class='Ref_to_Struct'>StatisticExtInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>info</span> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN716"><span class='Ref_to_Struct'>StatisticExtInfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="plancat.c.html#LN1301"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN720"><span class='Ref_to_Member'>statOid</span></a> <span class='Operator'>= </span><a href="plancat.c.html#LN1279"><span class='Ref_To_Local'>statOid</span></a><span class='Delimiter'>; 
</span>            <a href="plancat.c.html#LN1301"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN721"><span class='Ref_to_Member'>rel</span></a> <span class='Operator'>= </span><a href="plancat.c.html#LN1269"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>; 
</span>            <a href="plancat.c.html#LN1301"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN722"><span class='Ref_to_Member'>kind</span></a> <span class='Operator'>= </span><a href="../../../include/catalog/pg_statistic_ext.h.html#LN76"><span class='Ref_to_Const'>STATS_EXT_NDISTINCT</span></a><span class='Delimiter'>; 
</span>            <a href="plancat.c.html#LN1301"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN723"><span class='Ref_to_Member'>keys</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN65"><span class='Ref_to_Proto'>bms_copy</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1282"><span class='Ref_To_Local'>keys</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="plancat.c.html#LN1272"><span class='Ref_To_Local'>stainfos</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN215"><span class='Ref_to_Proto'>lcons</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1301"><span class='Ref_To_Local'>info</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN1272"><span class='Ref_To_Local'>stainfos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/statistics/statistics.h.html#LN85"><span class='Ref_to_Proto'>statext_is_kind_built</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1281"><span class='Ref_To_Local'>htup</span></a><span class='Delimiter'>, </span><a href="../../../include/catalog/pg_statistic_ext.h.html#LN77"><span class='Ref_to_Const'>STATS_EXT_DEPENDENCIES</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN1313"></a>            <a href="../../../include/nodes/relation.h.html#LN716"><span class='Ref_to_Struct'>StatisticExtInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>info</span> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN716"><span class='Ref_to_Struct'>StatisticExtInfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="plancat.c.html#LN1313"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN720"><span class='Ref_to_Member'>statOid</span></a> <span class='Operator'>= </span><a href="plancat.c.html#LN1279"><span class='Ref_To_Local'>statOid</span></a><span class='Delimiter'>; 
</span>            <a href="plancat.c.html#LN1313"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN721"><span class='Ref_to_Member'>rel</span></a> <span class='Operator'>= </span><a href="plancat.c.html#LN1269"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>; 
</span>            <a href="plancat.c.html#LN1313"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN722"><span class='Ref_to_Member'>kind</span></a> <span class='Operator'>= </span><a href="../../../include/catalog/pg_statistic_ext.h.html#LN77"><span class='Ref_to_Const'>STATS_EXT_DEPENDENCIES</span></a><span class='Delimiter'>; 
</span>            <a href="plancat.c.html#LN1313"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN723"><span class='Ref_to_Member'>keys</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN65"><span class='Ref_to_Proto'>bms_copy</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1282"><span class='Ref_To_Local'>keys</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="plancat.c.html#LN1272"><span class='Ref_To_Local'>stainfos</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN215"><span class='Ref_to_Proto'>lcons</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1313"><span class='Ref_To_Local'>info</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN1272"><span class='Ref_To_Local'>stainfos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1281"><span class='Ref_To_Local'>htup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/nodes/bitmapset.h.html#LN68"><span class='Ref_to_Proto'>bms_free</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1282"><span class='Ref_To_Local'>keys</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1271"><span class='Ref_To_Local'>statoidlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="plancat.c.html#LN1272"><span class='Ref_To_Local'>stainfos</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_relation_statistics &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * relation_excluded_by_constraints 
 * 
 * Detect whether the relation need not be scanned because it has either 
 * self-inconsistent restrictions, or restrictions inconsistent with the 
 * relation's validated CHECK constraints. 
 * 
 * Note: this examines only rel-&GT;relid, rel-&GT;reloptkind, and 
 * rel-&GT;baserestrictinfo; therefore it can be called before filling in 
 * other fields of the RelOptInfo. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN1344"></a><span class='Declare_Function'>relation_excluded_by_constraints</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN1345"></a>                                 <a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rte</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1347"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>safe_restrictions</span><span class='Delimiter'>; 
</span><a name="LN1348"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>constraint_pred</span><span class='Delimiter'>; 
</span><a name="LN1349"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>safe_constraints</span><span class='Delimiter'>; 
</span><a name="LN1350"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* As of now, constraint exclusion works only with simple relations. */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN504"><span class='Ref_to_Macro'>IS_SIMPLE_REL</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1345"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Regardless of the setting of constraint_exclusion, detect 
     * constant-FALSE-or-NULL restriction clauses.  Because const-folding will 
     * reduce "anything AND FALSE" to just "FALSE", any such case should 
     * result in exactly one baserestrictinfo entry.  This doesn't fire very 
     * often, but it seems cheap enough to be worth doing anyway.  (Without 
     * this, we'd miss some optimizations that 9.5 and earlier found via much 
     * more roundabout methods.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1345"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN583"><span class='Ref_to_Member'>baserestrictinfo</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1366"></a>        <a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rinfo</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1345"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN583"><span class='Ref_to_Member'>baserestrictinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1367"></a>        <a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>clause</span> <span class='Operator'>= </span><a href="plancat.c.html#LN1366"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1746"><span class='Ref_to_Member'>clause</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN1367"><span class='Ref_To_Local'>clause</span></a> <span class='Operator'>&& </span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1367"><span class='Ref_To_Local'>clause</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a><span class='Parentheses'>)</span> <span class='Operator'>&& 
</span>            <span class='Parentheses'>(((</span><a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a> <span class='Operator'>*</span><span class='Parentheses'>)</span> <a href="plancat.c.html#LN1367"><span class='Ref_To_Local'>clause</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>constisnull <span class='Operator'>|| 
</span>             <span class='Operator'>!</span><a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(((</span><a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="plancat.c.html#LN1367"><span class='Ref_To_Local'>clause</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>constvalue<span class='Parentheses'>)))</span> 
            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Skip further tests if constraint exclusion is disabled for the rel */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN53"><span class='Ref_to_Global_Var'>constraint_exclusion</span></a> <span class='Operator'>== </span><a href="../../../include/optimizer/cost.h.html#LN35"><span class='Ref_to_EnumConst'>CONSTRAINT_EXCLUSION_OFF</span></a> <span class='Operator'>|| 
</span>        <span class='Parentheses'>(</span><a href="plancat.c.html#LN53"><span class='Ref_to_Global_Var'>constraint_exclusion</span></a> <span class='Operator'>== </span><a href="../../../include/optimizer/cost.h.html#LN37"><span class='Ref_to_EnumConst'>CONSTRAINT_EXCLUSION_PARTITION</span></a> <span class='Operator'>&& 
</span>         <span class='Operator'>!</span><span class='Parentheses'>(</span><a href="plancat.c.html#LN1345"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN521"><span class='Ref_to_Member'>reloptkind</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/relation.h.html#LN495"><span class='Ref_to_EnumConst'>RELOPT_OTHER_MEMBER_REL</span></a> <span class='Operator'>|| 
</span>           <span class='Parentheses'>(</span><a href="plancat.c.html#LN1344"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN296"><span class='Ref_to_Member'>hasInheritedTarget</span></a> <span class='Operator'>&& 
</span>            <a href="plancat.c.html#LN1345"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN521"><span class='Ref_to_Member'>reloptkind</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/relation.h.html#LN493"><span class='Ref_to_EnumConst'>RELOPT_BASEREL</span></a> <span class='Operator'>&& 
</span>            <a href="plancat.c.html#LN1345"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN552"><span class='Ref_to_Member'>relid</span></a> <span class='Operator'>== </span><a href="plancat.c.html#LN1344"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN119"><span class='Ref_to_Member'>resultRelation</span></a><span class='Parentheses'>))))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check for self-contradictory restriction clauses.  We dare not make 
     * deductions with non-immutable functions, but any immutable clauses that 
     * are self-contradictory allow us to conclude the scan is unnecessary. 
     * 
     * Note: strip off RestrictInfo because predicate_refuted_by() isn't 
     * expecting to see any in its predicate argument. 
     */ 
</span>    <a href="plancat.c.html#LN1347"><span class='Ref_To_Local'>safe_restrictions</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1350"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN1345"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN583"><span class='Ref_to_Member'>baserestrictinfo</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1395"></a>        <a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rinfo</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1350"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/optimizer/clauses.h.html#LN59"><span class='Ref_to_Proto'>contain_mutable_functions</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="plancat.c.html#LN1395"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1746"><span class='Ref_to_Member'>clause</span></a><span class='Parentheses'>))</span> 
            <a href="plancat.c.html#LN1347"><span class='Ref_To_Local'>safe_restrictions</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1347"><span class='Ref_To_Local'>safe_restrictions</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN1395"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1746"><span class='Ref_to_Member'>clause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/optimizer/predtest.h.html#LN21"><span class='Ref_to_Proto'>predicate_refuted_by</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1347"><span class='Ref_To_Local'>safe_restrictions</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN1347"><span class='Ref_To_Local'>safe_restrictions</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Only plain relations have constraints */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN1345"><span class='Ref_to_Parameter'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN936"><span class='Ref_to_Member'>rtekind</span></a> <span class='Operator'>!= </span><a href="../../../include/nodes/parsenodes.h.html#LN922"><span class='Ref_to_EnumConst'>RTE_RELATION</span></a> <span class='Operator'>|| </span><a href="plancat.c.html#LN1345"><span class='Ref_to_Parameter'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1025"><span class='Ref_to_Member'>inh</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * OK to fetch the constraint expressions.  Include "col IS NOT NULL" 
     * expressions for attnotnull columns, in case we can refute those. 
     */ 
</span>    <a href="plancat.c.html#LN1348"><span class='Ref_To_Local'>constraint_pred</span></a> <span class='Operator'>= </span><a href="plancat.c.html#LN64"><span class='Ref_to_Proto'>get_relation_constraints</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1344"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN1345"><span class='Ref_to_Parameter'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN947"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN1345"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We do not currently enforce that CHECK constraints contain only 
     * immutable functions, so it's necessary to check here. We daren't draw 
     * conclusions from plan-time evaluation of non-immutable functions. Since 
     * they're ANDed, we can just ignore any mutable constraints in the list, 
     * and reason about the rest. 
     */ 
</span>    <a href="plancat.c.html#LN1349"><span class='Ref_To_Local'>safe_constraints</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1350"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN1348"><span class='Ref_To_Local'>constraint_pred</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1424"></a>        <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>pred</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1350"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/optimizer/clauses.h.html#LN59"><span class='Ref_to_Proto'>contain_mutable_functions</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1424"><span class='Ref_To_Local'>pred</span></a><span class='Parentheses'>))</span> 
            <a href="plancat.c.html#LN1349"><span class='Ref_To_Local'>safe_constraints</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1349"><span class='Ref_To_Local'>safe_constraints</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN1424"><span class='Ref_To_Local'>pred</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The constraints are effectively ANDed together, so we can just try to 
     * refute the entire collection at once.  This may allow us to make proofs 
     * that would fail if we took them individually. 
     * 
     * Note: we use rel-&GT;baserestrictinfo, not safe_restrictions as might seem 
     * an obvious optimization.  Some of the clauses might be OR clauses that 
     * have volatile and nonvolatile subclauses, and it's OK to make 
     * deductions with the nonvolatile parts. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/optimizer/predtest.h.html#LN21"><span class='Ref_to_Proto'>predicate_refuted_by</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1349"><span class='Ref_To_Local'>safe_constraints</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN1345"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN583"><span class='Ref_to_Member'>baserestrictinfo</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end relation_excluded_by_constraints &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * build_physical_tlist 
 * 
 * Build a targetlist consisting of exactly the relation's user attributes, 
 * in order.  The executor can special-case such tlists to avoid a projection 
 * step at runtime, so we use such tlists preferentially for scan nodes. 
 * 
 * Exception: if there are any dropped columns, we punt and return NIL. 
 * Ideally we would like to handle the dropped-column case too.  However this 
 * creates problems for ExecTypeFromTL, which may be asked to build a tupdesc 
 * for a tlist that includes vars of no-longer-existent types.  In theory we 
 * could dig out the required info from the pg_attribute entries of the 
 * relation, but that data is not readily available to ExecTypeFromTL. 
 * For now, we don't apply the physical-tlist optimization when there are 
 * dropped cols. 
 * 
 * We also support building a "physical" tlist for subqueries, functions, 
 * values lists, table expressions, and CTEs, since the same optimization can 
 * occur in SubqueryScan, FunctionScan, ValuesScan, CteScan, TableFunc, 
 * NamedTuplestoreScan, and WorkTableScan nodes. 
 */ 
</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN1469"></a><span class='Declare_Function'>build_physical_tlist</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1471"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>tlist</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN1472"></a>    <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a>       <span class='Declare_Local'>varno</span> <span class='Operator'>= </span><a href="plancat.c.html#LN1469"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN552"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>; 
</span><a name="LN1473"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rte</span> <span class='Operator'>= </span><a href="../../../include/nodes/relation.h.html#LN324"><span class='Ref_to_Macro'>planner_rt_fetch</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1472"><span class='Ref_To_Local'>varno</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN1469"><span class='Ref_to_Parameter'>root</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1474"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>relation</span><span class='Delimiter'>; 
</span><a name="LN1475"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>subquery</span><span class='Delimiter'>; 
</span><a name="LN1476"></a>    <a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>var</span><span class='Delimiter'>; 
</span><a name="LN1477"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span><a name="LN1478"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>attrno</span><span class='Delimiter'>, 
</span><a name="LN1479"></a>                <span class='Declare_Local'>numattrs</span><span class='Delimiter'>; 
</span><a name="LN1480"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>colvars</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN1473"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN936"><span class='Ref_to_Member'>rtekind</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN922"><span class='Ref_to_EnumConst'>RTE_RELATION</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* Assume we already have adequate lock */ 
</span>            <a href="plancat.c.html#LN1474"><span class='Ref_To_Local'>relation</span></a> <span class='Operator'>= </span><a href="../../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1473"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN947"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="plancat.c.html#LN1479"><span class='Ref_To_Local'>numattrs</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rel.h.html#LN422"><span class='Ref_to_Macro'>RelationGetNumberOfAttributes</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1474"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN1478"><span class='Ref_To_Local'>attrno</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="plancat.c.html#LN1478"><span class='Ref_To_Local'>attrno</span></a> <span class='Operator'>&LT;= </span><a href="plancat.c.html#LN1479"><span class='Ref_To_Local'>numattrs</span></a><span class='Delimiter'>; </span><a href="plancat.c.html#LN1478"><span class='Ref_To_Local'>attrno</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1491"></a>                <a href="../../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>att_tup</span> <span class='Operator'>= </span><a href="plancat.c.html#LN1474"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="plancat.c.html#LN1478"><span class='Ref_To_Local'>attrno</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN1491"><span class='Ref_To_Local'>att_tup</span></a><span class='Operator'>-&GT;</span>attisdropped<span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* found a dropped col, so punt */ 
</span>                    <a href="plancat.c.html#LN1471"><span class='Ref_To_Local'>tlist</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <a href="plancat.c.html#LN1476"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/makefuncs.h.html#LN25"><span class='Ref_to_Proto'>makeVar</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1472"><span class='Ref_To_Local'>varno</span></a><span class='Delimiter'>, 
</span>                              <a href="plancat.c.html#LN1478"><span class='Ref_To_Local'>attrno</span></a><span class='Delimiter'>, 
</span>                              <a href="plancat.c.html#LN1491"><span class='Ref_To_Local'>att_tup</span></a><span class='Operator'>-&GT;</span>atttypid<span class='Delimiter'>, 
</span>                              <a href="plancat.c.html#LN1491"><span class='Ref_To_Local'>att_tup</span></a><span class='Operator'>-&GT;</span>atttypmod<span class='Delimiter'>, 
</span>                              <a href="plancat.c.html#LN1491"><span class='Ref_To_Local'>att_tup</span></a><span class='Operator'>-&GT;</span>attcollation<span class='Delimiter'>, 
</span>                              <span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="plancat.c.html#LN1471"><span class='Ref_To_Local'>tlist</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1471"><span class='Ref_To_Local'>tlist</span></a><span class='Delimiter'>, 
</span>                                <a href="../../../include/nodes/makefuncs.h.html#LN40"><span class='Ref_to_Proto'>makeTargetEntry</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="plancat.c.html#LN1476"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, 
</span>                                                <a href="plancat.c.html#LN1478"><span class='Ref_To_Local'>attrno</span></a><span class='Delimiter'>, 
</span>                                                <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                                <span class='Boolean'>false</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for attrno=1;attrno&LT;=numa... &raquo; </span> 
 
            <a href="../../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1474"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN923"><span class='Ref_to_EnumConst'>RTE_SUBQUERY</span></a><span class='Operator'>: 
</span>            <a href="plancat.c.html#LN1475"><span class='Ref_To_Local'>subquery</span></a> <span class='Operator'>= </span><a href="plancat.c.html#LN1473"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN954"><span class='Ref_to_Member'>subquery</span></a><span class='Delimiter'>; 
</span>            <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1477"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN1475"><span class='Ref_To_Local'>subquery</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN137"><span class='Ref_to_Member'>targetList</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1521"></a>                <a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tle</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1477"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * A resjunk column of the subquery can be reflected as 
                 * resjunk in the physical tlist; we need not punt. 
                 */ 
</span>                <a href="plancat.c.html#LN1476"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/makefuncs.h.html#LN32"><span class='Ref_to_Proto'>makeVarFromTargetEntry</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1472"><span class='Ref_To_Local'>varno</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN1521"><span class='Ref_To_Local'>tle</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="plancat.c.html#LN1471"><span class='Ref_To_Local'>tlist</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1471"><span class='Ref_To_Local'>tlist</span></a><span class='Delimiter'>, 
</span>                                <a href="../../../include/nodes/makefuncs.h.html#LN40"><span class='Ref_to_Proto'>makeTargetEntry</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="plancat.c.html#LN1476"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, 
</span>                                                <a href="plancat.c.html#LN1521"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1367"><span class='Ref_to_Member'>resno</span></a><span class='Delimiter'>, 
</span>                                                <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                                <a href="plancat.c.html#LN1521"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1373"><span class='Ref_to_Member'>resjunk</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN925"><span class='Ref_to_EnumConst'>RTE_FUNCTION</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN926"><span class='Ref_to_EnumConst'>RTE_TABLEFUNC</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN927"><span class='Ref_to_EnumConst'>RTE_VALUES</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN928"><span class='Ref_to_EnumConst'>RTE_CTE</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN929"><span class='Ref_to_EnumConst'>RTE_NAMEDTUPLESTORE</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* Not all of these can have dropped cols, but share code anyway */ 
</span>            <a href="../../../include/parser/parse_relation.h.html#LN120"><span class='Ref_to_Proto'>expandRTE</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1473"><span class='Ref_To_Local'>rte</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN1472"><span class='Ref_To_Local'>varno</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Boolean'>true </span><span class='Comment_Multi_Line'>/* include dropped */ </span><span class='Delimiter'>, 
</span>                      <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="plancat.c.html#LN1480"><span class='Ref_To_Local'>colvars</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1477"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN1480"><span class='Ref_To_Local'>colvars</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="plancat.c.html#LN1476"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1477"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * A non-Var in expandRTE's output means a dropped column; 
                 * must punt. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1476"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="plancat.c.html#LN1471"><span class='Ref_To_Local'>tlist</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <a href="plancat.c.html#LN1471"><span class='Ref_To_Local'>tlist</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1471"><span class='Ref_To_Local'>tlist</span></a><span class='Delimiter'>, 
</span>                                <a href="../../../include/nodes/makefuncs.h.html#LN40"><span class='Ref_to_Proto'>makeTargetEntry</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="plancat.c.html#LN1476"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, 
</span>                                                <a href="plancat.c.html#LN1476"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN167"><span class='Ref_to_Member'>varattno</span></a><span class='Delimiter'>, 
</span>                                                <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                                <span class='Boolean'>false</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* caller error */ 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unsupported RTE kind %d in build_physical_tlist"</span><span class='Delimiter'>, 
</span>                 <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="plancat.c.html#LN1473"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN936"><span class='Ref_to_Member'>rtekind</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch rte-&GT;rtekind &raquo; </span> 
 
    <span class='Control'>return</span> <a href="plancat.c.html#LN1471"><span class='Ref_To_Local'>tlist</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end build_physical_tlist &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * build_index_tlist 
 * 
 * Build a targetlist representing the columns of the specified index. 
 * Each column is represented by a Var for the corresponding base-relation 
 * column, or an expression in base-relation Vars, as appropriate. 
 * 
 * There are never any dropped columns in indexes, so unlike 
 * build_physical_tlist, we need no failure case. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN1588"></a><span class='Declare_Function'>build_index_tlist</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>index</span><span class='Delimiter'>, 
</span><a name="LN1589"></a>                  <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>heapRelation</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1591"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>tlist</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN1592"></a>    <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a>       <span class='Declare_Local'>varno</span> <span class='Operator'>= </span><a href="plancat.c.html#LN1588"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN632"><span class='Ref_to_Member'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN552"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>; 
</span><a name="LN1593"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>indexpr_item</span><span class='Delimiter'>; 
</span><a name="LN1594"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <a href="plancat.c.html#LN1593"><span class='Ref_To_Local'>indexpr_item</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN75"><span class='Ref_to_Func'>list_head</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1588"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN652"><span class='Ref_to_Member'>indexprs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN1594"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="plancat.c.html#LN1594"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="plancat.c.html#LN1588"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN640"><span class='Ref_to_Member'>ncolumns</span></a><span class='Delimiter'>; </span><a href="plancat.c.html#LN1594"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1599"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>indexkey</span> <span class='Operator'>= </span><a href="plancat.c.html#LN1588"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN641"><span class='Ref_to_Member'>indexkeys</span></a><span class='Delimiter'>[</span><a href="plancat.c.html#LN1594"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span><a name="LN1600"></a>        <a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>indexvar</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN1599"><span class='Ref_To_Local'>indexkey</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* simple column */ 
</span><a name="LN1605"></a>            <a href="../../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>att_tup</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN1599"><span class='Ref_To_Local'>indexkey</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="plancat.c.html#LN1605"><span class='Ref_To_Local'>att_tup</span></a> <span class='Operator'>= </span><a href="../../../include/catalog/heap.h.html#LN122"><span class='Ref_to_Proto'>SystemAttributeDefinition</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1599"><span class='Ref_To_Local'>indexkey</span></a><span class='Delimiter'>, 
</span>                                           <a href="plancat.c.html#LN1589"><span class='Ref_to_Parameter'>heapRelation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relhasoids<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="plancat.c.html#LN1605"><span class='Ref_To_Local'>att_tup</span></a> <span class='Operator'>= </span><a href="plancat.c.html#LN1589"><span class='Ref_to_Parameter'>heapRelation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="plancat.c.html#LN1599"><span class='Ref_To_Local'>indexkey</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
            <a href="plancat.c.html#LN1600"><span class='Ref_To_Local'>indexvar</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/makefuncs.h.html#LN25"><span class='Ref_to_Proto'>makeVar</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1592"><span class='Ref_To_Local'>varno</span></a><span class='Delimiter'>, 
</span>                                        <a href="plancat.c.html#LN1599"><span class='Ref_To_Local'>indexkey</span></a><span class='Delimiter'>, 
</span>                                        <a href="plancat.c.html#LN1605"><span class='Ref_To_Local'>att_tup</span></a><span class='Operator'>-&GT;</span>atttypid<span class='Delimiter'>, 
</span>                                        <a href="plancat.c.html#LN1605"><span class='Ref_To_Local'>att_tup</span></a><span class='Operator'>-&GT;</span>atttypmod<span class='Delimiter'>, 
</span>                                        <a href="plancat.c.html#LN1605"><span class='Ref_To_Local'>att_tup</span></a><span class='Operator'>-&GT;</span>attcollation<span class='Delimiter'>, 
</span>                                        <span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* expression column */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN1593"><span class='Ref_To_Local'>indexpr_item</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"wrong number of index expressions"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="plancat.c.html#LN1600"><span class='Ref_To_Local'>indexvar</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1593"><span class='Ref_To_Local'>indexpr_item</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="plancat.c.html#LN1593"><span class='Ref_To_Local'>indexpr_item</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1593"><span class='Ref_To_Local'>indexpr_item</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="plancat.c.html#LN1591"><span class='Ref_To_Local'>tlist</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1591"><span class='Ref_To_Local'>tlist</span></a><span class='Delimiter'>, 
</span>                        <a href="../../../include/nodes/makefuncs.h.html#LN40"><span class='Ref_to_Proto'>makeTargetEntry</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1600"><span class='Ref_To_Local'>indexvar</span></a><span class='Delimiter'>, 
</span>                                        <a href="plancat.c.html#LN1594"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                        <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                        <span class='Boolean'>false</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;index-&GT;ncolumns... &raquo; </span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN1593"><span class='Ref_To_Local'>indexpr_item</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"wrong number of index expressions"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="plancat.c.html#LN1591"><span class='Ref_To_Local'>tlist</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end build_index_tlist &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * restriction_selectivity 
 * 
 * Returns the selectivity of a specified restriction operator clause. 
 * This code executes registered procedures stored in the 
 * operator relation, by calling the function manager. 
 * 
 * See clause_selectivity() for the meaning of the additional parameters. 
 */ 
</span><a href="../../../include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a> 
<a name="LN1651"></a><span class='Declare_Function'>restriction_selectivity</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN1652"></a>                        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>operatorid</span><span class='Delimiter'>, 
</span><a name="LN1653"></a>                        <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>args</span><span class='Delimiter'>, 
</span><a name="LN1654"></a>                        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>inputcollid</span><span class='Delimiter'>, 
</span><a name="LN1655"></a>                        <span class='Keyword'>int </span><span class='Declare_Parameter'>varRelid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1657"></a>    <a href="../../../include/c.h.html#LN394"><span class='Ref_to_Typedef'>RegProcedure</span></a> <span class='Declare_Local'>oprrest</span> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN108"><span class='Ref_to_Proto'>get_oprrest</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1652"><span class='Ref_to_Parameter'>operatorid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1658"></a>    <a href="../../../include/c.h.html#LN380"><span class='Ref_to_Typedef'>float8</span></a>      <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * if the oprrest procedure is missing for whatever reason, use a 
     * selectivity of 0.5 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="plancat.c.html#LN1657"><span class='Ref_To_Local'>oprrest</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>5</span><span class='Delimiter'>; 
</span> 
    <a href="plancat.c.html#LN1658"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN720"><span class='Ref_to_Func'>DatumGetFloat8</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN555"><span class='Ref_to_Proto'>OidFunctionCall4Coll</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1657"><span class='Ref_To_Local'>oprrest</span></a><span class='Delimiter'>, 
</span>                                                 <a href="plancat.c.html#LN1654"><span class='Ref_to_Parameter'>inputcollid</span></a><span class='Delimiter'>, 
</span>                                                 <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1651"><span class='Ref_to_Parameter'>root</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                 <a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1652"><span class='Ref_to_Parameter'>operatorid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                 <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1653"><span class='Ref_to_Parameter'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                 <a href="../../../include/postgres.h.html#LN484"><span class='Ref_to_Macro'>Int32GetDatum</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1655"><span class='Ref_to_Parameter'>varRelid</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN1658"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="plancat.c.html#LN1658"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid restriction selectivity: %f"</span><span class='Delimiter'>, </span><a href="plancat.c.html#LN1658"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a><span class='Parentheses'>) </span><a href="plancat.c.html#LN1658"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end restriction_selectivity &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * join_selectivity 
 * 
 * Returns the selectivity of a specified join operator clause. 
 * This code executes registered procedures stored in the 
 * operator relation, by calling the function manager. 
 */ 
</span><a href="../../../include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a> 
<a name="LN1688"></a><span class='Declare_Function'>join_selectivity</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN1689"></a>                 <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>operatorid</span><span class='Delimiter'>, 
</span><a name="LN1690"></a>                 <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>args</span><span class='Delimiter'>, 
</span><a name="LN1691"></a>                 <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>inputcollid</span><span class='Delimiter'>, 
</span><a name="LN1692"></a>                 <a href="../../../include/nodes/nodes.h.html#LN671"><span class='Ref_to_Enum'>JoinType</span></a> <span class='Declare_Parameter'>jointype</span><span class='Delimiter'>, 
</span><a name="LN1693"></a>                 <a href="../../../include/nodes/relation.h.html#LN1913"><span class='Ref_to_Struct'>SpecialJoinInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>sjinfo</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1695"></a>    <a href="../../../include/c.h.html#LN394"><span class='Ref_to_Typedef'>RegProcedure</span></a> <span class='Declare_Local'>oprjoin</span> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN109"><span class='Ref_to_Proto'>get_oprjoin</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1689"><span class='Ref_to_Parameter'>operatorid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1696"></a>    <a href="../../../include/c.h.html#LN380"><span class='Ref_to_Typedef'>float8</span></a>      <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * if the oprjoin procedure is missing for whatever reason, use a 
     * selectivity of 0.5 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="plancat.c.html#LN1695"><span class='Ref_To_Local'>oprjoin</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>5</span><span class='Delimiter'>; 
</span> 
    <a href="plancat.c.html#LN1696"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN720"><span class='Ref_to_Func'>DatumGetFloat8</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN558"><span class='Ref_to_Proto'>OidFunctionCall5Coll</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1695"><span class='Ref_To_Local'>oprjoin</span></a><span class='Delimiter'>, 
</span>                                                 <a href="plancat.c.html#LN1691"><span class='Ref_to_Parameter'>inputcollid</span></a><span class='Delimiter'>, 
</span>                                                 <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1688"><span class='Ref_to_Parameter'>root</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                 <a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1689"><span class='Ref_to_Parameter'>operatorid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                 <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1690"><span class='Ref_to_Parameter'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                 <a href="../../../include/postgres.h.html#LN456"><span class='Ref_to_Macro'>Int16GetDatum</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1692"><span class='Ref_to_Parameter'>jointype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                 <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1693"><span class='Ref_to_Parameter'>sjinfo</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN1696"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="plancat.c.html#LN1696"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid join selectivity: %f"</span><span class='Delimiter'>, </span><a href="plancat.c.html#LN1696"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a><span class='Parentheses'>) </span><a href="plancat.c.html#LN1696"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end join_selectivity &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * has_unique_index 
 * 
 * Detect whether there is a unique index on the specified attribute 
 * of the specified relation, thus allowing us to conclude that all 
 * the (non-null) values of the attribute are distinct. 
 * 
 * This function does not check the index's indimmediate property, which 
 * means that uniqueness may transiently fail to hold intra-transaction. 
 * That's appropriate when we are making statistical estimates, but beware 
 * of using this for any correctness proofs. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN1732"></a><span class='Declare_Function'>has_unique_index</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a> <span class='Declare_Parameter'>attno</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1734"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>ilist</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1734"><span class='Ref_To_Local'>ilist</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN1732"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN561"><span class='Ref_to_Member'>indexlist</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1738"></a>        <a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>index</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN626"><span class='Ref_to_Struct'>IndexOptInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1734"><span class='Ref_To_Local'>ilist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Note: ignore partial indexes, since they don't allow us to conclude 
         * that all attr values are distinct, *unless* they are marked predOK 
         * which means we know the index's predicate is satisfied by the 
         * query. We don't take any interest in expressional indexes either. 
         * Also, a multicolumn unique index doesn't allow us to conclude that 
         * just the specified attr is unique. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN1738"><span class='Ref_To_Local'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN663"><span class='Ref_to_Member'>unique</span></a> <span class='Operator'>&& 
</span>            <a href="plancat.c.html#LN1738"><span class='Ref_To_Local'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN640"><span class='Ref_to_Member'>ncolumns</span></a> <span class='Operator'>== </span><span class='Number'>1</span> <span class='Operator'>&& 
</span>            <a href="plancat.c.html#LN1738"><span class='Ref_To_Local'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN641"><span class='Ref_to_Member'>indexkeys</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><a href="plancat.c.html#LN1732"><span class='Ref_to_Parameter'>attno</span></a> <span class='Operator'>&& 
</span>            <span class='Parentheses'>(</span><a href="plancat.c.html#LN1738"><span class='Ref_To_Local'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN653"><span class='Ref_to_Member'>indpred</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a> <span class='Operator'>|| </span><a href="plancat.c.html#LN1738"><span class='Ref_To_Local'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN662"><span class='Ref_to_Member'>predOK</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end has_unique_index &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * has_row_triggers 
 * 
 * Detect whether the specified relation has any row-level triggers for event. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN1764"></a><span class='Declare_Function'>has_row_triggers</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>rti</span><span class='Delimiter'>, </span><a href="../../../include/nodes/nodes.h.html#LN647"><span class='Ref_to_Enum'>CmdType</span></a> <span class='Declare_Parameter'>event</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1766"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rte</span> <span class='Operator'>= </span><a href="../../../include/nodes/relation.h.html#LN324"><span class='Ref_to_Macro'>planner_rt_fetch</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1764"><span class='Ref_to_Parameter'>rti</span></a><span class='Delimiter'>, </span><a href="plancat.c.html#LN1764"><span class='Ref_to_Parameter'>root</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1767"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>relation</span><span class='Delimiter'>; 
</span><a name="LN1768"></a>    <a href="../../../include/utils/reltrigger.h.html#LN45"><span class='Ref_to_Struct'>TriggerDesc</span></a> <span class='Operator'>*</span><span class='Declare_Local'>trigDesc</span><span class='Delimiter'>; 
</span><a name="LN1769"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>result</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Assume we already have adequate lock */ 
</span>    <a href="plancat.c.html#LN1767"><span class='Ref_To_Local'>relation</span></a> <span class='Operator'>= </span><a href="../../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1766"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN947"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="plancat.c.html#LN1768"><span class='Ref_To_Local'>trigDesc</span></a> <span class='Operator'>= </span><a href="plancat.c.html#LN1767"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN119"><span class='Ref_to_Member'>trigdesc</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN1764"><span class='Ref_to_Parameter'>event</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN652"><span class='Ref_to_EnumConst'>CMD_INSERT</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN1768"><span class='Ref_To_Local'>trigDesc</span></a> <span class='Operator'>&& 
</span>                <span class='Parentheses'>(</span><a href="plancat.c.html#LN1768"><span class='Ref_To_Local'>trigDesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/reltrigger.h.html#LN55"><span class='Ref_to_Member'>trig_insert_after_row</span></a> <span class='Operator'>|| 
</span>                 <a href="plancat.c.html#LN1768"><span class='Ref_To_Local'>trigDesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/reltrigger.h.html#LN54"><span class='Ref_to_Member'>trig_insert_before_row</span></a><span class='Parentheses'>))</span> 
                <a href="plancat.c.html#LN1769"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN651"><span class='Ref_to_EnumConst'>CMD_UPDATE</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN1768"><span class='Ref_To_Local'>trigDesc</span></a> <span class='Operator'>&& 
</span>                <span class='Parentheses'>(</span><a href="plancat.c.html#LN1768"><span class='Ref_To_Local'>trigDesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/reltrigger.h.html#LN60"><span class='Ref_to_Member'>trig_update_after_row</span></a> <span class='Operator'>|| 
</span>                 <a href="plancat.c.html#LN1768"><span class='Ref_To_Local'>trigDesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/reltrigger.h.html#LN59"><span class='Ref_to_Member'>trig_update_before_row</span></a><span class='Parentheses'>))</span> 
                <a href="plancat.c.html#LN1769"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN653"><span class='Ref_to_EnumConst'>CMD_DELETE</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plancat.c.html#LN1768"><span class='Ref_To_Local'>trigDesc</span></a> <span class='Operator'>&& 
</span>                <span class='Parentheses'>(</span><a href="plancat.c.html#LN1768"><span class='Ref_To_Local'>trigDesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/reltrigger.h.html#LN65"><span class='Ref_to_Member'>trig_delete_after_row</span></a> <span class='Operator'>|| 
</span>                 <a href="plancat.c.html#LN1768"><span class='Ref_To_Local'>trigDesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/reltrigger.h.html#LN64"><span class='Ref_to_Member'>trig_delete_before_row</span></a><span class='Parentheses'>))</span> 
                <a href="plancat.c.html#LN1769"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized CmdType: %d"</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="plancat.c.html#LN1764"><span class='Ref_to_Parameter'>event</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch event &raquo; </span> 
 
    <a href="../../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="plancat.c.html#LN1767"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="plancat.c.html#LN1769"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end has_row_triggers &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>