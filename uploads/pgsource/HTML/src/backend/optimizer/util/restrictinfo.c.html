<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\optimizer\util\restrictinfo.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\optimizer\util\restrictinfo.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:43 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * restrictinfo.c 
 *    RestrictInfo node manipulation routines. 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/optimizer/util/restrictinfo.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"optimizer/clauses.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/restrictinfo.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/var.h"</span> 
 
 
<a name="LN21"></a><span class='Keyword'>static </span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>make_restrictinfo_internal</span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>clause</span><span class='Delimiter'>, 
</span><a name="LN22"></a>                           <a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>orclause</span><span class='Delimiter'>, 
</span><a name="LN23"></a>                           <span class='Keyword'>bool </span><span class='Declare_Parameter'>is_pushed_down</span><span class='Delimiter'>, 
</span><a name="LN24"></a>                           <span class='Keyword'>bool </span><span class='Declare_Parameter'>outerjoin_delayed</span><span class='Delimiter'>, 
</span><a name="LN25"></a>                           <span class='Keyword'>bool </span><span class='Declare_Parameter'>pseudoconstant</span><span class='Delimiter'>, 
</span><a name="LN26"></a>                           <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>security_level</span><span class='Delimiter'>, 
</span><a name="LN27"></a>                           <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>required_relids</span><span class='Delimiter'>, 
</span><a name="LN28"></a>                           <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>outer_relids</span><span class='Delimiter'>, 
</span><a name="LN29"></a>                           <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>nullable_relids</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN30"></a><span class='Keyword'>static </span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>make_sub_restrictinfos</span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>clause</span><span class='Delimiter'>, 
</span><a name="LN31"></a>                       <span class='Keyword'>bool </span><span class='Declare_Parameter'>is_pushed_down</span><span class='Delimiter'>, 
</span><a name="LN32"></a>                       <span class='Keyword'>bool </span><span class='Declare_Parameter'>outerjoin_delayed</span><span class='Delimiter'>, 
</span><a name="LN33"></a>                       <span class='Keyword'>bool </span><span class='Declare_Parameter'>pseudoconstant</span><span class='Delimiter'>, 
</span><a name="LN34"></a>                       <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>security_level</span><span class='Delimiter'>, 
</span><a name="LN35"></a>                       <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>required_relids</span><span class='Delimiter'>, 
</span><a name="LN36"></a>                       <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>outer_relids</span><span class='Delimiter'>, 
</span><a name="LN37"></a>                       <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>nullable_relids</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * make_restrictinfo 
 * 
 * Build a RestrictInfo node containing the given subexpression. 
 * 
 * The is_pushed_down, outerjoin_delayed, and pseudoconstant flags for the 
 * RestrictInfo must be supplied by the caller, as well as the correct values 
 * for security_level, outer_relids, and nullable_relids. 
 * required_relids can be NULL, in which case it defaults to the actual clause 
 * contents (i.e., clause_relids). 
 * 
 * We initialize fields that depend only on the given subexpression, leaving 
 * others that depend on context (or may never be needed at all) to be filled 
 * later. 
 */ 
</span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>* 
</span><a name="LN56"></a><span class='Declare_Function'>make_restrictinfo</span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>clause</span><span class='Delimiter'>, 
</span><a name="LN57"></a>                  <span class='Keyword'>bool </span><span class='Declare_Parameter'>is_pushed_down</span><span class='Delimiter'>, 
</span><a name="LN58"></a>                  <span class='Keyword'>bool </span><span class='Declare_Parameter'>outerjoin_delayed</span><span class='Delimiter'>, 
</span><a name="LN59"></a>                  <span class='Keyword'>bool </span><span class='Declare_Parameter'>pseudoconstant</span><span class='Delimiter'>, 
</span><a name="LN60"></a>                  <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>security_level</span><span class='Delimiter'>, 
</span><a name="LN61"></a>                  <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>required_relids</span><span class='Delimiter'>, 
</span><a name="LN62"></a>                  <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>outer_relids</span><span class='Delimiter'>, 
</span><a name="LN63"></a>                  <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>nullable_relids</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * If it's an OR clause, build a modified copy with RestrictInfos inserted 
     * above each subclause of the top-level AND/OR structure. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/optimizer/clauses.h.html#LN39"><span class='Ref_to_Proto'>or_clause</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="restrictinfo.c.html#LN56"><span class='Ref_to_Parameter'>clause</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="restrictinfo.c.html#LN30"><span class='Ref_to_Proto'>make_sub_restrictinfos</span></a><span class='Parentheses'>(</span><a href="restrictinfo.c.html#LN56"><span class='Ref_to_Parameter'>clause</span></a><span class='Delimiter'>, 
</span>                                                       <a href="restrictinfo.c.html#LN57"><span class='Ref_to_Parameter'>is_pushed_down</span></a><span class='Delimiter'>, 
</span>                                                       <a href="restrictinfo.c.html#LN58"><span class='Ref_to_Parameter'>outerjoin_delayed</span></a><span class='Delimiter'>, 
</span>                                                       <a href="restrictinfo.c.html#LN59"><span class='Ref_to_Parameter'>pseudoconstant</span></a><span class='Delimiter'>, 
</span>                                                       <a href="restrictinfo.c.html#LN60"><span class='Ref_to_Parameter'>security_level</span></a><span class='Delimiter'>, 
</span>                                                       <a href="restrictinfo.c.html#LN61"><span class='Ref_to_Parameter'>required_relids</span></a><span class='Delimiter'>, 
</span>                                                       <a href="restrictinfo.c.html#LN62"><span class='Ref_to_Parameter'>outer_relids</span></a><span class='Delimiter'>, 
</span>                                                       <a href="restrictinfo.c.html#LN63"><span class='Ref_to_Parameter'>nullable_relids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Shouldn't be an AND clause, else AND/OR flattening messed up */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/optimizer/clauses.h.html#LN42"><span class='Ref_to_Proto'>and_clause</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="restrictinfo.c.html#LN56"><span class='Ref_to_Parameter'>clause</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="restrictinfo.c.html#LN21"><span class='Ref_to_Proto'>make_restrictinfo_internal</span></a><span class='Parentheses'>(</span><a href="restrictinfo.c.html#LN56"><span class='Ref_to_Parameter'>clause</span></a><span class='Delimiter'>, 
</span>                                      <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                      <a href="restrictinfo.c.html#LN57"><span class='Ref_to_Parameter'>is_pushed_down</span></a><span class='Delimiter'>, 
</span>                                      <a href="restrictinfo.c.html#LN58"><span class='Ref_to_Parameter'>outerjoin_delayed</span></a><span class='Delimiter'>, 
</span>                                      <a href="restrictinfo.c.html#LN59"><span class='Ref_to_Parameter'>pseudoconstant</span></a><span class='Delimiter'>, 
</span>                                      <a href="restrictinfo.c.html#LN60"><span class='Ref_to_Parameter'>security_level</span></a><span class='Delimiter'>, 
</span>                                      <a href="restrictinfo.c.html#LN61"><span class='Ref_to_Parameter'>required_relids</span></a><span class='Delimiter'>, 
</span>                                      <a href="restrictinfo.c.html#LN62"><span class='Ref_to_Parameter'>outer_relids</span></a><span class='Delimiter'>, 
</span>                                      <a href="restrictinfo.c.html#LN63"><span class='Ref_to_Parameter'>nullable_relids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end make_restrictinfo &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * make_restrictinfo_internal 
 * 
 * Common code for the main entry points and the recursive cases. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>* 
</span><a name="LN99"></a><span class='Declare_Function'>make_restrictinfo_internal</span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>clause</span><span class='Delimiter'>, 
</span><a name="LN100"></a>                           <a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>orclause</span><span class='Delimiter'>, 
</span><a name="LN101"></a>                           <span class='Keyword'>bool </span><span class='Declare_Parameter'>is_pushed_down</span><span class='Delimiter'>, 
</span><a name="LN102"></a>                           <span class='Keyword'>bool </span><span class='Declare_Parameter'>outerjoin_delayed</span><span class='Delimiter'>, 
</span><a name="LN103"></a>                           <span class='Keyword'>bool </span><span class='Declare_Parameter'>pseudoconstant</span><span class='Delimiter'>, 
</span><a name="LN104"></a>                           <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>security_level</span><span class='Delimiter'>, 
</span><a name="LN105"></a>                           <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>required_relids</span><span class='Delimiter'>, 
</span><a name="LN106"></a>                           <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>outer_relids</span><span class='Delimiter'>, 
</span><a name="LN107"></a>                           <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>nullable_relids</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN109"></a>    <a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>restrictinfo</span> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="restrictinfo.c.html#LN109"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1746"><span class='Ref_to_Member'>clause</span></a> <span class='Operator'>= </span><a href="restrictinfo.c.html#LN99"><span class='Ref_to_Parameter'>clause</span></a><span class='Delimiter'>; 
</span>    <a href="restrictinfo.c.html#LN109"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1777"><span class='Ref_to_Member'>orclause</span></a> <span class='Operator'>= </span><a href="restrictinfo.c.html#LN100"><span class='Ref_to_Parameter'>orclause</span></a><span class='Delimiter'>; 
</span>    <a href="restrictinfo.c.html#LN109"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1748"><span class='Ref_to_Member'>is_pushed_down</span></a> <span class='Operator'>= </span><a href="restrictinfo.c.html#LN101"><span class='Ref_to_Parameter'>is_pushed_down</span></a><span class='Delimiter'>; 
</span>    <a href="restrictinfo.c.html#LN109"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1750"><span class='Ref_to_Member'>outerjoin_delayed</span></a> <span class='Operator'>= </span><a href="restrictinfo.c.html#LN102"><span class='Ref_to_Parameter'>outerjoin_delayed</span></a><span class='Delimiter'>; 
</span>    <a href="restrictinfo.c.html#LN109"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1754"><span class='Ref_to_Member'>pseudoconstant</span></a> <span class='Operator'>= </span><a href="restrictinfo.c.html#LN103"><span class='Ref_to_Parameter'>pseudoconstant</span></a><span class='Delimiter'>; 
</span>    <a href="restrictinfo.c.html#LN109"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1752"><span class='Ref_to_Member'>can_join</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* may get set below */ 
</span>    <a href="restrictinfo.c.html#LN109"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1758"><span class='Ref_to_Member'>security_level</span></a> <span class='Operator'>= </span><a href="restrictinfo.c.html#LN104"><span class='Ref_to_Parameter'>security_level</span></a><span class='Delimiter'>; 
</span>    <a href="restrictinfo.c.html#LN109"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1767"><span class='Ref_to_Member'>outer_relids</span></a> <span class='Operator'>= </span><a href="restrictinfo.c.html#LN106"><span class='Ref_to_Parameter'>outer_relids</span></a><span class='Delimiter'>; 
</span>    <a href="restrictinfo.c.html#LN109"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1770"><span class='Ref_to_Member'>nullable_relids</span></a> <span class='Operator'>= </span><a href="restrictinfo.c.html#LN107"><span class='Ref_to_Parameter'>nullable_relids</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If it's potentially delayable by lower-level security quals, figure out 
     * whether it's leakproof.  We can skip testing this for level-zero quals, 
     * since they would never get delayed on security grounds anyway. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="restrictinfo.c.html#LN104"><span class='Ref_to_Parameter'>security_level</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="restrictinfo.c.html#LN109"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1756"><span class='Ref_to_Member'>leakproof</span></a> <span class='Operator'>= !</span><a href="../../../include/optimizer/clauses.h.html#LN65"><span class='Ref_to_Proto'>contain_leaked_vars</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="restrictinfo.c.html#LN99"><span class='Ref_to_Parameter'>clause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="restrictinfo.c.html#LN109"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1756"><span class='Ref_to_Member'>leakproof</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* really, "don't know" */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If it's a binary opclause, set up left/right relids info. In any case 
     * set up the total clause relids info. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/optimizer/clauses.h.html#LN19"><span class='Ref_to_Macro'>is_opclause</span></a><span class='Parentheses'>(</span><a href="restrictinfo.c.html#LN99"><span class='Ref_to_Parameter'>clause</span></a><span class='Parentheses'>)</span> <span class='Operator'>&& </span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(((</span><a href="../../../include/nodes/primnodes.h.html#LN491"><span class='Ref_to_Struct'>OpExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="restrictinfo.c.html#LN99"><span class='Ref_to_Parameter'>clause</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>args<span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Number'>2</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="restrictinfo.c.html#LN109"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1773"><span class='Ref_to_Member'>left_relids</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/var.h.html#LN29"><span class='Ref_to_Proto'>pull_varnos</span></a><span class='Parentheses'>(</span><a href="../../../include/optimizer/clauses.h.html#LN32"><span class='Ref_to_Proto'>get_leftop</span></a><span class='Parentheses'>(</span><a href="restrictinfo.c.html#LN99"><span class='Ref_to_Parameter'>clause</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="restrictinfo.c.html#LN109"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1774"><span class='Ref_to_Member'>right_relids</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/var.h.html#LN29"><span class='Ref_to_Proto'>pull_varnos</span></a><span class='Parentheses'>(</span><a href="../../../include/optimizer/clauses.h.html#LN33"><span class='Ref_to_Proto'>get_rightop</span></a><span class='Parentheses'>(</span><a href="restrictinfo.c.html#LN99"><span class='Ref_to_Parameter'>clause</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="restrictinfo.c.html#LN109"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1761"><span class='Ref_to_Member'>clause_relids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN70"><span class='Ref_to_Proto'>bms_union</span></a><span class='Parentheses'>(</span><a href="restrictinfo.c.html#LN109"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1773"><span class='Ref_to_Member'>left_relids</span></a><span class='Delimiter'>, 
</span>                                                <a href="restrictinfo.c.html#LN109"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1774"><span class='Ref_to_Member'>right_relids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Does it look like a normal join clause, i.e., a binary operator 
         * relating expressions that come from distinct relations? If so we 
         * might be able to use it in a join algorithm.  Note that this is a 
         * purely syntactic test that is made regardless of context. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/bitmapset.h.html#LN85"><span class='Ref_to_Proto'>bms_is_empty</span></a><span class='Parentheses'>(</span><a href="restrictinfo.c.html#LN109"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1773"><span class='Ref_to_Member'>left_relids</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>            <span class='Operator'>!</span><a href="../../../include/nodes/bitmapset.h.html#LN85"><span class='Ref_to_Proto'>bms_is_empty</span></a><span class='Parentheses'>(</span><a href="restrictinfo.c.html#LN109"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1774"><span class='Ref_to_Member'>right_relids</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>            <span class='Operator'>!</span><a href="../../../include/nodes/bitmapset.h.html#LN76"><span class='Ref_to_Proto'>bms_overlap</span></a><span class='Parentheses'>(</span><a href="restrictinfo.c.html#LN109"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1773"><span class='Ref_to_Member'>left_relids</span></a><span class='Delimiter'>, 
</span>                         <a href="restrictinfo.c.html#LN109"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1774"><span class='Ref_to_Member'>right_relids</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="restrictinfo.c.html#LN109"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1752"><span class='Ref_to_Member'>can_join</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* pseudoconstant should certainly not be true */ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="restrictinfo.c.html#LN109"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1754"><span class='Ref_to_Member'>pseudoconstant</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if is_opclause(clause)&&... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Not a binary opclause, so mark left/right relid sets as empty */ 
</span>        <a href="restrictinfo.c.html#LN109"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1773"><span class='Ref_to_Member'>left_relids</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="restrictinfo.c.html#LN109"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1774"><span class='Ref_to_Member'>right_relids</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* and get the total relid set the hard way */ 
</span>        <a href="restrictinfo.c.html#LN109"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1761"><span class='Ref_to_Member'>clause_relids</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/var.h.html#LN29"><span class='Ref_to_Proto'>pull_varnos</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="restrictinfo.c.html#LN99"><span class='Ref_to_Parameter'>clause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* required_relids defaults to clause_relids */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="restrictinfo.c.html#LN105"><span class='Ref_to_Parameter'>required_relids</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="restrictinfo.c.html#LN109"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1764"><span class='Ref_to_Member'>required_relids</span></a> <span class='Operator'>= </span><a href="restrictinfo.c.html#LN105"><span class='Ref_to_Parameter'>required_relids</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="restrictinfo.c.html#LN109"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1764"><span class='Ref_to_Member'>required_relids</span></a> <span class='Operator'>= </span><a href="restrictinfo.c.html#LN109"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1761"><span class='Ref_to_Member'>clause_relids</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Fill in all the cacheable fields with "not yet set" markers. None of 
     * these will be computed until/unless needed.  Note in particular that we 
     * don't mark a binary opclause as mergejoinable or hashjoinable here; 
     * that happens only if it appears in the right context (top level of a 
     * joinclause list). 
     */ 
</span>    <a href="restrictinfo.c.html#LN109"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1780"><span class='Ref_to_Member'>parent_ec</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="restrictinfo.c.html#LN109"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1783"><span class='Ref_to_Member'>eval_cost</span></a><span class='Operator'>.</span><a href="../../../include/nodes/relation.h.html#LN44"><span class='Ref_to_Member'>startup</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="restrictinfo.c.html#LN109"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1784"><span class='Ref_to_Member'>norm_selec</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="restrictinfo.c.html#LN109"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1787"><span class='Ref_to_Member'>outer_selec</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <a href="restrictinfo.c.html#LN109"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1791"><span class='Ref_to_Member'>mergeopfamilies</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <a href="restrictinfo.c.html#LN109"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1794"><span class='Ref_to_Member'>left_ec</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="restrictinfo.c.html#LN109"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1795"><span class='Ref_to_Member'>right_ec</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="restrictinfo.c.html#LN109"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1796"><span class='Ref_to_Member'>left_em</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="restrictinfo.c.html#LN109"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1797"><span class='Ref_to_Member'>right_em</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="restrictinfo.c.html#LN109"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1798"><span class='Ref_to_Member'>scansel_cache</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <a href="restrictinfo.c.html#LN109"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1801"><span class='Ref_to_Member'>outer_is_left</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <a href="restrictinfo.c.html#LN109"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1804"><span class='Ref_to_Member'>hashjoinoperator</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
    <a href="restrictinfo.c.html#LN109"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1807"><span class='Ref_to_Member'>left_bucketsize</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="restrictinfo.c.html#LN109"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1808"><span class='Ref_to_Member'>right_bucketsize</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="restrictinfo.c.html#LN109"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end make_restrictinfo_internal &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Recursively insert sub-RestrictInfo nodes into a boolean expression. 
 * 
 * We put RestrictInfos above simple (non-AND/OR) clauses and above 
 * sub-OR clauses, but not above sub-AND clauses, because there's no need. 
 * This may seem odd but it is closely related to the fact that we use 
 * implicit-AND lists at top level of RestrictInfo lists.  Only ORs and 
 * simple clauses are valid RestrictInfos. 
 * 
 * The same is_pushed_down, outerjoin_delayed, and pseudoconstant flag 
 * values can be applied to all RestrictInfo nodes in the result.  Likewise 
 * for security_level, outer_relids, and nullable_relids. 
 * 
 * The given required_relids are attached to our top-level output, 
 * but any OR-clause constituents are allowed to default to just the 
 * contained rels. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>* 
</span><a name="LN223"></a><span class='Declare_Function'>make_sub_restrictinfos</span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>clause</span><span class='Delimiter'>, 
</span><a name="LN224"></a>                       <span class='Keyword'>bool </span><span class='Declare_Parameter'>is_pushed_down</span><span class='Delimiter'>, 
</span><a name="LN225"></a>                       <span class='Keyword'>bool </span><span class='Declare_Parameter'>outerjoin_delayed</span><span class='Delimiter'>, 
</span><a name="LN226"></a>                       <span class='Keyword'>bool </span><span class='Declare_Parameter'>pseudoconstant</span><span class='Delimiter'>, 
</span><a name="LN227"></a>                       <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>security_level</span><span class='Delimiter'>, 
</span><a name="LN228"></a>                       <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>required_relids</span><span class='Delimiter'>, 
</span><a name="LN229"></a>                       <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>outer_relids</span><span class='Delimiter'>, 
</span><a name="LN230"></a>                       <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>nullable_relids</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/optimizer/clauses.h.html#LN39"><span class='Ref_to_Proto'>or_clause</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="restrictinfo.c.html#LN223"><span class='Ref_to_Parameter'>clause</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN234"></a>        <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>orlist</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN235"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>temp</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="restrictinfo.c.html#LN235"><span class='Ref_To_Local'>temp</span></a><span class='Delimiter'>, </span><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN557"><span class='Ref_to_Struct'>BoolExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="restrictinfo.c.html#LN223"><span class='Ref_to_Parameter'>clause</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>args<span class='Parentheses'>)</span> 
<a name="LN238"></a>            <span class='Declare_Local'>orlist</span> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="restrictinfo.c.html#LN234"><span class='Ref_To_Local'>orlist</span></a><span class='Delimiter'>, 
</span>                             <a href="restrictinfo.c.html#LN30"><span class='Ref_to_Proto'>make_sub_restrictinfos</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="restrictinfo.c.html#LN235"><span class='Ref_To_Local'>temp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                    <a href="restrictinfo.c.html#LN224"><span class='Ref_to_Parameter'>is_pushed_down</span></a><span class='Delimiter'>, 
</span>                                                    <a href="restrictinfo.c.html#LN225"><span class='Ref_to_Parameter'>outerjoin_delayed</span></a><span class='Delimiter'>, 
</span>                                                    <a href="restrictinfo.c.html#LN226"><span class='Ref_to_Parameter'>pseudoconstant</span></a><span class='Delimiter'>, 
</span>                                                    <a href="restrictinfo.c.html#LN227"><span class='Ref_to_Parameter'>security_level</span></a><span class='Delimiter'>, 
</span>                                                    <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                                    <a href="restrictinfo.c.html#LN229"><span class='Ref_to_Parameter'>outer_relids</span></a><span class='Delimiter'>, 
</span>                                                    <a href="restrictinfo.c.html#LN230"><span class='Ref_to_Parameter'>nullable_relids</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="restrictinfo.c.html#LN21"><span class='Ref_to_Proto'>make_restrictinfo_internal</span></a><span class='Parentheses'>(</span><a href="restrictinfo.c.html#LN223"><span class='Ref_to_Parameter'>clause</span></a><span class='Delimiter'>, 
</span>                                                   <a href="../../../include/optimizer/clauses.h.html#LN40"><span class='Ref_to_Proto'>make_orclause</span></a><span class='Parentheses'>(</span><a href="restrictinfo.c.html#LN234"><span class='Ref_To_Local'>orlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                   <a href="restrictinfo.c.html#LN224"><span class='Ref_to_Parameter'>is_pushed_down</span></a><span class='Delimiter'>, 
</span>                                                   <a href="restrictinfo.c.html#LN225"><span class='Ref_to_Parameter'>outerjoin_delayed</span></a><span class='Delimiter'>, 
</span>                                                   <a href="restrictinfo.c.html#LN226"><span class='Ref_to_Parameter'>pseudoconstant</span></a><span class='Delimiter'>, 
</span>                                                   <a href="restrictinfo.c.html#LN227"><span class='Ref_to_Parameter'>security_level</span></a><span class='Delimiter'>, 
</span>                                                   <a href="restrictinfo.c.html#LN228"><span class='Ref_to_Parameter'>required_relids</span></a><span class='Delimiter'>, 
</span>                                                   <a href="restrictinfo.c.html#LN229"><span class='Ref_to_Parameter'>outer_relids</span></a><span class='Delimiter'>, 
</span>                                                   <a href="restrictinfo.c.html#LN230"><span class='Ref_to_Parameter'>nullable_relids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if or_clause((Node*)clau... &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/optimizer/clauses.h.html#LN42"><span class='Ref_to_Proto'>and_clause</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="restrictinfo.c.html#LN223"><span class='Ref_to_Parameter'>clause</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN259"></a>        <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>andlist</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN260"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>temp</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="restrictinfo.c.html#LN260"><span class='Ref_To_Local'>temp</span></a><span class='Delimiter'>, </span><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN557"><span class='Ref_to_Struct'>BoolExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="restrictinfo.c.html#LN223"><span class='Ref_to_Parameter'>clause</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>args<span class='Parentheses'>)</span> 
<a name="LN263"></a>            <span class='Declare_Local'>andlist</span> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="restrictinfo.c.html#LN259"><span class='Ref_To_Local'>andlist</span></a><span class='Delimiter'>, 
</span>                              <a href="restrictinfo.c.html#LN30"><span class='Ref_to_Proto'>make_sub_restrictinfos</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="restrictinfo.c.html#LN260"><span class='Ref_To_Local'>temp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                     <a href="restrictinfo.c.html#LN224"><span class='Ref_to_Parameter'>is_pushed_down</span></a><span class='Delimiter'>, 
</span>                                                     <a href="restrictinfo.c.html#LN225"><span class='Ref_to_Parameter'>outerjoin_delayed</span></a><span class='Delimiter'>, 
</span>                                                     <a href="restrictinfo.c.html#LN226"><span class='Ref_to_Parameter'>pseudoconstant</span></a><span class='Delimiter'>, 
</span>                                                     <a href="restrictinfo.c.html#LN227"><span class='Ref_to_Parameter'>security_level</span></a><span class='Delimiter'>, 
</span>                                                     <a href="restrictinfo.c.html#LN228"><span class='Ref_to_Parameter'>required_relids</span></a><span class='Delimiter'>, 
</span>                                                     <a href="restrictinfo.c.html#LN229"><span class='Ref_to_Parameter'>outer_relids</span></a><span class='Delimiter'>, 
</span>                                                     <a href="restrictinfo.c.html#LN230"><span class='Ref_to_Parameter'>nullable_relids</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="../../../include/optimizer/clauses.h.html#LN43"><span class='Ref_to_Proto'>make_andclause</span></a><span class='Parentheses'>(</span><a href="restrictinfo.c.html#LN259"><span class='Ref_To_Local'>andlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="restrictinfo.c.html#LN21"><span class='Ref_to_Proto'>make_restrictinfo_internal</span></a><span class='Parentheses'>(</span><a href="restrictinfo.c.html#LN223"><span class='Ref_to_Parameter'>clause</span></a><span class='Delimiter'>, 
</span>                                                   <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                                   <a href="restrictinfo.c.html#LN224"><span class='Ref_to_Parameter'>is_pushed_down</span></a><span class='Delimiter'>, 
</span>                                                   <a href="restrictinfo.c.html#LN225"><span class='Ref_to_Parameter'>outerjoin_delayed</span></a><span class='Delimiter'>, 
</span>                                                   <a href="restrictinfo.c.html#LN226"><span class='Ref_to_Parameter'>pseudoconstant</span></a><span class='Delimiter'>, 
</span>                                                   <a href="restrictinfo.c.html#LN227"><span class='Ref_to_Parameter'>security_level</span></a><span class='Delimiter'>, 
</span>                                                   <a href="restrictinfo.c.html#LN228"><span class='Ref_to_Parameter'>required_relids</span></a><span class='Delimiter'>, 
</span>                                                   <a href="restrictinfo.c.html#LN229"><span class='Ref_to_Parameter'>outer_relids</span></a><span class='Delimiter'>, 
</span>                                                   <a href="restrictinfo.c.html#LN230"><span class='Ref_to_Parameter'>nullable_relids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end make_sub_restrictinfos &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * restriction_is_or_clause 
 * 
 * Returns t iff the restrictinfo node contains an 'or' clause. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN292"></a><span class='Declare_Function'>restriction_is_or_clause</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>restrictinfo</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="restrictinfo.c.html#LN292"><span class='Ref_to_Parameter'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1777"><span class='Ref_to_Member'>orclause</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * restriction_is_securely_promotable 
 * 
 * Returns true if it's okay to evaluate this clause "early", that is before 
 * other restriction clauses attached to the specified relation. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN307"></a><span class='Declare_Function'>restriction_is_securely_promotable</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>restrictinfo</span><span class='Delimiter'>, 
</span><a name="LN308"></a>                                   <a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * It's okay if there are no baserestrictinfo clauses for the rel that 
     * would need to go before this one, *or* if this one is leakproof. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="restrictinfo.c.html#LN307"><span class='Ref_to_Parameter'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1758"><span class='Ref_to_Member'>security_level</span></a> <span class='Operator'>&LT;= </span><a href="restrictinfo.c.html#LN308"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN586"><span class='Ref_to_Member'>baserestrict_min_security</span></a> <span class='Operator'>|| 
</span>        <a href="restrictinfo.c.html#LN307"><span class='Ref_to_Parameter'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1756"><span class='Ref_to_Member'>leakproof</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * get_actual_clauses 
 * 
 * Returns a list containing the bare clauses from 'restrictinfo_list'. 
 * 
 * This is only to be used in cases where none of the RestrictInfos can 
 * be pseudoconstant clauses (for instance, it's OK on indexqual lists). 
 */ 
</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN330"></a><span class='Declare_Function'>get_actual_clauses</span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>restrictinfo_list</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN332"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN333"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="restrictinfo.c.html#LN333"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="restrictinfo.c.html#LN330"><span class='Ref_to_Parameter'>restrictinfo_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN337"></a>        <a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rinfo</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN108"><span class='Ref_to_Macro'>lfirst_node</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a><span class='Delimiter'>, </span><a href="restrictinfo.c.html#LN333"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="restrictinfo.c.html#LN337"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1754"><span class='Ref_to_Member'>pseudoconstant</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="restrictinfo.c.html#LN332"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="restrictinfo.c.html#LN332"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="restrictinfo.c.html#LN337"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1746"><span class='Ref_to_Member'>clause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="restrictinfo.c.html#LN332"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * extract_actual_clauses 
 * 
 * Extract bare clauses from 'restrictinfo_list', returning either the 
 * regular ones or the pseudoconstant ones per 'pseudoconstant'. 
 */ 
</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN353"></a><span class='Declare_Function'>extract_actual_clauses</span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>restrictinfo_list</span><span class='Delimiter'>, 
</span><a name="LN354"></a>                       <span class='Keyword'>bool </span><span class='Declare_Parameter'>pseudoconstant</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN356"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN357"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="restrictinfo.c.html#LN357"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="restrictinfo.c.html#LN353"><span class='Ref_to_Parameter'>restrictinfo_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN361"></a>        <a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rinfo</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN108"><span class='Ref_to_Macro'>lfirst_node</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a><span class='Delimiter'>, </span><a href="restrictinfo.c.html#LN357"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="restrictinfo.c.html#LN361"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1754"><span class='Ref_to_Member'>pseudoconstant</span></a> <span class='Operator'>== </span><a href="restrictinfo.c.html#LN354"><span class='Ref_to_Parameter'>pseudoconstant</span></a><span class='Parentheses'>) 
</span>            <a href="restrictinfo.c.html#LN356"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="restrictinfo.c.html#LN356"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="restrictinfo.c.html#LN361"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1746"><span class='Ref_to_Member'>clause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="restrictinfo.c.html#LN356"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * extract_actual_join_clauses 
 * 
 * Extract bare clauses from 'restrictinfo_list', separating those that 
 * syntactically match the join level from those that were pushed down. 
 * Pseudoconstant clauses are excluded from the results. 
 * 
 * This is only used at outer joins, since for plain joins we don't care 
 * about pushed-down-ness. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN380"></a><span class='Declare_Function'>extract_actual_join_clauses</span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>restrictinfo_list</span><span class='Delimiter'>, 
</span><a name="LN381"></a>                            <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>joinquals</span><span class='Delimiter'>, 
</span><a name="LN382"></a>                            <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>otherquals</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN384"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="restrictinfo.c.html#LN381"><span class='Ref_to_Parameter'>joinquals</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="restrictinfo.c.html#LN382"><span class='Ref_to_Parameter'>otherquals</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="restrictinfo.c.html#LN384"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="restrictinfo.c.html#LN380"><span class='Ref_to_Parameter'>restrictinfo_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN391"></a>        <a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rinfo</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN108"><span class='Ref_to_Macro'>lfirst_node</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a><span class='Delimiter'>, </span><a href="restrictinfo.c.html#LN384"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="restrictinfo.c.html#LN391"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1748"><span class='Ref_to_Member'>is_pushed_down</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="restrictinfo.c.html#LN391"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1754"><span class='Ref_to_Member'>pseudoconstant</span></a><span class='Parentheses'>) 
</span>                <span class='Operator'>*</span><a href="restrictinfo.c.html#LN382"><span class='Ref_to_Parameter'>otherquals</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="restrictinfo.c.html#LN382"><span class='Ref_to_Parameter'>otherquals</span></a><span class='Delimiter'>, </span><a href="restrictinfo.c.html#LN391"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1746"><span class='Ref_to_Member'>clause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* joinquals shouldn't have been marked pseudoconstant */ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="restrictinfo.c.html#LN391"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1754"><span class='Ref_to_Member'>pseudoconstant</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="restrictinfo.c.html#LN381"><span class='Ref_to_Parameter'>joinquals</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="restrictinfo.c.html#LN381"><span class='Ref_to_Parameter'>joinquals</span></a><span class='Delimiter'>, </span><a href="restrictinfo.c.html#LN391"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1746"><span class='Ref_to_Member'>clause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end extract_actual_join_clauses &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * join_clause_is_movable_to 
 *      Test whether a join clause is a safe candidate for parameterization 
 *      of a scan on the specified base relation. 
 * 
 * A movable join clause is one that can safely be evaluated at a rel below 
 * its normal semantic level (ie, its required_relids), if the values of 
 * variables that it would need from other rels are provided. 
 * 
 * We insist that the clause actually reference the target relation; this 
 * prevents undesirable movement of degenerate join clauses, and ensures 
 * that there is a unique place that a clause can be moved down to. 
 * 
 * We cannot move an outer-join clause into the non-nullable side of its 
 * outer join, as that would change the results (rows would be suppressed 
 * rather than being null-extended). 
 * 
 * Also there must not be an outer join below the clause that would null the 
 * Vars coming from the target relation.  Otherwise the clause might give 
 * results different from what it would give at its normal semantic level. 
 * 
 * Also, the join clause must not use any relations that have LATERAL 
 * references to the target relation, since we could not put such rels on 
 * the outer side of a nestloop with the target relation. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN434"></a><span class='Declare_Function'>join_clause_is_movable_to</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rinfo</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>baserel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Clause must physically reference target rel */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/bitmapset.h.html#LN75"><span class='Ref_to_Proto'>bms_is_member</span></a><span class='Parentheses'>(</span><a href="restrictinfo.c.html#LN434"><span class='Ref_to_Parameter'>baserel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN552"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>, </span><a href="restrictinfo.c.html#LN434"><span class='Ref_to_Parameter'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1761"><span class='Ref_to_Member'>clause_relids</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Cannot move an outer-join clause into the join's outer side */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/bitmapset.h.html#LN75"><span class='Ref_to_Proto'>bms_is_member</span></a><span class='Parentheses'>(</span><a href="restrictinfo.c.html#LN434"><span class='Ref_to_Parameter'>baserel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN552"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>, </span><a href="restrictinfo.c.html#LN434"><span class='Ref_to_Parameter'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1767"><span class='Ref_to_Member'>outer_relids</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Target rel must not be nullable below the clause */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/bitmapset.h.html#LN75"><span class='Ref_to_Proto'>bms_is_member</span></a><span class='Parentheses'>(</span><a href="restrictinfo.c.html#LN434"><span class='Ref_to_Parameter'>baserel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN552"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>, </span><a href="restrictinfo.c.html#LN434"><span class='Ref_to_Parameter'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1770"><span class='Ref_to_Member'>nullable_relids</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Clause must not use any rels with LATERAL references to this rel */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/bitmapset.h.html#LN76"><span class='Ref_to_Proto'>bms_overlap</span></a><span class='Parentheses'>(</span><a href="restrictinfo.c.html#LN434"><span class='Ref_to_Parameter'>baserel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN560"><span class='Ref_to_Member'>lateral_referencers</span></a><span class='Delimiter'>, </span><a href="restrictinfo.c.html#LN434"><span class='Ref_to_Parameter'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1761"><span class='Ref_to_Member'>clause_relids</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end join_clause_is_movable_to &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * join_clause_is_movable_into 
 *      Test whether a join clause is movable and can be evaluated within 
 *      the current join context. 
 * 
 * currentrelids: the relids of the proposed evaluation location 
 * current_and_outer: the union of currentrelids and the required_outer 
 *      relids (parameterization's outer relations) 
 * 
 * The API would be a bit clearer if we passed the current relids and the 
 * outer relids separately and did bms_union internally; but since most 
 * callers need to apply this function to multiple clauses, we make the 
 * caller perform the union. 
 * 
 * Obviously, the clause must only refer to Vars available from the current 
 * relation plus the outer rels.  We also check that it does reference at 
 * least one current Var, ensuring that the clause will be pushed down to 
 * a unique place in a parameterized join tree.  And we check that we're 
 * not pushing the clause into its outer-join outer side, nor down into 
 * a lower outer join's inner side. 
 * 
 * The check about pushing a clause down into a lower outer join's inner side 
 * is only approximate; it sometimes returns "false" when actually it would 
 * be safe to use the clause here because we're still above the outer join 
 * in question.  This is okay as long as the answers at different join levels 
 * are consistent: it just means we might sometimes fail to push a clause as 
 * far down as it could safely be pushed.  It's unclear whether it would be 
 * worthwhile to do this more precisely.  (But if it's ever fixed to be 
 * exactly accurate, there's an Assert in get_joinrel_parampathinfo() that 
 * should be re-enabled.) 
 * 
 * There's no check here equivalent to join_clause_is_movable_to's test on 
 * lateral_referencers.  We assume the caller wouldn't be inquiring unless 
 * it'd verified that the proposed outer rels don't have lateral references 
 * to the current rel(s).  (If we are considering join paths with the outer 
 * rels on the outside and the current rels on the inside, then this should 
 * have been checked at the outset of such consideration; see join_is_legal 
 * and the path parameterization checks in joinpath.c.)  On the other hand, 
 * in join_clause_is_movable_to we are asking whether the clause could be 
 * moved for some valid set of outer rels, so we don't have the benefit of 
 * relying on prior checks for lateral-reference validity. 
 * 
 * Note: if this returns true, it means that the clause could be moved to 
 * this join relation, but that doesn't mean that this is the lowest join 
 * it could be moved to.  Caller may need to make additional calls to verify 
 * that this doesn't succeed on either of the inputs of a proposed join. 
 * 
 * Note: get_joinrel_parampathinfo depends on the fact that if 
 * current_and_outer is NULL, this function will always return false 
 * (since one or the other of the first two tests must fail). 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN507"></a><span class='Declare_Function'>join_clause_is_movable_into</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rinfo</span><span class='Delimiter'>, 
</span><a name="LN508"></a>                            <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>currentrelids</span><span class='Delimiter'>, 
</span><a name="LN509"></a>                            <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>current_and_outer</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Clause must be evaluable given available context */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/bitmapset.h.html#LN73"><span class='Ref_to_Proto'>bms_is_subset</span></a><span class='Parentheses'>(</span><a href="restrictinfo.c.html#LN507"><span class='Ref_to_Parameter'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1761"><span class='Ref_to_Member'>clause_relids</span></a><span class='Delimiter'>, </span><a href="restrictinfo.c.html#LN509"><span class='Ref_to_Parameter'>current_and_outer</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Clause must physically reference at least one target rel */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/bitmapset.h.html#LN76"><span class='Ref_to_Proto'>bms_overlap</span></a><span class='Parentheses'>(</span><a href="restrictinfo.c.html#LN508"><span class='Ref_to_Parameter'>currentrelids</span></a><span class='Delimiter'>, </span><a href="restrictinfo.c.html#LN507"><span class='Ref_to_Parameter'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1761"><span class='Ref_to_Member'>clause_relids</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Cannot move an outer-join clause into the join's outer side */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/bitmapset.h.html#LN76"><span class='Ref_to_Proto'>bms_overlap</span></a><span class='Parentheses'>(</span><a href="restrictinfo.c.html#LN508"><span class='Ref_to_Parameter'>currentrelids</span></a><span class='Delimiter'>, </span><a href="restrictinfo.c.html#LN507"><span class='Ref_to_Parameter'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1767"><span class='Ref_to_Member'>outer_relids</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Target rel(s) must not be nullable below the clause.  This is 
     * approximate, in the safe direction, because the current join might be 
     * above the join where the nulling would happen, in which case the clause 
     * would work correctly here.  But we don't have enough info to be sure. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/bitmapset.h.html#LN76"><span class='Ref_to_Proto'>bms_overlap</span></a><span class='Parentheses'>(</span><a href="restrictinfo.c.html#LN508"><span class='Ref_to_Parameter'>currentrelids</span></a><span class='Delimiter'>, </span><a href="restrictinfo.c.html#LN507"><span class='Ref_to_Parameter'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1770"><span class='Ref_to_Member'>nullable_relids</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end join_clause_is_movable_into &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>