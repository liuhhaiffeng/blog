<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\optimizer\util\var.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\optimizer\util\var.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:43 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * var.c 
 *    Var node manipulation routines 
 * 
 * Note: for most purposes, PlaceHolderVar is considered a Var too, 
 * even if its contained expression is variable-free.  Also, CurrentOfExpr 
 * is treated as a Var for purposes of determining whether an expression 
 * contains variables. 
 * 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/optimizer/util/var.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/sysattr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"nodes/nodeFuncs.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/prep.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/var.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parsetree.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"rewrite/rewriteManip.h"</span> 
 
 
<span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN32"></a>    <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a>      <span class='Declare_Member'>varnos</span><span class='Delimiter'>; 
</span><a name="LN33"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>sublevels_up</span><span class='Delimiter'>; 
</span><a name="LN34"></a>} <span class='Declare_Typedef'>pull_varnos_context</span><span class='Delimiter'>; 
</span> 
<span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN38"></a>    <a href="../../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a>  <span class='Operator'>*</span><span class='Declare_Member'>varattnos</span><span class='Delimiter'>; 
</span><a name="LN39"></a>    <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a>       <span class='Declare_Member'>varno</span><span class='Delimiter'>; 
</span><a name="LN40"></a>} <span class='Declare_Typedef'>pull_varattnos_context</span><span class='Delimiter'>; 
</span> 
<span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN44"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>vars</span><span class='Delimiter'>; 
</span><a name="LN45"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>sublevels_up</span><span class='Delimiter'>; 
</span><a name="LN46"></a>} <span class='Declare_Typedef'>pull_vars_context</span><span class='Delimiter'>; 
</span> 
<span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN50"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>var_location</span><span class='Delimiter'>; 
</span><a name="LN51"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>sublevels_up</span><span class='Delimiter'>; 
</span><a name="LN52"></a>} <span class='Declare_Typedef'>locate_var_of_level_context</span><span class='Delimiter'>; 
</span> 
<span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN56"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>varlist</span><span class='Delimiter'>; 
</span><a name="LN57"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>flags</span><span class='Delimiter'>; 
</span><a name="LN58"></a>} <span class='Declare_Typedef'>pull_var_clause_context</span><span class='Delimiter'>; 
</span> 
<span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN62"></a>    <a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Member'>root</span><span class='Delimiter'>; 
</span><a name="LN63"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>sublevels_up</span><span class='Delimiter'>; 
</span><a name="LN64"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>possible_sublink</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* could aliases include a SubLink? */ 
</span><a name="LN65"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>inserted_sublink</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* have we inserted a SubLink? */ 
</span><a name="LN66"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>flatten_join_alias_vars_context</span><span class='Delimiter'>; 
</span> 
<a name="LN68"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>pull_varnos_walker</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, 
</span><a name="LN69"></a>                   <a href="var.c.html#LN30"><span class='Ref_to_Typedef'>pull_varnos_context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN70"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>pull_varattnos_walker</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><a href="var.c.html#LN36"><span class='Ref_to_Typedef'>pull_varattnos_context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN71"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>pull_vars_walker</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><a href="var.c.html#LN42"><span class='Ref_to_Typedef'>pull_vars_context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN72"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>contain_var_clause_walker</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN73"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>contain_vars_of_level_walker</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>sublevels_up</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN74"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>locate_var_of_level_walker</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, 
</span><a name="LN75"></a>                           <a href="var.c.html#LN48"><span class='Ref_to_Typedef'>locate_var_of_level_context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN76"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>pull_var_clause_walker</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, 
</span><a name="LN77"></a>                       <a href="var.c.html#LN54"><span class='Ref_to_Typedef'>pull_var_clause_context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN78"></a><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>flatten_join_alias_vars_mutator</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, 
</span><a name="LN79"></a>                                <a href="var.c.html#LN60"><span class='Ref_to_Typedef'>flatten_join_alias_vars_context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN80"></a><span class='Keyword'>static </span><a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Prototype'>alias_relid_set</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>relids</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * pull_varnos 
 *      Create a set of all the distinct varnos present in a parsetree. 
 *      Only varnos that reference level-zero rtable entries are considered. 
 * 
 * NOTE: this is used on not-yet-planned expressions.  It may therefore find 
 * bare SubLinks, and if so it needs to recurse into them to look for uplevel 
 * references to the desired rtable level!  But when we find a completed 
 * SubPlan, we only need to look at the parameters passed to the subplan. 
 */ 
</span><a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> 
<a name="LN94"></a><span class='Declare_Function'>pull_varnos</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN96"></a>    <a href="var.c.html#LN30"><span class='Ref_to_Typedef'>pull_varnos_context</span></a> <span class='Declare_Local'>context</span><span class='Delimiter'>; 
</span> 
    <a href="var.c.html#LN96"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="var.c.html#LN32"><span class='Ref_to_Member'>varnos</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="var.c.html#LN96"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="var.c.html#LN33"><span class='Ref_to_Member'>sublevels_up</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Must be prepared to start with a Query or a bare expression tree; if 
     * it's a Query, we don't want to increment sublevels_up. 
     */ 
</span>    <a href="../../../include/nodes/nodeFuncs.h.html#LN67"><span class='Ref_to_Proto'>query_or_expression_tree_walker</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN94"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, 
</span>                                    <a href="var.c.html#LN68"><span class='Ref_to_Proto'>pull_varnos_walker</span></a><span class='Delimiter'>, 
</span>                                    <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="var.c.html#LN96"><span class='Ref_To_Local'>context</span></a><span class='Delimiter'>, 
</span>                                    <span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="var.c.html#LN96"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="var.c.html#LN32"><span class='Ref_to_Member'>varnos</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * pull_varnos_of_level 
 *      Create a set of all the distinct varnos present in a parsetree. 
 *      Only Vars of the specified level are considered. 
 */ 
</span><a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> 
<a name="LN119"></a><span class='Declare_Function'>pull_varnos_of_level</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>levelsup</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN121"></a>    <a href="var.c.html#LN30"><span class='Ref_to_Typedef'>pull_varnos_context</span></a> <span class='Declare_Local'>context</span><span class='Delimiter'>; 
</span> 
    <a href="var.c.html#LN121"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="var.c.html#LN32"><span class='Ref_to_Member'>varnos</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="var.c.html#LN121"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="var.c.html#LN33"><span class='Ref_to_Member'>sublevels_up</span></a> <span class='Operator'>= </span><a href="var.c.html#LN119"><span class='Ref_to_Parameter'>levelsup</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Must be prepared to start with a Query or a bare expression tree; if 
     * it's a Query, we don't want to increment sublevels_up. 
     */ 
</span>    <a href="../../../include/nodes/nodeFuncs.h.html#LN67"><span class='Ref_to_Proto'>query_or_expression_tree_walker</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN119"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, 
</span>                                    <a href="var.c.html#LN68"><span class='Ref_to_Proto'>pull_varnos_walker</span></a><span class='Delimiter'>, 
</span>                                    <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="var.c.html#LN121"><span class='Ref_To_Local'>context</span></a><span class='Delimiter'>, 
</span>                                    <span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="var.c.html#LN121"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="var.c.html#LN32"><span class='Ref_to_Member'>varnos</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static bool 
</span><a name="LN139"></a><span class='Declare_Function'>pull_varnos_walker</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><a href="var.c.html#LN30"><span class='Ref_to_Typedef'>pull_varnos_context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="var.c.html#LN139"><span class='Ref_to_Parameter'>node</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN139"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN145"></a>        <a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>var</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="var.c.html#LN139"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="var.c.html#LN145"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN172"><span class='Ref_to_Member'>varlevelsup</span></a> <span class='Operator'>== </span><a href="var.c.html#LN139"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN33"><span class='Ref_to_Member'>sublevels_up</span></a><span class='Parentheses'>) 
</span>            <a href="var.c.html#LN139"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN32"><span class='Ref_to_Member'>varnos</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN89"><span class='Ref_to_Proto'>bms_add_member</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN139"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN32"><span class='Ref_to_Member'>varnos</span></a><span class='Delimiter'>, </span><a href="var.c.html#LN145"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN165"><span class='Ref_to_Member'>varno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN139"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1272"><span class='Ref_to_Struct'>CurrentOfExpr</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN153"></a>        <a href="../../../include/nodes/primnodes.h.html#LN1272"><span class='Ref_to_Struct'>CurrentOfExpr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cexpr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1272"><span class='Ref_to_Struct'>CurrentOfExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="var.c.html#LN139"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="var.c.html#LN139"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN33"><span class='Ref_to_Member'>sublevels_up</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="var.c.html#LN139"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN32"><span class='Ref_to_Member'>varnos</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN89"><span class='Ref_to_Proto'>bms_add_member</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN139"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN32"><span class='Ref_to_Member'>varnos</span></a><span class='Delimiter'>, </span><a href="var.c.html#LN153"><span class='Ref_To_Local'>cexpr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1275"><span class='Ref_to_Member'>cvarno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN139"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN1846"><span class='Ref_to_Struct'>PlaceHolderVar</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * A PlaceHolderVar acts as a variable of its syntactic scope, or 
         * lower than that if it references only a subset of the rels in its 
         * syntactic scope.  It might also contain lateral references, but we 
         * should ignore such references when computing the set of varnos in 
         * an expression tree.  Also, if the PHV contains no variables within 
         * its syntactic scope, it will be forced to be evaluated exactly at 
         * the syntactic scope, so take that as the relid set. 
         */ 
</span><a name="LN170"></a>        <a href="../../../include/nodes/relation.h.html#LN1846"><span class='Ref_to_Struct'>PlaceHolderVar</span></a> <span class='Operator'>*</span><span class='Declare_Local'>phv</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1846"><span class='Ref_to_Struct'>PlaceHolderVar</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="var.c.html#LN139"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span><a name="LN171"></a>        <a href="var.c.html#LN30"><span class='Ref_to_Typedef'>pull_varnos_context</span></a> <span class='Declare_Local'>subcontext</span><span class='Delimiter'>; 
</span> 
        <a href="var.c.html#LN171"><span class='Ref_To_Local'>subcontext</span></a><span class='Operator'>.</span><a href="var.c.html#LN32"><span class='Ref_to_Member'>varnos</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="var.c.html#LN171"><span class='Ref_To_Local'>subcontext</span></a><span class='Operator'>.</span><a href="var.c.html#LN33"><span class='Ref_to_Member'>sublevels_up</span></a> <span class='Operator'>= </span><a href="var.c.html#LN139"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN33"><span class='Ref_to_Member'>sublevels_up</span></a><span class='Delimiter'>; 
</span>        <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="var.c.html#LN68"><span class='Ref_to_Proto'>pull_varnos_walker</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="var.c.html#LN170"><span class='Ref_To_Local'>phv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1849"><span class='Ref_to_Member'>phexpr</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="var.c.html#LN171"><span class='Ref_To_Local'>subcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="var.c.html#LN170"><span class='Ref_To_Local'>phv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1852"><span class='Ref_to_Member'>phlevelsup</span></a> <span class='Operator'>== </span><a href="var.c.html#LN139"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN33"><span class='Ref_to_Member'>sublevels_up</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="var.c.html#LN171"><span class='Ref_To_Local'>subcontext</span></a><span class='Operator'>.</span><a href="var.c.html#LN32"><span class='Ref_to_Member'>varnos</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN92"><span class='Ref_to_Proto'>bms_int_members</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN171"><span class='Ref_To_Local'>subcontext</span></a><span class='Operator'>.</span><a href="var.c.html#LN32"><span class='Ref_to_Member'>varnos</span></a><span class='Delimiter'>, 
</span>                                                <a href="var.c.html#LN170"><span class='Ref_To_Local'>phv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1850"><span class='Ref_to_Member'>phrels</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/bitmapset.h.html#LN85"><span class='Ref_to_Proto'>bms_is_empty</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN171"><span class='Ref_To_Local'>subcontext</span></a><span class='Operator'>.</span><a href="var.c.html#LN32"><span class='Ref_to_Member'>varnos</span></a><span class='Parentheses'>))</span> 
                <a href="var.c.html#LN139"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN32"><span class='Ref_to_Member'>varnos</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN91"><span class='Ref_to_Proto'>bms_add_members</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN139"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN32"><span class='Ref_to_Member'>varnos</span></a><span class='Delimiter'>, 
</span>                                                  <a href="var.c.html#LN170"><span class='Ref_To_Local'>phv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1850"><span class='Ref_to_Member'>phrels</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="var.c.html#LN139"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN32"><span class='Ref_to_Member'>varnos</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN94"><span class='Ref_to_Proto'>bms_join</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN139"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN32"><span class='Ref_to_Member'>varnos</span></a><span class='Delimiter'>, </span><a href="var.c.html#LN171"><span class='Ref_To_Local'>subcontext</span></a><span class='Operator'>.</span><a href="var.c.html#LN32"><span class='Ref_to_Member'>varnos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IsA(node,PlaceHolderV... &raquo; </span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN139"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Recurse into RTE subquery or not-yet-planned sublink subquery */ 
</span><a name="LN190"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
        <a href="var.c.html#LN139"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN33"><span class='Ref_to_Member'>sublevels_up</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="var.c.html#LN190"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodeFuncs.h.html#LN57"><span class='Ref_to_Proto'>query_tree_walker</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="var.c.html#LN139"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="var.c.html#LN68"><span class='Ref_to_Proto'>pull_varnos_walker</span></a><span class='Delimiter'>, 
</span>                                   <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="var.c.html#LN139"><span class='Ref_to_Parameter'>context</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="var.c.html#LN139"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN33"><span class='Ref_to_Member'>sublevels_up</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="var.c.html#LN190"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="../../../include/nodes/nodeFuncs.h.html#LN52"><span class='Ref_to_Proto'>expression_tree_walker</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN139"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="var.c.html#LN68"><span class='Ref_to_Proto'>pull_varnos_walker</span></a><span class='Delimiter'>, 
</span>                                  <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="var.c.html#LN139"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pull_varnos_walker &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * pull_varattnos 
 *      Find all the distinct attribute numbers present in an expression tree, 
 *      and add them to the initial contents of *varattnos. 
 *      Only Vars of the given varno and rtable level zero are considered. 
 * 
 * Attribute numbers are offset by FirstLowInvalidHeapAttributeNumber so that 
 * we can include system attributes (e.g., OID) in the bitmap representation. 
 * 
 * Currently, this does not support unplanned subqueries; that is not needed 
 * for current uses.  It will handle already-planned SubPlan nodes, though, 
 * looking into only the "testexpr" and the "args" list.  (The subplan cannot 
 * contain any other references to Vars of the current level.) 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN218"></a><span class='Declare_Function'>pull_varattnos</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>varno</span><span class='Delimiter'>, </span><a href="../../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>varattnos</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN220"></a>    <a href="var.c.html#LN36"><span class='Ref_to_Typedef'>pull_varattnos_context</span></a> <span class='Declare_Local'>context</span><span class='Delimiter'>; 
</span> 
    <a href="var.c.html#LN220"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="var.c.html#LN38"><span class='Ref_to_Member'>varattnos</span></a> <span class='Operator'>= *</span><a href="var.c.html#LN218"><span class='Ref_to_Parameter'>varattnos</span></a><span class='Delimiter'>; 
</span>    <a href="var.c.html#LN220"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="var.c.html#LN39"><span class='Ref_to_Member'>varno</span></a> <span class='Operator'>= </span><a href="var.c.html#LN218"><span class='Ref_to_Parameter'>varno</span></a><span class='Delimiter'>; 
</span> 
    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="var.c.html#LN70"><span class='Ref_to_Proto'>pull_varattnos_walker</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN218"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="var.c.html#LN220"><span class='Ref_To_Local'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="var.c.html#LN218"><span class='Ref_to_Parameter'>varattnos</span></a> <span class='Operator'>= </span><a href="var.c.html#LN220"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="var.c.html#LN38"><span class='Ref_to_Member'>varattnos</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static bool 
</span><a name="LN231"></a><span class='Declare_Function'>pull_varattnos_walker</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><a href="var.c.html#LN36"><span class='Ref_to_Typedef'>pull_varattnos_context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="var.c.html#LN231"><span class='Ref_to_Parameter'>node</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN231"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN237"></a>        <a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>var</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="var.c.html#LN231"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="var.c.html#LN237"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN165"><span class='Ref_to_Member'>varno</span></a> <span class='Operator'>== </span><a href="var.c.html#LN231"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN39"><span class='Ref_to_Member'>varno</span></a> <span class='Operator'>&& </span><a href="var.c.html#LN237"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN172"><span class='Ref_to_Member'>varlevelsup</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="var.c.html#LN231"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN38"><span class='Ref_to_Member'>varattnos</span></a> <span class='Operator'>= 
</span>                <a href="../../../include/nodes/bitmapset.h.html#LN89"><span class='Ref_to_Proto'>bms_add_member</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN231"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN38"><span class='Ref_to_Member'>varattnos</span></a><span class='Delimiter'>, 
</span>                         <a href="var.c.html#LN237"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN167"><span class='Ref_to_Member'>varattno</span></a> <span class='Operator'>- </span><a href="../../../include/access/sysattr.h.html#LN27"><span class='Ref_to_Const'>FirstLowInvalidHeapAttributeNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Should not find an unplanned subquery */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN231"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../../include/nodes/nodeFuncs.h.html#LN52"><span class='Ref_to_Proto'>expression_tree_walker</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN231"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="var.c.html#LN70"><span class='Ref_to_Proto'>pull_varattnos_walker</span></a><span class='Delimiter'>, 
</span>                                  <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="var.c.html#LN231"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pull_varattnos_walker &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * pull_vars_of_level 
 *      Create a list of all Vars (and PlaceHolderVars) referencing the 
 *      specified query level in the given parsetree. 
 * 
 * Caution: the Vars are not copied, only linked into the list. 
 */ 
</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN262"></a><span class='Declare_Function'>pull_vars_of_level</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>levelsup</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN264"></a>    <a href="var.c.html#LN42"><span class='Ref_to_Typedef'>pull_vars_context</span></a> <span class='Declare_Local'>context</span><span class='Delimiter'>; 
</span> 
    <a href="var.c.html#LN264"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="var.c.html#LN44"><span class='Ref_to_Member'>vars</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="var.c.html#LN264"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="var.c.html#LN45"><span class='Ref_to_Member'>sublevels_up</span></a> <span class='Operator'>= </span><a href="var.c.html#LN262"><span class='Ref_to_Parameter'>levelsup</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Must be prepared to start with a Query or a bare expression tree; if 
     * it's a Query, we don't want to increment sublevels_up. 
     */ 
</span>    <a href="../../../include/nodes/nodeFuncs.h.html#LN67"><span class='Ref_to_Proto'>query_or_expression_tree_walker</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN262"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, 
</span>                                    <a href="var.c.html#LN71"><span class='Ref_to_Proto'>pull_vars_walker</span></a><span class='Delimiter'>, 
</span>                                    <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="var.c.html#LN264"><span class='Ref_To_Local'>context</span></a><span class='Delimiter'>, 
</span>                                    <span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="var.c.html#LN264"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="var.c.html#LN44"><span class='Ref_to_Member'>vars</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static bool 
</span><a name="LN282"></a><span class='Declare_Function'>pull_vars_walker</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><a href="var.c.html#LN42"><span class='Ref_to_Typedef'>pull_vars_context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="var.c.html#LN282"><span class='Ref_to_Parameter'>node</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN282"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN288"></a>        <a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>var</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="var.c.html#LN282"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="var.c.html#LN288"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN172"><span class='Ref_to_Member'>varlevelsup</span></a> <span class='Operator'>== </span><a href="var.c.html#LN282"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN45"><span class='Ref_to_Member'>sublevels_up</span></a><span class='Parentheses'>) 
</span>            <a href="var.c.html#LN282"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN44"><span class='Ref_to_Member'>vars</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN282"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN44"><span class='Ref_to_Member'>vars</span></a><span class='Delimiter'>, </span><a href="var.c.html#LN288"><span class='Ref_To_Local'>var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN282"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN1846"><span class='Ref_to_Struct'>PlaceHolderVar</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN296"></a>        <a href="../../../include/nodes/relation.h.html#LN1846"><span class='Ref_to_Struct'>PlaceHolderVar</span></a> <span class='Operator'>*</span><span class='Declare_Local'>phv</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1846"><span class='Ref_to_Struct'>PlaceHolderVar</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="var.c.html#LN282"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="var.c.html#LN296"><span class='Ref_To_Local'>phv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1852"><span class='Ref_to_Member'>phlevelsup</span></a> <span class='Operator'>== </span><a href="var.c.html#LN282"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN45"><span class='Ref_to_Member'>sublevels_up</span></a><span class='Parentheses'>) 
</span>            <a href="var.c.html#LN282"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN44"><span class='Ref_to_Member'>vars</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN282"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN44"><span class='Ref_to_Member'>vars</span></a><span class='Delimiter'>, </span><a href="var.c.html#LN296"><span class='Ref_To_Local'>phv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* we don't want to look into the contained expression */ 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN282"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Recurse into RTE subquery or not-yet-planned sublink subquery */ 
</span><a name="LN306"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
        <a href="var.c.html#LN282"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN45"><span class='Ref_to_Member'>sublevels_up</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="var.c.html#LN306"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodeFuncs.h.html#LN57"><span class='Ref_to_Proto'>query_tree_walker</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="var.c.html#LN282"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="var.c.html#LN71"><span class='Ref_to_Proto'>pull_vars_walker</span></a><span class='Delimiter'>, 
</span>                                   <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="var.c.html#LN282"><span class='Ref_to_Parameter'>context</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="var.c.html#LN282"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN45"><span class='Ref_to_Member'>sublevels_up</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="var.c.html#LN306"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="../../../include/nodes/nodeFuncs.h.html#LN52"><span class='Ref_to_Proto'>expression_tree_walker</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN282"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="var.c.html#LN71"><span class='Ref_to_Proto'>pull_vars_walker</span></a><span class='Delimiter'>, 
</span>                                  <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="var.c.html#LN282"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pull_vars_walker &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * contain_var_clause 
 *    Recursively scan a clause to discover whether it contains any Var nodes 
 *    (of the current query level). 
 * 
 *    Returns true if any varnode found. 
 * 
 * Does not examine subqueries, therefore must only be used after reduction 
 * of sublinks to subplans! 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN330"></a><span class='Declare_Function'>contain_var_clause</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="var.c.html#LN72"><span class='Ref_to_Proto'>contain_var_clause_walker</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN330"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static bool 
</span><a name="LN336"></a><span class='Declare_Function'>contain_var_clause_walker</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="var.c.html#LN336"><span class='Ref_to_Parameter'>node</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN336"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(((</span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="var.c.html#LN336"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>varlevelsup <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* abort the tree traversal and return true */ 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN336"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1272"><span class='Ref_to_Struct'>CurrentOfExpr</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN336"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN1846"><span class='Ref_to_Struct'>PlaceHolderVar</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(((</span><a href="../../../include/nodes/relation.h.html#LN1846"><span class='Ref_to_Struct'>PlaceHolderVar</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="var.c.html#LN336"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>phlevelsup <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* abort the tree traversal and return true */ 
</span>        <span class='Comment_Multi_Line'>/* else fall through to check the contained expr */ 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="../../../include/nodes/nodeFuncs.h.html#LN52"><span class='Ref_to_Proto'>expression_tree_walker</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN336"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="var.c.html#LN72"><span class='Ref_to_Proto'>contain_var_clause_walker</span></a><span class='Delimiter'>, </span><a href="var.c.html#LN336"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end contain_var_clause_walker &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * contain_vars_of_level 
 *    Recursively scan a clause to discover whether it contains any Var nodes 
 *    of the specified query level. 
 * 
 *    Returns true if any such Var found. 
 * 
 * Will recurse into sublinks.  Also, may be invoked directly on a Query. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN368"></a><span class='Declare_Function'>contain_vars_of_level</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>levelsup</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN370"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>sublevels_up</span> <span class='Operator'>= </span><a href="var.c.html#LN368"><span class='Ref_to_Parameter'>levelsup</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../../include/nodes/nodeFuncs.h.html#LN67"><span class='Ref_to_Proto'>query_or_expression_tree_walker</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN368"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, 
</span>                                           <a href="var.c.html#LN73"><span class='Ref_to_Proto'>contain_vars_of_level_walker</span></a><span class='Delimiter'>, 
</span>                                           <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="var.c.html#LN370"><span class='Ref_To_Local'>sublevels_up</span></a><span class='Delimiter'>, 
</span>                                           <span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static bool 
</span><a name="LN379"></a><span class='Declare_Function'>contain_vars_of_level_walker</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>sublevels_up</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="var.c.html#LN379"><span class='Ref_to_Parameter'>node</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN379"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(((</span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="var.c.html#LN379"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>varlevelsup <span class='Operator'>== *</span><a href="var.c.html#LN379"><span class='Ref_to_Parameter'>sublevels_up</span></a><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* abort tree traversal and return true */ 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN379"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1272"><span class='Ref_to_Struct'>CurrentOfExpr</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="var.c.html#LN379"><span class='Ref_to_Parameter'>sublevels_up</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN379"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN1846"><span class='Ref_to_Struct'>PlaceHolderVar</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(((</span><a href="../../../include/nodes/relation.h.html#LN1846"><span class='Ref_to_Struct'>PlaceHolderVar</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="var.c.html#LN379"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>phlevelsup <span class='Operator'>== *</span><a href="var.c.html#LN379"><span class='Ref_to_Parameter'>sublevels_up</span></a><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* abort the tree traversal and return true */ 
</span>        <span class='Comment_Multi_Line'>/* else fall through to check the contained expr */ 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN379"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Recurse into subselects */ 
</span><a name="LN404"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="var.c.html#LN379"><span class='Ref_to_Parameter'>sublevels_up</span></a><span class='Parentheses'>)</span><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="var.c.html#LN404"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodeFuncs.h.html#LN57"><span class='Ref_to_Proto'>query_tree_walker</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="var.c.html#LN379"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, 
</span>                                   <a href="var.c.html#LN73"><span class='Ref_to_Proto'>contain_vars_of_level_walker</span></a><span class='Delimiter'>, 
</span>                                   <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="var.c.html#LN379"><span class='Ref_to_Parameter'>sublevels_up</span></a><span class='Delimiter'>, 
</span>                                   <span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="var.c.html#LN379"><span class='Ref_to_Parameter'>sublevels_up</span></a><span class='Parentheses'>)</span><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="var.c.html#LN404"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="../../../include/nodes/nodeFuncs.h.html#LN52"><span class='Ref_to_Proto'>expression_tree_walker</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN379"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, 
</span>                                  <a href="var.c.html#LN73"><span class='Ref_to_Proto'>contain_vars_of_level_walker</span></a><span class='Delimiter'>, 
</span>                                  <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="var.c.html#LN379"><span class='Ref_to_Parameter'>sublevels_up</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end contain_vars_of_level_walker &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * locate_var_of_level 
 *    Find the parse location of any Var of the specified query level. 
 * 
 * Returns -1 if no such Var is in the querytree, or if they all have 
 * unknown parse location.  (The former case is probably caller error, 
 * but we don't bother to distinguish it from the latter case.) 
 * 
 * Will recurse into sublinks.  Also, may be invoked directly on a Query. 
 * 
 * Note: it might seem appropriate to merge this functionality into 
 * contain_vars_of_level, but that would complicate that function's API. 
 * Currently, the only uses of this function are for error reporting, 
 * and so shaving cycles probably isn't very important. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN436"></a><span class='Declare_Function'>locate_var_of_level</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>levelsup</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN438"></a>    <a href="var.c.html#LN48"><span class='Ref_to_Typedef'>locate_var_of_level_context</span></a> <span class='Declare_Local'>context</span><span class='Delimiter'>; 
</span> 
    <a href="var.c.html#LN438"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="var.c.html#LN50"><span class='Ref_to_Member'>var_location</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* in case we find nothing */ 
</span>    <a href="var.c.html#LN438"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="var.c.html#LN51"><span class='Ref_to_Member'>sublevels_up</span></a> <span class='Operator'>= </span><a href="var.c.html#LN436"><span class='Ref_to_Parameter'>levelsup</span></a><span class='Delimiter'>; 
</span> 
    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../../include/nodes/nodeFuncs.h.html#LN67"><span class='Ref_to_Proto'>query_or_expression_tree_walker</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN436"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, 
</span>                                           <a href="var.c.html#LN74"><span class='Ref_to_Proto'>locate_var_of_level_walker</span></a><span class='Delimiter'>, 
</span>                                           <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="var.c.html#LN438"><span class='Ref_To_Local'>context</span></a><span class='Delimiter'>, 
</span>                                           <span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="var.c.html#LN438"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="var.c.html#LN50"><span class='Ref_to_Member'>var_location</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static bool 
</span><a name="LN452"></a><span class='Declare_Function'>locate_var_of_level_walker</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, 
</span><a name="LN453"></a>                           <a href="var.c.html#LN48"><span class='Ref_to_Typedef'>locate_var_of_level_context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="var.c.html#LN452"><span class='Ref_to_Parameter'>node</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN452"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN459"></a>        <a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>var</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="var.c.html#LN452"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="var.c.html#LN459"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN172"><span class='Ref_to_Member'>varlevelsup</span></a> <span class='Operator'>== </span><a href="var.c.html#LN453"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN51"><span class='Ref_to_Member'>sublevels_up</span></a> <span class='Operator'>&& 
</span>            <a href="var.c.html#LN459"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN177"><span class='Ref_to_Member'>location</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="var.c.html#LN453"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN50"><span class='Ref_to_Member'>var_location</span></a> <span class='Operator'>= </span><a href="var.c.html#LN459"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN177"><span class='Ref_to_Member'>location</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* abort tree traversal and return true */ 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN452"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1272"><span class='Ref_to_Struct'>CurrentOfExpr</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* since CurrentOfExpr doesn't carry location, nothing we can do */ 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Comment_Multi_Line'>/* No extra code needed for PlaceHolderVar; just look in contained expr */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN452"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Recurse into subselects */ 
</span><a name="LN478"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
        <a href="var.c.html#LN453"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN51"><span class='Ref_to_Member'>sublevels_up</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="var.c.html#LN478"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodeFuncs.h.html#LN57"><span class='Ref_to_Proto'>query_tree_walker</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="var.c.html#LN452"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, 
</span>                                   <a href="var.c.html#LN74"><span class='Ref_to_Proto'>locate_var_of_level_walker</span></a><span class='Delimiter'>, 
</span>                                   <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="var.c.html#LN453"><span class='Ref_to_Parameter'>context</span></a><span class='Delimiter'>, 
</span>                                   <span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="var.c.html#LN453"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN51"><span class='Ref_to_Member'>sublevels_up</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="var.c.html#LN478"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="../../../include/nodes/nodeFuncs.h.html#LN52"><span class='Ref_to_Proto'>expression_tree_walker</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN452"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, 
</span>                                  <a href="var.c.html#LN74"><span class='Ref_to_Proto'>locate_var_of_level_walker</span></a><span class='Delimiter'>, 
</span>                                  <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="var.c.html#LN453"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end locate_var_of_level_walker &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * pull_var_clause 
 *    Recursively pulls all Var nodes from an expression clause. 
 * 
 *    Aggrefs are handled according to these bits in 'flags': 
 *      PVC_INCLUDE_AGGREGATES      include Aggrefs in output list 
 *      PVC_RECURSE_AGGREGATES      recurse into Aggref arguments 
 *      neither flag                throw error if Aggref found 
 *    Vars within an Aggref's expression are included in the result only 
 *    when PVC_RECURSE_AGGREGATES is specified. 
 * 
 *    WindowFuncs are handled according to these bits in 'flags': 
 *      PVC_INCLUDE_WINDOWFUNCS     include WindowFuncs in output list 
 *      PVC_RECURSE_WINDOWFUNCS     recurse into WindowFunc arguments 
 *      neither flag                throw error if WindowFunc found 
 *    Vars within a WindowFunc's expression are included in the result only 
 *    when PVC_RECURSE_WINDOWFUNCS is specified. 
 * 
 *    PlaceHolderVars are handled according to these bits in 'flags': 
 *      PVC_INCLUDE_PLACEHOLDERS    include PlaceHolderVars in output list 
 *      PVC_RECURSE_PLACEHOLDERS    recurse into PlaceHolderVar arguments 
 *      neither flag                throw error if PlaceHolderVar found 
 *    Vars within a PHV's expression are included in the result only 
 *    when PVC_RECURSE_PLACEHOLDERS is specified. 
 * 
 *    GroupingFuncs are treated mostly like Aggrefs, and so do not need 
 *    their own flag bits. 
 * 
 *    CurrentOfExpr nodes are ignored in all cases. 
 * 
 *    Upper-level vars (with varlevelsup &GT; 0) should not be seen here, 
 *    likewise for upper-level Aggrefs and PlaceHolderVars. 
 * 
 *    Returns list of nodes found.  Note the nodes themselves are not 
 *    copied, only referenced. 
 * 
 * Does not examine subqueries, therefore must only be used after reduction 
 * of sublinks to subplans! 
 */ 
</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN534"></a><span class='Declare_Function'>pull_var_clause</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>flags</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN536"></a>    <a href="var.c.html#LN54"><span class='Ref_to_Typedef'>pull_var_clause_context</span></a> <span class='Declare_Local'>context</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Assert that caller has not specified inconsistent flags */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>((</span><a href="var.c.html#LN534"><span class='Ref_to_Parameter'>flags</span></a> <span class='Operator'>& </span><span class='Parentheses'>(</span><a href="../../../include/optimizer/var.h.html#LN19"><span class='Ref_to_Const'>PVC_INCLUDE_AGGREGATES</span></a> <span class='Operator'>| </span><a href="../../../include/optimizer/var.h.html#LN20"><span class='Ref_to_Const'>PVC_RECURSE_AGGREGATES</span></a><span class='Parentheses'>))</span> 
           <span class='Operator'>!= </span><span class='Parentheses'>(</span><a href="../../../include/optimizer/var.h.html#LN19"><span class='Ref_to_Const'>PVC_INCLUDE_AGGREGATES</span></a> <span class='Operator'>| </span><a href="../../../include/optimizer/var.h.html#LN20"><span class='Ref_to_Const'>PVC_RECURSE_AGGREGATES</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>((</span><a href="var.c.html#LN534"><span class='Ref_to_Parameter'>flags</span></a> <span class='Operator'>& </span><span class='Parentheses'>(</span><a href="../../../include/optimizer/var.h.html#LN21"><span class='Ref_to_Const'>PVC_INCLUDE_WINDOWFUNCS</span></a> <span class='Operator'>| </span><a href="../../../include/optimizer/var.h.html#LN22"><span class='Ref_to_Const'>PVC_RECURSE_WINDOWFUNCS</span></a><span class='Parentheses'>))</span> 
           <span class='Operator'>!= </span><span class='Parentheses'>(</span><a href="../../../include/optimizer/var.h.html#LN21"><span class='Ref_to_Const'>PVC_INCLUDE_WINDOWFUNCS</span></a> <span class='Operator'>| </span><a href="../../../include/optimizer/var.h.html#LN22"><span class='Ref_to_Const'>PVC_RECURSE_WINDOWFUNCS</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>((</span><a href="var.c.html#LN534"><span class='Ref_to_Parameter'>flags</span></a> <span class='Operator'>& </span><span class='Parentheses'>(</span><a href="../../../include/optimizer/var.h.html#LN23"><span class='Ref_to_Const'>PVC_INCLUDE_PLACEHOLDERS</span></a> <span class='Operator'>| </span><a href="../../../include/optimizer/var.h.html#LN25"><span class='Ref_to_Const'>PVC_RECURSE_PLACEHOLDERS</span></a><span class='Parentheses'>))</span> 
           <span class='Operator'>!= </span><span class='Parentheses'>(</span><a href="../../../include/optimizer/var.h.html#LN23"><span class='Ref_to_Const'>PVC_INCLUDE_PLACEHOLDERS</span></a> <span class='Operator'>| </span><a href="../../../include/optimizer/var.h.html#LN25"><span class='Ref_to_Const'>PVC_RECURSE_PLACEHOLDERS</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="var.c.html#LN536"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="var.c.html#LN56"><span class='Ref_to_Member'>varlist</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="var.c.html#LN536"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="var.c.html#LN57"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>= </span><a href="var.c.html#LN534"><span class='Ref_to_Parameter'>flags</span></a><span class='Delimiter'>; 
</span> 
    <a href="var.c.html#LN76"><span class='Ref_to_Proto'>pull_var_clause_walker</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN534"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="var.c.html#LN536"><span class='Ref_To_Local'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="var.c.html#LN536"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="var.c.html#LN56"><span class='Ref_to_Member'>varlist</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static bool 
</span><a name="LN554"></a><span class='Declare_Function'>pull_var_clause_walker</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><a href="var.c.html#LN54"><span class='Ref_to_Typedef'>pull_var_clause_context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="var.c.html#LN554"><span class='Ref_to_Parameter'>node</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN554"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(((</span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="var.c.html#LN554"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>varlevelsup <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"Upper-level Var found where not expected"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="var.c.html#LN554"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN56"><span class='Ref_to_Member'>varlist</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN554"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN56"><span class='Ref_to_Member'>varlist</span></a><span class='Delimiter'>, </span><a href="var.c.html#LN554"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN554"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN290"><span class='Ref_to_Struct'>Aggref</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(((</span><a href="../../../include/nodes/primnodes.h.html#LN290"><span class='Ref_to_Struct'>Aggref</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="var.c.html#LN554"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>agglevelsup <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"Upper-level Aggref found where not expected"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="var.c.html#LN554"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN57"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>& </span><a href="../../../include/optimizer/var.h.html#LN19"><span class='Ref_to_Const'>PVC_INCLUDE_AGGREGATES</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="var.c.html#LN554"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN56"><span class='Ref_to_Member'>varlist</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN554"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN56"><span class='Ref_to_Member'>varlist</span></a><span class='Delimiter'>, </span><a href="var.c.html#LN554"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* we do NOT descend into the contained expression */ 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="var.c.html#LN554"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN57"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>& </span><a href="../../../include/optimizer/var.h.html#LN20"><span class='Ref_to_Const'>PVC_RECURSE_AGGREGATES</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* fall through to recurse into the aggregate's arguments */ 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"Aggref found where not expected"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN554"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN337"><span class='Ref_to_Struct'>GroupingFunc</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(((</span><a href="../../../include/nodes/primnodes.h.html#LN337"><span class='Ref_to_Struct'>GroupingFunc</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="var.c.html#LN554"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>agglevelsup <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"Upper-level GROUPING found where not expected"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="var.c.html#LN554"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN57"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>& </span><a href="../../../include/optimizer/var.h.html#LN19"><span class='Ref_to_Const'>PVC_INCLUDE_AGGREGATES</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="var.c.html#LN554"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN56"><span class='Ref_to_Member'>varlist</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN554"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN56"><span class='Ref_to_Member'>varlist</span></a><span class='Delimiter'>, </span><a href="var.c.html#LN554"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* we do NOT descend into the contained expression */ 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="var.c.html#LN554"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN57"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>& </span><a href="../../../include/optimizer/var.h.html#LN20"><span class='Ref_to_Const'>PVC_RECURSE_AGGREGATES</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * We do NOT descend into the contained expression, even if the 
             * caller asked for it, because we never actually evaluate it - 
             * the result is driven entirely off the associated GROUP BY 
             * clause, so we never need to extract the actual Vars here. 
             */ 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"GROUPING found where not expected"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IsA(node,GroupingFunc... &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN554"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN351"><span class='Ref_to_Struct'>WindowFunc</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* WindowFuncs have no levelsup field to check ... */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="var.c.html#LN554"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN57"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>& </span><a href="../../../include/optimizer/var.h.html#LN21"><span class='Ref_to_Const'>PVC_INCLUDE_WINDOWFUNCS</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="var.c.html#LN554"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN56"><span class='Ref_to_Member'>varlist</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN554"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN56"><span class='Ref_to_Member'>varlist</span></a><span class='Delimiter'>, </span><a href="var.c.html#LN554"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* we do NOT descend into the contained expressions */ 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="var.c.html#LN554"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN57"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>& </span><a href="../../../include/optimizer/var.h.html#LN22"><span class='Ref_to_Const'>PVC_RECURSE_WINDOWFUNCS</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* fall through to recurse into the windowfunc's arguments */ 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"WindowFunc found where not expected"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN554"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN1846"><span class='Ref_to_Struct'>PlaceHolderVar</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(((</span><a href="../../../include/nodes/relation.h.html#LN1846"><span class='Ref_to_Struct'>PlaceHolderVar</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="var.c.html#LN554"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>phlevelsup <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"Upper-level PlaceHolderVar found where not expected"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="var.c.html#LN554"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN57"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>& </span><a href="../../../include/optimizer/var.h.html#LN23"><span class='Ref_to_Const'>PVC_INCLUDE_PLACEHOLDERS</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="var.c.html#LN554"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN56"><span class='Ref_to_Member'>varlist</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN554"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN56"><span class='Ref_to_Member'>varlist</span></a><span class='Delimiter'>, </span><a href="var.c.html#LN554"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* we do NOT descend into the contained expression */ 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="var.c.html#LN554"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN57"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>& </span><a href="../../../include/optimizer/var.h.html#LN25"><span class='Ref_to_Const'>PVC_RECURSE_PLACEHOLDERS</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* fall through to recurse into the placeholder's expression */ 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"PlaceHolderVar found where not expected"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="../../../include/nodes/nodeFuncs.h.html#LN52"><span class='Ref_to_Proto'>expression_tree_walker</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN554"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="var.c.html#LN76"><span class='Ref_to_Proto'>pull_var_clause_walker</span></a><span class='Delimiter'>, 
</span>                                  <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="var.c.html#LN554"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pull_var_clause_walker &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * flatten_join_alias_vars 
 *    Replace Vars that reference JOIN outputs with references to the original 
 *    relation variables instead.  This allows quals involving such vars to be 
 *    pushed down.  Whole-row Vars that reference JOIN relations are expanded 
 *    into RowExpr constructs that name the individual output Vars.  This 
 *    is necessary since we will not scan the JOIN as a base relation, which 
 *    is the only way that the executor can directly handle whole-row Vars. 
 * 
 * This also adjusts relid sets found in some expression node types to 
 * substitute the contained base rels for any join relid. 
 * 
 * If a JOIN contains sub-selects that have been flattened, its join alias 
 * entries might now be arbitrary expressions, not just Vars.  This affects 
 * this function in one important way: we might find ourselves inserting 
 * SubLink expressions into subqueries, and we must make sure that their 
 * Query.hasSubLinks fields get set to TRUE if so.  If there are any 
 * SubLinks in the join alias lists, the outer Query should already have 
 * hasSubLinks = TRUE, so this is only relevant to un-flattened subqueries. 
 * 
 * NOTE: this is used on not-yet-planned expressions.  We do not expect it 
 * to be applied directly to the whole Query, so if we see a Query to start 
 * with, we do want to increment sublevels_up (this occurs for LATERAL 
 * subqueries). 
 */ 
</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>* 
</span><a name="LN669"></a><span class='Declare_Function'>flatten_join_alias_vars</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN671"></a>    <a href="var.c.html#LN60"><span class='Ref_to_Typedef'>flatten_join_alias_vars_context</span></a> <span class='Declare_Local'>context</span><span class='Delimiter'>; 
</span> 
    <a href="var.c.html#LN671"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="var.c.html#LN62"><span class='Ref_to_Member'>root</span></a> <span class='Operator'>= </span><a href="var.c.html#LN669"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>; 
</span>    <a href="var.c.html#LN671"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="var.c.html#LN63"><span class='Ref_to_Member'>sublevels_up</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* flag whether join aliases could possibly contain SubLinks */ 
</span>    <a href="var.c.html#LN671"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="var.c.html#LN64"><span class='Ref_to_Member'>possible_sublink</span></a> <span class='Operator'>= </span><a href="var.c.html#LN669"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN125"><span class='Ref_to_Member'>hasSubLinks</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* if hasSubLinks is already true, no need to work hard */ 
</span>    <a href="var.c.html#LN671"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="var.c.html#LN65"><span class='Ref_to_Member'>inserted_sublink</span></a> <span class='Operator'>= </span><a href="var.c.html#LN669"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN125"><span class='Ref_to_Member'>hasSubLinks</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="var.c.html#LN78"><span class='Ref_to_Proto'>flatten_join_alias_vars_mutator</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN669"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="var.c.html#LN671"><span class='Ref_To_Local'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>* 
</span><a name="LN684"></a><span class='Declare_Function'>flatten_join_alias_vars_mutator</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, 
</span><a name="LN685"></a>                                <a href="var.c.html#LN60"><span class='Ref_to_Typedef'>flatten_join_alias_vars_context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="var.c.html#LN684"><span class='Ref_to_Parameter'>node</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN684"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN691"></a>        <a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>var</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="var.c.html#LN684"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span><a name="LN692"></a>        <a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rte</span><span class='Delimiter'>; 
</span><a name="LN693"></a>        <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>newvar</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* No change unless Var belongs to a JOIN of the target level */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="var.c.html#LN691"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN172"><span class='Ref_to_Member'>varlevelsup</span></a> <span class='Operator'>!= </span><a href="var.c.html#LN685"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN63"><span class='Ref_to_Member'>sublevels_up</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="var.c.html#LN684"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* no need to copy, really */ 
</span>        <a href="var.c.html#LN692"><span class='Ref_To_Local'>rte</span></a> <span class='Operator'>= </span><a href="../../../include/parser/parsetree.h.html#LN30"><span class='Ref_to_Macro'>rt_fetch</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN691"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN165"><span class='Ref_to_Member'>varno</span></a><span class='Delimiter'>, </span><a href="var.c.html#LN685"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN62"><span class='Ref_to_Member'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN134"><span class='Ref_to_Member'>rtable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="var.c.html#LN692"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN936"><span class='Ref_to_Member'>rtekind</span></a> <span class='Operator'>!= </span><a href="../../../include/nodes/parsenodes.h.html#LN924"><span class='Ref_to_EnumConst'>RTE_JOIN</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="var.c.html#LN684"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="var.c.html#LN691"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN167"><span class='Ref_to_Member'>varattno</span></a> <span class='Operator'>== </span><a href="../../../include/access/attnum.h.html#LN22"><span class='Ref_to_Const'>InvalidAttrNumber</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Must expand whole-row reference */ 
</span><a name="LN704"></a>            <a href="../../../include/nodes/primnodes.h.html#LN981"><span class='Ref_to_Struct'>RowExpr</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>rowexpr</span><span class='Delimiter'>; 
</span><a name="LN705"></a>            <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>fields</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN706"></a>            <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>colnames</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN707"></a>            <a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>attnum</span><span class='Delimiter'>; 
</span><a name="LN708"></a>            <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lv</span><span class='Delimiter'>; 
</span><a name="LN709"></a>            <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>ln</span><span class='Delimiter'>; 
</span> 
            <a href="var.c.html#LN707"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN692"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN975"><span class='Ref_to_Member'>joinaliasvars</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN692"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1023"><span class='Ref_to_Member'>eref</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN42"><span class='Ref_to_Member'>colnames</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../../../include/nodes/pg_list.h.html#LN179"><span class='Ref_to_Macro'>forboth</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN708"><span class='Ref_To_Local'>lv</span></a><span class='Delimiter'>, </span><a href="var.c.html#LN692"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN975"><span class='Ref_to_Member'>joinaliasvars</span></a><span class='Delimiter'>, </span><a href="var.c.html#LN709"><span class='Ref_To_Local'>ln</span></a><span class='Delimiter'>, </span><a href="var.c.html#LN692"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN1023"><span class='Ref_to_Member'>eref</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN42"><span class='Ref_to_Member'>colnames</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="var.c.html#LN693"><span class='Ref_To_Local'>newvar</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN708"><span class='Ref_To_Local'>lv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="var.c.html#LN707"><span class='Ref_To_Local'>attnum</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* Ignore dropped columns */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="var.c.html#LN693"><span class='Ref_To_Local'>newvar</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                <a href="var.c.html#LN693"><span class='Ref_To_Local'>newvar</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN693"><span class='Ref_To_Local'>newvar</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * If we are expanding an alias carried down from an upper 
                 * query, must adjust its varlevelsup fields. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="var.c.html#LN685"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN63"><span class='Ref_to_Member'>sublevels_up</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <a href="../../../include/rewrite/rewriteManip.h.html#LN44"><span class='Ref_to_Proto'>IncrementVarSublevelsUp</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN693"><span class='Ref_To_Local'>newvar</span></a><span class='Delimiter'>, </span><a href="var.c.html#LN685"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN63"><span class='Ref_to_Member'>sublevels_up</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* Preserve original Var's location, if possible */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN693"><span class='Ref_To_Local'>newvar</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a><span class='Parentheses'>))</span> 
                    <span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="var.c.html#LN693"><span class='Ref_To_Local'>newvar</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>location <span class='Operator'>= </span><a href="var.c.html#LN691"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN177"><span class='Ref_to_Member'>location</span></a><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* Recurse in case join input is itself a join */ 
</span>                <span class='Comment_Multi_Line'>/* (also takes care of setting inserted_sublink if needed) */ 
</span>                <a href="var.c.html#LN693"><span class='Ref_To_Local'>newvar</span></a> <span class='Operator'>= </span><a href="var.c.html#LN78"><span class='Ref_to_Proto'>flatten_join_alias_vars_mutator</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN693"><span class='Ref_To_Local'>newvar</span></a><span class='Delimiter'>, </span><a href="var.c.html#LN685"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="var.c.html#LN705"><span class='Ref_To_Local'>fields</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN705"><span class='Ref_To_Local'>fields</span></a><span class='Delimiter'>, </span><a href="var.c.html#LN693"><span class='Ref_To_Local'>newvar</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* We need the names of non-dropped columns, too */ 
</span>                <a href="var.c.html#LN706"><span class='Ref_To_Local'>colnames</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN706"><span class='Ref_To_Local'>colnames</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN709"><span class='Ref_To_Local'>ln</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="var.c.html#LN704"><span class='Ref_To_Local'>rowexpr</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN981"><span class='Ref_to_Struct'>RowExpr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="var.c.html#LN704"><span class='Ref_To_Local'>rowexpr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN984"><span class='Ref_to_Member'>args</span></a> <span class='Operator'>= </span><a href="var.c.html#LN705"><span class='Ref_To_Local'>fields</span></a><span class='Delimiter'>; 
</span>            <a href="var.c.html#LN704"><span class='Ref_To_Local'>rowexpr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN985"><span class='Ref_to_Member'>row_typeid</span></a> <span class='Operator'>= </span><a href="var.c.html#LN691"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN169"><span class='Ref_to_Member'>vartype</span></a><span class='Delimiter'>; 
</span>            <a href="var.c.html#LN704"><span class='Ref_To_Local'>rowexpr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN996"><span class='Ref_to_Member'>row_format</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/primnodes.h.html#LN438"><span class='Ref_to_EnumConst'>COERCE_IMPLICIT_CAST</span></a><span class='Delimiter'>; 
</span>            <a href="var.c.html#LN704"><span class='Ref_To_Local'>rowexpr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN997"><span class='Ref_to_Member'>colnames</span></a> <span class='Operator'>= </span><a href="var.c.html#LN706"><span class='Ref_To_Local'>colnames</span></a><span class='Delimiter'>; 
</span>            <a href="var.c.html#LN704"><span class='Ref_To_Local'>rowexpr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN998"><span class='Ref_to_Member'>location</span></a> <span class='Operator'>= </span><a href="var.c.html#LN691"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN177"><span class='Ref_to_Member'>location</span></a><span class='Delimiter'>; 
</span> 
            <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="var.c.html#LN704"><span class='Ref_To_Local'>rowexpr</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if var-&GT;varattno==Invali... &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* Expand join alias reference */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="var.c.html#LN691"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN167"><span class='Ref_to_Member'>varattno</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="var.c.html#LN693"><span class='Ref_To_Local'>newvar</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN223"><span class='Ref_to_Proto'>list_nth</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN692"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN975"><span class='Ref_to_Member'>joinaliasvars</span></a><span class='Delimiter'>, </span><a href="var.c.html#LN691"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN167"><span class='Ref_to_Member'>varattno</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="var.c.html#LN693"><span class='Ref_To_Local'>newvar</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="var.c.html#LN693"><span class='Ref_To_Local'>newvar</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN693"><span class='Ref_To_Local'>newvar</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If we are expanding an alias carried down from an upper query, must 
         * adjust its varlevelsup fields. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="var.c.html#LN685"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN63"><span class='Ref_to_Member'>sublevels_up</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="../../../include/rewrite/rewriteManip.h.html#LN44"><span class='Ref_to_Proto'>IncrementVarSublevelsUp</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN693"><span class='Ref_To_Local'>newvar</span></a><span class='Delimiter'>, </span><a href="var.c.html#LN685"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN63"><span class='Ref_to_Member'>sublevels_up</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Preserve original Var's location, if possible */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN693"><span class='Ref_To_Local'>newvar</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a><span class='Parentheses'>))</span> 
            <span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="var.c.html#LN693"><span class='Ref_To_Local'>newvar</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>location <span class='Operator'>= </span><a href="var.c.html#LN691"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN177"><span class='Ref_to_Member'>location</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Recurse in case join input is itself a join */ 
</span>        <a href="var.c.html#LN693"><span class='Ref_To_Local'>newvar</span></a> <span class='Operator'>= </span><a href="var.c.html#LN78"><span class='Ref_to_Proto'>flatten_join_alias_vars_mutator</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN693"><span class='Ref_To_Local'>newvar</span></a><span class='Delimiter'>, </span><a href="var.c.html#LN685"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Detect if we are adding a sublink to query */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="var.c.html#LN685"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN64"><span class='Ref_to_Member'>possible_sublink</span></a> <span class='Operator'>&& !</span><a href="var.c.html#LN685"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN65"><span class='Ref_to_Member'>inserted_sublink</span></a><span class='Parentheses'>) 
</span>            <a href="var.c.html#LN685"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN65"><span class='Ref_to_Member'>inserted_sublink</span></a> <span class='Operator'>= </span><a href="../../../include/rewrite/rewriteManip.h.html#LN61"><span class='Ref_to_Proto'>checkExprHasSubLink</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN693"><span class='Ref_To_Local'>newvar</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>return</span> <a href="var.c.html#LN693"><span class='Ref_To_Local'>newvar</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IsA(node,Var) &raquo; </span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN684"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN1846"><span class='Ref_to_Struct'>PlaceHolderVar</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Copy the PlaceHolderVar node with correct mutation of subnodes */ 
</span><a name="LN777"></a>        <a href="../../../include/nodes/relation.h.html#LN1846"><span class='Ref_to_Struct'>PlaceHolderVar</span></a> <span class='Operator'>*</span><span class='Declare_Local'>phv</span><span class='Delimiter'>; 
</span> 
        <a href="var.c.html#LN777"><span class='Ref_To_Local'>phv</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1846"><span class='Ref_to_Struct'>PlaceHolderVar</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/nodeFuncs.h.html#LN54"><span class='Ref_to_Proto'>expression_tree_mutator</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN684"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, 
</span>                                             <a href="var.c.html#LN78"><span class='Ref_to_Proto'>flatten_join_alias_vars_mutator</span></a><span class='Delimiter'>, 
</span>                                                         <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="var.c.html#LN685"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* now fix PlaceHolderVar's relid sets */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="var.c.html#LN777"><span class='Ref_To_Local'>phv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1852"><span class='Ref_to_Member'>phlevelsup</span></a> <span class='Operator'>== </span><a href="var.c.html#LN685"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN63"><span class='Ref_to_Member'>sublevels_up</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="var.c.html#LN777"><span class='Ref_To_Local'>phv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1850"><span class='Ref_to_Member'>phrels</span></a> <span class='Operator'>= </span><a href="var.c.html#LN80"><span class='Ref_to_Proto'>alias_relid_set</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN685"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN62"><span class='Ref_to_Member'>root</span></a><span class='Delimiter'>, 
</span>                                          <a href="var.c.html#LN777"><span class='Ref_To_Local'>phv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1850"><span class='Ref_to_Member'>phrels</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="var.c.html#LN777"><span class='Ref_To_Local'>phv</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN684"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Recurse into RTE subquery or not-yet-planned sublink subquery */ 
</span><a name="LN794"></a>        <a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>newnode</span><span class='Delimiter'>; 
</span><a name="LN795"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>save_inserted_sublink</span><span class='Delimiter'>; 
</span> 
        <a href="var.c.html#LN685"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN63"><span class='Ref_to_Member'>sublevels_up</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="var.c.html#LN795"><span class='Ref_To_Local'>save_inserted_sublink</span></a> <span class='Operator'>= </span><a href="var.c.html#LN685"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN65"><span class='Ref_to_Member'>inserted_sublink</span></a><span class='Delimiter'>; 
</span>        <a href="var.c.html#LN685"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN65"><span class='Ref_to_Member'>inserted_sublink</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="var.c.html#LN684"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>hasSubLinks<span class='Delimiter'>; 
</span>        <a href="var.c.html#LN794"><span class='Ref_To_Local'>newnode</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodeFuncs.h.html#LN59"><span class='Ref_to_Proto'>query_tree_mutator</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="var.c.html#LN684"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, 
</span>                                     <a href="var.c.html#LN78"><span class='Ref_to_Proto'>flatten_join_alias_vars_mutator</span></a><span class='Delimiter'>, 
</span>                                     <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="var.c.html#LN685"><span class='Ref_to_Parameter'>context</span></a><span class='Delimiter'>, 
</span>                                     <a href="../../../include/nodes/nodeFuncs.h.html#LN22"><span class='Ref_to_Const'>QTW_IGNORE_JOINALIASES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="var.c.html#LN794"><span class='Ref_To_Local'>newnode</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN125"><span class='Ref_to_Member'>hasSubLinks</span></a> <span class='Operator'>|= </span><a href="var.c.html#LN685"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN65"><span class='Ref_to_Member'>inserted_sublink</span></a><span class='Delimiter'>; 
</span>        <a href="var.c.html#LN685"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN65"><span class='Ref_to_Member'>inserted_sublink</span></a> <span class='Operator'>= </span><a href="var.c.html#LN795"><span class='Ref_To_Local'>save_inserted_sublink</span></a><span class='Delimiter'>; 
</span>        <a href="var.c.html#LN685"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="var.c.html#LN63"><span class='Ref_to_Member'>sublevels_up</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="var.c.html#LN794"><span class='Ref_To_Local'>newnode</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Comment_Multi_Line'>/* Already-planned tree not supported */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN684"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN678"><span class='Ref_to_Struct'>SubPlan</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Shouldn't need to handle these planner auxiliary nodes here */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN684"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN1913"><span class='Ref_to_Struct'>SpecialJoinInfo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN684"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN2057"><span class='Ref_to_Struct'>PlaceHolderInfo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN684"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN2074"><span class='Ref_to_Struct'>MinMaxAggInfo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../../include/nodes/nodeFuncs.h.html#LN54"><span class='Ref_to_Proto'>expression_tree_mutator</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN684"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="var.c.html#LN78"><span class='Ref_to_Proto'>flatten_join_alias_vars_mutator</span></a><span class='Delimiter'>, 
</span>                                   <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="var.c.html#LN685"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end flatten_join_alias_vars_mutator &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * alias_relid_set: in a set of RT indexes, replace joins by their 
 * underlying base relids 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> 
<a name="LN825"></a><span class='Declare_Function'>alias_relid_set</span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a> <span class='Declare_Parameter'>relids</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN827"></a>    <a href="../../../include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a>      <span class='Declare_Local'>result</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN828"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>rtindex</span><span class='Delimiter'>; 
</span> 
    <a href="var.c.html#LN828"><span class='Ref_To_Local'>rtindex</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="var.c.html#LN828"><span class='Ref_To_Local'>rtindex</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN98"><span class='Ref_to_Proto'>bms_next_member</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN825"><span class='Ref_to_Parameter'>relids</span></a><span class='Delimiter'>, </span><a href="var.c.html#LN828"><span class='Ref_To_Local'>rtindex</span></a><span class='Parentheses'>))</span> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN833"></a>        <a href="../../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rte</span> <span class='Operator'>= </span><a href="../../../include/parser/parsetree.h.html#LN30"><span class='Ref_to_Macro'>rt_fetch</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN828"><span class='Ref_To_Local'>rtindex</span></a><span class='Delimiter'>, </span><a href="var.c.html#LN825"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN134"><span class='Ref_to_Member'>rtable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="var.c.html#LN833"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN936"><span class='Ref_to_Member'>rtekind</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/parsenodes.h.html#LN924"><span class='Ref_to_EnumConst'>RTE_JOIN</span></a><span class='Parentheses'>) 
</span>            <a href="var.c.html#LN827"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN94"><span class='Ref_to_Proto'>bms_join</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN827"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="../../../include/optimizer/prep.h.html#LN29"><span class='Ref_to_Proto'>get_relids_for_join</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN825"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="var.c.html#LN828"><span class='Ref_To_Local'>rtindex</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="var.c.html#LN827"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN89"><span class='Ref_to_Proto'>bms_add_member</span></a><span class='Parentheses'>(</span><a href="var.c.html#LN827"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="var.c.html#LN828"><span class='Ref_To_Local'>rtindex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="var.c.html#LN827"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
} 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>