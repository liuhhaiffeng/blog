<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\parser\parse_cte.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\parser\parse_cte.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:44 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * parse_cte.c 
 *    handle CTEs (common table expressions) in parser 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/parser/parse_cte.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_collation.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"nodes/nodeFuncs.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/analyze.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parse_cte.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
 
 
<span class='Comment_Multi_Line'>/* Enumeration of contexts in which a self-reference is disallowed */ 
</span><span class='Control'>typedef</span> <span class='Control'>enum</span> 
<span class='Delimiter'>{ 
</span><a name="LN28"></a>    <span class='Declare_Enum_Const'>RECURSION_OK</span><span class='Delimiter'>, 
</span><a name="LN29"></a>    <span class='Declare_Enum_Const'>RECURSION_NONRECURSIVETERM</span><span class='Delimiter'>, </span><span class='Comment_Single_Line'>/* inside the left-hand term */ 
</span><a name="LN30"></a>    <span class='Declare_Enum_Const'>RECURSION_SUBLINK</span><span class='Delimiter'>,</span>          <span class='Comment_Single_Line'>/* inside a sublink */ 
</span><a name="LN31"></a>    <span class='Declare_Enum_Const'>RECURSION_OUTERJOIN</span><span class='Delimiter'>,</span>        <span class='Comment_Single_Line'>/* inside nullable side of an outer join */ 
</span><a name="LN32"></a>    <span class='Declare_Enum_Const'>RECURSION_INTERSECT</span><span class='Delimiter'>,</span>        <span class='Comment_Single_Line'>/* underneath INTERSECT (ALL) */ 
</span><a name="LN33"></a>    <span class='Declare_Enum_Const'>RECURSION_EXCEPT</span>            <span class='Comment_Single_Line'>/* underneath EXCEPT (ALL) */ 
</span><a name="LN34"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>RecursionContext</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* Associated error messages --- each must have one %s for CTE name */ 
</span><a name="LN37"></a><span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Keyword'>const </span><span class='Declare_Var'>recursion_errormsgs</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* RECURSION_OK */ 
</span>    <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* RECURSION_NONRECURSIVETERM */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"recursive reference to query \"%s\" must not appear within its non-recursive term"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* RECURSION_SUBLINK */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"recursive reference to query \"%s\" must not appear within a subquery"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* RECURSION_OUTERJOIN */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"recursive reference to query \"%s\" must not appear within an outer join"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* RECURSION_INTERSECT */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"recursive reference to query \"%s\" must not appear within INTERSECT"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* RECURSION_EXCEPT */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"recursive reference to query \"%s\" must not appear within EXCEPT"</span><span class='Parentheses'>) 
</span><span class='Delimiter'>}; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * For WITH RECURSIVE, we have to find an ordering of the clause members 
 * with no forward references, and determine which members are recursive 
 * (i.e., self-referential).  It is convenient to do this with an array 
 * of CteItems instead of a list of CommonTableExprs. 
 */ 
</span><a name="LN58"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>CteItem</span> 
<span class='Delimiter'>{ 
</span><a name="LN60"></a>    <a href="../../include/nodes/parsenodes.h.html#LN1339"><span class='Ref_to_Struct'>CommonTableExpr</span></a> <span class='Operator'>*</span><span class='Declare_Member'>cte</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* One CTE to examine */ 
</span><a name="LN61"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>id</span><span class='Delimiter'>;</span>             <span class='Comment_Single_Line'>/* Its ID number for dependencies */ 
</span><a name="LN62"></a>    <a href="../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a>  <span class='Operator'>*</span><span class='Declare_Member'>depends_on</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* CTEs depended on (not including self) */ 
</span><a name="LN63"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>CteItem</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* CteState is what we need to pass around in the tree walkers */ 
</span><a name="LN66"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>CteState</span> 
<span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* global state: */ 
</span><a name="LN69"></a>    <a href="../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Member'>pstate</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* global parse state */ 
</span><a name="LN70"></a>    <a href="parse_cte.c.html#LN58"><span class='Ref_to_Struct'>CteItem</span></a>    <span class='Operator'>*</span><span class='Declare_Member'>items</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* array of CTEs and extra data */ 
</span><a name="LN71"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>numitems</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* number of CTEs */ 
</span>    <span class='Comment_Multi_Line'>/* working state during a tree walk: */ 
</span><a name="LN73"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>curitem</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* index of item currently being examined */ 
</span><a name="LN74"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>innerwiths</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* list of lists of CommonTableExpr */ 
</span>    <span class='Comment_Multi_Line'>/* working state for checkWellFormedRecursion walk only: */ 
</span><a name="LN76"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>selfrefcount</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* number of self-references detected */ 
</span><a name="LN77"></a>    <a href="parse_cte.c.html#LN26"><span class='Ref_to_Typedef'>RecursionContext</span></a> <span class='Declare_Member'>context</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* context to allow or disallow self-ref */ 
</span><a name="LN78"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>CteState</span><span class='Delimiter'>; 
</span> 
 
<a name="LN81"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>analyzeCTE</span><span class='Parentheses'>(</span><a href="../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1339"><span class='Ref_to_Struct'>CommonTableExpr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cte</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* Dependency processing functions */ 
</span><a name="LN84"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>makeDependencyGraph</span><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN66"><span class='Ref_to_Struct'>CteState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cstate</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN85"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>makeDependencyGraphWalker</span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN66"><span class='Ref_to_Struct'>CteState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cstate</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN86"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>TopologicalSort</span><span class='Parentheses'>(</span><a href="../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN58"><span class='Ref_to_Struct'>CteItem</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>items</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>numitems</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* Recursion validity checker functions */ 
</span><a name="LN89"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>checkWellFormedRecursion</span><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN66"><span class='Ref_to_Struct'>CteState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cstate</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN90"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>checkWellFormedRecursionWalker</span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN66"><span class='Ref_to_Struct'>CteState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cstate</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN91"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>checkWellFormedSelectStmt</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1478"><span class='Ref_to_Struct'>SelectStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN66"><span class='Ref_to_Struct'>CteState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cstate</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * transformWithClause - 
 *    Transform the list of WITH clause "common table expressions" into 
 *    Query nodes. 
 * 
 * The result is the list of transformed CTEs to be put into the output 
 * Query.  (This is in fact the same as the ending value of p_ctenamespace, 
 * but it seems cleaner to not expose that in the function's API.) 
 */ 
</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN104"></a><span class='Declare_Function'>transformWithClause</span><span class='Parentheses'>(</span><a href="../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1294"><span class='Ref_to_Struct'>WithClause</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>withClause</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN106"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Only one WITH clause per query level */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN104"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/parser/parse_node.h.html#LN175"><span class='Ref_to_Member'>p_ctenamespace</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN104"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/parser/parse_node.h.html#LN176"><span class='Ref_to_Member'>p_future_ctes</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * For either type of WITH, there must not be duplicate CTE names in the 
     * list.  Check this right away so we needn't worry later. 
     * 
     * Also, tentatively mark each CTE as non-recursive, and initialize its 
     * reference count to zero, and set pstate-&GT;p_hasModifyingCTE if needed. 
     */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN106"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN104"><span class='Ref_to_Parameter'>withClause</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1297"><span class='Ref_to_Member'>ctes</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN121"></a>        <a href="../../include/nodes/parsenodes.h.html#LN1339"><span class='Ref_to_Struct'>CommonTableExpr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cte</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1339"><span class='Ref_to_Struct'>CommonTableExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN106"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN122"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>rest</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/nodes/pg_list.h.html#LN168"><span class='Ref_to_Macro'>for_each_cell</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN122"><span class='Ref_To_Local'>rest</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN106"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN126"></a>            <a href="../../include/nodes/parsenodes.h.html#LN1339"><span class='Ref_to_Struct'>CommonTableExpr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cte2</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1339"><span class='Ref_to_Struct'>CommonTableExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN122"><span class='Ref_To_Local'>rest</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="parse_cte.c.html#LN121"><span class='Ref_To_Local'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1342"><span class='Ref_to_Member'>ctename</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN126"><span class='Ref_To_Local'>cte2</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1342"><span class='Ref_to_Member'>ctename</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DUPLICATE_ALIAS<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"WITH query name \"%s\" specified more than once"</span><span class='Delimiter'>, 
</span>                           <a href="parse_cte.c.html#LN126"><span class='Ref_To_Local'>cte2</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1342"><span class='Ref_to_Member'>ctename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN104"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN126"><span class='Ref_To_Local'>cte2</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1346"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="parse_cte.c.html#LN121"><span class='Ref_To_Local'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1348"><span class='Ref_to_Member'>cterecursive</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="parse_cte.c.html#LN121"><span class='Ref_To_Local'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1349"><span class='Ref_to_Member'>cterefcount</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN121"><span class='Ref_To_Local'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1345"><span class='Ref_to_Member'>ctequery</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1478"><span class='Ref_to_Struct'>SelectStmt</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* must be a data-modifying statement */ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN121"><span class='Ref_To_Local'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1345"><span class='Ref_to_Member'>ctequery</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1416"><span class='Ref_to_Struct'>InsertStmt</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>                   <a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN121"><span class='Ref_To_Local'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1345"><span class='Ref_to_Member'>ctequery</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1446"><span class='Ref_to_Struct'>UpdateStmt</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>                   <a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN121"><span class='Ref_To_Local'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1345"><span class='Ref_to_Member'>ctequery</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1432"><span class='Ref_to_Struct'>DeleteStmt</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <a href="parse_cte.c.html#LN104"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/parser/parse_node.h.html#LN199"><span class='Ref_to_Member'>p_hasModifyingCTE</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_cte.c.html#LN104"><span class='Ref_to_Parameter'>withClause</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1298"><span class='Ref_to_Member'>recursive</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * For WITH RECURSIVE, we rearrange the list elements if needed to 
         * eliminate forward references.  First, build a work array and set up 
         * the data structure needed by the tree walkers. 
         */ 
</span><a name="LN157"></a>        <a href="parse_cte.c.html#LN66"><span class='Ref_to_Struct'>CteState</span></a>    <span class='Declare_Local'>cstate</span><span class='Delimiter'>; 
</span><a name="LN158"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <a href="parse_cte.c.html#LN157"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>.</span><a href="parse_cte.c.html#LN69"><span class='Ref_to_Member'>pstate</span></a> <span class='Operator'>= </span><a href="parse_cte.c.html#LN104"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>; 
</span>        <a href="parse_cte.c.html#LN157"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>.</span><a href="parse_cte.c.html#LN71"><span class='Ref_to_Member'>numitems</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN104"><span class='Ref_to_Parameter'>withClause</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1297"><span class='Ref_to_Member'>ctes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="parse_cte.c.html#LN157"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>.</span><a href="parse_cte.c.html#LN70"><span class='Ref_to_Member'>items</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN58"><span class='Ref_to_Struct'>CteItem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN157"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>.</span><a href="parse_cte.c.html#LN71"><span class='Ref_to_Member'>numitems</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN58"><span class='Ref_to_Struct'>CteItem</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="parse_cte.c.html#LN158"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN106"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN104"><span class='Ref_to_Parameter'>withClause</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1297"><span class='Ref_to_Member'>ctes</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="parse_cte.c.html#LN157"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>.</span><a href="parse_cte.c.html#LN70"><span class='Ref_to_Member'>items</span></a><span class='Delimiter'>[</span><a href="parse_cte.c.html#LN158"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="parse_cte.c.html#LN60"><span class='Ref_to_Member'>cte</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1339"><span class='Ref_to_Struct'>CommonTableExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN106"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="parse_cte.c.html#LN157"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>.</span><a href="parse_cte.c.html#LN70"><span class='Ref_to_Member'>items</span></a><span class='Delimiter'>[</span><a href="parse_cte.c.html#LN158"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="parse_cte.c.html#LN61"><span class='Ref_to_Member'>id</span></a> <span class='Operator'>= </span><a href="parse_cte.c.html#LN158"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>            <a href="parse_cte.c.html#LN158"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Find all the dependencies and sort the CteItems into a safe 
         * processing order.  Also, mark CTEs that contain self-references. 
         */ 
</span>        <a href="parse_cte.c.html#LN84"><span class='Ref_to_Proto'>makeDependencyGraph</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="parse_cte.c.html#LN157"><span class='Ref_To_Local'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Check that recursive queries are well-formed. 
         */ 
</span>        <a href="parse_cte.c.html#LN89"><span class='Ref_to_Proto'>checkWellFormedRecursion</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="parse_cte.c.html#LN157"><span class='Ref_To_Local'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Set up the ctenamespace for parse analysis.  Per spec, all the WITH 
         * items are visible to all others, so stuff them all in before parse 
         * analysis.  We build the list in safe processing order so that the 
         * planner can process the queries in sequence. 
         */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="parse_cte.c.html#LN158"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="parse_cte.c.html#LN158"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="parse_cte.c.html#LN157"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>.</span><a href="parse_cte.c.html#LN71"><span class='Ref_to_Member'>numitems</span></a><span class='Delimiter'>; </span><a href="parse_cte.c.html#LN158"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN190"></a>            <a href="../../include/nodes/parsenodes.h.html#LN1339"><span class='Ref_to_Struct'>CommonTableExpr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cte</span> <span class='Operator'>= </span><a href="parse_cte.c.html#LN157"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>.</span><a href="parse_cte.c.html#LN70"><span class='Ref_to_Member'>items</span></a><span class='Delimiter'>[</span><a href="parse_cte.c.html#LN158"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="parse_cte.c.html#LN60"><span class='Ref_to_Member'>cte</span></a><span class='Delimiter'>; 
</span> 
            <a href="parse_cte.c.html#LN104"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/parser/parse_node.h.html#LN175"><span class='Ref_to_Member'>p_ctenamespace</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN104"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/parser/parse_node.h.html#LN175"><span class='Ref_to_Member'>p_ctenamespace</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN190"><span class='Ref_To_Local'>cte</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Do parse analysis in the order determined by the topological sort. 
         */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="parse_cte.c.html#LN158"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="parse_cte.c.html#LN158"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="parse_cte.c.html#LN157"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>.</span><a href="parse_cte.c.html#LN71"><span class='Ref_to_Member'>numitems</span></a><span class='Delimiter'>; </span><a href="parse_cte.c.html#LN158"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN200"></a>            <a href="../../include/nodes/parsenodes.h.html#LN1339"><span class='Ref_to_Struct'>CommonTableExpr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cte</span> <span class='Operator'>= </span><a href="parse_cte.c.html#LN157"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>.</span><a href="parse_cte.c.html#LN70"><span class='Ref_to_Member'>items</span></a><span class='Delimiter'>[</span><a href="parse_cte.c.html#LN158"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="parse_cte.c.html#LN60"><span class='Ref_to_Member'>cte</span></a><span class='Delimiter'>; 
</span> 
            <a href="parse_cte.c.html#LN81"><span class='Ref_to_Proto'>analyzeCTE</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN104"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN200"><span class='Ref_To_Local'>cte</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if withClause-&GT;recursive &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * For non-recursive WITH, just analyze each CTE in sequence and then 
         * add it to the ctenamespace.  This corresponds to the spec's 
         * definition of the scope of each WITH name.  However, to allow error 
         * reports to be aware of the possibility of an erroneous reference, 
         * we maintain a list in p_future_ctes of the not-yet-visible CTEs. 
         */ 
</span>        <a href="parse_cte.c.html#LN104"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/parser/parse_node.h.html#LN176"><span class='Ref_to_Member'>p_future_ctes</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN268"><span class='Ref_to_Proto'>list_copy</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN104"><span class='Ref_to_Parameter'>withClause</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1297"><span class='Ref_to_Member'>ctes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN106"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN104"><span class='Ref_to_Parameter'>withClause</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1297"><span class='Ref_to_Member'>ctes</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN218"></a>            <a href="../../include/nodes/parsenodes.h.html#LN1339"><span class='Ref_to_Struct'>CommonTableExpr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cte</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1339"><span class='Ref_to_Struct'>CommonTableExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN106"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="parse_cte.c.html#LN81"><span class='Ref_to_Proto'>analyzeCTE</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN104"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN218"><span class='Ref_To_Local'>cte</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="parse_cte.c.html#LN104"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/parser/parse_node.h.html#LN175"><span class='Ref_to_Member'>p_ctenamespace</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN104"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/parser/parse_node.h.html#LN175"><span class='Ref_to_Member'>p_ctenamespace</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN218"><span class='Ref_To_Local'>cte</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="parse_cte.c.html#LN104"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/parser/parse_node.h.html#LN176"><span class='Ref_to_Member'>p_future_ctes</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN237"><span class='Ref_to_Proto'>list_delete_first</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN104"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/parser/parse_node.h.html#LN176"><span class='Ref_to_Member'>p_future_ctes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Control'>return</span> <a href="parse_cte.c.html#LN104"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/parser/parse_node.h.html#LN175"><span class='Ref_to_Member'>p_ctenamespace</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end transformWithClause &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Perform the actual parse analysis transformation of one CTE.  All 
 * CTEs it depends on have already been loaded into pstate-&GT;p_ctenamespace, 
 * and have been marked with the correct output column names/types. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN236"></a><span class='Declare_Function'>analyzeCTE</span><span class='Parentheses'>(</span><a href="../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1339"><span class='Ref_to_Struct'>CommonTableExpr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cte</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN238"></a>    <a href="../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>query</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Analysis not done already */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN236"><span class='Ref_to_Parameter'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1345"><span class='Ref_to_Member'>ctequery</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="parse_cte.c.html#LN238"><span class='Ref_To_Local'>query</span></a> <span class='Operator'>= </span><a href="../../include/parser/analyze.h.html#LN29"><span class='Ref_to_Proto'>parse_sub_analyze</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN236"><span class='Ref_to_Parameter'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1345"><span class='Ref_to_Member'>ctequery</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN236"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN236"><span class='Ref_to_Parameter'>cte</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="parse_cte.c.html#LN236"><span class='Ref_to_Parameter'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1345"><span class='Ref_to_Member'>ctequery</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="parse_cte.c.html#LN238"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check that we got something reasonable.  These first two cases should 
     * be prevented by the grammar. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN238"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected non-Query statement in WITH"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_cte.c.html#LN238"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN117"><span class='Ref_to_Member'>utilityStmt</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected utility statement in WITH"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We disallow data-modifying WITH except at the top level of a query, 
     * because it's not clear when such a modification should be executed. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_cte.c.html#LN238"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN109"><span class='Ref_to_Member'>commandType</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/nodes.h.html#LN650"><span class='Ref_to_EnumConst'>CMD_SELECT</span></a> <span class='Operator'>&& 
</span>        <a href="parse_cte.c.html#LN236"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/parser/parse_node.h.html#LN166"><span class='Ref_to_Member'>parentParseState</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"WITH clause containing a data-modifying statement must be at the top level"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN236"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN236"><span class='Ref_to_Parameter'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1346"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * CTE queries are always marked not canSetTag.  (Currently this only 
     * matters for data-modifying statements, for which the flag will be 
     * propagated to the ModifyTable plan node.) 
     */ 
</span>    <a href="parse_cte.c.html#LN238"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN115"><span class='Ref_to_Member'>canSetTag</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="parse_cte.c.html#LN236"><span class='Ref_to_Parameter'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1348"><span class='Ref_to_Member'>cterecursive</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Compute the output column names/types if not done yet */ 
</span>        <a href="../../include/parser/parse_cte.h.html#LN20"><span class='Ref_to_Proto'>analyzeCTETargetList</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN236"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN236"><span class='Ref_to_Parameter'>cte</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1358"><span class='Ref_to_Macro'>GetCTETargetList</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN236"><span class='Ref_to_Parameter'>cte</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Verify that the previously determined output column types and 
         * collations match what the query really produced.  We have to check 
         * this because the recursive term could have overridden the 
         * non-recursive term, and we don't have any easy way to fix that. 
         */ 
</span><a name="LN286"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lctlist</span><span class='Delimiter'>, 
</span><a name="LN287"></a>                   <span class='Operator'>*</span><span class='Declare_Local'>lctyp</span><span class='Delimiter'>, 
</span><a name="LN288"></a>                   <span class='Operator'>*</span><span class='Declare_Local'>lctypmod</span><span class='Delimiter'>, 
</span><a name="LN289"></a>                   <span class='Operator'>*</span><span class='Declare_Local'>lccoll</span><span class='Delimiter'>; 
</span><a name="LN290"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>varattno</span><span class='Delimiter'>; 
</span> 
        <a href="parse_cte.c.html#LN287"><span class='Ref_To_Local'>lctyp</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN75"><span class='Ref_to_Func'>list_head</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN236"><span class='Ref_to_Parameter'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1352"><span class='Ref_to_Member'>ctecoltypes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="parse_cte.c.html#LN288"><span class='Ref_To_Local'>lctypmod</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN75"><span class='Ref_to_Func'>list_head</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN236"><span class='Ref_to_Parameter'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1353"><span class='Ref_to_Member'>ctecoltypmods</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="parse_cte.c.html#LN289"><span class='Ref_To_Local'>lccoll</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN75"><span class='Ref_to_Func'>list_head</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN236"><span class='Ref_to_Parameter'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1354"><span class='Ref_to_Member'>ctecolcollations</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="parse_cte.c.html#LN290"><span class='Ref_To_Local'>varattno</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN286"><span class='Ref_To_Local'>lctlist</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1358"><span class='Ref_to_Macro'>GetCTETargetList</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN236"><span class='Ref_to_Parameter'>cte</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN298"></a>            <a href="../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>te</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN286"><span class='Ref_To_Local'>lctlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN299"></a>            <a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>texpr</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_cte.c.html#LN298"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1373"><span class='Ref_to_Member'>resjunk</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <a href="parse_cte.c.html#LN290"><span class='Ref_To_Local'>varattno</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN290"><span class='Ref_To_Local'>varattno</span></a> <span class='Operator'>== </span><a href="parse_cte.c.html#LN298"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1367"><span class='Ref_to_Member'>resno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_cte.c.html#LN287"><span class='Ref_To_Local'>lctyp</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="parse_cte.c.html#LN288"><span class='Ref_To_Local'>lctypmod</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="parse_cte.c.html#LN289"><span class='Ref_To_Local'>lccoll</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span>    <span class='Comment_Single_Line'>/* shouldn't happen */ 
</span>                <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"wrong number of output columns in WITH"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="parse_cte.c.html#LN299"><span class='Ref_To_Local'>texpr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="parse_cte.c.html#LN298"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/nodeFuncs.h.html#LN31"><span class='Ref_to_Proto'>exprType</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN299"><span class='Ref_To_Local'>texpr</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN287"><span class='Ref_To_Local'>lctyp</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>                <a href="../../include/nodes/nodeFuncs.h.html#LN32"><span class='Ref_to_Proto'>exprTypmod</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN299"><span class='Ref_To_Local'>texpr</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN106"><span class='Ref_to_Macro'>lfirst_int</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN288"><span class='Ref_To_Local'>lctypmod</span></a><span class='Parentheses'>))</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"recursive query \"%s\" column %d has type %s in non-recursive term but type %s overall"</span><span class='Delimiter'>, 
</span>                                <a href="parse_cte.c.html#LN236"><span class='Ref_to_Parameter'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1342"><span class='Ref_to_Member'>ctename</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN290"><span class='Ref_To_Local'>varattno</span></a><span class='Delimiter'>, 
</span>                                <a href="../utils/adt/format_type.c.html#LN111"><span class='Ref_to_Func'>format_type_with_typemod</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN287"><span class='Ref_To_Local'>lctyp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                       <a href="../../include/nodes/pg_list.h.html#LN106"><span class='Ref_to_Macro'>lfirst_int</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN288"><span class='Ref_To_Local'>lctypmod</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                                <a href="../utils/adt/format_type.c.html#LN111"><span class='Ref_to_Func'>format_type_with_typemod</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/nodeFuncs.h.html#LN31"><span class='Ref_to_Proto'>exprType</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN299"><span class='Ref_To_Local'>texpr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                         <a href="../../include/nodes/nodeFuncs.h.html#LN32"><span class='Ref_to_Proto'>exprTypmod</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN299"><span class='Ref_To_Local'>texpr</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Cast the output of the non-recursive term to the correct type."</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN236"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/nodeFuncs.h.html#LN43"><span class='Ref_to_Proto'>exprLocation</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN299"><span class='Ref_To_Local'>texpr</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/nodeFuncs.h.html#LN38"><span class='Ref_to_Proto'>exprCollation</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN299"><span class='Ref_To_Local'>texpr</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN289"><span class='Ref_To_Local'>lccoll</span></a><span class='Parentheses'>))</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_COLLATION_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"recursive query \"%s\" column %d has collation \"%s\" in non-recursive term but collation \"%s\" overall"</span><span class='Delimiter'>, 
</span>                                <a href="parse_cte.c.html#LN236"><span class='Ref_to_Parameter'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1342"><span class='Ref_to_Member'>ctename</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN290"><span class='Ref_To_Local'>varattno</span></a><span class='Delimiter'>, 
</span>                                <a href="../../include/utils/lsyscache.h.html#LN93"><span class='Ref_to_Proto'>get_collation_name</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN289"><span class='Ref_To_Local'>lccoll</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                                <a href="../../include/utils/lsyscache.h.html#LN93"><span class='Ref_to_Proto'>get_collation_name</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/nodeFuncs.h.html#LN38"><span class='Ref_to_Proto'>exprCollation</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN299"><span class='Ref_To_Local'>texpr</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Use the COLLATE clause to set the collation of the non-recursive term."</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN236"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/nodeFuncs.h.html#LN43"><span class='Ref_to_Proto'>exprLocation</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN299"><span class='Ref_To_Local'>texpr</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>            <a href="parse_cte.c.html#LN287"><span class='Ref_To_Local'>lctyp</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN287"><span class='Ref_To_Local'>lctyp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="parse_cte.c.html#LN288"><span class='Ref_To_Local'>lctypmod</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN288"><span class='Ref_To_Local'>lctypmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="parse_cte.c.html#LN289"><span class='Ref_To_Local'>lccoll</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN289"><span class='Ref_To_Local'>lccoll</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_cte.c.html#LN287"><span class='Ref_To_Local'>lctyp</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="parse_cte.c.html#LN288"><span class='Ref_To_Local'>lctypmod</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="parse_cte.c.html#LN289"><span class='Ref_To_Local'>lccoll</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span>        <span class='Comment_Single_Line'>/* shouldn't happen */ 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"wrong number of output columns in WITH"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end analyzeCTE &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Compute derived fields of a CTE, given the transformed output targetlist 
 * 
 * For a nonrecursive CTE, this is called after transforming the CTE's query. 
 * For a recursive CTE, we call it after transforming the non-recursive term, 
 * and pass the targetlist emitted by the non-recursive term only. 
 * 
 * Note: in the recursive case, the passed pstate is actually the one being 
 * used to analyze the CTE's query, so it is one level lower down than in 
 * the nonrecursive case.  This doesn't matter since we only use it for 
 * error message context anyway. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN351"></a><span class='Declare_Function'>analyzeCTETargetList</span><span class='Parentheses'>(</span><a href="../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1339"><span class='Ref_to_Struct'>CommonTableExpr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cte</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tlist</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN353"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>numaliases</span><span class='Delimiter'>; 
</span><a name="LN354"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>varattno</span><span class='Delimiter'>; 
</span><a name="LN355"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>tlistitem</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Not done already ... */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN351"><span class='Ref_to_Parameter'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1351"><span class='Ref_to_Member'>ctecolnames</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We need to determine column names, types, and collations.  The alias 
     * column names override anything coming from the query itself.  (Note: 
     * the SQL spec says that the alias list must be empty or exactly as long 
     * as the output column set; but we allow it to be shorter for consistency 
     * with Alias handling.) 
     */ 
</span>    <a href="parse_cte.c.html#LN351"><span class='Ref_to_Parameter'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1351"><span class='Ref_to_Member'>ctecolnames</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN351"><span class='Ref_to_Parameter'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1343"><span class='Ref_to_Member'>aliascolnames</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="parse_cte.c.html#LN351"><span class='Ref_to_Parameter'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1352"><span class='Ref_to_Member'>ctecoltypes</span></a> <span class='Operator'>= </span><a href="parse_cte.c.html#LN351"><span class='Ref_to_Parameter'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1353"><span class='Ref_to_Member'>ctecoltypmods</span></a> <span class='Operator'>= </span><a href="parse_cte.c.html#LN351"><span class='Ref_to_Parameter'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1354"><span class='Ref_to_Member'>ctecolcollations</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="parse_cte.c.html#LN353"><span class='Ref_To_Local'>numaliases</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN351"><span class='Ref_to_Parameter'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1343"><span class='Ref_to_Member'>aliascolnames</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="parse_cte.c.html#LN354"><span class='Ref_To_Local'>varattno</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN355"><span class='Ref_To_Local'>tlistitem</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN351"><span class='Ref_to_Parameter'>tlist</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN373"></a>        <a href="../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>te</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN355"><span class='Ref_To_Local'>tlistitem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN374"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>coltype</span><span class='Delimiter'>; 
</span><a name="LN375"></a>        <a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>coltypmod</span><span class='Delimiter'>; 
</span><a name="LN376"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>colcoll</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_cte.c.html#LN373"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1373"><span class='Ref_to_Member'>resjunk</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <a href="parse_cte.c.html#LN354"><span class='Ref_To_Local'>varattno</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN354"><span class='Ref_To_Local'>varattno</span></a> <span class='Operator'>== </span><a href="parse_cte.c.html#LN373"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1367"><span class='Ref_to_Member'>resno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_cte.c.html#LN354"><span class='Ref_To_Local'>varattno</span></a> <span class='Operator'>&GT; </span><a href="parse_cte.c.html#LN353"><span class='Ref_To_Local'>numaliases</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN384"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>attrname</span><span class='Delimiter'>; 
</span> 
            <a href="parse_cte.c.html#LN384"><span class='Ref_To_Local'>attrname</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN373"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1368"><span class='Ref_to_Member'>resname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="parse_cte.c.html#LN351"><span class='Ref_to_Parameter'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1351"><span class='Ref_to_Member'>ctecolnames</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN351"><span class='Ref_to_Parameter'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1351"><span class='Ref_to_Member'>ctecolnames</span></a><span class='Delimiter'>, </span><a href="../nodes/value.c.html#LN51"><span class='Ref_to_Func'>makeString</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN384"><span class='Ref_To_Local'>attrname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="parse_cte.c.html#LN374"><span class='Ref_To_Local'>coltype</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodeFuncs.h.html#LN31"><span class='Ref_to_Proto'>exprType</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="parse_cte.c.html#LN373"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="parse_cte.c.html#LN375"><span class='Ref_To_Local'>coltypmod</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodeFuncs.h.html#LN32"><span class='Ref_to_Proto'>exprTypmod</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="parse_cte.c.html#LN373"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="parse_cte.c.html#LN376"><span class='Ref_To_Local'>colcoll</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodeFuncs.h.html#LN38"><span class='Ref_to_Proto'>exprCollation</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="parse_cte.c.html#LN373"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If the CTE is recursive, force the exposed column type of any 
         * "unknown" column to "text".  We must deal with this here because 
         * we're called on the non-recursive term before there's been any 
         * attempt to force unknown output columns to some other type.  We 
         * have to resolve unknowns before looking at the recursive term. 
         * 
         * The column might contain 'foo' COLLATE "bar", so don't override 
         * collation if it's already set. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_cte.c.html#LN351"><span class='Ref_to_Parameter'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1348"><span class='Ref_to_Member'>cterecursive</span></a> <span class='Operator'>&& </span><a href="parse_cte.c.html#LN374"><span class='Ref_To_Local'>coltype</span></a> <span class='Operator'>== </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN43"><span class='Ref_to_Const'>UNKNOWNOID</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="parse_cte.c.html#LN374"><span class='Ref_To_Local'>coltype</span></a> <span class='Operator'>= </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>; 
</span>            <a href="parse_cte.c.html#LN375"><span class='Ref_To_Local'>coltypmod</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* should be -1 already, but be sure */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN376"><span class='Ref_To_Local'>colcoll</span></a><span class='Parentheses'>))</span> 
                <a href="parse_cte.c.html#LN376"><span class='Ref_To_Local'>colcoll</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_collation.h.html#LN74"><span class='Ref_to_Const'>DEFAULT_COLLATION_OID</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="parse_cte.c.html#LN351"><span class='Ref_to_Parameter'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1352"><span class='Ref_to_Member'>ctecoltypes</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN351"><span class='Ref_to_Parameter'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1352"><span class='Ref_to_Member'>ctecoltypes</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN374"><span class='Ref_To_Local'>coltype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="parse_cte.c.html#LN351"><span class='Ref_to_Parameter'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1353"><span class='Ref_to_Member'>ctecoltypmods</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN144"><span class='Ref_to_Func'>lappend_int</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN351"><span class='Ref_to_Parameter'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1353"><span class='Ref_to_Member'>ctecoltypmods</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN375"><span class='Ref_To_Local'>coltypmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="parse_cte.c.html#LN351"><span class='Ref_to_Parameter'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1354"><span class='Ref_to_Member'>ctecolcollations</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN351"><span class='Ref_to_Parameter'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1354"><span class='Ref_to_Member'>ctecolcollations</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN376"><span class='Ref_To_Local'>colcoll</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_cte.c.html#LN354"><span class='Ref_To_Local'>varattno</span></a> <span class='Operator'>&LT; </span><a href="parse_cte.c.html#LN353"><span class='Ref_To_Local'>numaliases</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_COLUMN_REFERENCE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"WITH query \"%s\" has %d columns available but %d columns specified"</span><span class='Delimiter'>, 
</span>                        <a href="parse_cte.c.html#LN351"><span class='Ref_to_Parameter'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1342"><span class='Ref_to_Member'>ctename</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN354"><span class='Ref_To_Local'>varattno</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN353"><span class='Ref_To_Local'>numaliases</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN351"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN351"><span class='Ref_to_Parameter'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1346"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end analyzeCTETargetList &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Identify the cross-references of a list of WITH RECURSIVE items, 
 * and sort into an order that has no forward references. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN428"></a><span class='Declare_Function'>makeDependencyGraph</span><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN66"><span class='Ref_to_Struct'>CteState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cstate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN430"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="parse_cte.c.html#LN430"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="parse_cte.c.html#LN430"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="parse_cte.c.html#LN428"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN71"><span class='Ref_to_Member'>numitems</span></a><span class='Delimiter'>; </span><a href="parse_cte.c.html#LN430"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN434"></a>        <a href="../../include/nodes/parsenodes.h.html#LN1339"><span class='Ref_to_Struct'>CommonTableExpr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cte</span> <span class='Operator'>= </span><a href="parse_cte.c.html#LN428"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN70"><span class='Ref_to_Member'>items</span></a><span class='Delimiter'>[</span><a href="parse_cte.c.html#LN430"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="parse_cte.c.html#LN60"><span class='Ref_to_Member'>cte</span></a><span class='Delimiter'>; 
</span> 
        <a href="parse_cte.c.html#LN428"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN73"><span class='Ref_to_Member'>curitem</span></a> <span class='Operator'>= </span><a href="parse_cte.c.html#LN430"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>        <a href="parse_cte.c.html#LN428"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN74"><span class='Ref_to_Member'>innerwiths</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>        <a href="parse_cte.c.html#LN85"><span class='Ref_to_Proto'>makeDependencyGraphWalker</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="parse_cte.c.html#LN434"><span class='Ref_To_Local'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1345"><span class='Ref_to_Member'>ctequery</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN428"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN428"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN74"><span class='Ref_to_Member'>innerwiths</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="parse_cte.c.html#LN86"><span class='Ref_to_Proto'>TopologicalSort</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN428"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN69"><span class='Ref_to_Member'>pstate</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN428"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN70"><span class='Ref_to_Member'>items</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN428"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN71"><span class='Ref_to_Member'>numitems</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Tree walker function to detect cross-references and self-references of the 
 * CTEs in a WITH RECURSIVE list. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN450"></a><span class='Declare_Function'>makeDependencyGraphWalker</span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN66"><span class='Ref_to_Struct'>CteState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cstate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_cte.c.html#LN450"><span class='Ref_to_Parameter'>node</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN450"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/primnodes.h.html#LN62"><span class='Ref_to_Struct'>RangeVar</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN456"></a>        <a href="../../include/nodes/primnodes.h.html#LN62"><span class='Ref_to_Struct'>RangeVar</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>rv</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN62"><span class='Ref_to_Struct'>RangeVar</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="parse_cte.c.html#LN450"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* If unqualified name, might be a CTE reference */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="parse_cte.c.html#LN456"><span class='Ref_To_Local'>rv</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN66"><span class='Ref_to_Member'>schemaname</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN461"></a>            <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span><a name="LN462"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* ... but first see if it's captured by an inner WITH */ 
</span>            <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN461"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN450"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN74"><span class='Ref_to_Member'>innerwiths</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN467"></a>                <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>withlist</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN461"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN468"></a>                <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc2</span><span class='Delimiter'>; 
</span> 
                <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN468"><span class='Ref_To_Local'>lc2</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN467"><span class='Ref_To_Local'>withlist</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN472"></a>                    <a href="../../include/nodes/parsenodes.h.html#LN1339"><span class='Ref_to_Struct'>CommonTableExpr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cte</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1339"><span class='Ref_to_Struct'>CommonTableExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN468"><span class='Ref_To_Local'>lc2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="parse_cte.c.html#LN456"><span class='Ref_To_Local'>rv</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN472"><span class='Ref_To_Local'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1342"><span class='Ref_to_Member'>ctename</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* yes, so bail out */ 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* No, could be a reference to the query level we are working on */ 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="parse_cte.c.html#LN462"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="parse_cte.c.html#LN462"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="parse_cte.c.html#LN450"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN71"><span class='Ref_to_Member'>numitems</span></a><span class='Delimiter'>; </span><a href="parse_cte.c.html#LN462"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN482"></a>                <a href="../../include/nodes/parsenodes.h.html#LN1339"><span class='Ref_to_Struct'>CommonTableExpr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cte</span> <span class='Operator'>= </span><a href="parse_cte.c.html#LN450"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN70"><span class='Ref_to_Member'>items</span></a><span class='Delimiter'>[</span><a href="parse_cte.c.html#LN462"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="parse_cte.c.html#LN60"><span class='Ref_to_Member'>cte</span></a><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="parse_cte.c.html#LN456"><span class='Ref_To_Local'>rv</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN482"><span class='Ref_To_Local'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1342"><span class='Ref_to_Member'>ctename</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span><a name="LN486"></a>                    <span class='Keyword'>int</span>         <span class='Declare_Local'>myindex</span> <span class='Operator'>= </span><a href="parse_cte.c.html#LN450"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN73"><span class='Ref_to_Member'>curitem</span></a><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_cte.c.html#LN462"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>!= </span><a href="parse_cte.c.html#LN486"><span class='Ref_To_Local'>myindex</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* Add cross-item dependency */ 
</span>                        <a href="parse_cte.c.html#LN450"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN70"><span class='Ref_to_Member'>items</span></a><span class='Delimiter'>[</span><a href="parse_cte.c.html#LN486"><span class='Ref_To_Local'>myindex</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="parse_cte.c.html#LN62"><span class='Ref_to_Member'>depends_on</span></a> <span class='Operator'>= 
</span>                            <a href="../../include/nodes/bitmapset.h.html#LN89"><span class='Ref_to_Proto'>bms_add_member</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN450"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN70"><span class='Ref_to_Member'>items</span></a><span class='Delimiter'>[</span><a href="parse_cte.c.html#LN486"><span class='Ref_To_Local'>myindex</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="parse_cte.c.html#LN62"><span class='Ref_to_Member'>depends_on</span></a><span class='Delimiter'>, 
</span>                                           <a href="parse_cte.c.html#LN450"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN70"><span class='Ref_to_Member'>items</span></a><span class='Delimiter'>[</span><a href="parse_cte.c.html#LN462"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="parse_cte.c.html#LN61"><span class='Ref_to_Member'>id</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* Found out this one is self-referential */ 
</span>                        <a href="parse_cte.c.html#LN482"><span class='Ref_To_Local'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1348"><span class='Ref_to_Member'>cterecursive</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;cstate-&GT;numitem... &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !rv-&GT;schemaname &raquo; </span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IsA(node,RangeVar) &raquo; </span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN450"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1478"><span class='Ref_to_Struct'>SelectStmt</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN508"></a>        <a href="../../include/nodes/parsenodes.h.html#LN1478"><span class='Ref_to_Struct'>SelectStmt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>stmt</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1478"><span class='Ref_to_Struct'>SelectStmt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="parse_cte.c.html#LN450"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span><a name="LN509"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_cte.c.html#LN508"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1513"><span class='Ref_to_Member'>withClause</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_cte.c.html#LN508"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1513"><span class='Ref_to_Member'>withClause</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1298"><span class='Ref_to_Member'>recursive</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * In the RECURSIVE case, all query names of the WITH are 
                 * visible to all WITH items as well as the main query. So 
                 * push them all on, process, pop them all off. 
                 */ 
</span>                <a href="parse_cte.c.html#LN450"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN74"><span class='Ref_to_Member'>innerwiths</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN215"><span class='Ref_to_Proto'>lcons</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN508"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1513"><span class='Ref_to_Member'>withClause</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1297"><span class='Ref_to_Member'>ctes</span></a><span class='Delimiter'>, 
</span>                                           <a href="parse_cte.c.html#LN450"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN74"><span class='Ref_to_Member'>innerwiths</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN509"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN508"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1513"><span class='Ref_to_Member'>withClause</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1297"><span class='Ref_to_Member'>ctes</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN524"></a>                    <a href="../../include/nodes/parsenodes.h.html#LN1339"><span class='Ref_to_Struct'>CommonTableExpr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cte</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1339"><span class='Ref_to_Struct'>CommonTableExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN509"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="parse_cte.c.html#LN85"><span class='Ref_to_Proto'>makeDependencyGraphWalker</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN524"><span class='Ref_To_Local'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1345"><span class='Ref_to_Member'>ctequery</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN450"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../include/nodes/nodeFuncs.h.html#LN72"><span class='Ref_to_Proto'>raw_expression_tree_walker</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN450"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, 
</span>                                                  <a href="parse_cte.c.html#LN85"><span class='Ref_to_Proto'>makeDependencyGraphWalker</span></a><span class='Delimiter'>, 
</span>                                                  <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="parse_cte.c.html#LN450"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="parse_cte.c.html#LN450"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN74"><span class='Ref_to_Member'>innerwiths</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN237"><span class='Ref_to_Proto'>list_delete_first</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN450"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN74"><span class='Ref_to_Member'>innerwiths</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if stmt-&GT;withClause-&GT;rec... &raquo; </span> 
            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * In the non-RECURSIVE case, query names are visible to the 
                 * WITH items after them and to the main query. 
                 */ 
</span><a name="LN539"></a>                <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cell1</span><span class='Delimiter'>; 
</span> 
                <a href="parse_cte.c.html#LN450"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN74"><span class='Ref_to_Member'>innerwiths</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN215"><span class='Ref_to_Proto'>lcons</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN450"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN74"><span class='Ref_to_Member'>innerwiths</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="parse_cte.c.html#LN539"><span class='Ref_To_Local'>cell1</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN75"><span class='Ref_to_Func'>list_head</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN450"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN74"><span class='Ref_to_Member'>innerwiths</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN509"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN508"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1513"><span class='Ref_to_Member'>withClause</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1297"><span class='Ref_to_Member'>ctes</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN545"></a>                    <a href="../../include/nodes/parsenodes.h.html#LN1339"><span class='Ref_to_Struct'>CommonTableExpr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cte</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1339"><span class='Ref_to_Struct'>CommonTableExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN509"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="parse_cte.c.html#LN85"><span class='Ref_to_Proto'>makeDependencyGraphWalker</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN545"><span class='Ref_To_Local'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1345"><span class='Ref_to_Member'>ctequery</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN450"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN539"><span class='Ref_To_Local'>cell1</span></a><span class='Parentheses'>) </span><span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN539"><span class='Ref_To_Local'>cell1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN545"><span class='Ref_To_Local'>cte</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../include/nodes/nodeFuncs.h.html#LN72"><span class='Ref_to_Proto'>raw_expression_tree_walker</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN450"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, 
</span>                                                  <a href="parse_cte.c.html#LN85"><span class='Ref_to_Proto'>makeDependencyGraphWalker</span></a><span class='Delimiter'>, 
</span>                                                  <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="parse_cte.c.html#LN450"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="parse_cte.c.html#LN450"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN74"><span class='Ref_to_Member'>innerwiths</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN237"><span class='Ref_to_Proto'>list_delete_first</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN450"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN74"><span class='Ref_to_Member'>innerwiths</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
            <span class='Comment_Multi_Line'>/* We're done examining the SelectStmt */ 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if stmt-&GT;withClause &raquo; </span> 
        <span class='Comment_Multi_Line'>/* if no WITH clause, just fall through for normal processing */ 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IsA(node,SelectStmt) &raquo; </span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN450"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1294"><span class='Ref_to_Struct'>WithClause</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Prevent raw_expression_tree_walker from recursing directly into a 
         * WITH clause.  We need that to happen only under the control of the 
         * code above. 
         */ 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="../../include/nodes/nodeFuncs.h.html#LN72"><span class='Ref_to_Proto'>raw_expression_tree_walker</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN450"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, 
</span>                                      <a href="parse_cte.c.html#LN85"><span class='Ref_to_Proto'>makeDependencyGraphWalker</span></a><span class='Delimiter'>, 
</span>                                      <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="parse_cte.c.html#LN450"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end makeDependencyGraphWalker &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Sort by dependencies, using a standard topological sort operation 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN578"></a><span class='Declare_Function'>TopologicalSort</span><span class='Parentheses'>(</span><a href="../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN58"><span class='Ref_to_Struct'>CteItem</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>items</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>numitems</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN580"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN581"></a>                <span class='Declare_Local'>j</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* for each position in sequence ... */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="parse_cte.c.html#LN580"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="parse_cte.c.html#LN580"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="parse_cte.c.html#LN578"><span class='Ref_to_Parameter'>numitems</span></a><span class='Delimiter'>; </span><a href="parse_cte.c.html#LN580"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* ... scan the remaining items to find one that has no dependencies */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="parse_cte.c.html#LN581"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><a href="parse_cte.c.html#LN580"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; </span><a href="parse_cte.c.html#LN581"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>&LT; </span><a href="parse_cte.c.html#LN578"><span class='Ref_to_Parameter'>numitems</span></a><span class='Delimiter'>; </span><a href="parse_cte.c.html#LN581"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/bitmapset.h.html#LN85"><span class='Ref_to_Proto'>bms_is_empty</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN578"><span class='Ref_to_Parameter'>items</span></a><span class='Delimiter'>[</span><a href="parse_cte.c.html#LN581"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="parse_cte.c.html#LN62"><span class='Ref_to_Member'>depends_on</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* if we didn't find one, the dependency graph has a cycle */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_cte.c.html#LN581"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>&GT;= </span><a href="parse_cte.c.html#LN578"><span class='Ref_to_Parameter'>numitems</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>            <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"mutual recursion between WITH items is not implemented"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN578"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN578"><span class='Ref_to_Parameter'>items</span></a><span class='Delimiter'>[</span><a href="parse_cte.c.html#LN580"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="parse_cte.c.html#LN60"><span class='Ref_to_Member'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1346"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Found one.  Move it to front and remove it from every other item's 
         * dependencies. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_cte.c.html#LN580"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>!= </span><a href="parse_cte.c.html#LN581"><span class='Ref_To_Local'>j</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN606"></a>            <a href="parse_cte.c.html#LN58"><span class='Ref_to_Struct'>CteItem</span></a>     <span class='Declare_Local'>tmp</span><span class='Delimiter'>; 
</span> 
            <a href="parse_cte.c.html#LN606"><span class='Ref_To_Local'>tmp</span></a> <span class='Operator'>= </span><a href="parse_cte.c.html#LN578"><span class='Ref_to_Parameter'>items</span></a><span class='Delimiter'>[</span><a href="parse_cte.c.html#LN580"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>            <a href="parse_cte.c.html#LN578"><span class='Ref_to_Parameter'>items</span></a><span class='Delimiter'>[</span><a href="parse_cte.c.html#LN580"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="parse_cte.c.html#LN578"><span class='Ref_to_Parameter'>items</span></a><span class='Delimiter'>[</span><a href="parse_cte.c.html#LN581"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]; 
</span>            <a href="parse_cte.c.html#LN578"><span class='Ref_to_Parameter'>items</span></a><span class='Delimiter'>[</span><a href="parse_cte.c.html#LN581"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="parse_cte.c.html#LN606"><span class='Ref_To_Local'>tmp</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Items up through i are known to have no dependencies left, so we 
         * can skip them in this loop. 
         */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="parse_cte.c.html#LN581"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><a href="parse_cte.c.html#LN580"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="parse_cte.c.html#LN581"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>&LT; </span><a href="parse_cte.c.html#LN578"><span class='Ref_to_Parameter'>numitems</span></a><span class='Delimiter'>; </span><a href="parse_cte.c.html#LN581"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="parse_cte.c.html#LN578"><span class='Ref_to_Parameter'>items</span></a><span class='Delimiter'>[</span><a href="parse_cte.c.html#LN581"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="parse_cte.c.html#LN62"><span class='Ref_to_Member'>depends_on</span></a> <span class='Operator'>= </span><a href="../../include/nodes/bitmapset.h.html#LN90"><span class='Ref_to_Proto'>bms_del_member</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN578"><span class='Ref_to_Parameter'>items</span></a><span class='Delimiter'>[</span><a href="parse_cte.c.html#LN581"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="parse_cte.c.html#LN62"><span class='Ref_to_Member'>depends_on</span></a><span class='Delimiter'>, 
</span>                                                 <a href="parse_cte.c.html#LN578"><span class='Ref_to_Parameter'>items</span></a><span class='Delimiter'>[</span><a href="parse_cte.c.html#LN580"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="parse_cte.c.html#LN61"><span class='Ref_to_Member'>id</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;numitems;i++ &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end TopologicalSort &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Check that recursive queries are well-formed. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN630"></a><span class='Declare_Function'>checkWellFormedRecursion</span><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN66"><span class='Ref_to_Struct'>CteState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cstate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN632"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="parse_cte.c.html#LN632"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="parse_cte.c.html#LN632"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="parse_cte.c.html#LN630"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN71"><span class='Ref_to_Member'>numitems</span></a><span class='Delimiter'>; </span><a href="parse_cte.c.html#LN632"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN636"></a>        <a href="../../include/nodes/parsenodes.h.html#LN1339"><span class='Ref_to_Struct'>CommonTableExpr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cte</span> <span class='Operator'>= </span><a href="parse_cte.c.html#LN630"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN70"><span class='Ref_to_Member'>items</span></a><span class='Delimiter'>[</span><a href="parse_cte.c.html#LN632"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="parse_cte.c.html#LN60"><span class='Ref_to_Member'>cte</span></a><span class='Delimiter'>; 
</span><a name="LN637"></a>        <a href="../../include/nodes/parsenodes.h.html#LN1478"><span class='Ref_to_Struct'>SelectStmt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>stmt</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1478"><span class='Ref_to_Struct'>SelectStmt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="parse_cte.c.html#LN636"><span class='Ref_To_Local'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1345"><span class='Ref_to_Member'>ctequery</span></a><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN637"><span class='Ref_To_Local'>stmt</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a><span class='Parentheses'>))</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* not analyzed yet */ 
</span> 
        <span class='Comment_Multi_Line'>/* Ignore items that weren't found to be recursive */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="parse_cte.c.html#LN636"><span class='Ref_To_Local'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1348"><span class='Ref_to_Member'>cterecursive</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Must be a SELECT statement */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN637"><span class='Ref_To_Local'>stmt</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1478"><span class='Ref_to_Struct'>SelectStmt</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_RECURSION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"recursive query \"%s\" must not contain data-modifying statements"</span><span class='Delimiter'>, 
</span>                            <a href="parse_cte.c.html#LN636"><span class='Ref_To_Local'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1342"><span class='Ref_to_Member'>ctename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN630"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN69"><span class='Ref_to_Member'>pstate</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN636"><span class='Ref_To_Local'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1346"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Must have top-level UNION */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_cte.c.html#LN637"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1518"><span class='Ref_to_Member'>op</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/parsenodes.h.html#LN1473"><span class='Ref_to_EnumConst'>SETOP_UNION</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_RECURSION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"recursive query \"%s\" does not have the form non-recursive-term UNION [ALL] recursive-term"</span><span class='Delimiter'>, 
</span>                            <a href="parse_cte.c.html#LN636"><span class='Ref_To_Local'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1342"><span class='Ref_to_Member'>ctename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN630"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN69"><span class='Ref_to_Member'>pstate</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN636"><span class='Ref_To_Local'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1346"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* The left-hand operand mustn't contain self-reference at all */ 
</span>        <a href="parse_cte.c.html#LN630"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN73"><span class='Ref_to_Member'>curitem</span></a> <span class='Operator'>= </span><a href="parse_cte.c.html#LN632"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>        <a href="parse_cte.c.html#LN630"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN74"><span class='Ref_to_Member'>innerwiths</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>        <a href="parse_cte.c.html#LN630"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN76"><span class='Ref_to_Member'>selfrefcount</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="parse_cte.c.html#LN630"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN77"><span class='Ref_to_Member'>context</span></a> <span class='Operator'>= </span><a href="parse_cte.c.html#LN29"><span class='Ref_to_EnumConst'>RECURSION_NONRECURSIVETERM</span></a><span class='Delimiter'>; 
</span>        <a href="parse_cte.c.html#LN90"><span class='Ref_to_Proto'>checkWellFormedRecursionWalker</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="parse_cte.c.html#LN637"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1520"><span class='Ref_to_Member'>larg</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN630"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN630"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN74"><span class='Ref_to_Member'>innerwiths</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Right-hand operand should contain one reference in a valid place */ 
</span>        <a href="parse_cte.c.html#LN630"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN73"><span class='Ref_to_Member'>curitem</span></a> <span class='Operator'>= </span><a href="parse_cte.c.html#LN632"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>        <a href="parse_cte.c.html#LN630"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN74"><span class='Ref_to_Member'>innerwiths</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>        <a href="parse_cte.c.html#LN630"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN76"><span class='Ref_to_Member'>selfrefcount</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="parse_cte.c.html#LN630"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN77"><span class='Ref_to_Member'>context</span></a> <span class='Operator'>= </span><a href="parse_cte.c.html#LN28"><span class='Ref_to_EnumConst'>RECURSION_OK</span></a><span class='Delimiter'>; 
</span>        <a href="parse_cte.c.html#LN90"><span class='Ref_to_Proto'>checkWellFormedRecursionWalker</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="parse_cte.c.html#LN637"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1521"><span class='Ref_to_Member'>rarg</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN630"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN630"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN74"><span class='Ref_to_Member'>innerwiths</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_cte.c.html#LN630"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN76"><span class='Ref_to_Member'>selfrefcount</span></a> <span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>)</span>  <span class='Comment_Single_Line'>/* shouldn't happen */ 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"missing recursive reference"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* WITH mustn't contain self-reference, either */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_cte.c.html#LN637"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1513"><span class='Ref_to_Member'>withClause</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="parse_cte.c.html#LN630"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN73"><span class='Ref_to_Member'>curitem</span></a> <span class='Operator'>= </span><a href="parse_cte.c.html#LN632"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>            <a href="parse_cte.c.html#LN630"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN74"><span class='Ref_to_Member'>innerwiths</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>            <a href="parse_cte.c.html#LN630"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN76"><span class='Ref_to_Member'>selfrefcount</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="parse_cte.c.html#LN630"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN77"><span class='Ref_to_Member'>context</span></a> <span class='Operator'>= </span><a href="parse_cte.c.html#LN30"><span class='Ref_to_EnumConst'>RECURSION_SUBLINK</span></a><span class='Delimiter'>; 
</span>            <a href="parse_cte.c.html#LN90"><span class='Ref_to_Proto'>checkWellFormedRecursionWalker</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="parse_cte.c.html#LN637"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1513"><span class='Ref_to_Member'>withClause</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1297"><span class='Ref_to_Member'>ctes</span></a><span class='Delimiter'>, 
</span>                                           <a href="parse_cte.c.html#LN630"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN630"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN74"><span class='Ref_to_Member'>innerwiths</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Disallow ORDER BY and similar decoration atop the UNION. These 
         * don't make sense because it's impossible to figure out what they 
         * mean when we have only part of the recursive query's results. (If 
         * we did allow them, we'd have to check for recursive references 
         * inside these subtrees.) 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_cte.c.html#LN637"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1509"><span class='Ref_to_Member'>sortClause</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                  <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"ORDER BY in a recursive query is not implemented"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN630"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN69"><span class='Ref_to_Member'>pstate</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../include/nodes/nodeFuncs.h.html#LN43"><span class='Ref_to_Proto'>exprLocation</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="parse_cte.c.html#LN637"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1509"><span class='Ref_to_Member'>sortClause</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_cte.c.html#LN637"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1510"><span class='Ref_to_Member'>limitOffset</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"OFFSET in a recursive query is not implemented"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN630"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN69"><span class='Ref_to_Member'>pstate</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../include/nodes/nodeFuncs.h.html#LN43"><span class='Ref_to_Proto'>exprLocation</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN637"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1510"><span class='Ref_to_Member'>limitOffset</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_cte.c.html#LN637"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1511"><span class='Ref_to_Member'>limitCount</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"LIMIT in a recursive query is not implemented"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN630"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN69"><span class='Ref_to_Member'>pstate</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../include/nodes/nodeFuncs.h.html#LN43"><span class='Ref_to_Proto'>exprLocation</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN637"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1511"><span class='Ref_to_Member'>limitCount</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_cte.c.html#LN637"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1512"><span class='Ref_to_Member'>lockingClause</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"FOR UPDATE/SHARE in a recursive query is not implemented"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN630"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN69"><span class='Ref_to_Member'>pstate</span></a><span class='Delimiter'>, 
</span>                               <a href="../../include/nodes/nodeFuncs.h.html#LN43"><span class='Ref_to_Proto'>exprLocation</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="parse_cte.c.html#LN637"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1512"><span class='Ref_to_Member'>lockingClause</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;cstate-&GT;numitem... &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end checkWellFormedRecursion &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Tree walker function to detect invalid self-references in a recursive query. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN729"></a><span class='Declare_Function'>checkWellFormedRecursionWalker</span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN66"><span class='Ref_to_Struct'>CteState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cstate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN731"></a>    <a href="parse_cte.c.html#LN26"><span class='Ref_to_Typedef'>RecursionContext</span></a> <span class='Declare_Local'>save_context</span> <span class='Operator'>= </span><a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN77"><span class='Ref_to_Member'>context</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>node</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/primnodes.h.html#LN62"><span class='Ref_to_Struct'>RangeVar</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN737"></a>        <a href="../../include/nodes/primnodes.h.html#LN62"><span class='Ref_to_Struct'>RangeVar</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>rv</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN62"><span class='Ref_to_Struct'>RangeVar</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* If unqualified name, might be a CTE reference */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="parse_cte.c.html#LN737"><span class='Ref_To_Local'>rv</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN66"><span class='Ref_to_Member'>schemaname</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN742"></a>            <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span><a name="LN743"></a>            <a href="../../include/nodes/parsenodes.h.html#LN1339"><span class='Ref_to_Struct'>CommonTableExpr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>mycte</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* ... but first see if it's captured by an inner WITH */ 
</span>            <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN742"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN74"><span class='Ref_to_Member'>innerwiths</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN748"></a>                <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>withlist</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN742"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN749"></a>                <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc2</span><span class='Delimiter'>; 
</span> 
                <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN749"><span class='Ref_To_Local'>lc2</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN748"><span class='Ref_To_Local'>withlist</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN753"></a>                    <a href="../../include/nodes/parsenodes.h.html#LN1339"><span class='Ref_to_Struct'>CommonTableExpr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cte</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1339"><span class='Ref_to_Struct'>CommonTableExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN749"><span class='Ref_To_Local'>lc2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="parse_cte.c.html#LN737"><span class='Ref_To_Local'>rv</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN753"><span class='Ref_To_Local'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1342"><span class='Ref_to_Member'>ctename</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* yes, so bail out */ 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* No, could be a reference to the query level we are working on */ 
</span>            <a href="parse_cte.c.html#LN743"><span class='Ref_To_Local'>mycte</span></a> <span class='Operator'>= </span><a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN70"><span class='Ref_to_Member'>items</span></a><span class='Delimiter'>[</span><a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN73"><span class='Ref_to_Member'>curitem</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="parse_cte.c.html#LN60"><span class='Ref_to_Member'>cte</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="parse_cte.c.html#LN737"><span class='Ref_To_Local'>rv</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN743"><span class='Ref_To_Local'>mycte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1342"><span class='Ref_to_Member'>ctename</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Found a recursive reference to the active query */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN77"><span class='Ref_to_Member'>context</span></a> <span class='Operator'>!= </span><a href="parse_cte.c.html#LN28"><span class='Ref_to_EnumConst'>RECURSION_OK</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_RECURSION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN37"><span class='Ref_to_Global_Var'>recursion_errormsgs</span></a><span class='Delimiter'>[</span><a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN77"><span class='Ref_to_Member'>context</span></a><span class='Delimiter'>], 
</span>                                    <a href="parse_cte.c.html#LN743"><span class='Ref_To_Local'>mycte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1342"><span class='Ref_to_Member'>ctename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN69"><span class='Ref_to_Member'>pstate</span></a><span class='Delimiter'>, 
</span>                                                <a href="parse_cte.c.html#LN737"><span class='Ref_To_Local'>rv</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN72"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* Count references */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>++</span><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN76"><span class='Ref_to_Member'>selfrefcount</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_RECURSION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"recursive reference to query \"%s\" must not appear more than once"</span><span class='Delimiter'>, 
</span>                                    <a href="parse_cte.c.html#LN743"><span class='Ref_To_Local'>mycte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1342"><span class='Ref_to_Member'>ctename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN69"><span class='Ref_to_Member'>pstate</span></a><span class='Delimiter'>, 
</span>                                                <a href="parse_cte.c.html#LN737"><span class='Ref_To_Local'>rv</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN72"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !rv-&GT;schemaname &raquo; </span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IsA(node,RangeVar) &raquo; </span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1478"><span class='Ref_to_Struct'>SelectStmt</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN786"></a>        <a href="../../include/nodes/parsenodes.h.html#LN1478"><span class='Ref_to_Struct'>SelectStmt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>stmt</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1478"><span class='Ref_to_Struct'>SelectStmt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span><a name="LN787"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_cte.c.html#LN786"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1513"><span class='Ref_to_Member'>withClause</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_cte.c.html#LN786"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1513"><span class='Ref_to_Member'>withClause</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1298"><span class='Ref_to_Member'>recursive</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * In the RECURSIVE case, all query names of the WITH are 
                 * visible to all WITH items as well as the main query. So 
                 * push them all on, process, pop them all off. 
                 */ 
</span>                <a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN74"><span class='Ref_to_Member'>innerwiths</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN215"><span class='Ref_to_Proto'>lcons</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN786"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1513"><span class='Ref_to_Member'>withClause</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1297"><span class='Ref_to_Member'>ctes</span></a><span class='Delimiter'>, 
</span>                                           <a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN74"><span class='Ref_to_Member'>innerwiths</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN787"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN786"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1513"><span class='Ref_to_Member'>withClause</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1297"><span class='Ref_to_Member'>ctes</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN802"></a>                    <a href="../../include/nodes/parsenodes.h.html#LN1339"><span class='Ref_to_Struct'>CommonTableExpr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cte</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1339"><span class='Ref_to_Struct'>CommonTableExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN787"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="parse_cte.c.html#LN90"><span class='Ref_to_Proto'>checkWellFormedRecursionWalker</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN802"><span class='Ref_To_Local'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1345"><span class='Ref_to_Member'>ctequery</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="parse_cte.c.html#LN91"><span class='Ref_to_Proto'>checkWellFormedSelectStmt</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN786"><span class='Ref_To_Local'>stmt</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN74"><span class='Ref_to_Member'>innerwiths</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN237"><span class='Ref_to_Proto'>list_delete_first</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN74"><span class='Ref_to_Member'>innerwiths</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * In the non-RECURSIVE case, query names are visible to the 
                 * WITH items after them and to the main query. 
                 */ 
</span><a name="LN815"></a>                <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cell1</span><span class='Delimiter'>; 
</span> 
                <a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN74"><span class='Ref_to_Member'>innerwiths</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN215"><span class='Ref_to_Proto'>lcons</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN74"><span class='Ref_to_Member'>innerwiths</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="parse_cte.c.html#LN815"><span class='Ref_To_Local'>cell1</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN75"><span class='Ref_to_Func'>list_head</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN74"><span class='Ref_to_Member'>innerwiths</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN787"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN786"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1513"><span class='Ref_to_Member'>withClause</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1297"><span class='Ref_to_Member'>ctes</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN821"></a>                    <a href="../../include/nodes/parsenodes.h.html#LN1339"><span class='Ref_to_Struct'>CommonTableExpr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cte</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1339"><span class='Ref_to_Struct'>CommonTableExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN787"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="parse_cte.c.html#LN90"><span class='Ref_to_Proto'>checkWellFormedRecursionWalker</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN821"><span class='Ref_To_Local'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1345"><span class='Ref_to_Member'>ctequery</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN815"><span class='Ref_To_Local'>cell1</span></a><span class='Parentheses'>) </span><span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN815"><span class='Ref_To_Local'>cell1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN821"><span class='Ref_To_Local'>cte</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="parse_cte.c.html#LN91"><span class='Ref_to_Proto'>checkWellFormedSelectStmt</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN786"><span class='Ref_To_Local'>stmt</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN74"><span class='Ref_to_Member'>innerwiths</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN237"><span class='Ref_to_Proto'>list_delete_first</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN74"><span class='Ref_to_Member'>innerwiths</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if stmt-&GT;withClause &raquo; </span> 
        <span class='Control'>else</span> 
            <a href="parse_cte.c.html#LN91"><span class='Ref_to_Proto'>checkWellFormedSelectStmt</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN786"><span class='Ref_To_Local'>stmt</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* We're done examining the SelectStmt */ 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IsA(node,SelectStmt) &raquo; </span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1294"><span class='Ref_to_Struct'>WithClause</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Prevent raw_expression_tree_walker from recursing directly into a 
         * WITH clause.  We need that to happen only under the control of the 
         * code above. 
         */ 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN846"></a>        <a href="../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>j</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="parse_cte.c.html#LN846"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1447"><span class='Ref_to_Member'>jointype</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/nodes.h.html#LN677"><span class='Ref_to_EnumConst'>JOIN_INNER</span></a><span class='Operator'>: 
</span>                <a href="parse_cte.c.html#LN90"><span class='Ref_to_Proto'>checkWellFormedRecursionWalker</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN846"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1449"><span class='Ref_to_Member'>larg</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="parse_cte.c.html#LN90"><span class='Ref_to_Proto'>checkWellFormedRecursionWalker</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN846"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1450"><span class='Ref_to_Member'>rarg</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="parse_cte.c.html#LN90"><span class='Ref_to_Proto'>checkWellFormedRecursionWalker</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN846"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1452"><span class='Ref_to_Member'>quals</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/nodes.h.html#LN678"><span class='Ref_to_EnumConst'>JOIN_LEFT</span></a><span class='Operator'>: 
</span>                <a href="parse_cte.c.html#LN90"><span class='Ref_to_Proto'>checkWellFormedRecursionWalker</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN846"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1449"><span class='Ref_to_Member'>larg</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_cte.c.html#LN731"><span class='Ref_To_Local'>save_context</span></a> <span class='Operator'>== </span><a href="parse_cte.c.html#LN28"><span class='Ref_to_EnumConst'>RECURSION_OK</span></a><span class='Parentheses'>) 
</span>                    <a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN77"><span class='Ref_to_Member'>context</span></a> <span class='Operator'>= </span><a href="parse_cte.c.html#LN31"><span class='Ref_to_EnumConst'>RECURSION_OUTERJOIN</span></a><span class='Delimiter'>; 
</span>                <a href="parse_cte.c.html#LN90"><span class='Ref_to_Proto'>checkWellFormedRecursionWalker</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN846"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1450"><span class='Ref_to_Member'>rarg</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN77"><span class='Ref_to_Member'>context</span></a> <span class='Operator'>= </span><a href="parse_cte.c.html#LN731"><span class='Ref_To_Local'>save_context</span></a><span class='Delimiter'>; 
</span>                <a href="parse_cte.c.html#LN90"><span class='Ref_to_Proto'>checkWellFormedRecursionWalker</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN846"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1452"><span class='Ref_to_Member'>quals</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/nodes.h.html#LN679"><span class='Ref_to_EnumConst'>JOIN_FULL</span></a><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_cte.c.html#LN731"><span class='Ref_To_Local'>save_context</span></a> <span class='Operator'>== </span><a href="parse_cte.c.html#LN28"><span class='Ref_to_EnumConst'>RECURSION_OK</span></a><span class='Parentheses'>) 
</span>                    <a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN77"><span class='Ref_to_Member'>context</span></a> <span class='Operator'>= </span><a href="parse_cte.c.html#LN31"><span class='Ref_to_EnumConst'>RECURSION_OUTERJOIN</span></a><span class='Delimiter'>; 
</span>                <a href="parse_cte.c.html#LN90"><span class='Ref_to_Proto'>checkWellFormedRecursionWalker</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN846"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1449"><span class='Ref_to_Member'>larg</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="parse_cte.c.html#LN90"><span class='Ref_to_Proto'>checkWellFormedRecursionWalker</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN846"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1450"><span class='Ref_to_Member'>rarg</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN77"><span class='Ref_to_Member'>context</span></a> <span class='Operator'>= </span><a href="parse_cte.c.html#LN731"><span class='Ref_To_Local'>save_context</span></a><span class='Delimiter'>; 
</span>                <a href="parse_cte.c.html#LN90"><span class='Ref_to_Proto'>checkWellFormedRecursionWalker</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN846"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1452"><span class='Ref_to_Member'>quals</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/nodes.h.html#LN680"><span class='Ref_to_EnumConst'>JOIN_RIGHT</span></a><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_cte.c.html#LN731"><span class='Ref_To_Local'>save_context</span></a> <span class='Operator'>== </span><a href="parse_cte.c.html#LN28"><span class='Ref_to_EnumConst'>RECURSION_OK</span></a><span class='Parentheses'>) 
</span>                    <a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN77"><span class='Ref_to_Member'>context</span></a> <span class='Operator'>= </span><a href="parse_cte.c.html#LN31"><span class='Ref_to_EnumConst'>RECURSION_OUTERJOIN</span></a><span class='Delimiter'>; 
</span>                <a href="parse_cte.c.html#LN90"><span class='Ref_to_Proto'>checkWellFormedRecursionWalker</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN846"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1449"><span class='Ref_to_Member'>larg</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN77"><span class='Ref_to_Member'>context</span></a> <span class='Operator'>= </span><a href="parse_cte.c.html#LN731"><span class='Ref_To_Local'>save_context</span></a><span class='Delimiter'>; 
</span>                <a href="parse_cte.c.html#LN90"><span class='Ref_to_Proto'>checkWellFormedRecursionWalker</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN846"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1450"><span class='Ref_to_Member'>rarg</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="parse_cte.c.html#LN90"><span class='Ref_to_Proto'>checkWellFormedRecursionWalker</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN846"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1452"><span class='Ref_to_Member'>quals</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized join type: %d"</span><span class='Delimiter'>, 
</span>                     <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="parse_cte.c.html#LN846"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1447"><span class='Ref_to_Member'>jointype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch j-&GT;jointype &raquo; </span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IsA(node,JoinExpr) &raquo; </span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/primnodes.h.html#LN629"><span class='Ref_to_Struct'>SubLink</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN887"></a>        <a href="../../include/nodes/primnodes.h.html#LN629"><span class='Ref_to_Struct'>SubLink</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>sl</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN629"><span class='Ref_to_Struct'>SubLink</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * we intentionally override outer context, since subquery is 
         * independent 
         */ 
</span>        <a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN77"><span class='Ref_to_Member'>context</span></a> <span class='Operator'>= </span><a href="parse_cte.c.html#LN30"><span class='Ref_to_EnumConst'>RECURSION_SUBLINK</span></a><span class='Delimiter'>; 
</span>        <a href="parse_cte.c.html#LN90"><span class='Ref_to_Proto'>checkWellFormedRecursionWalker</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN887"><span class='Ref_To_Local'>sl</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN636"><span class='Ref_to_Member'>subselect</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN77"><span class='Ref_to_Member'>context</span></a> <span class='Operator'>= </span><a href="parse_cte.c.html#LN731"><span class='Ref_To_Local'>save_context</span></a><span class='Delimiter'>; 
</span>        <a href="parse_cte.c.html#LN90"><span class='Ref_to_Proto'>checkWellFormedRecursionWalker</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN887"><span class='Ref_To_Local'>sl</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN634"><span class='Ref_to_Member'>testexpr</span></a><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="../../include/nodes/nodeFuncs.h.html#LN72"><span class='Ref_to_Proto'>raw_expression_tree_walker</span></a><span class='Parentheses'>(</span><a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, 
</span>                                      <a href="parse_cte.c.html#LN90"><span class='Ref_to_Proto'>checkWellFormedRecursionWalker</span></a><span class='Delimiter'>, 
</span>                                      <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="parse_cte.c.html#LN729"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end checkWellFormedRecursionWalker &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * subroutine for checkWellFormedRecursionWalker: process a SelectStmt 
 * without worrying about its WITH clause 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN909"></a><span class='Declare_Function'>checkWellFormedSelectStmt</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1478"><span class='Ref_to_Struct'>SelectStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Delimiter'>, </span><a href="parse_cte.c.html#LN66"><span class='Ref_to_Struct'>CteState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cstate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN911"></a>    <a href="parse_cte.c.html#LN26"><span class='Ref_to_Typedef'>RecursionContext</span></a> <span class='Declare_Local'>save_context</span> <span class='Operator'>= </span><a href="parse_cte.c.html#LN909"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN77"><span class='Ref_to_Member'>context</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_cte.c.html#LN911"><span class='Ref_To_Local'>save_context</span></a> <span class='Operator'>!= </span><a href="parse_cte.c.html#LN28"><span class='Ref_to_EnumConst'>RECURSION_OK</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* just recurse without changing state */ 
</span>        <a href="../../include/nodes/nodeFuncs.h.html#LN72"><span class='Ref_to_Proto'>raw_expression_tree_walker</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="parse_cte.c.html#LN909"><span class='Ref_to_Parameter'>stmt</span></a><span class='Delimiter'>, 
</span>                                   <a href="parse_cte.c.html#LN90"><span class='Ref_to_Proto'>checkWellFormedRecursionWalker</span></a><span class='Delimiter'>, 
</span>                                   <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="parse_cte.c.html#LN909"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="parse_cte.c.html#LN909"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1518"><span class='Ref_to_Member'>op</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1472"><span class='Ref_to_EnumConst'>SETOP_NONE</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1473"><span class='Ref_to_EnumConst'>SETOP_UNION</span></a><span class='Operator'>: 
</span>                <a href="../../include/nodes/nodeFuncs.h.html#LN72"><span class='Ref_to_Proto'>raw_expression_tree_walker</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="parse_cte.c.html#LN909"><span class='Ref_to_Parameter'>stmt</span></a><span class='Delimiter'>, 
</span>                                           <a href="parse_cte.c.html#LN90"><span class='Ref_to_Proto'>checkWellFormedRecursionWalker</span></a><span class='Delimiter'>, 
</span>                                           <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="parse_cte.c.html#LN909"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1474"><span class='Ref_to_EnumConst'>SETOP_INTERSECT</span></a><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_cte.c.html#LN909"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1519"><span class='Ref_to_Member'>all</span></a><span class='Parentheses'>) 
</span>                    <a href="parse_cte.c.html#LN909"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN77"><span class='Ref_to_Member'>context</span></a> <span class='Operator'>= </span><a href="parse_cte.c.html#LN32"><span class='Ref_to_EnumConst'>RECURSION_INTERSECT</span></a><span class='Delimiter'>; 
</span>                <a href="parse_cte.c.html#LN90"><span class='Ref_to_Proto'>checkWellFormedRecursionWalker</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="parse_cte.c.html#LN909"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1520"><span class='Ref_to_Member'>larg</span></a><span class='Delimiter'>, 
</span>                                               <a href="parse_cte.c.html#LN909"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="parse_cte.c.html#LN90"><span class='Ref_to_Proto'>checkWellFormedRecursionWalker</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="parse_cte.c.html#LN909"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1521"><span class='Ref_to_Member'>rarg</span></a><span class='Delimiter'>, 
</span>                                               <a href="parse_cte.c.html#LN909"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="parse_cte.c.html#LN909"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN77"><span class='Ref_to_Member'>context</span></a> <span class='Operator'>= </span><a href="parse_cte.c.html#LN911"><span class='Ref_To_Local'>save_context</span></a><span class='Delimiter'>; 
</span>                <a href="parse_cte.c.html#LN90"><span class='Ref_to_Proto'>checkWellFormedRecursionWalker</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="parse_cte.c.html#LN909"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1509"><span class='Ref_to_Member'>sortClause</span></a><span class='Delimiter'>, 
</span>                                               <a href="parse_cte.c.html#LN909"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="parse_cte.c.html#LN90"><span class='Ref_to_Proto'>checkWellFormedRecursionWalker</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="parse_cte.c.html#LN909"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1510"><span class='Ref_to_Member'>limitOffset</span></a><span class='Delimiter'>, 
</span>                                               <a href="parse_cte.c.html#LN909"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="parse_cte.c.html#LN90"><span class='Ref_to_Proto'>checkWellFormedRecursionWalker</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="parse_cte.c.html#LN909"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1511"><span class='Ref_to_Member'>limitCount</span></a><span class='Delimiter'>, 
</span>                                               <a href="parse_cte.c.html#LN909"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="parse_cte.c.html#LN90"><span class='Ref_to_Proto'>checkWellFormedRecursionWalker</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="parse_cte.c.html#LN909"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1512"><span class='Ref_to_Member'>lockingClause</span></a><span class='Delimiter'>, 
</span>                                               <a href="parse_cte.c.html#LN909"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* stmt-&GT;withClause is intentionally ignored here */ 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1475"><span class='Ref_to_EnumConst'>SETOP_EXCEPT</span></a><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_cte.c.html#LN909"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1519"><span class='Ref_to_Member'>all</span></a><span class='Parentheses'>) 
</span>                    <a href="parse_cte.c.html#LN909"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN77"><span class='Ref_to_Member'>context</span></a> <span class='Operator'>= </span><a href="parse_cte.c.html#LN33"><span class='Ref_to_EnumConst'>RECURSION_EXCEPT</span></a><span class='Delimiter'>; 
</span>                <a href="parse_cte.c.html#LN90"><span class='Ref_to_Proto'>checkWellFormedRecursionWalker</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="parse_cte.c.html#LN909"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1520"><span class='Ref_to_Member'>larg</span></a><span class='Delimiter'>, 
</span>                                               <a href="parse_cte.c.html#LN909"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="parse_cte.c.html#LN909"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN77"><span class='Ref_to_Member'>context</span></a> <span class='Operator'>= </span><a href="parse_cte.c.html#LN33"><span class='Ref_to_EnumConst'>RECURSION_EXCEPT</span></a><span class='Delimiter'>; 
</span>                <a href="parse_cte.c.html#LN90"><span class='Ref_to_Proto'>checkWellFormedRecursionWalker</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="parse_cte.c.html#LN909"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1521"><span class='Ref_to_Member'>rarg</span></a><span class='Delimiter'>, 
</span>                                               <a href="parse_cte.c.html#LN909"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="parse_cte.c.html#LN909"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="parse_cte.c.html#LN77"><span class='Ref_to_Member'>context</span></a> <span class='Operator'>= </span><a href="parse_cte.c.html#LN911"><span class='Ref_To_Local'>save_context</span></a><span class='Delimiter'>; 
</span>                <a href="parse_cte.c.html#LN90"><span class='Ref_to_Proto'>checkWellFormedRecursionWalker</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="parse_cte.c.html#LN909"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1509"><span class='Ref_to_Member'>sortClause</span></a><span class='Delimiter'>, 
</span>                                               <a href="parse_cte.c.html#LN909"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="parse_cte.c.html#LN90"><span class='Ref_to_Proto'>checkWellFormedRecursionWalker</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="parse_cte.c.html#LN909"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1510"><span class='Ref_to_Member'>limitOffset</span></a><span class='Delimiter'>, 
</span>                                               <a href="parse_cte.c.html#LN909"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="parse_cte.c.html#LN90"><span class='Ref_to_Proto'>checkWellFormedRecursionWalker</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="parse_cte.c.html#LN909"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1511"><span class='Ref_to_Member'>limitCount</span></a><span class='Delimiter'>, 
</span>                                               <a href="parse_cte.c.html#LN909"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="parse_cte.c.html#LN90"><span class='Ref_to_Proto'>checkWellFormedRecursionWalker</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="parse_cte.c.html#LN909"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1512"><span class='Ref_to_Member'>lockingClause</span></a><span class='Delimiter'>, 
</span>                                               <a href="parse_cte.c.html#LN909"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* stmt-&GT;withClause is intentionally ignored here */ 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized set op: %d"</span><span class='Delimiter'>, 
</span>                     <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="parse_cte.c.html#LN909"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1518"><span class='Ref_to_Member'>op</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch stmt-&GT;op &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end checkWellFormedSelectStmt &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>