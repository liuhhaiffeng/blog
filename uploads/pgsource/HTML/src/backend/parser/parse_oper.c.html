<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\parser\parse_oper.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\parser\parse_oper.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:44 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * parse_oper.c 
 *      handle operator things for parser 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/parser/parse_oper.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span> 
<span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_operator.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"lib/stringinfo.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"nodes/nodeFuncs.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parse_coerce.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parse_func.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parse_oper.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parse_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/inval.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/syscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/typcache.h"</span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * The lookup key for the operator lookaside hash table.  Unused bits must be 
 * zeroes to ensure hashing works consistently --- in particular, oprname 
 * must be zero-padded and any unused entries in search_path must be zero. 
 * 
 * search_path contains the actual search_path with which the entry was 
 * derived (minus temp namespace if any), or else the single specified 
 * schema OID if we are looking up an explicitly-qualified operator name. 
 * 
 * search_path has to be fixed-length since the hashtable code insists on 
 * fixed-size keys.  If your search path is longer than that, we just punt 
 * and don't cache anything. 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* If your search_path is longer than this, sucks to be you ... */ 
</span><a name="LN48"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>MAX_CACHED_PATH_LEN</span>     <span class='Number'>16</span> 
 
<a name="LN50"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>OprCacheKey</span> 
<span class='Delimiter'>{ 
</span><a name="LN52"></a>    <span class='Keyword'>char</span>        <span class='Declare_Member'>oprname</span><span class='Delimiter'>[</span><a href="../../interfaces/ecpg/include/sqlda-native.h.html#LN15"><span class='Ref_to_Const'>NAMEDATALEN</span></a><span class='Delimiter'>]; 
</span><a name="LN53"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>left_arg</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* Left input OID, or 0 if prefix op */ 
</span><a name="LN54"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>right_arg</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* Right input OID, or 0 if postfix op */ 
</span><a name="LN55"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>search_path</span><span class='Delimiter'>[</span><a href="parse_oper.c.html#LN48"><span class='Ref_to_Const'>MAX_CACHED_PATH_LEN</span></a><span class='Delimiter'>]; 
</span><a name="LN56"></a>} <span class='Declare_Typedef'>OprCacheKey</span><span class='Delimiter'>; 
</span> 
<a name="LN58"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>OprCacheEntry</span> 
<span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* the hash lookup key MUST BE FIRST */ 
</span><a name="LN61"></a>    <a href="parse_oper.c.html#LN50"><span class='Ref_to_Struct'>OprCacheKey</span></a> <span class='Declare_Member'>key</span><span class='Delimiter'>; 
</span> 
<a name="LN63"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>opr_oid</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* OID of the resolved operator */ 
</span><a name="LN64"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>OprCacheEntry</span><span class='Delimiter'>; 
</span> 
 
<a name="LN67"></a><span class='Keyword'>static </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>  <span class='Declare_Prototype'>binary_oper_exact</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>opname</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>arg1</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>arg2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN68"></a><span class='Keyword'>static </span><a href="../../include/parser/parse_func.h.html#LN21"><span class='Ref_to_Typedef'>FuncDetailCode</span></a> <span class='Declare_Prototype'>oper_select_candidate</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>nargs</span><span class='Delimiter'>, 
</span><a name="LN69"></a>                      <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>input_typeids</span><span class='Delimiter'>, 
</span><a name="LN70"></a>                      <a href="../../include/catalog/namespace.h.html#LN27"><span class='Ref_to_Typedef'>FuncCandidateList</span></a> <span class='Declare_Parameter'>candidates</span><span class='Delimiter'>, 
</span><a name="LN71"></a>                      <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>operOid</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN72"></a><span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Declare_Prototype'>op_signature_string</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>op</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>oprkind</span><span class='Delimiter'>, 
</span><a name="LN73"></a>                    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>arg1</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>arg2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN74"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>op_error</span><span class='Parentheses'>(</span><a href="../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>op</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>oprkind</span><span class='Delimiter'>, 
</span><a name="LN75"></a>         <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>arg1</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>arg2</span><span class='Delimiter'>, 
</span><a name="LN76"></a>         <a href="../../include/parser/parse_func.h.html#LN21"><span class='Ref_to_Typedef'>FuncDetailCode</span></a> <span class='Declare_Parameter'>fdresult</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>location</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN77"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>make_oper_cache_key</span><span class='Parentheses'>(</span><a href="../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN50"><span class='Ref_to_Struct'>OprCacheKey</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>key</span><span class='Delimiter'>, 
</span><a name="LN78"></a>                    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>opname</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>ltypeId</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>rtypeId</span><span class='Delimiter'>, 
</span><a name="LN79"></a>                    <span class='Keyword'>int </span><span class='Declare_Parameter'>location</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN80"></a><span class='Keyword'>static </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>  <span class='Declare_Prototype'>find_oper_cache_entry</span><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN50"><span class='Ref_to_Struct'>OprCacheKey</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>key</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN81"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>make_oper_cache_entry</span><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN50"><span class='Ref_to_Struct'>OprCacheKey</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>key</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>opr_oid</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN82"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>InvalidateOprCacheCallBack</span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>cacheid</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Parameter'>hashvalue</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * LookupOperName 
 *      Given a possibly-qualified operator name and exact input datatypes, 
 *      look up the operator. 
 * 
 * Pass oprleft = InvalidOid for a prefix op, oprright = InvalidOid for 
 * a postfix op. 
 * 
 * If the operator name is not schema-qualified, it is sought in the current 
 * namespace search path. 
 * 
 * If the operator is not found, we return InvalidOid if noError is true, 
 * else raise an error.  pstate and location are used only to report the 
 * error position; pass NULL/-1 if not available. 
 */ 
</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN101"></a><span class='Declare_Function'>LookupOperName</span><span class='Parentheses'>(</span><a href="../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>opername</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>oprleft</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>oprright</span><span class='Delimiter'>, 
</span><a name="LN102"></a>               <span class='Keyword'>bool </span><span class='Declare_Parameter'>noError</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>location</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN104"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="parse_oper.c.html#LN104"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN77"><span class='Ref_to_Proto'>OpernameGetOprid</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN101"><span class='Ref_to_Parameter'>opername</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN101"><span class='Ref_to_Parameter'>oprleft</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN101"><span class='Ref_to_Parameter'>oprright</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN104"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="parse_oper.c.html#LN104"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* we don't use op_error here because only an exact match is wanted */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="parse_oper.c.html#LN102"><span class='Ref_to_Parameter'>noError</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN113"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>oprkind</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN101"><span class='Ref_to_Parameter'>oprleft</span></a><span class='Parentheses'>))</span> 
            <a href="parse_oper.c.html#LN113"><span class='Ref_To_Local'>oprkind</span></a> <span class='Operator'>= </span><span class='String'>'l'</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN101"><span class='Ref_to_Parameter'>oprright</span></a><span class='Parentheses'>))</span> 
            <a href="parse_oper.c.html#LN113"><span class='Ref_To_Local'>oprkind</span></a> <span class='Operator'>= </span><span class='String'>'r'</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="parse_oper.c.html#LN113"><span class='Ref_To_Local'>oprkind</span></a> <span class='Operator'>= </span><span class='String'>'b'</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_FUNCTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"operator does not exist: %s"</span><span class='Delimiter'>, 
</span>                        <a href="parse_oper.c.html#LN72"><span class='Ref_to_Proto'>op_signature_string</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN101"><span class='Ref_to_Parameter'>opername</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN113"><span class='Ref_To_Local'>oprkind</span></a><span class='Delimiter'>, 
</span>                                            <a href="parse_oper.c.html#LN101"><span class='Ref_to_Parameter'>oprleft</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN101"><span class='Ref_to_Parameter'>oprright</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                 <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN101"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN102"><span class='Ref_to_Parameter'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end LookupOperName &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * LookupOperWithArgs 
 *      Like LookupOperName, but the argument types are specified by 
 *      a ObjectWithArg node. 
 */ 
</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN139"></a><span class='Declare_Function'>LookupOperWithArgs</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1848"><span class='Ref_to_Struct'>ObjectWithArgs</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>oper</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>noError</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN141"></a>    <a href="../../include/nodes/parsenodes.h.html#LN205"><span class='Ref_to_Struct'>TypeName</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>oprleft</span><span class='Delimiter'>, 
</span><a name="LN142"></a>               <span class='Operator'>*</span><span class='Declare_Local'>oprright</span><span class='Delimiter'>; 
</span><a name="LN143"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>leftoid</span><span class='Delimiter'>, 
</span><a name="LN144"></a>                <span class='Declare_Local'>rightoid</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN139"><span class='Ref_to_Parameter'>oper</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1852"><span class='Ref_to_Member'>objargs</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="parse_oper.c.html#LN141"><span class='Ref_To_Local'>oprleft</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN139"><span class='Ref_to_Parameter'>oper</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1852"><span class='Ref_to_Member'>objargs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="parse_oper.c.html#LN142"><span class='Ref_To_Local'>oprright</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN115"><span class='Ref_to_Macro'>lsecond</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN139"><span class='Ref_to_Parameter'>oper</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1852"><span class='Ref_to_Member'>objargs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_oper.c.html#LN141"><span class='Ref_To_Local'>oprleft</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="parse_oper.c.html#LN143"><span class='Ref_To_Local'>leftoid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="parse_oper.c.html#LN143"><span class='Ref_To_Local'>leftoid</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_type.h.html#LN23"><span class='Ref_to_Proto'>LookupTypeNameOid</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN141"><span class='Ref_To_Local'>oprleft</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN139"><span class='Ref_to_Parameter'>noError</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_oper.c.html#LN142"><span class='Ref_To_Local'>oprright</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="parse_oper.c.html#LN144"><span class='Ref_To_Local'>rightoid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="parse_oper.c.html#LN144"><span class='Ref_To_Local'>rightoid</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_type.h.html#LN23"><span class='Ref_to_Proto'>LookupTypeNameOid</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN142"><span class='Ref_To_Local'>oprright</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN139"><span class='Ref_to_Parameter'>noError</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../include/parser/parse_oper.h.html#LN24"><span class='Ref_to_Proto'>LookupOperName</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN139"><span class='Ref_to_Parameter'>oper</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1851"><span class='Ref_to_Member'>objname</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN143"><span class='Ref_To_Local'>leftoid</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN144"><span class='Ref_To_Local'>rightoid</span></a><span class='Delimiter'>, 
</span>                          <a href="parse_oper.c.html#LN139"><span class='Ref_to_Parameter'>noError</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end LookupOperWithArgs &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * get_sort_group_operators - get default sorting/grouping operators for type 
 * 
 * We fetch the "&LT;", "=", and "&GT;" operators all at once to reduce lookup 
 * overhead (knowing that most callers will be interested in at least two). 
 * However, a given datatype might have only an "=" operator, if it is 
 * hashable but not sortable.  (Other combinations of present and missing 
 * operators shouldn't happen, unless the system catalogs are messed up.) 
 * 
 * If an operator is missing and the corresponding needXX flag is true, 
 * throw a standard error message, else return InvalidOid. 
 * 
 * In addition to the operator OIDs themselves, this function can identify 
 * whether the "=" operator is hashable. 
 * 
 * Callers can pass NULL pointers for any results they don't care to get. 
 * 
 * Note: the results are guaranteed to be exact or binary-compatible matches, 
 * since most callers are not prepared to cope with adding any run-time type 
 * coercion steps. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN186"></a><span class='Declare_Function'>get_sort_group_operators</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>argtype</span><span class='Delimiter'>, 
</span><a name="LN187"></a>                         <span class='Keyword'>bool </span><span class='Declare_Parameter'>needLT</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>needEQ</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>needGT</span><span class='Delimiter'>, 
</span><a name="LN188"></a>                         <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ltOpr</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>eqOpr</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>gtOpr</span><span class='Delimiter'>, 
</span><a name="LN189"></a>                         <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>isHashable</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN191"></a>    <a href="../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>typentry</span><span class='Delimiter'>; 
</span><a name="LN192"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>cache_flags</span><span class='Delimiter'>; 
</span><a name="LN193"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>lt_opr</span><span class='Delimiter'>; 
</span><a name="LN194"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>eq_opr</span><span class='Delimiter'>; 
</span><a name="LN195"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>gt_opr</span><span class='Delimiter'>; 
</span><a name="LN196"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>hashable</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Look up the operators using the type cache. 
     * 
     * Note: the search algorithm used by typcache.c ensures that the results 
     * are consistent, ie all from matching opclasses. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_oper.c.html#LN189"><span class='Ref_to_Parameter'>isHashable</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="parse_oper.c.html#LN192"><span class='Ref_To_Local'>cache_flags</span></a> <span class='Operator'>= </span><a href="../../include/utils/typcache.h.html#LN110"><span class='Ref_to_Const'>TYPECACHE_LT_OPR</span></a> <span class='Operator'>| </span><a href="../../include/utils/typcache.h.html#LN109"><span class='Ref_to_Const'>TYPECACHE_EQ_OPR</span></a> <span class='Operator'>| </span><a href="../../include/utils/typcache.h.html#LN111"><span class='Ref_to_Const'>TYPECACHE_GT_OPR</span></a> <span class='Operator'>| 
</span>            <a href="../../include/utils/typcache.h.html#LN113"><span class='Ref_to_Const'>TYPECACHE_HASH_PROC</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="parse_oper.c.html#LN192"><span class='Ref_To_Local'>cache_flags</span></a> <span class='Operator'>= </span><a href="../../include/utils/typcache.h.html#LN110"><span class='Ref_to_Const'>TYPECACHE_LT_OPR</span></a> <span class='Operator'>| </span><a href="../../include/utils/typcache.h.html#LN109"><span class='Ref_to_Const'>TYPECACHE_EQ_OPR</span></a> <span class='Operator'>| </span><a href="../../include/utils/typcache.h.html#LN111"><span class='Ref_to_Const'>TYPECACHE_GT_OPR</span></a><span class='Delimiter'>; 
</span> 
    <a href="parse_oper.c.html#LN191"><span class='Ref_To_Local'>typentry</span></a> <span class='Operator'>= </span><a href="../../include/utils/typcache.h.html#LN142"><span class='Ref_to_Proto'>lookup_type_cache</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN186"><span class='Ref_to_Parameter'>argtype</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN192"><span class='Ref_To_Local'>cache_flags</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="parse_oper.c.html#LN193"><span class='Ref_To_Local'>lt_opr</span></a> <span class='Operator'>= </span><a href="parse_oper.c.html#LN191"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/typcache.h.html#LN54"><span class='Ref_to_Member'>lt_opr</span></a><span class='Delimiter'>; 
</span>    <a href="parse_oper.c.html#LN194"><span class='Ref_To_Local'>eq_opr</span></a> <span class='Operator'>= </span><a href="parse_oper.c.html#LN191"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/typcache.h.html#LN53"><span class='Ref_to_Member'>eq_opr</span></a><span class='Delimiter'>; 
</span>    <a href="parse_oper.c.html#LN195"><span class='Ref_To_Local'>gt_opr</span></a> <span class='Operator'>= </span><a href="parse_oper.c.html#LN191"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/typcache.h.html#LN55"><span class='Ref_to_Member'>gt_opr</span></a><span class='Delimiter'>; 
</span>    <a href="parse_oper.c.html#LN196"><span class='Ref_To_Local'>hashable</span></a> <span class='Operator'>= </span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN191"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/typcache.h.html#LN57"><span class='Ref_to_Member'>hash_proc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Report errors if needed */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="parse_oper.c.html#LN187"><span class='Ref_to_Parameter'>needLT</span></a> <span class='Operator'>&& !</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN193"><span class='Ref_To_Local'>lt_opr</span></a><span class='Parentheses'>))</span> <span class='Operator'>|| 
</span>        <span class='Parentheses'>(</span><a href="parse_oper.c.html#LN187"><span class='Ref_to_Parameter'>needGT</span></a> <span class='Operator'>&& !</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN195"><span class='Ref_To_Local'>gt_opr</span></a><span class='Parentheses'>)))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_FUNCTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not identify an ordering operator for type %s"</span><span class='Delimiter'>, 
</span>                        <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN186"><span class='Ref_to_Parameter'>argtype</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>         <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Use an explicit ordering operator or modify the query."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_oper.c.html#LN187"><span class='Ref_to_Parameter'>needEQ</span></a> <span class='Operator'>&& !</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN194"><span class='Ref_To_Local'>eq_opr</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_FUNCTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not identify an equality operator for type %s"</span><span class='Delimiter'>, 
</span>                        <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN186"><span class='Ref_to_Parameter'>argtype</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Return results as needed */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_oper.c.html#LN188"><span class='Ref_to_Parameter'>ltOpr</span></a><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="parse_oper.c.html#LN188"><span class='Ref_to_Parameter'>ltOpr</span></a> <span class='Operator'>= </span><a href="parse_oper.c.html#LN193"><span class='Ref_To_Local'>lt_opr</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_oper.c.html#LN188"><span class='Ref_to_Parameter'>eqOpr</span></a><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="parse_oper.c.html#LN188"><span class='Ref_to_Parameter'>eqOpr</span></a> <span class='Operator'>= </span><a href="parse_oper.c.html#LN194"><span class='Ref_To_Local'>eq_opr</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_oper.c.html#LN188"><span class='Ref_to_Parameter'>gtOpr</span></a><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="parse_oper.c.html#LN188"><span class='Ref_to_Parameter'>gtOpr</span></a> <span class='Operator'>= </span><a href="parse_oper.c.html#LN195"><span class='Ref_To_Local'>gt_opr</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_oper.c.html#LN189"><span class='Ref_to_Parameter'>isHashable</span></a><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="parse_oper.c.html#LN189"><span class='Ref_to_Parameter'>isHashable</span></a> <span class='Operator'>= </span><a href="parse_oper.c.html#LN196"><span class='Ref_To_Local'>hashable</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_sort_group_operators &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* given operator tuple, return the operator OID */ 
</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN244"></a><span class='Declare_Function'>oprid</span><span class='Parentheses'>(</span><a href="../../include/parser/parse_oper.h.html#LN21"><span class='Ref_to_Typedef'>Operator</span></a> <span class='Declare_Parameter'>op</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN244"><span class='Ref_to_Parameter'>op</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* given operator tuple, return the underlying function's OID */ 
</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN251"></a><span class='Declare_Function'>oprfuncid</span><span class='Parentheses'>(</span><a href="../../include/parser/parse_oper.h.html#LN21"><span class='Ref_to_Typedef'>Operator</span></a> <span class='Declare_Parameter'>op</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN253"></a>    <a href="../../include/catalog/pg_operator.h.html#LN56"><span class='Ref_to_Typedef'>Form_pg_operator</span></a> <span class='Declare_Local'>pgopform</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_operator.h.html#LN56"><span class='Ref_to_Typedef'>Form_pg_operator</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN251"><span class='Ref_to_Parameter'>op</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="parse_oper.c.html#LN253"><span class='Ref_To_Local'>pgopform</span></a><span class='Operator'>-&GT;</span>oprcode<span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* binary_oper_exact() 
 * Check for an "exact" match to the specified operand types. 
 * 
 * If one operand is an unknown literal, assume it should be taken to be 
 * the same type as the other operand for this purpose.  Also, consider 
 * the possibility that the other operand is a domain type that needs to 
 * be reduced to its base type to find an "exact" match. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN268"></a><span class='Declare_Function'>binary_oper_exact</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>opname</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>arg1</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>arg2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN270"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN271"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>was_unknown</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Unspecified type for one of the arguments? then use the other */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="parse_oper.c.html#LN268"><span class='Ref_to_Parameter'>arg1</span></a> <span class='Operator'>== </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN43"><span class='Ref_to_Const'>UNKNOWNOID</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN268"><span class='Ref_to_Parameter'>arg2</span></a> <span class='Operator'>!= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="parse_oper.c.html#LN268"><span class='Ref_to_Parameter'>arg1</span></a> <span class='Operator'>= </span><a href="parse_oper.c.html#LN268"><span class='Ref_to_Parameter'>arg2</span></a><span class='Delimiter'>; 
</span>        <a href="parse_oper.c.html#LN271"><span class='Ref_To_Local'>was_unknown</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="parse_oper.c.html#LN268"><span class='Ref_to_Parameter'>arg2</span></a> <span class='Operator'>== </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN43"><span class='Ref_to_Const'>UNKNOWNOID</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN268"><span class='Ref_to_Parameter'>arg1</span></a> <span class='Operator'>!= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="parse_oper.c.html#LN268"><span class='Ref_to_Parameter'>arg2</span></a> <span class='Operator'>= </span><a href="parse_oper.c.html#LN268"><span class='Ref_to_Parameter'>arg1</span></a><span class='Delimiter'>; 
</span>        <a href="parse_oper.c.html#LN271"><span class='Ref_To_Local'>was_unknown</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="parse_oper.c.html#LN270"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN77"><span class='Ref_to_Proto'>OpernameGetOprid</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN268"><span class='Ref_to_Parameter'>opname</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN268"><span class='Ref_to_Parameter'>arg1</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN268"><span class='Ref_to_Parameter'>arg2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN270"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="parse_oper.c.html#LN270"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_oper.c.html#LN271"><span class='Ref_To_Local'>was_unknown</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* arg1 and arg2 are the same here, need only look at arg1 */ 
</span><a name="LN292"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>basetype</span> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN168"><span class='Ref_to_Proto'>getBaseType</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN268"><span class='Ref_to_Parameter'>arg1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_oper.c.html#LN292"><span class='Ref_To_Local'>basetype</span></a> <span class='Operator'>!= </span><a href="parse_oper.c.html#LN268"><span class='Ref_to_Parameter'>arg1</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="parse_oper.c.html#LN270"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN77"><span class='Ref_to_Proto'>OpernameGetOprid</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN268"><span class='Ref_to_Parameter'>opname</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN292"><span class='Ref_To_Local'>basetype</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN292"><span class='Ref_To_Local'>basetype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN270"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <a href="parse_oper.c.html#LN270"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end binary_oper_exact &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* oper_select_candidate() 
 *      Given the input argtype array and one or more candidates 
 *      for the operator, attempt to resolve the conflict. 
 * 
 * Returns FUNCDETAIL_NOTFOUND, FUNCDETAIL_MULTIPLE, or FUNCDETAIL_NORMAL. 
 * In the success case the Oid of the best candidate is stored in *operOid. 
 * 
 * Note that the caller has already determined that there is no candidate 
 * exactly matching the input argtype(s).  Incompatible candidates are not yet 
 * pruned away, however. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/parser/parse_func.h.html#LN21"><span class='Ref_to_Typedef'>FuncDetailCode</span></a> 
<a name="LN318"></a><span class='Declare_Function'>oper_select_candidate</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>nargs</span><span class='Delimiter'>, 
</span><a name="LN319"></a>                      <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>input_typeids</span><span class='Delimiter'>, 
</span><a name="LN320"></a>                      <a href="../../include/catalog/namespace.h.html#LN27"><span class='Ref_to_Typedef'>FuncCandidateList</span></a> <span class='Declare_Parameter'>candidates</span><span class='Delimiter'>, 
</span><a name="LN321"></a>                      <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>operOid</span><span class='Parentheses'>)</span>     <span class='Comment_Single_Line'>/* output argument */ 
</span><span class='Delimiter'>{ 
</span><a name="LN323"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ncandidates</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Delete any candidates that cannot actually accept the given input 
     * types, whether directly or by coercion. 
     */ 
</span>    <a href="parse_oper.c.html#LN323"><span class='Ref_To_Local'>ncandidates</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_func.h.html#LN43"><span class='Ref_to_Proto'>func_match_argtypes</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN318"><span class='Ref_to_Parameter'>nargs</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN319"><span class='Ref_to_Parameter'>input_typeids</span></a><span class='Delimiter'>, 
</span>                                      <a href="parse_oper.c.html#LN320"><span class='Ref_to_Parameter'>candidates</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="parse_oper.c.html#LN320"><span class='Ref_to_Parameter'>candidates</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Done if no candidate or only one candidate survives */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_oper.c.html#LN323"><span class='Ref_To_Local'>ncandidates</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="parse_oper.c.html#LN321"><span class='Ref_to_Parameter'>operOid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="../../include/parser/parse_func.h.html#LN23"><span class='Ref_to_EnumConst'>FUNCDETAIL_NOTFOUND</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_oper.c.html#LN323"><span class='Ref_To_Local'>ncandidates</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="parse_oper.c.html#LN321"><span class='Ref_to_Parameter'>operOid</span></a> <span class='Operator'>= </span><a href="parse_oper.c.html#LN320"><span class='Ref_to_Parameter'>candidates</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/namespace.h.html#LN31"><span class='Ref_to_Member'>oid</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="../../include/parser/parse_func.h.html#LN25"><span class='Ref_to_EnumConst'>FUNCDETAIL_NORMAL</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Use the same heuristics as for ambiguous functions to resolve the 
     * conflict. 
     */ 
</span>    <a href="parse_oper.c.html#LN320"><span class='Ref_to_Parameter'>candidates</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_func.h.html#LN48"><span class='Ref_to_Proto'>func_select_candidate</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN318"><span class='Ref_to_Parameter'>nargs</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN319"><span class='Ref_to_Parameter'>input_typeids</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN320"><span class='Ref_to_Parameter'>candidates</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_oper.c.html#LN320"><span class='Ref_to_Parameter'>candidates</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="parse_oper.c.html#LN321"><span class='Ref_to_Parameter'>operOid</span></a> <span class='Operator'>= </span><a href="parse_oper.c.html#LN320"><span class='Ref_to_Parameter'>candidates</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/namespace.h.html#LN31"><span class='Ref_to_Member'>oid</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="../../include/parser/parse_func.h.html#LN25"><span class='Ref_to_EnumConst'>FUNCDETAIL_NORMAL</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Operator'>*</span><a href="parse_oper.c.html#LN321"><span class='Ref_to_Parameter'>operOid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="../../include/parser/parse_func.h.html#LN24"><span class='Ref_to_EnumConst'>FUNCDETAIL_MULTIPLE</span></a><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* failed to select a best candidate */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end oper_select_candidate &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* oper() -- search for a binary operator 
 * Given operator name, types of arg1 and arg2, return oper struct. 
 * 
 * IMPORTANT: the returned operator (if any) is only promised to be 
 * coercion-compatible with the input datatypes.  Do not use this if 
 * you need an exact- or binary-compatible match; see compatible_oper. 
 * 
 * If no matching operator found, return NULL if noError is true, 
 * raise an error if it is false.  pstate and location are used only to report 
 * the error position; pass NULL/-1 if not available. 
 * 
 * NOTE: on success, the returned object is a syscache entry.  The caller 
 * must ReleaseSysCache() the entry when done with it. 
 */ 
</span><a href="../../include/parser/parse_oper.h.html#LN21"><span class='Ref_to_Typedef'>Operator</span></a> 
<a name="LN376"></a><span class='Declare_Function'>oper</span><span class='Parentheses'>(</span><a href="../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>opname</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>ltypeId</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>rtypeId</span><span class='Delimiter'>, 
</span><a name="LN377"></a>     <span class='Keyword'>bool </span><span class='Declare_Parameter'>noError</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>location</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN379"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>operOid</span><span class='Delimiter'>; 
</span><a name="LN380"></a>    <a href="parse_oper.c.html#LN50"><span class='Ref_to_Struct'>OprCacheKey</span></a> <span class='Declare_Local'>key</span><span class='Delimiter'>; 
</span><a name="LN381"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>key_ok</span><span class='Delimiter'>; 
</span><a name="LN382"></a>    <a href="../../include/parser/parse_func.h.html#LN21"><span class='Ref_to_Typedef'>FuncDetailCode</span></a> <span class='Declare_Local'>fdresult</span> <span class='Operator'>= </span><a href="../../include/parser/parse_func.h.html#LN23"><span class='Ref_to_EnumConst'>FUNCDETAIL_NOTFOUND</span></a><span class='Delimiter'>; 
</span><a name="LN383"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Try to find the mapping in the lookaside cache. 
     */ 
</span>    <a href="parse_oper.c.html#LN381"><span class='Ref_To_Local'>key_ok</span></a> <span class='Operator'>= </span><a href="parse_oper.c.html#LN77"><span class='Ref_to_Proto'>make_oper_cache_key</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN376"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="parse_oper.c.html#LN380"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN376"><span class='Ref_to_Parameter'>opname</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN376"><span class='Ref_to_Parameter'>ltypeId</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN376"><span class='Ref_to_Parameter'>rtypeId</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN377"><span class='Ref_to_Parameter'>location</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_oper.c.html#LN381"><span class='Ref_To_Local'>key_ok</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="parse_oper.c.html#LN379"><span class='Ref_To_Local'>operOid</span></a> <span class='Operator'>= </span><a href="parse_oper.c.html#LN80"><span class='Ref_to_Proto'>find_oper_cache_entry</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="parse_oper.c.html#LN380"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN379"><span class='Ref_To_Local'>operOid</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="parse_oper.c.html#LN383"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN71"><span class='Ref_to_EnumConst'>OPEROID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN379"><span class='Ref_To_Local'>operOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN383"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../include/parser/parse_oper.h.html#LN21"><span class='Ref_to_Typedef'>Operator</span></a><span class='Parentheses'>) </span><a href="parse_oper.c.html#LN383"><span class='Ref_To_Local'>tup</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * First try for an "exact" match. 
     */ 
</span>    <a href="parse_oper.c.html#LN379"><span class='Ref_To_Local'>operOid</span></a> <span class='Operator'>= </span><a href="parse_oper.c.html#LN67"><span class='Ref_to_Proto'>binary_oper_exact</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN376"><span class='Ref_to_Parameter'>opname</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN376"><span class='Ref_to_Parameter'>ltypeId</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN376"><span class='Ref_to_Parameter'>rtypeId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN379"><span class='Ref_To_Local'>operOid</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Otherwise, search for the most suitable candidate. 
         */ 
</span><a name="LN410"></a>        <a href="../../include/catalog/namespace.h.html#LN27"><span class='Ref_to_Typedef'>FuncCandidateList</span></a> <span class='Declare_Local'>clist</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Get binary operators of given name */ 
</span>        <a href="parse_oper.c.html#LN410"><span class='Ref_To_Local'>clist</span></a> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN78"><span class='Ref_to_Proto'>OpernameGetCandidates</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN376"><span class='Ref_to_Parameter'>opname</span></a><span class='Delimiter'>, </span><span class='String'>'b'</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* No operators found? Then fail... */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_oper.c.html#LN410"><span class='Ref_To_Local'>clist</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Unspecified type for one of the arguments? then use the other 
             * (XXX this is probably dead code?) 
             */ 
</span><a name="LN422"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>inputOids</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_oper.c.html#LN376"><span class='Ref_to_Parameter'>rtypeId</span></a> <span class='Operator'>== </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>                <a href="parse_oper.c.html#LN376"><span class='Ref_to_Parameter'>rtypeId</span></a> <span class='Operator'>= </span><a href="parse_oper.c.html#LN376"><span class='Ref_to_Parameter'>ltypeId</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_oper.c.html#LN376"><span class='Ref_to_Parameter'>ltypeId</span></a> <span class='Operator'>== </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>                <a href="parse_oper.c.html#LN376"><span class='Ref_to_Parameter'>ltypeId</span></a> <span class='Operator'>= </span><a href="parse_oper.c.html#LN376"><span class='Ref_to_Parameter'>rtypeId</span></a><span class='Delimiter'>; 
</span>            <a href="parse_oper.c.html#LN422"><span class='Ref_To_Local'>inputOids</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="parse_oper.c.html#LN376"><span class='Ref_to_Parameter'>ltypeId</span></a><span class='Delimiter'>; 
</span>            <a href="parse_oper.c.html#LN422"><span class='Ref_To_Local'>inputOids</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="parse_oper.c.html#LN376"><span class='Ref_to_Parameter'>rtypeId</span></a><span class='Delimiter'>; 
</span>            <a href="parse_oper.c.html#LN382"><span class='Ref_To_Local'>fdresult</span></a> <span class='Operator'>= </span><a href="parse_oper.c.html#LN68"><span class='Ref_to_Proto'>oper_select_candidate</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN422"><span class='Ref_To_Local'>inputOids</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN410"><span class='Ref_To_Local'>clist</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="parse_oper.c.html#LN379"><span class='Ref_To_Local'>operOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !OidIsValid(operOid) &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN379"><span class='Ref_To_Local'>operOid</span></a><span class='Parentheses'>))</span> 
        <a href="parse_oper.c.html#LN383"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN71"><span class='Ref_to_EnumConst'>OPEROID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN379"><span class='Ref_To_Local'>operOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN383"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_oper.c.html#LN381"><span class='Ref_To_Local'>key_ok</span></a><span class='Parentheses'>) 
</span>            <a href="parse_oper.c.html#LN81"><span class='Ref_to_Proto'>make_oper_cache_entry</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="parse_oper.c.html#LN380"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN379"><span class='Ref_To_Local'>operOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="parse_oper.c.html#LN377"><span class='Ref_to_Parameter'>noError</span></a><span class='Parentheses'>) 
</span>        <a href="parse_oper.c.html#LN74"><span class='Ref_to_Proto'>op_error</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN376"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN376"><span class='Ref_to_Parameter'>opname</span></a><span class='Delimiter'>, </span><span class='String'>'b'</span><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN376"><span class='Ref_to_Parameter'>ltypeId</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN376"><span class='Ref_to_Parameter'>rtypeId</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN382"><span class='Ref_To_Local'>fdresult</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN377"><span class='Ref_to_Parameter'>location</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../include/parser/parse_oper.h.html#LN21"><span class='Ref_to_Typedef'>Operator</span></a><span class='Parentheses'>) </span><a href="parse_oper.c.html#LN383"><span class='Ref_To_Local'>tup</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end oper &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* compatible_oper() 
 *  given an opname and input datatypes, find a compatible binary operator 
 * 
 *  This is tighter than oper() because it will not return an operator that 
 *  requires coercion of the input datatypes (but binary-compatible operators 
 *  are accepted).  Otherwise, the semantics are the same. 
 */ 
</span><a href="../../include/parser/parse_oper.h.html#LN21"><span class='Ref_to_Typedef'>Operator</span></a> 
<a name="LN456"></a><span class='Declare_Function'>compatible_oper</span><span class='Parentheses'>(</span><a href="../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>op</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>arg1</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>arg2</span><span class='Delimiter'>, 
</span><a name="LN457"></a>                <span class='Keyword'>bool </span><span class='Declare_Parameter'>noError</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>location</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN459"></a>    <a href="../../include/parser/parse_oper.h.html#LN21"><span class='Ref_to_Typedef'>Operator</span></a>    <span class='Declare_Local'>optup</span><span class='Delimiter'>; 
</span><a name="LN460"></a>    <a href="../../include/catalog/pg_operator.h.html#LN56"><span class='Ref_to_Typedef'>Form_pg_operator</span></a> <span class='Declare_Local'>opform</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* oper() will find the best available match */ 
</span>    <a href="parse_oper.c.html#LN459"><span class='Ref_To_Local'>optup</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_oper.h.html#LN31"><span class='Ref_to_Proto'>oper</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN456"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN456"><span class='Ref_to_Parameter'>op</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN456"><span class='Ref_to_Parameter'>arg1</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN456"><span class='Ref_to_Parameter'>arg2</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN457"><span class='Ref_to_Parameter'>noError</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN457"><span class='Ref_to_Parameter'>location</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_oper.c.html#LN459"><span class='Ref_To_Local'>optup</span></a> <span class='Operator'>== </span><span class='Parentheses'>(</span><a href="../../include/parser/parse_oper.h.html#LN21"><span class='Ref_to_Typedef'>Operator</span></a><span class='Parentheses'>) </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../include/parser/parse_oper.h.html#LN21"><span class='Ref_to_Typedef'>Operator</span></a><span class='Parentheses'>) </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* must be noError case */ 
</span> 
    <span class='Comment_Multi_Line'>/* but is it good enough? */ 
</span>    <a href="parse_oper.c.html#LN460"><span class='Ref_To_Local'>opform</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_operator.h.html#LN56"><span class='Ref_to_Typedef'>Form_pg_operator</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN459"><span class='Ref_To_Local'>optup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/parser/parse_coerce.h.html#LN33"><span class='Ref_to_Proto'>IsBinaryCoercible</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN456"><span class='Ref_to_Parameter'>arg1</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN460"><span class='Ref_To_Local'>opform</span></a><span class='Operator'>-&GT;</span>oprleft<span class='Parentheses'>) </span><span class='Operator'>&& 
</span>        <a href="../../include/parser/parse_coerce.h.html#LN33"><span class='Ref_to_Proto'>IsBinaryCoercible</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN456"><span class='Ref_to_Parameter'>arg2</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN460"><span class='Ref_To_Local'>opform</span></a><span class='Operator'>-&GT;</span>oprright<span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="parse_oper.c.html#LN459"><span class='Ref_To_Local'>optup</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* nope... */ 
</span>    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN459"><span class='Ref_To_Local'>optup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="parse_oper.c.html#LN457"><span class='Ref_to_Parameter'>noError</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_FUNCTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"operator requires run-time type coercion: %s"</span><span class='Delimiter'>, 
</span>                        <a href="parse_oper.c.html#LN72"><span class='Ref_to_Proto'>op_signature_string</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN456"><span class='Ref_to_Parameter'>op</span></a><span class='Delimiter'>, </span><span class='String'>'b'</span><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN456"><span class='Ref_to_Parameter'>arg1</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN456"><span class='Ref_to_Parameter'>arg2</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                 <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN456"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN457"><span class='Ref_to_Parameter'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../include/parser/parse_oper.h.html#LN21"><span class='Ref_to_Typedef'>Operator</span></a><span class='Parentheses'>) </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end compatible_oper &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* compatible_oper_opid() -- get OID of a binary operator 
 * 
 * This is a convenience routine that extracts only the operator OID 
 * from the result of compatible_oper().  InvalidOid is returned if the 
 * lookup fails and noError is true. 
 */ 
</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN493"></a><span class='Declare_Function'>compatible_oper_opid</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>op</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>arg1</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>arg2</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>noError</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN495"></a>    <a href="../../include/parser/parse_oper.h.html#LN21"><span class='Ref_to_Typedef'>Operator</span></a>    <span class='Declare_Local'>optup</span><span class='Delimiter'>; 
</span><a name="LN496"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="parse_oper.c.html#LN495"><span class='Ref_To_Local'>optup</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_oper.h.html#LN40"><span class='Ref_to_Proto'>compatible_oper</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN493"><span class='Ref_to_Parameter'>op</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN493"><span class='Ref_to_Parameter'>arg1</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN493"><span class='Ref_to_Parameter'>arg2</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN493"><span class='Ref_to_Parameter'>noError</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_oper.c.html#LN495"><span class='Ref_To_Local'>optup</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="parse_oper.c.html#LN496"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_oper.h.html#LN56"><span class='Ref_to_Proto'>oprid</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN495"><span class='Ref_To_Local'>optup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN495"><span class='Ref_To_Local'>optup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="parse_oper.c.html#LN496"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* right_oper() -- search for a unary right operator (postfix operator) 
 * Given operator name and type of arg, return oper struct. 
 * 
 * IMPORTANT: the returned operator (if any) is only promised to be 
 * coercion-compatible with the input datatype.  Do not use this if 
 * you need an exact- or binary-compatible match. 
 * 
 * If no matching operator found, return NULL if noError is true, 
 * raise an error if it is false.  pstate and location are used only to report 
 * the error position; pass NULL/-1 if not available. 
 * 
 * NOTE: on success, the returned object is a syscache entry.  The caller 
 * must ReleaseSysCache() the entry when done with it. 
 */ 
</span><a href="../../include/parser/parse_oper.h.html#LN21"><span class='Ref_to_Typedef'>Operator</span></a> 
<a name="LN524"></a><span class='Declare_Function'>right_oper</span><span class='Parentheses'>(</span><a href="../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>op</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>noError</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>location</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN526"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>operOid</span><span class='Delimiter'>; 
</span><a name="LN527"></a>    <a href="parse_oper.c.html#LN50"><span class='Ref_to_Struct'>OprCacheKey</span></a> <span class='Declare_Local'>key</span><span class='Delimiter'>; 
</span><a name="LN528"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>key_ok</span><span class='Delimiter'>; 
</span><a name="LN529"></a>    <a href="../../include/parser/parse_func.h.html#LN21"><span class='Ref_to_Typedef'>FuncDetailCode</span></a> <span class='Declare_Local'>fdresult</span> <span class='Operator'>= </span><a href="../../include/parser/parse_func.h.html#LN23"><span class='Ref_to_EnumConst'>FUNCDETAIL_NOTFOUND</span></a><span class='Delimiter'>; 
</span><a name="LN530"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Try to find the mapping in the lookaside cache. 
     */ 
</span>    <a href="parse_oper.c.html#LN528"><span class='Ref_To_Local'>key_ok</span></a> <span class='Operator'>= </span><a href="parse_oper.c.html#LN77"><span class='Ref_to_Proto'>make_oper_cache_key</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN524"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="parse_oper.c.html#LN527"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN524"><span class='Ref_to_Parameter'>op</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN524"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN524"><span class='Ref_to_Parameter'>location</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_oper.c.html#LN528"><span class='Ref_To_Local'>key_ok</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="parse_oper.c.html#LN526"><span class='Ref_To_Local'>operOid</span></a> <span class='Operator'>= </span><a href="parse_oper.c.html#LN80"><span class='Ref_to_Proto'>find_oper_cache_entry</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="parse_oper.c.html#LN527"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN526"><span class='Ref_To_Local'>operOid</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="parse_oper.c.html#LN530"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN71"><span class='Ref_to_EnumConst'>OPEROID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN526"><span class='Ref_To_Local'>operOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN530"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../include/parser/parse_oper.h.html#LN21"><span class='Ref_to_Typedef'>Operator</span></a><span class='Parentheses'>) </span><a href="parse_oper.c.html#LN530"><span class='Ref_To_Local'>tup</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * First try for an "exact" match. 
     */ 
</span>    <a href="parse_oper.c.html#LN526"><span class='Ref_To_Local'>operOid</span></a> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN77"><span class='Ref_to_Proto'>OpernameGetOprid</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN524"><span class='Ref_to_Parameter'>op</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN524"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN526"><span class='Ref_To_Local'>operOid</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Otherwise, search for the most suitable candidate. 
         */ 
</span><a name="LN557"></a>        <a href="../../include/catalog/namespace.h.html#LN27"><span class='Ref_to_Typedef'>FuncCandidateList</span></a> <span class='Declare_Local'>clist</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Get postfix operators of given name */ 
</span>        <a href="parse_oper.c.html#LN557"><span class='Ref_To_Local'>clist</span></a> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN78"><span class='Ref_to_Proto'>OpernameGetCandidates</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN524"><span class='Ref_to_Parameter'>op</span></a><span class='Delimiter'>, </span><span class='String'>'r'</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* No operators found? Then fail... */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_oper.c.html#LN557"><span class='Ref_To_Local'>clist</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * We must run oper_select_candidate even if only one candidate, 
             * otherwise we may falsely return a non-type-compatible operator. 
             */ 
</span>            <a href="parse_oper.c.html#LN529"><span class='Ref_To_Local'>fdresult</span></a> <span class='Operator'>= </span><a href="parse_oper.c.html#LN68"><span class='Ref_to_Proto'>oper_select_candidate</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="parse_oper.c.html#LN524"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN557"><span class='Ref_To_Local'>clist</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="parse_oper.c.html#LN526"><span class='Ref_To_Local'>operOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !OidIsValid(operOid) &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN526"><span class='Ref_To_Local'>operOid</span></a><span class='Parentheses'>))</span> 
        <a href="parse_oper.c.html#LN530"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN71"><span class='Ref_to_EnumConst'>OPEROID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN526"><span class='Ref_To_Local'>operOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN530"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_oper.c.html#LN528"><span class='Ref_To_Local'>key_ok</span></a><span class='Parentheses'>) 
</span>            <a href="parse_oper.c.html#LN81"><span class='Ref_to_Proto'>make_oper_cache_entry</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="parse_oper.c.html#LN527"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN526"><span class='Ref_To_Local'>operOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="parse_oper.c.html#LN524"><span class='Ref_to_Parameter'>noError</span></a><span class='Parentheses'>) 
</span>        <a href="parse_oper.c.html#LN74"><span class='Ref_to_Proto'>op_error</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN524"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN524"><span class='Ref_to_Parameter'>op</span></a><span class='Delimiter'>, </span><span class='String'>'r'</span><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN524"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN529"><span class='Ref_To_Local'>fdresult</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN524"><span class='Ref_to_Parameter'>location</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../include/parser/parse_oper.h.html#LN21"><span class='Ref_to_Typedef'>Operator</span></a><span class='Parentheses'>) </span><a href="parse_oper.c.html#LN530"><span class='Ref_To_Local'>tup</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end right_oper &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* left_oper() -- search for a unary left operator (prefix operator) 
 * Given operator name and type of arg, return oper struct. 
 * 
 * IMPORTANT: the returned operator (if any) is only promised to be 
 * coercion-compatible with the input datatype.  Do not use this if 
 * you need an exact- or binary-compatible match. 
 * 
 * If no matching operator found, return NULL if noError is true, 
 * raise an error if it is false.  pstate and location are used only to report 
 * the error position; pass NULL/-1 if not available. 
 * 
 * NOTE: on success, the returned object is a syscache entry.  The caller 
 * must ReleaseSysCache() the entry when done with it. 
 */ 
</span><a href="../../include/parser/parse_oper.h.html#LN21"><span class='Ref_to_Typedef'>Operator</span></a> 
<a name="LN603"></a><span class='Declare_Function'>left_oper</span><span class='Parentheses'>(</span><a href="../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>op</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>noError</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>location</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN605"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>operOid</span><span class='Delimiter'>; 
</span><a name="LN606"></a>    <a href="parse_oper.c.html#LN50"><span class='Ref_to_Struct'>OprCacheKey</span></a> <span class='Declare_Local'>key</span><span class='Delimiter'>; 
</span><a name="LN607"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>key_ok</span><span class='Delimiter'>; 
</span><a name="LN608"></a>    <a href="../../include/parser/parse_func.h.html#LN21"><span class='Ref_to_Typedef'>FuncDetailCode</span></a> <span class='Declare_Local'>fdresult</span> <span class='Operator'>= </span><a href="../../include/parser/parse_func.h.html#LN23"><span class='Ref_to_EnumConst'>FUNCDETAIL_NOTFOUND</span></a><span class='Delimiter'>; 
</span><a name="LN609"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Try to find the mapping in the lookaside cache. 
     */ 
</span>    <a href="parse_oper.c.html#LN607"><span class='Ref_To_Local'>key_ok</span></a> <span class='Operator'>= </span><a href="parse_oper.c.html#LN77"><span class='Ref_to_Proto'>make_oper_cache_key</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN603"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="parse_oper.c.html#LN606"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN603"><span class='Ref_to_Parameter'>op</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN603"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN603"><span class='Ref_to_Parameter'>location</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_oper.c.html#LN607"><span class='Ref_To_Local'>key_ok</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="parse_oper.c.html#LN605"><span class='Ref_To_Local'>operOid</span></a> <span class='Operator'>= </span><a href="parse_oper.c.html#LN80"><span class='Ref_to_Proto'>find_oper_cache_entry</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="parse_oper.c.html#LN606"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN605"><span class='Ref_To_Local'>operOid</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="parse_oper.c.html#LN609"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN71"><span class='Ref_to_EnumConst'>OPEROID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN605"><span class='Ref_To_Local'>operOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN609"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../include/parser/parse_oper.h.html#LN21"><span class='Ref_to_Typedef'>Operator</span></a><span class='Parentheses'>) </span><a href="parse_oper.c.html#LN609"><span class='Ref_To_Local'>tup</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * First try for an "exact" match. 
     */ 
</span>    <a href="parse_oper.c.html#LN605"><span class='Ref_To_Local'>operOid</span></a> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN77"><span class='Ref_to_Proto'>OpernameGetOprid</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN603"><span class='Ref_to_Parameter'>op</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN603"><span class='Ref_to_Parameter'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN605"><span class='Ref_To_Local'>operOid</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Otherwise, search for the most suitable candidate. 
         */ 
</span><a name="LN636"></a>        <a href="../../include/catalog/namespace.h.html#LN27"><span class='Ref_to_Typedef'>FuncCandidateList</span></a> <span class='Declare_Local'>clist</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Get prefix operators of given name */ 
</span>        <a href="parse_oper.c.html#LN636"><span class='Ref_To_Local'>clist</span></a> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN78"><span class='Ref_to_Proto'>OpernameGetCandidates</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN603"><span class='Ref_to_Parameter'>op</span></a><span class='Delimiter'>, </span><span class='String'>'l'</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* No operators found? Then fail... */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_oper.c.html#LN636"><span class='Ref_To_Local'>clist</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * The returned list has args in the form (0, oprright). Move the 
             * useful data into args[0] to keep oper_select_candidate simple. 
             * XXX we are assuming here that we may scribble on the list! 
             */ 
</span><a name="LN649"></a>            <a href="../../include/catalog/namespace.h.html#LN27"><span class='Ref_to_Typedef'>FuncCandidateList</span></a> <span class='Declare_Local'>clisti</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="parse_oper.c.html#LN649"><span class='Ref_To_Local'>clisti</span></a> <span class='Operator'>= </span><a href="parse_oper.c.html#LN636"><span class='Ref_To_Local'>clist</span></a><span class='Delimiter'>; </span><a href="parse_oper.c.html#LN649"><span class='Ref_To_Local'>clisti</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><a href="parse_oper.c.html#LN649"><span class='Ref_To_Local'>clisti</span></a> <span class='Operator'>= </span><a href="parse_oper.c.html#LN649"><span class='Ref_To_Local'>clisti</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/namespace.h.html#LN29"><span class='Ref_to_Member'>next</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="parse_oper.c.html#LN649"><span class='Ref_To_Local'>clisti</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/namespace.h.html#LN36"><span class='Ref_to_Member'>args</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="parse_oper.c.html#LN649"><span class='Ref_To_Local'>clisti</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/namespace.h.html#LN36"><span class='Ref_to_Member'>args</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * We must run oper_select_candidate even if only one candidate, 
             * otherwise we may falsely return a non-type-compatible operator. 
             */ 
</span>            <a href="parse_oper.c.html#LN608"><span class='Ref_To_Local'>fdresult</span></a> <span class='Operator'>= </span><a href="parse_oper.c.html#LN68"><span class='Ref_to_Proto'>oper_select_candidate</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="parse_oper.c.html#LN603"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN636"><span class='Ref_To_Local'>clist</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="parse_oper.c.html#LN605"><span class='Ref_To_Local'>operOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if clist!=NULL &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !OidIsValid(operOid) &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN605"><span class='Ref_To_Local'>operOid</span></a><span class='Parentheses'>))</span> 
        <a href="parse_oper.c.html#LN609"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN71"><span class='Ref_to_EnumConst'>OPEROID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN605"><span class='Ref_To_Local'>operOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN609"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_oper.c.html#LN607"><span class='Ref_To_Local'>key_ok</span></a><span class='Parentheses'>) 
</span>            <a href="parse_oper.c.html#LN81"><span class='Ref_to_Proto'>make_oper_cache_entry</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="parse_oper.c.html#LN606"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN605"><span class='Ref_To_Local'>operOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="parse_oper.c.html#LN603"><span class='Ref_to_Parameter'>noError</span></a><span class='Parentheses'>) 
</span>        <a href="parse_oper.c.html#LN74"><span class='Ref_to_Proto'>op_error</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN603"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN603"><span class='Ref_to_Parameter'>op</span></a><span class='Delimiter'>, </span><span class='String'>'l'</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN603"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN608"><span class='Ref_To_Local'>fdresult</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN603"><span class='Ref_to_Parameter'>location</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../include/parser/parse_oper.h.html#LN21"><span class='Ref_to_Typedef'>Operator</span></a><span class='Parentheses'>) </span><a href="parse_oper.c.html#LN609"><span class='Ref_To_Local'>tup</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end left_oper &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * op_signature_string 
 *      Build a string representing an operator name, including arg type(s). 
 *      The result is something like "integer + integer". 
 * 
 * This is typically used in the construction of operator-not-found error 
 * messages. 
 */ 
</span><span class='Keyword'>static const char </span><span class='Operator'>* 
</span><a name="LN687"></a><span class='Declare_Function'>op_signature_string</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>op</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>oprkind</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>arg1</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>arg2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN689"></a>    <a href="../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>argbuf</span><span class='Delimiter'>; 
</span> 
    <a href="../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="parse_oper.c.html#LN689"><span class='Ref_To_Local'>argbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_oper.c.html#LN687"><span class='Ref_to_Parameter'>oprkind</span></a> <span class='Operator'>!= </span><span class='String'>'l'</span><span class='Parentheses'>) 
</span>        <a href="../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="parse_oper.c.html#LN689"><span class='Ref_To_Local'>argbuf</span></a><span class='Delimiter'>, </span><span class='String'>"%s "</span><span class='Delimiter'>, </span><a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN687"><span class='Ref_to_Parameter'>arg1</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="parse_oper.c.html#LN689"><span class='Ref_To_Local'>argbuf</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/namespace.h.html#LN120"><span class='Ref_to_Proto'>NameListToString</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN687"><span class='Ref_to_Parameter'>op</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_oper.c.html#LN687"><span class='Ref_to_Parameter'>oprkind</span></a> <span class='Operator'>!= </span><span class='String'>'r'</span><span class='Parentheses'>) 
</span>        <a href="../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="parse_oper.c.html#LN689"><span class='Ref_To_Local'>argbuf</span></a><span class='Delimiter'>, </span><span class='String'>" %s"</span><span class='Delimiter'>, </span><a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN687"><span class='Ref_to_Parameter'>arg2</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="parse_oper.c.html#LN689"><span class='Ref_To_Local'>argbuf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* return palloc'd string buffer */ 
</span><span class='Delimiter'>} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * op_error - utility routine to complain about an unresolvable operator 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN708"></a><span class='Declare_Function'>op_error</span><span class='Parentheses'>(</span><a href="../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>op</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>oprkind</span><span class='Delimiter'>, 
</span><a name="LN709"></a>         <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>arg1</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>arg2</span><span class='Delimiter'>, 
</span><a name="LN710"></a>         <a href="../../include/parser/parse_func.h.html#LN21"><span class='Ref_to_Typedef'>FuncDetailCode</span></a> <span class='Declare_Parameter'>fdresult</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>location</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_oper.c.html#LN710"><span class='Ref_to_Parameter'>fdresult</span></a> <span class='Operator'>== </span><a href="../../include/parser/parse_func.h.html#LN24"><span class='Ref_to_EnumConst'>FUNCDETAIL_MULTIPLE</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_AMBIGUOUS_FUNCTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"operator is not unique: %s"</span><span class='Delimiter'>, 
</span>                        <a href="parse_oper.c.html#LN72"><span class='Ref_to_Proto'>op_signature_string</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN708"><span class='Ref_to_Parameter'>op</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN708"><span class='Ref_to_Parameter'>oprkind</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN709"><span class='Ref_to_Parameter'>arg1</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN709"><span class='Ref_to_Parameter'>arg2</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Could not choose a best candidate operator. "</span> 
                         <span class='String'>"You might need to add explicit type casts."</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN708"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN710"><span class='Ref_to_Parameter'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_FUNCTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"operator does not exist: %s"</span><span class='Delimiter'>, 
</span>                        <a href="parse_oper.c.html#LN72"><span class='Ref_to_Proto'>op_signature_string</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN708"><span class='Ref_to_Parameter'>op</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN708"><span class='Ref_to_Parameter'>oprkind</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN709"><span class='Ref_to_Parameter'>arg1</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN709"><span class='Ref_to_Parameter'>arg2</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>          <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"No operator matches the given name and argument type(s). "</span> 
                  <span class='String'>"You might need to add explicit type casts."</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN708"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN710"><span class='Ref_to_Parameter'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end op_error &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * make_op() 
 *      Operator expression construction. 
 * 
 * Transform operator expression ensuring type compatibility. 
 * This is where some type conversion happens. 
 * 
 * As with coerce_type, pstate may be NULL if no special unknown-Param 
 * processing is wanted. 
 */ 
</span><a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>* 
</span><a name="LN741"></a><span class='Declare_Function'>make_op</span><span class='Parentheses'>(</span><a href="../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>opname</span><span class='Delimiter'>, </span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ltree</span><span class='Delimiter'>, </span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rtree</span><span class='Delimiter'>, 
</span><a name="LN742"></a>        <span class='Keyword'>int </span><span class='Declare_Parameter'>location</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN744"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ltypeId</span><span class='Delimiter'>, 
</span><a name="LN745"></a>                <span class='Declare_Local'>rtypeId</span><span class='Delimiter'>; 
</span><a name="LN746"></a>    <a href="../../include/parser/parse_oper.h.html#LN21"><span class='Ref_to_Typedef'>Operator</span></a>    <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN747"></a>    <a href="../../include/catalog/pg_operator.h.html#LN56"><span class='Ref_to_Typedef'>Form_pg_operator</span></a> <span class='Declare_Local'>opform</span><span class='Delimiter'>; 
</span><a name="LN748"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>actual_arg_types</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]; 
</span><a name="LN749"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>declared_arg_types</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]; 
</span><a name="LN750"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nargs</span><span class='Delimiter'>; 
</span><a name="LN751"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>args</span><span class='Delimiter'>; 
</span><a name="LN752"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>rettype</span><span class='Delimiter'>; 
</span><a name="LN753"></a>    <a href="../../include/nodes/primnodes.h.html#LN491"><span class='Ref_to_Struct'>OpExpr</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Select the operator */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_oper.c.html#LN741"><span class='Ref_to_Parameter'>rtree</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* right operator */ 
</span>        <a href="parse_oper.c.html#LN744"><span class='Ref_To_Local'>ltypeId</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodeFuncs.h.html#LN31"><span class='Ref_to_Proto'>exprType</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN741"><span class='Ref_to_Parameter'>ltree</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="parse_oper.c.html#LN745"><span class='Ref_To_Local'>rtypeId</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <a href="parse_oper.c.html#LN746"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_oper.h.html#LN33"><span class='Ref_to_Proto'>right_oper</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN741"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN741"><span class='Ref_to_Parameter'>opname</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN744"><span class='Ref_To_Local'>ltypeId</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN742"><span class='Ref_to_Parameter'>location</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_oper.c.html#LN741"><span class='Ref_to_Parameter'>ltree</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* left operator */ 
</span>        <a href="parse_oper.c.html#LN745"><span class='Ref_To_Local'>rtypeId</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodeFuncs.h.html#LN31"><span class='Ref_to_Proto'>exprType</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN741"><span class='Ref_to_Parameter'>rtree</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="parse_oper.c.html#LN744"><span class='Ref_To_Local'>ltypeId</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <a href="parse_oper.c.html#LN746"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_oper.h.html#LN35"><span class='Ref_to_Proto'>left_oper</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN741"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN741"><span class='Ref_to_Parameter'>opname</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN745"><span class='Ref_To_Local'>rtypeId</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN742"><span class='Ref_to_Parameter'>location</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* otherwise, binary operator */ 
</span>        <a href="parse_oper.c.html#LN744"><span class='Ref_To_Local'>ltypeId</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodeFuncs.h.html#LN31"><span class='Ref_to_Proto'>exprType</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN741"><span class='Ref_to_Parameter'>ltree</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="parse_oper.c.html#LN745"><span class='Ref_To_Local'>rtypeId</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodeFuncs.h.html#LN31"><span class='Ref_to_Proto'>exprType</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN741"><span class='Ref_to_Parameter'>rtree</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="parse_oper.c.html#LN746"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_oper.h.html#LN31"><span class='Ref_to_Proto'>oper</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN741"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN741"><span class='Ref_to_Parameter'>opname</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN744"><span class='Ref_To_Local'>ltypeId</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN745"><span class='Ref_To_Local'>rtypeId</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN742"><span class='Ref_to_Parameter'>location</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="parse_oper.c.html#LN747"><span class='Ref_To_Local'>opform</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_operator.h.html#LN56"><span class='Ref_to_Typedef'>Form_pg_operator</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN746"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check it's not a shell */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN539"><span class='Ref_to_Macro'>RegProcedureIsValid</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN747"><span class='Ref_To_Local'>opform</span></a><span class='Operator'>-&GT;</span>oprcode<span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_FUNCTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"operator is only a shell: %s"</span><span class='Delimiter'>, 
</span>                        <a href="parse_oper.c.html#LN72"><span class='Ref_to_Proto'>op_signature_string</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN741"><span class='Ref_to_Parameter'>opname</span></a><span class='Delimiter'>, 
</span>                                            <a href="parse_oper.c.html#LN747"><span class='Ref_To_Local'>opform</span></a><span class='Operator'>-&GT;</span>oprkind<span class='Delimiter'>, 
</span>                                            <a href="parse_oper.c.html#LN747"><span class='Ref_To_Local'>opform</span></a><span class='Operator'>-&GT;</span>oprleft<span class='Delimiter'>, 
</span>                                            <a href="parse_oper.c.html#LN747"><span class='Ref_To_Local'>opform</span></a><span class='Operator'>-&GT;</span>oprright<span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                 <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN741"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN742"><span class='Ref_to_Parameter'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Do typecasting and build the expression tree */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_oper.c.html#LN741"><span class='Ref_to_Parameter'>rtree</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* right operator */ 
</span>        <a href="parse_oper.c.html#LN751"><span class='Ref_To_Local'>args</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN138"><span class='Ref_to_Macro'>list_make1</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN741"><span class='Ref_to_Parameter'>ltree</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="parse_oper.c.html#LN748"><span class='Ref_To_Local'>actual_arg_types</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="parse_oper.c.html#LN744"><span class='Ref_To_Local'>ltypeId</span></a><span class='Delimiter'>; 
</span>        <a href="parse_oper.c.html#LN749"><span class='Ref_To_Local'>declared_arg_types</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="parse_oper.c.html#LN747"><span class='Ref_To_Local'>opform</span></a><span class='Operator'>-&GT;</span>oprleft<span class='Delimiter'>; 
</span>        <a href="parse_oper.c.html#LN750"><span class='Ref_To_Local'>nargs</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_oper.c.html#LN741"><span class='Ref_to_Parameter'>ltree</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* left operator */ 
</span>        <a href="parse_oper.c.html#LN751"><span class='Ref_To_Local'>args</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN138"><span class='Ref_to_Macro'>list_make1</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN741"><span class='Ref_to_Parameter'>rtree</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="parse_oper.c.html#LN748"><span class='Ref_To_Local'>actual_arg_types</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="parse_oper.c.html#LN745"><span class='Ref_To_Local'>rtypeId</span></a><span class='Delimiter'>; 
</span>        <a href="parse_oper.c.html#LN749"><span class='Ref_To_Local'>declared_arg_types</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="parse_oper.c.html#LN747"><span class='Ref_To_Local'>opform</span></a><span class='Operator'>-&GT;</span>oprright<span class='Delimiter'>; 
</span>        <a href="parse_oper.c.html#LN750"><span class='Ref_To_Local'>nargs</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* otherwise, binary operator */ 
</span>        <a href="parse_oper.c.html#LN751"><span class='Ref_To_Local'>args</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN139"><span class='Ref_to_Macro'>list_make2</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN741"><span class='Ref_to_Parameter'>ltree</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN741"><span class='Ref_to_Parameter'>rtree</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="parse_oper.c.html#LN748"><span class='Ref_To_Local'>actual_arg_types</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="parse_oper.c.html#LN744"><span class='Ref_To_Local'>ltypeId</span></a><span class='Delimiter'>; 
</span>        <a href="parse_oper.c.html#LN748"><span class='Ref_To_Local'>actual_arg_types</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="parse_oper.c.html#LN745"><span class='Ref_To_Local'>rtypeId</span></a><span class='Delimiter'>; 
</span>        <a href="parse_oper.c.html#LN749"><span class='Ref_To_Local'>declared_arg_types</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="parse_oper.c.html#LN747"><span class='Ref_To_Local'>opform</span></a><span class='Operator'>-&GT;</span>oprleft<span class='Delimiter'>; 
</span>        <a href="parse_oper.c.html#LN749"><span class='Ref_To_Local'>declared_arg_types</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="parse_oper.c.html#LN747"><span class='Ref_To_Local'>opform</span></a><span class='Operator'>-&GT;</span>oprright<span class='Delimiter'>; 
</span>        <a href="parse_oper.c.html#LN750"><span class='Ref_To_Local'>nargs</span></a> <span class='Operator'>= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * enforce consistency with polymorphic argument and return types, 
     * possibly adjusting return type or declared_arg_types (which will be 
     * used as the cast destination by make_fn_arguments) 
     */ 
</span>    <a href="parse_oper.c.html#LN752"><span class='Ref_To_Local'>rettype</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_coerce.h.html#LN77"><span class='Ref_to_Proto'>enforce_generic_type_consistency</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN748"><span class='Ref_To_Local'>actual_arg_types</span></a><span class='Delimiter'>, 
</span>                                               <a href="parse_oper.c.html#LN749"><span class='Ref_To_Local'>declared_arg_types</span></a><span class='Delimiter'>, 
</span>                                               <a href="parse_oper.c.html#LN750"><span class='Ref_To_Local'>nargs</span></a><span class='Delimiter'>, 
</span>                                               <a href="parse_oper.c.html#LN747"><span class='Ref_To_Local'>opform</span></a><span class='Operator'>-&GT;</span>oprresult<span class='Delimiter'>, 
</span>                                               <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* perform the necessary typecasting of arguments */ 
</span>    <a href="../../include/parser/parse_func.h.html#LN52"><span class='Ref_to_Proto'>make_fn_arguments</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN741"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN751"><span class='Ref_To_Local'>args</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN748"><span class='Ref_To_Local'>actual_arg_types</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN749"><span class='Ref_To_Local'>declared_arg_types</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* and build the expression node */ 
</span>    <a href="parse_oper.c.html#LN753"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN491"><span class='Ref_to_Struct'>OpExpr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="parse_oper.c.html#LN753"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN494"><span class='Ref_to_Member'>opno</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_oper.h.html#LN56"><span class='Ref_to_Proto'>oprid</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN746"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="parse_oper.c.html#LN753"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN495"><span class='Ref_to_Member'>opfuncid</span></a> <span class='Operator'>= </span><a href="parse_oper.c.html#LN747"><span class='Ref_To_Local'>opform</span></a><span class='Operator'>-&GT;</span>oprcode<span class='Delimiter'>; 
</span>    <a href="parse_oper.c.html#LN753"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN496"><span class='Ref_to_Member'>opresulttype</span></a> <span class='Operator'>= </span><a href="parse_oper.c.html#LN752"><span class='Ref_To_Local'>rettype</span></a><span class='Delimiter'>; 
</span>    <a href="parse_oper.c.html#LN753"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN497"><span class='Ref_to_Member'>opretset</span></a> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN116"><span class='Ref_to_Proto'>get_func_retset</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN747"><span class='Ref_To_Local'>opform</span></a><span class='Operator'>-&GT;</span>oprcode<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* opcollid and inputcollid will be set by parse_collate.c */ 
</span>    <a href="parse_oper.c.html#LN753"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN500"><span class='Ref_to_Member'>args</span></a> <span class='Operator'>= </span><a href="parse_oper.c.html#LN751"><span class='Ref_To_Local'>args</span></a><span class='Delimiter'>; 
</span>    <a href="parse_oper.c.html#LN753"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN501"><span class='Ref_to_Member'>location</span></a> <span class='Operator'>= </span><a href="parse_oper.c.html#LN742"><span class='Ref_to_Parameter'>location</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* if it returns a set, check that's OK */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_oper.c.html#LN753"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN497"><span class='Ref_to_Member'>opretset</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/parser/parse_func.h.html#LN69"><span class='Ref_to_Proto'>check_srf_call_placement</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN741"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN742"><span class='Ref_to_Parameter'>location</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN746"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="parse_oper.c.html#LN753"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end make_op &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * make_scalar_array_op() 
 *      Build expression tree for "scalar op ANY/ALL (array)" construct. 
 */ 
</span><a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>* 
</span><a name="LN857"></a><span class='Declare_Function'>make_scalar_array_op</span><span class='Parentheses'>(</span><a href="../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>opname</span><span class='Delimiter'>, 
</span><a name="LN858"></a>                     <span class='Keyword'>bool </span><span class='Declare_Parameter'>useOr</span><span class='Delimiter'>, 
</span><a name="LN859"></a>                     <a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ltree</span><span class='Delimiter'>, </span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rtree</span><span class='Delimiter'>, 
</span><a name="LN860"></a>                     <span class='Keyword'>int </span><span class='Declare_Parameter'>location</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN862"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ltypeId</span><span class='Delimiter'>, 
</span><a name="LN863"></a>                <span class='Declare_Local'>rtypeId</span><span class='Delimiter'>, 
</span><a name="LN864"></a>                <span class='Declare_Local'>atypeId</span><span class='Delimiter'>, 
</span><a name="LN865"></a>                <span class='Declare_Local'>res_atypeId</span><span class='Delimiter'>; 
</span><a name="LN866"></a>    <a href="../../include/parser/parse_oper.h.html#LN21"><span class='Ref_to_Typedef'>Operator</span></a>    <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN867"></a>    <a href="../../include/catalog/pg_operator.h.html#LN56"><span class='Ref_to_Typedef'>Form_pg_operator</span></a> <span class='Declare_Local'>opform</span><span class='Delimiter'>; 
</span><a name="LN868"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>actual_arg_types</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]; 
</span><a name="LN869"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>declared_arg_types</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]; 
</span><a name="LN870"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>args</span><span class='Delimiter'>; 
</span><a name="LN871"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>rettype</span><span class='Delimiter'>; 
</span><a name="LN872"></a>    <a href="../../include/nodes/primnodes.h.html#LN534"><span class='Ref_to_Struct'>ScalarArrayOpExpr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="parse_oper.c.html#LN862"><span class='Ref_To_Local'>ltypeId</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodeFuncs.h.html#LN31"><span class='Ref_to_Proto'>exprType</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN859"><span class='Ref_to_Parameter'>ltree</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="parse_oper.c.html#LN864"><span class='Ref_To_Local'>atypeId</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodeFuncs.h.html#LN31"><span class='Ref_to_Proto'>exprType</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN859"><span class='Ref_to_Parameter'>rtree</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The right-hand input of the operator will be the element type of the 
     * array.  However, if we currently have just an untyped literal on the 
     * right, stay with that and hope we can resolve the operator. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_oper.c.html#LN864"><span class='Ref_To_Local'>atypeId</span></a> <span class='Operator'>== </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN43"><span class='Ref_to_Const'>UNKNOWNOID</span></a><span class='Parentheses'>) 
</span>        <a href="parse_oper.c.html#LN863"><span class='Ref_To_Local'>rtypeId</span></a> <span class='Operator'>= </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN43"><span class='Ref_to_Const'>UNKNOWNOID</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="parse_oper.c.html#LN863"><span class='Ref_To_Local'>rtypeId</span></a> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN160"><span class='Ref_to_Proto'>get_base_element_type</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN864"><span class='Ref_To_Local'>atypeId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN863"><span class='Ref_To_Local'>rtypeId</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                   <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"op ANY/ALL (array) requires array on right side"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN857"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN860"><span class='Ref_to_Parameter'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Now resolve the operator */ 
</span>    <a href="parse_oper.c.html#LN866"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_oper.h.html#LN31"><span class='Ref_to_Proto'>oper</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN857"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN857"><span class='Ref_to_Parameter'>opname</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN862"><span class='Ref_To_Local'>ltypeId</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN863"><span class='Ref_To_Local'>rtypeId</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN860"><span class='Ref_to_Parameter'>location</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="parse_oper.c.html#LN867"><span class='Ref_To_Local'>opform</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_operator.h.html#LN56"><span class='Ref_to_Typedef'>Form_pg_operator</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN866"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check it's not a shell */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN539"><span class='Ref_to_Macro'>RegProcedureIsValid</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN867"><span class='Ref_To_Local'>opform</span></a><span class='Operator'>-&GT;</span>oprcode<span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_FUNCTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"operator is only a shell: %s"</span><span class='Delimiter'>, 
</span>                        <a href="parse_oper.c.html#LN72"><span class='Ref_to_Proto'>op_signature_string</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN857"><span class='Ref_to_Parameter'>opname</span></a><span class='Delimiter'>, 
</span>                                            <a href="parse_oper.c.html#LN867"><span class='Ref_To_Local'>opform</span></a><span class='Operator'>-&GT;</span>oprkind<span class='Delimiter'>, 
</span>                                            <a href="parse_oper.c.html#LN867"><span class='Ref_To_Local'>opform</span></a><span class='Operator'>-&GT;</span>oprleft<span class='Delimiter'>, 
</span>                                            <a href="parse_oper.c.html#LN867"><span class='Ref_To_Local'>opform</span></a><span class='Operator'>-&GT;</span>oprright<span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                 <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN857"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN860"><span class='Ref_to_Parameter'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="parse_oper.c.html#LN870"><span class='Ref_To_Local'>args</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN139"><span class='Ref_to_Macro'>list_make2</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN859"><span class='Ref_to_Parameter'>ltree</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN859"><span class='Ref_to_Parameter'>rtree</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="parse_oper.c.html#LN868"><span class='Ref_To_Local'>actual_arg_types</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="parse_oper.c.html#LN862"><span class='Ref_To_Local'>ltypeId</span></a><span class='Delimiter'>; 
</span>    <a href="parse_oper.c.html#LN868"><span class='Ref_To_Local'>actual_arg_types</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="parse_oper.c.html#LN863"><span class='Ref_To_Local'>rtypeId</span></a><span class='Delimiter'>; 
</span>    <a href="parse_oper.c.html#LN869"><span class='Ref_To_Local'>declared_arg_types</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="parse_oper.c.html#LN867"><span class='Ref_To_Local'>opform</span></a><span class='Operator'>-&GT;</span>oprleft<span class='Delimiter'>; 
</span>    <a href="parse_oper.c.html#LN869"><span class='Ref_To_Local'>declared_arg_types</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="parse_oper.c.html#LN867"><span class='Ref_To_Local'>opform</span></a><span class='Operator'>-&GT;</span>oprright<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * enforce consistency with polymorphic argument and return types, 
     * possibly adjusting return type or declared_arg_types (which will be 
     * used as the cast destination by make_fn_arguments) 
     */ 
</span>    <a href="parse_oper.c.html#LN871"><span class='Ref_To_Local'>rettype</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_coerce.h.html#LN77"><span class='Ref_to_Proto'>enforce_generic_type_consistency</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN868"><span class='Ref_To_Local'>actual_arg_types</span></a><span class='Delimiter'>, 
</span>                                               <a href="parse_oper.c.html#LN869"><span class='Ref_To_Local'>declared_arg_types</span></a><span class='Delimiter'>, 
</span>                                               <span class='Number'>2</span><span class='Delimiter'>, 
</span>                                               <a href="parse_oper.c.html#LN867"><span class='Ref_To_Local'>opform</span></a><span class='Operator'>-&GT;</span>oprresult<span class='Delimiter'>, 
</span>                                               <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check that operator result is boolean 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_oper.c.html#LN871"><span class='Ref_To_Local'>rettype</span></a> <span class='Operator'>!= </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN17"><span class='Ref_to_Const'>BOOLOID</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"op ANY/ALL (array) requires operator to yield boolean"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN857"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN860"><span class='Ref_to_Parameter'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/lsyscache.h.html#LN116"><span class='Ref_to_Proto'>get_func_retset</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN867"><span class='Ref_To_Local'>opform</span></a><span class='Operator'>-&GT;</span>oprcode<span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>          <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"op ANY/ALL (array) requires operator not to return a set"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN857"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN860"><span class='Ref_to_Parameter'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now switch back to the array type on the right, arranging for any 
     * needed cast to be applied.  Beware of polymorphic operators here; 
     * enforce_generic_type_consistency may or may not have replaced a 
     * polymorphic type with a real one. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN744"><span class='Ref_to_Macro'>IsPolymorphicType</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN869"><span class='Ref_To_Local'>declared_arg_types</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* assume the actual array type is OK */ 
</span>        <a href="parse_oper.c.html#LN865"><span class='Ref_To_Local'>res_atypeId</span></a> <span class='Operator'>= </span><a href="parse_oper.c.html#LN864"><span class='Ref_To_Local'>atypeId</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="parse_oper.c.html#LN865"><span class='Ref_To_Local'>res_atypeId</span></a> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN158"><span class='Ref_to_Proto'>get_array_type</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN869"><span class='Ref_To_Local'>declared_arg_types</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN865"><span class='Ref_To_Local'>res_atypeId</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not find array type for data type %s"</span><span class='Delimiter'>, 
</span>                            <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN869"><span class='Ref_To_Local'>declared_arg_types</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                     <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN857"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN860"><span class='Ref_to_Parameter'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="parse_oper.c.html#LN868"><span class='Ref_To_Local'>actual_arg_types</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="parse_oper.c.html#LN864"><span class='Ref_To_Local'>atypeId</span></a><span class='Delimiter'>; 
</span>    <a href="parse_oper.c.html#LN869"><span class='Ref_To_Local'>declared_arg_types</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="parse_oper.c.html#LN865"><span class='Ref_To_Local'>res_atypeId</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* perform the necessary typecasting of arguments */ 
</span>    <a href="../../include/parser/parse_func.h.html#LN52"><span class='Ref_to_Proto'>make_fn_arguments</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN857"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN870"><span class='Ref_To_Local'>args</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN868"><span class='Ref_To_Local'>actual_arg_types</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN869"><span class='Ref_To_Local'>declared_arg_types</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* and build the expression node */ 
</span>    <a href="parse_oper.c.html#LN872"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN534"><span class='Ref_to_Struct'>ScalarArrayOpExpr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="parse_oper.c.html#LN872"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN537"><span class='Ref_to_Member'>opno</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_oper.h.html#LN56"><span class='Ref_to_Proto'>oprid</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN866"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="parse_oper.c.html#LN872"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN538"><span class='Ref_to_Member'>opfuncid</span></a> <span class='Operator'>= </span><a href="parse_oper.c.html#LN867"><span class='Ref_To_Local'>opform</span></a><span class='Operator'>-&GT;</span>oprcode<span class='Delimiter'>; 
</span>    <a href="parse_oper.c.html#LN872"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN539"><span class='Ref_to_Member'>useOr</span></a> <span class='Operator'>= </span><a href="parse_oper.c.html#LN858"><span class='Ref_to_Parameter'>useOr</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* inputcollid will be set by parse_collate.c */ 
</span>    <a href="parse_oper.c.html#LN872"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN541"><span class='Ref_to_Member'>args</span></a> <span class='Operator'>= </span><a href="parse_oper.c.html#LN870"><span class='Ref_To_Local'>args</span></a><span class='Delimiter'>; 
</span>    <a href="parse_oper.c.html#LN872"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN542"><span class='Ref_to_Member'>location</span></a> <span class='Operator'>= </span><a href="parse_oper.c.html#LN860"><span class='Ref_to_Parameter'>location</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN866"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="parse_oper.c.html#LN872"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end make_scalar_array_op &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Lookaside cache to speed operator lookup.  Possibly this should be in 
 * a separate module under utils/cache/ ? 
 * 
 * The idea here is that the mapping from operator name and given argument 
 * types is constant for a given search path (or single specified schema OID) 
 * so long as the contents of pg_operator and pg_cast don't change.  And that 
 * mapping is pretty expensive to compute, especially for ambiguous operators; 
 * this is mainly because there are a *lot* of instances of popular operator 
 * names such as "=", and we have to check each one to see which is the 
 * best match.  So once we have identified the correct mapping, we save it 
 * in a cache that need only be flushed on pg_operator or pg_cast change. 
 * (pg_cast must be considered because changes in the set of implicit casts 
 * affect the set of applicable operators for any given input datatype.) 
 * 
 * XXX in principle, ALTER TABLE ... INHERIT could affect the mapping as 
 * well, but we disregard that since there's no convenient way to find out 
 * about it, and it seems a pretty far-fetched corner-case anyway. 
 * 
 * Note: at some point it might be worth doing a similar cache for function 
 * lookups.  However, the potential gain is a lot less since (a) function 
 * names are generally not overloaded as heavily as operator names, and 
 * (b) we'd have to flush on pg_proc updates, which are probably a good 
 * deal more common than pg_operator updates. 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* The operator cache hashtable */ 
</span><a name="LN1009"></a><span class='Keyword'>static </span><a href="../utils/hash/dynahash.c.html#LN192"><span class='Ref_to_Struct'>HTAB</span></a> <span class='Operator'>*</span><span class='Declare_Var'>OprCacheHash</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * make_oper_cache_key 
 *      Fill the lookup key struct given operator name and arg types. 
 * 
 * Returns TRUE if successful, FALSE if the search_path overflowed 
 * (hence no caching is possible). 
 * 
 * pstate/location are used only to report the error position; pass NULL/-1 
 * if not available. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1023"></a><span class='Declare_Function'>make_oper_cache_key</span><span class='Parentheses'>(</span><a href="../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN50"><span class='Ref_to_Struct'>OprCacheKey</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>key</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>opname</span><span class='Delimiter'>, 
</span><a name="LN1024"></a>                    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>ltypeId</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>rtypeId</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>location</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1026"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>schemaname</span><span class='Delimiter'>; 
</span><a name="LN1027"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>opername</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* deconstruct the name list */ 
</span>    <a href="../../include/catalog/namespace.h.html#LN109"><span class='Ref_to_Proto'>DeconstructQualifiedName</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN1023"><span class='Ref_to_Parameter'>opname</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="parse_oper.c.html#LN1026"><span class='Ref_To_Local'>schemaname</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="parse_oper.c.html#LN1027"><span class='Ref_To_Local'>opername</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* ensure zero-fill for stable hashing */ 
</span>    <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN1023"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN50"><span class='Ref_to_Struct'>OprCacheKey</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* save operator name and input types into key */ 
</span>    <a href="../../port/strlcpy.c.html#LN43"><span class='Ref_to_Func'>strlcpy</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN1023"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="parse_oper.c.html#LN52"><span class='Ref_to_Member'>oprname</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN1027"><span class='Ref_To_Local'>opername</span></a><span class='Delimiter'>, </span><a href="../../interfaces/ecpg/include/sqlda-native.h.html#LN15"><span class='Ref_to_Const'>NAMEDATALEN</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="parse_oper.c.html#LN1023"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="parse_oper.c.html#LN53"><span class='Ref_to_Member'>left_arg</span></a> <span class='Operator'>= </span><a href="parse_oper.c.html#LN1024"><span class='Ref_to_Parameter'>ltypeId</span></a><span class='Delimiter'>; 
</span>    <a href="parse_oper.c.html#LN1023"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="parse_oper.c.html#LN54"><span class='Ref_to_Member'>right_arg</span></a> <span class='Operator'>= </span><a href="parse_oper.c.html#LN1024"><span class='Ref_to_Parameter'>rtypeId</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_oper.c.html#LN1026"><span class='Ref_To_Local'>schemaname</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1042"></a>        <a href="../../include/parser/parse_node.h.html#LN249"><span class='Ref_to_Struct'>ParseCallbackState</span></a> <span class='Declare_Local'>pcbstate</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* search only in exact schema given */ 
</span>        <a href="parse_node.c.html#LN143"><span class='Ref_to_Func'>setup_parser_errposition_callback</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="parse_oper.c.html#LN1042"><span class='Ref_To_Local'>pcbstate</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN1023"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN1024"><span class='Ref_to_Parameter'>location</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="parse_oper.c.html#LN1023"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="parse_oper.c.html#LN55"><span class='Ref_to_Member'>search_path</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN113"><span class='Ref_to_Proto'>LookupExplicitNamespace</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN1026"><span class='Ref_To_Local'>schemaname</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="parse_node.c.html#LN159"><span class='Ref_to_Func'>cancel_parser_errposition_callback</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="parse_oper.c.html#LN1042"><span class='Ref_To_Local'>pcbstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* get the active search path */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/catalog/namespace.h.html#LN157"><span class='Ref_to_Proto'>fetch_search_path_array</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN1023"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="parse_oper.c.html#LN55"><span class='Ref_to_Member'>search_path</span></a><span class='Delimiter'>, 
</span>                                  <a href="parse_oper.c.html#LN48"><span class='Ref_to_Const'>MAX_CACHED_PATH_LEN</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><a href="parse_oper.c.html#LN48"><span class='Ref_to_Const'>MAX_CACHED_PATH_LEN</span></a><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* oops, didn't fit */ 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end make_oper_cache_key &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * find_oper_cache_entry 
 * 
 * Look for a cache entry matching the given key.  If found, return the 
 * contained operator OID, else return InvalidOid. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN1067"></a><span class='Declare_Function'>find_oper_cache_entry</span><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN50"><span class='Ref_to_Struct'>OprCacheKey</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>key</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1069"></a>    <a href="parse_oper.c.html#LN58"><span class='Ref_to_Struct'>OprCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>oprentry</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_oper.c.html#LN1009"><span class='Ref_to_Global_Var'>OprCacheHash</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* First time through: initialize the hash table */ 
</span><a name="LN1074"></a>        <a href="../../include/utils/hsearch.h.html#LN64"><span class='Ref_to_Struct'>HASHCTL</span></a>     <span class='Declare_Local'>ctl</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="parse_oper.c.html#LN1074"><span class='Ref_To_Local'>ctl</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN1074"><span class='Ref_To_Local'>ctl</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="parse_oper.c.html#LN1074"><span class='Ref_To_Local'>ctl</span></a><span class='Operator'>.</span><a href="../../include/utils/hsearch.h.html#LN71"><span class='Ref_to_Member'>keysize</span></a> <span class='Operator'>= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN50"><span class='Ref_to_Struct'>OprCacheKey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="parse_oper.c.html#LN1074"><span class='Ref_To_Local'>ctl</span></a><span class='Operator'>.</span><a href="../../include/utils/hsearch.h.html#LN72"><span class='Ref_to_Member'>entrysize</span></a> <span class='Operator'>= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN58"><span class='Ref_to_Struct'>OprCacheEntry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="parse_oper.c.html#LN1009"><span class='Ref_to_Global_Var'>OprCacheHash</span></a> <span class='Operator'>= </span><a href="../../include/utils/hsearch.h.html#LN121"><span class='Ref_to_Proto'>hash_create</span></a><span class='Parentheses'>(</span><span class='String'>"Operator lookup cache"</span><span class='Delimiter'>, </span><span class='Number'>256</span><span class='Delimiter'>, 
</span>                                   <span class='Operator'>&</span><a href="parse_oper.c.html#LN1074"><span class='Ref_To_Local'>ctl</span></a><span class='Delimiter'>, </span><a href="../../include/utils/hsearch.h.html#LN86"><span class='Ref_to_Const'>HASH_ELEM</span></a> <span class='Operator'>| </span><a href="../../include/utils/hsearch.h.html#LN87"><span class='Ref_to_Const'>HASH_BLOBS</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Arrange to flush cache on pg_operator and pg_cast changes */ 
</span>        <a href="../../include/utils/inval.h.html#LN55"><span class='Ref_to_Proto'>CacheRegisterSyscacheCallback</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN70"><span class='Ref_to_EnumConst'>OPERNAMENSP</span></a><span class='Delimiter'>, 
</span>                                      <a href="parse_oper.c.html#LN82"><span class='Ref_to_Proto'>InvalidateOprCacheCallBack</span></a><span class='Delimiter'>, 
</span>                                      <span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/inval.h.html#LN55"><span class='Ref_to_Proto'>CacheRegisterSyscacheCallback</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN45"><span class='Ref_to_EnumConst'>CASTSOURCETARGET</span></a><span class='Delimiter'>, 
</span>                                      <a href="parse_oper.c.html#LN82"><span class='Ref_to_Proto'>InvalidateOprCacheCallBack</span></a><span class='Delimiter'>, 
</span>                                      <span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Look for an existing entry */ 
</span>    <a href="parse_oper.c.html#LN1069"><span class='Ref_To_Local'>oprentry</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN58"><span class='Ref_to_Struct'>OprCacheEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/utils/hsearch.h.html#LN125"><span class='Ref_to_Proto'>hash_search</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN1009"><span class='Ref_to_Global_Var'>OprCacheHash</span></a><span class='Delimiter'>, 
</span>                                             <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="parse_oper.c.html#LN1067"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, 
</span>                                             <a href="../../include/utils/hsearch.h.html#LN104"><span class='Ref_to_EnumConst'>HASH_FIND</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parse_oper.c.html#LN1069"><span class='Ref_To_Local'>oprentry</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="parse_oper.c.html#LN1069"><span class='Ref_To_Local'>oprentry</span></a><span class='Operator'>-&GT;</span><a href="parse_oper.c.html#LN63"><span class='Ref_to_Member'>opr_oid</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end find_oper_cache_entry &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * make_oper_cache_entry 
 * 
 * Insert a cache entry for the given key. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1107"></a><span class='Declare_Function'>make_oper_cache_entry</span><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN50"><span class='Ref_to_Struct'>OprCacheKey</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>key</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>opr_oid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1109"></a>    <a href="parse_oper.c.html#LN58"><span class='Ref_to_Struct'>OprCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>oprentry</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN1009"><span class='Ref_to_Global_Var'>OprCacheHash</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="parse_oper.c.html#LN1109"><span class='Ref_To_Local'>oprentry</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN58"><span class='Ref_to_Struct'>OprCacheEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/utils/hsearch.h.html#LN125"><span class='Ref_to_Proto'>hash_search</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN1009"><span class='Ref_to_Global_Var'>OprCacheHash</span></a><span class='Delimiter'>, 
</span>                                             <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="parse_oper.c.html#LN1107"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, 
</span>                                             <a href="../../include/utils/hsearch.h.html#LN105"><span class='Ref_to_EnumConst'>HASH_ENTER</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="parse_oper.c.html#LN1109"><span class='Ref_To_Local'>oprentry</span></a><span class='Operator'>-&GT;</span><a href="parse_oper.c.html#LN63"><span class='Ref_to_Member'>opr_oid</span></a> <span class='Operator'>= </span><a href="parse_oper.c.html#LN1107"><span class='Ref_to_Parameter'>opr_oid</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Callback for pg_operator and pg_cast inval events 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1123"></a><span class='Declare_Function'>InvalidateOprCacheCallBack</span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>cacheid</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Parameter'>hashvalue</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1125"></a>    <a href="../../include/utils/hsearch.h.html#LN111"><span class='Ref_to_Typedef'>HASH_SEQ_STATUS</span></a> <span class='Declare_Local'>status</span><span class='Delimiter'>; 
</span><a name="LN1126"></a>    <a href="parse_oper.c.html#LN58"><span class='Ref_to_Struct'>OprCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>hentry</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN1009"><span class='Ref_to_Global_Var'>OprCacheHash</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Currently we just flush all entries; hard to be smarter ... */ 
</span>    <a href="../../include/utils/hsearch.h.html#LN134"><span class='Ref_to_Proto'>hash_seq_init</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="parse_oper.c.html#LN1125"><span class='Ref_To_Local'>status</span></a><span class='Delimiter'>, </span><a href="parse_oper.c.html#LN1009"><span class='Ref_to_Global_Var'>OprCacheHash</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="parse_oper.c.html#LN1126"><span class='Ref_To_Local'>hentry</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN58"><span class='Ref_to_Struct'>OprCacheEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/utils/hsearch.h.html#LN135"><span class='Ref_to_Proto'>hash_seq_search</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="parse_oper.c.html#LN1125"><span class='Ref_To_Local'>status</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/hsearch.h.html#LN125"><span class='Ref_to_Proto'>hash_search</span></a><span class='Parentheses'>(</span><a href="parse_oper.c.html#LN1009"><span class='Ref_to_Global_Var'>OprCacheHash</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="parse_oper.c.html#LN1126"><span class='Ref_To_Local'>hentry</span></a><span class='Operator'>-&GT;</span><a href="parse_oper.c.html#LN61"><span class='Ref_to_Member'>key</span></a><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/hsearch.h.html#LN106"><span class='Ref_to_EnumConst'>HASH_REMOVE</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"hash table corrupted"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>