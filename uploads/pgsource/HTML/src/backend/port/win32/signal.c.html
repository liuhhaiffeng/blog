<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\port\win32\signal.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\port\win32\signal.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:45 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * signal.c 
 *    Microsoft Windows Win32 Signal Emulation Functions 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * 
 * IDENTIFICATION 
 *    src/backend/port/win32/signal.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span> 
<span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"libpq/pqsignal.h"</span> 
 
<span class='Comment_Multi_Line'>/* 
 * These are exported for use by the UNBLOCKED_SIGNAL_QUEUE() macro. 
 * pg_signal_queue must be volatile since it is changed by the signal 
 * handling thread and inspected without any lock by the main thread. 
 * pg_signal_mask is only changed by main thread so shouldn't need it. 
 */ 
</span><a name="LN23"></a><span class='Keyword'>volatile int </span><span class='Declare_Var'>pg_signal_queue</span><span class='Delimiter'>; 
</span><a name="LN24"></a><span class='Keyword'>int</span>         <span class='Declare_Var'>pg_signal_mask</span><span class='Delimiter'>; 
</span> 
<a name="LN26"></a>HANDLE      <span class='Declare_Var'>pgwin32_signal_event</span><span class='Delimiter'>; 
</span><a name="LN27"></a>HANDLE      <span class='Declare_Var'>pgwin32_initial_signal_pipe</span> <span class='Operator'>= </span>INVALID_HANDLE_VALUE<span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * pg_signal_crit_sec is used to protect only pg_signal_queue. That is the only 
 * variable that can be accessed from the signal sending threads! 
 */ 
</span><a name="LN33"></a><span class='Keyword'>static </span>CRITICAL_SECTION <span class='Declare_Var'>pg_signal_crit_sec</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* Note that array elements 0 are unused since they correspond to signal 0 */ 
</span><a name="LN36"></a><span class='Keyword'>static </span><a href="../../../include/port.h.html#LN469"><span class='Ref_to_Typedef'>pqsigfunc</span></a> <span class='Declare_Var'>pg_signal_array</span><span class='Delimiter'>[</span><a href="../../../include/port.h.html#LN209"><span class='Ref_to_Const'>PG_SIGNAL_COUNT</span></a><span class='Delimiter'>]; 
</span><a name="LN37"></a><span class='Keyword'>static </span><a href="../../../include/port.h.html#LN469"><span class='Ref_to_Typedef'>pqsigfunc</span></a> <span class='Declare_Var'>pg_signal_defaults</span><span class='Delimiter'>[</span><a href="../../../include/port.h.html#LN209"><span class='Ref_to_Const'>PG_SIGNAL_COUNT</span></a><span class='Delimiter'>]; 
</span> 
 
<span class='Comment_Multi_Line'>/* Signal handling thread function */ 
</span><a name="LN41"></a><span class='Keyword'>static DWORD </span>WINAPI <span class='Declare_Prototype'>pg_signal_thread</span><span class='Parentheses'>(</span>LPVOID <span class='Declare_Parameter'>param</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN42"></a><span class='Keyword'>static </span>BOOL WINAPI <span class='Declare_Prototype'>pg_console_handler</span><span class='Parentheses'>(</span><span class='Keyword'>DWORD </span><span class='Declare_Parameter'>dwCtrlType</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * pg_usleep --- delay the specified number of microseconds, but 
 * stop waiting if a signal arrives. 
 * 
 * This replaces the non-signal-aware version provided by src/port/pgsleep.c. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN52"></a><span class='Declare_Function'>pg_usleep</span><span class='Parentheses'>(</span><span class='Keyword'>long </span><span class='Declare_Parameter'>microsec</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>WaitForSingleObject<span class='Parentheses'>(</span><a href="signal.c.html#LN26"><span class='Ref_to_Global_Var'>pgwin32_signal_event</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="signal.c.html#LN52"><span class='Ref_to_Parameter'>microsec</span></a> <span class='Operator'>&LT; </span><span class='Number'>500</span> <span class='Operator'>? </span><span class='Number'>1</span> <span class='Operator'>: </span><span class='Parentheses'>(</span><a href="signal.c.html#LN52"><span class='Ref_to_Parameter'>microsec</span></a> <span class='Operator'>+ </span><span class='Number'>500</span><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Number'>1000</span><span class='Parentheses'>))</span> 
        <span class='Operator'>== </span>WAIT_OBJECT_0<span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="signal.c.html#LN105"><span class='Ref_to_Func'>pgwin32_dispatch_queued_signals</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        errno <span class='Operator'>= </span><a href="../../../interfaces/libpq/win32.h.html#LN17"><span class='Ref_to_Const'>EINTR</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* Initialization */ 
</span><span class='Keyword'>void 
</span><a name="LN67"></a><span class='Declare_Function'>pgwin32_signal_initialize</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN69"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN70"></a>    HANDLE      <span class='Declare_Local'>signal_thread_handle</span><span class='Delimiter'>; 
</span> 
    InitializeCriticalSection<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="signal.c.html#LN33"><span class='Ref_to_Global_Var'>pg_signal_crit_sec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="signal.c.html#LN69"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="signal.c.html#LN69"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="../../../include/port.h.html#LN209"><span class='Ref_to_Const'>PG_SIGNAL_COUNT</span></a><span class='Delimiter'>; </span><a href="signal.c.html#LN69"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="signal.c.html#LN36"><span class='Ref_to_Global_Var'>pg_signal_array</span></a><span class='Delimiter'>[</span><a href="signal.c.html#LN69"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/port/win32.h.html#LN182"><span class='Ref_to_Const'>SIG_DFL</span></a><span class='Delimiter'>; 
</span>        <a href="signal.c.html#LN37"><span class='Ref_to_Global_Var'>pg_signal_defaults</span></a><span class='Delimiter'>[</span><a href="signal.c.html#LN69"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/port/win32.h.html#LN184"><span class='Ref_to_Const'>SIG_IGN</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="signal.c.html#LN24"><span class='Ref_to_Global_Var'>pg_signal_mask</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="signal.c.html#LN23"><span class='Ref_to_Global_Var'>pg_signal_queue</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Create the global event handle used to flag signals */ 
</span>    <a href="signal.c.html#LN26"><span class='Ref_to_Global_Var'>pgwin32_signal_event</span></a> <span class='Operator'>= </span>CreateEvent<span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Boolean'>TRUE</span><span class='Delimiter'>, </span><span class='Boolean'>FALSE</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="signal.c.html#LN26"><span class='Ref_to_Global_Var'>pgwin32_signal_event</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../utils/error/elog.c.html#LN825"><span class='Ref_to_Func'>errmsg_internal</span></a><span class='Parentheses'>(</span><span class='String'>"could not create signal event: error code %lu"</span><span class='Delimiter'>, </span>GetLastError<span class='Parentheses'>())))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Create thread for handling signals */ 
</span>    <a href="signal.c.html#LN70"><span class='Ref_To_Local'>signal_thread_handle</span></a> <span class='Operator'>= </span>CreateThread<span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="signal.c.html#LN41"><span class='Ref_to_Proto'>pg_signal_thread</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="signal.c.html#LN70"><span class='Ref_To_Local'>signal_thread_handle</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../utils/error/elog.c.html#LN825"><span class='Ref_to_Func'>errmsg_internal</span></a><span class='Parentheses'>(</span><span class='String'>"could not create signal handler thread"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Create console control handle to pick up Ctrl-C etc */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span>SetConsoleCtrlHandler<span class='Parentheses'>(</span><a href="signal.c.html#LN42"><span class='Ref_to_Proto'>pg_console_handler</span></a><span class='Delimiter'>, </span><span class='Boolean'>TRUE</span><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../utils/error/elog.c.html#LN825"><span class='Ref_to_Func'>errmsg_internal</span></a><span class='Parentheses'>(</span><span class='String'>"could not set console control handler"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pgwin32_signal_initialize &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Dispatch all signals currently queued and not blocked 
 * Blocked signals are ignored, and will be fired at the time of 
 * the sigsetmask() call. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN106"></a><span class='Declare_Function'>pgwin32_dispatch_queued_signals</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN108"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>exec_mask</span><span class='Delimiter'>; 
</span> 
    EnterCriticalSection<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="signal.c.html#LN33"><span class='Ref_to_Global_Var'>pg_signal_crit_sec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="signal.c.html#LN108"><span class='Ref_To_Local'>exec_mask</span></a> <span class='Operator'>= </span><a href="../../../include/port/win32.h.html#LN358"><span class='Ref_to_Macro'>UNBLOCKED_SIGNAL_QUEUE</span></a><span class='Parentheses'>())</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* One or more unblocked signals queued for execution */ 
</span><a name="LN114"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="signal.c.html#LN114"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="signal.c.html#LN114"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="../../../include/port.h.html#LN209"><span class='Ref_to_Const'>PG_SIGNAL_COUNT</span></a><span class='Delimiter'>; </span><a href="signal.c.html#LN114"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="signal.c.html#LN108"><span class='Ref_To_Local'>exec_mask</span></a> <span class='Operator'>& </span><a href="../../../include/port/win32.h.html#LN176"><span class='Ref_to_Macro'>sigmask</span></a><span class='Parentheses'>(</span><a href="signal.c.html#LN114"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Execute this signal */ 
</span><a name="LN121"></a>                <a href="../../../include/port.h.html#LN469"><span class='Ref_to_Typedef'>pqsigfunc</span></a>   <span class='Declare_Local'>sig</span> <span class='Operator'>= </span><a href="signal.c.html#LN36"><span class='Ref_to_Global_Var'>pg_signal_array</span></a><span class='Delimiter'>[</span><a href="signal.c.html#LN114"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="signal.c.html#LN121"><span class='Ref_To_Local'>sig</span></a> <span class='Operator'>== </span><a href="../../../include/port/win32.h.html#LN182"><span class='Ref_to_Const'>SIG_DFL</span></a><span class='Parentheses'>) 
</span>                    <a href="signal.c.html#LN121"><span class='Ref_To_Local'>sig</span></a> <span class='Operator'>= </span><a href="signal.c.html#LN37"><span class='Ref_to_Global_Var'>pg_signal_defaults</span></a><span class='Delimiter'>[</span><a href="signal.c.html#LN114"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>                <a href="signal.c.html#LN23"><span class='Ref_to_Global_Var'>pg_signal_queue</span></a> <span class='Operator'>&= </span>~sigmask<span class='Parentheses'>(</span><a href="signal.c.html#LN114"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="signal.c.html#LN121"><span class='Ref_To_Local'>sig</span></a> <span class='Operator'>!= </span><a href="../../../include/port/win32.h.html#LN183"><span class='Ref_to_Const'>SIG_ERR</span></a> <span class='Operator'>&& </span><a href="signal.c.html#LN121"><span class='Ref_To_Local'>sig</span></a> <span class='Operator'>!= </span><a href="../../../include/port/win32.h.html#LN184"><span class='Ref_to_Const'>SIG_IGN</span></a> <span class='Operator'>&& </span><a href="signal.c.html#LN121"><span class='Ref_To_Local'>sig</span></a> <span class='Operator'>!= </span><a href="../../../include/port/win32.h.html#LN182"><span class='Ref_to_Const'>SIG_DFL</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    LeaveCriticalSection<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="signal.c.html#LN33"><span class='Ref_to_Global_Var'>pg_signal_crit_sec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="signal.c.html#LN121"><span class='Ref_To_Local'>sig</span></a><span class='Parentheses'>(</span><a href="signal.c.html#LN114"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    EnterCriticalSection<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="signal.c.html#LN33"><span class='Ref_to_Global_Var'>pg_signal_crit_sec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>;</span>      <span class='Comment_Multi_Line'>/* Restart outer loop, in case signal mask or 
                                 * queue has been modified inside signal 
                                 * handler */ 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=1;i&LT;PG_SIGNAL_COUNT... &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while (exec_mask=UNBLOCKED_... &raquo; </span> 
    ResetEvent<span class='Parentheses'>(</span><a href="signal.c.html#LN26"><span class='Ref_to_Global_Var'>pgwin32_signal_event</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    LeaveCriticalSection<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="signal.c.html#LN33"><span class='Ref_to_Global_Var'>pg_signal_crit_sec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pgwin32_dispatch_queued_signals &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* signal masking. Only called on main thread, no sync required */ 
</span><span class='Keyword'>int 
</span><a name="LN144"></a><span class='Declare_Function'>pqsigsetmask</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>mask</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN146"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>prevmask</span><span class='Delimiter'>; 
</span> 
    <a href="signal.c.html#LN146"><span class='Ref_To_Local'>prevmask</span></a> <span class='Operator'>= </span><a href="signal.c.html#LN24"><span class='Ref_to_Global_Var'>pg_signal_mask</span></a><span class='Delimiter'>; 
</span>    <a href="signal.c.html#LN24"><span class='Ref_to_Global_Var'>pg_signal_mask</span></a> <span class='Operator'>= </span><a href="signal.c.html#LN144"><span class='Ref_to_Parameter'>mask</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Dispatch any signals queued up right away, in case we have unblocked 
     * one or more signals previously queued 
     */ 
</span>    <a href="signal.c.html#LN105"><span class='Ref_to_Func'>pgwin32_dispatch_queued_signals</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="signal.c.html#LN146"><span class='Ref_To_Local'>prevmask</span></a><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Unix-like signal handler installation 
 * 
 * Only called on main thread, no sync required 
 */ 
</span><a href="../../../include/port.h.html#LN469"><span class='Ref_to_Typedef'>pqsigfunc</span></a> 
<a name="LN167"></a><span class='Declare_Function'>pqsignal</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>signum</span><span class='Delimiter'>, </span><a href="../../../include/port.h.html#LN469"><span class='Ref_to_Typedef'>pqsigfunc</span></a> <span class='Declare_Parameter'>handler</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN169"></a>    <a href="../../../include/port.h.html#LN469"><span class='Ref_to_Typedef'>pqsigfunc</span></a>   <span class='Declare_Local'>prevfunc</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="signal.c.html#LN167"><span class='Ref_to_Parameter'>signum</span></a> <span class='Operator'>&GT;= </span><a href="../../../include/port.h.html#LN209"><span class='Ref_to_Const'>PG_SIGNAL_COUNT</span></a> <span class='Operator'>|| </span><a href="signal.c.html#LN167"><span class='Ref_to_Parameter'>signum</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../../include/port/win32.h.html#LN183"><span class='Ref_to_Const'>SIG_ERR</span></a><span class='Delimiter'>; 
</span>    <a href="signal.c.html#LN169"><span class='Ref_To_Local'>prevfunc</span></a> <span class='Operator'>= </span><a href="signal.c.html#LN36"><span class='Ref_to_Global_Var'>pg_signal_array</span></a><span class='Delimiter'>[</span><a href="signal.c.html#LN167"><span class='Ref_to_Parameter'>signum</span></a><span class='Delimiter'>]; 
</span>    <a href="signal.c.html#LN36"><span class='Ref_to_Global_Var'>pg_signal_array</span></a><span class='Delimiter'>[</span><a href="signal.c.html#LN167"><span class='Ref_to_Parameter'>signum</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="signal.c.html#LN167"><span class='Ref_to_Parameter'>handler</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="signal.c.html#LN169"><span class='Ref_To_Local'>prevfunc</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* Create the signal listener pipe for specified PID */ 
</span>HANDLE 
<a name="LN180"></a><span class='Declare_Function'>pgwin32_create_signal_listener</span><span class='Parentheses'>(</span><a href="../../../include/port/win32.h.html#LN255"><span class='Ref_to_Typedef'>pid_t</span></a> <span class='Declare_Parameter'>pid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN182"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>pipename</span><span class='Delimiter'>[</span><span class='Number'>128</span><span class='Delimiter'>]; 
</span><a name="LN183"></a>    HANDLE      <span class='Declare_Local'>pipe</span><span class='Delimiter'>; 
</span> 
    <a href="../../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="signal.c.html#LN182"><span class='Ref_To_Local'>pipename</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="signal.c.html#LN182"><span class='Ref_To_Local'>pipename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"\\\\.\\pipe\\pgsignal_%u"</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="signal.c.html#LN180"><span class='Ref_to_Parameter'>pid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="signal.c.html#LN183"><span class='Ref_To_Local'>pipe</span></a> <span class='Operator'>= </span>CreateNamedPipe<span class='Parentheses'>(</span><a href="signal.c.html#LN182"><span class='Ref_To_Local'>pipename</span></a><span class='Delimiter'>, </span>PIPE_ACCESS_DUPLEX<span class='Delimiter'>, 
</span>                       PIPE_TYPE_MESSAGE <span class='Operator'>| </span>PIPE_READMODE_MESSAGE <span class='Operator'>| </span>PIPE_WAIT<span class='Delimiter'>, 
</span>                           PIPE_UNLIMITED_INSTANCES<span class='Delimiter'>, </span><span class='Number'>16</span><span class='Delimiter'>, </span><span class='Number'>16</span><span class='Delimiter'>, </span><span class='Number'>1000</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="signal.c.html#LN183"><span class='Ref_To_Local'>pipe</span></a> <span class='Operator'>== </span>INVALID_HANDLE_VALUE<span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not create signal listener pipe for PID %d: error code %lu"</span><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="signal.c.html#LN180"><span class='Ref_to_Parameter'>pid</span></a><span class='Delimiter'>, </span>GetLastError<span class='Parentheses'>())))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="signal.c.html#LN183"><span class='Ref_To_Local'>pipe</span></a><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * All functions below execute on the signal handler thread 
 * and must be synchronized as such! 
 * NOTE! The only global variable that can be used is 
 * pg_signal_queue! 
 */ 
</span> 
 
<span class='Keyword'>void 
</span><a name="LN209"></a><span class='Declare_Function'>pg_queue_signal</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>signum</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="signal.c.html#LN209"><span class='Ref_to_Parameter'>signum</span></a> <span class='Operator'>&GT;= </span><a href="../../../include/port.h.html#LN209"><span class='Ref_to_Const'>PG_SIGNAL_COUNT</span></a> <span class='Operator'>|| </span><a href="signal.c.html#LN209"><span class='Ref_to_Parameter'>signum</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    EnterCriticalSection<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="signal.c.html#LN33"><span class='Ref_to_Global_Var'>pg_signal_crit_sec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="signal.c.html#LN23"><span class='Ref_to_Global_Var'>pg_signal_queue</span></a> <span class='Operator'>|= </span><a href="../../../include/port/win32.h.html#LN176"><span class='Ref_to_Macro'>sigmask</span></a><span class='Parentheses'>(</span><a href="signal.c.html#LN209"><span class='Ref_to_Parameter'>signum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    LeaveCriticalSection<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="signal.c.html#LN33"><span class='Ref_to_Global_Var'>pg_signal_crit_sec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    SetEvent<span class='Parentheses'>(</span><a href="signal.c.html#LN26"><span class='Ref_to_Global_Var'>pgwin32_signal_event</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* Signal dispatching thread */ 
</span><span class='Keyword'>static DWORD </span>WINAPI 
<a name="LN223"></a><span class='Declare_Function'>pg_signal_dispatch_thread</span><span class='Parentheses'>(</span>LPVOID <span class='Declare_Parameter'>param</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN225"></a>    HANDLE      <span class='Declare_Local'>pipe</span> <span class='Operator'>= </span><span class='Parentheses'>(</span>HANDLE<span class='Parentheses'>) </span><a href="signal.c.html#LN223"><span class='Ref_to_Parameter'>param</span></a><span class='Delimiter'>; 
</span><a name="LN226"></a>    BYTE        <span class='Declare_Local'>sigNum</span><span class='Delimiter'>; 
</span><a name="LN227"></a>    <span class='Keyword'>DWORD</span>       <span class='Declare_Local'>bytes</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span>ReadFile<span class='Parentheses'>(</span><a href="signal.c.html#LN225"><span class='Ref_To_Local'>pipe</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="signal.c.html#LN226"><span class='Ref_To_Local'>sigNum</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="signal.c.html#LN227"><span class='Ref_To_Local'>bytes</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Client died before sending */ 
</span>        CloseHandle<span class='Parentheses'>(</span><a href="signal.c.html#LN225"><span class='Ref_To_Local'>pipe</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="signal.c.html#LN227"><span class='Ref_To_Local'>bytes</span></a> <span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Received &LT;bytes&GT; bytes over signal pipe (should be 1) */ 
</span>        CloseHandle<span class='Parentheses'>(</span><a href="signal.c.html#LN225"><span class='Ref_To_Local'>pipe</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    WriteFile<span class='Parentheses'>(</span><a href="signal.c.html#LN225"><span class='Ref_To_Local'>pipe</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="signal.c.html#LN226"><span class='Ref_To_Local'>sigNum</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="signal.c.html#LN227"><span class='Ref_To_Local'>bytes</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>  <span class='Comment_Multi_Line'>/* Don't care if it works or 
                                                 * not.. */ 
</span>    FlushFileBuffers<span class='Parentheses'>(</span><a href="signal.c.html#LN225"><span class='Ref_To_Local'>pipe</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    DisconnectNamedPipe<span class='Parentheses'>(</span><a href="signal.c.html#LN225"><span class='Ref_To_Local'>pipe</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    CloseHandle<span class='Parentheses'>(</span><a href="signal.c.html#LN225"><span class='Ref_To_Local'>pipe</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="signal.c.html#LN208"><span class='Ref_to_Func'>pg_queue_signal</span></a><span class='Parentheses'>(</span><a href="signal.c.html#LN226"><span class='Ref_To_Local'>sigNum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_signal_dispatch_thread &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* Signal handling thread */ 
</span><span class='Keyword'>static DWORD </span>WINAPI 
<a name="LN253"></a><span class='Declare_Function'>pg_signal_thread</span><span class='Parentheses'>(</span>LPVOID <span class='Declare_Parameter'>param</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN255"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>pipename</span><span class='Delimiter'>[</span><span class='Number'>128</span><span class='Delimiter'>]; 
</span><a name="LN256"></a>    HANDLE      <span class='Declare_Local'>pipe</span> <span class='Operator'>= </span><a href="signal.c.html#LN27"><span class='Ref_to_Global_Var'>pgwin32_initial_signal_pipe</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="signal.c.html#LN255"><span class='Ref_To_Local'>pipename</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="signal.c.html#LN255"><span class='Ref_To_Local'>pipename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"\\\\.\\pipe\\pgsignal_%lu"</span><span class='Delimiter'>, </span>GetCurrentProcessId<span class='Parentheses'>())</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN262"></a>        BOOL        <span class='Declare_Local'>fConnected</span><span class='Delimiter'>; 
</span><a name="LN263"></a>        HANDLE      <span class='Declare_Local'>hThread</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="signal.c.html#LN256"><span class='Ref_To_Local'>pipe</span></a> <span class='Operator'>== </span>INVALID_HANDLE_VALUE<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="signal.c.html#LN256"><span class='Ref_To_Local'>pipe</span></a> <span class='Operator'>= </span>CreateNamedPipe<span class='Parentheses'>(</span><a href="signal.c.html#LN255"><span class='Ref_To_Local'>pipename</span></a><span class='Delimiter'>, </span>PIPE_ACCESS_DUPLEX<span class='Delimiter'>, 
</span>                       PIPE_TYPE_MESSAGE <span class='Operator'>| </span>PIPE_READMODE_MESSAGE <span class='Operator'>| </span>PIPE_WAIT<span class='Delimiter'>, 
</span>                               PIPE_UNLIMITED_INSTANCES<span class='Delimiter'>, </span><span class='Number'>16</span><span class='Delimiter'>, </span><span class='Number'>16</span><span class='Delimiter'>, </span><span class='Number'>1000</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="signal.c.html#LN256"><span class='Ref_To_Local'>pipe</span></a> <span class='Operator'>== </span>INVALID_HANDLE_VALUE<span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../../bin/pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span><span class='String'>"could not create signal listener pipe: error code %lu; retrying\n"</span><span class='Delimiter'>, </span>GetLastError<span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>                SleepEx<span class='Parentheses'>(</span><span class='Number'>500</span><span class='Delimiter'>, </span><span class='Boolean'>FALSE</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="signal.c.html#LN262"><span class='Ref_To_Local'>fConnected</span></a> <span class='Operator'>= </span>ConnectNamedPipe<span class='Parentheses'>(</span><a href="signal.c.html#LN256"><span class='Ref_To_Local'>pipe</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Boolean'>TRUE </span><span class='Operator'>: </span><span class='Parentheses'>(</span>GetLastError<span class='Parentheses'>() </span><span class='Operator'>== </span>ERROR_PIPE_CONNECTED<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="signal.c.html#LN262"><span class='Ref_To_Local'>fConnected</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN282"></a>            HANDLE      <span class='Declare_Local'>newpipe</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * We have a connected pipe. Pass this off to a separate thread 
             * that will do the actual processing of the pipe. 
             * 
             * We must also create a new instance of the pipe *before* we 
             * start running the new thread. If we don't, there is a race 
             * condition whereby the dispatch thread might run CloseHandle() 
             * before we have created a new instance, thereby causing a small 
             * window of time where we will miss incoming requests. 
             */ 
</span>            <a href="signal.c.html#LN282"><span class='Ref_To_Local'>newpipe</span></a> <span class='Operator'>= </span>CreateNamedPipe<span class='Parentheses'>(</span><a href="signal.c.html#LN255"><span class='Ref_To_Local'>pipename</span></a><span class='Delimiter'>, </span>PIPE_ACCESS_DUPLEX<span class='Delimiter'>, 
</span>                       PIPE_TYPE_MESSAGE <span class='Operator'>| </span>PIPE_READMODE_MESSAGE <span class='Operator'>| </span>PIPE_WAIT<span class='Delimiter'>, 
</span>                               PIPE_UNLIMITED_INSTANCES<span class='Delimiter'>, </span><span class='Number'>16</span><span class='Delimiter'>, </span><span class='Number'>16</span><span class='Delimiter'>, </span><span class='Number'>1000</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="signal.c.html#LN282"><span class='Ref_To_Local'>newpipe</span></a> <span class='Operator'>== </span>INVALID_HANDLE_VALUE<span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * This really should never fail. Just retry in case it does, 
                 * even though we have a small race window in that case. There 
                 * is nothing else we can do other than abort the whole 
                 * process which will be even worse. 
                 */ 
</span>                <a href="../../../bin/pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span><span class='String'>"could not create signal listener pipe: error code %lu; retrying\n"</span><span class='Delimiter'>, </span>GetLastError<span class='Parentheses'>())</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Keep going so we at least dispatch this signal. Hopefully, 
                 * the call will succeed when retried in the loop soon after. 
                 */ 
</span>            <span class='Delimiter'>} 
</span>            <a href="signal.c.html#LN263"><span class='Ref_To_Local'>hThread</span></a> <span class='Operator'>= </span>CreateThread<span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                          <span class='Parentheses'>(</span>LPTHREAD_START_ROUTINE<span class='Parentheses'>) </span><a href="signal.c.html#LN222"><span class='Ref_to_Func'>pg_signal_dispatch_thread</span></a><span class='Delimiter'>, 
</span>                                   <span class='Parentheses'>(</span>LPVOID<span class='Parentheses'>) </span><a href="signal.c.html#LN256"><span class='Ref_To_Local'>pipe</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="signal.c.html#LN263"><span class='Ref_To_Local'>hThread</span></a> <span class='Operator'>== </span>INVALID_HANDLE_VALUE<span class='Parentheses'>) 
</span>                <a href="../../../bin/pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span><span class='String'>"could not create signal dispatch thread: error code %lu\n"</span><span class='Delimiter'>, 
</span>                             GetLastError<span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                CloseHandle<span class='Parentheses'>(</span><a href="signal.c.html#LN263"><span class='Ref_To_Local'>hThread</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Background thread is running with our instance of the pipe. So 
             * replace our reference with the newly created one and loop back 
             * up for another run. 
             */ 
</span>            <a href="signal.c.html#LN256"><span class='Ref_To_Local'>pipe</span></a> <span class='Operator'>= </span><a href="signal.c.html#LN282"><span class='Ref_To_Local'>newpipe</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if fConnected &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Connection failed. Cleanup and try again. 
             * 
             * This should never happen. If it does, we have a small race 
             * condition until we loop up and re-create the pipe. 
             */ 
</span>            CloseHandle<span class='Parentheses'>(</span><a href="signal.c.html#LN256"><span class='Ref_To_Local'>pipe</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="signal.c.html#LN256"><span class='Ref_To_Local'>pipe</span></a> <span class='Operator'>= </span>INVALID_HANDLE_VALUE<span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_signal_thread &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* Console control handler will execute on a thread created 
   by the OS at the time of invocation */ 
</span><span class='Keyword'>static </span>BOOL WINAPI 
<a name="LN347"></a><span class='Declare_Function'>pg_console_handler</span><span class='Parentheses'>(</span><span class='Keyword'>DWORD </span><span class='Declare_Parameter'>dwCtrlType</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="signal.c.html#LN347"><span class='Ref_to_Parameter'>dwCtrlType</span></a> <span class='Operator'>== </span>CTRL_C_EVENT <span class='Operator'>|| 
</span>        <a href="signal.c.html#LN347"><span class='Ref_to_Parameter'>dwCtrlType</span></a> <span class='Operator'>== </span>CTRL_BREAK_EVENT <span class='Operator'>|| 
</span>        <a href="signal.c.html#LN347"><span class='Ref_to_Parameter'>dwCtrlType</span></a> <span class='Operator'>== </span>CTRL_CLOSE_EVENT <span class='Operator'>|| 
</span>        <a href="signal.c.html#LN347"><span class='Ref_to_Parameter'>dwCtrlType</span></a> <span class='Operator'>== </span>CTRL_SHUTDOWN_EVENT<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="signal.c.html#LN208"><span class='Ref_to_Func'>pg_queue_signal</span></a><span class='Parentheses'>(</span>SIGINT<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>TRUE</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <span class='Boolean'>FALSE</span><span class='Delimiter'>; 
} 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>