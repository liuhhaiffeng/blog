<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\replication\logical\decode.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\replication\logical\decode.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:46 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/* ------------------------------------------------------------------------- 
 * 
 * decode.c 
 *      This module decodes WAL records read using xlogreader.h's APIs for the 
 *      purpose of logical decoding by passing information to the 
 *      reorderbuffer module (containing the actual changes) and to the 
 *      snapbuild module to build a fitting catalog snapshot (to be able to 
 *      properly decode the changes in the reorderbuffer). 
 * 
 * NOTE: 
 *      This basically tries to handle all low level xlog stuff for 
 *      reorderbuffer.c and snapbuild.c. There's some minor leakage where a 
 *      specific record's struct is used to pass data along, but those just 
 *      happen to contain the right amount of data in a convenient 
 *      format. There isn't and shouldn't be much intelligence about the 
 *      contents of records in here except turning them into a more usable 
 *      format. 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * IDENTIFICATION 
 *    src/backend/replication/logical/decode.c 
 * 
 * ------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/heapam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/heapam_xlog.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/transam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xact.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xlog_internal.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xlogutils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xlogreader.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xlogrecord.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_control.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"replication/decode.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"replication/logical.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"replication/message.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"replication/reorderbuffer.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"replication/origin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"replication/snapbuild.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"storage/standby.h"</span> 
 
<a name="LN48"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>XLogRecordBuffer</span> 
<span class='Delimiter'>{ 
</span><a name="LN50"></a>    <a href="../../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a>  <span class='Declare_Member'>origptr</span><span class='Delimiter'>; 
</span><a name="LN51"></a>    <a href="../../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a>  <span class='Declare_Member'>endptr</span><span class='Delimiter'>; 
</span><a name="LN52"></a>    <a href="../../../include/access/xlogreader.h.html#LN68"><span class='Ref_to_Struct'>XLogReaderState</span></a> <span class='Operator'>*</span><span class='Declare_Member'>record</span><span class='Delimiter'>; 
</span><a name="LN53"></a>} <span class='Declare_Typedef'>XLogRecordBuffer</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* RMGR Handlers */ 
</span><a name="LN56"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>DecodeXLogOp</span><span class='Parentheses'>(</span><a href="../../../include/replication/logical.h.html#LN34"><span class='Ref_to_Struct'>LogicalDecodingContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><a href="decode.c.html#LN48"><span class='Ref_to_Struct'>XLogRecordBuffer</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN57"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>DecodeHeapOp</span><span class='Parentheses'>(</span><a href="../../../include/replication/logical.h.html#LN34"><span class='Ref_to_Struct'>LogicalDecodingContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><a href="decode.c.html#LN48"><span class='Ref_to_Struct'>XLogRecordBuffer</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN58"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>DecodeHeap2Op</span><span class='Parentheses'>(</span><a href="../../../include/replication/logical.h.html#LN34"><span class='Ref_to_Struct'>LogicalDecodingContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><a href="decode.c.html#LN48"><span class='Ref_to_Struct'>XLogRecordBuffer</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN59"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>DecodeXactOp</span><span class='Parentheses'>(</span><a href="../../../include/replication/logical.h.html#LN34"><span class='Ref_to_Struct'>LogicalDecodingContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><a href="decode.c.html#LN48"><span class='Ref_to_Struct'>XLogRecordBuffer</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN60"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>DecodeStandbyOp</span><span class='Parentheses'>(</span><a href="../../../include/replication/logical.h.html#LN34"><span class='Ref_to_Struct'>LogicalDecodingContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><a href="decode.c.html#LN48"><span class='Ref_to_Struct'>XLogRecordBuffer</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN61"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>DecodeLogicalMsgOp</span><span class='Parentheses'>(</span><a href="../../../include/replication/logical.h.html#LN34"><span class='Ref_to_Struct'>LogicalDecodingContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><a href="decode.c.html#LN48"><span class='Ref_to_Struct'>XLogRecordBuffer</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* individual record(group)'s handlers */ 
</span><a name="LN64"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>DecodeInsert</span><span class='Parentheses'>(</span><a href="../../../include/replication/logical.h.html#LN34"><span class='Ref_to_Struct'>LogicalDecodingContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><a href="decode.c.html#LN48"><span class='Ref_to_Struct'>XLogRecordBuffer</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN65"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>DecodeUpdate</span><span class='Parentheses'>(</span><a href="../../../include/replication/logical.h.html#LN34"><span class='Ref_to_Struct'>LogicalDecodingContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><a href="decode.c.html#LN48"><span class='Ref_to_Struct'>XLogRecordBuffer</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN66"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>DecodeDelete</span><span class='Parentheses'>(</span><a href="../../../include/replication/logical.h.html#LN34"><span class='Ref_to_Struct'>LogicalDecodingContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><a href="decode.c.html#LN48"><span class='Ref_to_Struct'>XLogRecordBuffer</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN67"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>DecodeMultiInsert</span><span class='Parentheses'>(</span><a href="../../../include/replication/logical.h.html#LN34"><span class='Ref_to_Struct'>LogicalDecodingContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><a href="decode.c.html#LN48"><span class='Ref_to_Struct'>XLogRecordBuffer</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN68"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>DecodeSpecConfirm</span><span class='Parentheses'>(</span><a href="../../../include/replication/logical.h.html#LN34"><span class='Ref_to_Struct'>LogicalDecodingContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><a href="decode.c.html#LN48"><span class='Ref_to_Struct'>XLogRecordBuffer</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN70"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>DecodeCommit</span><span class='Parentheses'>(</span><a href="../../../include/replication/logical.h.html#LN34"><span class='Ref_to_Struct'>LogicalDecodingContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><a href="decode.c.html#LN48"><span class='Ref_to_Struct'>XLogRecordBuffer</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Delimiter'>, 
</span><a name="LN71"></a>             <a href="../../../include/access/xact.h.html#LN286"><span class='Ref_to_Struct'>xl_xact_parsed_commit</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>parsed</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Declare_Parameter'>xid</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN72"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>DecodeAbort</span><span class='Parentheses'>(</span><a href="../../../include/replication/logical.h.html#LN34"><span class='Ref_to_Struct'>LogicalDecodingContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><a href="decode.c.html#LN48"><span class='Ref_to_Struct'>XLogRecordBuffer</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Delimiter'>, 
</span><a name="LN73"></a>            <a href="../../../include/access/xact.h.html#LN310"><span class='Ref_to_Struct'>xl_xact_parsed_abort</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>parsed</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Declare_Parameter'>xid</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* common function to decode tuples */ 
</span><a name="LN76"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>DecodeXLogTuple</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>data</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Declare_Parameter'>len</span><span class='Delimiter'>, </span><a href="../../../include/replication/reorderbuffer.h.html#LN20"><span class='Ref_to_Struct'>ReorderBufferTupleBuf</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tup</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Take every XLogReadRecord()ed record and perform the actions required to 
 * decode it using the output plugin already setup in the logical decoding 
 * context. 
 * 
 * NB: Note that every record's xid needs to be processed by reorderbuffer 
 * (xids contained in the content of records are not relevant for this rule). 
 * That means that for records which'd otherwise not go through the 
 * reorderbuffer ReorderBufferProcessXid() has to be called. We don't want to 
 * call ReorderBufferProcessXid for each record type by default, because 
 * e.g. empty xacts can be handled more efficiently if there's no previous 
 * state for them. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN92"></a><span class='Declare_Function'>LogicalDecodingProcessRecord</span><span class='Parentheses'>(</span><a href="../../../include/replication/logical.h.html#LN34"><span class='Ref_to_Struct'>LogicalDecodingContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><a href="../../../include/access/xlogreader.h.html#LN68"><span class='Ref_to_Struct'>XLogReaderState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>record</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN94"></a>    <a href="decode.c.html#LN48"><span class='Ref_to_Struct'>XLogRecordBuffer</span></a> <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span> 
    <a href="decode.c.html#LN94"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="decode.c.html#LN50"><span class='Ref_to_Member'>origptr</span></a> <span class='Operator'>= </span><a href="decode.c.html#LN92"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/logical.h.html#LN43"><span class='Ref_to_Member'>reader</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/xlogreader.h.html#LN113"><span class='Ref_to_Member'>ReadRecPtr</span></a><span class='Delimiter'>; 
</span>    <a href="decode.c.html#LN94"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="decode.c.html#LN51"><span class='Ref_to_Member'>endptr</span></a> <span class='Operator'>= </span><a href="decode.c.html#LN92"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/logical.h.html#LN43"><span class='Ref_to_Member'>reader</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/xlogreader.h.html#LN114"><span class='Ref_to_Member'>EndRecPtr</span></a><span class='Delimiter'>; 
</span>    <a href="decode.c.html#LN94"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="decode.c.html#LN52"><span class='Ref_to_Member'>record</span></a> <span class='Operator'>= </span><a href="decode.c.html#LN92"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* cast so we get a warning when new rmgrs are added */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>((</span><a href="../../../include/access/rmgr.h.html#LN24"><span class='Ref_to_Enum'>RmgrIds</span></a><span class='Parentheses'>) </span><a href="../../../include/access/xlogreader.h.html#LN216"><span class='Ref_to_Macro'>XLogRecGetRmid</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN92"><span class='Ref_to_Parameter'>record</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Rmgrs we care about for logical decoding. Add new rmgrs in 
             * rmgrlist.h's order. 
             */ 
</span>        <span class='Control'>case</span> RM_XLOG_ID<span class='Operator'>: 
</span>            <a href="decode.c.html#LN56"><span class='Ref_to_Proto'>DecodeXLogOp</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN92"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="decode.c.html#LN94"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> RM_XACT_ID<span class='Operator'>: 
</span>            <a href="decode.c.html#LN59"><span class='Ref_to_Proto'>DecodeXactOp</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN92"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="decode.c.html#LN94"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> RM_STANDBY_ID<span class='Operator'>: 
</span>            <a href="decode.c.html#LN60"><span class='Ref_to_Proto'>DecodeStandbyOp</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN92"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="decode.c.html#LN94"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> RM_HEAP2_ID<span class='Operator'>: 
</span>            <a href="decode.c.html#LN58"><span class='Ref_to_Proto'>DecodeHeap2Op</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN92"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="decode.c.html#LN94"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> RM_HEAP_ID<span class='Operator'>: 
</span>            <a href="decode.c.html#LN57"><span class='Ref_to_Proto'>DecodeHeapOp</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN92"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="decode.c.html#LN94"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> RM_LOGICALMSG_ID<span class='Operator'>: 
</span>            <a href="decode.c.html#LN61"><span class='Ref_to_Proto'>DecodeLogicalMsgOp</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN92"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="decode.c.html#LN94"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Rmgrs irrelevant for logical decoding; they describe stuff not 
             * represented in logical decoding. Add new rmgrs in rmgrlist.h's 
             * order. 
             */ 
</span>        <span class='Control'>case</span> RM_SMGR_ID<span class='Operator'>: 
</span>        <span class='Control'>case</span> RM_CLOG_ID<span class='Operator'>: 
</span>        <span class='Control'>case</span> RM_DBASE_ID<span class='Operator'>: 
</span>        <span class='Control'>case</span> RM_TBLSPC_ID<span class='Operator'>: 
</span>        <span class='Control'>case</span> RM_MULTIXACT_ID<span class='Operator'>: 
</span>        <span class='Control'>case</span> RM_RELMAP_ID<span class='Operator'>: 
</span>        <span class='Control'>case</span> RM_BTREE_ID<span class='Operator'>: 
</span>        <span class='Control'>case</span> RM_HASH_ID<span class='Operator'>: 
</span>        <span class='Control'>case</span> RM_GIN_ID<span class='Operator'>: 
</span>        <span class='Control'>case</span> RM_GIST_ID<span class='Operator'>: 
</span>        <span class='Control'>case</span> RM_SEQ_ID<span class='Operator'>: 
</span>        <span class='Control'>case</span> RM_SPGIST_ID<span class='Operator'>: 
</span>        <span class='Control'>case</span> RM_BRIN_ID<span class='Operator'>: 
</span>        <span class='Control'>case</span> RM_COMMIT_TS_ID<span class='Operator'>: 
</span>        <span class='Control'>case</span> RM_REPLORIGIN_ID<span class='Operator'>: 
</span>        <span class='Control'>case</span> RM_GENERIC_ID<span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* just deal with xid, and done */ 
</span>            <a href="../../../include/replication/reorderbuffer.h.html#LN393"><span class='Ref_to_Proto'>ReorderBufferProcessXid</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN92"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/logical.h.html#LN44"><span class='Ref_to_Member'>reorder</span></a><span class='Delimiter'>, </span><a href="../../../include/access/xlogreader.h.html#LN217"><span class='Ref_to_Macro'>XLogRecGetXid</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN92"><span class='Ref_to_Parameter'>record</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                    <a href="decode.c.html#LN94"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="decode.c.html#LN50"><span class='Ref_to_Member'>origptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/access/rmgr.h.html#LN27"><span class='Ref_to_EnumConst'>RM_NEXT_ID</span></a><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected RM_NEXT_ID rmgr_id: %u"</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/access/rmgr.h.html#LN24"><span class='Ref_to_Enum'>RmgrIds</span></a><span class='Parentheses'>) </span><a href="../../../include/access/xlogreader.h.html#LN216"><span class='Ref_to_Macro'>XLogRecGetRmid</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN94"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="decode.c.html#LN52"><span class='Ref_to_Member'>record</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch (RmgrIds)XLogRecGetRm... &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end LogicalDecodingProcessRecord &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Handle rmgr XLOG_ID records for DecodeRecordIntoReorderBuffer(). 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN165"></a><span class='Declare_Function'>DecodeXLogOp</span><span class='Parentheses'>(</span><a href="../../../include/replication/logical.h.html#LN34"><span class='Ref_to_Struct'>LogicalDecodingContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><a href="decode.c.html#LN48"><span class='Ref_to_Struct'>XLogRecordBuffer</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN167"></a>    <a href="snapbuild.c.html#LN152"><span class='Ref_to_Struct'>SnapBuild</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>builder</span> <span class='Operator'>= </span><a href="decode.c.html#LN165"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/logical.h.html#LN45"><span class='Ref_to_Member'>snapshot_builder</span></a><span class='Delimiter'>; 
</span><a name="LN168"></a>    <a href="../../../include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>       <span class='Declare_Local'>info</span> <span class='Operator'>= </span><a href="../../../include/access/xlogreader.h.html#LN215"><span class='Ref_to_Macro'>XLogRecGetInfo</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN165"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN52"><span class='Ref_to_Member'>record</span></a><span class='Parentheses'>) </span><span class='Operator'>& ~</span><a href="../../../include/access/xlogrecord.h.html#LN61"><span class='Ref_to_Const'>XLR_INFO_MASK</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/replication/reorderbuffer.h.html#LN393"><span class='Ref_to_Proto'>ReorderBufferProcessXid</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN165"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/logical.h.html#LN44"><span class='Ref_to_Member'>reorder</span></a><span class='Delimiter'>, </span><a href="../../../include/access/xlogreader.h.html#LN217"><span class='Ref_to_Macro'>XLogRecGetXid</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN165"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN52"><span class='Ref_to_Member'>record</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="decode.c.html#LN165"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN50"><span class='Ref_to_Member'>origptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="decode.c.html#LN168"><span class='Ref_To_Local'>info</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* this is also used in END_OF_RECOVERY checkpoints */ 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_control.h.html#LN65"><span class='Ref_to_Const'>XLOG_CHECKPOINT_SHUTDOWN</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_control.h.html#LN74"><span class='Ref_to_Const'>XLOG_END_OF_RECOVERY</span></a><span class='Operator'>: 
</span>            <a href="../../../include/replication/snapbuild.h.html#LN87"><span class='Ref_to_Proto'>SnapBuildSerializationPoint</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN167"><span class='Ref_To_Local'>builder</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN165"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN50"><span class='Ref_to_Member'>origptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_control.h.html#LN66"><span class='Ref_to_Const'>XLOG_CHECKPOINT_ONLINE</span></a><span class='Operator'>: 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * a RUNNING_XACTS record will have been logged near to this, we 
             * can restart from there. 
             */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_control.h.html#LN67"><span class='Ref_to_Const'>XLOG_NOOP</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_control.h.html#LN68"><span class='Ref_to_Const'>XLOG_NEXTOID</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_control.h.html#LN69"><span class='Ref_to_Const'>XLOG_SWITCH</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_control.h.html#LN70"><span class='Ref_to_Const'>XLOG_BACKUP_END</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_control.h.html#LN71"><span class='Ref_to_Const'>XLOG_PARAMETER_CHANGE</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_control.h.html#LN72"><span class='Ref_to_Const'>XLOG_RESTORE_POINT</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_control.h.html#LN73"><span class='Ref_to_Const'>XLOG_FPW_CHANGE</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_control.h.html#LN75"><span class='Ref_to_Const'>XLOG_FPI_FOR_HINT</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_control.h.html#LN76"><span class='Ref_to_Const'>XLOG_FPI</span></a><span class='Operator'>: 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected RM_XLOG_ID record type: %u"</span><span class='Delimiter'>, </span><a href="decode.c.html#LN168"><span class='Ref_To_Local'>info</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch info &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end DecodeXLogOp &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Handle rmgr XACT_ID records for DecodeRecordIntoReorderBuffer(). 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN207"></a><span class='Declare_Function'>DecodeXactOp</span><span class='Parentheses'>(</span><a href="../../../include/replication/logical.h.html#LN34"><span class='Ref_to_Struct'>LogicalDecodingContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><a href="decode.c.html#LN48"><span class='Ref_to_Struct'>XLogRecordBuffer</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN209"></a>    <a href="snapbuild.c.html#LN152"><span class='Ref_to_Struct'>SnapBuild</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>builder</span> <span class='Operator'>= </span><a href="decode.c.html#LN207"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/logical.h.html#LN45"><span class='Ref_to_Member'>snapshot_builder</span></a><span class='Delimiter'>; 
</span><a name="LN210"></a>    <a href="../../../include/replication/reorderbuffer.h.html#LN294"><span class='Ref_to_Struct'>ReorderBuffer</span></a> <span class='Operator'>*</span><span class='Declare_Local'>reorder</span> <span class='Operator'>= </span><a href="decode.c.html#LN207"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/logical.h.html#LN44"><span class='Ref_to_Member'>reorder</span></a><span class='Delimiter'>; 
</span><a name="LN211"></a>    <a href="../../../include/access/xlogreader.h.html#LN68"><span class='Ref_to_Struct'>XLogReaderState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>r</span> <span class='Operator'>= </span><a href="decode.c.html#LN207"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN52"><span class='Ref_to_Member'>record</span></a><span class='Delimiter'>; 
</span><a name="LN212"></a>    <a href="../../../include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>       <span class='Declare_Local'>info</span> <span class='Operator'>= </span><a href="../../../include/access/xlogreader.h.html#LN215"><span class='Ref_to_Macro'>XLogRecGetInfo</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN211"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>) </span><span class='Operator'>& </span><a href="../../../include/access/xact.h.html#LN143"><span class='Ref_to_Const'>XLOG_XACT_OPMASK</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * No point in doing anything yet, data could not be decoded anyway. It's 
     * ok not to call ReorderBufferProcessXid() in that case, except in the 
     * assignment case there'll not be any later records with the same xid; 
     * and in the assignment case we'll not decode those xacts. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/replication/snapbuild.h.html#LN72"><span class='Ref_to_Proto'>SnapBuildCurrentState</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN209"><span class='Ref_To_Local'>builder</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><a href="../../../include/replication/snapbuild.h.html#LN38"><span class='Ref_to_EnumConst'>SNAPBUILD_FULL_SNAPSHOT</span></a><span class='Parentheses'>)</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="decode.c.html#LN212"><span class='Ref_To_Local'>info</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/access/xact.h.html#LN133"><span class='Ref_to_Const'>XLOG_XACT_COMMIT</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/access/xact.h.html#LN136"><span class='Ref_to_Const'>XLOG_XACT_COMMIT_PREPARED</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN228"></a>                <a href="../../../include/access/xact.h.html#LN254"><span class='Ref_to_Struct'>xl_xact_commit</span></a> <span class='Operator'>*</span><span class='Declare_Local'>xlrec</span><span class='Delimiter'>; 
</span><a name="LN229"></a>                <a href="../../../include/access/xact.h.html#LN286"><span class='Ref_to_Struct'>xl_xact_parsed_commit</span></a> <span class='Declare_Local'>parsed</span><span class='Delimiter'>; 
</span><a name="LN230"></a>                <a href="../../../include/c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Declare_Local'>xid</span><span class='Delimiter'>; 
</span> 
                <a href="decode.c.html#LN228"><span class='Ref_To_Local'>xlrec</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/xact.h.html#LN254"><span class='Ref_to_Struct'>xl_xact_commit</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/access/xlogreader.h.html#LN219"><span class='Ref_to_Macro'>XLogRecGetData</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN211"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../access/rmgrdesc/xactdesc.c.html#LN33"><span class='Ref_to_Func'>ParseCommitRecord</span></a><span class='Parentheses'>(</span><a href="../../../include/access/xlogreader.h.html#LN215"><span class='Ref_to_Macro'>XLogRecGetInfo</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN207"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN52"><span class='Ref_to_Member'>record</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="decode.c.html#LN228"><span class='Ref_To_Local'>xlrec</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="decode.c.html#LN229"><span class='Ref_To_Local'>parsed</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/transam.h.html#LN40"><span class='Ref_to_Macro'>TransactionIdIsValid</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN229"><span class='Ref_To_Local'>parsed</span></a><span class='Operator'>.</span><a href="../../../include/access/xact.h.html#LN304"><span class='Ref_to_Member'>twophase_xid</span></a><span class='Parentheses'>))</span> 
                    <a href="decode.c.html#LN230"><span class='Ref_To_Local'>xid</span></a> <span class='Operator'>= </span><a href="../../../include/access/xlogreader.h.html#LN217"><span class='Ref_to_Macro'>XLogRecGetXid</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN211"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="decode.c.html#LN230"><span class='Ref_To_Local'>xid</span></a> <span class='Operator'>= </span><a href="decode.c.html#LN229"><span class='Ref_To_Local'>parsed</span></a><span class='Operator'>.</span><a href="../../../include/access/xact.h.html#LN304"><span class='Ref_to_Member'>twophase_xid</span></a><span class='Delimiter'>; 
</span> 
                <a href="decode.c.html#LN70"><span class='Ref_to_Proto'>DecodeCommit</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN207"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN207"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="decode.c.html#LN229"><span class='Ref_To_Local'>parsed</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN230"><span class='Ref_To_Local'>xid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Control'>case</span> <a href="../../../include/access/xact.h.html#LN135"><span class='Ref_to_Const'>XLOG_XACT_ABORT</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/access/xact.h.html#LN137"><span class='Ref_to_Const'>XLOG_XACT_ABORT_PREPARED</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN246"></a>                <a href="../../../include/access/xact.h.html#LN268"><span class='Ref_to_Struct'>xl_xact_abort</span></a> <span class='Operator'>*</span><span class='Declare_Local'>xlrec</span><span class='Delimiter'>; 
</span><a name="LN247"></a>                <a href="../../../include/access/xact.h.html#LN310"><span class='Ref_to_Struct'>xl_xact_parsed_abort</span></a> <span class='Declare_Local'>parsed</span><span class='Delimiter'>; 
</span><a name="LN248"></a>                <a href="../../../include/c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Declare_Local'>xid</span><span class='Delimiter'>; 
</span> 
                <a href="decode.c.html#LN246"><span class='Ref_To_Local'>xlrec</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/xact.h.html#LN268"><span class='Ref_to_Struct'>xl_xact_abort</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/access/xlogreader.h.html#LN219"><span class='Ref_to_Macro'>XLogRecGetData</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN211"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../access/rmgrdesc/xactdesc.c.html#LN120"><span class='Ref_to_Func'>ParseAbortRecord</span></a><span class='Parentheses'>(</span><a href="../../../include/access/xlogreader.h.html#LN215"><span class='Ref_to_Macro'>XLogRecGetInfo</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN207"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN52"><span class='Ref_to_Member'>record</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="decode.c.html#LN246"><span class='Ref_To_Local'>xlrec</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="decode.c.html#LN247"><span class='Ref_To_Local'>parsed</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/transam.h.html#LN40"><span class='Ref_to_Macro'>TransactionIdIsValid</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN247"><span class='Ref_To_Local'>parsed</span></a><span class='Operator'>.</span><a href="../../../include/access/xact.h.html#LN321"><span class='Ref_to_Member'>twophase_xid</span></a><span class='Parentheses'>))</span> 
                    <a href="decode.c.html#LN248"><span class='Ref_To_Local'>xid</span></a> <span class='Operator'>= </span><a href="../../../include/access/xlogreader.h.html#LN217"><span class='Ref_to_Macro'>XLogRecGetXid</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN211"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="decode.c.html#LN248"><span class='Ref_To_Local'>xid</span></a> <span class='Operator'>= </span><a href="decode.c.html#LN247"><span class='Ref_To_Local'>parsed</span></a><span class='Operator'>.</span><a href="../../../include/access/xact.h.html#LN321"><span class='Ref_to_Member'>twophase_xid</span></a><span class='Delimiter'>; 
</span> 
                <a href="decode.c.html#LN72"><span class='Ref_to_Proto'>DecodeAbort</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN207"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN207"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="decode.c.html#LN247"><span class='Ref_To_Local'>parsed</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN248"><span class='Ref_To_Local'>xid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Control'>case</span> <a href="../../../include/access/xact.h.html#LN138"><span class='Ref_to_Const'>XLOG_XACT_ASSIGNMENT</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN263"></a>                <a href="../../../include/access/xact.h.html#LN180"><span class='Ref_to_Struct'>xl_xact_assignment</span></a> <span class='Operator'>*</span><span class='Declare_Local'>xlrec</span><span class='Delimiter'>; 
</span><a name="LN264"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN265"></a>                <a href="../../../include/c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Operator'>*</span><span class='Declare_Local'>sub_xid</span><span class='Delimiter'>; 
</span> 
                <a href="decode.c.html#LN263"><span class='Ref_To_Local'>xlrec</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/xact.h.html#LN180"><span class='Ref_to_Struct'>xl_xact_assignment</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/access/xlogreader.h.html#LN219"><span class='Ref_to_Macro'>XLogRecGetData</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN211"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="decode.c.html#LN265"><span class='Ref_To_Local'>sub_xid</span></a> <span class='Operator'>= &</span><a href="decode.c.html#LN263"><span class='Ref_To_Local'>xlrec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/xact.h.html#LN184"><span class='Ref_to_Member'>xsub</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span> 
                <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="decode.c.html#LN264"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="decode.c.html#LN264"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="decode.c.html#LN263"><span class='Ref_To_Local'>xlrec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/xact.h.html#LN183"><span class='Ref_to_Member'>nsubxacts</span></a><span class='Delimiter'>; </span><a href="decode.c.html#LN264"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../../include/replication/reorderbuffer.h.html#LN375"><span class='Ref_to_Proto'>ReorderBufferAssignChild</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN210"><span class='Ref_To_Local'>reorder</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN263"><span class='Ref_To_Local'>xlrec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/xact.h.html#LN182"><span class='Ref_to_Member'>xtop</span></a><span class='Delimiter'>, 
</span>                                             <span class='Operator'>*</span><span class='Parentheses'>(</span><a href="decode.c.html#LN265"><span class='Ref_To_Local'>sub_xid</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="decode.c.html#LN207"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN50"><span class='Ref_to_Member'>origptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Control'>case</span> <a href="../../../include/access/xact.h.html#LN134"><span class='Ref_to_Const'>XLOG_XACT_PREPARE</span></a><span class='Operator'>: 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Currently decoding ignores PREPARE TRANSACTION and will just 
             * decode the transaction when the COMMIT PREPARED is sent or 
             * throw away the transaction's contents when a ROLLBACK PREPARED 
             * is received. In the future we could add code to expose prepared 
             * transactions in the changestream allowing for a kind of 
             * distributed 2PC. 
             */ 
</span>            <a href="../../../include/replication/reorderbuffer.h.html#LN393"><span class='Ref_to_Proto'>ReorderBufferProcessXid</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN210"><span class='Ref_To_Local'>reorder</span></a><span class='Delimiter'>, </span><a href="../../../include/access/xlogreader.h.html#LN217"><span class='Ref_to_Macro'>XLogRecGetXid</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN211"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="decode.c.html#LN207"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN50"><span class='Ref_to_Member'>origptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected RM_XACT_ID record type: %u"</span><span class='Delimiter'>, </span><a href="decode.c.html#LN212"><span class='Ref_To_Local'>info</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch info &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end DecodeXactOp &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Handle rmgr STANDBY_ID records for DecodeRecordIntoReorderBuffer(). 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN299"></a><span class='Declare_Function'>DecodeStandbyOp</span><span class='Parentheses'>(</span><a href="../../../include/replication/logical.h.html#LN34"><span class='Ref_to_Struct'>LogicalDecodingContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><a href="decode.c.html#LN48"><span class='Ref_to_Struct'>XLogRecordBuffer</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN301"></a>    <a href="snapbuild.c.html#LN152"><span class='Ref_to_Struct'>SnapBuild</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>builder</span> <span class='Operator'>= </span><a href="decode.c.html#LN299"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/logical.h.html#LN45"><span class='Ref_to_Member'>snapshot_builder</span></a><span class='Delimiter'>; 
</span><a name="LN302"></a>    <a href="../../../include/access/xlogreader.h.html#LN68"><span class='Ref_to_Struct'>XLogReaderState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>r</span> <span class='Operator'>= </span><a href="decode.c.html#LN299"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN52"><span class='Ref_to_Member'>record</span></a><span class='Delimiter'>; 
</span><a name="LN303"></a>    <a href="../../../include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>       <span class='Declare_Local'>info</span> <span class='Operator'>= </span><a href="../../../include/access/xlogreader.h.html#LN215"><span class='Ref_to_Macro'>XLogRecGetInfo</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN302"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>) </span><span class='Operator'>& ~</span><a href="../../../include/access/xlogrecord.h.html#LN61"><span class='Ref_to_Const'>XLR_INFO_MASK</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/replication/reorderbuffer.h.html#LN393"><span class='Ref_to_Proto'>ReorderBufferProcessXid</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN299"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/logical.h.html#LN44"><span class='Ref_to_Member'>reorder</span></a><span class='Delimiter'>, </span><a href="../../../include/access/xlogreader.h.html#LN217"><span class='Ref_to_Macro'>XLogRecGetXid</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN302"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="decode.c.html#LN299"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN50"><span class='Ref_to_Member'>origptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="decode.c.html#LN303"><span class='Ref_To_Local'>info</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/storage/standbydefs.h.html#LN34"><span class='Ref_to_Const'>XLOG_RUNNING_XACTS</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN311"></a>                <a href="../../../include/storage/standbydefs.h.html#LN46"><span class='Ref_to_Struct'>xl_running_xacts</span></a> <span class='Operator'>*</span><span class='Declare_Local'>running</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/storage/standbydefs.h.html#LN46"><span class='Ref_to_Struct'>xl_running_xacts</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/access/xlogreader.h.html#LN219"><span class='Ref_to_Macro'>XLogRecGetData</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN302"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="../../../include/replication/snapbuild.h.html#LN85"><span class='Ref_to_Proto'>SnapBuildProcessRunningXacts</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN301"><span class='Ref_To_Local'>builder</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN299"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN50"><span class='Ref_to_Member'>origptr</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN311"><span class='Ref_To_Local'>running</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Abort all transactions that we keep track of, that are 
                 * older than the record's oldestRunningXid. This is the most 
                 * convenient spot for doing so since, in contrast to shutdown 
                 * or end-of-recovery checkpoints, we have information about 
                 * all running transactions which includes prepared ones, 
                 * while shutdown checkpoints just know that no non-prepared 
                 * transactions are in progress. 
                 */ 
</span>                <a href="../../../include/replication/reorderbuffer.h.html#LN379"><span class='Ref_to_Proto'>ReorderBufferAbortOld</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN299"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/logical.h.html#LN44"><span class='Ref_to_Member'>reorder</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN311"><span class='Ref_To_Local'>running</span></a><span class='Operator'>-&GT;</span><a href="../../../include/storage/standbydefs.h.html#LN52"><span class='Ref_to_Member'>oldestRunningXid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/storage/standbydefs.h.html#LN33"><span class='Ref_to_Const'>XLOG_STANDBY_LOCK</span></a><span class='Operator'>: 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/storage/standbydefs.h.html#LN35"><span class='Ref_to_Const'>XLOG_INVALIDATIONS</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN331"></a>                <a href="../../../include/storage/standbydefs.h.html#LN62"><span class='Ref_to_Struct'>xl_invalidations</span></a> <span class='Operator'>*</span><span class='Declare_Local'>invalidations</span> <span class='Operator'>= 
</span>                <span class='Parentheses'>(</span><a href="../../../include/storage/standbydefs.h.html#LN62"><span class='Ref_to_Struct'>xl_invalidations</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/access/xlogreader.h.html#LN219"><span class='Ref_to_Macro'>XLogRecGetData</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN302"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="../../../include/replication/reorderbuffer.h.html#LN391"><span class='Ref_to_Proto'>ReorderBufferImmediateInvalidation</span></a><span class='Parentheses'>( 
</span>                    <a href="decode.c.html#LN299"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/logical.h.html#LN44"><span class='Ref_to_Member'>reorder</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN331"><span class='Ref_To_Local'>invalidations</span></a><span class='Operator'>-&GT;</span><a href="../../../include/storage/standbydefs.h.html#LN67"><span class='Ref_to_Member'>nmsgs</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN331"><span class='Ref_To_Local'>invalidations</span></a><span class='Operator'>-&GT;</span><a href="../../../include/storage/standbydefs.h.html#LN68"><span class='Ref_to_Member'>msgs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected RM_STANDBY_ID record type: %u"</span><span class='Delimiter'>, </span><a href="decode.c.html#LN303"><span class='Ref_To_Local'>info</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch info &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end DecodeStandbyOp &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Handle rmgr HEAP2_ID records for DecodeRecordIntoReorderBuffer(). 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN347"></a><span class='Declare_Function'>DecodeHeap2Op</span><span class='Parentheses'>(</span><a href="../../../include/replication/logical.h.html#LN34"><span class='Ref_to_Struct'>LogicalDecodingContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><a href="decode.c.html#LN48"><span class='Ref_to_Struct'>XLogRecordBuffer</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN349"></a>    <a href="../../../include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>       <span class='Declare_Local'>info</span> <span class='Operator'>= </span><a href="../../../include/access/xlogreader.h.html#LN215"><span class='Ref_to_Macro'>XLogRecGetInfo</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN347"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN52"><span class='Ref_to_Member'>record</span></a><span class='Parentheses'>) </span><span class='Operator'>& </span><a href="../../../include/access/heapam_xlog.h.html#LN40"><span class='Ref_to_Const'>XLOG_HEAP_OPMASK</span></a><span class='Delimiter'>; 
</span><a name="LN350"></a>    <a href="../../../include/c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Declare_Local'>xid</span> <span class='Operator'>= </span><a href="../../../include/access/xlogreader.h.html#LN217"><span class='Ref_to_Macro'>XLogRecGetXid</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN347"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN52"><span class='Ref_to_Member'>record</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN351"></a>    <a href="snapbuild.c.html#LN152"><span class='Ref_to_Struct'>SnapBuild</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>builder</span> <span class='Operator'>= </span><a href="decode.c.html#LN347"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/logical.h.html#LN45"><span class='Ref_to_Member'>snapshot_builder</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/replication/reorderbuffer.h.html#LN393"><span class='Ref_to_Proto'>ReorderBufferProcessXid</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN347"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/logical.h.html#LN44"><span class='Ref_to_Member'>reorder</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN350"><span class='Ref_To_Local'>xid</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN347"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN50"><span class='Ref_to_Member'>origptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* no point in doing anything yet */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/replication/snapbuild.h.html#LN72"><span class='Ref_to_Proto'>SnapBuildCurrentState</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN351"><span class='Ref_To_Local'>builder</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><a href="../../../include/replication/snapbuild.h.html#LN38"><span class='Ref_to_EnumConst'>SNAPBUILD_FULL_SNAPSHOT</span></a><span class='Parentheses'>)</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="decode.c.html#LN349"><span class='Ref_To_Local'>info</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/access/heapam_xlog.h.html#LN57"><span class='Ref_to_Const'>XLOG_HEAP2_MULTI_INSERT</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/replication/snapbuild.h.html#LN81"><span class='Ref_to_Proto'>SnapBuildProcessChange</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN351"><span class='Ref_To_Local'>builder</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN350"><span class='Ref_To_Local'>xid</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN347"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN50"><span class='Ref_to_Member'>origptr</span></a><span class='Parentheses'>))</span> 
                <a href="decode.c.html#LN67"><span class='Ref_to_Proto'>DecodeMultiInsert</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN347"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN347"><span class='Ref_to_Parameter'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/access/heapam_xlog.h.html#LN59"><span class='Ref_to_Const'>XLOG_HEAP2_NEW_CID</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN367"></a>                <a href="../../../include/access/heapam_xlog.h.html#LN332"><span class='Ref_to_Struct'>xl_heap_new_cid</span></a> <span class='Operator'>*</span><span class='Declare_Local'>xlrec</span><span class='Delimiter'>; 
</span> 
                <a href="decode.c.html#LN367"><span class='Ref_To_Local'>xlrec</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/heapam_xlog.h.html#LN332"><span class='Ref_to_Struct'>xl_heap_new_cid</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/access/xlogreader.h.html#LN219"><span class='Ref_to_Macro'>XLogRecGetData</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN347"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN52"><span class='Ref_to_Member'>record</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../../include/replication/snapbuild.h.html#LN83"><span class='Ref_to_Proto'>SnapBuildProcessNewCid</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN351"><span class='Ref_To_Local'>builder</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN350"><span class='Ref_To_Local'>xid</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN347"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN50"><span class='Ref_to_Member'>origptr</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN367"><span class='Ref_To_Local'>xlrec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Control'>case</span> <a href="../../../include/access/heapam_xlog.h.html#LN52"><span class='Ref_to_Const'>XLOG_HEAP2_REWRITE</span></a><span class='Operator'>: 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Although these records only exist to serve the needs of logical 
             * decoding, all the work happens as part of crash or archive 
             * recovery, so we don't need to do anything here. 
             */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Everything else here is just low level physical stuff we're not 
             * interested in. 
             */ 
</span>        <span class='Control'>case</span> <a href="../../../include/access/heapam_xlog.h.html#LN54"><span class='Ref_to_Const'>XLOG_HEAP2_FREEZE_PAGE</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/access/heapam_xlog.h.html#LN53"><span class='Ref_to_Const'>XLOG_HEAP2_CLEAN</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/access/heapam_xlog.h.html#LN55"><span class='Ref_to_Const'>XLOG_HEAP2_CLEANUP_INFO</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/access/heapam_xlog.h.html#LN56"><span class='Ref_to_Const'>XLOG_HEAP2_VISIBLE</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/access/heapam_xlog.h.html#LN58"><span class='Ref_to_Const'>XLOG_HEAP2_LOCK_UPDATED</span></a><span class='Operator'>: 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected RM_HEAP2_ID record type: %u"</span><span class='Delimiter'>, </span><a href="decode.c.html#LN349"><span class='Ref_To_Local'>info</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch info &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end DecodeHeap2Op &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Handle rmgr HEAP_ID records for DecodeRecordIntoReorderBuffer(). 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN402"></a><span class='Declare_Function'>DecodeHeapOp</span><span class='Parentheses'>(</span><a href="../../../include/replication/logical.h.html#LN34"><span class='Ref_to_Struct'>LogicalDecodingContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><a href="decode.c.html#LN48"><span class='Ref_to_Struct'>XLogRecordBuffer</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN404"></a>    <a href="../../../include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>       <span class='Declare_Local'>info</span> <span class='Operator'>= </span><a href="../../../include/access/xlogreader.h.html#LN215"><span class='Ref_to_Macro'>XLogRecGetInfo</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN402"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN52"><span class='Ref_to_Member'>record</span></a><span class='Parentheses'>) </span><span class='Operator'>& </span><a href="../../../include/access/heapam_xlog.h.html#LN40"><span class='Ref_to_Const'>XLOG_HEAP_OPMASK</span></a><span class='Delimiter'>; 
</span><a name="LN405"></a>    <a href="../../../include/c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Declare_Local'>xid</span> <span class='Operator'>= </span><a href="../../../include/access/xlogreader.h.html#LN217"><span class='Ref_to_Macro'>XLogRecGetXid</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN402"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN52"><span class='Ref_to_Member'>record</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN406"></a>    <a href="snapbuild.c.html#LN152"><span class='Ref_to_Struct'>SnapBuild</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>builder</span> <span class='Operator'>= </span><a href="decode.c.html#LN402"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/logical.h.html#LN45"><span class='Ref_to_Member'>snapshot_builder</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/replication/reorderbuffer.h.html#LN393"><span class='Ref_to_Proto'>ReorderBufferProcessXid</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN402"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/logical.h.html#LN44"><span class='Ref_to_Member'>reorder</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN405"><span class='Ref_To_Local'>xid</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN402"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN50"><span class='Ref_to_Member'>origptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* no point in doing anything yet */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/replication/snapbuild.h.html#LN72"><span class='Ref_to_Proto'>SnapBuildCurrentState</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN406"><span class='Ref_To_Local'>builder</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><a href="../../../include/replication/snapbuild.h.html#LN38"><span class='Ref_to_EnumConst'>SNAPBUILD_FULL_SNAPSHOT</span></a><span class='Parentheses'>)</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="decode.c.html#LN404"><span class='Ref_To_Local'>info</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/access/heapam_xlog.h.html#LN31"><span class='Ref_to_Const'>XLOG_HEAP_INSERT</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/replication/snapbuild.h.html#LN81"><span class='Ref_to_Proto'>SnapBuildProcessChange</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN406"><span class='Ref_To_Local'>builder</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN405"><span class='Ref_To_Local'>xid</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN402"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN50"><span class='Ref_to_Member'>origptr</span></a><span class='Parentheses'>))</span> 
                <a href="decode.c.html#LN64"><span class='Ref_to_Proto'>DecodeInsert</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN402"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN402"><span class='Ref_to_Parameter'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Treat HOT update as normal updates. There is no useful 
             * information in the fact that we could make it a HOT update 
             * locally and the WAL layout is compatible. 
             */ 
</span>        <span class='Control'>case</span> <a href="../../../include/access/heapam_xlog.h.html#LN35"><span class='Ref_to_Const'>XLOG_HEAP_HOT_UPDATE</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/access/heapam_xlog.h.html#LN33"><span class='Ref_to_Const'>XLOG_HEAP_UPDATE</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/replication/snapbuild.h.html#LN81"><span class='Ref_to_Proto'>SnapBuildProcessChange</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN406"><span class='Ref_To_Local'>builder</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN405"><span class='Ref_To_Local'>xid</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN402"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN50"><span class='Ref_to_Member'>origptr</span></a><span class='Parentheses'>))</span> 
                <a href="decode.c.html#LN65"><span class='Ref_to_Proto'>DecodeUpdate</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN402"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN402"><span class='Ref_to_Parameter'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/access/heapam_xlog.h.html#LN32"><span class='Ref_to_Const'>XLOG_HEAP_DELETE</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/replication/snapbuild.h.html#LN81"><span class='Ref_to_Proto'>SnapBuildProcessChange</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN406"><span class='Ref_To_Local'>builder</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN405"><span class='Ref_To_Local'>xid</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN402"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN50"><span class='Ref_to_Member'>origptr</span></a><span class='Parentheses'>))</span> 
                <a href="decode.c.html#LN66"><span class='Ref_to_Proto'>DecodeDelete</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN402"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN402"><span class='Ref_to_Parameter'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/access/heapam_xlog.h.html#LN38"><span class='Ref_to_Const'>XLOG_HEAP_INPLACE</span></a><span class='Operator'>: 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Inplace updates are only ever performed on catalog tuples and 
             * can, per definition, not change tuple visibility.  Since we 
             * don't decode catalog tuples, we're not interested in the 
             * record's contents. 
             * 
             * In-place updates can be used either by XID-bearing transactions 
             * (e.g.  in CREATE INDEX CONCURRENTLY) or by XID-less 
             * transactions (e.g.  VACUUM).  In the former case, the commit 
             * record will include cache invalidations, so we mark the 
             * transaction as catalog modifying here. Currently that's 
             * redundant because the commit will do that as well, but once we 
             * support decoding in-progress relations, this will be important. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/transam.h.html#LN40"><span class='Ref_to_Macro'>TransactionIdIsValid</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN405"><span class='Ref_To_Local'>xid</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <a href="../../../include/replication/snapbuild.h.html#LN81"><span class='Ref_to_Proto'>SnapBuildProcessChange</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN406"><span class='Ref_To_Local'>builder</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN405"><span class='Ref_To_Local'>xid</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN402"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN50"><span class='Ref_to_Member'>origptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/replication/reorderbuffer.h.html#LN394"><span class='Ref_to_Proto'>ReorderBufferXidSetCatalogChanges</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN402"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/logical.h.html#LN44"><span class='Ref_to_Member'>reorder</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN405"><span class='Ref_To_Local'>xid</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN402"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN50"><span class='Ref_to_Member'>origptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/access/heapam_xlog.h.html#LN36"><span class='Ref_to_Const'>XLOG_HEAP_CONFIRM</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/replication/snapbuild.h.html#LN81"><span class='Ref_to_Proto'>SnapBuildProcessChange</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN406"><span class='Ref_To_Local'>builder</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN405"><span class='Ref_To_Local'>xid</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN402"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN50"><span class='Ref_to_Member'>origptr</span></a><span class='Parentheses'>))</span> 
                <a href="decode.c.html#LN68"><span class='Ref_to_Proto'>DecodeSpecConfirm</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN402"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN402"><span class='Ref_to_Parameter'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/access/heapam_xlog.h.html#LN37"><span class='Ref_to_Const'>XLOG_HEAP_LOCK</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* we don't care about row level locks for now */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected RM_HEAP_ID record type: %u"</span><span class='Delimiter'>, </span><a href="decode.c.html#LN404"><span class='Ref_To_Local'>info</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch info &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end DecodeHeapOp &raquo; </span> 
 
<span class='Keyword'>static inline bool 
</span><a name="LN476"></a><span class='Declare_Function'>FilterByOrigin</span><span class='Parentheses'>(</span><a href="../../../include/replication/logical.h.html#LN34"><span class='Ref_to_Struct'>LogicalDecodingContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><a href="../../../include/access/xlogdefs.h.html#LN50"><span class='Ref_to_Typedef'>RepOriginId</span></a> <span class='Declare_Parameter'>origin_id</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="decode.c.html#LN476"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/logical.h.html#LN47"><span class='Ref_to_Member'>callbacks</span></a><span class='Operator'>.</span><a href="../../../include/replication/output_plugin.h.html#LN101"><span class='Ref_to_Member'>filter_by_origin_cb</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../../include/replication/logical.h.html#LN112"><span class='Ref_to_Proto'>filter_by_origin_cb_wrapper</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN476"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN476"><span class='Ref_to_Parameter'>origin_id</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Handle rmgr LOGICALMSG_ID records for DecodeRecordIntoReorderBuffer(). 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN488"></a><span class='Declare_Function'>DecodeLogicalMsgOp</span><span class='Parentheses'>(</span><a href="../../../include/replication/logical.h.html#LN34"><span class='Ref_to_Struct'>LogicalDecodingContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><a href="decode.c.html#LN48"><span class='Ref_to_Struct'>XLogRecordBuffer</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN490"></a>    <a href="snapbuild.c.html#LN152"><span class='Ref_to_Struct'>SnapBuild</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>builder</span> <span class='Operator'>= </span><a href="decode.c.html#LN488"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/logical.h.html#LN45"><span class='Ref_to_Member'>snapshot_builder</span></a><span class='Delimiter'>; 
</span><a name="LN491"></a>    <a href="../../../include/access/xlogreader.h.html#LN68"><span class='Ref_to_Struct'>XLogReaderState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>r</span> <span class='Operator'>= </span><a href="decode.c.html#LN488"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN52"><span class='Ref_to_Member'>record</span></a><span class='Delimiter'>; 
</span><a name="LN492"></a>    <a href="../../../include/c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Declare_Local'>xid</span> <span class='Operator'>= </span><a href="../../../include/access/xlogreader.h.html#LN217"><span class='Ref_to_Macro'>XLogRecGetXid</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN491"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN493"></a>    <a href="../../../include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>       <span class='Declare_Local'>info</span> <span class='Operator'>= </span><a href="../../../include/access/xlogreader.h.html#LN215"><span class='Ref_to_Macro'>XLogRecGetInfo</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN491"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>) </span><span class='Operator'>& ~</span><a href="../../../include/access/xlogrecord.h.html#LN61"><span class='Ref_to_Const'>XLR_INFO_MASK</span></a><span class='Delimiter'>; 
</span><a name="LN494"></a>    <a href="../../../include/access/xlogdefs.h.html#LN50"><span class='Ref_to_Typedef'>RepOriginId</span></a> <span class='Declare_Local'>origin_id</span> <span class='Operator'>= </span><a href="../../../include/access/xlogreader.h.html#LN218"><span class='Ref_to_Macro'>XLogRecGetOrigin</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN491"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN495"></a>    <a href="../../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a>    <span class='Declare_Local'>snapshot</span><span class='Delimiter'>; 
</span><a name="LN496"></a>    <a href="../../../include/replication/message.h.html#LN19"><span class='Ref_to_Struct'>xl_logical_message</span></a> <span class='Operator'>*</span><span class='Declare_Local'>message</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="decode.c.html#LN493"><span class='Ref_To_Local'>info</span></a> <span class='Operator'>!= </span><a href="../../../include/replication/message.h.html#LN36"><span class='Ref_to_Const'>XLOG_LOGICAL_MESSAGE</span></a><span class='Parentheses'>) 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected RM_LOGICALMSG_ID record type: %u"</span><span class='Delimiter'>, </span><a href="decode.c.html#LN493"><span class='Ref_To_Local'>info</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/replication/reorderbuffer.h.html#LN393"><span class='Ref_to_Proto'>ReorderBufferProcessXid</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN488"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/logical.h.html#LN44"><span class='Ref_to_Member'>reorder</span></a><span class='Delimiter'>, </span><a href="../../../include/access/xlogreader.h.html#LN217"><span class='Ref_to_Macro'>XLogRecGetXid</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN491"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="decode.c.html#LN488"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN50"><span class='Ref_to_Member'>origptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* No point in doing anything yet. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/replication/snapbuild.h.html#LN72"><span class='Ref_to_Proto'>SnapBuildCurrentState</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN490"><span class='Ref_To_Local'>builder</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><a href="../../../include/replication/snapbuild.h.html#LN38"><span class='Ref_to_EnumConst'>SNAPBUILD_FULL_SNAPSHOT</span></a><span class='Parentheses'>)</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="decode.c.html#LN496"><span class='Ref_To_Local'>message</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/replication/message.h.html#LN19"><span class='Ref_to_Struct'>xl_logical_message</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/access/xlogreader.h.html#LN219"><span class='Ref_to_Macro'>XLogRecGetData</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN491"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="decode.c.html#LN496"><span class='Ref_To_Local'>message</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/message.h.html#LN21"><span class='Ref_to_Member'>dbId</span></a> <span class='Operator'>!= </span><a href="decode.c.html#LN488"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/logical.h.html#LN40"><span class='Ref_to_Member'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/slot.h.html#LN114"><span class='Ref_to_Member'>data</span></a><span class='Operator'>.</span><a href="../../../include/replication/slot.h.html#LN43"><span class='Ref_to_Member'>database</span></a> <span class='Operator'>|| 
</span>        <a href="decode.c.html#LN475"><span class='Ref_to_Func'>FilterByOrigin</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN488"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN494"><span class='Ref_To_Local'>origin_id</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="decode.c.html#LN496"><span class='Ref_To_Local'>message</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/message.h.html#LN22"><span class='Ref_to_Member'>transactional</span></a> <span class='Operator'>&& 
</span>        <span class='Operator'>!</span><a href="../../../include/replication/snapbuild.h.html#LN81"><span class='Ref_to_Proto'>SnapBuildProcessChange</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN490"><span class='Ref_To_Local'>builder</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN492"><span class='Ref_To_Local'>xid</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN488"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN50"><span class='Ref_to_Member'>origptr</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="decode.c.html#LN496"><span class='Ref_To_Local'>message</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/message.h.html#LN22"><span class='Ref_to_Member'>transactional</span></a> <span class='Operator'>&& 
</span>             <span class='Parentheses'>(</span><a href="../../../include/replication/snapbuild.h.html#LN72"><span class='Ref_to_Proto'>SnapBuildCurrentState</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN490"><span class='Ref_To_Local'>builder</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../../include/replication/snapbuild.h.html#LN45"><span class='Ref_to_EnumConst'>SNAPBUILD_CONSISTENT</span></a> <span class='Operator'>|| 
</span>              <a href="../../../include/replication/snapbuild.h.html#LN76"><span class='Ref_to_Proto'>SnapBuildXactNeedsSkip</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN490"><span class='Ref_To_Local'>builder</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN488"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN50"><span class='Ref_to_Member'>origptr</span></a><span class='Parentheses'>)))</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="decode.c.html#LN495"><span class='Ref_To_Local'>snapshot</span></a> <span class='Operator'>= </span><a href="../../../include/replication/snapbuild.h.html#LN73"><span class='Ref_to_Proto'>SnapBuildGetOrBuildSnapshot</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN490"><span class='Ref_To_Local'>builder</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN492"><span class='Ref_To_Local'>xid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/replication/reorderbuffer.h.html#LN369"><span class='Ref_to_Proto'>ReorderBufferQueueMessage</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN488"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/logical.h.html#LN44"><span class='Ref_to_Member'>reorder</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN492"><span class='Ref_To_Local'>xid</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN495"><span class='Ref_To_Local'>snapshot</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN488"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN51"><span class='Ref_to_Member'>endptr</span></a><span class='Delimiter'>, 
</span>                              <a href="decode.c.html#LN496"><span class='Ref_To_Local'>message</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/message.h.html#LN22"><span class='Ref_to_Member'>transactional</span></a><span class='Delimiter'>, 
</span>                              <a href="decode.c.html#LN496"><span class='Ref_To_Local'>message</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/message.h.html#LN25"><span class='Ref_to_Member'>message</span></a><span class='Delimiter'>, </span><span class='Comment_Multi_Line'>/* first part of message is 
                                                 * prefix */ 
</span>                              <a href="decode.c.html#LN496"><span class='Ref_To_Local'>message</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/message.h.html#LN24"><span class='Ref_to_Member'>message_size</span></a><span class='Delimiter'>, 
</span>                              <a href="decode.c.html#LN496"><span class='Ref_To_Local'>message</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/message.h.html#LN25"><span class='Ref_to_Member'>message</span></a> <span class='Operator'>+ </span><a href="decode.c.html#LN496"><span class='Ref_To_Local'>message</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/message.h.html#LN23"><span class='Ref_to_Member'>prefix_size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end DecodeLogicalMsgOp &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Consolidated commit record handling between the different form of commit 
 * records. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN535"></a><span class='Declare_Function'>DecodeCommit</span><span class='Parentheses'>(</span><a href="../../../include/replication/logical.h.html#LN34"><span class='Ref_to_Struct'>LogicalDecodingContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><a href="decode.c.html#LN48"><span class='Ref_to_Struct'>XLogRecordBuffer</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Delimiter'>, 
</span><a name="LN536"></a>             <a href="../../../include/access/xact.h.html#LN286"><span class='Ref_to_Struct'>xl_xact_parsed_commit</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>parsed</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Declare_Parameter'>xid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN538"></a>    <a href="../../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a>  <span class='Declare_Local'>origin_lsn</span> <span class='Operator'>= </span><a href="../../../include/access/xlogdefs.h.html#LN27"><span class='Ref_to_Const'>InvalidXLogRecPtr</span></a><span class='Delimiter'>; 
</span><a name="LN539"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>commit_time</span> <span class='Operator'>= </span><a href="decode.c.html#LN536"><span class='Ref_to_Parameter'>parsed</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/xact.h.html#LN288"><span class='Ref_to_Member'>xact_time</span></a><span class='Delimiter'>; 
</span><a name="LN540"></a>    <a href="../../../include/access/xlogdefs.h.html#LN50"><span class='Ref_to_Typedef'>RepOriginId</span></a> <span class='Declare_Local'>origin_id</span> <span class='Operator'>= </span><a href="../../../include/access/xlogreader.h.html#LN218"><span class='Ref_to_Macro'>XLogRecGetOrigin</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN535"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN52"><span class='Ref_to_Member'>record</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN541"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="decode.c.html#LN536"><span class='Ref_to_Parameter'>parsed</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/xact.h.html#LN290"><span class='Ref_to_Member'>xinfo</span></a> <span class='Operator'>& </span><a href="../../../include/access/xact.h.html#LN157"><span class='Ref_to_Const'>XACT_XINFO_HAS_ORIGIN</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="decode.c.html#LN538"><span class='Ref_To_Local'>origin_lsn</span></a> <span class='Operator'>= </span><a href="decode.c.html#LN536"><span class='Ref_to_Parameter'>parsed</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/xact.h.html#LN306"><span class='Ref_to_Member'>origin_lsn</span></a><span class='Delimiter'>; 
</span>        <a href="decode.c.html#LN539"><span class='Ref_To_Local'>commit_time</span></a> <span class='Operator'>= </span><a href="decode.c.html#LN536"><span class='Ref_to_Parameter'>parsed</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/xact.h.html#LN307"><span class='Ref_to_Member'>origin_timestamp</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Process invalidation messages, even if we're not interested in the 
     * transaction's contents, since the various caches need to always be 
     * consistent. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="decode.c.html#LN536"><span class='Ref_to_Parameter'>parsed</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/xact.h.html#LN301"><span class='Ref_to_Member'>nmsgs</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/replication/reorderbuffer.h.html#LN389"><span class='Ref_to_Proto'>ReorderBufferAddInvalidations</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN535"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/logical.h.html#LN44"><span class='Ref_to_Member'>reorder</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN536"><span class='Ref_to_Parameter'>xid</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN535"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN50"><span class='Ref_to_Member'>origptr</span></a><span class='Delimiter'>, 
</span>                                      <a href="decode.c.html#LN536"><span class='Ref_to_Parameter'>parsed</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/xact.h.html#LN301"><span class='Ref_to_Member'>nmsgs</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN536"><span class='Ref_to_Parameter'>parsed</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/xact.h.html#LN302"><span class='Ref_to_Member'>msgs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/replication/reorderbuffer.h.html#LN394"><span class='Ref_to_Proto'>ReorderBufferXidSetCatalogChanges</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN535"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/logical.h.html#LN44"><span class='Ref_to_Member'>reorder</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN536"><span class='Ref_to_Parameter'>xid</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN535"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN50"><span class='Ref_to_Member'>origptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/replication/snapbuild.h.html#LN78"><span class='Ref_to_Proto'>SnapBuildCommitTxn</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN535"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/logical.h.html#LN45"><span class='Ref_to_Member'>snapshot_builder</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN535"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN50"><span class='Ref_to_Member'>origptr</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN536"><span class='Ref_to_Parameter'>xid</span></a><span class='Delimiter'>, 
</span>                       <a href="decode.c.html#LN536"><span class='Ref_to_Parameter'>parsed</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/xact.h.html#LN295"><span class='Ref_to_Member'>nsubxacts</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN536"><span class='Ref_to_Parameter'>parsed</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/xact.h.html#LN296"><span class='Ref_to_Member'>subxacts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* ---- 
     * Check whether we are interested in this specific transaction, and tell 
     * the reorderbuffer to forget the content of the (sub-)transactions 
     * if not. 
     * 
     * There can be several reasons we might not be interested in this 
     * transaction: 
     * 1) We might not be interested in decoding transactions up to this 
     *    LSN. This can happen because we previously decoded it and now just 
     *    are restarting or if we haven't assembled a consistent snapshot yet. 
     * 2) The transaction happened in another database. 
     * 3) The output plugin is not interested in the origin. 
     * 
     * We can't just use ReorderBufferAbort() here, because we need to execute 
     * the transaction's invalidations.  This currently won't be needed if 
     * we're just skipping over the transaction because currently we only do 
     * so during startup, to get to the first transaction the client needs. As 
     * we have reset the catalog caches before starting to read WAL, and we 
     * haven't yet touched any catalogs, there can't be anything to invalidate. 
     * But if we're "forgetting" this commit because it's it happened in 
     * another database, the invalidations might be important, because they 
     * could be for shared catalogs and we might have loaded data into the 
     * relevant syscaches. 
     * --- 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/replication/snapbuild.h.html#LN76"><span class='Ref_to_Proto'>SnapBuildXactNeedsSkip</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN535"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/logical.h.html#LN45"><span class='Ref_to_Member'>snapshot_builder</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN535"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN50"><span class='Ref_to_Member'>origptr</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>        <span class='Parentheses'>(</span><a href="decode.c.html#LN536"><span class='Ref_to_Parameter'>parsed</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/xact.h.html#LN292"><span class='Ref_to_Member'>dbId</span></a> <span class='Operator'>!= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a> <span class='Operator'>&& </span><a href="decode.c.html#LN536"><span class='Ref_to_Parameter'>parsed</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/xact.h.html#LN292"><span class='Ref_to_Member'>dbId</span></a> <span class='Operator'>!= </span><a href="decode.c.html#LN535"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/logical.h.html#LN40"><span class='Ref_to_Member'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/slot.h.html#LN114"><span class='Ref_to_Member'>data</span></a><span class='Operator'>.</span><a href="../../../include/replication/slot.h.html#LN43"><span class='Ref_to_Member'>database</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>        <a href="decode.c.html#LN475"><span class='Ref_to_Func'>FilterByOrigin</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN535"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN540"><span class='Ref_To_Local'>origin_id</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="decode.c.html#LN541"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="decode.c.html#LN541"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="decode.c.html#LN536"><span class='Ref_to_Parameter'>parsed</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/xact.h.html#LN295"><span class='Ref_to_Member'>nsubxacts</span></a><span class='Delimiter'>; </span><a href="decode.c.html#LN541"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../include/replication/reorderbuffer.h.html#LN380"><span class='Ref_to_Proto'>ReorderBufferForget</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN535"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/logical.h.html#LN44"><span class='Ref_to_Member'>reorder</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN536"><span class='Ref_to_Parameter'>parsed</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/xact.h.html#LN296"><span class='Ref_to_Member'>subxacts</span></a><span class='Delimiter'>[</span><a href="decode.c.html#LN541"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="decode.c.html#LN535"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN50"><span class='Ref_to_Member'>origptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../../include/replication/reorderbuffer.h.html#LN380"><span class='Ref_to_Proto'>ReorderBufferForget</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN535"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/logical.h.html#LN44"><span class='Ref_to_Member'>reorder</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN536"><span class='Ref_to_Parameter'>xid</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN535"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN50"><span class='Ref_to_Member'>origptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* tell the reorderbuffer about the surviving subtransactions */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="decode.c.html#LN541"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="decode.c.html#LN541"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="decode.c.html#LN536"><span class='Ref_to_Parameter'>parsed</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/xact.h.html#LN295"><span class='Ref_to_Member'>nsubxacts</span></a><span class='Delimiter'>; </span><a href="decode.c.html#LN541"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/replication/reorderbuffer.h.html#LN376"><span class='Ref_to_Proto'>ReorderBufferCommitChild</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN535"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/logical.h.html#LN44"><span class='Ref_to_Member'>reorder</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN536"><span class='Ref_to_Parameter'>xid</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN536"><span class='Ref_to_Parameter'>parsed</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/xact.h.html#LN296"><span class='Ref_to_Member'>subxacts</span></a><span class='Delimiter'>[</span><a href="decode.c.html#LN541"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                                 <a href="decode.c.html#LN535"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN50"><span class='Ref_to_Member'>origptr</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN535"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN51"><span class='Ref_to_Member'>endptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* replay actions of all transaction + subtransactions in order */ 
</span>    <a href="../../../include/replication/reorderbuffer.h.html#LN372"><span class='Ref_to_Proto'>ReorderBufferCommit</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN535"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/logical.h.html#LN44"><span class='Ref_to_Member'>reorder</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN536"><span class='Ref_to_Parameter'>xid</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN535"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN50"><span class='Ref_to_Member'>origptr</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN535"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN51"><span class='Ref_to_Member'>endptr</span></a><span class='Delimiter'>, 
</span>                        <a href="decode.c.html#LN539"><span class='Ref_To_Local'>commit_time</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN540"><span class='Ref_To_Local'>origin_id</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN538"><span class='Ref_To_Local'>origin_lsn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end DecodeCommit &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Get the data from the various forms of abort records and pass it on to 
 * snapbuild.c and reorderbuffer.c 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN619"></a><span class='Declare_Function'>DecodeAbort</span><span class='Parentheses'>(</span><a href="../../../include/replication/logical.h.html#LN34"><span class='Ref_to_Struct'>LogicalDecodingContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><a href="decode.c.html#LN48"><span class='Ref_to_Struct'>XLogRecordBuffer</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Delimiter'>, 
</span><a name="LN620"></a>            <a href="../../../include/access/xact.h.html#LN310"><span class='Ref_to_Struct'>xl_xact_parsed_abort</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>parsed</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Declare_Parameter'>xid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN622"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="decode.c.html#LN622"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="decode.c.html#LN622"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="decode.c.html#LN620"><span class='Ref_to_Parameter'>parsed</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/xact.h.html#LN315"><span class='Ref_to_Member'>nsubxacts</span></a><span class='Delimiter'>; </span><a href="decode.c.html#LN622"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/replication/reorderbuffer.h.html#LN378"><span class='Ref_to_Proto'>ReorderBufferAbort</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN619"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/logical.h.html#LN44"><span class='Ref_to_Member'>reorder</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN620"><span class='Ref_to_Parameter'>parsed</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/xact.h.html#LN316"><span class='Ref_to_Member'>subxacts</span></a><span class='Delimiter'>[</span><a href="decode.c.html#LN622"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                           <a href="decode.c.html#LN619"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN52"><span class='Ref_to_Member'>record</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/xlogreader.h.html#LN114"><span class='Ref_to_Member'>EndRecPtr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/replication/reorderbuffer.h.html#LN378"><span class='Ref_to_Proto'>ReorderBufferAbort</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN619"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/logical.h.html#LN44"><span class='Ref_to_Member'>reorder</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN620"><span class='Ref_to_Parameter'>xid</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN619"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN52"><span class='Ref_to_Member'>record</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/xlogreader.h.html#LN114"><span class='Ref_to_Member'>EndRecPtr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Parse XLOG_HEAP_INSERT (not MULTI_INSERT!) records into tuplebufs. 
 * 
 * Deletes can contain the new tuple. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN639"></a><span class='Declare_Function'>DecodeInsert</span><span class='Parentheses'>(</span><a href="../../../include/replication/logical.h.html#LN34"><span class='Ref_to_Struct'>LogicalDecodingContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><a href="decode.c.html#LN48"><span class='Ref_to_Struct'>XLogRecordBuffer</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN641"></a>    <a href="../../../include/access/xlogreader.h.html#LN68"><span class='Ref_to_Struct'>XLogReaderState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>r</span> <span class='Operator'>= </span><a href="decode.c.html#LN639"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN52"><span class='Ref_to_Member'>record</span></a><span class='Delimiter'>; 
</span><a name="LN642"></a>    <a href="../../../include/access/heapam_xlog.h.html#LN129"><span class='Ref_to_Struct'>xl_heap_insert</span></a> <span class='Operator'>*</span><span class='Declare_Local'>xlrec</span><span class='Delimiter'>; 
</span><a name="LN643"></a>    <a href="../../../include/replication/reorderbuffer.h.html#LN71"><span class='Ref_to_Struct'>ReorderBufferChange</span></a> <span class='Operator'>*</span><span class='Declare_Local'>change</span><span class='Delimiter'>; 
</span><a name="LN644"></a>    <a href="../../../include/storage/relfilenode.h.html#LN56"><span class='Ref_to_Struct'>RelFileNode</span></a> <span class='Declare_Local'>target_node</span><span class='Delimiter'>; 
</span> 
    <a href="decode.c.html#LN642"><span class='Ref_To_Local'>xlrec</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/heapam_xlog.h.html#LN129"><span class='Ref_to_Struct'>xl_heap_insert</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/access/xlogreader.h.html#LN219"><span class='Ref_to_Macro'>XLogRecGetData</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN641"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* only interested in our database */ 
</span>    <a href="../../../include/access/xlogreader.h.html#LN231"><span class='Ref_to_Proto'>XLogRecGetBlockTag</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN641"><span class='Ref_To_Local'>r</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="decode.c.html#LN644"><span class='Ref_To_Local'>target_node</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="decode.c.html#LN644"><span class='Ref_To_Local'>target_node</span></a><span class='Operator'>.</span><a href="../../../include/storage/relfilenode.h.html#LN59"><span class='Ref_to_Member'>dbNode</span></a> <span class='Operator'>!= </span><a href="decode.c.html#LN639"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/logical.h.html#LN40"><span class='Ref_to_Member'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/slot.h.html#LN114"><span class='Ref_to_Member'>data</span></a><span class='Operator'>.</span><a href="../../../include/replication/slot.h.html#LN43"><span class='Ref_to_Member'>database</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* output plugin doesn't look for this origin, no need to queue */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="decode.c.html#LN475"><span class='Ref_to_Func'>FilterByOrigin</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN639"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="../../../include/access/xlogreader.h.html#LN218"><span class='Ref_to_Macro'>XLogRecGetOrigin</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN641"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>)))</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="decode.c.html#LN643"><span class='Ref_To_Local'>change</span></a> <span class='Operator'>= </span><a href="reorderbuffer.c.html#LN345"><span class='Ref_to_Func'>ReorderBufferGetChange</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN639"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/logical.h.html#LN44"><span class='Ref_to_Member'>reorder</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="decode.c.html#LN642"><span class='Ref_To_Local'>xlrec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/heapam_xlog.h.html#LN132"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>& </span><a href="../../../include/access/heapam_xlog.h.html#LN67"><span class='Ref_to_Const'>XLH_INSERT_IS_SPECULATIVE</span></a><span class='Parentheses'>))</span> 
        <a href="decode.c.html#LN643"><span class='Ref_To_Local'>change</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/reorderbuffer.h.html#LN76"><span class='Ref_to_Member'>action</span></a> <span class='Operator'>= </span><a href="../../../include/replication/reorderbuffer.h.html#LN53"><span class='Ref_to_EnumConst'>REORDER_BUFFER_CHANGE_INSERT</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="decode.c.html#LN643"><span class='Ref_To_Local'>change</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/reorderbuffer.h.html#LN76"><span class='Ref_to_Member'>action</span></a> <span class='Operator'>= </span><a href="../../../include/replication/reorderbuffer.h.html#LN60"><span class='Ref_to_EnumConst'>REORDER_BUFFER_CHANGE_INTERNAL_SPEC_INSERT</span></a><span class='Delimiter'>; 
</span>    <a href="decode.c.html#LN643"><span class='Ref_To_Local'>change</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/reorderbuffer.h.html#LN78"><span class='Ref_to_Member'>origin_id</span></a> <span class='Operator'>= </span><a href="../../../include/access/xlogreader.h.html#LN218"><span class='Ref_to_Macro'>XLogRecGetOrigin</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN641"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    memcpy<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="decode.c.html#LN643"><span class='Ref_To_Local'>change</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/reorderbuffer.h.html#LN130"><span class='Ref_to_Member'>data</span></a><span class='Operator'>.</span>tp<span class='Operator'>.</span>relnode<span class='Delimiter'>, </span><span class='Operator'>&</span><a href="decode.c.html#LN644"><span class='Ref_To_Local'>target_node</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/storage/relfilenode.h.html#LN56"><span class='Ref_to_Struct'>RelFileNode</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="decode.c.html#LN642"><span class='Ref_To_Local'>xlrec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/heapam_xlog.h.html#LN132"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>& </span><a href="../../../include/access/heapam_xlog.h.html#LN68"><span class='Ref_to_Const'>XLH_INSERT_CONTAINS_NEW_TUPLE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN668"></a>        <a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>datalen</span><span class='Delimiter'>; 
</span><a name="LN669"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>tupledata</span> <span class='Operator'>= </span><a href="../../../include/access/xlogreader.h.html#LN230"><span class='Ref_to_Proto'>XLogRecGetBlockData</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN641"><span class='Ref_To_Local'>r</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="decode.c.html#LN668"><span class='Ref_To_Local'>datalen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN670"></a>        <a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>tuplelen</span> <span class='Operator'>= </span><a href="decode.c.html#LN668"><span class='Ref_To_Local'>datalen</span></a> <span class='Operator'>- </span><a href="../../../include/access/heapam_xlog.h.html#LN126"><span class='Ref_to_Const'>SizeOfHeapHeader</span></a><span class='Delimiter'>; 
</span> 
        <a href="decode.c.html#LN643"><span class='Ref_To_Local'>change</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/reorderbuffer.h.html#LN130"><span class='Ref_to_Member'>data</span></a><span class='Operator'>.</span>tp<span class='Operator'>.</span>newtuple <span class='Operator'>= 
</span>            <a href="../../../include/replication/reorderbuffer.h.html#LN363"><span class='Ref_to_Proto'>ReorderBufferGetTupleBuf</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN639"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/logical.h.html#LN44"><span class='Ref_to_Member'>reorder</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN670"><span class='Ref_To_Local'>tuplelen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="decode.c.html#LN76"><span class='Ref_to_Proto'>DecodeXLogTuple</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN669"><span class='Ref_To_Local'>tupledata</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN668"><span class='Ref_To_Local'>datalen</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN643"><span class='Ref_To_Local'>change</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/reorderbuffer.h.html#LN130"><span class='Ref_to_Member'>data</span></a><span class='Operator'>.</span>tp<span class='Operator'>.</span>newtuple<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="decode.c.html#LN643"><span class='Ref_To_Local'>change</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/reorderbuffer.h.html#LN130"><span class='Ref_to_Member'>data</span></a><span class='Operator'>.</span>tp<span class='Operator'>.</span>clear_toast_afterwards <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/replication/reorderbuffer.h.html#LN368"><span class='Ref_to_Proto'>ReorderBufferQueueChange</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN639"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/logical.h.html#LN44"><span class='Ref_to_Member'>reorder</span></a><span class='Delimiter'>, </span><a href="../../../include/access/xlogreader.h.html#LN217"><span class='Ref_to_Macro'>XLogRecGetXid</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN641"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="decode.c.html#LN639"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN50"><span class='Ref_to_Member'>origptr</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN643"><span class='Ref_To_Local'>change</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end DecodeInsert &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Parse XLOG_HEAP_UPDATE and XLOG_HEAP_HOT_UPDATE, which have the same layout 
 * in the record, from wal into proper tuplebufs. 
 * 
 * Updates can possibly contain a new tuple and the old primary key. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN690"></a><span class='Declare_Function'>DecodeUpdate</span><span class='Parentheses'>(</span><a href="../../../include/replication/logical.h.html#LN34"><span class='Ref_to_Struct'>LogicalDecodingContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><a href="decode.c.html#LN48"><span class='Ref_to_Struct'>XLogRecordBuffer</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN692"></a>    <a href="../../../include/access/xlogreader.h.html#LN68"><span class='Ref_to_Struct'>XLogReaderState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>r</span> <span class='Operator'>= </span><a href="decode.c.html#LN690"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN52"><span class='Ref_to_Member'>record</span></a><span class='Delimiter'>; 
</span><a name="LN693"></a>    <a href="../../../include/access/heapam_xlog.h.html#LN187"><span class='Ref_to_Struct'>xl_heap_update</span></a> <span class='Operator'>*</span><span class='Declare_Local'>xlrec</span><span class='Delimiter'>; 
</span><a name="LN694"></a>    <a href="../../../include/replication/reorderbuffer.h.html#LN71"><span class='Ref_to_Struct'>ReorderBufferChange</span></a> <span class='Operator'>*</span><span class='Declare_Local'>change</span><span class='Delimiter'>; 
</span><a name="LN695"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>data</span><span class='Delimiter'>; 
</span><a name="LN696"></a>    <a href="../../../include/storage/relfilenode.h.html#LN56"><span class='Ref_to_Struct'>RelFileNode</span></a> <span class='Declare_Local'>target_node</span><span class='Delimiter'>; 
</span> 
    <a href="decode.c.html#LN693"><span class='Ref_To_Local'>xlrec</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/heapam_xlog.h.html#LN187"><span class='Ref_to_Struct'>xl_heap_update</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/access/xlogreader.h.html#LN219"><span class='Ref_to_Macro'>XLogRecGetData</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN692"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* only interested in our database */ 
</span>    <a href="../../../include/access/xlogreader.h.html#LN231"><span class='Ref_to_Proto'>XLogRecGetBlockTag</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN692"><span class='Ref_To_Local'>r</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="decode.c.html#LN696"><span class='Ref_To_Local'>target_node</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="decode.c.html#LN696"><span class='Ref_To_Local'>target_node</span></a><span class='Operator'>.</span><a href="../../../include/storage/relfilenode.h.html#LN59"><span class='Ref_to_Member'>dbNode</span></a> <span class='Operator'>!= </span><a href="decode.c.html#LN690"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/logical.h.html#LN40"><span class='Ref_to_Member'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/slot.h.html#LN114"><span class='Ref_to_Member'>data</span></a><span class='Operator'>.</span><a href="../../../include/replication/slot.h.html#LN43"><span class='Ref_to_Member'>database</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* output plugin doesn't look for this origin, no need to queue */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="decode.c.html#LN475"><span class='Ref_to_Func'>FilterByOrigin</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN690"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="../../../include/access/xlogreader.h.html#LN218"><span class='Ref_to_Macro'>XLogRecGetOrigin</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN692"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>)))</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="decode.c.html#LN694"><span class='Ref_To_Local'>change</span></a> <span class='Operator'>= </span><a href="reorderbuffer.c.html#LN345"><span class='Ref_to_Func'>ReorderBufferGetChange</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN690"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/logical.h.html#LN44"><span class='Ref_to_Member'>reorder</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="decode.c.html#LN694"><span class='Ref_To_Local'>change</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/reorderbuffer.h.html#LN76"><span class='Ref_to_Member'>action</span></a> <span class='Operator'>= </span><a href="../../../include/replication/reorderbuffer.h.html#LN54"><span class='Ref_to_EnumConst'>REORDER_BUFFER_CHANGE_UPDATE</span></a><span class='Delimiter'>; 
</span>    <a href="decode.c.html#LN694"><span class='Ref_To_Local'>change</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/reorderbuffer.h.html#LN78"><span class='Ref_to_Member'>origin_id</span></a> <span class='Operator'>= </span><a href="../../../include/access/xlogreader.h.html#LN218"><span class='Ref_to_Macro'>XLogRecGetOrigin</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN692"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="decode.c.html#LN694"><span class='Ref_To_Local'>change</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/reorderbuffer.h.html#LN130"><span class='Ref_to_Member'>data</span></a><span class='Operator'>.</span>tp<span class='Operator'>.</span>relnode<span class='Delimiter'>, </span><span class='Operator'>&</span><a href="decode.c.html#LN696"><span class='Ref_To_Local'>target_node</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/storage/relfilenode.h.html#LN56"><span class='Ref_to_Struct'>RelFileNode</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="decode.c.html#LN693"><span class='Ref_To_Local'>xlrec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/heapam_xlog.h.html#LN192"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>& </span><a href="../../../include/access/heapam_xlog.h.html#LN79"><span class='Ref_to_Const'>XLH_UPDATE_CONTAINS_NEW_TUPLE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN716"></a>        <a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>datalen</span><span class='Delimiter'>; 
</span><a name="LN717"></a>        <a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>tuplelen</span><span class='Delimiter'>; 
</span> 
        <a href="decode.c.html#LN695"><span class='Ref_To_Local'>data</span></a> <span class='Operator'>= </span><a href="../../../include/access/xlogreader.h.html#LN230"><span class='Ref_to_Proto'>XLogRecGetBlockData</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN692"><span class='Ref_To_Local'>r</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="decode.c.html#LN716"><span class='Ref_To_Local'>datalen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="decode.c.html#LN717"><span class='Ref_To_Local'>tuplelen</span></a> <span class='Operator'>= </span><a href="decode.c.html#LN716"><span class='Ref_To_Local'>datalen</span></a> <span class='Operator'>- </span><a href="../../../include/access/heapam_xlog.h.html#LN126"><span class='Ref_to_Const'>SizeOfHeapHeader</span></a><span class='Delimiter'>; 
</span> 
        <a href="decode.c.html#LN694"><span class='Ref_To_Local'>change</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/reorderbuffer.h.html#LN130"><span class='Ref_to_Member'>data</span></a><span class='Operator'>.</span>tp<span class='Operator'>.</span>newtuple <span class='Operator'>= 
</span>            <a href="../../../include/replication/reorderbuffer.h.html#LN363"><span class='Ref_to_Proto'>ReorderBufferGetTupleBuf</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN690"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/logical.h.html#LN44"><span class='Ref_to_Member'>reorder</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN717"><span class='Ref_To_Local'>tuplelen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="decode.c.html#LN76"><span class='Ref_to_Proto'>DecodeXLogTuple</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN695"><span class='Ref_To_Local'>data</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN716"><span class='Ref_To_Local'>datalen</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN694"><span class='Ref_To_Local'>change</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/reorderbuffer.h.html#LN130"><span class='Ref_to_Member'>data</span></a><span class='Operator'>.</span>tp<span class='Operator'>.</span>newtuple<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="decode.c.html#LN693"><span class='Ref_To_Local'>xlrec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/heapam_xlog.h.html#LN192"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>& </span><a href="../../../include/access/heapam_xlog.h.html#LN84"><span class='Ref_to_Const'>XLH_UPDATE_CONTAINS_OLD</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN731"></a>        <a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>datalen</span><span class='Delimiter'>; 
</span><a name="LN732"></a>        <a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>tuplelen</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* caution, remaining data in record is not aligned */ 
</span>        <a href="decode.c.html#LN695"><span class='Ref_To_Local'>data</span></a> <span class='Operator'>= </span><a href="../../../include/access/xlogreader.h.html#LN219"><span class='Ref_to_Macro'>XLogRecGetData</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN692"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="../../../include/access/heapam_xlog.h.html#LN202"><span class='Ref_to_Const'>SizeOfHeapUpdate</span></a><span class='Delimiter'>; 
</span>        <a href="decode.c.html#LN731"><span class='Ref_To_Local'>datalen</span></a> <span class='Operator'>= </span><a href="../../../include/access/xlogreader.h.html#LN220"><span class='Ref_to_Macro'>XLogRecGetDataLen</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN692"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="../../../include/access/heapam_xlog.h.html#LN202"><span class='Ref_to_Const'>SizeOfHeapUpdate</span></a><span class='Delimiter'>; 
</span>        <a href="decode.c.html#LN732"><span class='Ref_To_Local'>tuplelen</span></a> <span class='Operator'>= </span><a href="decode.c.html#LN731"><span class='Ref_To_Local'>datalen</span></a> <span class='Operator'>- </span><a href="../../../include/access/heapam_xlog.h.html#LN126"><span class='Ref_to_Const'>SizeOfHeapHeader</span></a><span class='Delimiter'>; 
</span> 
        <a href="decode.c.html#LN694"><span class='Ref_To_Local'>change</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/reorderbuffer.h.html#LN130"><span class='Ref_to_Member'>data</span></a><span class='Operator'>.</span>tp<span class='Operator'>.</span>oldtuple <span class='Operator'>= 
</span>            <a href="../../../include/replication/reorderbuffer.h.html#LN363"><span class='Ref_to_Proto'>ReorderBufferGetTupleBuf</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN690"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/logical.h.html#LN44"><span class='Ref_to_Member'>reorder</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN732"><span class='Ref_To_Local'>tuplelen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="decode.c.html#LN76"><span class='Ref_to_Proto'>DecodeXLogTuple</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN695"><span class='Ref_To_Local'>data</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN731"><span class='Ref_To_Local'>datalen</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN694"><span class='Ref_To_Local'>change</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/reorderbuffer.h.html#LN130"><span class='Ref_to_Member'>data</span></a><span class='Operator'>.</span>tp<span class='Operator'>.</span>oldtuple<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="decode.c.html#LN694"><span class='Ref_To_Local'>change</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/reorderbuffer.h.html#LN130"><span class='Ref_to_Member'>data</span></a><span class='Operator'>.</span>tp<span class='Operator'>.</span>clear_toast_afterwards <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/replication/reorderbuffer.h.html#LN368"><span class='Ref_to_Proto'>ReorderBufferQueueChange</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN690"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/logical.h.html#LN44"><span class='Ref_to_Member'>reorder</span></a><span class='Delimiter'>, </span><a href="../../../include/access/xlogreader.h.html#LN217"><span class='Ref_to_Macro'>XLogRecGetXid</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN692"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="decode.c.html#LN690"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN50"><span class='Ref_to_Member'>origptr</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN694"><span class='Ref_To_Local'>change</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end DecodeUpdate &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Parse XLOG_HEAP_DELETE from wal into proper tuplebufs. 
 * 
 * Deletes can possibly contain the old primary key. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN756"></a><span class='Declare_Function'>DecodeDelete</span><span class='Parentheses'>(</span><a href="../../../include/replication/logical.h.html#LN34"><span class='Ref_to_Struct'>LogicalDecodingContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><a href="decode.c.html#LN48"><span class='Ref_to_Struct'>XLogRecordBuffer</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN758"></a>    <a href="../../../include/access/xlogreader.h.html#LN68"><span class='Ref_to_Struct'>XLogReaderState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>r</span> <span class='Operator'>= </span><a href="decode.c.html#LN756"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN52"><span class='Ref_to_Member'>record</span></a><span class='Delimiter'>; 
</span><a name="LN759"></a>    <a href="../../../include/access/heapam_xlog.h.html#LN101"><span class='Ref_to_Struct'>xl_heap_delete</span></a> <span class='Operator'>*</span><span class='Declare_Local'>xlrec</span><span class='Delimiter'>; 
</span><a name="LN760"></a>    <a href="../../../include/replication/reorderbuffer.h.html#LN71"><span class='Ref_to_Struct'>ReorderBufferChange</span></a> <span class='Operator'>*</span><span class='Declare_Local'>change</span><span class='Delimiter'>; 
</span><a name="LN761"></a>    <a href="../../../include/storage/relfilenode.h.html#LN56"><span class='Ref_to_Struct'>RelFileNode</span></a> <span class='Declare_Local'>target_node</span><span class='Delimiter'>; 
</span> 
    <a href="decode.c.html#LN759"><span class='Ref_To_Local'>xlrec</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/heapam_xlog.h.html#LN101"><span class='Ref_to_Struct'>xl_heap_delete</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/access/xlogreader.h.html#LN219"><span class='Ref_to_Macro'>XLogRecGetData</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN758"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* only interested in our database */ 
</span>    <a href="../../../include/access/xlogreader.h.html#LN231"><span class='Ref_to_Proto'>XLogRecGetBlockTag</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN758"><span class='Ref_To_Local'>r</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="decode.c.html#LN761"><span class='Ref_To_Local'>target_node</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="decode.c.html#LN761"><span class='Ref_To_Local'>target_node</span></a><span class='Operator'>.</span><a href="../../../include/storage/relfilenode.h.html#LN59"><span class='Ref_to_Member'>dbNode</span></a> <span class='Operator'>!= </span><a href="decode.c.html#LN756"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/logical.h.html#LN40"><span class='Ref_to_Member'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/slot.h.html#LN114"><span class='Ref_to_Member'>data</span></a><span class='Operator'>.</span><a href="../../../include/replication/slot.h.html#LN43"><span class='Ref_to_Member'>database</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Super deletions are irrelevant for logical decoding, it's driven by the 
     * confirmation records. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="decode.c.html#LN759"><span class='Ref_To_Local'>xlrec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/heapam_xlog.h.html#LN106"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>& </span><a href="../../../include/access/heapam_xlog.h.html#LN94"><span class='Ref_to_Const'>XLH_DELETE_IS_SUPER</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* output plugin doesn't look for this origin, no need to queue */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="decode.c.html#LN475"><span class='Ref_to_Func'>FilterByOrigin</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN756"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="../../../include/access/xlogreader.h.html#LN218"><span class='Ref_to_Macro'>XLogRecGetOrigin</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN758"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>)))</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="decode.c.html#LN760"><span class='Ref_To_Local'>change</span></a> <span class='Operator'>= </span><a href="reorderbuffer.c.html#LN345"><span class='Ref_to_Func'>ReorderBufferGetChange</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN756"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/logical.h.html#LN44"><span class='Ref_to_Member'>reorder</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="decode.c.html#LN760"><span class='Ref_To_Local'>change</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/reorderbuffer.h.html#LN76"><span class='Ref_to_Member'>action</span></a> <span class='Operator'>= </span><a href="../../../include/replication/reorderbuffer.h.html#LN55"><span class='Ref_to_EnumConst'>REORDER_BUFFER_CHANGE_DELETE</span></a><span class='Delimiter'>; 
</span>    <a href="decode.c.html#LN760"><span class='Ref_To_Local'>change</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/reorderbuffer.h.html#LN78"><span class='Ref_to_Member'>origin_id</span></a> <span class='Operator'>= </span><a href="../../../include/access/xlogreader.h.html#LN218"><span class='Ref_to_Macro'>XLogRecGetOrigin</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN758"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    memcpy<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="decode.c.html#LN760"><span class='Ref_To_Local'>change</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/reorderbuffer.h.html#LN130"><span class='Ref_to_Member'>data</span></a><span class='Operator'>.</span>tp<span class='Operator'>.</span>relnode<span class='Delimiter'>, </span><span class='Operator'>&</span><a href="decode.c.html#LN761"><span class='Ref_To_Local'>target_node</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/storage/relfilenode.h.html#LN56"><span class='Ref_to_Struct'>RelFileNode</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* old primary key stored */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="decode.c.html#LN759"><span class='Ref_To_Local'>xlrec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/heapam_xlog.h.html#LN106"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>& </span><a href="../../../include/access/heapam_xlog.h.html#LN97"><span class='Ref_to_Const'>XLH_DELETE_CONTAINS_OLD</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN790"></a>        <a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>datalen</span> <span class='Operator'>= </span><a href="../../../include/access/xlogreader.h.html#LN220"><span class='Ref_to_Macro'>XLogRecGetDataLen</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN758"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="../../../include/access/heapam_xlog.h.html#LN109"><span class='Ref_to_Const'>SizeOfHeapDelete</span></a><span class='Delimiter'>; 
</span><a name="LN791"></a>        <a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>tuplelen</span> <span class='Operator'>= </span><a href="decode.c.html#LN790"><span class='Ref_To_Local'>datalen</span></a> <span class='Operator'>- </span><a href="../../../include/access/heapam_xlog.h.html#LN126"><span class='Ref_to_Const'>SizeOfHeapHeader</span></a><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/access/xlogreader.h.html#LN220"><span class='Ref_to_Macro'>XLogRecGetDataLen</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN758"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Parentheses'>(</span><a href="../../../include/access/heapam_xlog.h.html#LN109"><span class='Ref_to_Const'>SizeOfHeapDelete</span></a> <span class='Operator'>+ </span><a href="../../../include/access/heapam_xlog.h.html#LN126"><span class='Ref_to_Const'>SizeOfHeapHeader</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="decode.c.html#LN760"><span class='Ref_To_Local'>change</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/reorderbuffer.h.html#LN130"><span class='Ref_to_Member'>data</span></a><span class='Operator'>.</span>tp<span class='Operator'>.</span>oldtuple <span class='Operator'>= 
</span>            <a href="../../../include/replication/reorderbuffer.h.html#LN363"><span class='Ref_to_Proto'>ReorderBufferGetTupleBuf</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN756"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/logical.h.html#LN44"><span class='Ref_to_Member'>reorder</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN791"><span class='Ref_To_Local'>tuplelen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="decode.c.html#LN76"><span class='Ref_to_Proto'>DecodeXLogTuple</span></a><span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="decode.c.html#LN759"><span class='Ref_To_Local'>xlrec</span></a> <span class='Operator'>+ </span><a href="../../../include/access/heapam_xlog.h.html#LN109"><span class='Ref_to_Const'>SizeOfHeapDelete</span></a><span class='Delimiter'>, 
</span>                        <a href="decode.c.html#LN790"><span class='Ref_To_Local'>datalen</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN760"><span class='Ref_To_Local'>change</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/reorderbuffer.h.html#LN130"><span class='Ref_to_Member'>data</span></a><span class='Operator'>.</span>tp<span class='Operator'>.</span>oldtuple<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="decode.c.html#LN760"><span class='Ref_To_Local'>change</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/reorderbuffer.h.html#LN130"><span class='Ref_to_Member'>data</span></a><span class='Operator'>.</span>tp<span class='Operator'>.</span>clear_toast_afterwards <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/replication/reorderbuffer.h.html#LN368"><span class='Ref_to_Proto'>ReorderBufferQueueChange</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN756"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/logical.h.html#LN44"><span class='Ref_to_Member'>reorder</span></a><span class='Delimiter'>, </span><a href="../../../include/access/xlogreader.h.html#LN217"><span class='Ref_to_Macro'>XLogRecGetXid</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN758"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="decode.c.html#LN756"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN50"><span class='Ref_to_Member'>origptr</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN760"><span class='Ref_To_Local'>change</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end DecodeDelete &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Decode XLOG_HEAP2_MULTI_INSERT_insert record into multiple tuplebufs. 
 * 
 * Currently MULTI_INSERT will always contain the full tuples. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN813"></a><span class='Declare_Function'>DecodeMultiInsert</span><span class='Parentheses'>(</span><a href="../../../include/replication/logical.h.html#LN34"><span class='Ref_to_Struct'>LogicalDecodingContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><a href="decode.c.html#LN48"><span class='Ref_to_Struct'>XLogRecordBuffer</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN815"></a>    <a href="../../../include/access/xlogreader.h.html#LN68"><span class='Ref_to_Struct'>XLogReaderState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>r</span> <span class='Operator'>= </span><a href="decode.c.html#LN813"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN52"><span class='Ref_to_Member'>record</span></a><span class='Delimiter'>; 
</span><a name="LN816"></a>    <a href="../../../include/access/heapam_xlog.h.html#LN150"><span class='Ref_to_Struct'>xl_heap_multi_insert</span></a> <span class='Operator'>*</span><span class='Declare_Local'>xlrec</span><span class='Delimiter'>; 
</span><a name="LN817"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN818"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>data</span><span class='Delimiter'>; 
</span><a name="LN819"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>tupledata</span><span class='Delimiter'>; 
</span><a name="LN820"></a>    <a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>tuplelen</span><span class='Delimiter'>; 
</span><a name="LN821"></a>    <a href="../../../include/storage/relfilenode.h.html#LN56"><span class='Ref_to_Struct'>RelFileNode</span></a> <span class='Declare_Local'>rnode</span><span class='Delimiter'>; 
</span> 
    <a href="decode.c.html#LN816"><span class='Ref_To_Local'>xlrec</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/heapam_xlog.h.html#LN150"><span class='Ref_to_Struct'>xl_heap_multi_insert</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/access/xlogreader.h.html#LN219"><span class='Ref_to_Macro'>XLogRecGetData</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN815"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* only interested in our database */ 
</span>    <a href="../../../include/access/xlogreader.h.html#LN231"><span class='Ref_to_Proto'>XLogRecGetBlockTag</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN815"><span class='Ref_To_Local'>r</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="decode.c.html#LN821"><span class='Ref_To_Local'>rnode</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="decode.c.html#LN821"><span class='Ref_To_Local'>rnode</span></a><span class='Operator'>.</span><a href="../../../include/storage/relfilenode.h.html#LN59"><span class='Ref_to_Member'>dbNode</span></a> <span class='Operator'>!= </span><a href="decode.c.html#LN813"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/logical.h.html#LN40"><span class='Ref_to_Member'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/slot.h.html#LN114"><span class='Ref_to_Member'>data</span></a><span class='Operator'>.</span><a href="../../../include/replication/slot.h.html#LN43"><span class='Ref_to_Member'>database</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* output plugin doesn't look for this origin, no need to queue */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="decode.c.html#LN475"><span class='Ref_to_Func'>FilterByOrigin</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN813"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="../../../include/access/xlogreader.h.html#LN218"><span class='Ref_to_Macro'>XLogRecGetOrigin</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN815"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>)))</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="decode.c.html#LN819"><span class='Ref_To_Local'>tupledata</span></a> <span class='Operator'>= </span><a href="../../../include/access/xlogreader.h.html#LN230"><span class='Ref_to_Proto'>XLogRecGetBlockData</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN815"><span class='Ref_To_Local'>r</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="decode.c.html#LN820"><span class='Ref_To_Local'>tuplelen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="decode.c.html#LN818"><span class='Ref_To_Local'>data</span></a> <span class='Operator'>= </span><a href="decode.c.html#LN819"><span class='Ref_To_Local'>tupledata</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="decode.c.html#LN817"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="decode.c.html#LN817"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="decode.c.html#LN816"><span class='Ref_To_Local'>xlrec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/heapam_xlog.h.html#LN153"><span class='Ref_to_Member'>ntuples</span></a><span class='Delimiter'>; </span><a href="decode.c.html#LN817"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN839"></a>        <a href="../../../include/replication/reorderbuffer.h.html#LN71"><span class='Ref_to_Struct'>ReorderBufferChange</span></a> <span class='Operator'>*</span><span class='Declare_Local'>change</span><span class='Delimiter'>; 
</span><a name="LN840"></a>        <a href="../../../include/access/heapam_xlog.h.html#LN159"><span class='Ref_to_Struct'>xl_multi_insert_tuple</span></a> <span class='Operator'>*</span><span class='Declare_Local'>xlhdr</span><span class='Delimiter'>; 
</span><a name="LN841"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>datalen</span><span class='Delimiter'>; 
</span><a name="LN842"></a>        <a href="../../../include/replication/reorderbuffer.h.html#LN20"><span class='Ref_to_Struct'>ReorderBufferTupleBuf</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span> 
        <a href="decode.c.html#LN839"><span class='Ref_To_Local'>change</span></a> <span class='Operator'>= </span><a href="reorderbuffer.c.html#LN345"><span class='Ref_to_Func'>ReorderBufferGetChange</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN813"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/logical.h.html#LN44"><span class='Ref_to_Member'>reorder</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="decode.c.html#LN839"><span class='Ref_To_Local'>change</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/reorderbuffer.h.html#LN76"><span class='Ref_to_Member'>action</span></a> <span class='Operator'>= </span><a href="../../../include/replication/reorderbuffer.h.html#LN53"><span class='Ref_to_EnumConst'>REORDER_BUFFER_CHANGE_INSERT</span></a><span class='Delimiter'>; 
</span>        <a href="decode.c.html#LN839"><span class='Ref_To_Local'>change</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/reorderbuffer.h.html#LN78"><span class='Ref_to_Member'>origin_id</span></a> <span class='Operator'>= </span><a href="../../../include/access/xlogreader.h.html#LN218"><span class='Ref_to_Macro'>XLogRecGetOrigin</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN815"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        memcpy<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="decode.c.html#LN839"><span class='Ref_To_Local'>change</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/reorderbuffer.h.html#LN130"><span class='Ref_to_Member'>data</span></a><span class='Operator'>.</span>tp<span class='Operator'>.</span>relnode<span class='Delimiter'>, </span><span class='Operator'>&</span><a href="decode.c.html#LN821"><span class='Ref_To_Local'>rnode</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/storage/relfilenode.h.html#LN56"><span class='Ref_to_Struct'>RelFileNode</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * CONTAINS_NEW_TUPLE will always be set currently as multi_insert 
         * isn't used for catalogs, but better be future proof. 
         * 
         * We decode the tuple in pretty much the same way as DecodeXLogTuple, 
         * but since the layout is slightly different, we can't use it here. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="decode.c.html#LN816"><span class='Ref_To_Local'>xlrec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/heapam_xlog.h.html#LN152"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>& </span><a href="../../../include/access/heapam_xlog.h.html#LN68"><span class='Ref_to_Const'>XLH_INSERT_CONTAINS_NEW_TUPLE</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN859"></a>            <a href="../../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a> <span class='Declare_Local'>header</span><span class='Delimiter'>; 
</span> 
            <a href="decode.c.html#LN840"><span class='Ref_To_Local'>xlhdr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/heapam_xlog.h.html#LN159"><span class='Ref_to_Struct'>xl_multi_insert_tuple</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/c.h.html#LN583"><span class='Ref_to_Macro'>SHORTALIGN</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN818"><span class='Ref_To_Local'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="decode.c.html#LN818"><span class='Ref_To_Local'>data</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="decode.c.html#LN840"><span class='Ref_To_Local'>xlhdr</span></a><span class='Parentheses'>)</span> <span class='Operator'>+ </span><a href="../../../include/access/heapam_xlog.h.html#LN168"><span class='Ref_to_Const'>SizeOfMultiInsertTuple</span></a><span class='Delimiter'>; 
</span>            <a href="decode.c.html#LN841"><span class='Ref_To_Local'>datalen</span></a> <span class='Operator'>= </span><a href="decode.c.html#LN840"><span class='Ref_To_Local'>xlhdr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/heapam_xlog.h.html#LN161"><span class='Ref_to_Member'>datalen</span></a><span class='Delimiter'>; 
</span> 
            <a href="decode.c.html#LN839"><span class='Ref_To_Local'>change</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/reorderbuffer.h.html#LN130"><span class='Ref_to_Member'>data</span></a><span class='Operator'>.</span>tp<span class='Operator'>.</span>newtuple <span class='Operator'>= 
</span>                <a href="../../../include/replication/reorderbuffer.h.html#LN363"><span class='Ref_to_Proto'>ReorderBufferGetTupleBuf</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN813"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/logical.h.html#LN44"><span class='Ref_to_Member'>reorder</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN841"><span class='Ref_To_Local'>datalen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="decode.c.html#LN842"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="decode.c.html#LN839"><span class='Ref_To_Local'>change</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/reorderbuffer.h.html#LN130"><span class='Ref_to_Member'>data</span></a><span class='Operator'>.</span>tp<span class='Operator'>.</span>newtuple<span class='Delimiter'>; 
</span>            <a href="decode.c.html#LN859"><span class='Ref_To_Local'>header</span></a> <span class='Operator'>= </span><a href="decode.c.html#LN842"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/reorderbuffer.h.html#LN26"><span class='Ref_to_Member'>tuple</span></a><span class='Operator'>.</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* not a disk based tuple */ 
</span>            <a href="../../../include/storage/itemptr.h.html#LN148"><span class='Ref_to_Macro'>ItemPointerSetInvalid</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="decode.c.html#LN842"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/reorderbuffer.h.html#LN26"><span class='Ref_to_Member'>tuple</span></a><span class='Operator'>.</span><a href="../../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * We can only figure this out after reassembling the 
             * transactions. 
             */ 
</span>            <a href="decode.c.html#LN842"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/reorderbuffer.h.html#LN26"><span class='Ref_to_Member'>tuple</span></a><span class='Operator'>.</span><a href="../../../include/access/htup.h.html#LN65"><span class='Ref_to_Member'>t_tableOid</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
            <a href="decode.c.html#LN842"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/reorderbuffer.h.html#LN26"><span class='Ref_to_Member'>tuple</span></a><span class='Operator'>.</span><a href="../../../include/access/htup.h.html#LN63"><span class='Ref_to_Member'>t_len</span></a> <span class='Operator'>= </span><a href="decode.c.html#LN841"><span class='Ref_To_Local'>datalen</span></a> <span class='Operator'>+ </span><a href="../../../include/access/htup_details.h.html#LN169"><span class='Ref_to_Const'>SizeofHeapTupleHeader</span></a><span class='Delimiter'>; 
</span> 
            memset<span class='Parentheses'>(</span><a href="decode.c.html#LN859"><span class='Ref_To_Local'>header</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN169"><span class='Ref_to_Const'>SizeofHeapTupleHeader</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            memcpy<span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="decode.c.html#LN842"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/reorderbuffer.h.html#LN26"><span class='Ref_to_Member'>tuple</span></a><span class='Operator'>.</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a> <span class='Operator'>+ </span><a href="../../../include/access/htup_details.h.html#LN169"><span class='Ref_to_Const'>SizeofHeapTupleHeader</span></a><span class='Delimiter'>, 
</span>                   <span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="decode.c.html#LN818"><span class='Ref_To_Local'>data</span></a><span class='Delimiter'>, 
</span>                   <a href="decode.c.html#LN841"><span class='Ref_To_Local'>datalen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="decode.c.html#LN818"><span class='Ref_To_Local'>data</span></a> <span class='Operator'>+= </span><a href="decode.c.html#LN841"><span class='Ref_To_Local'>datalen</span></a><span class='Delimiter'>; 
</span> 
            <a href="decode.c.html#LN859"><span class='Ref_To_Local'>header</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>= </span><a href="decode.c.html#LN840"><span class='Ref_To_Local'>xlhdr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/heapam_xlog.h.html#LN163"><span class='Ref_to_Member'>t_infomask</span></a><span class='Delimiter'>; 
</span>            <a href="decode.c.html#LN859"><span class='Ref_To_Local'>header</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN154"><span class='Ref_to_Member'>t_infomask2</span></a> <span class='Operator'>= </span><a href="decode.c.html#LN840"><span class='Ref_To_Local'>xlhdr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/heapam_xlog.h.html#LN162"><span class='Ref_to_Member'>t_infomask2</span></a><span class='Delimiter'>; 
</span>            <a href="decode.c.html#LN859"><span class='Ref_To_Local'>header</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN158"><span class='Ref_to_Member'>t_hoff</span></a> <span class='Operator'>= </span><a href="decode.c.html#LN840"><span class='Ref_To_Local'>xlhdr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/heapam_xlog.h.html#LN164"><span class='Ref_to_Member'>t_hoff</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if xlrec-&GT;flags&XLH_INSE... &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* 
         * Reset toast reassembly state only after the last row in the last 
         * xl_multi_insert_tuple record emitted by one heap_multi_insert() 
         * call. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="decode.c.html#LN816"><span class='Ref_To_Local'>xlrec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/heapam_xlog.h.html#LN152"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>& </span><a href="../../../include/access/heapam_xlog.h.html#LN66"><span class='Ref_to_Const'>XLH_INSERT_LAST_IN_MULTI</span></a> <span class='Operator'>&& 
</span>            <span class='Parentheses'>(</span><a href="decode.c.html#LN817"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="decode.c.html#LN816"><span class='Ref_To_Local'>xlrec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/heapam_xlog.h.html#LN153"><span class='Ref_to_Member'>ntuples</span></a><span class='Parentheses'>)</span> 
            <a href="decode.c.html#LN839"><span class='Ref_To_Local'>change</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/reorderbuffer.h.html#LN130"><span class='Ref_to_Member'>data</span></a><span class='Operator'>.</span>tp<span class='Operator'>.</span>clear_toast_afterwards <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="decode.c.html#LN839"><span class='Ref_To_Local'>change</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/reorderbuffer.h.html#LN130"><span class='Ref_to_Member'>data</span></a><span class='Operator'>.</span>tp<span class='Operator'>.</span>clear_toast_afterwards <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/replication/reorderbuffer.h.html#LN368"><span class='Ref_to_Proto'>ReorderBufferQueueChange</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN813"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/logical.h.html#LN44"><span class='Ref_to_Member'>reorder</span></a><span class='Delimiter'>, </span><a href="../../../include/access/xlogreader.h.html#LN217"><span class='Ref_to_Macro'>XLogRecGetXid</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN815"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="decode.c.html#LN813"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN50"><span class='Ref_to_Member'>origptr</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN839"><span class='Ref_To_Local'>change</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;xlrec-&GT;ntuples;... &raquo; </span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="decode.c.html#LN818"><span class='Ref_To_Local'>data</span></a> <span class='Operator'>== </span><a href="decode.c.html#LN819"><span class='Ref_To_Local'>tupledata</span></a> <span class='Operator'>+ </span><a href="decode.c.html#LN820"><span class='Ref_To_Local'>tuplelen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end DecodeMultiInsert &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Parse XLOG_HEAP_CONFIRM from wal into a confirmation change. 
 * 
 * This is pretty trivial, all the state essentially already setup by the 
 * speculative insertion. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN918"></a><span class='Declare_Function'>DecodeSpecConfirm</span><span class='Parentheses'>(</span><a href="../../../include/replication/logical.h.html#LN34"><span class='Ref_to_Struct'>LogicalDecodingContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><a href="decode.c.html#LN48"><span class='Ref_to_Struct'>XLogRecordBuffer</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN920"></a>    <a href="../../../include/access/xlogreader.h.html#LN68"><span class='Ref_to_Struct'>XLogReaderState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>r</span> <span class='Operator'>= </span><a href="decode.c.html#LN918"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN52"><span class='Ref_to_Member'>record</span></a><span class='Delimiter'>; 
</span><a name="LN921"></a>    <a href="../../../include/replication/reorderbuffer.h.html#LN71"><span class='Ref_to_Struct'>ReorderBufferChange</span></a> <span class='Operator'>*</span><span class='Declare_Local'>change</span><span class='Delimiter'>; 
</span><a name="LN922"></a>    <a href="../../../include/storage/relfilenode.h.html#LN56"><span class='Ref_to_Struct'>RelFileNode</span></a> <span class='Declare_Local'>target_node</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* only interested in our database */ 
</span>    <a href="../../../include/access/xlogreader.h.html#LN231"><span class='Ref_to_Proto'>XLogRecGetBlockTag</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN920"><span class='Ref_To_Local'>r</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="decode.c.html#LN922"><span class='Ref_To_Local'>target_node</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="decode.c.html#LN922"><span class='Ref_To_Local'>target_node</span></a><span class='Operator'>.</span><a href="../../../include/storage/relfilenode.h.html#LN59"><span class='Ref_to_Member'>dbNode</span></a> <span class='Operator'>!= </span><a href="decode.c.html#LN918"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/logical.h.html#LN40"><span class='Ref_to_Member'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/slot.h.html#LN114"><span class='Ref_to_Member'>data</span></a><span class='Operator'>.</span><a href="../../../include/replication/slot.h.html#LN43"><span class='Ref_to_Member'>database</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* output plugin doesn't look for this origin, no need to queue */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="decode.c.html#LN475"><span class='Ref_to_Func'>FilterByOrigin</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN918"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="../../../include/access/xlogreader.h.html#LN218"><span class='Ref_to_Macro'>XLogRecGetOrigin</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN920"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>)))</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="decode.c.html#LN921"><span class='Ref_To_Local'>change</span></a> <span class='Operator'>= </span><a href="reorderbuffer.c.html#LN345"><span class='Ref_to_Func'>ReorderBufferGetChange</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN918"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/logical.h.html#LN44"><span class='Ref_to_Member'>reorder</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="decode.c.html#LN921"><span class='Ref_To_Local'>change</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/reorderbuffer.h.html#LN76"><span class='Ref_to_Member'>action</span></a> <span class='Operator'>= </span><a href="../../../include/replication/reorderbuffer.h.html#LN61"><span class='Ref_to_EnumConst'>REORDER_BUFFER_CHANGE_INTERNAL_SPEC_CONFIRM</span></a><span class='Delimiter'>; 
</span>    <a href="decode.c.html#LN921"><span class='Ref_To_Local'>change</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/reorderbuffer.h.html#LN78"><span class='Ref_to_Member'>origin_id</span></a> <span class='Operator'>= </span><a href="../../../include/access/xlogreader.h.html#LN218"><span class='Ref_to_Macro'>XLogRecGetOrigin</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN920"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    memcpy<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="decode.c.html#LN921"><span class='Ref_To_Local'>change</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/reorderbuffer.h.html#LN130"><span class='Ref_to_Member'>data</span></a><span class='Operator'>.</span>tp<span class='Operator'>.</span>relnode<span class='Delimiter'>, </span><span class='Operator'>&</span><a href="decode.c.html#LN922"><span class='Ref_To_Local'>target_node</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/storage/relfilenode.h.html#LN56"><span class='Ref_to_Struct'>RelFileNode</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="decode.c.html#LN921"><span class='Ref_To_Local'>change</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/reorderbuffer.h.html#LN130"><span class='Ref_to_Member'>data</span></a><span class='Operator'>.</span>tp<span class='Operator'>.</span>clear_toast_afterwards <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/replication/reorderbuffer.h.html#LN368"><span class='Ref_to_Proto'>ReorderBufferQueueChange</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN918"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/logical.h.html#LN44"><span class='Ref_to_Member'>reorder</span></a><span class='Delimiter'>, </span><a href="../../../include/access/xlogreader.h.html#LN217"><span class='Ref_to_Macro'>XLogRecGetXid</span></a><span class='Parentheses'>(</span><a href="decode.c.html#LN920"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="decode.c.html#LN918"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="decode.c.html#LN50"><span class='Ref_to_Member'>origptr</span></a><span class='Delimiter'>, </span><a href="decode.c.html#LN921"><span class='Ref_To_Local'>change</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end DecodeSpecConfirm &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Read a HeapTuple as WAL logged by heap_insert, heap_update and heap_delete 
 * (but not by heap_multi_insert) into a tuplebuf. 
 * 
 * The size 'len' and the pointer 'data' in the record need to be 
 * computed outside as they are record specific. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN953"></a><span class='Declare_Function'>DecodeXLogTuple</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>data</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Declare_Parameter'>len</span><span class='Delimiter'>, </span><a href="../../../include/replication/reorderbuffer.h.html#LN20"><span class='Ref_to_Struct'>ReorderBufferTupleBuf</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tuple</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN955"></a>    <a href="../../../include/access/heapam_xlog.h.html#LN119"><span class='Ref_to_Struct'>xl_heap_header</span></a> <span class='Declare_Local'>xlhdr</span><span class='Delimiter'>; 
</span><a name="LN956"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>datalen</span> <span class='Operator'>= </span><a href="decode.c.html#LN953"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>- </span><a href="../../../include/access/heapam_xlog.h.html#LN126"><span class='Ref_to_Const'>SizeOfHeapHeader</span></a><span class='Delimiter'>; 
</span><a name="LN957"></a>    <a href="../../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a> <span class='Declare_Local'>header</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="decode.c.html#LN956"><span class='Ref_To_Local'>datalen</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="decode.c.html#LN953"><span class='Ref_to_Parameter'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/reorderbuffer.h.html#LN26"><span class='Ref_to_Member'>tuple</span></a><span class='Operator'>.</span><a href="../../../include/access/htup.h.html#LN63"><span class='Ref_to_Member'>t_len</span></a> <span class='Operator'>= </span><a href="decode.c.html#LN956"><span class='Ref_To_Local'>datalen</span></a> <span class='Operator'>+ </span><a href="../../../include/access/htup_details.h.html#LN169"><span class='Ref_to_Const'>SizeofHeapTupleHeader</span></a><span class='Delimiter'>; 
</span>    <a href="decode.c.html#LN957"><span class='Ref_To_Local'>header</span></a> <span class='Operator'>= </span><a href="decode.c.html#LN953"><span class='Ref_to_Parameter'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/reorderbuffer.h.html#LN26"><span class='Ref_to_Member'>tuple</span></a><span class='Operator'>.</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* not a disk based tuple */ 
</span>    <a href="../../../include/storage/itemptr.h.html#LN148"><span class='Ref_to_Macro'>ItemPointerSetInvalid</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="decode.c.html#LN953"><span class='Ref_to_Parameter'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/reorderbuffer.h.html#LN26"><span class='Ref_to_Member'>tuple</span></a><span class='Operator'>.</span><a href="../../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* we can only figure this out after reassembling the transactions */ 
</span>    <a href="decode.c.html#LN953"><span class='Ref_to_Parameter'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/reorderbuffer.h.html#LN26"><span class='Ref_to_Member'>tuple</span></a><span class='Operator'>.</span><a href="../../../include/access/htup.h.html#LN65"><span class='Ref_to_Member'>t_tableOid</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* data is not stored aligned, copy to aligned storage */ 
</span>    memcpy<span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="decode.c.html#LN955"><span class='Ref_To_Local'>xlhdr</span></a><span class='Delimiter'>, 
</span>           <a href="decode.c.html#LN953"><span class='Ref_to_Parameter'>data</span></a><span class='Delimiter'>, 
</span>           <a href="../../../include/access/heapam_xlog.h.html#LN126"><span class='Ref_to_Const'>SizeOfHeapHeader</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    memset<span class='Parentheses'>(</span><a href="decode.c.html#LN957"><span class='Ref_To_Local'>header</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN169"><span class='Ref_to_Const'>SizeofHeapTupleHeader</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    memcpy<span class='Parentheses'>(((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="decode.c.html#LN953"><span class='Ref_to_Parameter'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/replication/reorderbuffer.h.html#LN26"><span class='Ref_to_Member'>tuple</span></a><span class='Operator'>.</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Parentheses'>)</span> <span class='Operator'>+ </span><a href="../../../include/access/htup_details.h.html#LN169"><span class='Ref_to_Const'>SizeofHeapTupleHeader</span></a><span class='Delimiter'>, 
</span>           <a href="decode.c.html#LN953"><span class='Ref_to_Parameter'>data</span></a> <span class='Operator'>+ </span><a href="../../../include/access/heapam_xlog.h.html#LN126"><span class='Ref_to_Const'>SizeOfHeapHeader</span></a><span class='Delimiter'>, 
</span>           <a href="decode.c.html#LN956"><span class='Ref_To_Local'>datalen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="decode.c.html#LN957"><span class='Ref_To_Local'>header</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>= </span><a href="decode.c.html#LN955"><span class='Ref_To_Local'>xlhdr</span></a><span class='Operator'>.</span><a href="../../../include/access/heapam_xlog.h.html#LN122"><span class='Ref_to_Member'>t_infomask</span></a><span class='Delimiter'>; 
</span>    <a href="decode.c.html#LN957"><span class='Ref_To_Local'>header</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN154"><span class='Ref_to_Member'>t_infomask2</span></a> <span class='Operator'>= </span><a href="decode.c.html#LN955"><span class='Ref_To_Local'>xlhdr</span></a><span class='Operator'>.</span><a href="../../../include/access/heapam_xlog.h.html#LN121"><span class='Ref_to_Member'>t_infomask2</span></a><span class='Delimiter'>; 
</span>    <a href="decode.c.html#LN957"><span class='Ref_To_Local'>header</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN158"><span class='Ref_to_Member'>t_hoff</span></a> <span class='Operator'>= </span><a href="decode.c.html#LN955"><span class='Ref_To_Local'>xlhdr</span></a><span class='Operator'>.</span><a href="../../../include/access/heapam_xlog.h.html#LN123"><span class='Ref_to_Member'>t_hoff</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end DecodeXLogTuple &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>