<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\tcop\postgres.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\tcop\postgres.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:49 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * postgres.c 
 *    POSTGRES C Backend Interface 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/tcop/postgres.c 
 * 
 * NOTES 
 *    this is the "main" module of the postgres backend and 
 *    hence the main module of the "traffic cop". 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span> 
<span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;fcntl.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;limits.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;signal.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;unistd.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;sys/socket.h&GT;</span> 
<span class='Directive'>#ifdef</span> HAVE_SYS_SELECT_H 
<span class='Keyword'>#include </span><span class='String'>&LT;sys/select.h&GT;</span> 
<span class='Directive'>#endif</span> 
<span class='Directive'>#ifdef</span> HAVE_SYS_RESOURCE_H 
<span class='Keyword'>#include </span><span class='String'>&LT;sys/time.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;sys/resource.h&GT;</span> 
<span class='Directive'>#endif</span> 
 
<span class='Directive'>#ifndef</span> HAVE_GETRUSAGE 
<span class='Keyword'>#include </span><span class='String'>"rusagestub.h"</span> 
<span class='Directive'>#endif</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/parallel.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/printtup.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xact.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/async.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/prepare.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"libpq/libpq.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"libpq/pqformat.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"libpq/pqsignal.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"nodes/print.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/planner.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"pgstat.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"pg_trace.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/analyze.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parser.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"pg_getopt.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"postmaster/autovacuum.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"postmaster/postmaster.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"replication/logicallauncher.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"replication/logicalworker.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"replication/slot.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"replication/walsender.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"rewrite/rewriteHandler.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/bufmgr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/ipc.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/proc.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/procsignal.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/sinval.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"tcop/fastpath.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"tcop/pquery.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"tcop/tcopprot.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"tcop/utility.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/memutils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/ps_status.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/snapmgr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/timeout.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/timestamp.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"mb/pg_wchar.h"</span> 
 
 
<span class='Comment_Multi_Line'>/* ---------------- 
 *      global variables 
 * ---------------- 
 */ 
</span><a name="LN84"></a><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Var'>debug_query_string</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* client-supplied query string */ 
</span> 
<span class='Comment_Multi_Line'>/* Note: whereToSendOutput is initialized for the bootstrap/standalone case */ 
</span><a name="LN87"></a><a href="../../include/tcop/dest.h.html#LN85"><span class='Ref_to_Typedef'>CommandDest</span></a> <span class='Declare_Var'>whereToSendOutput</span> <span class='Operator'>= </span><a href="../../include/tcop/dest.h.html#LN88"><span class='Ref_to_EnumConst'>DestDebug</span></a><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* flag for logging end of session */ 
</span><a name="LN90"></a><span class='Keyword'>bool</span>        <span class='Declare_Var'>Log_disconnections</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
<a name="LN92"></a><span class='Keyword'>int</span>         <span class='Declare_Var'>log_statement</span> <span class='Operator'>= </span><a href="../../include/tcop/tcopprot.h.html#LN41"><span class='Ref_to_EnumConst'>LOGSTMT_NONE</span></a><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* GUC variable for maximum stack depth (measured in kilobytes) */ 
</span><a name="LN95"></a><span class='Keyword'>int</span>         <span class='Declare_Var'>max_stack_depth</span> <span class='Operator'>= </span><span class='Number'>100</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* wait N seconds to allow attach from a debugger */ 
</span><a name="LN98"></a><span class='Keyword'>int</span>         <span class='Declare_Var'>PostAuthDelay</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
 
 
<span class='Comment_Multi_Line'>/* ---------------- 
 *      private variables 
 * ---------------- 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* max_stack_depth converted to bytes for speed of checking */ 
</span><a name="LN108"></a><span class='Keyword'>static long </span><span class='Declare_Var'>max_stack_depth_bytes</span> <span class='Operator'>= </span><span class='Number'>100</span> <span class='Operator'>* </span><span class='Number'>1024L</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Stack base pointer -- initialized by PostmasterMain and inherited by 
 * subprocesses. This is not static because old versions of PL/Java modify 
 * it directly. Newer versions use set_stack_base(), but we want to stay 
 * binary-compatible for the time being. 
 */ 
</span><a name="LN116"></a><span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Var'>stack_base_ptr</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * On IA64 we also have to remember the register stack base. 
 */ 
</span><span class='Directive'>#if</span> defined<span class='Parentheses'>(</span>__ia64__<span class='Parentheses'>) </span><span class='Operator'>|| </span>defined<span class='Parentheses'>(</span>__ia64<span class='Parentheses'>) 
</span><a name="LN122"></a><span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Var'>register_stack_base_ptr</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Flag to keep track of whether we have started a transaction. 
 * For extended query protocol this has to be remembered across messages. 
 */ 
</span><a name="LN129"></a><span class='Keyword'>static bool </span><span class='Declare_Var'>xact_started</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Flag to indicate that we are doing the outer loop's read-from-client, 
 * as opposed to any random read from client that might happen within 
 * commands like COPY FROM STDIN. 
 */ 
</span><a name="LN136"></a><span class='Keyword'>static bool </span><span class='Declare_Var'>DoingCommandRead</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Flags to implement skip-till-Sync-after-error behavior for messages of 
 * the extended query protocol. 
 */ 
</span><a name="LN142"></a><span class='Keyword'>static bool </span><span class='Declare_Var'>doing_extended_query_message</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN143"></a><span class='Keyword'>static bool </span><span class='Declare_Var'>ignore_till_sync</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * If an unnamed prepared statement exists, it's stored here. 
 * We keep it separate from the hashtable kept by commands/prepare.c 
 * in order to reduce overhead for short-lived queries. 
 */ 
</span><a name="LN150"></a><span class='Keyword'>static </span><a href="../../include/utils/plancache.h.html#LN79"><span class='Ref_to_Struct'>CachedPlanSource</span></a> <span class='Operator'>*</span><span class='Declare_Var'>unnamed_stmt_psrc</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* assorted command-line switches */ 
</span><a name="LN153"></a><span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Declare_Var'>userDoption</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* -D switch */ 
</span><a name="LN154"></a><span class='Keyword'>static bool </span><span class='Declare_Var'>EchoQuery</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* -E switch */ 
</span><a name="LN155"></a><span class='Keyword'>static bool </span><span class='Declare_Var'>UseSemiNewlineNewline</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* -j switch */ 
</span> 
<span class='Comment_Multi_Line'>/* whether or not, and why, we were canceled by conflict with recovery */ 
</span><a name="LN158"></a><span class='Keyword'>static bool </span><span class='Declare_Var'>RecoveryConflictPending</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN159"></a><span class='Keyword'>static bool </span><span class='Declare_Var'>RecoveryConflictRetryable</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span><a name="LN160"></a><span class='Keyword'>static </span><a href="../../include/storage/procsignal.h.html#LN29"><span class='Ref_to_Typedef'>ProcSignalReason</span></a> <span class='Declare_Var'>RecoveryConflictReason</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------- 
 *      decls for routines only used in this file 
 * ---------------------------------------------------------------- 
 */ 
</span><a name="LN166"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>InteractiveBackend</span><span class='Parentheses'>(</span><a href="../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>inBuf</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN167"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>interactive_getc</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN168"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>SocketBackend</span><span class='Parentheses'>(</span><a href="../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>inBuf</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN169"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>ReadCommand</span><span class='Parentheses'>(</span><a href="../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>inBuf</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN170"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>forbidden_in_wal_sender</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Declare_Parameter'>firstchar</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN171"></a><span class='Keyword'>static </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>pg_rewrite_query</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>query</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN172"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>check_log_statement</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt_list</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN173"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>errdetail_execute</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>raw_parsetree_list</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN174"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>errdetail_params</span><span class='Parentheses'>(</span><a href="../../include/nodes/params.h.html#LN61"><span class='Ref_to_Typedef'>ParamListInfo</span></a> <span class='Declare_Parameter'>params</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN175"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>errdetail_abort</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN176"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>errdetail_recovery_conflict</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN177"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>start_xact_command</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN178"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>finish_xact_command</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN179"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>IsTransactionExitStmt</span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>parsetree</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN180"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>IsTransactionExitStmtList</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstmts</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN181"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>IsTransactionStmtList</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstmts</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN182"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>drop_unnamed_stmt</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN183"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>log_disconnections</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>code</span><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>arg</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------- 
 *      routines to obtain user input 
 * ---------------------------------------------------------------- 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* ---------------- 
 *  InteractiveBackend() is called for user interactive connections 
 * 
 *  the string entered by the user is placed in its parameter inBuf, 
 *  and we act like a Q message was received. 
 * 
 *  EOF is returned if end-of-file input is seen; time to shut down. 
 * ---------------- 
 */ 
</span> 
<span class='Keyword'>static int 
</span><a name="LN202"></a><span class='Declare_Function'>InteractiveBackend</span><span class='Parentheses'>(</span><a href="../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>inBuf</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN204"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>c</span><span class='Delimiter'>;</span>              <span class='Comment_Single_Line'>/* character read from getc() */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * display a prompt and obtain input from the user 
     */ 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"backend&GT; "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    fflush<span class='Parentheses'>(</span>stdout<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../lib/stringinfo.c.html#LN60"><span class='Ref_to_Func'>resetStringInfo</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN202"><span class='Ref_to_Parameter'>inBuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Read characters until EOF or the appropriate delimiter is seen. 
     */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="postgres.c.html#LN204"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN167"><span class='Ref_to_Proto'>interactive_getc</span></a><span class='Parentheses'>())</span> <span class='Operator'>!= </span>EOF<span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN204"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>== </span><span class='String'>'\n'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN155"><span class='Ref_to_Global_Var'>UseSemiNewlineNewline</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * In -j mode, semicolon followed by two newlines ends the 
                 * command; otherwise treat newline as regular character. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN202"><span class='Ref_to_Parameter'>inBuf</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span> <span class='Operator'>&& 
</span>                    <a href="postgres.c.html#LN202"><span class='Ref_to_Parameter'>inBuf</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>[</span><a href="postgres.c.html#LN202"><span class='Ref_to_Parameter'>inBuf</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\n'</span> <span class='Operator'>&& 
</span>                    <a href="postgres.c.html#LN202"><span class='Ref_to_Parameter'>inBuf</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>[</span><a href="postgres.c.html#LN202"><span class='Ref_to_Parameter'>inBuf</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>- </span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>';'</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* might as well drop the second newline */ 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * In plain mode, newline ends the command unless preceded by 
                 * backslash. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN202"><span class='Ref_to_Parameter'>inBuf</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>                    <a href="postgres.c.html#LN202"><span class='Ref_to_Parameter'>inBuf</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>[</span><a href="postgres.c.html#LN202"><span class='Ref_to_Parameter'>inBuf</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\\'</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* discard backslash from inBuf */ 
</span>                    <a href="postgres.c.html#LN202"><span class='Ref_to_Parameter'>inBuf</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>[</span><span class='Operator'>--</span><a href="postgres.c.html#LN202"><span class='Ref_to_Parameter'>inBuf</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>                    <span class='Comment_Multi_Line'>/* discard newline too */ 
</span>                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* keep the newline character, but end the command */ 
</span>                    <a href="../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN202"><span class='Ref_to_Parameter'>inBuf</span></a><span class='Delimiter'>, </span><span class='String'>'\n'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if c=='\n' &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* Not newline, or newline treated as regular character */ 
</span>        <a href="../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN202"><span class='Ref_to_Parameter'>inBuf</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>char</span><span class='Parentheses'>) </span><a href="postgres.c.html#LN204"><span class='Ref_To_Local'>c</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while (c=interactive_getc()... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* No input before EOF signal means time to quit. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN204"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>== </span>EOF <span class='Operator'>&& </span><a href="postgres.c.html#LN202"><span class='Ref_to_Parameter'>inBuf</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> EOF<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * otherwise we have a user query so process it. 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* Add '\0' to make it look the same as message case. */ 
</span>    <a href="../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN202"><span class='Ref_to_Parameter'>inBuf</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>char</span><span class='Parentheses'>) </span><span class='String'>'\0'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * if the query echo flag was given, print the query.. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN154"><span class='Ref_to_Global_Var'>EchoQuery</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"statement: %s\n"</span><span class='Delimiter'>, </span><a href="postgres.c.html#LN202"><span class='Ref_to_Parameter'>inBuf</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    fflush<span class='Parentheses'>(</span>stdout<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='String'>'Q'</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end InteractiveBackend &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * interactive_getc -- collect one character from stdin 
 * 
 * Even though we are not reading from a "client" process, we still want to 
 * respond to signals, particularly SIGTERM/SIGQUIT. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN290"></a><span class='Declare_Function'>interactive_getc</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN292"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>c</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * This will not process catchup interrupts or notifications while 
     * reading. But those can't really be relevant for a standalone backend 
     * anyway. To properly handle SIGTERM there's a hack in die() that 
     * directly processes interrupts at this stage... 
     */ 
</span>    <a href="../../include/miscadmin.h.html#LN99"><span class='Ref_to_Macro'>CHECK_FOR_INTERRUPTS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="postgres.c.html#LN292"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= </span>getc<span class='Parentheses'>(</span>stdin<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/tcop/tcopprot.h.html#LN73"><span class='Ref_to_Proto'>ProcessClientReadInterrupt</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="postgres.c.html#LN292"><span class='Ref_To_Local'>c</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* ---------------- 
 *  SocketBackend()     Is called for frontend-backend connections 
 * 
 *  Returns the message type code, and loads message body data into inBuf. 
 * 
 *  EOF is returned if the connection is lost. 
 * ---------------- 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN318"></a><span class='Declare_Function'>SocketBackend</span><span class='Parentheses'>(</span><a href="../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>inBuf</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN320"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>qtype</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Get message type code from the frontend. 
     */ 
</span>    <a href="../../include/miscadmin.h.html#LN124"><span class='Ref_to_Macro'>HOLD_CANCEL_INTERRUPTS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="../../include/libpq/libpq.h.html#LN65"><span class='Ref_to_Proto'>pq_startmsgread</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="postgres.c.html#LN320"><span class='Ref_To_Local'>qtype</span></a> <span class='Operator'>= </span><a href="../../include/libpq/libpq.h.html#LN69"><span class='Ref_to_Proto'>pq_getbyte</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN320"><span class='Ref_To_Local'>qtype</span></a> <span class='Operator'>== </span>EOF<span class='Parentheses'>)</span>           <span class='Comment_Single_Line'>/* frontend disconnected */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/xact.h.html#LN329"><span class='Ref_to_Proto'>IsTransactionState</span></a><span class='Parentheses'>())</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN29"><span class='Ref_to_Const'>COMMERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONNECTION_FAILURE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"unexpected EOF on client connection with an open transaction"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Can't send DEBUG log messages to client at this point. Since 
             * we're disconnecting right away, we don't need to restore 
             * whereToSendOutput. 
             */ 
</span>            <a href="postgres.c.html#LN87"><span class='Ref_to_Global_Var'>whereToSendOutput</span></a> <span class='Operator'>= </span><a href="../../include/tcop/dest.h.html#LN87"><span class='Ref_to_EnumConst'>DestNone</span></a><span class='Delimiter'>; 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN24"><span class='Ref_to_Const'>DEBUG1</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONNECTION_DOES_NOT_EXIST<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"unexpected EOF on client connection"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>return</span> <a href="postgres.c.html#LN320"><span class='Ref_To_Local'>qtype</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if qtype==EOF &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Validate message type code before trying to read body; if we have lost 
     * sync, better to say "command unknown" than to run out of memory because 
     * we used garbage as a length word. 
     * 
     * This also gives us a place to set the doing_extended_query_message flag 
     * as soon as possible. 
     */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN320"><span class='Ref_To_Local'>qtype</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <span class='String'>'Q'</span><span class='Operator'>:</span>               <span class='Comment_Single_Line'>/* simple query */ 
</span>            <a href="postgres.c.html#LN142"><span class='Ref_to_Global_Var'>doing_extended_query_message</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/libpq/pqcomm.h.html#LN103"><span class='Ref_to_Macro'>PG_PROTOCOL_MAJOR</span></a><span class='Parentheses'>(</span><a href="../utils/init/globals.c.html#LN26"><span class='Ref_to_Global_Var'>FrontendProtocol</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>3</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* old style without length word; convert */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/libpq/libpq.h.html#LN64"><span class='Ref_to_Proto'>pq_getstring</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN318"><span class='Ref_to_Parameter'>inBuf</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/xact.h.html#LN329"><span class='Ref_to_Proto'>IsTransactionState</span></a><span class='Parentheses'>())</span> 
                        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN29"><span class='Ref_to_Const'>COMMERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONNECTION_FAILURE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"unexpected EOF on client connection with an open transaction"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* 
                         * Can't send DEBUG log messages to client at this 
                         * point. Since we're disconnecting right away, we 
                         * don't need to restore whereToSendOutput. 
                         */ 
</span>                        <a href="postgres.c.html#LN87"><span class='Ref_to_Global_Var'>whereToSendOutput</span></a> <span class='Operator'>= </span><a href="../../include/tcop/dest.h.html#LN87"><span class='Ref_to_EnumConst'>DestNone</span></a><span class='Delimiter'>; 
</span>                        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN24"><span class='Ref_to_Const'>DEBUG1</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONNECTION_DOES_NOT_EXIST<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"unexpected EOF on client connection"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>return</span> EOF<span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if pq_getstring(inBuf) &raquo; </span> 
            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if PG_PROTOCOL_MAJOR(Fro... &raquo; </span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <span class='String'>'F'</span><span class='Operator'>:</span>               <span class='Comment_Single_Line'>/* fastpath function call */ 
</span>            <a href="postgres.c.html#LN142"><span class='Ref_to_Global_Var'>doing_extended_query_message</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/libpq/pqcomm.h.html#LN103"><span class='Ref_to_Macro'>PG_PROTOCOL_MAJOR</span></a><span class='Parentheses'>(</span><a href="../utils/init/globals.c.html#LN26"><span class='Ref_to_Global_Var'>FrontendProtocol</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>3</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/tcop/fastpath.h.html#LN17"><span class='Ref_to_Proto'>GetOldFunctionMessage</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN318"><span class='Ref_to_Parameter'>inBuf</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/xact.h.html#LN329"><span class='Ref_to_Proto'>IsTransactionState</span></a><span class='Parentheses'>())</span> 
                        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN29"><span class='Ref_to_Const'>COMMERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONNECTION_FAILURE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"unexpected EOF on client connection with an open transaction"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* 
                         * Can't send DEBUG log messages to client at this 
                         * point. Since we're disconnecting right away, we 
                         * don't need to restore whereToSendOutput. 
                         */ 
</span>                        <a href="postgres.c.html#LN87"><span class='Ref_to_Global_Var'>whereToSendOutput</span></a> <span class='Operator'>= </span><a href="../../include/tcop/dest.h.html#LN87"><span class='Ref_to_EnumConst'>DestNone</span></a><span class='Delimiter'>; 
</span>                        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN24"><span class='Ref_to_Const'>DEBUG1</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONNECTION_DOES_NOT_EXIST<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"unexpected EOF on client connection"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>return</span> EOF<span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if GetOldFunctionMessage... &raquo; </span> 
            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if PG_PROTOCOL_MAJOR(Fro... &raquo; </span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <span class='String'>'X'</span><span class='Operator'>:</span>               <span class='Comment_Single_Line'>/* terminate */ 
</span>            <a href="postgres.c.html#LN142"><span class='Ref_to_Global_Var'>doing_extended_query_message</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="postgres.c.html#LN143"><span class='Ref_to_Global_Var'>ignore_till_sync</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <span class='String'>'B'</span><span class='Operator'>:</span>               <span class='Comment_Single_Line'>/* bind */ 
</span>        <span class='Control'>case</span> <span class='String'>'C'</span><span class='Operator'>:</span>               <span class='Comment_Single_Line'>/* close */ 
</span>        <span class='Control'>case</span> <span class='String'>'D'</span><span class='Operator'>:</span>               <span class='Comment_Single_Line'>/* describe */ 
</span>        <span class='Control'>case</span> <span class='String'>'E'</span><span class='Operator'>:</span>               <span class='Comment_Single_Line'>/* execute */ 
</span>        <span class='Control'>case</span> <span class='String'>'H'</span><span class='Operator'>:</span>               <span class='Comment_Single_Line'>/* flush */ 
</span>        <span class='Control'>case</span> <span class='String'>'P'</span><span class='Operator'>:</span>               <span class='Comment_Single_Line'>/* parse */ 
</span>            <a href="postgres.c.html#LN142"><span class='Ref_to_Global_Var'>doing_extended_query_message</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* these are only legal in protocol 3 */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/libpq/pqcomm.h.html#LN103"><span class='Ref_to_Macro'>PG_PROTOCOL_MAJOR</span></a><span class='Parentheses'>(</span><a href="../utils/init/globals.c.html#LN26"><span class='Ref_to_Global_Var'>FrontendProtocol</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>3</span><span class='Parentheses'>)</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_PROTOCOL_VIOLATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid frontend message type %d"</span><span class='Delimiter'>, </span><a href="postgres.c.html#LN320"><span class='Ref_To_Local'>qtype</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <span class='String'>'S'</span><span class='Operator'>:</span>               <span class='Comment_Single_Line'>/* sync */ 
</span>            <span class='Comment_Multi_Line'>/* stop any active skip-till-Sync */ 
</span>            <a href="postgres.c.html#LN143"><span class='Ref_to_Global_Var'>ignore_till_sync</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* mark not-extended, so that a new error doesn't begin skip */ 
</span>            <a href="postgres.c.html#LN142"><span class='Ref_to_Global_Var'>doing_extended_query_message</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* only legal in protocol 3 */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/libpq/pqcomm.h.html#LN103"><span class='Ref_to_Macro'>PG_PROTOCOL_MAJOR</span></a><span class='Parentheses'>(</span><a href="../utils/init/globals.c.html#LN26"><span class='Ref_to_Global_Var'>FrontendProtocol</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>3</span><span class='Parentheses'>)</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_PROTOCOL_VIOLATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid frontend message type %d"</span><span class='Delimiter'>, </span><a href="postgres.c.html#LN320"><span class='Ref_To_Local'>qtype</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <span class='String'>'d'</span><span class='Operator'>:</span>               <span class='Comment_Single_Line'>/* copy data */ 
</span>        <span class='Control'>case</span> <span class='String'>'c'</span><span class='Operator'>:</span>               <span class='Comment_Single_Line'>/* copy done */ 
</span>        <span class='Control'>case</span> <span class='String'>'f'</span><span class='Operator'>:</span>               <span class='Comment_Single_Line'>/* copy fail */ 
</span>            <a href="postgres.c.html#LN142"><span class='Ref_to_Global_Var'>doing_extended_query_message</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* these are only legal in protocol 3 */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/libpq/pqcomm.h.html#LN103"><span class='Ref_to_Macro'>PG_PROTOCOL_MAJOR</span></a><span class='Parentheses'>(</span><a href="../utils/init/globals.c.html#LN26"><span class='Ref_to_Global_Var'>FrontendProtocol</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>3</span><span class='Parentheses'>)</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_PROTOCOL_VIOLATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid frontend message type %d"</span><span class='Delimiter'>, </span><a href="postgres.c.html#LN320"><span class='Ref_To_Local'>qtype</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Otherwise we got garbage from the frontend.  We treat this as 
             * fatal because we have probably lost message boundary sync, and 
             * there's no good way to recover. 
             */ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_PROTOCOL_VIOLATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid frontend message type %d"</span><span class='Delimiter'>, </span><a href="postgres.c.html#LN320"><span class='Ref_To_Local'>qtype</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch qtype &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * In protocol version 3, all frontend messages have a length word next 
     * after the type code; we can read the message contents independently of 
     * the type. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/libpq/pqcomm.h.html#LN103"><span class='Ref_to_Macro'>PG_PROTOCOL_MAJOR</span></a><span class='Parentheses'>(</span><a href="../utils/init/globals.c.html#LN26"><span class='Ref_to_Global_Var'>FrontendProtocol</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='Number'>3</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/libpq/libpq.h.html#LN68"><span class='Ref_to_Proto'>pq_getmessage</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN318"><span class='Ref_to_Parameter'>inBuf</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> EOF<span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* suitable message already logged */ 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="../../include/libpq/libpq.h.html#LN66"><span class='Ref_to_Proto'>pq_endmsgread</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="../../include/miscadmin.h.html#LN126"><span class='Ref_to_Macro'>RESUME_CANCEL_INTERRUPTS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="postgres.c.html#LN320"><span class='Ref_To_Local'>qtype</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end SocketBackend &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------------- 
 *      ReadCommand reads a command from either the frontend or 
 *      standard input, places it in inBuf, and returns the 
 *      message type code (first byte of the message). 
 *      EOF is returned if end of file. 
 * ---------------- 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN495"></a><span class='Declare_Function'>ReadCommand</span><span class='Parentheses'>(</span><a href="../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>inBuf</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN497"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN87"><span class='Ref_to_Global_Var'>whereToSendOutput</span></a> <span class='Operator'>== </span><a href="../../include/tcop/dest.h.html#LN89"><span class='Ref_to_EnumConst'>DestRemote</span></a><span class='Parentheses'>) 
</span>        <a href="postgres.c.html#LN497"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN168"><span class='Ref_to_Proto'>SocketBackend</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN495"><span class='Ref_to_Parameter'>inBuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="postgres.c.html#LN497"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN166"><span class='Ref_to_Proto'>InteractiveBackend</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN495"><span class='Ref_to_Parameter'>inBuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="postgres.c.html#LN497"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * ProcessClientReadInterrupt() - Process interrupts specific to client reads 
 * 
 * This is called just after low-level reads. That might be after the read 
 * finished successfully, or it was interrupted via interrupt. 
 * 
 * Must preserve errno! 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN515"></a><span class='Declare_Function'>ProcessClientReadInterrupt</span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Declare_Parameter'>blocked</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN517"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>save_errno</span> <span class='Operator'>= </span>errno<span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN136"><span class='Ref_to_Global_Var'>DoingCommandRead</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Check for general interrupts that arrived while reading */ 
</span>        <a href="../../include/miscadmin.h.html#LN99"><span class='Ref_to_Macro'>CHECK_FOR_INTERRUPTS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Process sinval catchup interrupts that happened while reading */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../storage/ipc/sinval.c.html#LN40"><span class='Ref_to_Global_Var'>catchupInterruptPending</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/storage/sinval.h.html#LN143"><span class='Ref_to_Proto'>ProcessCatchupInterrupt</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Process sinval catchup interrupts that happened while reading */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../commands/async.c.html#LN355"><span class='Ref_to_Global_Var'>notifyInterruptPending</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/commands/async.h.html#LN54"><span class='Ref_to_Proto'>ProcessNotifyInterrupt</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/init/globals.c.html#LN30"><span class='Ref_to_Global_Var'>ProcDiePending</span></a> <span class='Operator'>&& </span><a href="postgres.c.html#LN515"><span class='Ref_to_Parameter'>blocked</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * We're dying. It's safe (and sane) to handle that now. 
         */ 
</span>        <a href="../../include/miscadmin.h.html#LN99"><span class='Ref_to_Macro'>CHECK_FOR_INTERRUPTS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    errno <span class='Operator'>= </span><a href="postgres.c.html#LN517"><span class='Ref_To_Local'>save_errno</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ProcessClientReadInterrupt &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ProcessClientWriteInterrupt() - Process interrupts specific to client writes 
 * 
 * This is called just after low-level writes. That might be after the read 
 * finished successfully, or it was interrupted via interrupt. 'blocked' tells 
 * us whether the 
 * 
 * Must preserve errno! 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN553"></a><span class='Declare_Function'>ProcessClientWriteInterrupt</span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Declare_Parameter'>blocked</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN555"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>save_errno</span> <span class='Operator'>= </span>errno<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We only want to process the interrupt here if socket writes are 
     * blocking to increase the chance to get an error message to the client. 
     * If we're not blocked there'll soon be a CHECK_FOR_INTERRUPTS(). But if 
     * we're blocked we'll never get out of that situation if the client has 
     * died. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/init/globals.c.html#LN30"><span class='Ref_to_Global_Var'>ProcDiePending</span></a> <span class='Operator'>&& </span><a href="postgres.c.html#LN553"><span class='Ref_to_Parameter'>blocked</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * We're dying. It's safe (and sane) to handle that now. But we don't 
         * want to send the client the error message as that a) would possibly 
         * block again b) would possibly lead to sending an error message to 
         * the client, while we already started to send something else. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN87"><span class='Ref_to_Global_Var'>whereToSendOutput</span></a> <span class='Operator'>== </span><a href="../../include/tcop/dest.h.html#LN89"><span class='Ref_to_EnumConst'>DestRemote</span></a><span class='Parentheses'>) 
</span>            <a href="postgres.c.html#LN87"><span class='Ref_to_Global_Var'>whereToSendOutput</span></a> <span class='Operator'>= </span><a href="../../include/tcop/dest.h.html#LN87"><span class='Ref_to_EnumConst'>DestNone</span></a><span class='Delimiter'>; 
</span> 
        <a href="../../include/miscadmin.h.html#LN99"><span class='Ref_to_Macro'>CHECK_FOR_INTERRUPTS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    errno <span class='Operator'>= </span><a href="postgres.c.html#LN555"><span class='Ref_To_Local'>save_errno</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ProcessClientWriteInterrupt &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Do raw parsing (only). 
 * 
 * A list of parsetrees (RawStmt nodes) is returned, since there might be 
 * multiple commands in the given string. 
 * 
 * NOTE: for interactive queries, it is important to keep this routine 
 * separate from the analysis & rewrite stages.  Analysis and rewriting 
 * cannot be done in an aborted transaction, since they require access to 
 * database tables.  So, we rely on the raw parser to determine whether 
 * we've seen a COMMIT or ABORT command; when we are in abort state, other 
 * commands are not processed any further than the raw parse stage. 
 */ 
</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN595"></a><span class='Declare_Function'>pg_parse_query</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>query_string</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN597"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>raw_parsetree_list</span><span class='Delimiter'>; 
</span> 
    TRACE_POSTGRESQL_QUERY_PARSE_START<span class='Parentheses'>(</span><a href="postgres.c.html#LN595"><span class='Ref_to_Parameter'>query_string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/guc.c.html#LN437"><span class='Ref_to_Global_Var'>log_parser_stats</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/tcop/tcopprot.h.html#LN82"><span class='Ref_to_Proto'>ResetUsage</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="postgres.c.html#LN597"><span class='Ref_To_Local'>raw_parsetree_list</span></a> <span class='Operator'>= </span><a href="../parser/parser.c.html#LN34"><span class='Ref_to_Func'>raw_parser</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN595"><span class='Ref_to_Parameter'>query_string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/guc.c.html#LN437"><span class='Ref_to_Global_Var'>log_parser_stats</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/tcop/tcopprot.h.html#LN83"><span class='Ref_to_Proto'>ShowUsage</span></a><span class='Parentheses'>(</span><span class='String'>"PARSER STATISTICS"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> COPY_PARSE_PLAN_TREES 
    <span class='Comment_Multi_Line'>/* Optional debugging check: pass raw parsetrees through copyObject() */ 
</span>    <span class='Delimiter'>{ 
</span><a name="LN612"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>new_list</span> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN597"><span class='Ref_To_Local'>raw_parsetree_list</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* This checks both copyObject() and the equal() routines... */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/nodes/nodes.h.html#LN626"><span class='Ref_to_Proto'>equal</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN612"><span class='Ref_To_Local'>new_list</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN597"><span class='Ref_To_Local'>raw_parsetree_list</span></a><span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, </span><span class='String'>"copyObject() failed to produce an equal raw parse tree"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="postgres.c.html#LN597"><span class='Ref_To_Local'>raw_parsetree_list</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN612"><span class='Ref_To_Local'>new_list</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span><span class='Directive'>#endif</span> 
 
    TRACE_POSTGRESQL_QUERY_PARSE_DONE<span class='Parentheses'>(</span><a href="postgres.c.html#LN595"><span class='Ref_to_Parameter'>query_string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="postgres.c.html#LN597"><span class='Ref_To_Local'>raw_parsetree_list</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_parse_query &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Given a raw parsetree (gram.y output), and optionally information about 
 * types of parameter symbols ($n), perform parse analysis and rule rewriting. 
 * 
 * A list of Query nodes is returned, since either the analyzer or the 
 * rewriter might expand one query to several. 
 * 
 * NOTE: for reasons mentioned above, this must be separate from raw parsing. 
 */ 
</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN637"></a><span class='Declare_Function'>pg_analyze_and_rewrite</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1396"><span class='Ref_to_Struct'>RawStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>parsetree</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>query_string</span><span class='Delimiter'>, 
</span><a name="LN638"></a>                       <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>paramTypes</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>numParams</span><span class='Delimiter'>, 
</span><a name="LN639"></a>                       <a href="../utils/misc/queryenvironment.c.html#LN31"><span class='Ref_to_Struct'>QueryEnvironment</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>queryEnv</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN641"></a>    <a href="../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>query</span><span class='Delimiter'>; 
</span><a name="LN642"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>querytree_list</span><span class='Delimiter'>; 
</span> 
    TRACE_POSTGRESQL_QUERY_REWRITE_START<span class='Parentheses'>(</span><a href="postgres.c.html#LN637"><span class='Ref_to_Parameter'>query_string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * (1) Perform parse analysis. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/guc.c.html#LN437"><span class='Ref_to_Global_Var'>log_parser_stats</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/tcop/tcopprot.h.html#LN82"><span class='Ref_to_Proto'>ResetUsage</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="postgres.c.html#LN641"><span class='Ref_To_Local'>query</span></a> <span class='Operator'>= </span><a href="../../include/parser/analyze.h.html#LN24"><span class='Ref_to_Proto'>parse_analyze</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN637"><span class='Ref_to_Parameter'>parsetree</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN637"><span class='Ref_to_Parameter'>query_string</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN638"><span class='Ref_to_Parameter'>paramTypes</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN638"><span class='Ref_to_Parameter'>numParams</span></a><span class='Delimiter'>, 
</span>                          <a href="postgres.c.html#LN639"><span class='Ref_to_Parameter'>queryEnv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/guc.c.html#LN437"><span class='Ref_to_Global_Var'>log_parser_stats</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/tcop/tcopprot.h.html#LN83"><span class='Ref_to_Proto'>ShowUsage</span></a><span class='Parentheses'>(</span><span class='String'>"PARSE ANALYSIS STATISTICS"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * (2) Rewrite the queries, as necessary 
     */ 
</span>    <a href="postgres.c.html#LN642"><span class='Ref_To_Local'>querytree_list</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN171"><span class='Ref_to_Proto'>pg_rewrite_query</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN641"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    TRACE_POSTGRESQL_QUERY_REWRITE_DONE<span class='Parentheses'>(</span><a href="postgres.c.html#LN637"><span class='Ref_to_Parameter'>query_string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="postgres.c.html#LN642"><span class='Ref_To_Local'>querytree_list</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_analyze_and_rewrite &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Do parse analysis and rewriting.  This is the same as pg_analyze_and_rewrite 
 * except that external-parameter resolution is determined by parser callback 
 * hooks instead of a fixed list of parameter datatypes. 
 */ 
</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN674"></a><span class='Declare_Function'>pg_analyze_and_rewrite_params</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1396"><span class='Ref_to_Struct'>RawStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>parsetree</span><span class='Delimiter'>, 
</span><a name="LN675"></a>                              <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>query_string</span><span class='Delimiter'>, 
</span><a name="LN676"></a>                              <a href="../../include/nodes/params.h.html#LN65"><span class='Ref_to_Typedef'>ParserSetupHook</span></a> <span class='Declare_Parameter'>parserSetup</span><span class='Delimiter'>, 
</span><a name="LN677"></a>                              <span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>parserSetupArg</span><span class='Delimiter'>, 
</span><a name="LN678"></a>                              <a href="../utils/misc/queryenvironment.c.html#LN31"><span class='Ref_to_Struct'>QueryEnvironment</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>queryEnv</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN680"></a>    <a href="../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pstate</span><span class='Delimiter'>; 
</span><a name="LN681"></a>    <a href="../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>query</span><span class='Delimiter'>; 
</span><a name="LN682"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>querytree_list</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="postgres.c.html#LN675"><span class='Ref_to_Parameter'>query_string</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* required as of 8.4 */ 
</span> 
    TRACE_POSTGRESQL_QUERY_REWRITE_START<span class='Parentheses'>(</span><a href="postgres.c.html#LN675"><span class='Ref_to_Parameter'>query_string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * (1) Perform parse analysis. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/guc.c.html#LN437"><span class='Ref_to_Global_Var'>log_parser_stats</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/tcop/tcopprot.h.html#LN82"><span class='Ref_to_Proto'>ResetUsage</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="postgres.c.html#LN680"><span class='Ref_To_Local'>pstate</span></a> <span class='Operator'>= </span><a href="../parser/parse_node.c.html#LN42"><span class='Ref_to_Func'>make_parsestate</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="postgres.c.html#LN680"><span class='Ref_To_Local'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/parser/parse_node.h.html#LN167"><span class='Ref_to_Member'>p_sourcetext</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN675"><span class='Ref_to_Parameter'>query_string</span></a><span class='Delimiter'>; 
</span>    <a href="postgres.c.html#LN680"><span class='Ref_To_Local'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/parser/parse_node.h.html#LN191"><span class='Ref_to_Member'>p_queryEnv</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN678"><span class='Ref_to_Parameter'>queryEnv</span></a><span class='Delimiter'>; 
</span>    <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="postgres.c.html#LN676"><span class='Ref_to_Parameter'>parserSetup</span></a><span class='Parentheses'>) (</span><a href="postgres.c.html#LN680"><span class='Ref_To_Local'>pstate</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN677"><span class='Ref_to_Parameter'>parserSetupArg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="postgres.c.html#LN681"><span class='Ref_To_Local'>query</span></a> <span class='Operator'>= </span><a href="../../include/parser/analyze.h.html#LN34"><span class='Ref_to_Proto'>transformTopLevelStmt</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN680"><span class='Ref_To_Local'>pstate</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN674"><span class='Ref_to_Parameter'>parsetree</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../parser/analyze.c.html#LN48"><span class='Ref_to_Global_Var'>post_parse_analyze_hook</span></a><span class='Parentheses'>) 
</span>        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="../parser/analyze.c.html#LN48"><span class='Ref_to_Global_Var'>post_parse_analyze_hook</span></a><span class='Parentheses'>) (</span><a href="postgres.c.html#LN680"><span class='Ref_To_Local'>pstate</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN681"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../parser/parse_node.c.html#LN75"><span class='Ref_to_Func'>free_parsestate</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN680"><span class='Ref_To_Local'>pstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/guc.c.html#LN437"><span class='Ref_to_Global_Var'>log_parser_stats</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/tcop/tcopprot.h.html#LN83"><span class='Ref_to_Proto'>ShowUsage</span></a><span class='Parentheses'>(</span><span class='String'>"PARSE ANALYSIS STATISTICS"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * (2) Rewrite the queries, as necessary 
     */ 
</span>    <a href="postgres.c.html#LN682"><span class='Ref_To_Local'>querytree_list</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN171"><span class='Ref_to_Proto'>pg_rewrite_query</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN681"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    TRACE_POSTGRESQL_QUERY_REWRITE_DONE<span class='Parentheses'>(</span><a href="postgres.c.html#LN675"><span class='Ref_to_Parameter'>query_string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="postgres.c.html#LN682"><span class='Ref_To_Local'>querytree_list</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_analyze_and_rewrite_params &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Perform rewriting of a query produced by parse analysis. 
 * 
 * Note: query must just have come from the parser, because we do not do 
 * AcquireRewriteLocks() on it. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN726"></a><span class='Declare_Function'>pg_rewrite_query</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>query</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN728"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>querytree_list</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/guc.c.html#LN433"><span class='Ref_to_Global_Var'>Debug_print_parse</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/nodes/print.h.html#LN23"><span class='Ref_to_Proto'>elog_node_display</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, </span><span class='String'>"parse tree"</span><span class='Delimiter'>, </span><a href="postgres.c.html#LN726"><span class='Ref_to_Parameter'>query</span></a><span class='Delimiter'>, 
</span>                          <a href="../utils/misc/guc.c.html#LN435"><span class='Ref_to_Global_Var'>Debug_pretty_print</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/guc.c.html#LN437"><span class='Ref_to_Global_Var'>log_parser_stats</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/tcop/tcopprot.h.html#LN82"><span class='Ref_to_Proto'>ResetUsage</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN726"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN109"><span class='Ref_to_Member'>commandType</span></a> <span class='Operator'>== </span><a href="../../include/nodes/nodes.h.html#LN654"><span class='Ref_to_EnumConst'>CMD_UTILITY</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* don't rewrite utilities, just dump 'em into result list */ 
</span>        <a href="postgres.c.html#LN728"><span class='Ref_To_Local'>querytree_list</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN138"><span class='Ref_to_Macro'>list_make1</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN726"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* rewrite regular queries */ 
</span>        <a href="postgres.c.html#LN728"><span class='Ref_To_Local'>querytree_list</span></a> <span class='Operator'>= </span><a href="../../include/rewrite/rewriteHandler.h.html#LN19"><span class='Ref_to_Proto'>QueryRewrite</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN726"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/guc.c.html#LN437"><span class='Ref_to_Global_Var'>log_parser_stats</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/tcop/tcopprot.h.html#LN83"><span class='Ref_to_Proto'>ShowUsage</span></a><span class='Parentheses'>(</span><span class='String'>"REWRITER STATISTICS"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> COPY_PARSE_PLAN_TREES 
    <span class='Comment_Multi_Line'>/* Optional debugging check: pass querytree output through copyObject() */ 
</span>    <span class='Delimiter'>{ 
</span><a name="LN754"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>new_list</span><span class='Delimiter'>; 
</span> 
        <a href="postgres.c.html#LN754"><span class='Ref_To_Local'>new_list</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN728"><span class='Ref_To_Local'>querytree_list</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* This checks both copyObject() and the equal() routines... */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/nodes/nodes.h.html#LN626"><span class='Ref_to_Proto'>equal</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN754"><span class='Ref_To_Local'>new_list</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN728"><span class='Ref_To_Local'>querytree_list</span></a><span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, </span><span class='String'>"copyObject() failed to produce equal parse tree"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="postgres.c.html#LN728"><span class='Ref_To_Local'>querytree_list</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN754"><span class='Ref_To_Local'>new_list</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span><span class='Directive'>#endif</span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/guc.c.html#LN434"><span class='Ref_to_Global_Var'>Debug_print_rewritten</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/nodes/print.h.html#LN23"><span class='Ref_to_Proto'>elog_node_display</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, </span><span class='String'>"rewritten parse tree"</span><span class='Delimiter'>, </span><a href="postgres.c.html#LN728"><span class='Ref_To_Local'>querytree_list</span></a><span class='Delimiter'>, 
</span>                          <a href="../utils/misc/guc.c.html#LN435"><span class='Ref_to_Global_Var'>Debug_pretty_print</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="postgres.c.html#LN728"><span class='Ref_To_Local'>querytree_list</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_rewrite_query &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Generate a plan for a single already-rewritten query. 
 * This is a thin wrapper around planner() and takes the same parameters. 
 */ 
</span><a href="../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a> <span class='Operator'>* 
</span><a name="LN778"></a><span class='Declare_Function'>pg_plan_query</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>querytree</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>cursorOptions</span><span class='Delimiter'>, </span><a href="../../include/nodes/params.h.html#LN61"><span class='Ref_to_Typedef'>ParamListInfo</span></a> <span class='Declare_Parameter'>boundParams</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN780"></a>    <a href="../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>plan</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Utility commands have no plans. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN778"><span class='Ref_to_Parameter'>querytree</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN109"><span class='Ref_to_Member'>commandType</span></a> <span class='Operator'>== </span><a href="../../include/nodes/nodes.h.html#LN654"><span class='Ref_to_EnumConst'>CMD_UTILITY</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Planner must have a snapshot in case it calls user-defined functions. */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/utils/snapmgr.h.html#LN78"><span class='Ref_to_Proto'>ActiveSnapshotSet</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span> 
    TRACE_POSTGRESQL_QUERY_PLAN_START<span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/guc.c.html#LN438"><span class='Ref_to_Global_Var'>log_planner_stats</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/tcop/tcopprot.h.html#LN82"><span class='Ref_to_Proto'>ResetUsage</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* call the optimizer */ 
</span>    <a href="postgres.c.html#LN780"><span class='Ref_To_Local'>plan</span></a> <span class='Operator'>= </span><a href="../../include/optimizer/planner.h.html#LN34"><span class='Ref_to_Proto'>planner</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN778"><span class='Ref_to_Parameter'>querytree</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN778"><span class='Ref_to_Parameter'>cursorOptions</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN778"><span class='Ref_to_Parameter'>boundParams</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/guc.c.html#LN438"><span class='Ref_to_Global_Var'>log_planner_stats</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/tcop/tcopprot.h.html#LN83"><span class='Ref_to_Proto'>ShowUsage</span></a><span class='Parentheses'>(</span><span class='String'>"PLANNER STATISTICS"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> COPY_PARSE_PLAN_TREES 
    <span class='Comment_Multi_Line'>/* Optional debugging check: pass plan output through copyObject() */ 
</span>    <span class='Delimiter'>{ 
</span><a name="LN803"></a>        <a href="../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>new_plan</span> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN780"><span class='Ref_To_Local'>plan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * equal() currently does not have routines to compare Plan nodes, so 
         * don't try to test equality here.  Perhaps fix someday? 
         */ 
</span><span class='Directive'>#ifdef</span> NOT_USED 
        <span class='Comment_Multi_Line'>/* This checks both copyObject() and the equal() routines... */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/nodes/nodes.h.html#LN626"><span class='Ref_to_Proto'>equal</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN803"><span class='Ref_To_Local'>new_plan</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN780"><span class='Ref_To_Local'>plan</span></a><span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, </span><span class='String'>"copyObject() failed to produce an equal plan tree"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
<span class='Directive'>#endif</span> 
            <a href="postgres.c.html#LN780"><span class='Ref_To_Local'>plan</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN803"><span class='Ref_To_Local'>new_plan</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span><span class='Directive'>#endif</span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Print plan if debugging. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/guc.c.html#LN432"><span class='Ref_to_Global_Var'>Debug_print_plan</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/nodes/print.h.html#LN23"><span class='Ref_to_Proto'>elog_node_display</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, </span><span class='String'>"plan"</span><span class='Delimiter'>, </span><a href="postgres.c.html#LN780"><span class='Ref_To_Local'>plan</span></a><span class='Delimiter'>, </span><a href="../utils/misc/guc.c.html#LN435"><span class='Ref_to_Global_Var'>Debug_pretty_print</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    TRACE_POSTGRESQL_QUERY_PLAN_DONE<span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="postgres.c.html#LN780"><span class='Ref_To_Local'>plan</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_plan_query &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Generate plans for a list of already-rewritten queries. 
 * 
 * For normal optimizable statements, invoke the planner.  For utility 
 * statements, just make a wrapper PlannedStmt node. 
 * 
 * The result is a list of PlannedStmt nodes. 
 */ 
</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN839"></a><span class='Declare_Function'>pg_plan_queries</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>querytrees</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>cursorOptions</span><span class='Delimiter'>, </span><a href="../../include/nodes/params.h.html#LN61"><span class='Ref_to_Typedef'>ParamListInfo</span></a> <span class='Declare_Parameter'>boundParams</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN841"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>stmt_list</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN842"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>query_list</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN842"><span class='Ref_To_Local'>query_list</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN839"><span class='Ref_to_Parameter'>querytrees</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN846"></a>        <a href="../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>query</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN108"><span class='Ref_to_Macro'>lfirst_node</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN842"><span class='Ref_To_Local'>query_list</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN847"></a>        <a href="../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>stmt</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN846"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN109"><span class='Ref_to_Member'>commandType</span></a> <span class='Operator'>== </span><a href="../../include/nodes/nodes.h.html#LN654"><span class='Ref_to_EnumConst'>CMD_UTILITY</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Utility commands require no planning. */ 
</span>            <a href="postgres.c.html#LN847"><span class='Ref_To_Local'>stmt</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="postgres.c.html#LN847"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN44"><span class='Ref_to_Member'>commandType</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN654"><span class='Ref_to_EnumConst'>CMD_UTILITY</span></a><span class='Delimiter'>; 
</span>            <a href="postgres.c.html#LN847"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN52"><span class='Ref_to_Member'>canSetTag</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN846"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN115"><span class='Ref_to_Member'>canSetTag</span></a><span class='Delimiter'>; 
</span>            <a href="postgres.c.html#LN847"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN93"><span class='Ref_to_Member'>utilityStmt</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN846"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN117"><span class='Ref_to_Member'>utilityStmt</span></a><span class='Delimiter'>; 
</span>            <a href="postgres.c.html#LN847"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN96"><span class='Ref_to_Member'>stmt_location</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN846"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN179"><span class='Ref_to_Member'>stmt_location</span></a><span class='Delimiter'>; 
</span>            <a href="postgres.c.html#LN847"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN97"><span class='Ref_to_Member'>stmt_len</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN846"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN180"><span class='Ref_to_Member'>stmt_len</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="postgres.c.html#LN847"><span class='Ref_To_Local'>stmt</span></a> <span class='Operator'>= </span><a href="../../include/tcop/tcopprot.h.html#LN59"><span class='Ref_to_Proto'>pg_plan_query</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN846"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN839"><span class='Ref_to_Parameter'>cursorOptions</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN839"><span class='Ref_to_Parameter'>boundParams</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="postgres.c.html#LN841"><span class='Ref_To_Local'>stmt_list</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN841"><span class='Ref_To_Local'>stmt_list</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN847"><span class='Ref_To_Local'>stmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="postgres.c.html#LN841"><span class='Ref_To_Local'>stmt_list</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_plan_queries &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * exec_simple_query 
 * 
 * Execute a "simple Query" protocol message. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN877"></a><span class='Declare_Function'>exec_simple_query</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>query_string</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN879"></a>    <a href="../../include/tcop/dest.h.html#LN85"><span class='Ref_to_Typedef'>CommandDest</span></a> <span class='Declare_Local'>dest</span> <span class='Operator'>= </span><a href="postgres.c.html#LN87"><span class='Ref_to_Global_Var'>whereToSendOutput</span></a><span class='Delimiter'>; 
</span><a name="LN880"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span><a name="LN881"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>parsetree_list</span><span class='Delimiter'>; 
</span><a name="LN882"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>parsetree_item</span><span class='Delimiter'>; 
</span><a name="LN883"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>save_log_statement_stats</span> <span class='Operator'>= </span><a href="../utils/misc/guc.c.html#LN440"><span class='Ref_to_Global_Var'>log_statement_stats</span></a><span class='Delimiter'>; 
</span><a name="LN884"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>was_logged</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN885"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isTopLevel</span><span class='Delimiter'>; 
</span><a name="LN886"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>msec_str</span><span class='Delimiter'>[</span><span class='Number'>32</span><span class='Delimiter'>]; 
</span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Report query to various monitoring facilities. 
     */ 
</span>    <a href="postgres.c.html#LN84"><span class='Ref_to_Global_Var'>debug_query_string</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN877"><span class='Ref_to_Parameter'>query_string</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/pgstat.h.html#LN1168"><span class='Ref_to_Proto'>pgstat_report_activity</span></a><span class='Parentheses'>(</span><a href="../../include/pgstat.h.html#LN724"><span class='Ref_to_EnumConst'>STATE_RUNNING</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN877"><span class='Ref_to_Parameter'>query_string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    TRACE_POSTGRESQL_QUERY_START<span class='Parentheses'>(</span><a href="postgres.c.html#LN877"><span class='Ref_to_Parameter'>query_string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We use save_log_statement_stats so ShowUsage doesn't report incorrect 
     * results because ResetUsage wasn't called. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN883"><span class='Ref_To_Local'>save_log_statement_stats</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/tcop/tcopprot.h.html#LN82"><span class='Ref_to_Proto'>ResetUsage</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Start up a transaction command.  All queries generated by the 
     * query_string will be in this same command block, *unless* we find a 
     * BEGIN/COMMIT/ABORT statement; we have to force a new xact command after 
     * one of those, else bad things will happen in xact.c. (Note that this 
     * will normally change current memory context.) 
     */ 
</span>    <a href="postgres.c.html#LN177"><span class='Ref_to_Proto'>start_xact_command</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Zap any pre-existing unnamed statement.  (While not strictly necessary, 
     * it seems best to define simple-Query mode as if it used the unnamed 
     * statement and portal; this ensures we recover any storage used by prior 
     * unnamed operations.) 
     */ 
</span>    <a href="postgres.c.html#LN182"><span class='Ref_to_Proto'>drop_unnamed_stmt</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Switch to appropriate context for constructing parsetrees. 
     */ 
</span>    <a href="postgres.c.html#LN880"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN46"><span class='Ref_to_Global_Var'>MessageContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Do basic parsing of the query or queries (this should be safe even if 
     * we are in aborted transaction state!) 
     */ 
</span>    <a href="postgres.c.html#LN881"><span class='Ref_To_Local'>parsetree_list</span></a> <span class='Operator'>= </span><a href="../../include/tcop/tcopprot.h.html#LN49"><span class='Ref_to_Proto'>pg_parse_query</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN877"><span class='Ref_to_Parameter'>query_string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Log immediately if dictated by log_statement */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN172"><span class='Ref_to_Proto'>check_log_statement</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN881"><span class='Ref_To_Local'>parsetree_list</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"statement: %s"</span><span class='Delimiter'>, </span><a href="postgres.c.html#LN877"><span class='Ref_to_Parameter'>query_string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN1066"><span class='Ref_to_Func'>errhidestmt</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="postgres.c.html#LN173"><span class='Ref_to_Proto'>errdetail_execute</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN881"><span class='Ref_To_Local'>parsetree_list</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="postgres.c.html#LN884"><span class='Ref_To_Local'>was_logged</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Switch back to transaction context to enter the loop. 
     */ 
</span>    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN880"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We'll tell PortalRun it's a top-level command iff there's exactly one 
     * raw parsetree.  If more than one, it's effectively a transaction block 
     * and we want PreventTransactionChain to reject unsafe commands. (Note: 
     * we're assuming that query rewrite cannot add commands that are 
     * significant to PreventTransactionChain.) 
     */ 
</span>    <a href="postgres.c.html#LN885"><span class='Ref_To_Local'>isTopLevel</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN881"><span class='Ref_To_Local'>parsetree_list</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Run through the raw parsetree(s) and process each one. 
     */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN882"><span class='Ref_To_Local'>parsetree_item</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN881"><span class='Ref_To_Local'>parsetree_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN962"></a>        <a href="../../include/nodes/parsenodes.h.html#LN1396"><span class='Ref_to_Struct'>RawStmt</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>parsetree</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN108"><span class='Ref_to_Macro'>lfirst_node</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1396"><span class='Ref_to_Struct'>RawStmt</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN882"><span class='Ref_To_Local'>parsetree_item</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN963"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>snapshot_set</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN964"></a>        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>commandTag</span><span class='Delimiter'>; 
</span><a name="LN965"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>completionTag</span><span class='Delimiter'>[</span><a href="../../include/tcop/dest.h.html#LN73"><span class='Ref_to_Const'>COMPLETION_TAG_BUFSIZE</span></a><span class='Delimiter'>]; 
</span><a name="LN966"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>querytree_list</span><span class='Delimiter'>, 
</span><a name="LN967"></a>                   <span class='Operator'>*</span><span class='Declare_Local'>plantree_list</span><span class='Delimiter'>; 
</span><a name="LN968"></a>        <a href="../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a>      <span class='Declare_Local'>portal</span><span class='Delimiter'>; 
</span><a name="LN969"></a>        <a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Local'>receiver</span><span class='Delimiter'>; 
</span><a name="LN970"></a>        <a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>       <span class='Declare_Local'>format</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Get the command name for use in status display (it also becomes the 
         * default completion tag, down inside PortalRun).  Set ps_status and 
         * do any special start-of-SQL-command processing needed by the 
         * destination. 
         */ 
</span>        <a href="postgres.c.html#LN964"><span class='Ref_To_Local'>commandTag</span></a> <span class='Operator'>= </span><a href="../../include/tcop/utility.h.html#LN48"><span class='Ref_to_Proto'>CreateCommandTag</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN962"><span class='Ref_To_Local'>parsetree</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1399"><span class='Ref_to_Member'>stmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/ps_status.h.html#LN21"><span class='Ref_to_Proto'>set_ps_display</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN964"><span class='Ref_To_Local'>commandTag</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="dest.c.html#LN97"><span class='Ref_to_Func'>BeginCommand</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN964"><span class='Ref_To_Local'>commandTag</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN879"><span class='Ref_To_Local'>dest</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If we are in an aborted transaction, reject all commands except 
         * COMMIT/ABORT.  It is important that this test occur before we try 
         * to do parse analysis, rewrite, or planning, since all those phases 
         * try to do database accesses, which may fail in abort state. (It 
         * might be safe to allow some additional utility commands in this 
         * state, but not many...) 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/xact.h.html#LN330"><span class='Ref_to_Proto'>IsAbortedTransactionBlockState</span></a><span class='Parentheses'>() </span><span class='Operator'>&& 
</span>            <span class='Operator'>!</span><a href="postgres.c.html#LN179"><span class='Ref_to_Proto'>IsTransactionExitStmt</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN962"><span class='Ref_To_Local'>parsetree</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1399"><span class='Ref_to_Member'>stmt</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_IN_FAILED_SQL_TRANSACTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"current transaction is aborted, "</span> 
                          <span class='String'>"commands ignored until end of transaction block"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="postgres.c.html#LN175"><span class='Ref_to_Proto'>errdetail_abort</span></a><span class='Parentheses'>()))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Make sure we are in a transaction command */ 
</span>        <a href="postgres.c.html#LN177"><span class='Ref_to_Proto'>start_xact_command</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* If we got a cancel signal in parsing or prior command, quit */ 
</span>        <a href="../../include/miscadmin.h.html#LN99"><span class='Ref_to_Macro'>CHECK_FOR_INTERRUPTS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Set up a snapshot if parse analysis/planning will need one. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/parser/analyze.h.html#LN37"><span class='Ref_to_Proto'>analyze_requires_snapshot</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN962"><span class='Ref_To_Local'>parsetree</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/snapmgr.h.html#LN73"><span class='Ref_to_Proto'>PushActiveSnapshot</span></a><span class='Parentheses'>(</span><a href="../../include/utils/snapmgr.h.html#LN63"><span class='Ref_to_Proto'>GetTransactionSnapshot</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>            <a href="postgres.c.html#LN963"><span class='Ref_To_Local'>snapshot_set</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * OK to analyze, rewrite, and plan this query. 
         * 
         * Switch to appropriate context for constructing querytrees (again, 
         * these must outlive the execution context). 
         */ 
</span>        <a href="postgres.c.html#LN880"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN46"><span class='Ref_to_Global_Var'>MessageContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="postgres.c.html#LN966"><span class='Ref_To_Local'>querytree_list</span></a> <span class='Operator'>= </span><a href="../../include/tcop/tcopprot.h.html#LN50"><span class='Ref_to_Proto'>pg_analyze_and_rewrite</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN962"><span class='Ref_To_Local'>parsetree</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN877"><span class='Ref_to_Parameter'>query_string</span></a><span class='Delimiter'>, 
</span>                                                <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="postgres.c.html#LN967"><span class='Ref_To_Local'>plantree_list</span></a> <span class='Operator'>= </span><a href="../../include/tcop/tcopprot.h.html#LN61"><span class='Ref_to_Proto'>pg_plan_queries</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN966"><span class='Ref_To_Local'>querytree_list</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../include/nodes/parsenodes.h.html#LN2610"><span class='Ref_to_Const'>CURSOR_OPT_PARALLEL_OK</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Done with the snapshot used for parsing/planning */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN963"><span class='Ref_To_Local'>snapshot_set</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/snapmgr.h.html#LN76"><span class='Ref_to_Proto'>PopActiveSnapshot</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* If we got a cancel signal in analysis or planning, quit */ 
</span>        <a href="../../include/miscadmin.h.html#LN99"><span class='Ref_to_Macro'>CHECK_FOR_INTERRUPTS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Create unnamed portal to run the query or queries in. If there 
         * already is one, silently drop it. 
         */ 
</span>        <a href="postgres.c.html#LN968"><span class='Ref_To_Local'>portal</span></a> <span class='Operator'>= </span><a href="../utils/mmgr/portalmem.c.html#LN172"><span class='Ref_to_Func'>CreatePortal</span></a><span class='Parentheses'>(</span><span class='String'>""</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Don't display the portal in pg_cursors */ 
</span>        <a href="postgres.c.html#LN968"><span class='Ref_To_Local'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN191"><span class='Ref_to_Member'>visible</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We don't have to copy anything into the portal, because everything 
         * we are passing here is in MessageContext, which will outlive the 
         * portal anyway. 
         */ 
</span>        <a href="../../include/utils/portal.h.html#LN229"><span class='Ref_to_Proto'>PortalDefineQuery</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN968"><span class='Ref_To_Local'>portal</span></a><span class='Delimiter'>, 
</span>                          <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                          <a href="postgres.c.html#LN877"><span class='Ref_to_Parameter'>query_string</span></a><span class='Delimiter'>, 
</span>                          <a href="postgres.c.html#LN964"><span class='Ref_To_Local'>commandTag</span></a><span class='Delimiter'>, 
</span>                          <a href="postgres.c.html#LN967"><span class='Ref_To_Local'>plantree_list</span></a><span class='Delimiter'>, 
</span>                          <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Start the portal.  No parameters here. 
         */ 
</span>        <a href="../../include/tcop/pquery.h.html#LN29"><span class='Ref_to_Proto'>PortalStart</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN968"><span class='Ref_To_Local'>portal</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="../../include/utils/snapshot.h.html#LN24"><span class='Ref_to_Const'>InvalidSnapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Select the appropriate output format: text unless we are doing a 
         * FETCH from a binary cursor.  (Pretty grotty to have to do this here 
         * --- but it avoids grottiness in other places.  Ah, the joys of 
         * backward compatibility...) 
         */ 
</span>        <a href="postgres.c.html#LN970"><span class='Ref_To_Local'>format</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>             <span class='Comment_Single_Line'>/* TEXT is default */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN962"><span class='Ref_To_Local'>parsetree</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1399"><span class='Ref_to_Member'>stmt</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN2647"><span class='Ref_to_Struct'>FetchStmt</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN1070"></a>            <a href="../../include/nodes/parsenodes.h.html#LN2647"><span class='Ref_to_Struct'>FetchStmt</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>stmt</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2647"><span class='Ref_to_Struct'>FetchStmt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres.c.html#LN962"><span class='Ref_To_Local'>parsetree</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1399"><span class='Ref_to_Member'>stmt</span></a><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postgres.c.html#LN1070"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2653"><span class='Ref_to_Member'>ismove</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1074"></a>                <a href="../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a>      <span class='Declare_Local'>fportal</span> <span class='Operator'>= </span><a href="../utils/mmgr/portalmem.c.html#LN127"><span class='Ref_to_Func'>GetPortalByName</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1070"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2652"><span class='Ref_to_Member'>portalname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/portal.h.html#LN198"><span class='Ref_to_Macro'>PortalIsValid</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1074"><span class='Ref_To_Local'>fportal</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>                    <span class='Parentheses'>(</span><a href="postgres.c.html#LN1074"><span class='Ref_To_Local'>fportal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN143"><span class='Ref_to_Member'>cursorOptions</span></a> <span class='Operator'>& </span><a href="../../include/nodes/parsenodes.h.html#LN2601"><span class='Ref_to_Const'>CURSOR_OPT_BINARY</span></a><span class='Parentheses'>))</span> 
                    <a href="postgres.c.html#LN970"><span class='Ref_To_Local'>format</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* BINARY */ 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../include/tcop/pquery.h.html#LN32"><span class='Ref_to_Proto'>PortalSetResultFormat</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN968"><span class='Ref_To_Local'>portal</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres.c.html#LN970"><span class='Ref_To_Local'>format</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Now we can create the destination receiver object. 
         */ 
</span>        <a href="postgres.c.html#LN969"><span class='Ref_To_Local'>receiver</span></a> <span class='Operator'>= </span><a href="dest.c.html#LN107"><span class='Ref_to_Func'>CreateDestReceiver</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN879"><span class='Ref_To_Local'>dest</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN879"><span class='Ref_To_Local'>dest</span></a> <span class='Operator'>== </span><a href="../../include/tcop/dest.h.html#LN89"><span class='Ref_to_EnumConst'>DestRemote</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/access/printtup.h.html#LN20"><span class='Ref_to_Proto'>SetRemoteDestReceiverParams</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN969"><span class='Ref_To_Local'>receiver</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN968"><span class='Ref_To_Local'>portal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Switch back to transaction context for execution. 
         */ 
</span>        <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN880"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Run the portal to completion, and then drop it (and the receiver). 
         */ 
</span>        <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../include/tcop/pquery.h.html#LN35"><span class='Ref_to_Proto'>PortalRun</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN968"><span class='Ref_To_Local'>portal</span></a><span class='Delimiter'>, 
</span>                         <a href="../../include/nodes/parsenodes.h.html#LN2645"><span class='Ref_to_Const'>FETCH_ALL</span></a><span class='Delimiter'>, 
</span>                         <a href="postgres.c.html#LN885"><span class='Ref_To_Local'>isTopLevel</span></a><span class='Delimiter'>, 
</span>                         <span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                         <a href="postgres.c.html#LN969"><span class='Ref_To_Local'>receiver</span></a><span class='Delimiter'>, 
</span>                         <a href="postgres.c.html#LN969"><span class='Ref_To_Local'>receiver</span></a><span class='Delimiter'>, 
</span>                         <a href="postgres.c.html#LN965"><span class='Ref_To_Local'>completionTag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="postgres.c.html#LN969"><span class='Ref_To_Local'>receiver</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/dest.h.html#LN125"><span class='Ref_to_Member'>rDestroy</span></a><span class='Parentheses'>) (</span><a href="postgres.c.html#LN969"><span class='Ref_To_Local'>receiver</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/portal.h.html#LN227"><span class='Ref_to_Proto'>PortalDrop</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN968"><span class='Ref_To_Local'>portal</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN962"><span class='Ref_To_Local'>parsetree</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1399"><span class='Ref_to_Member'>stmt</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN2902"><span class='Ref_to_Struct'>TransactionStmt</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * If this was a transaction control statement, commit it. We will 
             * start a new xact command for the next command (if any). 
             */ 
</span>            <a href="postgres.c.html#LN178"><span class='Ref_to_Proto'>finish_xact_command</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN882"><span class='Ref_To_Local'>parsetree_item</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * If this is the last parsetree of the query string, close down 
             * transaction statement before reporting command-complete.  This 
             * is so that any end-of-transaction errors are reported before 
             * the command-complete message is issued, to avoid confusing 
             * clients who will expect either a command-complete message or an 
             * error, not one and then the other.  But for compatibility with 
             * historical Postgres behavior, we do not force a transaction 
             * boundary between queries appearing in a single query string. 
             */ 
</span>            <a href="postgres.c.html#LN178"><span class='Ref_to_Proto'>finish_xact_command</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * We need a CommandCounterIncrement after every query, except 
             * those that start or end a transaction block. 
             */ 
</span>            <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Tell client that we're done with this query.  Note we emit exactly 
         * one EndCommand report for each raw parsetree, thus one for each SQL 
         * command the client sent, regardless of rewriting. (But a command 
         * aborted by error will not send an EndCommand report at all.) 
         */ 
</span>        <a href="../../include/tcop/dest.h.html#LN137"><span class='Ref_to_Proto'>EndCommand</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN965"><span class='Ref_To_Local'>completionTag</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN879"><span class='Ref_To_Local'>dest</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span>                           <span class='Comment_Single_Line'>/* end loop over parsetrees */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Close down transaction statement, if one is open. 
     */ 
</span>    <a href="postgres.c.html#LN178"><span class='Ref_to_Proto'>finish_xact_command</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If there were no parsetrees, return EmptyQueryResponse message. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postgres.c.html#LN881"><span class='Ref_To_Local'>parsetree_list</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/tcop/dest.h.html#LN141"><span class='Ref_to_Proto'>NullCommand</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN879"><span class='Ref_To_Local'>dest</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Emit duration logging if appropriate. 
     */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="../../include/tcop/tcopprot.h.html#LN84"><span class='Ref_to_Proto'>check_log_duration</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN886"><span class='Ref_To_Local'>msec_str</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN884"><span class='Ref_To_Local'>was_logged</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <span class='Number'>1</span><span class='Operator'>: 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"duration: %s ms"</span><span class='Delimiter'>, </span><a href="postgres.c.html#LN886"><span class='Ref_To_Local'>msec_str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN1066"><span class='Ref_to_Func'>errhidestmt</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <span class='Number'>2</span><span class='Operator'>: 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"duration: %s ms  statement: %s"</span><span class='Delimiter'>, 
</span>                            <a href="postgres.c.html#LN886"><span class='Ref_To_Local'>msec_str</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN877"><span class='Ref_to_Parameter'>query_string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN1066"><span class='Ref_to_Func'>errhidestmt</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="postgres.c.html#LN173"><span class='Ref_to_Proto'>errdetail_execute</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN881"><span class='Ref_To_Local'>parsetree_list</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN883"><span class='Ref_To_Local'>save_log_statement_stats</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/tcop/tcopprot.h.html#LN83"><span class='Ref_to_Proto'>ShowUsage</span></a><span class='Parentheses'>(</span><span class='String'>"QUERY STATISTICS"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    TRACE_POSTGRESQL_QUERY_DONE<span class='Parentheses'>(</span><a href="postgres.c.html#LN877"><span class='Ref_to_Parameter'>query_string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="postgres.c.html#LN84"><span class='Ref_to_Global_Var'>debug_query_string</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end exec_simple_query &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * exec_parse_message 
 * 
 * Execute a "Parse" protocol message. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1194"></a><span class='Declare_Function'>exec_parse_message</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>query_string</span><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* string to execute */ 
</span><a name="LN1195"></a>                   <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>stmt_name</span><span class='Delimiter'>,</span>       <span class='Comment_Single_Line'>/* name for prepared stmt */ 
</span><a name="LN1196"></a>                   <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>paramTypes</span><span class='Delimiter'>,</span>     <span class='Comment_Single_Line'>/* parameter types */ 
</span><a name="LN1197"></a>                   <span class='Keyword'>int </span><span class='Declare_Parameter'>numParams</span><span class='Parentheses'>)</span>       <span class='Comment_Single_Line'>/* number of parameters */ 
</span><span class='Delimiter'>{ 
</span><a name="LN1199"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>unnamed_stmt_context</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1200"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span><a name="LN1201"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>parsetree_list</span><span class='Delimiter'>; 
</span><a name="LN1202"></a>    <a href="../../include/nodes/parsenodes.h.html#LN1396"><span class='Ref_to_Struct'>RawStmt</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>raw_parse_tree</span><span class='Delimiter'>; 
</span><a name="LN1203"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>commandTag</span><span class='Delimiter'>; 
</span><a name="LN1204"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>querytree_list</span><span class='Delimiter'>; 
</span><a name="LN1205"></a>    <a href="../../include/utils/plancache.h.html#LN79"><span class='Ref_to_Struct'>CachedPlanSource</span></a> <span class='Operator'>*</span><span class='Declare_Local'>psrc</span><span class='Delimiter'>; 
</span><a name="LN1206"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>is_named</span><span class='Delimiter'>; 
</span><a name="LN1207"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>save_log_statement_stats</span> <span class='Operator'>= </span><a href="../utils/misc/guc.c.html#LN440"><span class='Ref_to_Global_Var'>log_statement_stats</span></a><span class='Delimiter'>; 
</span><a name="LN1208"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>msec_str</span><span class='Delimiter'>[</span><span class='Number'>32</span><span class='Delimiter'>]; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Report query to various monitoring facilities. 
     */ 
</span>    <a href="postgres.c.html#LN84"><span class='Ref_to_Global_Var'>debug_query_string</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN1194"><span class='Ref_to_Parameter'>query_string</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/pgstat.h.html#LN1168"><span class='Ref_to_Proto'>pgstat_report_activity</span></a><span class='Parentheses'>(</span><a href="../../include/pgstat.h.html#LN724"><span class='Ref_to_EnumConst'>STATE_RUNNING</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN1194"><span class='Ref_to_Parameter'>query_string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/ps_status.h.html#LN21"><span class='Ref_to_Proto'>set_ps_display</span></a><span class='Parentheses'>(</span><span class='String'>"PARSE"</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN1207"><span class='Ref_To_Local'>save_log_statement_stats</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/tcop/tcopprot.h.html#LN82"><span class='Ref_to_Proto'>ResetUsage</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN23"><span class='Ref_to_Const'>DEBUG2</span></a><span class='Delimiter'>, 
</span>            <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"parse %s: %s"</span><span class='Delimiter'>, 
</span>                    <span class='Operator'>*</span><a href="postgres.c.html#LN1195"><span class='Ref_to_Parameter'>stmt_name</span></a> <span class='Operator'>? </span><a href="postgres.c.html#LN1195"><span class='Ref_to_Parameter'>stmt_name</span></a> <span class='Operator'>: </span><span class='String'>"&LT;unnamed&GT;"</span><span class='Delimiter'>, 
</span>                    <a href="postgres.c.html#LN1194"><span class='Ref_to_Parameter'>query_string</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Start up a transaction command so we can run parse analysis etc. (Note 
     * that this will normally change current memory context.) Nothing happens 
     * if we are already in one. 
     */ 
</span>    <a href="postgres.c.html#LN177"><span class='Ref_to_Proto'>start_xact_command</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Switch to appropriate context for constructing parsetrees. 
     * 
     * We have two strategies depending on whether the prepared statement is 
     * named or not.  For a named prepared statement, we do parsing in 
     * MessageContext and copy the finished trees into the prepared 
     * statement's plancache entry; then the reset of MessageContext releases 
     * temporary space used by parsing and rewriting. For an unnamed prepared 
     * statement, we assume the statement isn't going to hang around long, so 
     * getting rid of temp space quickly is probably not worth the costs of 
     * copying parse trees.  So in this case, we create the plancache entry's 
     * query_context here, and do all the parsing work therein. 
     */ 
</span>    <a href="postgres.c.html#LN1206"><span class='Ref_To_Local'>is_named</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="postgres.c.html#LN1195"><span class='Ref_to_Parameter'>stmt_name</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN1206"><span class='Ref_To_Local'>is_named</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Named prepared statement --- parse in MessageContext */ 
</span>        <a href="postgres.c.html#LN1200"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN46"><span class='Ref_to_Global_Var'>MessageContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Unnamed prepared statement --- release any prior unnamed stmt */ 
</span>        <a href="postgres.c.html#LN182"><span class='Ref_to_Proto'>drop_unnamed_stmt</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Create context for parsing */ 
</span>        <a href="postgres.c.html#LN1199"><span class='Ref_To_Local'>unnamed_stmt_context</span></a> <span class='Operator'>= 
</span>            <a href="../../include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN46"><span class='Ref_to_Global_Var'>MessageContext</span></a><span class='Delimiter'>, 
</span>                                  <span class='String'>"unnamed prepared statement"</span><span class='Delimiter'>, 
</span>                                  <a href="../../include/utils/memutils.h.html#LN164"><span class='Ref_to_Const'>ALLOCSET_DEFAULT_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="postgres.c.html#LN1200"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1199"><span class='Ref_To_Local'>unnamed_stmt_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Do basic parsing of the query or queries (this should be safe even if 
     * we are in aborted transaction state!) 
     */ 
</span>    <a href="postgres.c.html#LN1201"><span class='Ref_To_Local'>parsetree_list</span></a> <span class='Operator'>= </span><a href="../../include/tcop/tcopprot.h.html#LN49"><span class='Ref_to_Proto'>pg_parse_query</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1194"><span class='Ref_to_Parameter'>query_string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We only allow a single user statement in a prepared statement. This is 
     * mainly to keep the protocol simple --- otherwise we'd need to worry 
     * about multiple result tupdescs and things like that. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1201"><span class='Ref_To_Local'>parsetree_list</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot insert multiple commands into a prepared statement"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN1201"><span class='Ref_To_Local'>parsetree_list</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1283"></a>        <a href="../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>query</span><span class='Delimiter'>; 
</span><a name="LN1284"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>snapshot_set</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN1285"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <a href="postgres.c.html#LN1202"><span class='Ref_To_Local'>raw_parse_tree</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN113"><span class='Ref_to_Macro'>linitial_node</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1396"><span class='Ref_to_Struct'>RawStmt</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN1201"><span class='Ref_To_Local'>parsetree_list</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Get the command name for possible use in status display. 
         */ 
</span>        <a href="postgres.c.html#LN1203"><span class='Ref_To_Local'>commandTag</span></a> <span class='Operator'>= </span><a href="../../include/tcop/utility.h.html#LN48"><span class='Ref_to_Proto'>CreateCommandTag</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1202"><span class='Ref_To_Local'>raw_parse_tree</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1399"><span class='Ref_to_Member'>stmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If we are in an aborted transaction, reject all commands except 
         * COMMIT/ROLLBACK.  It is important that this test occur before we 
         * try to do parse analysis, rewrite, or planning, since all those 
         * phases try to do database accesses, which may fail in abort state. 
         * (It might be safe to allow some additional utility commands in this 
         * state, but not many...) 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/xact.h.html#LN330"><span class='Ref_to_Proto'>IsAbortedTransactionBlockState</span></a><span class='Parentheses'>() </span><span class='Operator'>&& 
</span>            <span class='Operator'>!</span><a href="postgres.c.html#LN179"><span class='Ref_to_Proto'>IsTransactionExitStmt</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1202"><span class='Ref_To_Local'>raw_parse_tree</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1399"><span class='Ref_to_Member'>stmt</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_IN_FAILED_SQL_TRANSACTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"current transaction is aborted, "</span> 
                          <span class='String'>"commands ignored until end of transaction block"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="postgres.c.html#LN175"><span class='Ref_to_Proto'>errdetail_abort</span></a><span class='Parentheses'>()))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Create the CachedPlanSource before we do parse analysis, since it 
         * needs to see the unmodified raw parse tree. 
         */ 
</span>        <a href="postgres.c.html#LN1205"><span class='Ref_To_Local'>psrc</span></a> <span class='Operator'>= </span><a href="../../include/utils/plancache.h.html#LN149"><span class='Ref_to_Proto'>CreateCachedPlan</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1202"><span class='Ref_To_Local'>raw_parse_tree</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN1194"><span class='Ref_to_Parameter'>query_string</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN1203"><span class='Ref_To_Local'>commandTag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Set up a snapshot if parse analysis will need one. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/parser/analyze.h.html#LN37"><span class='Ref_to_Proto'>analyze_requires_snapshot</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1202"><span class='Ref_To_Local'>raw_parse_tree</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/snapmgr.h.html#LN73"><span class='Ref_to_Proto'>PushActiveSnapshot</span></a><span class='Parentheses'>(</span><a href="../../include/utils/snapmgr.h.html#LN63"><span class='Ref_to_Proto'>GetTransactionSnapshot</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>            <a href="postgres.c.html#LN1284"><span class='Ref_To_Local'>snapshot_set</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Analyze and rewrite the query.  Note that the originally specified 
         * parameter set is not required to be complete, so we have to use 
         * parse_analyze_varparams(). 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/guc.c.html#LN437"><span class='Ref_to_Global_Var'>log_parser_stats</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/tcop/tcopprot.h.html#LN82"><span class='Ref_to_Proto'>ResetUsage</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <a href="postgres.c.html#LN1283"><span class='Ref_To_Local'>query</span></a> <span class='Operator'>= </span><a href="../../include/parser/analyze.h.html#LN26"><span class='Ref_to_Proto'>parse_analyze_varparams</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1202"><span class='Ref_To_Local'>raw_parse_tree</span></a><span class='Delimiter'>, 
</span>                                        <a href="postgres.c.html#LN1194"><span class='Ref_to_Parameter'>query_string</span></a><span class='Delimiter'>, 
</span>                                        <span class='Operator'>&</span><a href="postgres.c.html#LN1196"><span class='Ref_to_Parameter'>paramTypes</span></a><span class='Delimiter'>, 
</span>                                        <span class='Operator'>&</span><a href="postgres.c.html#LN1197"><span class='Ref_to_Parameter'>numParams</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Check all parameter types got determined. 
         */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN1285"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="postgres.c.html#LN1285"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="postgres.c.html#LN1197"><span class='Ref_to_Parameter'>numParams</span></a><span class='Delimiter'>; </span><a href="postgres.c.html#LN1285"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1343"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ptype</span> <span class='Operator'>= </span><a href="postgres.c.html#LN1196"><span class='Ref_to_Parameter'>paramTypes</span></a><span class='Delimiter'>[</span><a href="postgres.c.html#LN1285"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN1343"><span class='Ref_To_Local'>ptype</span></a> <span class='Operator'>== </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a> <span class='Operator'>|| </span><a href="postgres.c.html#LN1343"><span class='Ref_To_Local'>ptype</span></a> <span class='Operator'>== </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN43"><span class='Ref_to_Const'>UNKNOWNOID</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INDETERMINATE_DATATYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not determine data type of parameter $%d"</span><span class='Delimiter'>, 
</span>                            <a href="postgres.c.html#LN1285"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/guc.c.html#LN437"><span class='Ref_to_Global_Var'>log_parser_stats</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/tcop/tcopprot.h.html#LN83"><span class='Ref_to_Proto'>ShowUsage</span></a><span class='Parentheses'>(</span><span class='String'>"PARSE ANALYSIS STATISTICS"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="postgres.c.html#LN1204"><span class='Ref_To_Local'>querytree_list</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN171"><span class='Ref_to_Proto'>pg_rewrite_query</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1283"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Done with the snapshot used for parsing */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN1284"><span class='Ref_To_Local'>snapshot_set</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/snapmgr.h.html#LN76"><span class='Ref_to_Proto'>PopActiveSnapshot</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if parsetree_list!=NIL &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Empty input string.  This is legal. */ 
</span>        <a href="postgres.c.html#LN1202"><span class='Ref_To_Local'>raw_parse_tree</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="postgres.c.html#LN1203"><span class='Ref_To_Local'>commandTag</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="postgres.c.html#LN1205"><span class='Ref_To_Local'>psrc</span></a> <span class='Operator'>= </span><a href="../../include/utils/plancache.h.html#LN149"><span class='Ref_to_Proto'>CreateCachedPlan</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1202"><span class='Ref_To_Local'>raw_parse_tree</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN1194"><span class='Ref_to_Parameter'>query_string</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN1203"><span class='Ref_To_Local'>commandTag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="postgres.c.html#LN1204"><span class='Ref_To_Local'>querytree_list</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * CachedPlanSource must be a direct child of MessageContext before we 
     * reparent unnamed_stmt_context under it, else we have a disconnected 
     * circular subgraph.  Klugy, but less so than flipping contexts even more 
     * above. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN1199"><span class='Ref_To_Local'>unnamed_stmt_context</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/memutils.h.html#LN78"><span class='Ref_to_Proto'>MemoryContextSetParent</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1205"><span class='Ref_To_Local'>psrc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/plancache.h.html#LN92"><span class='Ref_to_Member'>context</span></a><span class='Delimiter'>, </span><a href="../utils/mmgr/mcxt.c.html#LN46"><span class='Ref_to_Global_Var'>MessageContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Finish filling in the CachedPlanSource */ 
</span>    <a href="../../include/utils/plancache.h.html#LN155"><span class='Ref_to_Proto'>CompleteCachedPlan</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1205"><span class='Ref_To_Local'>psrc</span></a><span class='Delimiter'>, 
</span>                       <a href="postgres.c.html#LN1204"><span class='Ref_To_Local'>querytree_list</span></a><span class='Delimiter'>, 
</span>                       <a href="postgres.c.html#LN1199"><span class='Ref_To_Local'>unnamed_stmt_context</span></a><span class='Delimiter'>, 
</span>                       <a href="postgres.c.html#LN1196"><span class='Ref_to_Parameter'>paramTypes</span></a><span class='Delimiter'>, 
</span>                       <a href="postgres.c.html#LN1197"><span class='Ref_to_Parameter'>numParams</span></a><span class='Delimiter'>, 
</span>                       <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                       <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                       <a href="../../include/nodes/parsenodes.h.html#LN2610"><span class='Ref_to_Const'>CURSOR_OPT_PARALLEL_OK</span></a><span class='Delimiter'>,</span>  <span class='Comment_Single_Line'>/* allow parallel mode */ 
</span>                       <span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* fixed result */ 
</span> 
    <span class='Comment_Multi_Line'>/* If we got a cancel signal during analysis, quit */ 
</span>    <a href="../../include/miscadmin.h.html#LN99"><span class='Ref_to_Macro'>CHECK_FOR_INTERRUPTS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN1206"><span class='Ref_To_Local'>is_named</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Store the query as a prepared statement. 
         */ 
</span>        <a href="../../include/commands/prepare.h.html#LN48"><span class='Ref_to_Proto'>StorePreparedStatement</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1195"><span class='Ref_to_Parameter'>stmt_name</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN1205"><span class='Ref_To_Local'>psrc</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * We just save the CachedPlanSource into unnamed_stmt_psrc. 
         */ 
</span>        <a href="../../include/utils/plancache.h.html#LN165"><span class='Ref_to_Proto'>SaveCachedPlan</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1205"><span class='Ref_To_Local'>psrc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="postgres.c.html#LN150"><span class='Ref_to_Global_Var'>unnamed_stmt_psrc</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN1205"><span class='Ref_To_Local'>psrc</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1200"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We do NOT close the open transaction command here; that only happens 
     * when the client sends Sync.  Instead, do CommandCounterIncrement just 
     * in case something happened during parse/plan. 
     */ 
</span>    <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Send ParseComplete. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN87"><span class='Ref_to_Global_Var'>whereToSendOutput</span></a> <span class='Operator'>== </span><a href="../../include/tcop/dest.h.html#LN89"><span class='Ref_to_EnumConst'>DestRemote</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/libpq/pqformat.h.html#LN35"><span class='Ref_to_Proto'>pq_putemptymessage</span></a><span class='Parentheses'>(</span><span class='String'>'1'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Emit duration logging if appropriate. 
     */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="../../include/tcop/tcopprot.h.html#LN84"><span class='Ref_to_Proto'>check_log_duration</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1208"><span class='Ref_To_Local'>msec_str</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <span class='Number'>1</span><span class='Operator'>: 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"duration: %s ms"</span><span class='Delimiter'>, </span><a href="postgres.c.html#LN1208"><span class='Ref_To_Local'>msec_str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN1066"><span class='Ref_to_Func'>errhidestmt</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <span class='Number'>2</span><span class='Operator'>: 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"duration: %s ms  parse %s: %s"</span><span class='Delimiter'>, 
</span>                            <a href="postgres.c.html#LN1208"><span class='Ref_To_Local'>msec_str</span></a><span class='Delimiter'>, 
</span>                            <span class='Operator'>*</span><a href="postgres.c.html#LN1195"><span class='Ref_to_Parameter'>stmt_name</span></a> <span class='Operator'>? </span><a href="postgres.c.html#LN1195"><span class='Ref_to_Parameter'>stmt_name</span></a> <span class='Operator'>: </span><span class='String'>"&LT;unnamed&GT;"</span><span class='Delimiter'>, 
</span>                            <a href="postgres.c.html#LN1194"><span class='Ref_to_Parameter'>query_string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN1066"><span class='Ref_to_Func'>errhidestmt</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN1207"><span class='Ref_To_Local'>save_log_statement_stats</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/tcop/tcopprot.h.html#LN83"><span class='Ref_to_Proto'>ShowUsage</span></a><span class='Parentheses'>(</span><span class='String'>"PARSE MESSAGE STATISTICS"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="postgres.c.html#LN84"><span class='Ref_to_Global_Var'>debug_query_string</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end exec_parse_message &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * exec_bind_message 
 * 
 * Process a "Bind" message to create a portal from a prepared statement 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1456"></a><span class='Declare_Function'>exec_bind_message</span><span class='Parentheses'>(</span><a href="../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>input_message</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1458"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>portal_name</span><span class='Delimiter'>; 
</span><a name="LN1459"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>stmt_name</span><span class='Delimiter'>; 
</span><a name="LN1460"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>numPFormats</span><span class='Delimiter'>; 
</span><a name="LN1461"></a>    <a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>pformats</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1462"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>numParams</span><span class='Delimiter'>; 
</span><a name="LN1463"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>numRFormats</span><span class='Delimiter'>; 
</span><a name="LN1464"></a>    <a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>rformats</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1465"></a>    <a href="../../include/utils/plancache.h.html#LN79"><span class='Ref_to_Struct'>CachedPlanSource</span></a> <span class='Operator'>*</span><span class='Declare_Local'>psrc</span><span class='Delimiter'>; 
</span><a name="LN1466"></a>    <a href="../../include/utils/plancache.h.html#LN129"><span class='Ref_to_Struct'>CachedPlan</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cplan</span><span class='Delimiter'>; 
</span><a name="LN1467"></a>    <a href="../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a>      <span class='Declare_Local'>portal</span><span class='Delimiter'>; 
</span><a name="LN1468"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>query_string</span><span class='Delimiter'>; 
</span><a name="LN1469"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>saved_stmt_name</span><span class='Delimiter'>; 
</span><a name="LN1470"></a>    <a href="../../include/nodes/params.h.html#LN61"><span class='Ref_to_Typedef'>ParamListInfo</span></a> <span class='Declare_Local'>params</span><span class='Delimiter'>; 
</span><a name="LN1471"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldContext</span><span class='Delimiter'>; 
</span><a name="LN1472"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>save_log_statement_stats</span> <span class='Operator'>= </span><a href="../utils/misc/guc.c.html#LN440"><span class='Ref_to_Global_Var'>log_statement_stats</span></a><span class='Delimiter'>; 
</span><a name="LN1473"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>snapshot_set</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN1474"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>msec_str</span><span class='Delimiter'>[</span><span class='Number'>32</span><span class='Delimiter'>]; 
</span> 
    <span class='Comment_Multi_Line'>/* Get the fixed part of the message */ 
</span>    <a href="postgres.c.html#LN1458"><span class='Ref_To_Local'>portal_name</span></a> <span class='Operator'>= </span><a href="../../include/libpq/pqformat.h.html#LN45"><span class='Ref_to_Proto'>pq_getmsgstring</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1456"><span class='Ref_to_Parameter'>input_message</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="postgres.c.html#LN1459"><span class='Ref_To_Local'>stmt_name</span></a> <span class='Operator'>= </span><a href="../../include/libpq/pqformat.h.html#LN45"><span class='Ref_to_Proto'>pq_getmsgstring</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1456"><span class='Ref_to_Parameter'>input_message</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN23"><span class='Ref_to_Const'>DEBUG2</span></a><span class='Delimiter'>, 
</span>            <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"bind %s to %s"</span><span class='Delimiter'>, 
</span>                    <span class='Operator'>*</span><a href="postgres.c.html#LN1458"><span class='Ref_To_Local'>portal_name</span></a> <span class='Operator'>? </span><a href="postgres.c.html#LN1458"><span class='Ref_To_Local'>portal_name</span></a> <span class='Operator'>: </span><span class='String'>"&LT;unnamed&GT;"</span><span class='Delimiter'>, 
</span>                    <span class='Operator'>*</span><a href="postgres.c.html#LN1459"><span class='Ref_To_Local'>stmt_name</span></a> <span class='Operator'>? </span><a href="postgres.c.html#LN1459"><span class='Ref_To_Local'>stmt_name</span></a> <span class='Operator'>: </span><span class='String'>"&LT;unnamed&GT;"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Find prepared statement */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN1459"><span class='Ref_To_Local'>stmt_name</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1488"></a>        <a href="../../include/commands/prepare.h.html#LN26"><span class='Ref_to_Typedef'>PreparedStatement</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pstmt</span><span class='Delimiter'>; 
</span> 
        <a href="postgres.c.html#LN1488"><span class='Ref_To_Local'>pstmt</span></a> <span class='Operator'>= </span><a href="../../include/commands/prepare.h.html#LN51"><span class='Ref_to_Proto'>FetchPreparedStatement</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1459"><span class='Ref_To_Local'>stmt_name</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="postgres.c.html#LN1465"><span class='Ref_To_Local'>psrc</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN1488"><span class='Ref_To_Local'>pstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/prepare.h.html#LN30"><span class='Ref_to_Member'>plansource</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* special-case the unnamed statement */ 
</span>        <a href="postgres.c.html#LN1465"><span class='Ref_To_Local'>psrc</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN150"><span class='Ref_to_Global_Var'>unnamed_stmt_psrc</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postgres.c.html#LN1465"><span class='Ref_To_Local'>psrc</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_PSTATEMENT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"unnamed prepared statement does not exist"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Report query to various monitoring facilities. 
     */ 
</span>    <a href="postgres.c.html#LN84"><span class='Ref_to_Global_Var'>debug_query_string</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN1465"><span class='Ref_To_Local'>psrc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/plancache.h.html#LN83"><span class='Ref_to_Member'>query_string</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/pgstat.h.html#LN1168"><span class='Ref_to_Proto'>pgstat_report_activity</span></a><span class='Parentheses'>(</span><a href="../../include/pgstat.h.html#LN724"><span class='Ref_to_EnumConst'>STATE_RUNNING</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN1465"><span class='Ref_To_Local'>psrc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/plancache.h.html#LN83"><span class='Ref_to_Member'>query_string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/ps_status.h.html#LN21"><span class='Ref_to_Proto'>set_ps_display</span></a><span class='Parentheses'>(</span><span class='String'>"BIND"</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN1472"><span class='Ref_To_Local'>save_log_statement_stats</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/tcop/tcopprot.h.html#LN82"><span class='Ref_to_Proto'>ResetUsage</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Start up a transaction command so we can call functions etc. (Note that 
     * this will normally change current memory context.) Nothing happens if 
     * we are already in one. 
     */ 
</span>    <a href="postgres.c.html#LN177"><span class='Ref_to_Proto'>start_xact_command</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Switch back to message context */ 
</span>    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN46"><span class='Ref_to_Global_Var'>MessageContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get the parameter format codes */ 
</span>    <a href="postgres.c.html#LN1460"><span class='Ref_To_Local'>numPFormats</span></a> <span class='Operator'>= </span><a href="../../include/libpq/pqformat.h.html#LN38"><span class='Ref_to_Proto'>pq_getmsgint</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1456"><span class='Ref_to_Parameter'>input_message</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN1460"><span class='Ref_To_Local'>numPFormats</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1529"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <a href="postgres.c.html#LN1461"><span class='Ref_To_Local'>pformats</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1460"><span class='Ref_To_Local'>numPFormats</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN1529"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="postgres.c.html#LN1529"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="postgres.c.html#LN1460"><span class='Ref_To_Local'>numPFormats</span></a><span class='Delimiter'>; </span><a href="postgres.c.html#LN1529"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <a href="postgres.c.html#LN1461"><span class='Ref_To_Local'>pformats</span></a><span class='Delimiter'>[</span><a href="postgres.c.html#LN1529"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/libpq/pqformat.h.html#LN38"><span class='Ref_to_Proto'>pq_getmsgint</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1456"><span class='Ref_to_Parameter'>input_message</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Get the parameter value count */ 
</span>    <a href="postgres.c.html#LN1462"><span class='Ref_To_Local'>numParams</span></a> <span class='Operator'>= </span><a href="../../include/libpq/pqformat.h.html#LN38"><span class='Ref_to_Proto'>pq_getmsgint</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1456"><span class='Ref_to_Parameter'>input_message</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN1460"><span class='Ref_To_Local'>numPFormats</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span> <span class='Operator'>&& </span><a href="postgres.c.html#LN1460"><span class='Ref_To_Local'>numPFormats</span></a> <span class='Operator'>!= </span><a href="postgres.c.html#LN1462"><span class='Ref_To_Local'>numParams</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_PROTOCOL_VIOLATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>            <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"bind message has %d parameter formats but %d parameters"</span><span class='Delimiter'>, 
</span>                   <a href="postgres.c.html#LN1460"><span class='Ref_To_Local'>numPFormats</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN1462"><span class='Ref_To_Local'>numParams</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN1462"><span class='Ref_To_Local'>numParams</span></a> <span class='Operator'>!= </span><a href="postgres.c.html#LN1465"><span class='Ref_To_Local'>psrc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/plancache.h.html#LN86"><span class='Ref_to_Member'>num_params</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_PROTOCOL_VIOLATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"bind message supplies %d parameters, but prepared statement \"%s\" requires %d"</span><span class='Delimiter'>, 
</span>                        <a href="postgres.c.html#LN1462"><span class='Ref_To_Local'>numParams</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN1459"><span class='Ref_To_Local'>stmt_name</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN1465"><span class='Ref_To_Local'>psrc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/plancache.h.html#LN86"><span class='Ref_to_Member'>num_params</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we are in aborted transaction state, the only portals we can 
     * actually run are those containing COMMIT or ROLLBACK commands. We 
     * disallow binding anything else to avoid problems with infrastructure 
     * that expects to run inside a valid transaction.  We also disallow 
     * binding any parameters, since we can't risk calling user-defined I/O 
     * functions. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/xact.h.html#LN330"><span class='Ref_to_Proto'>IsAbortedTransactionBlockState</span></a><span class='Parentheses'>()</span> <span class='Operator'>&& 
</span>        <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="postgres.c.html#LN1465"><span class='Ref_To_Local'>psrc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/plancache.h.html#LN82"><span class='Ref_to_Member'>raw_parse_tree</span></a> <span class='Operator'>&& 
</span>           <a href="postgres.c.html#LN179"><span class='Ref_to_Proto'>IsTransactionExitStmt</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1465"><span class='Ref_To_Local'>psrc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/plancache.h.html#LN82"><span class='Ref_to_Member'>raw_parse_tree</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1399"><span class='Ref_to_Member'>stmt</span></a><span class='Parentheses'>))</span> <span class='Operator'>|| 
</span>         <a href="postgres.c.html#LN1462"><span class='Ref_To_Local'>numParams</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_IN_FAILED_SQL_TRANSACTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"current transaction is aborted, "</span> 
                        <span class='String'>"commands ignored until end of transaction block"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="postgres.c.html#LN175"><span class='Ref_to_Proto'>errdetail_abort</span></a><span class='Parentheses'>()))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Create the portal.  Allow silent replacement of an existing portal only 
     * if the unnamed portal is specified. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN1458"><span class='Ref_To_Local'>portal_name</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>        <a href="postgres.c.html#LN1467"><span class='Ref_To_Local'>portal</span></a> <span class='Operator'>= </span><a href="../utils/mmgr/portalmem.c.html#LN172"><span class='Ref_to_Func'>CreatePortal</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1458"><span class='Ref_To_Local'>portal_name</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="postgres.c.html#LN1467"><span class='Ref_To_Local'>portal</span></a> <span class='Operator'>= </span><a href="../utils/mmgr/portalmem.c.html#LN172"><span class='Ref_to_Func'>CreatePortal</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1458"><span class='Ref_To_Local'>portal_name</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Prepare to copy stuff into the portal's memory context.  We do all this 
     * copying first, because it could possibly fail (out-of-memory) and we 
     * don't want a failure to occur between GetCachedPlan and 
     * PortalDefineQuery; that would result in leaking our plancache refcount. 
     */ 
</span>    <a href="postgres.c.html#LN1471"><span class='Ref_To_Local'>oldContext</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../../include/utils/portal.h.html#LN204"><span class='Ref_to_Macro'>PortalGetHeapMemory</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1467"><span class='Ref_To_Local'>portal</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Copy the plan's query string into the portal */ 
</span>    <a href="postgres.c.html#LN1468"><span class='Ref_To_Local'>query_string</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1465"><span class='Ref_To_Local'>psrc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/plancache.h.html#LN83"><span class='Ref_to_Member'>query_string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Likewise make a copy of the statement name, unless it's unnamed */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN1459"><span class='Ref_To_Local'>stmt_name</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>        <a href="postgres.c.html#LN1469"><span class='Ref_To_Local'>saved_stmt_name</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1459"><span class='Ref_To_Local'>stmt_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="postgres.c.html#LN1469"><span class='Ref_To_Local'>saved_stmt_name</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Set a snapshot if we have parameters to fetch (since the input 
     * functions might need it) or the query isn't a utility command (and 
     * hence could require redoing parse analysis and planning).  We keep the 
     * snapshot active till we're done, so that plancache.c doesn't have to 
     * take new ones. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN1462"><span class='Ref_To_Local'>numParams</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        <span class='Parentheses'>(</span><a href="postgres.c.html#LN1465"><span class='Ref_To_Local'>psrc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/plancache.h.html#LN82"><span class='Ref_to_Member'>raw_parse_tree</span></a> <span class='Operator'>&& 
</span>         <a href="../../include/parser/analyze.h.html#LN37"><span class='Ref_to_Proto'>analyze_requires_snapshot</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1465"><span class='Ref_To_Local'>psrc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/plancache.h.html#LN82"><span class='Ref_to_Member'>raw_parse_tree</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/snapmgr.h.html#LN73"><span class='Ref_to_Proto'>PushActiveSnapshot</span></a><span class='Parentheses'>(</span><a href="../../include/utils/snapmgr.h.html#LN63"><span class='Ref_to_Proto'>GetTransactionSnapshot</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>        <a href="postgres.c.html#LN1473"><span class='Ref_To_Local'>snapshot_set</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Fetch parameters, if any, and store in the portal's memory context. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN1462"><span class='Ref_To_Local'>numParams</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1615"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>paramno</span><span class='Delimiter'>; 
</span> 
        <a href="postgres.c.html#LN1470"><span class='Ref_To_Local'>params</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/params.h.html#LN61"><span class='Ref_to_Typedef'>ParamListInfo</span></a><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/params.h.html#LN67"><span class='Ref_to_Struct'>ParamListInfoData</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN1470"><span class='Ref_To_Local'>params</span></a><span class='Parentheses'>) </span><span class='Operator'>+ 
</span>                                        <a href="postgres.c.html#LN1462"><span class='Ref_To_Local'>numParams</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/nodes/params.h.html#LN53"><span class='Ref_to_Struct'>ParamExternData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* we have static list of params, so no hooks needed */ 
</span>        <a href="postgres.c.html#LN1470"><span class='Ref_To_Local'>params</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/params.h.html#LN69"><span class='Ref_to_Member'>paramFetch</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="postgres.c.html#LN1470"><span class='Ref_To_Local'>params</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/params.h.html#LN70"><span class='Ref_to_Member'>paramFetchArg</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="postgres.c.html#LN1470"><span class='Ref_To_Local'>params</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/params.h.html#LN71"><span class='Ref_to_Member'>parserSetup</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="postgres.c.html#LN1470"><span class='Ref_To_Local'>params</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/params.h.html#LN72"><span class='Ref_to_Member'>parserSetupArg</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="postgres.c.html#LN1470"><span class='Ref_To_Local'>params</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/params.h.html#LN73"><span class='Ref_to_Member'>numParams</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN1462"><span class='Ref_To_Local'>numParams</span></a><span class='Delimiter'>; 
</span>        <a href="postgres.c.html#LN1470"><span class='Ref_To_Local'>params</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/params.h.html#LN74"><span class='Ref_to_Member'>paramMask</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN1615"><span class='Ref_To_Local'>paramno</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="postgres.c.html#LN1615"><span class='Ref_To_Local'>paramno</span></a> <span class='Operator'>&LT; </span><a href="postgres.c.html#LN1462"><span class='Ref_To_Local'>numParams</span></a><span class='Delimiter'>; </span><a href="postgres.c.html#LN1615"><span class='Ref_To_Local'>paramno</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1629"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ptype</span> <span class='Operator'>= </span><a href="postgres.c.html#LN1465"><span class='Ref_To_Local'>psrc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/plancache.h.html#LN85"><span class='Ref_to_Member'>param_types</span></a><span class='Delimiter'>[</span><a href="postgres.c.html#LN1615"><span class='Ref_To_Local'>paramno</span></a><span class='Delimiter'>]; 
</span><a name="LN1630"></a>            <a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>plength</span><span class='Delimiter'>; 
</span><a name="LN1631"></a>            <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>pval</span><span class='Delimiter'>; 
</span><a name="LN1632"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span><a name="LN1633"></a>            <a href="../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>pbuf</span><span class='Delimiter'>; 
</span><a name="LN1634"></a>            <span class='Keyword'>char</span>        <span class='Declare_Local'>csave</span><span class='Delimiter'>; 
</span><a name="LN1635"></a>            <a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>       <span class='Declare_Local'>pformat</span><span class='Delimiter'>; 
</span> 
            <a href="postgres.c.html#LN1630"><span class='Ref_To_Local'>plength</span></a> <span class='Operator'>= </span><a href="../../include/libpq/pqformat.h.html#LN38"><span class='Ref_to_Proto'>pq_getmsgint</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1456"><span class='Ref_to_Parameter'>input_message</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="postgres.c.html#LN1632"><span class='Ref_To_Local'>isNull</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="postgres.c.html#LN1630"><span class='Ref_To_Local'>plength</span></a> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postgres.c.html#LN1632"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1642"></a>                <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>pvalue</span> <span class='Operator'>= </span><a href="../../include/libpq/pqformat.h.html#LN42"><span class='Ref_to_Proto'>pq_getmsgbytes</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1456"><span class='Ref_to_Parameter'>input_message</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN1630"><span class='Ref_To_Local'>plength</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Rather than copying data around, we just set up a phony 
                 * StringInfo pointing to the correct portion of the message 
                 * buffer.  We assume we can scribble on the message buffer so 
                 * as to maintain the convention that StringInfos have a 
                 * trailing null.  This is grotty but is a big win when 
                 * dealing with very large parameter strings. 
                 */ 
</span>                <a href="postgres.c.html#LN1633"><span class='Ref_To_Local'>pbuf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres.c.html#LN1642"><span class='Ref_To_Local'>pvalue</span></a><span class='Delimiter'>; 
</span>                <a href="postgres.c.html#LN1633"><span class='Ref_To_Local'>pbuf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN38"><span class='Ref_to_Member'>maxlen</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN1630"><span class='Ref_To_Local'>plength</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <a href="postgres.c.html#LN1633"><span class='Ref_To_Local'>pbuf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN1630"><span class='Ref_To_Local'>plength</span></a><span class='Delimiter'>; 
</span>                <a href="postgres.c.html#LN1633"><span class='Ref_To_Local'>pbuf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN39"><span class='Ref_to_Member'>cursor</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
                <a href="postgres.c.html#LN1634"><span class='Ref_To_Local'>csave</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN1633"><span class='Ref_To_Local'>pbuf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>[</span><a href="postgres.c.html#LN1630"><span class='Ref_To_Local'>plength</span></a><span class='Delimiter'>]; 
</span>                <a href="postgres.c.html#LN1633"><span class='Ref_To_Local'>pbuf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>[</span><a href="postgres.c.html#LN1630"><span class='Ref_To_Local'>plength</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !isNull &raquo; </span> 
            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="postgres.c.html#LN1633"><span class='Ref_To_Local'>pbuf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>                <a href="postgres.c.html#LN1634"><span class='Ref_To_Local'>csave</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN1460"><span class='Ref_To_Local'>numPFormats</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                <a href="postgres.c.html#LN1635"><span class='Ref_To_Local'>pformat</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN1461"><span class='Ref_To_Local'>pformats</span></a><span class='Delimiter'>[</span><a href="postgres.c.html#LN1615"><span class='Ref_To_Local'>paramno</span></a><span class='Delimiter'>]; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN1460"><span class='Ref_To_Local'>numPFormats</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="postgres.c.html#LN1635"><span class='Ref_To_Local'>pformat</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN1461"><span class='Ref_To_Local'>pformats</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span>            <span class='Control'>else</span> 
                <a href="postgres.c.html#LN1635"><span class='Ref_To_Local'>pformat</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* default = text */ 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN1635"><span class='Ref_To_Local'>pformat</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span>   <span class='Comment_Single_Line'>/* text mode */ 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1675"></a>                <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typinput</span><span class='Delimiter'>; 
</span><a name="LN1676"></a>                <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typioparam</span><span class='Delimiter'>; 
</span><a name="LN1677"></a>                <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>pstring</span><span class='Delimiter'>; 
</span> 
                <a href="../../include/utils/lsyscache.h.html#LN161"><span class='Ref_to_Proto'>getTypeInputInfo</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1629"><span class='Ref_To_Local'>ptype</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres.c.html#LN1675"><span class='Ref_To_Local'>typinput</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres.c.html#LN1676"><span class='Ref_To_Local'>typioparam</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * We have to do encoding conversion before calling the 
                 * typinput routine. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN1632"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>                    <a href="postgres.c.html#LN1677"><span class='Ref_To_Local'>pstring</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="postgres.c.html#LN1677"><span class='Ref_To_Local'>pstring</span></a> <span class='Operator'>= </span><a href="../utils/mb/mbutils.c.html#LN554"><span class='Ref_to_Func'>pg_client_to_server</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1633"><span class='Ref_To_Local'>pbuf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN1630"><span class='Ref_To_Local'>plength</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="postgres.c.html#LN1631"><span class='Ref_To_Local'>pval</span></a> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN644"><span class='Ref_to_Proto'>OidInputFunctionCall</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1675"><span class='Ref_To_Local'>typinput</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN1677"><span class='Ref_To_Local'>pstring</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN1676"><span class='Ref_To_Local'>typioparam</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Free result of encoding conversion, if any */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN1677"><span class='Ref_To_Local'>pstring</span></a> <span class='Operator'>&& </span><a href="postgres.c.html#LN1677"><span class='Ref_To_Local'>pstring</span></a> <span class='Operator'>!= </span><a href="postgres.c.html#LN1633"><span class='Ref_To_Local'>pbuf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1677"><span class='Ref_To_Local'>pstring</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if pformat==0 &raquo; </span> 
            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN1635"><span class='Ref_To_Local'>pformat</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span>      <span class='Comment_Single_Line'>/* binary mode */ 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1698"></a>                <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typreceive</span><span class='Delimiter'>; 
</span><a name="LN1699"></a>                <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typioparam</span><span class='Delimiter'>; 
</span><a name="LN1700"></a>                <a href="../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a>  <span class='Declare_Local'>bufptr</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Call the parameter type's binary input converter 
                 */ 
</span>                <a href="../../include/utils/lsyscache.h.html#LN163"><span class='Ref_to_Proto'>getTypeBinaryInputInfo</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1629"><span class='Ref_To_Local'>ptype</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres.c.html#LN1698"><span class='Ref_To_Local'>typreceive</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres.c.html#LN1699"><span class='Ref_To_Local'>typioparam</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN1632"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>                    <a href="postgres.c.html#LN1700"><span class='Ref_To_Local'>bufptr</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="postgres.c.html#LN1700"><span class='Ref_To_Local'>bufptr</span></a> <span class='Operator'>= &</span><a href="postgres.c.html#LN1633"><span class='Ref_To_Local'>pbuf</span></a><span class='Delimiter'>; 
</span> 
                <a href="postgres.c.html#LN1631"><span class='Ref_To_Local'>pval</span></a> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN650"><span class='Ref_to_Proto'>OidReceiveFunctionCall</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1698"><span class='Ref_To_Local'>typreceive</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN1700"><span class='Ref_To_Local'>bufptr</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN1699"><span class='Ref_To_Local'>typioparam</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Trouble if it didn't eat the whole buffer */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postgres.c.html#LN1632"><span class='Ref_To_Local'>isNull</span></a> <span class='Operator'>&& </span><a href="postgres.c.html#LN1633"><span class='Ref_To_Local'>pbuf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN39"><span class='Ref_to_Member'>cursor</span></a> <span class='Operator'>!= </span><a href="postgres.c.html#LN1633"><span class='Ref_To_Local'>pbuf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_BINARY_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"incorrect binary data format in bind parameter %d"</span><span class='Delimiter'>, 
</span>                                    <a href="postgres.c.html#LN1615"><span class='Ref_To_Local'>paramno</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if pformat==1 &raquo; </span> 
            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"unsupported format code: %d"</span><span class='Delimiter'>, 
</span>                                <a href="postgres.c.html#LN1635"><span class='Ref_To_Local'>pformat</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <a href="postgres.c.html#LN1631"><span class='Ref_To_Local'>pval</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* Restore message buffer contents */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postgres.c.html#LN1632"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>                <a href="postgres.c.html#LN1633"><span class='Ref_To_Local'>pbuf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>[</span><a href="postgres.c.html#LN1630"><span class='Ref_To_Local'>plength</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="postgres.c.html#LN1634"><span class='Ref_To_Local'>csave</span></a><span class='Delimiter'>; 
</span> 
            <a href="postgres.c.html#LN1470"><span class='Ref_To_Local'>params</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/params.h.html#LN75"><span class='Ref_to_Member'>params</span></a><span class='Delimiter'>[</span><a href="postgres.c.html#LN1615"><span class='Ref_To_Local'>paramno</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><span class='Keyword'>value </span><span class='Operator'>= </span><a href="postgres.c.html#LN1631"><span class='Ref_To_Local'>pval</span></a><span class='Delimiter'>; 
</span>            <a href="postgres.c.html#LN1470"><span class='Ref_To_Local'>params</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/params.h.html#LN75"><span class='Ref_to_Member'>params</span></a><span class='Delimiter'>[</span><a href="postgres.c.html#LN1615"><span class='Ref_To_Local'>paramno</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../include/nodes/params.h.html#LN56"><span class='Ref_to_Member'>isnull</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN1632"><span class='Ref_To_Local'>isNull</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * We mark the params as CONST.  This ensures that any custom plan 
             * makes full use of the parameter values. 
             */ 
</span>            <a href="postgres.c.html#LN1470"><span class='Ref_To_Local'>params</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/params.h.html#LN75"><span class='Ref_to_Member'>params</span></a><span class='Delimiter'>[</span><a href="postgres.c.html#LN1615"><span class='Ref_To_Local'>paramno</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../include/nodes/params.h.html#LN57"><span class='Ref_to_Member'>pflags</span></a> <span class='Operator'>= </span><a href="../../include/nodes/params.h.html#LN51"><span class='Ref_to_Const'>PARAM_FLAG_CONST</span></a><span class='Delimiter'>; 
</span>            <a href="postgres.c.html#LN1470"><span class='Ref_To_Local'>params</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/params.h.html#LN75"><span class='Ref_to_Member'>params</span></a><span class='Delimiter'>[</span><a href="postgres.c.html#LN1615"><span class='Ref_To_Local'>paramno</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../include/nodes/params.h.html#LN58"><span class='Ref_to_Member'>ptype</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN1629"><span class='Ref_To_Local'>ptype</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for paramno=0;paramno&LT;num... &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if numParams&GT;0 &raquo; </span> 
    <span class='Control'>else</span> 
        <a href="postgres.c.html#LN1470"><span class='Ref_To_Local'>params</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Done storing stuff in portal's context */ 
</span>    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1471"><span class='Ref_To_Local'>oldContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get the result format codes */ 
</span>    <a href="postgres.c.html#LN1463"><span class='Ref_To_Local'>numRFormats</span></a> <span class='Operator'>= </span><a href="../../include/libpq/pqformat.h.html#LN38"><span class='Ref_to_Proto'>pq_getmsgint</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1456"><span class='Ref_to_Parameter'>input_message</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN1463"><span class='Ref_To_Local'>numRFormats</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1755"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <a href="postgres.c.html#LN1464"><span class='Ref_To_Local'>rformats</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1463"><span class='Ref_To_Local'>numRFormats</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN1755"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="postgres.c.html#LN1755"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="postgres.c.html#LN1463"><span class='Ref_To_Local'>numRFormats</span></a><span class='Delimiter'>; </span><a href="postgres.c.html#LN1755"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <a href="postgres.c.html#LN1464"><span class='Ref_To_Local'>rformats</span></a><span class='Delimiter'>[</span><a href="postgres.c.html#LN1755"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/libpq/pqformat.h.html#LN38"><span class='Ref_to_Proto'>pq_getmsgint</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1456"><span class='Ref_to_Parameter'>input_message</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/libpq/pqformat.h.html#LN47"><span class='Ref_to_Proto'>pq_getmsgend</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1456"><span class='Ref_to_Parameter'>input_message</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Obtain a plan from the CachedPlanSource.  Any cruft from (re)planning 
     * will be generated in MessageContext.  The plan refcount will be 
     * assigned to the Portal, so it will be released at portal destruction. 
     */ 
</span>    <a href="postgres.c.html#LN1466"><span class='Ref_To_Local'>cplan</span></a> <span class='Operator'>= </span><a href="../../include/utils/plancache.h.html#LN178"><span class='Ref_to_Proto'>GetCachedPlan</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1465"><span class='Ref_To_Local'>psrc</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN1470"><span class='Ref_To_Local'>params</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now we can define the portal. 
     * 
     * DO NOT put any code that could possibly throw an error between the 
     * above GetCachedPlan call and here. 
     */ 
</span>    <a href="../../include/utils/portal.h.html#LN229"><span class='Ref_to_Proto'>PortalDefineQuery</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1467"><span class='Ref_To_Local'>portal</span></a><span class='Delimiter'>, 
</span>                      <a href="postgres.c.html#LN1469"><span class='Ref_To_Local'>saved_stmt_name</span></a><span class='Delimiter'>, 
</span>                      <a href="postgres.c.html#LN1468"><span class='Ref_To_Local'>query_string</span></a><span class='Delimiter'>, 
</span>                      <a href="postgres.c.html#LN1465"><span class='Ref_To_Local'>psrc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/plancache.h.html#LN84"><span class='Ref_to_Member'>commandTag</span></a><span class='Delimiter'>, 
</span>                      <a href="postgres.c.html#LN1466"><span class='Ref_To_Local'>cplan</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/plancache.h.html#LN132"><span class='Ref_to_Member'>stmt_list</span></a><span class='Delimiter'>, 
</span>                      <a href="postgres.c.html#LN1466"><span class='Ref_To_Local'>cplan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Done with the snapshot used for parameter I/O and parsing/planning */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN1473"><span class='Ref_To_Local'>snapshot_set</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/snapmgr.h.html#LN76"><span class='Ref_to_Proto'>PopActiveSnapshot</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * And we're ready to start portal execution. 
     */ 
</span>    <a href="../../include/tcop/pquery.h.html#LN29"><span class='Ref_to_Proto'>PortalStart</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1467"><span class='Ref_To_Local'>portal</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN1470"><span class='Ref_To_Local'>params</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="../../include/utils/snapshot.h.html#LN24"><span class='Ref_to_Const'>InvalidSnapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Apply the result format requests to the portal. 
     */ 
</span>    <a href="../../include/tcop/pquery.h.html#LN32"><span class='Ref_to_Proto'>PortalSetResultFormat</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1467"><span class='Ref_To_Local'>portal</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN1463"><span class='Ref_To_Local'>numRFormats</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN1464"><span class='Ref_To_Local'>rformats</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Send BindComplete. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN87"><span class='Ref_to_Global_Var'>whereToSendOutput</span></a> <span class='Operator'>== </span><a href="../../include/tcop/dest.h.html#LN89"><span class='Ref_to_EnumConst'>DestRemote</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/libpq/pqformat.h.html#LN35"><span class='Ref_to_Proto'>pq_putemptymessage</span></a><span class='Parentheses'>(</span><span class='String'>'2'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Emit duration logging if appropriate. 
     */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="../../include/tcop/tcopprot.h.html#LN84"><span class='Ref_to_Proto'>check_log_duration</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1474"><span class='Ref_To_Local'>msec_str</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <span class='Number'>1</span><span class='Operator'>: 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"duration: %s ms"</span><span class='Delimiter'>, </span><a href="postgres.c.html#LN1474"><span class='Ref_To_Local'>msec_str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN1066"><span class='Ref_to_Func'>errhidestmt</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <span class='Number'>2</span><span class='Operator'>: 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"duration: %s ms  bind %s%s%s: %s"</span><span class='Delimiter'>, 
</span>                            <a href="postgres.c.html#LN1474"><span class='Ref_To_Local'>msec_str</span></a><span class='Delimiter'>, 
</span>                            <span class='Operator'>*</span><a href="postgres.c.html#LN1459"><span class='Ref_To_Local'>stmt_name</span></a> <span class='Operator'>? </span><a href="postgres.c.html#LN1459"><span class='Ref_To_Local'>stmt_name</span></a> <span class='Operator'>: </span><span class='String'>"&LT;unnamed&GT;"</span><span class='Delimiter'>, 
</span>                            <span class='Operator'>*</span><a href="postgres.c.html#LN1458"><span class='Ref_To_Local'>portal_name</span></a> <span class='Operator'>? </span><span class='String'>"/"</span> <span class='Operator'>: </span><span class='String'>""</span><span class='Delimiter'>, 
</span>                            <span class='Operator'>*</span><a href="postgres.c.html#LN1458"><span class='Ref_To_Local'>portal_name</span></a> <span class='Operator'>? </span><a href="postgres.c.html#LN1458"><span class='Ref_To_Local'>portal_name</span></a> <span class='Operator'>: </span><span class='String'>""</span><span class='Delimiter'>, 
</span>                            <a href="postgres.c.html#LN1465"><span class='Ref_To_Local'>psrc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/plancache.h.html#LN83"><span class='Ref_to_Member'>query_string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN1066"><span class='Ref_to_Func'>errhidestmt</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="postgres.c.html#LN174"><span class='Ref_to_Proto'>errdetail_params</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1470"><span class='Ref_To_Local'>params</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN1472"><span class='Ref_To_Local'>save_log_statement_stats</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/tcop/tcopprot.h.html#LN83"><span class='Ref_to_Proto'>ShowUsage</span></a><span class='Parentheses'>(</span><span class='String'>"BIND MESSAGE STATISTICS"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="postgres.c.html#LN84"><span class='Ref_to_Global_Var'>debug_query_string</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end exec_bind_message &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * exec_execute_message 
 * 
 * Process an "Execute" message for a portal 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1839"></a><span class='Declare_Function'>exec_execute_message</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>portal_name</span><span class='Delimiter'>, </span><span class='Keyword'>long </span><span class='Declare_Parameter'>max_rows</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1841"></a>    <a href="../../include/tcop/dest.h.html#LN85"><span class='Ref_to_Typedef'>CommandDest</span></a> <span class='Declare_Local'>dest</span><span class='Delimiter'>; 
</span><a name="LN1842"></a>    <a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Local'>receiver</span><span class='Delimiter'>; 
</span><a name="LN1843"></a>    <a href="../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a>      <span class='Declare_Local'>portal</span><span class='Delimiter'>; 
</span><a name="LN1844"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>completed</span><span class='Delimiter'>; 
</span><a name="LN1845"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>completionTag</span><span class='Delimiter'>[</span><a href="../../include/tcop/dest.h.html#LN73"><span class='Ref_to_Const'>COMPLETION_TAG_BUFSIZE</span></a><span class='Delimiter'>]; 
</span><a name="LN1846"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>sourceText</span><span class='Delimiter'>; 
</span><a name="LN1847"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>prepStmtName</span><span class='Delimiter'>; 
</span><a name="LN1848"></a>    <a href="../../include/nodes/params.h.html#LN61"><span class='Ref_to_Typedef'>ParamListInfo</span></a> <span class='Declare_Local'>portalParams</span><span class='Delimiter'>; 
</span><a name="LN1849"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>save_log_statement_stats</span> <span class='Operator'>= </span><a href="../utils/misc/guc.c.html#LN440"><span class='Ref_to_Global_Var'>log_statement_stats</span></a><span class='Delimiter'>; 
</span><a name="LN1850"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>is_xact_command</span><span class='Delimiter'>; 
</span><a name="LN1851"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>execute_is_fetch</span><span class='Delimiter'>; 
</span><a name="LN1852"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>was_logged</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN1853"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>msec_str</span><span class='Delimiter'>[</span><span class='Number'>32</span><span class='Delimiter'>]; 
</span> 
    <span class='Comment_Multi_Line'>/* Adjust destination to tell printtup.c what to do */ 
</span>    <a href="postgres.c.html#LN1841"><span class='Ref_To_Local'>dest</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN87"><span class='Ref_to_Global_Var'>whereToSendOutput</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN1841"><span class='Ref_To_Local'>dest</span></a> <span class='Operator'>== </span><a href="../../include/tcop/dest.h.html#LN89"><span class='Ref_to_EnumConst'>DestRemote</span></a><span class='Parentheses'>) 
</span>        <a href="postgres.c.html#LN1841"><span class='Ref_To_Local'>dest</span></a> <span class='Operator'>= </span><a href="../../include/tcop/dest.h.html#LN90"><span class='Ref_to_EnumConst'>DestRemoteExecute</span></a><span class='Delimiter'>; 
</span> 
    <a href="postgres.c.html#LN1843"><span class='Ref_To_Local'>portal</span></a> <span class='Operator'>= </span><a href="../utils/mmgr/portalmem.c.html#LN127"><span class='Ref_to_Func'>GetPortalByName</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1839"><span class='Ref_to_Parameter'>portal_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/portal.h.html#LN198"><span class='Ref_to_Macro'>PortalIsValid</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1843"><span class='Ref_To_Local'>portal</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_CURSOR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"portal \"%s\" does not exist"</span><span class='Delimiter'>, </span><a href="postgres.c.html#LN1839"><span class='Ref_to_Parameter'>portal_name</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the original query was a null string, just return 
     * EmptyQueryResponse. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN1843"><span class='Ref_To_Local'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN134"><span class='Ref_to_Member'>commandTag</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="postgres.c.html#LN1843"><span class='Ref_To_Local'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN135"><span class='Ref_to_Member'>stmts</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/tcop/dest.h.html#LN141"><span class='Ref_to_Proto'>NullCommand</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1841"><span class='Ref_To_Local'>dest</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Does the portal contain a transaction command? */ 
</span>    <a href="postgres.c.html#LN1850"><span class='Ref_To_Local'>is_xact_command</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN181"><span class='Ref_to_Proto'>IsTransactionStmtList</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1843"><span class='Ref_To_Local'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN135"><span class='Ref_to_Member'>stmts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We must copy the sourceText and prepStmtName into MessageContext in 
     * case the portal is destroyed during finish_xact_command. Can avoid the 
     * copy if it's not an xact command, though. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN1850"><span class='Ref_To_Local'>is_xact_command</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="postgres.c.html#LN1846"><span class='Ref_To_Local'>sourceText</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1843"><span class='Ref_To_Local'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN133"><span class='Ref_to_Member'>sourceText</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN1843"><span class='Ref_To_Local'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN117"><span class='Ref_to_Member'>prepStmtName</span></a><span class='Parentheses'>) 
</span>            <a href="postgres.c.html#LN1847"><span class='Ref_To_Local'>prepStmtName</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1843"><span class='Ref_To_Local'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN117"><span class='Ref_to_Member'>prepStmtName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="postgres.c.html#LN1847"><span class='Ref_To_Local'>prepStmtName</span></a> <span class='Operator'>= </span><span class='String'>"&LT;unnamed&GT;"</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * An xact command shouldn't have any parameters, which is a good 
         * thing because they wouldn't be around after finish_xact_command. 
         */ 
</span>        <a href="postgres.c.html#LN1848"><span class='Ref_To_Local'>portalParams</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="postgres.c.html#LN1846"><span class='Ref_To_Local'>sourceText</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN1843"><span class='Ref_To_Local'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN133"><span class='Ref_to_Member'>sourceText</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN1843"><span class='Ref_To_Local'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN117"><span class='Ref_to_Member'>prepStmtName</span></a><span class='Parentheses'>) 
</span>            <a href="postgres.c.html#LN1847"><span class='Ref_To_Local'>prepStmtName</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN1843"><span class='Ref_To_Local'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN117"><span class='Ref_to_Member'>prepStmtName</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="postgres.c.html#LN1847"><span class='Ref_To_Local'>prepStmtName</span></a> <span class='Operator'>= </span><span class='String'>"&LT;unnamed&GT;"</span><span class='Delimiter'>; 
</span>        <a href="postgres.c.html#LN1848"><span class='Ref_To_Local'>portalParams</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN1843"><span class='Ref_To_Local'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN138"><span class='Ref_to_Member'>portalParams</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Report query to various monitoring facilities. 
     */ 
</span>    <a href="postgres.c.html#LN84"><span class='Ref_to_Global_Var'>debug_query_string</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN1846"><span class='Ref_To_Local'>sourceText</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/pgstat.h.html#LN1168"><span class='Ref_to_Proto'>pgstat_report_activity</span></a><span class='Parentheses'>(</span><a href="../../include/pgstat.h.html#LN724"><span class='Ref_to_EnumConst'>STATE_RUNNING</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN1846"><span class='Ref_To_Local'>sourceText</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/ps_status.h.html#LN21"><span class='Ref_to_Proto'>set_ps_display</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1843"><span class='Ref_To_Local'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN134"><span class='Ref_to_Member'>commandTag</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN1849"><span class='Ref_To_Local'>save_log_statement_stats</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/tcop/tcopprot.h.html#LN82"><span class='Ref_to_Proto'>ResetUsage</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="dest.c.html#LN97"><span class='Ref_to_Func'>BeginCommand</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1843"><span class='Ref_To_Local'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN134"><span class='Ref_to_Member'>commandTag</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN1841"><span class='Ref_To_Local'>dest</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Create dest receiver in MessageContext (we don't want it in transaction 
     * context, because that may get deleted if portal contains VACUUM). 
     */ 
</span>    <a href="postgres.c.html#LN1842"><span class='Ref_To_Local'>receiver</span></a> <span class='Operator'>= </span><a href="dest.c.html#LN107"><span class='Ref_to_Func'>CreateDestReceiver</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1841"><span class='Ref_To_Local'>dest</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN1841"><span class='Ref_To_Local'>dest</span></a> <span class='Operator'>== </span><a href="../../include/tcop/dest.h.html#LN90"><span class='Ref_to_EnumConst'>DestRemoteExecute</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/access/printtup.h.html#LN20"><span class='Ref_to_Proto'>SetRemoteDestReceiverParams</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1842"><span class='Ref_To_Local'>receiver</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN1843"><span class='Ref_To_Local'>portal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Ensure we are in a transaction command (this should normally be the 
     * case already due to prior BIND). 
     */ 
</span>    <a href="postgres.c.html#LN177"><span class='Ref_to_Proto'>start_xact_command</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we re-issue an Execute protocol request against an existing portal, 
     * then we are only fetching more rows rather than completely re-executing 
     * the query from the start. atStart is never reset for a v3 portal, so we 
     * are safe to use this check. 
     */ 
</span>    <a href="postgres.c.html#LN1851"><span class='Ref_To_Local'>execute_is_fetch</span></a> <span class='Operator'>= !</span><a href="postgres.c.html#LN1843"><span class='Ref_To_Local'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN185"><span class='Ref_to_Member'>atStart</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Log immediately if dictated by log_statement */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN172"><span class='Ref_to_Proto'>check_log_statement</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1843"><span class='Ref_To_Local'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN135"><span class='Ref_to_Member'>stmts</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"%s %s%s%s: %s"</span><span class='Delimiter'>, 
</span>                        <a href="postgres.c.html#LN1851"><span class='Ref_To_Local'>execute_is_fetch</span></a> <span class='Operator'>? 
</span>                        _<span class='Parentheses'>(</span><span class='String'>"execute fetch from"</span><span class='Parentheses'>) </span><span class='Operator'>: 
</span>                        _<span class='Parentheses'>(</span><span class='String'>"execute"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="postgres.c.html#LN1847"><span class='Ref_To_Local'>prepStmtName</span></a><span class='Delimiter'>, 
</span>                        <span class='Operator'>*</span><a href="postgres.c.html#LN1839"><span class='Ref_to_Parameter'>portal_name</span></a> <span class='Operator'>? </span><span class='String'>"/"</span> <span class='Operator'>: </span><span class='String'>""</span><span class='Delimiter'>, 
</span>                        <span class='Operator'>*</span><a href="postgres.c.html#LN1839"><span class='Ref_to_Parameter'>portal_name</span></a> <span class='Operator'>? </span><a href="postgres.c.html#LN1839"><span class='Ref_to_Parameter'>portal_name</span></a> <span class='Operator'>: </span><span class='String'>""</span><span class='Delimiter'>, 
</span>                        <a href="postgres.c.html#LN1846"><span class='Ref_To_Local'>sourceText</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN1066"><span class='Ref_to_Func'>errhidestmt</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="postgres.c.html#LN174"><span class='Ref_to_Proto'>errdetail_params</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1848"><span class='Ref_To_Local'>portalParams</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="postgres.c.html#LN1852"><span class='Ref_To_Local'>was_logged</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we are in aborted transaction state, the only portals we can 
     * actually run are those containing COMMIT or ROLLBACK commands. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/xact.h.html#LN330"><span class='Ref_to_Proto'>IsAbortedTransactionBlockState</span></a><span class='Parentheses'>() </span><span class='Operator'>&& 
</span>        <span class='Operator'>!</span><a href="postgres.c.html#LN180"><span class='Ref_to_Proto'>IsTransactionExitStmtList</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1843"><span class='Ref_To_Local'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN135"><span class='Ref_to_Member'>stmts</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_IN_FAILED_SQL_TRANSACTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"current transaction is aborted, "</span> 
                        <span class='String'>"commands ignored until end of transaction block"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="postgres.c.html#LN175"><span class='Ref_to_Proto'>errdetail_abort</span></a><span class='Parentheses'>()))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check for cancel signal before we start execution */ 
</span>    <a href="../../include/miscadmin.h.html#LN99"><span class='Ref_to_Macro'>CHECK_FOR_INTERRUPTS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Okay to run the portal. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN1839"><span class='Ref_to_Parameter'>max_rows</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="postgres.c.html#LN1839"><span class='Ref_to_Parameter'>max_rows</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN2645"><span class='Ref_to_Const'>FETCH_ALL</span></a><span class='Delimiter'>; 
</span> 
    <a href="postgres.c.html#LN1844"><span class='Ref_To_Local'>completed</span></a> <span class='Operator'>= </span><a href="../../include/tcop/pquery.h.html#LN35"><span class='Ref_to_Proto'>PortalRun</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1843"><span class='Ref_To_Local'>portal</span></a><span class='Delimiter'>, 
</span>                          <a href="postgres.c.html#LN1839"><span class='Ref_to_Parameter'>max_rows</span></a><span class='Delimiter'>, 
</span>                          <span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Comment_Single_Line'>/* always top level */ 
</span>                          <span class='Operator'>!</span><a href="postgres.c.html#LN1851"><span class='Ref_To_Local'>execute_is_fetch</span></a> <span class='Operator'>&& </span><a href="postgres.c.html#LN1839"><span class='Ref_to_Parameter'>max_rows</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN2645"><span class='Ref_to_Const'>FETCH_ALL</span></a><span class='Delimiter'>, 
</span>                          <a href="postgres.c.html#LN1842"><span class='Ref_To_Local'>receiver</span></a><span class='Delimiter'>, 
</span>                          <a href="postgres.c.html#LN1842"><span class='Ref_To_Local'>receiver</span></a><span class='Delimiter'>, 
</span>                          <a href="postgres.c.html#LN1845"><span class='Ref_To_Local'>completionTag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="postgres.c.html#LN1842"><span class='Ref_To_Local'>receiver</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/dest.h.html#LN125"><span class='Ref_to_Member'>rDestroy</span></a><span class='Parentheses'>) (</span><a href="postgres.c.html#LN1842"><span class='Ref_To_Local'>receiver</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN1844"><span class='Ref_To_Local'>completed</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN1850"><span class='Ref_To_Local'>is_xact_command</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * If this was a transaction control statement, commit it.  We 
             * will start a new xact command for the next command (if any). 
             */ 
</span>            <a href="postgres.c.html#LN178"><span class='Ref_to_Proto'>finish_xact_command</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * We need a CommandCounterIncrement after every query, except 
             * those that start or end a transaction block. 
             */ 
</span>            <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Send appropriate CommandComplete to client */ 
</span>        <a href="../../include/tcop/dest.h.html#LN137"><span class='Ref_to_Proto'>EndCommand</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1845"><span class='Ref_To_Local'>completionTag</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN1841"><span class='Ref_To_Local'>dest</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if completed &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Portal run not complete, so send PortalSuspended */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN87"><span class='Ref_to_Global_Var'>whereToSendOutput</span></a> <span class='Operator'>== </span><a href="../../include/tcop/dest.h.html#LN89"><span class='Ref_to_EnumConst'>DestRemote</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/libpq/pqformat.h.html#LN35"><span class='Ref_to_Proto'>pq_putemptymessage</span></a><span class='Parentheses'>(</span><span class='String'>'s'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Emit duration logging if appropriate. 
     */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="../../include/tcop/tcopprot.h.html#LN84"><span class='Ref_to_Proto'>check_log_duration</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1853"><span class='Ref_To_Local'>msec_str</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN1852"><span class='Ref_To_Local'>was_logged</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <span class='Number'>1</span><span class='Operator'>: 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"duration: %s ms"</span><span class='Delimiter'>, </span><a href="postgres.c.html#LN1853"><span class='Ref_To_Local'>msec_str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN1066"><span class='Ref_to_Func'>errhidestmt</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <span class='Number'>2</span><span class='Operator'>: 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"duration: %s ms  %s %s%s%s: %s"</span><span class='Delimiter'>, 
</span>                            <a href="postgres.c.html#LN1853"><span class='Ref_To_Local'>msec_str</span></a><span class='Delimiter'>, 
</span>                            <a href="postgres.c.html#LN1851"><span class='Ref_To_Local'>execute_is_fetch</span></a> <span class='Operator'>? 
</span>                            _<span class='Parentheses'>(</span><span class='String'>"execute fetch from"</span><span class='Parentheses'>) </span><span class='Operator'>: 
</span>                            _<span class='Parentheses'>(</span><span class='String'>"execute"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="postgres.c.html#LN1847"><span class='Ref_To_Local'>prepStmtName</span></a><span class='Delimiter'>, 
</span>                            <span class='Operator'>*</span><a href="postgres.c.html#LN1839"><span class='Ref_to_Parameter'>portal_name</span></a> <span class='Operator'>? </span><span class='String'>"/"</span> <span class='Operator'>: </span><span class='String'>""</span><span class='Delimiter'>, 
</span>                            <span class='Operator'>*</span><a href="postgres.c.html#LN1839"><span class='Ref_to_Parameter'>portal_name</span></a> <span class='Operator'>? </span><a href="postgres.c.html#LN1839"><span class='Ref_to_Parameter'>portal_name</span></a> <span class='Operator'>: </span><span class='String'>""</span><span class='Delimiter'>, 
</span>                            <a href="postgres.c.html#LN1846"><span class='Ref_To_Local'>sourceText</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN1066"><span class='Ref_to_Func'>errhidestmt</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="postgres.c.html#LN174"><span class='Ref_to_Proto'>errdetail_params</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN1848"><span class='Ref_To_Local'>portalParams</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch check_log_duration(ms... &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN1849"><span class='Ref_To_Local'>save_log_statement_stats</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/tcop/tcopprot.h.html#LN83"><span class='Ref_to_Proto'>ShowUsage</span></a><span class='Parentheses'>(</span><span class='String'>"EXECUTE MESSAGE STATISTICS"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="postgres.c.html#LN84"><span class='Ref_to_Global_Var'>debug_query_string</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end exec_execute_message &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * check_log_statement 
 *      Determine whether command should be logged because of log_statement 
 * 
 * stmt_list can be either raw grammar output or a list of planned 
 * statements 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN2062"></a><span class='Declare_Function'>check_log_statement</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt_list</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2064"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>stmt_item</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN92"><span class='Ref_to_Global_Var'>log_statement</span></a> <span class='Operator'>== </span><a href="../../include/tcop/tcopprot.h.html#LN41"><span class='Ref_to_EnumConst'>LOGSTMT_NONE</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN92"><span class='Ref_to_Global_Var'>log_statement</span></a> <span class='Operator'>== </span><a href="../../include/tcop/tcopprot.h.html#LN44"><span class='Ref_to_EnumConst'>LOGSTMT_ALL</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Else we have to inspect the statement(s) to see whether to log */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN2064"><span class='Ref_To_Local'>stmt_item</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN2062"><span class='Ref_to_Parameter'>stmt_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2074"></a>        <a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>stmt</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN2064"><span class='Ref_To_Local'>stmt_item</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/tcop/utility.h.html#LN50"><span class='Ref_to_Proto'>GetCommandLogLevel</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN2074"><span class='Ref_To_Local'>stmt</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><a href="postgres.c.html#LN92"><span class='Ref_to_Global_Var'>log_statement</span></a><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end check_log_statement &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * check_log_duration 
 *      Determine whether current command's duration should be logged 
 * 
 * Returns: 
 *      0 if no logging is needed 
 *      1 if just the duration should be logged 
 *      2 if duration and query details should be logged 
 * 
 * If logging is needed, the duration in msec is formatted into msec_str[], 
 * which must be a 32-byte buffer. 
 * 
 * was_logged should be TRUE if caller already logged query details (this 
 * essentially prevents 2 from being returned). 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN2099"></a><span class='Declare_Function'>check_log_duration</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>msec_str</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>was_logged</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/guc.c.html#LN431"><span class='Ref_to_Global_Var'>log_duration</span></a> <span class='Operator'>|| </span><a href="../utils/misc/guc.c.html#LN452"><span class='Ref_to_Global_Var'>log_min_duration_statement</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2103"></a>        <span class='Keyword'>long</span>        <span class='Declare_Local'>secs</span><span class='Delimiter'>; 
</span><a name="LN2104"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>usecs</span><span class='Delimiter'>; 
</span><a name="LN2105"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>msecs</span><span class='Delimiter'>; 
</span><a name="LN2106"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>exceeded</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/timestamp.h.html#LN72"><span class='Ref_to_Proto'>TimestampDifference</span></a><span class='Parentheses'>(</span><a href="../../include/access/xact.h.html#LN341"><span class='Ref_to_Proto'>GetCurrentStatementStartTimestamp</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/timestamp.h.html#LN69"><span class='Ref_to_Proto'>GetCurrentTimestamp</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                            <span class='Operator'>&</span><a href="postgres.c.html#LN2103"><span class='Ref_To_Local'>secs</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres.c.html#LN2104"><span class='Ref_To_Local'>usecs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="postgres.c.html#LN2105"><span class='Ref_To_Local'>msecs</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN2104"><span class='Ref_To_Local'>usecs</span></a> <span class='Operator'>/ </span><span class='Number'>1000</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * This odd-looking test for log_min_duration_statement being exceeded 
         * is designed to avoid integer overflow with very long durations: 
         * don't compute secs * 1000 until we've verified it will fit in int. 
         */ 
</span>        <a href="postgres.c.html#LN2106"><span class='Ref_To_Local'>exceeded</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../utils/misc/guc.c.html#LN452"><span class='Ref_to_Global_Var'>log_min_duration_statement</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                    <span class='Parentheses'>(</span><a href="../utils/misc/guc.c.html#LN452"><span class='Ref_to_Global_Var'>log_min_duration_statement</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>                     <span class='Parentheses'>(</span><a href="postgres.c.html#LN2103"><span class='Ref_To_Local'>secs</span></a> <span class='Operator'>&GT; </span><a href="../utils/misc/guc.c.html#LN452"><span class='Ref_to_Global_Var'>log_min_duration_statement</span></a> <span class='Operator'>/ </span><span class='Number'>1000</span> <span class='Operator'>|| 
</span>                      <a href="postgres.c.html#LN2103"><span class='Ref_To_Local'>secs</span></a> <span class='Operator'>* </span><span class='Number'>1000</span> <span class='Operator'>+ </span><a href="postgres.c.html#LN2105"><span class='Ref_To_Local'>msecs</span></a> <span class='Operator'>&GT;= </span><a href="../utils/misc/guc.c.html#LN452"><span class='Ref_to_Global_Var'>log_min_duration_statement</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN2106"><span class='Ref_To_Local'>exceeded</span></a> <span class='Operator'>|| </span><a href="../utils/misc/guc.c.html#LN431"><span class='Ref_to_Global_Var'>log_duration</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN2099"><span class='Ref_to_Parameter'>msec_str</span></a><span class='Delimiter'>, </span><span class='Number'>32</span><span class='Delimiter'>, </span><span class='String'>"%ld.%03d"</span><span class='Delimiter'>, 
</span>                     <a href="postgres.c.html#LN2103"><span class='Ref_To_Local'>secs</span></a> <span class='Operator'>* </span><span class='Number'>1000</span> <span class='Operator'>+ </span><a href="postgres.c.html#LN2105"><span class='Ref_To_Local'>msecs</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN2104"><span class='Ref_To_Local'>usecs</span></a> <span class='Operator'>% </span><span class='Number'>1000</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN2106"><span class='Ref_To_Local'>exceeded</span></a> <span class='Operator'>&& !</span><a href="postgres.c.html#LN2099"><span class='Ref_to_Parameter'>was_logged</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Number'>2</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if log_duration||log_min... &raquo; </span> 
 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end check_log_duration &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * errdetail_execute 
 * 
 * Add an errdetail() line showing the query referenced by an EXECUTE, if any. 
 * The argument is the raw parsetree list. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN2144"></a><span class='Declare_Function'>errdetail_execute</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>raw_parsetree_list</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2146"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>parsetree_item</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN2146"><span class='Ref_To_Local'>parsetree_item</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN2144"><span class='Ref_to_Parameter'>raw_parsetree_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2150"></a>        <a href="../../include/nodes/parsenodes.h.html#LN1396"><span class='Ref_to_Struct'>RawStmt</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>parsetree</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN108"><span class='Ref_to_Macro'>lfirst_node</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1396"><span class='Ref_to_Struct'>RawStmt</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN2146"><span class='Ref_To_Local'>parsetree_item</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN2150"><span class='Ref_To_Local'>parsetree</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1399"><span class='Ref_to_Member'>stmt</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN3268"><span class='Ref_to_Struct'>ExecuteStmt</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN2154"></a>            <a href="../../include/nodes/parsenodes.h.html#LN3268"><span class='Ref_to_Struct'>ExecuteStmt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>stmt</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN3268"><span class='Ref_to_Struct'>ExecuteStmt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres.c.html#LN2150"><span class='Ref_To_Local'>parsetree</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1399"><span class='Ref_to_Member'>stmt</span></a><span class='Delimiter'>; 
</span><a name="LN2155"></a>            <a href="../../include/commands/prepare.h.html#LN26"><span class='Ref_to_Typedef'>PreparedStatement</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pstmt</span><span class='Delimiter'>; 
</span> 
            <a href="postgres.c.html#LN2155"><span class='Ref_To_Local'>pstmt</span></a> <span class='Operator'>= </span><a href="../../include/commands/prepare.h.html#LN51"><span class='Ref_to_Proto'>FetchPreparedStatement</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN2154"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3271"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN2155"><span class='Ref_To_Local'>pstmt</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"prepare: %s"</span><span class='Delimiter'>, </span><a href="postgres.c.html#LN2155"><span class='Ref_To_Local'>pstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/prepare.h.html#LN30"><span class='Ref_to_Member'>plansource</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/plancache.h.html#LN83"><span class='Ref_to_Member'>query_string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end errdetail_execute &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * errdetail_params 
 * 
 * Add an errdetail() line showing bind-parameter data, if available. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN2175"></a><span class='Declare_Function'>errdetail_params</span><span class='Parentheses'>(</span><a href="../../include/nodes/params.h.html#LN61"><span class='Ref_to_Typedef'>ParamListInfo</span></a> <span class='Declare_Parameter'>params</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* We mustn't call user-defined I/O functions when in an aborted xact */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN2175"><span class='Ref_to_Parameter'>params</span></a> <span class='Operator'>&& </span><a href="postgres.c.html#LN2175"><span class='Ref_to_Parameter'>params</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/params.h.html#LN73"><span class='Ref_to_Member'>numParams</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& !</span><a href="../../include/access/xact.h.html#LN330"><span class='Ref_to_Proto'>IsAbortedTransactionBlockState</span></a><span class='Parentheses'>())</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2180"></a>        <a href="../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>param_str</span><span class='Delimiter'>; 
</span><a name="LN2181"></a>        <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span><a name="LN2182"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>paramno</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Make sure any trash is generated in MessageContext */ 
</span>        <a href="postgres.c.html#LN2181"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN46"><span class='Ref_to_Global_Var'>MessageContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres.c.html#LN2180"><span class='Ref_To_Local'>param_str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN2182"><span class='Ref_To_Local'>paramno</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="postgres.c.html#LN2182"><span class='Ref_To_Local'>paramno</span></a> <span class='Operator'>&LT; </span><a href="postgres.c.html#LN2175"><span class='Ref_to_Parameter'>params</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/params.h.html#LN73"><span class='Ref_to_Member'>numParams</span></a><span class='Delimiter'>; </span><a href="postgres.c.html#LN2182"><span class='Ref_To_Local'>paramno</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2191"></a>            <a href="../../include/nodes/params.h.html#LN53"><span class='Ref_to_Struct'>ParamExternData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>prm</span> <span class='Operator'>= &</span><a href="postgres.c.html#LN2175"><span class='Ref_to_Parameter'>params</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/params.h.html#LN75"><span class='Ref_to_Member'>params</span></a><span class='Delimiter'>[</span><a href="postgres.c.html#LN2182"><span class='Ref_To_Local'>paramno</span></a><span class='Delimiter'>]; 
</span><a name="LN2192"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typoutput</span><span class='Delimiter'>; 
</span><a name="LN2193"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>typisvarlena</span><span class='Delimiter'>; 
</span><a name="LN2194"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>pstring</span><span class='Delimiter'>; 
</span><a name="LN2195"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span> 
            <a href="../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres.c.html#LN2180"><span class='Ref_To_Local'>param_str</span></a><span class='Delimiter'>, </span><span class='String'>"%s$%d = "</span><span class='Delimiter'>, 
</span>                             <a href="postgres.c.html#LN2182"><span class='Ref_To_Local'>paramno</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>? </span><span class='String'>", "</span> <span class='Operator'>: </span><span class='String'>""</span><span class='Delimiter'>, 
</span>                             <a href="postgres.c.html#LN2182"><span class='Ref_To_Local'>paramno</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN2191"><span class='Ref_To_Local'>prm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/params.h.html#LN56"><span class='Ref_to_Member'>isnull</span></a> <span class='Operator'>|| !</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN2191"><span class='Ref_To_Local'>prm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/params.h.html#LN58"><span class='Ref_to_Member'>ptype</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres.c.html#LN2180"><span class='Ref_To_Local'>param_str</span></a><span class='Delimiter'>, </span><span class='String'>"NULL"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="../../include/utils/lsyscache.h.html#LN162"><span class='Ref_to_Proto'>getTypeOutputInfo</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN2191"><span class='Ref_To_Local'>prm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/params.h.html#LN58"><span class='Ref_to_Member'>ptype</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres.c.html#LN2192"><span class='Ref_To_Local'>typoutput</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres.c.html#LN2193"><span class='Ref_To_Local'>typisvarlena</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="postgres.c.html#LN2194"><span class='Ref_To_Local'>pstring</span></a> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN647"><span class='Ref_to_Proto'>OidOutputFunctionCall</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN2192"><span class='Ref_To_Local'>typoutput</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN2191"><span class='Ref_To_Local'>prm</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/lib/stringinfo.h.html#LN126"><span class='Ref_to_Macro'>appendStringInfoCharMacro</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres.c.html#LN2180"><span class='Ref_To_Local'>param_str</span></a><span class='Delimiter'>, </span><span class='String'>'\''</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN2195"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN2194"><span class='Ref_To_Local'>pstring</span></a><span class='Delimiter'>; </span><span class='Operator'>*</span><a href="postgres.c.html#LN2195"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>; </span><a href="postgres.c.html#LN2195"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="postgres.c.html#LN2195"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>== </span><span class='String'>'\''</span><span class='Parentheses'>) </span><span class='Comment_Single_Line'>/* double single quotes */ 
</span>                    <a href="../../include/lib/stringinfo.h.html#LN126"><span class='Ref_to_Macro'>appendStringInfoCharMacro</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres.c.html#LN2180"><span class='Ref_To_Local'>param_str</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="postgres.c.html#LN2195"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/lib/stringinfo.h.html#LN126"><span class='Ref_to_Macro'>appendStringInfoCharMacro</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres.c.html#LN2180"><span class='Ref_To_Local'>param_str</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="postgres.c.html#LN2195"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="../../include/lib/stringinfo.h.html#LN126"><span class='Ref_to_Macro'>appendStringInfoCharMacro</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres.c.html#LN2180"><span class='Ref_To_Local'>param_str</span></a><span class='Delimiter'>, </span><span class='String'>'\''</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN2194"><span class='Ref_To_Local'>pstring</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for paramno=0;paramno&LT;par... &raquo; </span> 
 
        <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"parameters: %s"</span><span class='Delimiter'>, </span><a href="postgres.c.html#LN2180"><span class='Ref_To_Local'>param_str</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN2180"><span class='Ref_To_Local'>param_str</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN2181"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if params&&params-&GT;numPa... &raquo; </span> 
 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end errdetail_params &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * errdetail_abort 
 * 
 * Add an errdetail() line showing abort reason, if any. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN2239"></a><span class='Declare_Function'>errdetail_abort</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../storage/lmgr/proc.c.html#LN66"><span class='Ref_to_Global_Var'>MyProc</span></a><span class='Operator'>-&GT;</span><a href="../../include/storage/proc.h.html#LN122"><span class='Ref_to_Member'>recoveryConflictPending</span></a><span class='Parentheses'>) 
</span>        <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"abort reason: recovery conflict"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * errdetail_recovery_conflict 
 * 
 * Add an errdetail() line showing conflict source. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN2253"></a><span class='Declare_Function'>errdetail_recovery_conflict</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN160"><span class='Ref_to_Global_Var'>RecoveryConflictReason</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/storage/procsignal.h.html#LN42"><span class='Ref_to_EnumConst'>PROCSIG_RECOVERY_CONFLICT_BUFFERPIN</span></a><span class='Operator'>: 
</span>            <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"User was holding shared buffer pin for too long."</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/storage/procsignal.h.html#LN40"><span class='Ref_to_EnumConst'>PROCSIG_RECOVERY_CONFLICT_LOCK</span></a><span class='Operator'>: 
</span>            <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"User was holding a relation lock for too long."</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/storage/procsignal.h.html#LN39"><span class='Ref_to_EnumConst'>PROCSIG_RECOVERY_CONFLICT_TABLESPACE</span></a><span class='Operator'>: 
</span>            <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"User was or might have been using tablespace that must be dropped."</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/storage/procsignal.h.html#LN41"><span class='Ref_to_EnumConst'>PROCSIG_RECOVERY_CONFLICT_SNAPSHOT</span></a><span class='Operator'>: 
</span>            <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"User query might have needed to see row versions that must be removed."</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/storage/procsignal.h.html#LN43"><span class='Ref_to_EnumConst'>PROCSIG_RECOVERY_CONFLICT_STARTUP_DEADLOCK</span></a><span class='Operator'>: 
</span>            <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"User transaction caused buffer deadlock with recovery."</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/storage/procsignal.h.html#LN38"><span class='Ref_to_EnumConst'>PROCSIG_RECOVERY_CONFLICT_DATABASE</span></a><span class='Operator'>: 
</span>            <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"User was connected to a database that must be dropped."</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* no errdetail */ 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch RecoveryConflictReaso... &raquo; </span> 
 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end errdetail_recovery_conflict &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * exec_describe_statement_message 
 * 
 * Process a "Describe" message for a prepared statement 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2289"></a><span class='Declare_Function'>exec_describe_statement_message</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>stmt_name</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2291"></a>    <a href="../../include/utils/plancache.h.html#LN79"><span class='Ref_to_Struct'>CachedPlanSource</span></a> <span class='Operator'>*</span><span class='Declare_Local'>psrc</span><span class='Delimiter'>; 
</span><a name="LN2292"></a>    <a href="../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span><a name="LN2293"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Start up a transaction command. (Note that this will normally change 
     * current memory context.) Nothing happens if we are already in one. 
     */ 
</span>    <a href="postgres.c.html#LN177"><span class='Ref_to_Proto'>start_xact_command</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Switch back to message context */ 
</span>    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN46"><span class='Ref_to_Global_Var'>MessageContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Find prepared statement */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN2289"><span class='Ref_to_Parameter'>stmt_name</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2307"></a>        <a href="../../include/commands/prepare.h.html#LN26"><span class='Ref_to_Typedef'>PreparedStatement</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pstmt</span><span class='Delimiter'>; 
</span> 
        <a href="postgres.c.html#LN2307"><span class='Ref_To_Local'>pstmt</span></a> <span class='Operator'>= </span><a href="../../include/commands/prepare.h.html#LN51"><span class='Ref_to_Proto'>FetchPreparedStatement</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN2289"><span class='Ref_to_Parameter'>stmt_name</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="postgres.c.html#LN2291"><span class='Ref_To_Local'>psrc</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN2307"><span class='Ref_To_Local'>pstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/prepare.h.html#LN30"><span class='Ref_to_Member'>plansource</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* special-case the unnamed statement */ 
</span>        <a href="postgres.c.html#LN2291"><span class='Ref_To_Local'>psrc</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN150"><span class='Ref_to_Global_Var'>unnamed_stmt_psrc</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postgres.c.html#LN2291"><span class='Ref_To_Local'>psrc</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_PSTATEMENT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"unnamed prepared statement does not exist"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Prepared statements shouldn't have changeable result descs */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="postgres.c.html#LN2291"><span class='Ref_To_Local'>psrc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/plancache.h.html#LN90"><span class='Ref_to_Member'>fixed_result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we are in aborted transaction state, we can't run 
     * SendRowDescriptionMessage(), because that needs catalog accesses. 
     * Hence, refuse to Describe statements that return data.  (We shouldn't 
     * just refuse all Describes, since that might break the ability of some 
     * clients to issue COMMIT or ROLLBACK commands, if they use code that 
     * blindly Describes whatever it does.)  We can Describe parameters 
     * without doing anything dangerous, so we don't restrict that. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/xact.h.html#LN330"><span class='Ref_to_Proto'>IsAbortedTransactionBlockState</span></a><span class='Parentheses'>() </span><span class='Operator'>&& 
</span>        <a href="postgres.c.html#LN2291"><span class='Ref_To_Local'>psrc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/plancache.h.html#LN91"><span class='Ref_to_Member'>resultDesc</span></a><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_IN_FAILED_SQL_TRANSACTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"current transaction is aborted, "</span> 
                        <span class='String'>"commands ignored until end of transaction block"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="postgres.c.html#LN175"><span class='Ref_to_Proto'>errdetail_abort</span></a><span class='Parentheses'>()))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN87"><span class='Ref_to_Global_Var'>whereToSendOutput</span></a> <span class='Operator'>!= </span><a href="../../include/tcop/dest.h.html#LN89"><span class='Ref_to_EnumConst'>DestRemote</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>;</span>                 <span class='Comment_Single_Line'>/* can't actually do anything... */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * First describe the parameters... 
     */ 
</span>    <a href="../../include/libpq/pqformat.h.html#LN17"><span class='Ref_to_Proto'>pq_beginmessage</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres.c.html#LN2292"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>'t'</span><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* parameter description message type */ 
</span>    <a href="../../include/libpq/pqformat.h.html#LN25"><span class='Ref_to_Proto'>pq_sendint</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres.c.html#LN2292"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN2291"><span class='Ref_To_Local'>psrc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/plancache.h.html#LN86"><span class='Ref_to_Member'>num_params</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN2293"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="postgres.c.html#LN2293"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="postgres.c.html#LN2291"><span class='Ref_To_Local'>psrc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/plancache.h.html#LN86"><span class='Ref_to_Member'>num_params</span></a><span class='Delimiter'>; </span><a href="postgres.c.html#LN2293"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2353"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ptype</span> <span class='Operator'>= </span><a href="postgres.c.html#LN2291"><span class='Ref_To_Local'>psrc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/plancache.h.html#LN85"><span class='Ref_to_Member'>param_types</span></a><span class='Delimiter'>[</span><a href="postgres.c.html#LN2293"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
        <a href="../../include/libpq/pqformat.h.html#LN25"><span class='Ref_to_Proto'>pq_sendint</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres.c.html#LN2292"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="postgres.c.html#LN2353"><span class='Ref_To_Local'>ptype</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../include/libpq/pqformat.h.html#LN29"><span class='Ref_to_Proto'>pq_endmessage</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres.c.html#LN2292"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Next send RowDescription or NoData to describe the result... 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN2291"><span class='Ref_To_Local'>psrc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/plancache.h.html#LN91"><span class='Ref_to_Member'>resultDesc</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2364"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>tlist</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Get the plan's primary targetlist */ 
</span>        <a href="postgres.c.html#LN2364"><span class='Ref_To_Local'>tlist</span></a> <span class='Operator'>= </span><a href="../../include/utils/plancache.h.html#LN175"><span class='Ref_to_Proto'>CachedPlanGetTargetList</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN2291"><span class='Ref_To_Local'>psrc</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/access/printtup.h.html#LN22"><span class='Ref_to_Proto'>SendRowDescriptionMessage</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN2291"><span class='Ref_To_Local'>psrc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/plancache.h.html#LN91"><span class='Ref_to_Member'>resultDesc</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN2364"><span class='Ref_To_Local'>tlist</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="../../include/libpq/pqformat.h.html#LN35"><span class='Ref_to_Proto'>pq_putemptymessage</span></a><span class='Parentheses'>(</span><span class='String'>'n'</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* NoData */ 
</span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end exec_describe_statement_message &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * exec_describe_portal_message 
 * 
 * Process a "Describe" message for a portal 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2382"></a><span class='Declare_Function'>exec_describe_portal_message</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>portal_name</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2384"></a>    <a href="../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a>      <span class='Declare_Local'>portal</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Start up a transaction command. (Note that this will normally change 
     * current memory context.) Nothing happens if we are already in one. 
     */ 
</span>    <a href="postgres.c.html#LN177"><span class='Ref_to_Proto'>start_xact_command</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Switch back to message context */ 
</span>    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN46"><span class='Ref_to_Global_Var'>MessageContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="postgres.c.html#LN2384"><span class='Ref_To_Local'>portal</span></a> <span class='Operator'>= </span><a href="../utils/mmgr/portalmem.c.html#LN127"><span class='Ref_to_Func'>GetPortalByName</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN2382"><span class='Ref_to_Parameter'>portal_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/portal.h.html#LN198"><span class='Ref_to_Macro'>PortalIsValid</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN2384"><span class='Ref_To_Local'>portal</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_CURSOR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"portal \"%s\" does not exist"</span><span class='Delimiter'>, </span><a href="postgres.c.html#LN2382"><span class='Ref_to_Parameter'>portal_name</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we are in aborted transaction state, we can't run 
     * SendRowDescriptionMessage(), because that needs catalog accesses. 
     * Hence, refuse to Describe portals that return data.  (We shouldn't just 
     * refuse all Describes, since that might break the ability of some 
     * clients to issue COMMIT or ROLLBACK commands, if they use code that 
     * blindly Describes whatever it does.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/xact.h.html#LN330"><span class='Ref_to_Proto'>IsAbortedTransactionBlockState</span></a><span class='Parentheses'>() </span><span class='Operator'>&& 
</span>        <a href="postgres.c.html#LN2384"><span class='Ref_To_Local'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN154"><span class='Ref_to_Member'>tupDesc</span></a><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_IN_FAILED_SQL_TRANSACTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"current transaction is aborted, "</span> 
                        <span class='String'>"commands ignored until end of transaction block"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="postgres.c.html#LN175"><span class='Ref_to_Proto'>errdetail_abort</span></a><span class='Parentheses'>()))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN87"><span class='Ref_to_Global_Var'>whereToSendOutput</span></a> <span class='Operator'>!= </span><a href="../../include/tcop/dest.h.html#LN89"><span class='Ref_to_EnumConst'>DestRemote</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>;</span>                 <span class='Comment_Single_Line'>/* can't actually do anything... */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN2384"><span class='Ref_To_Local'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN154"><span class='Ref_to_Member'>tupDesc</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/access/printtup.h.html#LN22"><span class='Ref_to_Proto'>SendRowDescriptionMessage</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN2384"><span class='Ref_To_Local'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN154"><span class='Ref_to_Member'>tupDesc</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../include/tcop/pquery.h.html#LN25"><span class='Ref_to_Proto'>FetchPortalTargetList</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN2384"><span class='Ref_To_Local'>portal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                  <a href="postgres.c.html#LN2384"><span class='Ref_To_Local'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN156"><span class='Ref_to_Member'>formats</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../include/libpq/pqformat.h.html#LN35"><span class='Ref_to_Proto'>pq_putemptymessage</span></a><span class='Parentheses'>(</span><span class='String'>'n'</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* NoData */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end exec_describe_portal_message &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Convenience routines for starting/committing a single command. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2433"></a><span class='Declare_Function'>start_xact_command</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postgres.c.html#LN129"><span class='Ref_to_Global_Var'>xact_started</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/access/xact.h.html#LN348"><span class='Ref_to_Proto'>StartTransactionCommand</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Set statement timeout running, if any */ 
</span>        <span class='Comment_Multi_Line'>/* NB: this mustn't be enabled until we are within an xact */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../storage/lmgr/proc.c.html#LN60"><span class='Ref_to_Global_Var'>StatementTimeout</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="../../include/utils/timeout.h.html#LN74"><span class='Ref_to_Proto'>enable_timeout_after</span></a><span class='Parentheses'>(</span><a href="../../include/utils/timeout.h.html#LN28"><span class='Ref_to_EnumConst'>STATEMENT_TIMEOUT</span></a><span class='Delimiter'>, </span><a href="../storage/lmgr/proc.c.html#LN60"><span class='Ref_to_Global_Var'>StatementTimeout</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../include/utils/timeout.h.html#LN77"><span class='Ref_to_Proto'>disable_timeout</span></a><span class='Parentheses'>(</span><a href="../../include/utils/timeout.h.html#LN28"><span class='Ref_to_EnumConst'>STATEMENT_TIMEOUT</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="postgres.c.html#LN129"><span class='Ref_to_Global_Var'>xact_started</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN2451"></a><span class='Declare_Function'>finish_xact_command</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN129"><span class='Ref_to_Global_Var'>xact_started</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Cancel any active statement timeout before committing */ 
</span>        <a href="../../include/utils/timeout.h.html#LN77"><span class='Ref_to_Proto'>disable_timeout</span></a><span class='Parentheses'>(</span><a href="../../include/utils/timeout.h.html#LN28"><span class='Ref_to_EnumConst'>STATEMENT_TIMEOUT</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/access/xact.h.html#LN349"><span class='Ref_to_Proto'>CommitTransactionCommand</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> <a href="../../include/pg_config_manual.h.html#LN275"><span class='Ref_to_Const'>MEMORY_CONTEXT_CHECKING</span></a> 
        <span class='Comment_Multi_Line'>/* Check all memory contexts that weren't freed during commit */ 
</span>        <span class='Comment_Multi_Line'>/* (those that were, were checked before being deleted) */ 
</span>        <a href="../../include/utils/memutils.h.html#LN89"><span class='Ref_to_Proto'>MemoryContextCheck</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN42"><span class='Ref_to_Global_Var'>TopMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
<span class='Directive'>#ifdef</span> SHOW_MEMORY_STATS 
        <span class='Comment_Multi_Line'>/* Print mem stats after each commit for leak tracking */ 
</span>        <a href="../../include/utils/memutils.h.html#LN83"><span class='Ref_to_Proto'>MemoryContextStats</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN42"><span class='Ref_to_Global_Var'>TopMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
        <a href="postgres.c.html#LN129"><span class='Ref_to_Global_Var'>xact_started</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if xact_started &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end finish_xact_command &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Convenience routines for checking whether a statement is one of the 
 * ones that we allow in transaction-aborted state. 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* Test a bare parsetree */ 
</span><span class='Keyword'>static bool 
</span><a name="LN2483"></a><span class='Declare_Function'>IsTransactionExitStmt</span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>parsetree</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN2483"><span class='Ref_to_Parameter'>parsetree</span></a> <span class='Operator'>&& </span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN2483"><span class='Ref_to_Parameter'>parsetree</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN2902"><span class='Ref_to_Struct'>TransactionStmt</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2487"></a>        <a href="../../include/nodes/parsenodes.h.html#LN2902"><span class='Ref_to_Struct'>TransactionStmt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>stmt</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2902"><span class='Ref_to_Struct'>TransactionStmt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres.c.html#LN2483"><span class='Ref_to_Parameter'>parsetree</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN2487"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2905"><span class='Ref_to_Member'>kind</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN2892"><span class='Ref_to_EnumConst'>TRANS_STMT_COMMIT</span></a> <span class='Operator'>|| 
</span>            <a href="postgres.c.html#LN2487"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2905"><span class='Ref_to_Member'>kind</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN2897"><span class='Ref_to_EnumConst'>TRANS_STMT_PREPARE</span></a> <span class='Operator'>|| 
</span>            <a href="postgres.c.html#LN2487"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2905"><span class='Ref_to_Member'>kind</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN2893"><span class='Ref_to_EnumConst'>TRANS_STMT_ROLLBACK</span></a> <span class='Operator'>|| 
</span>            <a href="postgres.c.html#LN2487"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2905"><span class='Ref_to_Member'>kind</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN2896"><span class='Ref_to_EnumConst'>TRANS_STMT_ROLLBACK_TO</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* Test a list that contains PlannedStmt nodes */ 
</span><span class='Keyword'>static bool 
</span><a name="LN2500"></a><span class='Declare_Function'>IsTransactionExitStmtList</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstmts</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN2500"><span class='Ref_to_Parameter'>pstmts</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2504"></a>        <a href="../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pstmt</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN113"><span class='Ref_to_Macro'>linitial_node</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN2500"><span class='Ref_to_Parameter'>pstmts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN2504"><span class='Ref_To_Local'>pstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN44"><span class='Ref_to_Member'>commandType</span></a> <span class='Operator'>== </span><a href="../../include/nodes/nodes.h.html#LN654"><span class='Ref_to_EnumConst'>CMD_UTILITY</span></a> <span class='Operator'>&& 
</span>            <a href="postgres.c.html#LN179"><span class='Ref_to_Proto'>IsTransactionExitStmt</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN2504"><span class='Ref_To_Local'>pstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN93"><span class='Ref_to_Member'>utilityStmt</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* Test a list that contains PlannedStmt nodes */ 
</span><span class='Keyword'>static bool 
</span><a name="LN2515"></a><span class='Declare_Function'>IsTransactionStmtList</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstmts</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN2515"><span class='Ref_to_Parameter'>pstmts</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2519"></a>        <a href="../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pstmt</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN113"><span class='Ref_to_Macro'>linitial_node</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN2515"><span class='Ref_to_Parameter'>pstmts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN2519"><span class='Ref_To_Local'>pstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN44"><span class='Ref_to_Member'>commandType</span></a> <span class='Operator'>== </span><a href="../../include/nodes/nodes.h.html#LN654"><span class='Ref_to_EnumConst'>CMD_UTILITY</span></a> <span class='Operator'>&& 
</span>            <a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN2519"><span class='Ref_To_Local'>pstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN93"><span class='Ref_to_Member'>utilityStmt</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN2902"><span class='Ref_to_Struct'>TransactionStmt</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* Release any existing unnamed prepared statement */ 
</span><span class='Keyword'>static void 
</span><a name="LN2530"></a><span class='Declare_Function'>drop_unnamed_stmt</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* paranoia to avoid a dangling pointer in case of error */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN150"><span class='Ref_to_Global_Var'>unnamed_stmt_psrc</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2535"></a>        <a href="../../include/utils/plancache.h.html#LN79"><span class='Ref_to_Struct'>CachedPlanSource</span></a> <span class='Operator'>*</span><span class='Declare_Local'>psrc</span> <span class='Operator'>= </span><a href="postgres.c.html#LN150"><span class='Ref_to_Global_Var'>unnamed_stmt_psrc</span></a><span class='Delimiter'>; 
</span> 
        <a href="postgres.c.html#LN150"><span class='Ref_to_Global_Var'>unnamed_stmt_psrc</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/plancache.h.html#LN166"><span class='Ref_to_Proto'>DropCachedPlan</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN2535"><span class='Ref_To_Local'>psrc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* -------------------------------- 
 *      signal handler routines used in PostgresMain() 
 * -------------------------------- 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * quickdie() occurs when signalled SIGQUIT by the postmaster. 
 * 
 * Some backend has bought the farm, 
 * so we need to stop what we're doing and exit. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN2555"></a><span class='Declare_Function'>quickdie</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN1078"><span class='Ref_to_Const'>SIGNAL_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../include/libpq/pqsignal.h.html#LN28"><span class='Ref_to_Macro'>sigaddset</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="../libpq/pqsignal.c.html#LN22"><span class='Ref_to_Global_Var'>BlockSig</span></a><span class='Delimiter'>, </span><a href="../../include/port/win32.h.html#LN188"><span class='Ref_to_Const'>SIGQUIT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* prevent nested calls */ 
</span>    <a href="../../include/libpq/pqsignal.h.html#LN18"><span class='Ref_to_Macro'>PG_SETMASK</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="../libpq/pqsignal.c.html#LN22"><span class='Ref_to_Global_Var'>BlockSig</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Prevent interrupts while exiting; though we just blocked signals that 
     * would queue new interrupts, one may have been pending.  We don't want a 
     * quickdie() downgraded to a mere query cancel. 
     */ 
</span>    <a href="../../include/miscadmin.h.html#LN116"><span class='Ref_to_Macro'>HOLD_INTERRUPTS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we're aborting out of client auth, don't risk trying to send 
     * anything to the client; we will likely violate the protocol, not to 
     * mention that we may have interrupted the guts of OpenSSL or some 
     * authentication library. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../postmaster/postmaster.c.html#LN347"><span class='Ref_to_Global_Var'>ClientAuthInProgress</span></a> <span class='Operator'>&& </span><a href="postgres.c.html#LN87"><span class='Ref_to_Global_Var'>whereToSendOutput</span></a> <span class='Operator'>== </span><a href="../../include/tcop/dest.h.html#LN89"><span class='Ref_to_EnumConst'>DestRemote</span></a><span class='Parentheses'>) 
</span>        <a href="postgres.c.html#LN87"><span class='Ref_to_Global_Var'>whereToSendOutput</span></a> <span class='Operator'>= </span><a href="../../include/tcop/dest.h.html#LN87"><span class='Ref_to_EnumConst'>DestNone</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Ideally this should be ereport(FATAL), but then we'd not get control 
     * back... 
     */ 
</span>    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, 
</span>            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CRASH_SHUTDOWN<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"terminating connection because of crash of another server process"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"The postmaster has commanded this server process to roll back"</span> 
              <span class='String'>" the current transaction and exit, because another"</span> 
              <span class='String'>" server process exited abnormally and possibly corrupted"</span> 
              <span class='String'>" shared memory."</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"In a moment you should be able to reconnect to the"</span> 
                     <span class='String'>" database and repeat your command."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We DO NOT want to run proc_exit() callbacks -- we're here because 
     * shared memory may be corrupted, so we don't want to try to clean up our 
     * transaction.  Just nail the windows shut and get out of town.  Now that 
     * there's an atexit callback to prevent third-party code from breaking 
     * things by calling exit() directly, we have to reset the callbacks 
     * explicitly to make this work as intended. 
     */ 
</span>    <a href="../../include/storage/ipc.h.html#LN72"><span class='Ref_to_Proto'>on_exit_reset</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Note we do exit(2) not exit(0).  This is to force the postmaster into a 
     * system reset cycle if some idiot DBA sends a manual SIGQUIT to a random 
     * backend.  This is necessary precisely because we don't clean up our 
     * shared memory state.  (The "dead man switch" mechanism in pmsignal.c 
     * should ensure the postmaster sees this as a crash, too, but no harm in 
     * being doubly sure.) 
     */ 
</span>    <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end quickdie &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Shutdown signal from postmaster: abort transaction and exit 
 * at soonest convenient time 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN2616"></a><span class='Declare_Function'>die</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN1078"><span class='Ref_to_Const'>SIGNAL_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2618"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>save_errno</span> <span class='Operator'>= </span>errno<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Don't joggle the elbow of proc_exit */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../storage/ipc/ipc.c.html#LN39"><span class='Ref_to_Global_Var'>proc_exit_inprogress</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../utils/init/globals.c.html#LN28"><span class='Ref_to_Global_Var'>InterruptPending</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="../utils/init/globals.c.html#LN30"><span class='Ref_to_Global_Var'>ProcDiePending</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* If we're still here, waken anything waiting on the process latch */ 
</span>    <a href="../../include/storage/latch.h.html#LN151"><span class='Ref_to_Proto'>SetLatch</span></a><span class='Parentheses'>(</span><a href="../utils/init/globals.c.html#LN51"><span class='Ref_to_Global_Var'>MyLatch</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we're in single user mode, we want to quit immediately - we can't 
     * rely on latches as they wouldn't work when stdin/stdout is a file. 
     * Rather ugly, but it's unlikely to be worthwhile to invest much more 
     * effort just for the benefit of single user mode. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN136"><span class='Ref_to_Global_Var'>DoingCommandRead</span></a> <span class='Operator'>&& </span><a href="postgres.c.html#LN87"><span class='Ref_to_Global_Var'>whereToSendOutput</span></a> <span class='Operator'>!= </span><a href="../../include/tcop/dest.h.html#LN89"><span class='Ref_to_EnumConst'>DestRemote</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/miscadmin.h.html#LN95"><span class='Ref_to_Proto'>ProcessInterrupts</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    errno <span class='Operator'>= </span><a href="postgres.c.html#LN2618"><span class='Ref_To_Local'>save_errno</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end die &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Query-cancel signal from postmaster: abort current transaction 
 * at soonest convenient time 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN2647"></a><span class='Declare_Function'>StatementCancelHandler</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN1078"><span class='Ref_to_Const'>SIGNAL_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2649"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>save_errno</span> <span class='Operator'>= </span>errno<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Don't joggle the elbow of proc_exit 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../storage/ipc/ipc.c.html#LN39"><span class='Ref_to_Global_Var'>proc_exit_inprogress</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../utils/init/globals.c.html#LN28"><span class='Ref_to_Global_Var'>InterruptPending</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="../utils/init/globals.c.html#LN29"><span class='Ref_to_Global_Var'>QueryCancelPending</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* If we're still here, waken anything waiting on the process latch */ 
</span>    <a href="../../include/storage/latch.h.html#LN151"><span class='Ref_to_Proto'>SetLatch</span></a><span class='Parentheses'>(</span><a href="../utils/init/globals.c.html#LN51"><span class='Ref_to_Global_Var'>MyLatch</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    errno <span class='Operator'>= </span><a href="postgres.c.html#LN2649"><span class='Ref_To_Local'>save_errno</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* signal handler for floating point exception */ 
</span><span class='Keyword'>void 
</span><a name="LN2668"></a><span class='Declare_Function'>FloatExceptionHandler</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN1078"><span class='Ref_to_Const'>SIGNAL_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* We're not returning, so no need to save errno */ 
</span>    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FLOATING_POINT_EXCEPTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"floating-point exception"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"An invalid floating-point operation was signaled. "</span> 
                       <span class='String'>"This probably means an out-of-range result or an "</span> 
                       <span class='String'>"invalid operation, such as division by zero."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * SIGHUP: set flag to re-read config file at next convenient time. 
 * 
 * Sets the ConfigReloadPending flag, which should be checked at convenient 
 * places inside main loops. (Better than doing the reading in the signal 
 * handler, ey?) 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN2687"></a><span class='Declare_Function'>PostgresSigHupHandler</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN1078"><span class='Ref_to_Const'>SIGNAL_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2689"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>save_errno</span> <span class='Operator'>= </span>errno<span class='Delimiter'>; 
</span> 
    <a href="../utils/init/globals.c.html#LN33"><span class='Ref_to_Global_Var'>ConfigReloadPending</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="../../include/storage/latch.h.html#LN151"><span class='Ref_to_Proto'>SetLatch</span></a><span class='Parentheses'>(</span><a href="../utils/init/globals.c.html#LN51"><span class='Ref_to_Global_Var'>MyLatch</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    errno <span class='Operator'>= </span><a href="postgres.c.html#LN2689"><span class='Ref_To_Local'>save_errno</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * RecoveryConflictInterrupt: out-of-line portion of recovery conflict 
 * handling following receipt of SIGUSR1. Designed to be similar to die() 
 * and StatementCancelHandler(). Called only by a normal user backend 
 * that begins a transaction during recovery. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN2704"></a><span class='Declare_Function'>RecoveryConflictInterrupt</span><span class='Parentheses'>(</span><a href="../../include/storage/procsignal.h.html#LN29"><span class='Ref_to_Typedef'>ProcSignalReason</span></a> <span class='Declare_Parameter'>reason</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2706"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>save_errno</span> <span class='Operator'>= </span>errno<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Don't joggle the elbow of proc_exit 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../storage/ipc/ipc.c.html#LN39"><span class='Ref_to_Global_Var'>proc_exit_inprogress</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="postgres.c.html#LN160"><span class='Ref_to_Global_Var'>RecoveryConflictReason</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN2704"><span class='Ref_to_Parameter'>reason</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN2704"><span class='Ref_to_Parameter'>reason</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../include/storage/procsignal.h.html#LN43"><span class='Ref_to_EnumConst'>PROCSIG_RECOVERY_CONFLICT_STARTUP_DEADLOCK</span></a><span class='Operator'>: 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * If we aren't waiting for a lock we can never deadlock. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/storage/proc.h.html#LN304"><span class='Ref_to_Proto'>IsWaitingForLock</span></a><span class='Parentheses'>())</span> 
                    <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Intentional drop through to check wait for pin */ 
</span> 
            <span class='Control'>case</span> <a href="../../include/storage/procsignal.h.html#LN42"><span class='Ref_to_EnumConst'>PROCSIG_RECOVERY_CONFLICT_BUFFERPIN</span></a><span class='Operator'>: 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * If we aren't blocking the Startup process there is nothing 
                 * more to do. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/storage/bufmgr.h.html#LN219"><span class='Ref_to_Proto'>HoldingBufferPinThatDelaysRecovery</span></a><span class='Parentheses'>())</span> 
                    <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
                <a href="../storage/lmgr/proc.c.html#LN66"><span class='Ref_to_Global_Var'>MyProc</span></a><span class='Operator'>-&GT;</span><a href="../../include/storage/proc.h.html#LN122"><span class='Ref_to_Member'>recoveryConflictPending</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Intentional drop through to error handling */ 
</span> 
            <span class='Control'>case</span> <a href="../../include/storage/procsignal.h.html#LN40"><span class='Ref_to_EnumConst'>PROCSIG_RECOVERY_CONFLICT_LOCK</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/storage/procsignal.h.html#LN39"><span class='Ref_to_EnumConst'>PROCSIG_RECOVERY_CONFLICT_TABLESPACE</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/storage/procsignal.h.html#LN41"><span class='Ref_to_EnumConst'>PROCSIG_RECOVERY_CONFLICT_SNAPSHOT</span></a><span class='Operator'>: 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * If we aren't in a transaction any longer then ignore. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/xact.h.html#LN367"><span class='Ref_to_Proto'>IsTransactionOrTransactionBlock</span></a><span class='Parentheses'>())</span> 
                    <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * If we can abort just the current subtransaction then we are 
                 * OK to throw an ERROR to resolve the conflict. Otherwise 
                 * drop through to the FATAL case. 
                 * 
                 * XXX other times that we can throw just an ERROR *may* be 
                 * PROCSIG_RECOVERY_CONFLICT_LOCK if no locks are held in 
                 * parent transactions 
                 * 
                 * PROCSIG_RECOVERY_CONFLICT_SNAPSHOT if no snapshots are held 
                 * by parent transactions and the transaction is not 
                 * transaction-snapshot mode 
                 * 
                 * PROCSIG_RECOVERY_CONFLICT_TABLESPACE if no temp files or 
                 * cursors open in parent transactions 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/xact.h.html#LN361"><span class='Ref_to_Proto'>IsSubTransaction</span></a><span class='Parentheses'>())</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* 
                     * If we already aborted then we no longer need to cancel. 
                     * We do this here since we do not wish to ignore aborted 
                     * subtransactions, which must cause FATAL, currently. 
                     */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/xact.h.html#LN330"><span class='Ref_to_Proto'>IsAbortedTransactionBlockState</span></a><span class='Parentheses'>())</span> 
                        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
                    <a href="postgres.c.html#LN158"><span class='Ref_to_Global_Var'>RecoveryConflictPending</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                    <a href="../utils/init/globals.c.html#LN29"><span class='Ref_to_Global_Var'>QueryCancelPending</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                    <a href="../utils/init/globals.c.html#LN28"><span class='Ref_to_Global_Var'>InterruptPending</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Comment_Multi_Line'>/* Intentional drop through to session cancel */ 
</span> 
            <span class='Control'>case</span> <a href="../../include/storage/procsignal.h.html#LN38"><span class='Ref_to_EnumConst'>PROCSIG_RECOVERY_CONFLICT_DATABASE</span></a><span class='Operator'>: 
</span>                <a href="postgres.c.html#LN158"><span class='Ref_to_Global_Var'>RecoveryConflictPending</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="../utils/init/globals.c.html#LN30"><span class='Ref_to_Global_Var'>ProcDiePending</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="../utils/init/globals.c.html#LN28"><span class='Ref_to_Global_Var'>InterruptPending</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized conflict mode: %d"</span><span class='Delimiter'>, 
</span>                     <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="postgres.c.html#LN2704"><span class='Ref_to_Parameter'>reason</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch reason &raquo; </span> 
 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="postgres.c.html#LN158"><span class='Ref_to_Global_Var'>RecoveryConflictPending</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="../utils/init/globals.c.html#LN29"><span class='Ref_to_Global_Var'>QueryCancelPending</span></a> <span class='Operator'>|| </span><a href="../utils/init/globals.c.html#LN30"><span class='Ref_to_Global_Var'>ProcDiePending</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * All conflicts apart from database cause dynamic errors where the 
         * command or transaction can be retried at a later point with some 
         * potential for success. No need to reset this, since non-retryable 
         * conflict errors are currently FATAL. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN2704"><span class='Ref_to_Parameter'>reason</span></a> <span class='Operator'>== </span><a href="../../include/storage/procsignal.h.html#LN38"><span class='Ref_to_EnumConst'>PROCSIG_RECOVERY_CONFLICT_DATABASE</span></a><span class='Parentheses'>) 
</span>            <a href="postgres.c.html#LN159"><span class='Ref_to_Global_Var'>RecoveryConflictRetryable</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !proc_exit_inprogress &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Set the process latch. This function essentially emulates signal 
     * handlers like die() and StatementCancelHandler() and it seems prudent 
     * to behave similarly as they do. 
     */ 
</span>    <a href="../../include/storage/latch.h.html#LN151"><span class='Ref_to_Proto'>SetLatch</span></a><span class='Parentheses'>(</span><a href="../utils/init/globals.c.html#LN51"><span class='Ref_to_Global_Var'>MyLatch</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    errno <span class='Operator'>= </span><a href="postgres.c.html#LN2706"><span class='Ref_To_Local'>save_errno</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RecoveryConflictInterrupt &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ProcessInterrupts: out-of-line portion of CHECK_FOR_INTERRUPTS() macro 
 * 
 * If an interrupt condition is pending, and it's safe to service it, 
 * then clear the flag and accept the interrupt.  Called only when 
 * InterruptPending is true. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN2824"></a><span class='Declare_Function'>ProcessInterrupts</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* OK to accept any interrupts now? */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/init/globals.c.html#LN34"><span class='Ref_to_Global_Var'>InterruptHoldoffCount</span></a> <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="../utils/init/globals.c.html#LN36"><span class='Ref_to_Global_Var'>CritSectionCount</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <a href="../utils/init/globals.c.html#LN28"><span class='Ref_to_Global_Var'>InterruptPending</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/init/globals.c.html#LN30"><span class='Ref_to_Global_Var'>ProcDiePending</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../utils/init/globals.c.html#LN30"><span class='Ref_to_Global_Var'>ProcDiePending</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="../utils/init/globals.c.html#LN29"><span class='Ref_to_Global_Var'>QueryCancelPending</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* ProcDie trumps QueryCancel */ 
</span>        <a href="../../include/storage/proc.h.html#LN305"><span class='Ref_to_Proto'>LockErrorCleanup</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* As in quickdie, don't risk sending to client during auth */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../postmaster/postmaster.c.html#LN347"><span class='Ref_to_Global_Var'>ClientAuthInProgress</span></a> <span class='Operator'>&& </span><a href="postgres.c.html#LN87"><span class='Ref_to_Global_Var'>whereToSendOutput</span></a> <span class='Operator'>== </span><a href="../../include/tcop/dest.h.html#LN89"><span class='Ref_to_EnumConst'>DestRemote</span></a><span class='Parentheses'>) 
</span>            <a href="postgres.c.html#LN87"><span class='Ref_to_Global_Var'>whereToSendOutput</span></a> <span class='Operator'>= </span><a href="../../include/tcop/dest.h.html#LN87"><span class='Ref_to_EnumConst'>DestNone</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../postmaster/postmaster.c.html#LN347"><span class='Ref_to_Global_Var'>ClientAuthInProgress</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_QUERY_CANCELED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"canceling authentication due to timeout"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/postmaster/autovacuum.h.html#LN50"><span class='Ref_to_Proto'>IsAutoVacuumWorkerProcess</span></a><span class='Parentheses'>())</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ADMIN_SHUTDOWN<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"terminating autovacuum process due to administrator command"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/replication/logicalworker.h.html#LN16"><span class='Ref_to_Proto'>IsLogicalWorker</span></a><span class='Parentheses'>())</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ADMIN_SHUTDOWN<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"terminating logical replication worker due to administrator command"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/replication/logicallauncher.h.html#LN26"><span class='Ref_to_Proto'>IsLogicalLauncher</span></a><span class='Parentheses'>())</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN24"><span class='Ref_to_Const'>DEBUG1</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"logical replication launcher shutting down"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* The logical replication launcher can be stopped at any time. */ 
</span>            <a href="../storage/ipc/ipc.c.html#LN97"><span class='Ref_to_Func'>proc_exit</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN158"><span class='Ref_to_Global_Var'>RecoveryConflictPending</span></a> <span class='Operator'>&& </span><a href="postgres.c.html#LN159"><span class='Ref_to_Global_Var'>RecoveryConflictRetryable</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/pgstat.h.html#LN1162"><span class='Ref_to_Proto'>pgstat_report_recovery_conflict</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN160"><span class='Ref_to_Global_Var'>RecoveryConflictReason</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_T_R_SERIALIZATION_FAILURE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>              <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"terminating connection due to conflict with recovery"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="postgres.c.html#LN176"><span class='Ref_to_Proto'>errdetail_recovery_conflict</span></a><span class='Parentheses'>()))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN158"><span class='Ref_to_Global_Var'>RecoveryConflictPending</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Currently there is only one non-retryable recovery conflict */ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="postgres.c.html#LN160"><span class='Ref_to_Global_Var'>RecoveryConflictReason</span></a> <span class='Operator'>== </span><a href="../../include/storage/procsignal.h.html#LN38"><span class='Ref_to_EnumConst'>PROCSIG_RECOVERY_CONFLICT_DATABASE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/pgstat.h.html#LN1162"><span class='Ref_to_Proto'>pgstat_report_recovery_conflict</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN160"><span class='Ref_to_Global_Var'>RecoveryConflictReason</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATABASE_DROPPED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>              <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"terminating connection due to conflict with recovery"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="postgres.c.html#LN176"><span class='Ref_to_Proto'>errdetail_recovery_conflict</span></a><span class='Parentheses'>()))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ADMIN_SHUTDOWN<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"terminating connection due to administrator command"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if ProcDiePending &raquo; </span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/init/globals.c.html#LN31"><span class='Ref_to_Global_Var'>ClientConnectionLost</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../utils/init/globals.c.html#LN29"><span class='Ref_to_Global_Var'>QueryCancelPending</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* lost connection trumps QueryCancel */ 
</span>        <a href="../../include/storage/proc.h.html#LN305"><span class='Ref_to_Proto'>LockErrorCleanup</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* don't send to client, we already know the connection to be dead. */ 
</span>        <a href="postgres.c.html#LN87"><span class='Ref_to_Global_Var'>whereToSendOutput</span></a> <span class='Operator'>= </span><a href="../../include/tcop/dest.h.html#LN87"><span class='Ref_to_EnumConst'>DestNone</span></a><span class='Delimiter'>; 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONNECTION_FAILURE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"connection to client lost"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If a recovery conflict happens while we are waiting for input from the 
     * client, the client is presumably just sitting idle in a transaction, 
     * preventing recovery from making progress.  Terminate the connection to 
     * dislodge it. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN158"><span class='Ref_to_Global_Var'>RecoveryConflictPending</span></a> <span class='Operator'>&& </span><a href="postgres.c.html#LN136"><span class='Ref_to_Global_Var'>DoingCommandRead</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../utils/init/globals.c.html#LN29"><span class='Ref_to_Global_Var'>QueryCancelPending</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* this trumps QueryCancel */ 
</span>        <a href="postgres.c.html#LN158"><span class='Ref_to_Global_Var'>RecoveryConflictPending</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="../../include/storage/proc.h.html#LN305"><span class='Ref_to_Proto'>LockErrorCleanup</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <a href="../../include/pgstat.h.html#LN1162"><span class='Ref_to_Proto'>pgstat_report_recovery_conflict</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN160"><span class='Ref_to_Global_Var'>RecoveryConflictReason</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_T_R_SERIALIZATION_FAILURE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>              <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"terminating connection due to conflict with recovery"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="postgres.c.html#LN176"><span class='Ref_to_Proto'>errdetail_recovery_conflict</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"In a moment you should be able to reconnect to the"</span> 
                         <span class='String'>" database and repeat your command."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/init/globals.c.html#LN29"><span class='Ref_to_Global_Var'>QueryCancelPending</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2915"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>lock_timeout_occurred</span><span class='Delimiter'>; 
</span><a name="LN2916"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>stmt_timeout_occurred</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Don't allow query cancel interrupts while reading input from the 
         * client, because we might lose sync in the FE/BE protocol.  (Die 
         * interrupts are OK, because we won't read any further messages from 
         * the client in that case.) 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/init/globals.c.html#LN35"><span class='Ref_to_Global_Var'>QueryCancelHoldoffCount</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Re-arm InterruptPending so that we process the cancel request 
             * as soon as we're done reading the message. 
             */ 
</span>            <a href="../utils/init/globals.c.html#LN28"><span class='Ref_to_Global_Var'>InterruptPending</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../utils/init/globals.c.html#LN29"><span class='Ref_to_Global_Var'>QueryCancelPending</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If LOCK_TIMEOUT and STATEMENT_TIMEOUT indicators are both set, we 
         * need to clear both, so always fetch both. 
         */ 
</span>        <a href="postgres.c.html#LN2915"><span class='Ref_To_Local'>lock_timeout_occurred</span></a> <span class='Operator'>= </span><a href="../../include/utils/timeout.h.html#LN82"><span class='Ref_to_Proto'>get_timeout_indicator</span></a><span class='Parentheses'>(</span><a href="../../include/utils/timeout.h.html#LN27"><span class='Ref_to_EnumConst'>LOCK_TIMEOUT</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="postgres.c.html#LN2916"><span class='Ref_To_Local'>stmt_timeout_occurred</span></a> <span class='Operator'>= </span><a href="../../include/utils/timeout.h.html#LN82"><span class='Ref_to_Proto'>get_timeout_indicator</span></a><span class='Parentheses'>(</span><a href="../../include/utils/timeout.h.html#LN28"><span class='Ref_to_EnumConst'>STATEMENT_TIMEOUT</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If both were set, we want to report whichever timeout completed 
         * earlier; this ensures consistent behavior if the machine is slow 
         * enough that the second timeout triggers before we get here.  A tie 
         * is arbitrarily broken in favor of reporting a lock timeout. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN2915"><span class='Ref_To_Local'>lock_timeout_occurred</span></a> <span class='Operator'>&& </span><a href="postgres.c.html#LN2916"><span class='Ref_To_Local'>stmt_timeout_occurred</span></a> <span class='Operator'>&& 
</span>            <a href="../../include/utils/timeout.h.html#LN84"><span class='Ref_to_Proto'>get_timeout_finish_time</span></a><span class='Parentheses'>(</span><a href="../../include/utils/timeout.h.html#LN28"><span class='Ref_to_EnumConst'>STATEMENT_TIMEOUT</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><a href="../../include/utils/timeout.h.html#LN84"><span class='Ref_to_Proto'>get_timeout_finish_time</span></a><span class='Parentheses'>(</span><a href="../../include/utils/timeout.h.html#LN27"><span class='Ref_to_EnumConst'>LOCK_TIMEOUT</span></a><span class='Parentheses'>))</span> 
            <a href="postgres.c.html#LN2915"><span class='Ref_To_Local'>lock_timeout_occurred</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* report stmt timeout */ 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN2915"><span class='Ref_To_Local'>lock_timeout_occurred</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/storage/proc.h.html#LN305"><span class='Ref_to_Proto'>LockErrorCleanup</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_LOCK_NOT_AVAILABLE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"canceling statement due to lock timeout"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN2916"><span class='Ref_To_Local'>stmt_timeout_occurred</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/storage/proc.h.html#LN305"><span class='Ref_to_Proto'>LockErrorCleanup</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_QUERY_CANCELED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"canceling statement due to statement timeout"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/postmaster/autovacuum.h.html#LN50"><span class='Ref_to_Proto'>IsAutoVacuumWorkerProcess</span></a><span class='Parentheses'>())</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../include/storage/proc.h.html#LN305"><span class='Ref_to_Proto'>LockErrorCleanup</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_QUERY_CANCELED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"canceling autovacuum task"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN158"><span class='Ref_to_Global_Var'>RecoveryConflictPending</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="postgres.c.html#LN158"><span class='Ref_to_Global_Var'>RecoveryConflictPending</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="../../include/storage/proc.h.html#LN305"><span class='Ref_to_Proto'>LockErrorCleanup</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>            <a href="../../include/pgstat.h.html#LN1162"><span class='Ref_to_Proto'>pgstat_report_recovery_conflict</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN160"><span class='Ref_to_Global_Var'>RecoveryConflictReason</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_T_R_SERIALIZATION_FAILURE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"canceling statement due to conflict with recovery"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="postgres.c.html#LN176"><span class='Ref_to_Proto'>errdetail_recovery_conflict</span></a><span class='Parentheses'>()))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If we are reading a command from the client, just ignore the cancel 
         * request --- sending an extra error message won't accomplish 
         * anything.  Otherwise, go ahead and throw the error. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postgres.c.html#LN136"><span class='Ref_to_Global_Var'>DoingCommandRead</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/storage/proc.h.html#LN305"><span class='Ref_to_Proto'>LockErrorCleanup</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_QUERY_CANCELED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"canceling statement due to user request"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if QueryCancelPending &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/init/globals.c.html#LN32"><span class='Ref_to_Global_Var'>IdleInTransactionSessionTimeoutPending</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Has the timeout setting changed since last we looked? */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../storage/lmgr/proc.c.html#LN62"><span class='Ref_to_Global_Var'>IdleInTransactionSessionTimeout</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_IDLE_IN_TRANSACTION_SESSION_TIMEOUT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"terminating connection due to idle-in-transaction timeout"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../utils/init/globals.c.html#LN32"><span class='Ref_to_Global_Var'>IdleInTransactionSessionTimeoutPending</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../access/transam/parallel.c.html#LN96"><span class='Ref_to_Global_Var'>ParallelMessagePending</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/access/parallel.h.html#LN62"><span class='Ref_to_Proto'>HandleParallelMessages</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ProcessInterrupts &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * IA64-specific code to fetch the AR.BSP register for stack depth checks. 
 * 
 * We currently support gcc, icc, and HP-UX's native compiler here. 
 * 
 * Note: while icc accepts gcc asm blocks on x86[_64], this is not true on 
 * ia64 (at least not in icc versions before 12.x).  So we have to carry a 
 * separate implementation for it. 
 */ 
</span><span class='Directive'>#if</span> defined<span class='Parentheses'>(</span>__ia64__<span class='Parentheses'>) </span><span class='Operator'>|| </span>defined<span class='Parentheses'>(</span>__ia64<span class='Parentheses'>) 
</span> 
<span class='Directive'>#if</span> defined<span class='Parentheses'>(</span>__hpux<span class='Parentheses'>) </span><span class='Operator'>&& !</span>defined<span class='Parentheses'>(</span>__GNUC__<span class='Parentheses'>) </span><span class='Operator'>&& !</span>defined<span class='Parentheses'>(</span>__INTEL_COMPILER<span class='Parentheses'>) 
</span><span class='Comment_Multi_Line'>/* Assume it's HP-UX native compiler */ 
</span><span class='Keyword'>#include </span><span class='String'>&LT;ia64/sys/inline.h&GT;</span> 
<a name="LN3030"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>ia64_get_bsp</span><span class='Parentheses'>() ((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>)</span> <span class='Parentheses'>(</span>_Asm_mov_from_ar<span class='Parentheses'>(</span>_AREG_BSP<span class='Delimiter'>, </span>_NO_FENCE<span class='Parentheses'>)))</span> 
<span class='Directive'>#elif</span> defined<span class='Parentheses'>(</span>__INTEL_COMPILER<span class='Parentheses'>) 
</span><span class='Comment_Multi_Line'>/* icc */ 
</span><span class='Keyword'>#include </span><span class='String'>&LT;asm/ia64regs.h&GT;</span> 
<a name="LN3034"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>ia64_get_bsp</span><span class='Parentheses'>() ((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span>__getReg<span class='Parentheses'>(</span>_IA64_REG_AR_BSP<span class='Parentheses'>))</span> 
<span class='Directive'>#else</span> 
<span class='Comment_Multi_Line'>/* gcc */ 
</span><span class='Keyword'>static </span>__inline__ <span class='Keyword'>char </span><span class='Operator'>* 
</span><a name="LN3038"></a><span class='Declare_Function'>ia64_get_bsp</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3040"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>ret</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* the ;; is a "stop", seems to be required before fetching BSP */ 
</span><a name="LN3043"></a>    __asm__     <span class='Declare_Local'>__volatile__</span><span class='Parentheses'>(</span> 
                                         <span class='String'>";;\n"</span> 
                                         <span class='String'>"  mov %0=ar.bsp   \n"</span> 
                             <span class='Operator'>:</span>           <span class='String'>"=r"</span><span class='Parentheses'>(</span><a href="postgres.c.html#LN3040"><span class='Ref_To_Local'>ret</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="postgres.c.html#LN3040"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>; 
} 
</span><span class='Directive'>#endif</span> 
<span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* IA64 */ 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * set_stack_base: set up reference point for stack depth checking 
 * 
 * Returns the old reference point, if any. 
 */ 
</span><a href="../../include/miscadmin.h.html#LN270"><span class='Ref_to_Typedef'>pg_stack_base_t</span></a> 
<a name="LN3060"></a><span class='Declare_Function'>set_stack_base</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3062"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>stack_base</span><span class='Delimiter'>; 
</span><a name="LN3063"></a>    <a href="../../include/miscadmin.h.html#LN270"><span class='Ref_to_Typedef'>pg_stack_base_t</span></a> <span class='Declare_Local'>old</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#if</span> defined<span class='Parentheses'>(</span>__ia64__<span class='Parentheses'>) </span><span class='Operator'>|| </span>defined<span class='Parentheses'>(</span>__ia64<span class='Parentheses'>) 
</span>    <a href="postgres.c.html#LN3063"><span class='Ref_To_Local'>old</span></a><span class='Operator'>.</span>stack_base_ptr <span class='Operator'>= </span><a href="postgres.c.html#LN116"><span class='Ref_to_Global_Var'>stack_base_ptr</span></a><span class='Delimiter'>; 
</span>    <a href="postgres.c.html#LN3063"><span class='Ref_To_Local'>old</span></a><span class='Operator'>.</span>register_stack_base_ptr <span class='Operator'>= </span><a href="postgres.c.html#LN122"><span class='Ref_to_Global_Var'>register_stack_base_ptr</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
    <a href="postgres.c.html#LN3063"><span class='Ref_To_Local'>old</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN116"><span class='Ref_to_Global_Var'>stack_base_ptr</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <span class='Comment_Multi_Line'>/* Set up reference point for stack depth checking */ 
</span>    <a href="postgres.c.html#LN116"><span class='Ref_to_Global_Var'>stack_base_ptr</span></a> <span class='Operator'>= &</span><a href="postgres.c.html#LN3062"><span class='Ref_To_Local'>stack_base</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#if</span> defined<span class='Parentheses'>(</span>__ia64__<span class='Parentheses'>) </span><span class='Operator'>|| </span>defined<span class='Parentheses'>(</span>__ia64<span class='Parentheses'>) 
</span>    <a href="postgres.c.html#LN122"><span class='Ref_to_Global_Var'>register_stack_base_ptr</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN3030"><span class='Ref_to_Macro'>ia64_get_bsp</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <span class='Control'>return</span> <a href="postgres.c.html#LN3063"><span class='Ref_To_Local'>old</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end set_stack_base &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * restore_stack_base: restore reference point for stack depth checking 
 * 
 * This can be used after set_stack_base() to restore the old value. This 
 * is currently only used in PL/Java. When PL/Java calls a backend function 
 * from different thread, the thread's stack is at a different location than 
 * the main thread's stack, so it sets the base pointer before the call, and 
 * restores it afterwards. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN3091"></a><span class='Declare_Function'>restore_stack_base</span><span class='Parentheses'>(</span><a href="../../include/miscadmin.h.html#LN270"><span class='Ref_to_Typedef'>pg_stack_base_t</span></a> <span class='Declare_Parameter'>base</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><span class='Directive'>#if</span> defined<span class='Parentheses'>(</span>__ia64__<span class='Parentheses'>) </span><span class='Operator'>|| </span>defined<span class='Parentheses'>(</span>__ia64<span class='Parentheses'>) 
</span>    <a href="postgres.c.html#LN116"><span class='Ref_to_Global_Var'>stack_base_ptr</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN3091"><span class='Ref_to_Parameter'>base</span></a><span class='Operator'>.</span>stack_base_ptr<span class='Delimiter'>; 
</span>    <a href="postgres.c.html#LN122"><span class='Ref_to_Global_Var'>register_stack_base_ptr</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN3091"><span class='Ref_to_Parameter'>base</span></a><span class='Operator'>.</span>register_stack_base_ptr<span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
    <a href="postgres.c.html#LN116"><span class='Ref_to_Global_Var'>stack_base_ptr</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN3091"><span class='Ref_to_Parameter'>base</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<span class='Delimiter'>} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * check_stack_depth/stack_is_too_deep: check for excessively deep recursion 
 * 
 * This should be called someplace in any recursive routine that might possibly 
 * recurse deep enough to overflow the stack.  Most Unixen treat stack 
 * overflow as an unrecoverable SIGSEGV, so we want to error out ourselves 
 * before hitting the hardware limit. 
 * 
 * check_stack_depth() just throws an error summarily.  stack_is_too_deep() 
 * can be used by code that wants to handle the error condition itself. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN3113"></a><span class='Declare_Function'>check_stack_depth</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/miscadmin.h.html#LN276"><span class='Ref_to_Proto'>stack_is_too_deep</span></a><span class='Parentheses'>())</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_STATEMENT_TOO_COMPLEX<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"stack depth limit exceeded"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Increase the configuration parameter \"max_stack_depth\" (currently %dkB), "</span> 
              <span class='String'>"after ensuring the platform's stack depth limit is adequate."</span><span class='Delimiter'>, 
</span>                         <a href="postgres.c.html#LN95"><span class='Ref_to_Global_Var'>max_stack_depth</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Keyword'>bool 
</span><a name="LN3127"></a><span class='Declare_Function'>stack_is_too_deep</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3129"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>stack_top_loc</span><span class='Delimiter'>; 
</span><a name="LN3130"></a>    <span class='Keyword'>long</span>        <span class='Declare_Local'>stack_depth</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Compute distance from reference point to my local variables 
     */ 
</span>    <a href="postgres.c.html#LN3130"><span class='Ref_To_Local'>stack_depth</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>long</span><span class='Parentheses'>) (</span><a href="postgres.c.html#LN116"><span class='Ref_to_Global_Var'>stack_base_ptr</span></a> <span class='Operator'>- &</span><a href="postgres.c.html#LN3129"><span class='Ref_To_Local'>stack_top_loc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Take abs value, since stacks grow up on some machines, down on others 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN3130"><span class='Ref_To_Local'>stack_depth</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="postgres.c.html#LN3130"><span class='Ref_To_Local'>stack_depth</span></a> <span class='Operator'>= -</span><a href="postgres.c.html#LN3130"><span class='Ref_To_Local'>stack_depth</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Trouble? 
     * 
     * The test on stack_base_ptr prevents us from erroring out if called 
     * during process setup or in a non-backend process.  Logically it should 
     * be done first, but putting it here avoids wasting cycles during normal 
     * cases. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN3130"><span class='Ref_To_Local'>stack_depth</span></a> <span class='Operator'>&GT; </span><a href="postgres.c.html#LN108"><span class='Ref_to_Global_Var'>max_stack_depth_bytes</span></a> <span class='Operator'>&& 
</span>        <a href="postgres.c.html#LN116"><span class='Ref_to_Global_Var'>stack_base_ptr</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * On IA64 there is a separate "register" stack that requires its own 
     * independent check.  For this, we have to measure the change in the 
     * "BSP" pointer from PostgresMain to here.  Logic is just as above, 
     * except that we know IA64's register stack grows up. 
     * 
     * Note we assume that the same max_stack_depth applies to both stacks. 
     */ 
</span><span class='Directive'>#if</span> defined<span class='Parentheses'>(</span>__ia64__<span class='Parentheses'>) </span><span class='Operator'>|| </span>defined<span class='Parentheses'>(</span>__ia64<span class='Parentheses'>) 
</span>    <a href="postgres.c.html#LN3130"><span class='Ref_To_Local'>stack_depth</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>long</span><span class='Parentheses'>) (</span><a href="postgres.c.html#LN3030"><span class='Ref_to_Macro'>ia64_get_bsp</span></a><span class='Parentheses'>() </span><span class='Operator'>- </span><a href="postgres.c.html#LN122"><span class='Ref_to_Global_Var'>register_stack_base_ptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN3130"><span class='Ref_To_Local'>stack_depth</span></a> <span class='Operator'>&GT; </span><a href="postgres.c.html#LN108"><span class='Ref_to_Global_Var'>max_stack_depth_bytes</span></a> <span class='Operator'>&& 
</span>        <a href="postgres.c.html#LN122"><span class='Ref_to_Global_Var'>register_stack_base_ptr</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* IA64 */ 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end stack_is_too_deep &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* GUC check hook for max_stack_depth */ 
</span><span class='Keyword'>bool 
</span><a name="LN3176"></a><span class='Declare_Function'>check_max_stack_depth</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>newval</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>**</span><span class='Declare_Parameter'>extra</span><span class='Delimiter'>, </span><a href="../../include/utils/guc.h.html#LN104"><span class='Ref_to_Typedef'>GucSource</span></a> <span class='Declare_Parameter'>source</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3178"></a>    <span class='Keyword'>long</span>        <span class='Declare_Local'>newval_bytes</span> <span class='Operator'>= *</span><a href="postgres.c.html#LN3176"><span class='Ref_to_Parameter'>newval</span></a> <span class='Operator'>* </span><span class='Number'>1024L</span><span class='Delimiter'>; 
</span><a name="LN3179"></a>    <span class='Keyword'>long</span>        <span class='Declare_Local'>stack_rlimit</span> <span class='Operator'>= </span><a href="../../include/tcop/tcopprot.h.html#LN81"><span class='Ref_to_Proto'>get_stack_depth_rlimit</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN3179"><span class='Ref_To_Local'>stack_rlimit</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="postgres.c.html#LN3178"><span class='Ref_To_Local'>newval_bytes</span></a> <span class='Operator'>&GT; </span><a href="postgres.c.html#LN3179"><span class='Ref_To_Local'>stack_rlimit</span></a> <span class='Operator'>- </span><a href="../../include/tcop/tcopprot.h.html#LN30"><span class='Ref_to_Const'>STACK_DEPTH_SLOP</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/guc.h.html#LN406"><span class='Ref_to_Const'>GUC_check_errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"\"max_stack_depth\" must not exceed %ldkB."</span><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="postgres.c.html#LN3179"><span class='Ref_To_Local'>stack_rlimit</span></a> <span class='Operator'>- </span><a href="../../include/tcop/tcopprot.h.html#LN30"><span class='Ref_to_Const'>STACK_DEPTH_SLOP</span></a><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Number'>1024L</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/guc.h.html#LN410"><span class='Ref_to_Const'>GUC_check_errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Increase the platform's stack depth limit via \"ulimit -s\" or local equivalent."</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* GUC assign hook for max_stack_depth */ 
</span><span class='Keyword'>void 
</span><a name="LN3193"></a><span class='Declare_Function'>assign_max_stack_depth</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>newval</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>extra</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3195"></a>    <span class='Keyword'>long</span>        <span class='Declare_Local'>newval_bytes</span> <span class='Operator'>= </span><a href="postgres.c.html#LN3193"><span class='Ref_to_Parameter'>newval</span></a> <span class='Operator'>* </span><span class='Number'>1024L</span><span class='Delimiter'>; 
</span> 
    <a href="postgres.c.html#LN108"><span class='Ref_to_Global_Var'>max_stack_depth_bytes</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN3195"><span class='Ref_To_Local'>newval_bytes</span></a><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * set_debug_options --- apply "-d N" command line option 
 * 
 * -d is not quite the same as setting log_min_messages because it enables 
 * other output options. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN3208"></a><span class='Declare_Function'>set_debug_options</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>debug_flag</span><span class='Delimiter'>, </span><a href="../../include/utils/guc.h.html#LN67"><span class='Ref_to_Typedef'>GucContext</span></a> <span class='Declare_Parameter'>context</span><span class='Delimiter'>, </span><a href="../../include/utils/guc.h.html#LN104"><span class='Ref_to_Typedef'>GucSource</span></a> <span class='Declare_Parameter'>source</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN3208"><span class='Ref_to_Parameter'>debug_flag</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3212"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>debugstr</span><span class='Delimiter'>[</span><span class='Number'>64</span><span class='Delimiter'>]; 
</span> 
        <a href="../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN3212"><span class='Ref_To_Local'>debugstr</span></a><span class='Delimiter'>, </span><span class='String'>"debug%d"</span><span class='Delimiter'>, </span><a href="postgres.c.html#LN3208"><span class='Ref_to_Parameter'>debug_flag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/guc.h.html#LN276"><span class='Ref_to_Proto'>SetConfigOption</span></a><span class='Parentheses'>(</span><span class='String'>"log_min_messages"</span><span class='Delimiter'>, </span><a href="postgres.c.html#LN3212"><span class='Ref_To_Local'>debugstr</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN3208"><span class='Ref_to_Parameter'>context</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN3208"><span class='Ref_to_Parameter'>source</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="../../include/utils/guc.h.html#LN276"><span class='Ref_to_Proto'>SetConfigOption</span></a><span class='Parentheses'>(</span><span class='String'>"log_min_messages"</span><span class='Delimiter'>, </span><span class='String'>"notice"</span><span class='Delimiter'>, </span><a href="postgres.c.html#LN3208"><span class='Ref_to_Parameter'>context</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN3208"><span class='Ref_to_Parameter'>source</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN3208"><span class='Ref_to_Parameter'>debug_flag</span></a> <span class='Operator'>&GT;= </span><span class='Number'>1</span> <span class='Operator'>&& </span><a href="postgres.c.html#LN3208"><span class='Ref_to_Parameter'>context</span></a> <span class='Operator'>== </span><a href="../../include/utils/guc.h.html#LN70"><span class='Ref_to_EnumConst'>PGC_POSTMASTER</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/guc.h.html#LN276"><span class='Ref_to_Proto'>SetConfigOption</span></a><span class='Parentheses'>(</span><span class='String'>"log_connections"</span><span class='Delimiter'>, </span><span class='String'>"true"</span><span class='Delimiter'>, </span><a href="postgres.c.html#LN3208"><span class='Ref_to_Parameter'>context</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN3208"><span class='Ref_to_Parameter'>source</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/guc.h.html#LN276"><span class='Ref_to_Proto'>SetConfigOption</span></a><span class='Parentheses'>(</span><span class='String'>"log_disconnections"</span><span class='Delimiter'>, </span><span class='String'>"true"</span><span class='Delimiter'>, </span><a href="postgres.c.html#LN3208"><span class='Ref_to_Parameter'>context</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN3208"><span class='Ref_to_Parameter'>source</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN3208"><span class='Ref_to_Parameter'>debug_flag</span></a> <span class='Operator'>&GT;= </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/guc.h.html#LN276"><span class='Ref_to_Proto'>SetConfigOption</span></a><span class='Parentheses'>(</span><span class='String'>"log_statement"</span><span class='Delimiter'>, </span><span class='String'>"all"</span><span class='Delimiter'>, </span><a href="postgres.c.html#LN3208"><span class='Ref_to_Parameter'>context</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN3208"><span class='Ref_to_Parameter'>source</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN3208"><span class='Ref_to_Parameter'>debug_flag</span></a> <span class='Operator'>&GT;= </span><span class='Number'>3</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/guc.h.html#LN276"><span class='Ref_to_Proto'>SetConfigOption</span></a><span class='Parentheses'>(</span><span class='String'>"debug_print_parse"</span><span class='Delimiter'>, </span><span class='String'>"true"</span><span class='Delimiter'>, </span><a href="postgres.c.html#LN3208"><span class='Ref_to_Parameter'>context</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN3208"><span class='Ref_to_Parameter'>source</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN3208"><span class='Ref_to_Parameter'>debug_flag</span></a> <span class='Operator'>&GT;= </span><span class='Number'>4</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/guc.h.html#LN276"><span class='Ref_to_Proto'>SetConfigOption</span></a><span class='Parentheses'>(</span><span class='String'>"debug_print_plan"</span><span class='Delimiter'>, </span><span class='String'>"true"</span><span class='Delimiter'>, </span><a href="postgres.c.html#LN3208"><span class='Ref_to_Parameter'>context</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN3208"><span class='Ref_to_Parameter'>source</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN3208"><span class='Ref_to_Parameter'>debug_flag</span></a> <span class='Operator'>&GT;= </span><span class='Number'>5</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/guc.h.html#LN276"><span class='Ref_to_Proto'>SetConfigOption</span></a><span class='Parentheses'>(</span><span class='String'>"debug_print_rewritten"</span><span class='Delimiter'>, </span><span class='String'>"true"</span><span class='Delimiter'>, </span><a href="postgres.c.html#LN3208"><span class='Ref_to_Parameter'>context</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN3208"><span class='Ref_to_Parameter'>source</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end set_debug_options &raquo; </span> 
 
 
<span class='Keyword'>bool 
</span><a name="LN3237"></a><span class='Declare_Function'>set_plan_disabling_options</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="../../include/utils/guc.h.html#LN67"><span class='Ref_to_Typedef'>GucContext</span></a> <span class='Declare_Parameter'>context</span><span class='Delimiter'>, </span><a href="../../include/utils/guc.h.html#LN104"><span class='Ref_to_Typedef'>GucSource</span></a> <span class='Declare_Parameter'>source</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3239"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>tmp</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN3237"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <span class='String'>'s'</span><span class='Operator'>:</span>               <span class='Comment_Single_Line'>/* seqscan */ 
</span>            <a href="postgres.c.html#LN3239"><span class='Ref_To_Local'>tmp</span></a> <span class='Operator'>= </span><span class='String'>"enable_seqscan"</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <span class='String'>'i'</span><span class='Operator'>:</span>               <span class='Comment_Single_Line'>/* indexscan */ 
</span>            <a href="postgres.c.html#LN3239"><span class='Ref_To_Local'>tmp</span></a> <span class='Operator'>= </span><span class='String'>"enable_indexscan"</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <span class='String'>'o'</span><span class='Operator'>:</span>               <span class='Comment_Single_Line'>/* indexonlyscan */ 
</span>            <a href="postgres.c.html#LN3239"><span class='Ref_To_Local'>tmp</span></a> <span class='Operator'>= </span><span class='String'>"enable_indexonlyscan"</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <span class='String'>'b'</span><span class='Operator'>:</span>               <span class='Comment_Single_Line'>/* bitmapscan */ 
</span>            <a href="postgres.c.html#LN3239"><span class='Ref_To_Local'>tmp</span></a> <span class='Operator'>= </span><span class='String'>"enable_bitmapscan"</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <span class='String'>'t'</span><span class='Operator'>:</span>               <span class='Comment_Single_Line'>/* tidscan */ 
</span>            <a href="postgres.c.html#LN3239"><span class='Ref_To_Local'>tmp</span></a> <span class='Operator'>= </span><span class='String'>"enable_tidscan"</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <span class='String'>'n'</span><span class='Operator'>:</span>               <span class='Comment_Single_Line'>/* nestloop */ 
</span>            <a href="postgres.c.html#LN3239"><span class='Ref_To_Local'>tmp</span></a> <span class='Operator'>= </span><span class='String'>"enable_nestloop"</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <span class='String'>'m'</span><span class='Operator'>:</span>               <span class='Comment_Single_Line'>/* mergejoin */ 
</span>            <a href="postgres.c.html#LN3239"><span class='Ref_To_Local'>tmp</span></a> <span class='Operator'>= </span><span class='String'>"enable_mergejoin"</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <span class='String'>'h'</span><span class='Operator'>:</span>               <span class='Comment_Single_Line'>/* hashjoin */ 
</span>            <a href="postgres.c.html#LN3239"><span class='Ref_To_Local'>tmp</span></a> <span class='Operator'>= </span><span class='String'>"enable_hashjoin"</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch arg[0] &raquo; </span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN3239"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/guc.h.html#LN276"><span class='Ref_to_Proto'>SetConfigOption</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN3239"><span class='Ref_To_Local'>tmp</span></a><span class='Delimiter'>, </span><span class='String'>"false"</span><span class='Delimiter'>, </span><a href="postgres.c.html#LN3237"><span class='Ref_to_Parameter'>context</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN3237"><span class='Ref_to_Parameter'>source</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end set_plan_disabling_options &raquo; </span> 
 
 
<span class='Keyword'>const char </span><span class='Operator'>* 
</span><a name="LN3279"></a><span class='Declare_Function'>get_stats_option_name</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN3279"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <span class='String'>'p'</span><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'a'</span><span class='Parentheses'>)</span>       <span class='Comment_Single_Line'>/* "parser" */ 
</span>                <span class='Control'>return</span> <span class='String'>"log_parser_stats"</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'l'</span><span class='Parentheses'>)</span>  <span class='Comment_Single_Line'>/* "planner" */ 
</span>                <span class='Control'>return</span> <span class='String'>"log_planner_stats"</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <span class='String'>'e'</span><span class='Operator'>:</span>               <span class='Comment_Single_Line'>/* "executor" */ 
</span>            <span class='Control'>return</span> <span class='String'>"log_executor_stats"</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------- 
 * process_postgres_switches 
 *     Parse command line arguments for PostgresMain 
 * 
 * This is called twice, once for the "secure" options coming from the 
 * postmaster or command line, and once for the "insecure" options coming 
 * from the client's startup packet.  The latter have the same syntax but 
 * may be restricted in what they can do. 
 * 
 * argv[0] is ignored in either case (it's assumed to be the program name). 
 * 
 * ctx is PGC_POSTMASTER for secure options, PGC_BACKEND for insecure options 
 * coming from the client, or PGC_SU_BACKEND for insecure options coming from 
 * a superuser client. 
 * 
 * If a database name is present in the command line arguments, it's 
 * returned into *dbname (this is allowed only if *dbname is initially NULL). 
 * ---------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN3319"></a><span class='Declare_Function'>process_postgres_switches</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>argc</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>argv</span><span class='Delimiter'>[], </span><a href="../../include/utils/guc.h.html#LN67"><span class='Ref_to_Typedef'>GucContext</span></a> <span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, 
</span><a name="LN3320"></a>                          <span class='Keyword'>const char </span><span class='Operator'>**</span><span class='Declare_Parameter'>dbname</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3322"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>secure</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="postgres.c.html#LN3319"><span class='Ref_to_Parameter'>ctx</span></a> <span class='Operator'>== </span><a href="../../include/utils/guc.h.html#LN70"><span class='Ref_to_EnumConst'>PGC_POSTMASTER</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3323"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>errs</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN3324"></a>    <a href="../../include/utils/guc.h.html#LN104"><span class='Ref_to_Typedef'>GucSource</span></a>   <span class='Declare_Local'>gucsource</span><span class='Delimiter'>; 
</span><a name="LN3325"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>flag</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN3322"><span class='Ref_To_Local'>secure</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="postgres.c.html#LN3324"><span class='Ref_To_Local'>gucsource</span></a> <span class='Operator'>= </span><a href="../../include/utils/guc.h.html#LN110"><span class='Ref_to_EnumConst'>PGC_S_ARGV</span></a><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* switches came from command line */ 
</span> 
        <span class='Comment_Multi_Line'>/* Ignore the initial --single argument, if present */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN3319"><span class='Ref_to_Parameter'>argc</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span> <span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="postgres.c.html#LN3319"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], </span><span class='String'>"--single"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="postgres.c.html#LN3319"><span class='Ref_to_Parameter'>argv</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <a href="postgres.c.html#LN3319"><span class='Ref_to_Parameter'>argc</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="postgres.c.html#LN3324"><span class='Ref_To_Local'>gucsource</span></a> <span class='Operator'>= </span><a href="../../include/utils/guc.h.html#LN115"><span class='Ref_to_EnumConst'>PGC_S_CLIENT</span></a><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* switches came from client */ 
</span>    <span class='Delimiter'>} 
</span> 
<span class='Directive'>#ifdef</span> HAVE_INT_OPTERR 
 
    <span class='Comment_Multi_Line'>/* 
     * Turn this off because it's either printed to stderr and not the log 
     * where we'd want it, or argv[0] is now "--single", which would make for 
     * a weird error message.  We print our own error message below. 
     */ 
</span>    <a href="../../port/getopt.c.html#LN49"><span class='Ref_to_Global_Var'>opterr</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Parse command-line options.  CAUTION: keep this in sync with 
     * postmaster/postmaster.c (the option sets should not conflict) and with 
     * the common help() function in main/main.c. 
     */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="postgres.c.html#LN3325"><span class='Ref_To_Local'>flag</span></a> <span class='Operator'>= </span><a href="../../include/pg_getopt.h.html#LN42"><span class='Ref_to_Proto'>getopt</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN3319"><span class='Ref_to_Parameter'>argc</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN3319"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>, </span><span class='String'>"B:bc:C:D:d:EeFf:h:ijk:lN:nOo:Pp:r:S:sTt:v:W:-:"</span><span class='Parentheses'>))</span> <span class='Operator'>!= -</span><span class='Number'>1</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN3325"><span class='Ref_To_Local'>flag</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <span class='String'>'B'</span><span class='Operator'>: 
</span>                <a href="../../include/utils/guc.h.html#LN276"><span class='Ref_to_Proto'>SetConfigOption</span></a><span class='Parentheses'>(</span><span class='String'>"shared_buffers"</span><span class='Delimiter'>, </span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN3319"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN3324"><span class='Ref_To_Local'>gucsource</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'b'</span><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* Undocumented flag used for binary upgrades */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN3322"><span class='Ref_To_Local'>secure</span></a><span class='Parentheses'>) 
</span>                    <a href="../utils/init/globals.c.html#LN101"><span class='Ref_to_Global_Var'>IsBinaryUpgrade</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'C'</span><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* ignored for consistency with the postmaster */ 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'D'</span><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN3322"><span class='Ref_To_Local'>secure</span></a><span class='Parentheses'>) 
</span>                    <a href="postgres.c.html#LN153"><span class='Ref_to_Global_Var'>userDoption</span></a> <span class='Operator'>= </span>strdup<span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'d'</span><span class='Operator'>: 
</span>                <a href="../../include/tcop/tcopprot.h.html#LN85"><span class='Ref_to_Proto'>set_debug_options</span></a><span class='Parentheses'>(</span>atoi<span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="postgres.c.html#LN3319"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN3324"><span class='Ref_To_Local'>gucsource</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'E'</span><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN3322"><span class='Ref_To_Local'>secure</span></a><span class='Parentheses'>) 
</span>                    <a href="postgres.c.html#LN154"><span class='Ref_to_Global_Var'>EchoQuery</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'e'</span><span class='Operator'>: 
</span>                <a href="../../include/utils/guc.h.html#LN276"><span class='Ref_to_Proto'>SetConfigOption</span></a><span class='Parentheses'>(</span><span class='String'>"datestyle"</span><span class='Delimiter'>, </span><span class='String'>"euro"</span><span class='Delimiter'>, </span><a href="postgres.c.html#LN3319"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN3324"><span class='Ref_To_Local'>gucsource</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'F'</span><span class='Operator'>: 
</span>                <a href="../../include/utils/guc.h.html#LN276"><span class='Ref_to_Proto'>SetConfigOption</span></a><span class='Parentheses'>(</span><span class='String'>"fsync"</span><span class='Delimiter'>, </span><span class='String'>"false"</span><span class='Delimiter'>, </span><a href="postgres.c.html#LN3319"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN3324"><span class='Ref_To_Local'>gucsource</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'f'</span><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/tcop/tcopprot.h.html#LN87"><span class='Ref_to_Proto'>set_plan_disabling_options</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN3319"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN3324"><span class='Ref_To_Local'>gucsource</span></a><span class='Parentheses'>))</span> 
                    <a href="postgres.c.html#LN3323"><span class='Ref_To_Local'>errs</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'h'</span><span class='Operator'>: 
</span>                <a href="../../include/utils/guc.h.html#LN276"><span class='Ref_to_Proto'>SetConfigOption</span></a><span class='Parentheses'>(</span><span class='String'>"listen_addresses"</span><span class='Delimiter'>, </span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN3319"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN3324"><span class='Ref_To_Local'>gucsource</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'i'</span><span class='Operator'>: 
</span>                <a href="../../include/utils/guc.h.html#LN276"><span class='Ref_to_Proto'>SetConfigOption</span></a><span class='Parentheses'>(</span><span class='String'>"listen_addresses"</span><span class='Delimiter'>, </span><span class='String'>"*"</span><span class='Delimiter'>, </span><a href="postgres.c.html#LN3319"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN3324"><span class='Ref_To_Local'>gucsource</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'j'</span><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN3322"><span class='Ref_To_Local'>secure</span></a><span class='Parentheses'>) 
</span>                    <a href="postgres.c.html#LN155"><span class='Ref_to_Global_Var'>UseSemiNewlineNewline</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'k'</span><span class='Operator'>: 
</span>                <a href="../../include/utils/guc.h.html#LN276"><span class='Ref_to_Proto'>SetConfigOption</span></a><span class='Parentheses'>(</span><span class='String'>"unix_socket_directories"</span><span class='Delimiter'>, </span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN3319"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN3324"><span class='Ref_To_Local'>gucsource</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'l'</span><span class='Operator'>: 
</span>                <a href="../../include/utils/guc.h.html#LN276"><span class='Ref_to_Proto'>SetConfigOption</span></a><span class='Parentheses'>(</span><span class='String'>"ssl"</span><span class='Delimiter'>, </span><span class='String'>"true"</span><span class='Delimiter'>, </span><a href="postgres.c.html#LN3319"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN3324"><span class='Ref_To_Local'>gucsource</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'N'</span><span class='Operator'>: 
</span>                <a href="../../include/utils/guc.h.html#LN276"><span class='Ref_to_Proto'>SetConfigOption</span></a><span class='Parentheses'>(</span><span class='String'>"max_connections"</span><span class='Delimiter'>, </span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN3319"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN3324"><span class='Ref_To_Local'>gucsource</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'n'</span><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* ignored for consistency with postmaster */ 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'O'</span><span class='Operator'>: 
</span>                <a href="../../include/utils/guc.h.html#LN276"><span class='Ref_to_Proto'>SetConfigOption</span></a><span class='Parentheses'>(</span><span class='String'>"allow_system_table_mods"</span><span class='Delimiter'>, </span><span class='String'>"true"</span><span class='Delimiter'>, </span><a href="postgres.c.html#LN3319"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN3324"><span class='Ref_To_Local'>gucsource</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'o'</span><span class='Operator'>: 
</span>                <a href="postgres.c.html#LN3323"><span class='Ref_To_Local'>errs</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'P'</span><span class='Operator'>: 
</span>                <a href="../../include/utils/guc.h.html#LN276"><span class='Ref_to_Proto'>SetConfigOption</span></a><span class='Parentheses'>(</span><span class='String'>"ignore_system_indexes"</span><span class='Delimiter'>, </span><span class='String'>"true"</span><span class='Delimiter'>, </span><a href="postgres.c.html#LN3319"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN3324"><span class='Ref_To_Local'>gucsource</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'p'</span><span class='Operator'>: 
</span>                <a href="../../include/utils/guc.h.html#LN276"><span class='Ref_to_Proto'>SetConfigOption</span></a><span class='Parentheses'>(</span><span class='String'>"port"</span><span class='Delimiter'>, </span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN3319"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN3324"><span class='Ref_To_Local'>gucsource</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'r'</span><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* send output (stdout and stderr) to the given file */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN3322"><span class='Ref_To_Local'>secure</span></a><span class='Parentheses'>) 
</span>                    <a href="../../port/strlcpy.c.html#LN43"><span class='Ref_to_Func'>strlcpy</span></a><span class='Parentheses'>(</span><a href="../utils/init/globals.c.html#LN61"><span class='Ref_to_Global_Var'>OutputFileName</span></a><span class='Delimiter'>, </span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Delimiter'>, </span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'S'</span><span class='Operator'>: 
</span>                <a href="../../include/utils/guc.h.html#LN276"><span class='Ref_to_Proto'>SetConfigOption</span></a><span class='Parentheses'>(</span><span class='String'>"work_mem"</span><span class='Delimiter'>, </span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN3319"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN3324"><span class='Ref_To_Local'>gucsource</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'s'</span><span class='Operator'>: 
</span>                <a href="../../include/utils/guc.h.html#LN276"><span class='Ref_to_Proto'>SetConfigOption</span></a><span class='Parentheses'>(</span><span class='String'>"log_statement_stats"</span><span class='Delimiter'>, </span><span class='String'>"true"</span><span class='Delimiter'>, </span><a href="postgres.c.html#LN3319"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN3324"><span class='Ref_To_Local'>gucsource</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'T'</span><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* ignored for consistency with the postmaster */ 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'t'</span><span class='Operator'>: 
</span>                <span class='Delimiter'>{ 
</span><a name="LN3468"></a>                    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>tmp</span> <span class='Operator'>= </span><a href="../../include/tcop/tcopprot.h.html#LN89"><span class='Ref_to_Proto'>get_stats_option_name</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN3468"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>) 
</span>                        <a href="../../include/utils/guc.h.html#LN276"><span class='Ref_to_Proto'>SetConfigOption</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN3468"><span class='Ref_To_Local'>tmp</span></a><span class='Delimiter'>, </span><span class='String'>"true"</span><span class='Delimiter'>, </span><a href="postgres.c.html#LN3319"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN3324"><span class='Ref_To_Local'>gucsource</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> 
                        <a href="postgres.c.html#LN3323"><span class='Ref_To_Local'>errs</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
            <span class='Control'>case</span> <span class='String'>'v'</span><span class='Operator'>: 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * -v is no longer used in normal operation, since 
                 * FrontendProtocol is already set before we get here. We keep 
                 * the switch only for possible use in standalone operation, 
                 * in case we ever support using normal FE/BE protocol with a 
                 * standalone backend. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN3322"><span class='Ref_To_Local'>secure</span></a><span class='Parentheses'>) 
</span>                    <a href="../utils/init/globals.c.html#LN26"><span class='Ref_to_Global_Var'>FrontendProtocol</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/libpq/pqcomm.h.html#LN112"><span class='Ref_to_Typedef'>ProtocolVersion</span></a><span class='Parentheses'>) </span>atoi<span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'W'</span><span class='Operator'>: 
</span>                <a href="../../include/utils/guc.h.html#LN276"><span class='Ref_to_Proto'>SetConfigOption</span></a><span class='Parentheses'>(</span><span class='String'>"post_auth_delay"</span><span class='Delimiter'>, </span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN3319"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN3324"><span class='Ref_To_Local'>gucsource</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'c'</span><span class='Operator'>: 
</span>            <span class='Control'>case</span> <span class='String'>'-'</span><span class='Operator'>: 
</span>                <span class='Delimiter'>{ 
</span><a name="LN3497"></a>                    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>name</span><span class='Delimiter'>, 
</span><a name="LN3498"></a>                               <span class='Operator'>*</span><span class='Declare_Local'>value</span><span class='Delimiter'>; 
</span> 
                    <a href="../../include/utils/guc.h.html#LN357"><span class='Ref_to_Proto'>ParseLongOption</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres.c.html#LN3497"><span class='Ref_To_Local'>name</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Keyword'>value</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN3325"><span class='Ref_To_Local'>flag</span></a> <span class='Operator'>== </span><span class='String'>'-'</span><span class='Parentheses'>) 
</span>                            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"--%s requires a value"</span><span class='Delimiter'>, 
</span>                                            <a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                        <span class='Control'>else</span> 
                            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"-c %s requires a value"</span><span class='Delimiter'>, 
</span>                                            <a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <a href="../../include/utils/guc.h.html#LN276"><span class='Ref_to_Proto'>SetConfigOption</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN3497"><span class='Ref_To_Local'>name</span></a><span class='Delimiter'>, </span><span class='Keyword'>value</span><span class='Delimiter'>, </span><a href="postgres.c.html#LN3319"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN3324"><span class='Ref_To_Local'>gucsource</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN3497"><span class='Ref_To_Local'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>) 
</span>                        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="postgres.c.html#LN3323"><span class='Ref_To_Local'>errs</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch flag &raquo; </span> 
 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN3323"><span class='Ref_To_Local'>errs</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while (flag=getopt(argc,arg... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Optional database name should be there only if *dbname is NULL. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postgres.c.html#LN3323"><span class='Ref_To_Local'>errs</span></a> <span class='Operator'>&& </span><a href="postgres.c.html#LN3320"><span class='Ref_to_Parameter'>dbname</span></a> <span class='Operator'>&& *</span><a href="postgres.c.html#LN3320"><span class='Ref_to_Parameter'>dbname</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="postgres.c.html#LN3319"><span class='Ref_to_Parameter'>argc</span></a> <span class='Operator'>- </span><a href="../../port/getopt.c.html#LN50"><span class='Ref_to_Global_Var'>optind</span></a> <span class='Operator'>&GT;= </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="postgres.c.html#LN3320"><span class='Ref_to_Parameter'>dbname</span></a> <span class='Operator'>= </span>strdup<span class='Parentheses'>(</span><a href="postgres.c.html#LN3319"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><a href="../../port/getopt.c.html#LN50"><span class='Ref_to_Global_Var'>optind</span></a><span class='Operator'>++</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN3323"><span class='Ref_To_Local'>errs</span></a> <span class='Operator'>|| </span><a href="postgres.c.html#LN3319"><span class='Ref_to_Parameter'>argc</span></a> <span class='Operator'>!= </span><a href="../../port/getopt.c.html#LN50"><span class='Ref_to_Global_Var'>optind</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN3323"><span class='Ref_To_Local'>errs</span></a><span class='Parentheses'>) 
</span>            <a href="../../port/getopt.c.html#LN50"><span class='Ref_to_Global_Var'>optind</span></a><span class='Operator'>--</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* complain about the previous argument */ 
</span> 
        <span class='Comment_Multi_Line'>/* spell the error message a bit differently depending on context */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/init/globals.c.html#LN100"><span class='Ref_to_Global_Var'>IsUnderPostmaster</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid command-line argument for server process: %s"</span><span class='Delimiter'>, </span><a href="postgres.c.html#LN3319"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><a href="../../port/getopt.c.html#LN50"><span class='Ref_to_Global_Var'>optind</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>              <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Try \"%s --help\" for more information."</span><span class='Delimiter'>, </span><a href="../../bin/pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"%s: invalid command-line argument: %s"</span><span class='Delimiter'>, 
</span>                            <a href="../../bin/pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN3319"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><a href="../../port/getopt.c.html#LN50"><span class='Ref_to_Global_Var'>optind</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>              <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Try \"%s --help\" for more information."</span><span class='Delimiter'>, </span><a href="../../bin/pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Reset getopt(3) library so that it will work correctly in subprocesses 
     * or when this function is called a second time with another array. 
     */ 
</span>    <a href="../../port/getopt.c.html#LN50"><span class='Ref_to_Global_Var'>optind</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span><span class='Directive'>#ifdef</span> HAVE_INT_OPTRESET 
    <a href="../../include/pg_getopt.h.html#LN38"><span class='Ref_to_Global_Var'>optreset</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>;</span>               <span class='Comment_Single_Line'>/* some systems need this too */ 
</span><span class='Directive'>#endif</span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end process_postgres_switches &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------- 
 * PostgresMain 
 *     postgres main loop -- all backends, interactive or otherwise start here 
 * 
 * argc/argv are the command line arguments to be used.  (When being forked 
 * by the postmaster, these are not the original argv array of the process.) 
 * dbname is the name of the database to connect to, or NULL if the database 
 * name should be extracted from the command line arguments or defaulted. 
 * username is the PostgreSQL user name to be used for the session. 
 * ---------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN3578"></a><span class='Declare_Function'>PostgresMain</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>argc</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>argv</span><span class='Delimiter'>[], 
</span><a name="LN3579"></a>             <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>dbname</span><span class='Delimiter'>, 
</span><a name="LN3580"></a>             <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>username</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3582"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>firstchar</span><span class='Delimiter'>; 
</span><a name="LN3583"></a>    <a href="../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>input_message</span><span class='Delimiter'>; 
</span><a name="LN3584"></a>    <a href="../../include/c.h.html#LN1087"><span class='Ref_to_Const'>sigjmp_buf</span></a>  <span class='Declare_Local'>local_sigjmp_buf</span><span class='Delimiter'>; 
</span><a name="LN3585"></a>    <span class='Keyword'>volatile bool </span><span class='Declare_Local'>send_ready_for_query</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span><a name="LN3586"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>disable_idle_in_transaction_timeout</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Initialize startup process environment if necessary. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../utils/init/globals.c.html#LN100"><span class='Ref_to_Global_Var'>IsUnderPostmaster</span></a><span class='Parentheses'>) 
</span>        <a href="../utils/init/miscinit.c.html#LN217"><span class='Ref_to_Func'>InitStandaloneProcess</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN3578"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/miscadmin.h.html#LN375"><span class='Ref_to_Macro'>SetProcessingMode</span></a><span class='Parentheses'>(</span><a href="../../include/miscadmin.h.html#LN363"><span class='Ref_to_EnumConst'>InitProcessing</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Set default values for command-line options. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../utils/init/globals.c.html#LN100"><span class='Ref_to_Global_Var'>IsUnderPostmaster</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/guc.h.html#LN350"><span class='Ref_to_Proto'>InitializeGUCOptions</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Parse command-line options. 
     */ 
</span>    <a href="../../include/tcop/tcopprot.h.html#LN76"><span class='Ref_to_Proto'>process_postgres_switches</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN3578"><span class='Ref_to_Parameter'>argc</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN3578"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>, </span><a href="../../include/utils/guc.h.html#LN70"><span class='Ref_to_EnumConst'>PGC_POSTMASTER</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres.c.html#LN3579"><span class='Ref_to_Parameter'>dbname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Must have gotten a database name, or have a default (the username) */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN3579"><span class='Ref_to_Parameter'>dbname</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="postgres.c.html#LN3579"><span class='Ref_to_Parameter'>dbname</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN3580"><span class='Ref_to_Parameter'>username</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN3579"><span class='Ref_to_Parameter'>dbname</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"%s: no database nor user name specified"</span><span class='Delimiter'>, 
</span>                            <a href="../../bin/pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Acquire configuration parameters, unless inherited from postmaster */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../utils/init/globals.c.html#LN100"><span class='Ref_to_Global_Var'>IsUnderPostmaster</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/guc.h.html#LN351"><span class='Ref_to_Proto'>SelectConfigFiles</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN153"><span class='Ref_to_Global_Var'>userDoption</span></a><span class='Delimiter'>, </span><a href="../../bin/pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>))</span> 
            <a href="../storage/ipc/ipc.c.html#LN97"><span class='Ref_to_Func'>proc_exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Set up signal handlers and masks. 
     * 
     * Note that postmaster blocked all signals before forking child process, 
     * so there is no race condition whereby we might receive a signal before 
     * we have set up the handler. 
     * 
     * Also note: it's best not to use any signals that are SIG_IGNored in the 
     * postmaster.  If such a signal arrives before we are able to change the 
     * handler to non-SIG_IGN, it'll get dropped.  Instead, make a dummy 
     * handler in the postmaster to reserve the signal. (Of course, this isn't 
     * an issue for signals that are locally generated, such as SIGALRM and 
     * SIGPIPE.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../replication/walsender.c.html#LN113"><span class='Ref_to_Global_Var'>am_walsender</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/replication/walsender.h.html#LN42"><span class='Ref_to_Proto'>WalSndSignals</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../port/pqsignal.c.html#LN38"><span class='Ref_to_Func'>pqsignal</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32.h.html#LN187"><span class='Ref_to_Const'>SIGHUP</span></a><span class='Delimiter'>, </span><a href="../../include/miscadmin.h.html#LN278"><span class='Ref_to_Proto'>PostgresSigHupHandler</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>        <span class='Comment_Multi_Line'>/* set flag to read 
                                                         * config file */ 
</span>        <a href="../../port/pqsignal.c.html#LN38"><span class='Ref_to_Func'>pqsignal</span></a><span class='Parentheses'>(</span>SIGINT<span class='Delimiter'>, </span><a href="../../include/tcop/tcopprot.h.html#LN69"><span class='Ref_to_Proto'>StatementCancelHandler</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* cancel current query */ 
</span>        <a href="../../port/pqsignal.c.html#LN38"><span class='Ref_to_Func'>pqsignal</span></a><span class='Parentheses'>(</span>SIGTERM<span class='Delimiter'>, </span><a href="../../include/tcop/tcopprot.h.html#LN67"><span class='Ref_to_Proto'>die</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* cancel current query and exit */ 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * In a standalone backend, SIGQUIT can be generated from the keyboard 
         * easily, while SIGTERM cannot, so we make both signals do die() 
         * rather than quickdie(). 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/init/globals.c.html#LN100"><span class='Ref_to_Global_Var'>IsUnderPostmaster</span></a><span class='Parentheses'>) 
</span>            <a href="../../port/pqsignal.c.html#LN38"><span class='Ref_to_Func'>pqsignal</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32.h.html#LN188"><span class='Ref_to_Const'>SIGQUIT</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN2554"><span class='Ref_to_Func'>quickdie</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* hard crash time */ 
</span>        <span class='Control'>else</span> 
            <a href="../../port/pqsignal.c.html#LN38"><span class='Ref_to_Func'>pqsignal</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32.h.html#LN188"><span class='Ref_to_Const'>SIGQUIT</span></a><span class='Delimiter'>, </span><a href="../../include/tcop/tcopprot.h.html#LN67"><span class='Ref_to_Proto'>die</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* cancel current query and exit */ 
</span>        <a href="../../include/utils/timeout.h.html#LN69"><span class='Ref_to_Proto'>InitializeTimeouts</span></a><span class='Parentheses'>()</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* establishes SIGALRM handler */ 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Ignore failure to write to frontend. Note: if frontend closes 
         * connection, we will notice it and exit cleanly when control next 
         * returns to outer loop.  This seems safer than forcing exit in the 
         * midst of output during who-knows-what operation... 
         */ 
</span>        <a href="../../port/pqsignal.c.html#LN38"><span class='Ref_to_Func'>pqsignal</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32.h.html#LN192"><span class='Ref_to_Const'>SIGPIPE</span></a><span class='Delimiter'>, </span><a href="../../include/port/win32.h.html#LN184"><span class='Ref_to_Const'>SIG_IGN</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../port/pqsignal.c.html#LN38"><span class='Ref_to_Func'>pqsignal</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32.h.html#LN201"><span class='Ref_to_Const'>SIGUSR1</span></a><span class='Delimiter'>, </span><a href="../../include/storage/procsignal.h.html#LN58"><span class='Ref_to_Proto'>procsignal_sigusr1_handler</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../port/pqsignal.c.html#LN38"><span class='Ref_to_Func'>pqsignal</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32.h.html#LN202"><span class='Ref_to_Const'>SIGUSR2</span></a><span class='Delimiter'>, </span><a href="../../include/port/win32.h.html#LN184"><span class='Ref_to_Const'>SIG_IGN</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../port/pqsignal.c.html#LN38"><span class='Ref_to_Func'>pqsignal</span></a><span class='Parentheses'>(</span>SIGFPE<span class='Delimiter'>, </span><a href="postgres.c.html#LN2667"><span class='Ref_to_Func'>FloatExceptionHandler</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Reset some signals that are accepted by postmaster but not by 
         * backend 
         */ 
</span>        <a href="../../port/pqsignal.c.html#LN38"><span class='Ref_to_Func'>pqsignal</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32.h.html#LN197"><span class='Ref_to_Const'>SIGCHLD</span></a><span class='Delimiter'>, </span><a href="../../include/port/win32.h.html#LN182"><span class='Ref_to_Const'>SIG_DFL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>     <span class='Comment_Multi_Line'>/* system() requires this on some 
                                         * platforms */ 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <a href="../../include/libpq/pqsignal.h.html#LN36"><span class='Ref_to_Proto'>pqinitmask</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/init/globals.c.html#LN100"><span class='Ref_to_Global_Var'>IsUnderPostmaster</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* We allow SIGQUIT (quickdie) at all times */ 
</span>        <a href="../../include/libpq/pqsignal.h.html#LN29"><span class='Ref_to_Macro'>sigdelset</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="../libpq/pqsignal.c.html#LN22"><span class='Ref_to_Global_Var'>BlockSig</span></a><span class='Delimiter'>, </span><a href="../../include/port/win32.h.html#LN188"><span class='Ref_to_Const'>SIGQUIT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/libpq/pqsignal.h.html#LN18"><span class='Ref_to_Macro'>PG_SETMASK</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="../libpq/pqsignal.c.html#LN22"><span class='Ref_to_Global_Var'>BlockSig</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* block everything except SIGQUIT */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../utils/init/globals.c.html#LN100"><span class='Ref_to_Global_Var'>IsUnderPostmaster</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Validate we have been given a reasonable-looking DataDir (if under 
         * postmaster, assume postmaster did this already). 
         */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../utils/init/globals.c.html#LN59"><span class='Ref_to_Global_Var'>DataDir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/miscadmin.h.html#LN464"><span class='Ref_to_Proto'>ValidatePgVersion</span></a><span class='Parentheses'>(</span><a href="../utils/init/globals.c.html#LN59"><span class='Ref_to_Global_Var'>DataDir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Change into DataDir (if under postmaster, was done already) */ 
</span>        <a href="../utils/init/miscinit.c.html#LN113"><span class='Ref_to_Func'>ChangeToDataDir</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Create lockfile for data directory. 
         */ 
</span>        <a href="../../include/miscadmin.h.html#LN458"><span class='Ref_to_Proto'>CreateDataDirLockFile</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Initialize MaxBackends (if under postmaster, was done already) */ 
</span>        <a href="../../include/miscadmin.h.html#LN421"><span class='Ref_to_Proto'>InitializeMaxBackends</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !IsUnderPostmaster &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Early initialization */ 
</span>    <a href="../../include/miscadmin.h.html#LN424"><span class='Ref_to_Proto'>BaseInit</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Create a per-backend PGPROC struct in shared memory, except in the 
     * EXEC_BACKEND case where this was done in SubPostmasterMain. We must do 
     * this before we can use LWLocks (and in the EXEC_BACKEND case we already 
     * had to do some stuff with LWLocks). 
     */ 
</span><span class='Directive'>#ifdef</span> EXEC_BACKEND 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../utils/init/globals.c.html#LN100"><span class='Ref_to_Global_Var'>IsUnderPostmaster</span></a><span class='Parentheses'>) 
</span>        <a href="../storage/lmgr/proc.c.html#LN285"><span class='Ref_to_Func'>InitProcess</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
    <a href="../storage/lmgr/proc.c.html#LN285"><span class='Ref_to_Func'>InitProcess</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <span class='Comment_Multi_Line'>/* We need to allow SIGINT, etc during the initial transaction */ 
</span>    <a href="../../include/libpq/pqsignal.h.html#LN18"><span class='Ref_to_Macro'>PG_SETMASK</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="../libpq/pqsignal.c.html#LN21"><span class='Ref_to_Global_Var'>UnBlockSig</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * General initialization. 
     * 
     * NOTE: if you are tempted to add code in this vicinity, consider putting 
     * it inside InitPostgres() instead.  In particular, anything that 
     * involves database access should be there, not here. 
     */ 
</span>    <a href="../../include/miscadmin.h.html#LN422"><span class='Ref_to_Proto'>InitPostgres</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN3579"><span class='Ref_to_Parameter'>dbname</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN3580"><span class='Ref_to_Parameter'>username</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the PostmasterContext is still around, recycle the space; we don't 
     * need it anymore after InitPostgres completes.  Note this does not trash 
     * *MyProcPort, because ConnCreate() allocated that space with malloc() 
     * ... else we'd need to copy the Port data first.  Also, subsidiary data 
     * such as the username isn't lost either; see ProcessStartupPacket(). 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN44"><span class='Ref_to_Global_Var'>PostmasterContext</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/memutils.h.html#LN74"><span class='Ref_to_Proto'>MemoryContextDelete</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN44"><span class='Ref_to_Global_Var'>PostmasterContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../utils/mmgr/mcxt.c.html#LN44"><span class='Ref_to_Global_Var'>PostmasterContext</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/miscadmin.h.html#LN375"><span class='Ref_to_Macro'>SetProcessingMode</span></a><span class='Parentheses'>(</span><a href="../../include/miscadmin.h.html#LN364"><span class='Ref_to_EnumConst'>NormalProcessing</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now all GUC states are fully set up.  Report them to client if 
     * appropriate. 
     */ 
</span>    <a href="../../include/utils/guc.h.html#LN356"><span class='Ref_to_Proto'>BeginReportingGUCOptions</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Also set up handler to log session end; we have to wait till now to be 
     * sure Log_disconnections has its final value. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/init/globals.c.html#LN100"><span class='Ref_to_Global_Var'>IsUnderPostmaster</span></a> <span class='Operator'>&& </span><a href="postgres.c.html#LN90"><span class='Ref_to_Global_Var'>Log_disconnections</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/storage/ipc.h.html#LN68"><span class='Ref_to_Proto'>on_proc_exit</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN183"><span class='Ref_to_Proto'>log_disconnections</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Perform initialization specific to a WAL sender process. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../replication/walsender.c.html#LN113"><span class='Ref_to_Global_Var'>am_walsender</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/replication/walsender.h.html#LN39"><span class='Ref_to_Proto'>InitWalSender</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * process any libraries that should be preloaded at backend start (this 
     * likewise can't be done until GUC settings are complete) 
     */ 
</span>    <a href="../../include/miscadmin.h.html#LN466"><span class='Ref_to_Proto'>process_session_preload_libraries</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Send this backend's cancellation info to the frontend. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN87"><span class='Ref_to_Global_Var'>whereToSendOutput</span></a> <span class='Operator'>== </span><a href="../../include/tcop/dest.h.html#LN89"><span class='Ref_to_EnumConst'>DestRemote</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3778"></a>        <a href="../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/libpq/pqformat.h.html#LN17"><span class='Ref_to_Proto'>pq_beginmessage</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres.c.html#LN3778"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>'K'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/libpq/pqformat.h.html#LN25"><span class='Ref_to_Proto'>pq_sendint</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres.c.html#LN3778"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>) </span><a href="../utils/init/globals.c.html#LN38"><span class='Ref_to_Global_Var'>MyProcPid</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../include/libpq/pqformat.h.html#LN25"><span class='Ref_to_Proto'>pq_sendint</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres.c.html#LN3778"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>) </span><a href="../utils/init/globals.c.html#LN41"><span class='Ref_to_Global_Var'>MyCancelKey</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../include/libpq/pqformat.h.html#LN29"><span class='Ref_to_Proto'>pq_endmessage</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres.c.html#LN3778"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Need not flush since ReadyForQuery will do it. */ 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Welcome banner for standalone case */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN87"><span class='Ref_to_Global_Var'>whereToSendOutput</span></a> <span class='Operator'>== </span><a href="../../include/tcop/dest.h.html#LN88"><span class='Ref_to_EnumConst'>DestDebug</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"\nPostgreSQL stand-alone backend %s\n"</span><span class='Delimiter'>, </span>PG_VERSION<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Create the memory context we will use in the main loop. 
     * 
     * MessageContext is reset once per iteration of the main loop, ie, upon 
     * completion of processing of each command message from the client. 
     */ 
</span>    <a href="../utils/mmgr/mcxt.c.html#LN46"><span class='Ref_to_Global_Var'>MessageContext</span></a> <span class='Operator'>= </span><a href="../../include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN42"><span class='Ref_to_Global_Var'>TopMemoryContext</span></a><span class='Delimiter'>, 
</span>                                           <span class='String'>"MessageContext"</span><span class='Delimiter'>, 
</span>                                           <a href="../../include/utils/memutils.h.html#LN164"><span class='Ref_to_Const'>ALLOCSET_DEFAULT_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Remember stand-alone backend startup time 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../utils/init/globals.c.html#LN100"><span class='Ref_to_Global_Var'>IsUnderPostmaster</span></a><span class='Parentheses'>) 
</span>        <a href="../utils/adt/timestamp.c.html#LN48"><span class='Ref_to_Global_Var'>PgStartTime</span></a> <span class='Operator'>= </span><a href="../../include/utils/timestamp.h.html#LN69"><span class='Ref_to_Proto'>GetCurrentTimestamp</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * POSTGRES main processing loop begins here 
     * 
     * If an exception is encountered, processing resumes here so we abort the 
     * current transaction and start a new one. 
     * 
     * You might wonder why this isn't coded as an infinite loop around a 
     * PG_TRY construct.  The reason is that this is the bottom of the 
     * exception stack, and so with PG_TRY there would be no exception handler 
     * in force at all during the CATCH part.  By leaving the outermost setjmp 
     * always active, we have at least some chance of recovering from an error 
     * during error recovery.  (If we get into an infinite loop thereby, it 
     * will soon be stopped by overflow of elog.c's internal state stack.) 
     * 
     * Note that we use sigsetjmp(..., 1), so that this function's signal mask 
     * (to wit, UnBlockSig) will be restored when longjmp'ing to here.  This 
     * is essential in case we longjmp'd out of a signal handler on a platform 
     * where that leaves the signal blocked.  It's not redundant with the 
     * unblock in AbortTransaction() because the latter is only called if we 
     * were inside a transaction. 
     */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN1088"><span class='Ref_to_Macro'>sigsetjmp</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN3584"><span class='Ref_To_Local'>local_sigjmp_buf</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * NOTE: if you are tempted to add more code in this if-block, 
         * consider the high probability that it should be in 
         * AbortTransaction() instead.  The only stuff done directly here 
         * should be stuff that is guaranteed to apply *only* for outer-level 
         * error recovery, such as adjusting the FE/BE protocol status. 
         */ 
</span> 
        <span class='Comment_Multi_Line'>/* Since not using PG_TRY, must reset error stack by hand */ 
</span>        <a href="../utils/error/elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Prevent interrupts while cleaning up */ 
</span>        <a href="../../include/miscadmin.h.html#LN116"><span class='Ref_to_Macro'>HOLD_INTERRUPTS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Forget any pending QueryCancel request, since we're returning to 
         * the idle loop anyway, and cancel any active timeout requests.  (In 
         * future we might want to allow some timeout requests to survive, but 
         * at minimum it'd be necessary to do reschedule_timeouts(), in case 
         * we got here because of a query cancel interrupting the SIGALRM 
         * interrupt handler.)  Note in particular that we must clear the 
         * statement and lock timeout indicators, to prevent any future plain 
         * query cancels from being misreported as timeouts in case we're 
         * forgetting a timeout cancel. 
         */ 
</span>        <a href="../../include/utils/timeout.h.html#LN79"><span class='Ref_to_Proto'>disable_all_timeouts</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../utils/init/globals.c.html#LN29"><span class='Ref_to_Global_Var'>QueryCancelPending</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* second to avoid race condition */ 
</span> 
        <span class='Comment_Multi_Line'>/* Not reading from the client anymore. */ 
</span>        <a href="postgres.c.html#LN136"><span class='Ref_to_Global_Var'>DoingCommandRead</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Make sure libpq is in a good state */ 
</span>        <a href="../../include/libpq/libpq.h.html#LN37"><span class='Ref_to_Macro'>pq_comm_reset</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Report the error to the client and/or server log */ 
</span>        <a href="../../include/utils/elog.h.html#LN362"><span class='Ref_to_Proto'>EmitErrorReport</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Make sure debug_query_string gets reset before we possibly clobber 
         * the storage it points at. 
         */ 
</span>        <a href="postgres.c.html#LN84"><span class='Ref_to_Global_Var'>debug_query_string</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Abort the current transaction in order to recover. 
         */ 
</span>        <a href="../../include/access/xact.h.html#LN350"><span class='Ref_to_Proto'>AbortCurrentTransaction</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../replication/walsender.c.html#LN113"><span class='Ref_to_Global_Var'>am_walsender</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/replication/walsender.h.html#LN41"><span class='Ref_to_Proto'>WalSndErrorCleanup</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We can't release replication slots inside AbortTransaction() as we 
         * need to be able to start and abort transactions while having a slot 
         * acquired. But we never need to hold them across top level errors, 
         * so releasing here is fine. There's another cleanup in ProcKill() 
         * ensuring we'll correctly cleanup on FATAL errors as well. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../replication/slot.c.html#LN95"><span class='Ref_to_Global_Var'>MyReplicationSlot</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="../../include/replication/slot.h.html#LN167"><span class='Ref_to_Proto'>ReplicationSlotRelease</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* We also want to cleanup temporary slots on error. */ 
</span>        <a href="../../include/replication/slot.h.html#LN168"><span class='Ref_to_Proto'>ReplicationSlotCleanup</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Now return to normal top-level context and clear ErrorContext for 
         * next time. 
         */ 
</span>        <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN42"><span class='Ref_to_Global_Var'>TopMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/elog.h.html#LN365"><span class='Ref_to_Proto'>FlushErrorState</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If we were handling an extended-query-protocol message, initiate 
         * skip till next Sync.  This also causes us not to issue 
         * ReadyForQuery (until we get Sync). 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN142"><span class='Ref_to_Global_Var'>doing_extended_query_message</span></a><span class='Parentheses'>) 
</span>            <a href="postgres.c.html#LN143"><span class='Ref_to_Global_Var'>ignore_till_sync</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* We don't have a transaction command open anymore */ 
</span>        <a href="postgres.c.html#LN129"><span class='Ref_to_Global_Var'>xact_started</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If an error occurred while we were reading a message from the 
         * client, we have potentially lost track of where the previous 
         * message ends and the next one begins.  Even though we have 
         * otherwise recovered from the error, we cannot safely read any more 
         * messages from the client, so there isn't much we can do with the 
         * connection anymore. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/libpq/libpq.h.html#LN67"><span class='Ref_to_Proto'>pq_is_reading_msg</span></a><span class='Parentheses'>())</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_PROTOCOL_VIOLATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"terminating connection because protocol synchronization was lost"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Now we can allow interrupts again */ 
</span>        <a href="../../include/miscadmin.h.html#LN118"><span class='Ref_to_Macro'>RESUME_INTERRUPTS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if sigsetjmp(local_sigjm... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* We can now handle ereport(ERROR) */ 
</span>    <a href="../utils/error/elog.c.html#LN89"><span class='Ref_to_Global_Var'>PG_exception_stack</span></a> <span class='Operator'>= &</span><a href="postgres.c.html#LN3584"><span class='Ref_To_Local'>local_sigjmp_buf</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postgres.c.html#LN143"><span class='Ref_to_Global_Var'>ignore_till_sync</span></a><span class='Parentheses'>) 
</span>        <a href="postgres.c.html#LN3585"><span class='Ref_To_Local'>send_ready_for_query</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* initially, or after error */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Non-error queries loop here. 
     */ 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * At top of loop, reset extended-query-message flag, so that any 
         * errors encountered in "idle" state don't provoke skip. 
         */ 
</span>        <a href="postgres.c.html#LN142"><span class='Ref_to_Global_Var'>doing_extended_query_message</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Release storage left over from prior query cycle, and create a new 
         * query input buffer in the cleared MessageContext. 
         */ 
</span>        <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN46"><span class='Ref_to_Global_Var'>MessageContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/memutils.h.html#LN66"><span class='Ref_to_Macro'>MemoryContextResetAndDeleteChildren</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN46"><span class='Ref_to_Global_Var'>MessageContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres.c.html#LN3583"><span class='Ref_To_Local'>input_message</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Also consider releasing our catalog snapshot if any, so that it's 
         * not preventing advance of global xmin while we wait for the client. 
         */ 
</span>        <a href="../../include/utils/snapmgr.h.html#LN71"><span class='Ref_to_Proto'>InvalidateCatalogSnapshotConditionally</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * (1) If we've reached idle state, tell the frontend we're ready for 
         * a new query. 
         * 
         * Note: this includes fflush()'ing the last of the prior output. 
         * 
         * This is also a good time to send collected statistics to the 
         * collector, and to update the PS stats display.  We avoid doing 
         * those every time through the message loop because it'd slow down 
         * processing of batched messages, and because we don't want to report 
         * uncommitted updates (that confuses autovacuum).  The notification 
         * processor wants a call too, if we are not in a transaction block. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN3585"><span class='Ref_To_Local'>send_ready_for_query</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/xact.h.html#LN330"><span class='Ref_to_Proto'>IsAbortedTransactionBlockState</span></a><span class='Parentheses'>())</span> 
            <span class='Delimiter'>{ 
</span>                <a href="../../include/utils/ps_status.h.html#LN21"><span class='Ref_to_Proto'>set_ps_display</span></a><span class='Parentheses'>(</span><span class='String'>"idle in transaction (aborted)"</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/pgstat.h.html#LN1168"><span class='Ref_to_Proto'>pgstat_report_activity</span></a><span class='Parentheses'>(</span><a href="../../include/pgstat.h.html#LN727"><span class='Ref_to_EnumConst'>STATE_IDLEINTRANSACTION_ABORTED</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Start the idle-in-transaction timer */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../storage/lmgr/proc.c.html#LN62"><span class='Ref_to_Global_Var'>IdleInTransactionSessionTimeout</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="postgres.c.html#LN3586"><span class='Ref_To_Local'>disable_idle_in_transaction_timeout</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                    <a href="../../include/utils/timeout.h.html#LN74"><span class='Ref_to_Proto'>enable_timeout_after</span></a><span class='Parentheses'>(</span><a href="../../include/utils/timeout.h.html#LN32"><span class='Ref_to_EnumConst'>IDLE_IN_TRANSACTION_SESSION_TIMEOUT</span></a><span class='Delimiter'>, 
</span>                                         <a href="../storage/lmgr/proc.c.html#LN62"><span class='Ref_to_Global_Var'>IdleInTransactionSessionTimeout</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/xact.h.html#LN367"><span class='Ref_to_Proto'>IsTransactionOrTransactionBlock</span></a><span class='Parentheses'>())</span> 
            <span class='Delimiter'>{ 
</span>                <a href="../../include/utils/ps_status.h.html#LN21"><span class='Ref_to_Proto'>set_ps_display</span></a><span class='Parentheses'>(</span><span class='String'>"idle in transaction"</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/pgstat.h.html#LN1168"><span class='Ref_to_Proto'>pgstat_report_activity</span></a><span class='Parentheses'>(</span><a href="../../include/pgstat.h.html#LN725"><span class='Ref_to_EnumConst'>STATE_IDLEINTRANSACTION</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Start the idle-in-transaction timer */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../storage/lmgr/proc.c.html#LN62"><span class='Ref_to_Global_Var'>IdleInTransactionSessionTimeout</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="postgres.c.html#LN3586"><span class='Ref_To_Local'>disable_idle_in_transaction_timeout</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                    <a href="../../include/utils/timeout.h.html#LN74"><span class='Ref_to_Proto'>enable_timeout_after</span></a><span class='Parentheses'>(</span><a href="../../include/utils/timeout.h.html#LN32"><span class='Ref_to_EnumConst'>IDLE_IN_TRANSACTION_SESSION_TIMEOUT</span></a><span class='Delimiter'>, 
</span>                                         <a href="../storage/lmgr/proc.c.html#LN62"><span class='Ref_to_Global_Var'>IdleInTransactionSessionTimeout</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="../../include/commands/async.h.html#LN48"><span class='Ref_to_Proto'>ProcessCompletedNotifies</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>                <a href="../postmaster/pgstat.c.html#LN810"><span class='Ref_to_Func'>pgstat_report_stat</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="../../include/utils/ps_status.h.html#LN21"><span class='Ref_to_Proto'>set_ps_display</span></a><span class='Parentheses'>(</span><span class='String'>"idle"</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/pgstat.h.html#LN1168"><span class='Ref_to_Proto'>pgstat_report_activity</span></a><span class='Parentheses'>(</span><a href="../../include/pgstat.h.html#LN723"><span class='Ref_to_EnumConst'>STATE_IDLE</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="../../include/tcop/dest.h.html#LN142"><span class='Ref_to_Proto'>ReadyForQuery</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN87"><span class='Ref_to_Global_Var'>whereToSendOutput</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="postgres.c.html#LN3585"><span class='Ref_To_Local'>send_ready_for_query</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if send_ready_for_query &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* 
         * (2) Allow asynchronous signals to be executed immediately if they 
         * come in while we are waiting for client input. (This must be 
         * conditional since we don't want, say, reads on behalf of COPY FROM 
         * STDIN doing the same thing.) 
         */ 
</span>        <a href="postgres.c.html#LN136"><span class='Ref_to_Global_Var'>DoingCommandRead</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * (3) read a command (loop blocks here) 
         */ 
</span>        <a href="postgres.c.html#LN3582"><span class='Ref_To_Local'>firstchar</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN169"><span class='Ref_to_Proto'>ReadCommand</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres.c.html#LN3583"><span class='Ref_To_Local'>input_message</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * (4) disable async signal conditions again. 
         * 
         * Query cancel is supposed to be a no-op when there is no query in 
         * progress, so if a query cancel arrived while we were idle, just 
         * reset QueryCancelPending. ProcessInterrupts() has that effect when 
         * it's called when DoingCommandRead is set, so check for interrupts 
         * before resetting DoingCommandRead. 
         */ 
</span>        <a href="../../include/miscadmin.h.html#LN99"><span class='Ref_to_Macro'>CHECK_FOR_INTERRUPTS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <a href="postgres.c.html#LN136"><span class='Ref_to_Global_Var'>DoingCommandRead</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * (5) turn off the idle-in-transaction timeout 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN3586"><span class='Ref_To_Local'>disable_idle_in_transaction_timeout</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/timeout.h.html#LN77"><span class='Ref_to_Proto'>disable_timeout</span></a><span class='Parentheses'>(</span><a href="../../include/utils/timeout.h.html#LN32"><span class='Ref_to_EnumConst'>IDLE_IN_TRANSACTION_SESSION_TIMEOUT</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="postgres.c.html#LN3586"><span class='Ref_To_Local'>disable_idle_in_transaction_timeout</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * (6) check for any other interesting events that happened while we 
         * slept. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/init/globals.c.html#LN33"><span class='Ref_to_Global_Var'>ConfigReloadPending</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../utils/init/globals.c.html#LN33"><span class='Ref_to_Global_Var'>ConfigReloadPending</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="../utils/misc/guc-file.l.html#LN107"><span class='Ref_to_Func'>ProcessConfigFile</span></a><span class='Parentheses'>(</span><a href="../../include/utils/guc.h.html#LN71"><span class='Ref_to_EnumConst'>PGC_SIGHUP</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * (7) process the command.  But ignore it if we're skipping till 
         * Sync. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN143"><span class='Ref_to_Global_Var'>ignore_till_sync</span></a> <span class='Operator'>&& </span><a href="postgres.c.html#LN3582"><span class='Ref_To_Local'>firstchar</span></a> <span class='Operator'>!= </span>EOF<span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN3582"><span class='Ref_To_Local'>firstchar</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <span class='String'>'Q'</span><span class='Operator'>:</span>           <span class='Comment_Single_Line'>/* simple query */ 
</span>                <span class='Delimiter'>{ 
</span><a name="LN4072"></a>                    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>query_string</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* Set statement_timestamp() */ 
</span>                    <a href="../../include/access/xact.h.html#LN343"><span class='Ref_to_Proto'>SetCurrentStatementStartTimestamp</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
                    <a href="postgres.c.html#LN4072"><span class='Ref_To_Local'>query_string</span></a> <span class='Operator'>= </span><a href="../../include/libpq/pqformat.h.html#LN45"><span class='Ref_to_Proto'>pq_getmsgstring</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres.c.html#LN3583"><span class='Ref_To_Local'>input_message</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../include/libpq/pqformat.h.html#LN47"><span class='Ref_to_Proto'>pq_getmsgend</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres.c.html#LN3583"><span class='Ref_To_Local'>input_message</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../replication/walsender.c.html#LN113"><span class='Ref_to_Global_Var'>am_walsender</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/replication/walsender.h.html#LN40"><span class='Ref_to_Proto'>exec_replication_command</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN4072"><span class='Ref_To_Local'>query_string</span></a><span class='Parentheses'>))</span> 
                            <a href="postgres.c.html#LN876"><span class='Ref_to_Func'>exec_simple_query</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN4072"><span class='Ref_To_Local'>query_string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> 
                        <a href="postgres.c.html#LN876"><span class='Ref_to_Func'>exec_simple_query</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN4072"><span class='Ref_To_Local'>query_string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <a href="postgres.c.html#LN3585"><span class='Ref_To_Local'>send_ready_for_query</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'P'</span><span class='Operator'>:</span>           <span class='Comment_Single_Line'>/* parse */ 
</span>                <span class='Delimiter'>{ 
</span><a name="LN4094"></a>                    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>stmt_name</span><span class='Delimiter'>; 
</span><a name="LN4095"></a>                    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>query_string</span><span class='Delimiter'>; 
</span><a name="LN4096"></a>                    <span class='Keyword'>int</span>         <span class='Declare_Local'>numParams</span><span class='Delimiter'>; 
</span><a name="LN4097"></a>                    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>paramTypes</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
                    <a href="postgres.c.html#LN170"><span class='Ref_to_Proto'>forbidden_in_wal_sender</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN3582"><span class='Ref_To_Local'>firstchar</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* Set statement_timestamp() */ 
</span>                    <a href="../../include/access/xact.h.html#LN343"><span class='Ref_to_Proto'>SetCurrentStatementStartTimestamp</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
                    <a href="postgres.c.html#LN4094"><span class='Ref_To_Local'>stmt_name</span></a> <span class='Operator'>= </span><a href="../../include/libpq/pqformat.h.html#LN45"><span class='Ref_to_Proto'>pq_getmsgstring</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres.c.html#LN3583"><span class='Ref_To_Local'>input_message</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="postgres.c.html#LN4095"><span class='Ref_To_Local'>query_string</span></a> <span class='Operator'>= </span><a href="../../include/libpq/pqformat.h.html#LN45"><span class='Ref_to_Proto'>pq_getmsgstring</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres.c.html#LN3583"><span class='Ref_To_Local'>input_message</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="postgres.c.html#LN4096"><span class='Ref_To_Local'>numParams</span></a> <span class='Operator'>= </span><a href="../../include/libpq/pqformat.h.html#LN38"><span class='Ref_to_Proto'>pq_getmsgint</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres.c.html#LN3583"><span class='Ref_To_Local'>input_message</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN4096"><span class='Ref_To_Local'>numParams</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span><a name="LN4109"></a>                        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
                        <a href="postgres.c.html#LN4097"><span class='Ref_To_Local'>paramTypes</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN4096"><span class='Ref_To_Local'>numParams</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN4109"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="postgres.c.html#LN4109"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="postgres.c.html#LN4096"><span class='Ref_To_Local'>numParams</span></a><span class='Delimiter'>; </span><a href="postgres.c.html#LN4109"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                            <a href="postgres.c.html#LN4097"><span class='Ref_To_Local'>paramTypes</span></a><span class='Delimiter'>[</span><a href="postgres.c.html#LN4109"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/libpq/pqformat.h.html#LN38"><span class='Ref_to_Proto'>pq_getmsgint</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres.c.html#LN3583"><span class='Ref_To_Local'>input_message</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <a href="../../include/libpq/pqformat.h.html#LN47"><span class='Ref_to_Proto'>pq_getmsgend</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres.c.html#LN3583"><span class='Ref_To_Local'>input_message</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <a href="postgres.c.html#LN1193"><span class='Ref_to_Func'>exec_parse_message</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN4095"><span class='Ref_To_Local'>query_string</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN4094"><span class='Ref_To_Local'>stmt_name</span></a><span class='Delimiter'>, 
</span>                                       <a href="postgres.c.html#LN4097"><span class='Ref_To_Local'>paramTypes</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN4096"><span class='Ref_To_Local'>numParams</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'B'</span><span class='Operator'>:</span>           <span class='Comment_Single_Line'>/* bind */ 
</span>                <a href="postgres.c.html#LN170"><span class='Ref_to_Proto'>forbidden_in_wal_sender</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN3582"><span class='Ref_To_Local'>firstchar</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Set statement_timestamp() */ 
</span>                <a href="../../include/access/xact.h.html#LN343"><span class='Ref_to_Proto'>SetCurrentStatementStartTimestamp</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * this message is complex enough that it seems best to put 
                 * the field extraction out-of-line 
                 */ 
</span>                <a href="postgres.c.html#LN1455"><span class='Ref_to_Func'>exec_bind_message</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres.c.html#LN3583"><span class='Ref_To_Local'>input_message</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'E'</span><span class='Operator'>:</span>           <span class='Comment_Single_Line'>/* execute */ 
</span>                <span class='Delimiter'>{ 
</span><a name="LN4137"></a>                    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>portal_name</span><span class='Delimiter'>; 
</span><a name="LN4138"></a>                    <span class='Keyword'>int</span>         <span class='Declare_Local'>max_rows</span><span class='Delimiter'>; 
</span> 
                    <a href="postgres.c.html#LN170"><span class='Ref_to_Proto'>forbidden_in_wal_sender</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN3582"><span class='Ref_To_Local'>firstchar</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* Set statement_timestamp() */ 
</span>                    <a href="../../include/access/xact.h.html#LN343"><span class='Ref_to_Proto'>SetCurrentStatementStartTimestamp</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
                    <a href="postgres.c.html#LN4137"><span class='Ref_To_Local'>portal_name</span></a> <span class='Operator'>= </span><a href="../../include/libpq/pqformat.h.html#LN45"><span class='Ref_to_Proto'>pq_getmsgstring</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres.c.html#LN3583"><span class='Ref_To_Local'>input_message</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="postgres.c.html#LN4138"><span class='Ref_To_Local'>max_rows</span></a> <span class='Operator'>= </span><a href="../../include/libpq/pqformat.h.html#LN38"><span class='Ref_to_Proto'>pq_getmsgint</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres.c.html#LN3583"><span class='Ref_To_Local'>input_message</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../include/libpq/pqformat.h.html#LN47"><span class='Ref_to_Proto'>pq_getmsgend</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres.c.html#LN3583"><span class='Ref_To_Local'>input_message</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <a href="postgres.c.html#LN1838"><span class='Ref_to_Func'>exec_execute_message</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN4137"><span class='Ref_To_Local'>portal_name</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN4138"><span class='Ref_To_Local'>max_rows</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'F'</span><span class='Operator'>:</span>           <span class='Comment_Single_Line'>/* fastpath function call */ 
</span>                <a href="postgres.c.html#LN170"><span class='Ref_to_Proto'>forbidden_in_wal_sender</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN3582"><span class='Ref_To_Local'>firstchar</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Set statement_timestamp() */ 
</span>                <a href="../../include/access/xact.h.html#LN343"><span class='Ref_to_Proto'>SetCurrentStatementStartTimestamp</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Report query to various monitoring facilities. */ 
</span>                <a href="../../include/pgstat.h.html#LN1168"><span class='Ref_to_Proto'>pgstat_report_activity</span></a><span class='Parentheses'>(</span><a href="../../include/pgstat.h.html#LN726"><span class='Ref_to_EnumConst'>STATE_FASTPATH</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/utils/ps_status.h.html#LN21"><span class='Ref_to_Proto'>set_ps_display</span></a><span class='Parentheses'>(</span><span class='String'>"&LT;FASTPATH&GT;"</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* start an xact for this function invocation */ 
</span>                <a href="postgres.c.html#LN177"><span class='Ref_to_Proto'>start_xact_command</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Note: we may at this point be inside an aborted 
                 * transaction.  We can't throw error for that until we've 
                 * finished reading the function-call message, so 
                 * HandleFunctionRequest() must check for it after doing so. 
                 * Be careful not to do anything that assumes we're inside a 
                 * valid transaction here. 
                 */ 
</span> 
                <span class='Comment_Multi_Line'>/* switch back to message context */ 
</span>                <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN46"><span class='Ref_to_Global_Var'>MessageContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="../../include/tcop/fastpath.h.html#LN18"><span class='Ref_to_Proto'>HandleFunctionRequest</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres.c.html#LN3583"><span class='Ref_To_Local'>input_message</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* commit the function-invocation transaction */ 
</span>                <a href="postgres.c.html#LN178"><span class='Ref_to_Proto'>finish_xact_command</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
                <a href="postgres.c.html#LN3585"><span class='Ref_To_Local'>send_ready_for_query</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'C'</span><span class='Operator'>:</span>           <span class='Comment_Single_Line'>/* close */ 
</span>                <span class='Delimiter'>{ 
</span><a name="LN4188"></a>                    <span class='Keyword'>int</span>         <span class='Declare_Local'>close_type</span><span class='Delimiter'>; 
</span><a name="LN4189"></a>                    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>close_target</span><span class='Delimiter'>; 
</span> 
                    <a href="postgres.c.html#LN170"><span class='Ref_to_Proto'>forbidden_in_wal_sender</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN3582"><span class='Ref_To_Local'>firstchar</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <a href="postgres.c.html#LN4188"><span class='Ref_To_Local'>close_type</span></a> <span class='Operator'>= </span><a href="../../include/libpq/pqformat.h.html#LN37"><span class='Ref_to_Proto'>pq_getmsgbyte</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres.c.html#LN3583"><span class='Ref_To_Local'>input_message</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="postgres.c.html#LN4189"><span class='Ref_To_Local'>close_target</span></a> <span class='Operator'>= </span><a href="../../include/libpq/pqformat.h.html#LN45"><span class='Ref_to_Proto'>pq_getmsgstring</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres.c.html#LN3583"><span class='Ref_To_Local'>input_message</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../include/libpq/pqformat.h.html#LN47"><span class='Ref_to_Proto'>pq_getmsgend</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres.c.html#LN3583"><span class='Ref_To_Local'>input_message</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN4188"><span class='Ref_To_Local'>close_type</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>case</span> <span class='String'>'S'</span><span class='Operator'>: 
</span>                            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN4189"><span class='Ref_To_Local'>close_target</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>                                <a href="../../include/commands/prepare.h.html#LN53"><span class='Ref_to_Proto'>DropPreparedStatement</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN4189"><span class='Ref_To_Local'>close_target</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Control'>else</span> 
                            <span class='Delimiter'>{ 
</span>                                <span class='Comment_Multi_Line'>/* special-case the unnamed statement */ 
</span>                                <a href="postgres.c.html#LN182"><span class='Ref_to_Proto'>drop_unnamed_stmt</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>                            <span class='Delimiter'>} 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span>                        <span class='Control'>case</span> <span class='String'>'P'</span><span class='Operator'>: 
</span>                            <span class='Delimiter'>{ 
</span><a name="LN4210"></a>                                <a href="../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a>      <span class='Declare_Local'>portal</span><span class='Delimiter'>; 
</span> 
                                <a href="postgres.c.html#LN4210"><span class='Ref_To_Local'>portal</span></a> <span class='Operator'>= </span><a href="../utils/mmgr/portalmem.c.html#LN127"><span class='Ref_to_Func'>GetPortalByName</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN4189"><span class='Ref_To_Local'>close_target</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/portal.h.html#LN198"><span class='Ref_to_Macro'>PortalIsValid</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN4210"><span class='Ref_To_Local'>portal</span></a><span class='Parentheses'>))</span> 
                                    <a href="../../include/utils/portal.h.html#LN227"><span class='Ref_to_Proto'>PortalDrop</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN4210"><span class='Ref_To_Local'>portal</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Delimiter'>} 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span>                        <span class='Control'>default</span><span class='Operator'>: 
</span>                            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_PROTOCOL_VIOLATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                   <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid CLOSE message subtype %d"</span><span class='Delimiter'>, 
</span>                                          <a href="postgres.c.html#LN4188"><span class='Ref_To_Local'>close_type</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch close_type &raquo; </span> 
 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN87"><span class='Ref_to_Global_Var'>whereToSendOutput</span></a> <span class='Operator'>== </span><a href="../../include/tcop/dest.h.html#LN89"><span class='Ref_to_EnumConst'>DestRemote</span></a><span class='Parentheses'>) 
</span>                        <a href="../../include/libpq/pqformat.h.html#LN35"><span class='Ref_to_Proto'>pq_putemptymessage</span></a><span class='Parentheses'>(</span><span class='String'>'3'</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* CloseComplete */ 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'D'</span><span class='Operator'>:</span>           <span class='Comment_Single_Line'>/* describe */ 
</span>                <span class='Delimiter'>{ 
</span><a name="LN4232"></a>                    <span class='Keyword'>int</span>         <span class='Declare_Local'>describe_type</span><span class='Delimiter'>; 
</span><a name="LN4233"></a>                    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>describe_target</span><span class='Delimiter'>; 
</span> 
                    <a href="postgres.c.html#LN170"><span class='Ref_to_Proto'>forbidden_in_wal_sender</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN3582"><span class='Ref_To_Local'>firstchar</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* Set statement_timestamp() (needed for xact) */ 
</span>                    <a href="../../include/access/xact.h.html#LN343"><span class='Ref_to_Proto'>SetCurrentStatementStartTimestamp</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
                    <a href="postgres.c.html#LN4232"><span class='Ref_To_Local'>describe_type</span></a> <span class='Operator'>= </span><a href="../../include/libpq/pqformat.h.html#LN37"><span class='Ref_to_Proto'>pq_getmsgbyte</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres.c.html#LN3583"><span class='Ref_To_Local'>input_message</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="postgres.c.html#LN4233"><span class='Ref_To_Local'>describe_target</span></a> <span class='Operator'>= </span><a href="../../include/libpq/pqformat.h.html#LN45"><span class='Ref_to_Proto'>pq_getmsgstring</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres.c.html#LN3583"><span class='Ref_To_Local'>input_message</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../include/libpq/pqformat.h.html#LN47"><span class='Ref_to_Proto'>pq_getmsgend</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres.c.html#LN3583"><span class='Ref_To_Local'>input_message</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN4232"><span class='Ref_To_Local'>describe_type</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>case</span> <span class='String'>'S'</span><span class='Operator'>: 
</span>                            <a href="postgres.c.html#LN2288"><span class='Ref_to_Func'>exec_describe_statement_message</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN4233"><span class='Ref_To_Local'>describe_target</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span>                        <span class='Control'>case</span> <span class='String'>'P'</span><span class='Operator'>: 
</span>                            <a href="postgres.c.html#LN2381"><span class='Ref_to_Func'>exec_describe_portal_message</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN4233"><span class='Ref_To_Local'>describe_target</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span>                        <span class='Control'>default</span><span class='Operator'>: 
</span>                            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_PROTOCOL_VIOLATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid DESCRIBE message subtype %d"</span><span class='Delimiter'>, 
</span>                                       <a href="postgres.c.html#LN4232"><span class='Ref_To_Local'>describe_type</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'H'</span><span class='Operator'>:</span>           <span class='Comment_Single_Line'>/* flush */ 
</span>                <a href="../../include/libpq/pqformat.h.html#LN47"><span class='Ref_to_Proto'>pq_getmsgend</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres.c.html#LN3583"><span class='Ref_To_Local'>input_message</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN87"><span class='Ref_to_Global_Var'>whereToSendOutput</span></a> <span class='Operator'>== </span><a href="../../include/tcop/dest.h.html#LN89"><span class='Ref_to_EnumConst'>DestRemote</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/libpq/libpq.h.html#LN38"><span class='Ref_to_Macro'>pq_flush</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'S'</span><span class='Operator'>:</span>           <span class='Comment_Single_Line'>/* sync */ 
</span>                <a href="../../include/libpq/pqformat.h.html#LN47"><span class='Ref_to_Proto'>pq_getmsgend</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres.c.html#LN3583"><span class='Ref_To_Local'>input_message</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="postgres.c.html#LN178"><span class='Ref_to_Proto'>finish_xact_command</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>                <a href="postgres.c.html#LN3585"><span class='Ref_To_Local'>send_ready_for_query</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * 'X' means that the frontend is closing down the socket. EOF 
                 * means unexpected loss of frontend connection. Either way, 
                 * perform normal shutdown. 
                 */ 
</span>            <span class='Control'>case</span> <span class='String'>'X'</span><span class='Operator'>: 
</span>            <span class='Control'>case</span> EOF<span class='Operator'>: 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Reset whereToSendOutput to prevent ereport from attempting 
                 * to send any more messages to client. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN87"><span class='Ref_to_Global_Var'>whereToSendOutput</span></a> <span class='Operator'>== </span><a href="../../include/tcop/dest.h.html#LN89"><span class='Ref_to_EnumConst'>DestRemote</span></a><span class='Parentheses'>) 
</span>                    <a href="postgres.c.html#LN87"><span class='Ref_to_Global_Var'>whereToSendOutput</span></a> <span class='Operator'>= </span><a href="../../include/tcop/dest.h.html#LN87"><span class='Ref_to_EnumConst'>DestNone</span></a><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * NOTE: if you are tempted to add more code here, DON'T! 
                 * Whatever you had in mind to do should be set up as an 
                 * on_proc_exit or on_shmem_exit callback, instead. Otherwise 
                 * it will fail to be called during other backend-shutdown 
                 * scenarios. 
                 */ 
</span>                <a href="../storage/ipc/ipc.c.html#LN97"><span class='Ref_to_Func'>proc_exit</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'d'</span><span class='Operator'>:</span>           <span class='Comment_Single_Line'>/* copy data */ 
</span>            <span class='Control'>case</span> <span class='String'>'c'</span><span class='Operator'>:</span>           <span class='Comment_Single_Line'>/* copy done */ 
</span>            <span class='Control'>case</span> <span class='String'>'f'</span><span class='Operator'>:</span>           <span class='Comment_Single_Line'>/* copy fail */ 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Accept but ignore these messages, per protocol spec; we 
                 * probably got here because a COPY failed, and the frontend 
                 * is still sending data. 
                 */ 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_PROTOCOL_VIOLATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid frontend message type %d"</span><span class='Delimiter'>, 
</span>                                <a href="postgres.c.html#LN3582"><span class='Ref_To_Local'>firstchar</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch firstchar &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span>                           <span class='Comment_Single_Line'>/* end of input-reading loop */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end PostgresMain &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Throw an error if we're a WAL sender process. 
 * 
 * This is used to forbid anything else than simple query protocol messages 
 * in a WAL sender process.  'firstchar' specifies what kind of a forbidden 
 * message was received, and is used to construct the error message. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN4326"></a><span class='Declare_Function'>forbidden_in_wal_sender</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Declare_Parameter'>firstchar</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../replication/walsender.c.html#LN113"><span class='Ref_to_Global_Var'>am_walsender</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN4326"><span class='Ref_to_Parameter'>firstchar</span></a> <span class='Operator'>== </span><span class='String'>'F'</span><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_PROTOCOL_VIOLATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"fastpath function calls not supported in a replication connection"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_PROTOCOL_VIOLATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"extended query protocol not supported in a replication connection"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Obtain platform stack depth limit (in bytes) 
 * 
 * Return -1 if unknown 
 */ 
</span><span class='Keyword'>long 
</span><a name="LN4348"></a><span class='Declare_Function'>get_stack_depth_rlimit</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><span class='Directive'>#if</span> defined<span class='Parentheses'>(</span>HAVE_GETRLIMIT<span class='Parentheses'>) </span><span class='Operator'>&& </span>defined<span class='Parentheses'>(</span>RLIMIT_STACK<span class='Parentheses'>) 
</span><a name="LN4351"></a>    <span class='Keyword'>static long </span><span class='Declare_Local'>val</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* This won't change after process launch, so check just once */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN4351"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4356"></a>        <span class='Control'>struct</span> rlimit <span class='Declare_Local'>rlim</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>getrlimit<span class='Parentheses'>(</span>RLIMIT_STACK<span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres.c.html#LN4356"><span class='Ref_To_Local'>rlim</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="postgres.c.html#LN4351"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN4356"><span class='Ref_To_Local'>rlim</span></a><span class='Operator'>.</span>rlim_cur <span class='Operator'>== </span>RLIM_INFINITY<span class='Parentheses'>) 
</span>            <a href="postgres.c.html#LN4351"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span>LONG_MAX<span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* rlim_cur is probably of an unsigned type, so check for overflow */ 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN4356"><span class='Ref_To_Local'>rlim</span></a><span class='Operator'>.</span>rlim_cur <span class='Operator'>&GT;= </span>LONG_MAX<span class='Parentheses'>) 
</span>            <a href="postgres.c.html#LN4351"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span>LONG_MAX<span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="postgres.c.html#LN4351"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN4356"><span class='Ref_To_Local'>rlim</span></a><span class='Operator'>.</span>rlim_cur<span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="postgres.c.html#LN4351"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#else</span>                           <span class='Comment_Single_Line'>/* no getrlimit */ 
</span><span class='Directive'>#if</span> defined<span class='Parentheses'>(</span><a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a><span class='Parentheses'>) </span><span class='Operator'>|| </span>defined<span class='Parentheses'>(</span>__CYGWIN__<span class='Parentheses'>) 
</span>    <span class='Comment_Multi_Line'>/* On Windows we set the backend stack size in src/backend/Makefile */ 
</span>    <span class='Control'>return</span> WIN32_STACK_RLIMIT<span class='Delimiter'>; 
</span><span class='Directive'>#else</span>                           <span class='Comment_Single_Line'>/* not windows ... give up */ 
</span>    <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<span class='Directive'>#endif</span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end get_stack_depth_rlimit &raquo; </span> 
 
 
<a name="LN4380"></a><span class='Keyword'>static </span><span class='Control'>struct</span> <a href="../../include/rusagestub.h.html#LN25"><span class='Ref_to_Struct'>rusage</span></a> <span class='Declare_Var'>Save_r</span><span class='Delimiter'>; 
</span><a name="LN4381"></a><span class='Keyword'>static </span><span class='Control'>struct</span> timeval <span class='Declare_Var'>Save_t</span><span class='Delimiter'>; 
</span> 
<span class='Keyword'>void 
</span><a name="LN4384"></a><span class='Declare_Function'>ResetUsage</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../port/getrusage.c.html#LN29"><span class='Ref_to_Func'>getrusage</span></a><span class='Parentheses'>(</span><a href="../../include/rusagestub.h.html#LN22"><span class='Ref_to_Const'>RUSAGE_SELF</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres.c.html#LN4380"><span class='Ref_to_Global_Var'>Save_r</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../port/gettimeofday.c.html#LN103"><span class='Ref_to_Func'>gettimeofday</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres.c.html#LN4381"><span class='Ref_to_Global_Var'>Save_t</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>void 
</span><a name="LN4391"></a><span class='Declare_Function'>ShowUsage</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>title</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4393"></a>    <a href="../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>str</span><span class='Delimiter'>; 
</span><a name="LN4394"></a>    <span class='Control'>struct</span> timeval <span class='Declare_Local'>user</span><span class='Delimiter'>, 
</span><a name="LN4395"></a>                <span class='Declare_Local'>sys</span><span class='Delimiter'>; 
</span><a name="LN4396"></a>    <span class='Control'>struct</span> timeval <span class='Declare_Local'>elapse_t</span><span class='Delimiter'>; 
</span><a name="LN4397"></a>    <span class='Control'>struct</span> <a href="../../include/rusagestub.h.html#LN25"><span class='Ref_to_Struct'>rusage</span></a> <span class='Declare_Local'>r</span><span class='Delimiter'>; 
</span> 
    <a href="../../port/getrusage.c.html#LN29"><span class='Ref_to_Func'>getrusage</span></a><span class='Parentheses'>(</span><a href="../../include/rusagestub.h.html#LN22"><span class='Ref_to_Const'>RUSAGE_SELF</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres.c.html#LN4397"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../port/gettimeofday.c.html#LN103"><span class='Ref_to_Func'>gettimeofday</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres.c.html#LN4396"><span class='Ref_To_Local'>elapse_t</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="postgres.c.html#LN4394"><span class='Ref_To_Local'>user</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="postgres.c.html#LN4397"><span class='Ref_To_Local'>r</span></a><span class='Operator'>.</span><a href="../../include/rusagestub.h.html#LN27"><span class='Ref_to_Member'>ru_utime</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="postgres.c.html#LN4394"><span class='Ref_To_Local'>user</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="postgres.c.html#LN4395"><span class='Ref_To_Local'>sys</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="postgres.c.html#LN4397"><span class='Ref_To_Local'>r</span></a><span class='Operator'>.</span><a href="../../include/rusagestub.h.html#LN28"><span class='Ref_to_Member'>ru_stime</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="postgres.c.html#LN4395"><span class='Ref_To_Local'>sys</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN4396"><span class='Ref_To_Local'>elapse_t</span></a><span class='Operator'>.</span>tv_usec <span class='Operator'>&LT; </span><a href="postgres.c.html#LN4381"><span class='Ref_to_Global_Var'>Save_t</span></a><span class='Operator'>.</span>tv_usec<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="postgres.c.html#LN4396"><span class='Ref_To_Local'>elapse_t</span></a><span class='Operator'>.</span>tv_sec<span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <a href="postgres.c.html#LN4396"><span class='Ref_To_Local'>elapse_t</span></a><span class='Operator'>.</span>tv_usec <span class='Operator'>+= </span><span class='Number'>1000000</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN4397"><span class='Ref_To_Local'>r</span></a><span class='Operator'>.</span><a href="../../include/rusagestub.h.html#LN27"><span class='Ref_to_Member'>ru_utime</span></a><span class='Operator'>.</span>tv_usec <span class='Operator'>&LT; </span><a href="postgres.c.html#LN4380"><span class='Ref_to_Global_Var'>Save_r</span></a><span class='Operator'>.</span><a href="../../include/rusagestub.h.html#LN27"><span class='Ref_to_Member'>ru_utime</span></a><span class='Operator'>.</span>tv_usec<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="postgres.c.html#LN4397"><span class='Ref_To_Local'>r</span></a><span class='Operator'>.</span><a href="../../include/rusagestub.h.html#LN27"><span class='Ref_to_Member'>ru_utime</span></a><span class='Operator'>.</span>tv_sec<span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <a href="postgres.c.html#LN4397"><span class='Ref_To_Local'>r</span></a><span class='Operator'>.</span><a href="../../include/rusagestub.h.html#LN27"><span class='Ref_to_Member'>ru_utime</span></a><span class='Operator'>.</span>tv_usec <span class='Operator'>+= </span><span class='Number'>1000000</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN4397"><span class='Ref_To_Local'>r</span></a><span class='Operator'>.</span><a href="../../include/rusagestub.h.html#LN28"><span class='Ref_to_Member'>ru_stime</span></a><span class='Operator'>.</span>tv_usec <span class='Operator'>&LT; </span><a href="postgres.c.html#LN4380"><span class='Ref_to_Global_Var'>Save_r</span></a><span class='Operator'>.</span><a href="../../include/rusagestub.h.html#LN28"><span class='Ref_to_Member'>ru_stime</span></a><span class='Operator'>.</span>tv_usec<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="postgres.c.html#LN4397"><span class='Ref_To_Local'>r</span></a><span class='Operator'>.</span><a href="../../include/rusagestub.h.html#LN28"><span class='Ref_to_Member'>ru_stime</span></a><span class='Operator'>.</span>tv_sec<span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <a href="postgres.c.html#LN4397"><span class='Ref_To_Local'>r</span></a><span class='Operator'>.</span><a href="../../include/rusagestub.h.html#LN28"><span class='Ref_to_Member'>ru_stime</span></a><span class='Operator'>.</span>tv_usec <span class='Operator'>+= </span><span class='Number'>1000000</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * the only stats we don't show here are for memory usage -- i can't 
     * figure out how to interpret the relevant fields in the rusage struct, 
     * and they change names across o/s platforms, anyway. if you can figure 
     * out what the entries mean, you can somehow extract resident set size, 
     * shared text size, and unshared data and stack sizes. 
     */ 
</span>    <a href="../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres.c.html#LN4393"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres.c.html#LN4393"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, </span><span class='String'>"! system usage stats:\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres.c.html#LN4393"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, 
</span>            <span class='String'>"!\t%ld.%06ld s user, %ld.%06ld s system, %ld.%06ld s elapsed\n"</span><span class='Delimiter'>, 
</span>                     <span class='Parentheses'>(</span><span class='Keyword'>long</span><span class='Parentheses'>) (</span><a href="postgres.c.html#LN4397"><span class='Ref_To_Local'>r</span></a><span class='Operator'>.</span><a href="../../include/rusagestub.h.html#LN27"><span class='Ref_to_Member'>ru_utime</span></a><span class='Operator'>.</span>tv_sec <span class='Operator'>- </span><a href="postgres.c.html#LN4380"><span class='Ref_to_Global_Var'>Save_r</span></a><span class='Operator'>.</span><a href="../../include/rusagestub.h.html#LN27"><span class='Ref_to_Member'>ru_utime</span></a><span class='Operator'>.</span>tv_sec<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <span class='Parentheses'>(</span><span class='Keyword'>long</span><span class='Parentheses'>) (</span><a href="postgres.c.html#LN4397"><span class='Ref_To_Local'>r</span></a><span class='Operator'>.</span><a href="../../include/rusagestub.h.html#LN27"><span class='Ref_to_Member'>ru_utime</span></a><span class='Operator'>.</span>tv_usec <span class='Operator'>- </span><a href="postgres.c.html#LN4380"><span class='Ref_to_Global_Var'>Save_r</span></a><span class='Operator'>.</span><a href="../../include/rusagestub.h.html#LN27"><span class='Ref_to_Member'>ru_utime</span></a><span class='Operator'>.</span>tv_usec<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <span class='Parentheses'>(</span><span class='Keyword'>long</span><span class='Parentheses'>) (</span><a href="postgres.c.html#LN4397"><span class='Ref_To_Local'>r</span></a><span class='Operator'>.</span><a href="../../include/rusagestub.h.html#LN28"><span class='Ref_to_Member'>ru_stime</span></a><span class='Operator'>.</span>tv_sec <span class='Operator'>- </span><a href="postgres.c.html#LN4380"><span class='Ref_to_Global_Var'>Save_r</span></a><span class='Operator'>.</span><a href="../../include/rusagestub.h.html#LN28"><span class='Ref_to_Member'>ru_stime</span></a><span class='Operator'>.</span>tv_sec<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <span class='Parentheses'>(</span><span class='Keyword'>long</span><span class='Parentheses'>) (</span><a href="postgres.c.html#LN4397"><span class='Ref_To_Local'>r</span></a><span class='Operator'>.</span><a href="../../include/rusagestub.h.html#LN28"><span class='Ref_to_Member'>ru_stime</span></a><span class='Operator'>.</span>tv_usec <span class='Operator'>- </span><a href="postgres.c.html#LN4380"><span class='Ref_to_Global_Var'>Save_r</span></a><span class='Operator'>.</span><a href="../../include/rusagestub.h.html#LN28"><span class='Ref_to_Member'>ru_stime</span></a><span class='Operator'>.</span>tv_usec<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <span class='Parentheses'>(</span><span class='Keyword'>long</span><span class='Parentheses'>) (</span><a href="postgres.c.html#LN4396"><span class='Ref_To_Local'>elapse_t</span></a><span class='Operator'>.</span>tv_sec <span class='Operator'>- </span><a href="postgres.c.html#LN4381"><span class='Ref_to_Global_Var'>Save_t</span></a><span class='Operator'>.</span>tv_sec<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <span class='Parentheses'>(</span><span class='Keyword'>long</span><span class='Parentheses'>) (</span><a href="postgres.c.html#LN4396"><span class='Ref_To_Local'>elapse_t</span></a><span class='Operator'>.</span>tv_usec <span class='Operator'>- </span><a href="postgres.c.html#LN4381"><span class='Ref_to_Global_Var'>Save_t</span></a><span class='Operator'>.</span>tv_usec<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres.c.html#LN4393"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, 
</span>                     <span class='String'>"!\t[%ld.%06ld s user, %ld.%06ld s system total]\n"</span><span class='Delimiter'>, 
</span>                     <span class='Parentheses'>(</span><span class='Keyword'>long</span><span class='Parentheses'>) </span><a href="postgres.c.html#LN4394"><span class='Ref_To_Local'>user</span></a><span class='Operator'>.</span>tv_sec<span class='Delimiter'>, 
</span>                     <span class='Parentheses'>(</span><span class='Keyword'>long</span><span class='Parentheses'>) </span><a href="postgres.c.html#LN4394"><span class='Ref_To_Local'>user</span></a><span class='Operator'>.</span>tv_usec<span class='Delimiter'>, 
</span>                     <span class='Parentheses'>(</span><span class='Keyword'>long</span><span class='Parentheses'>) </span><a href="postgres.c.html#LN4395"><span class='Ref_To_Local'>sys</span></a><span class='Operator'>.</span>tv_sec<span class='Delimiter'>, 
</span>                     <span class='Parentheses'>(</span><span class='Keyword'>long</span><span class='Parentheses'>) </span><a href="postgres.c.html#LN4395"><span class='Ref_To_Local'>sys</span></a><span class='Operator'>.</span>tv_usec<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#if</span> defined<span class='Parentheses'>(</span>HAVE_GETRUSAGE<span class='Parentheses'>) 
</span>    <a href="../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres.c.html#LN4393"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, 
</span>                     <span class='String'>"!\t%ld/%ld [%ld/%ld] filesystem blocks in/out\n"</span><span class='Delimiter'>, 
</span>                     <a href="postgres.c.html#LN4397"><span class='Ref_To_Local'>r</span></a><span class='Operator'>.</span>ru_inblock <span class='Operator'>- </span><a href="postgres.c.html#LN4380"><span class='Ref_to_Global_Var'>Save_r</span></a><span class='Operator'>.</span>ru_inblock<span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* they only drink coffee at dec */ 
</span>                     <a href="postgres.c.html#LN4397"><span class='Ref_To_Local'>r</span></a><span class='Operator'>.</span>ru_oublock <span class='Operator'>- </span><a href="postgres.c.html#LN4380"><span class='Ref_to_Global_Var'>Save_r</span></a><span class='Operator'>.</span>ru_oublock<span class='Delimiter'>, 
</span>                     <a href="postgres.c.html#LN4397"><span class='Ref_To_Local'>r</span></a><span class='Operator'>.</span>ru_inblock<span class='Delimiter'>, </span><a href="postgres.c.html#LN4397"><span class='Ref_To_Local'>r</span></a><span class='Operator'>.</span>ru_oublock<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres.c.html#LN4393"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, 
</span>              <span class='String'>"!\t%ld/%ld [%ld/%ld] page faults/reclaims, %ld [%ld] swaps\n"</span><span class='Delimiter'>, 
</span>                     <a href="postgres.c.html#LN4397"><span class='Ref_To_Local'>r</span></a><span class='Operator'>.</span>ru_majflt <span class='Operator'>- </span><a href="postgres.c.html#LN4380"><span class='Ref_to_Global_Var'>Save_r</span></a><span class='Operator'>.</span>ru_majflt<span class='Delimiter'>, 
</span>                     <a href="postgres.c.html#LN4397"><span class='Ref_To_Local'>r</span></a><span class='Operator'>.</span>ru_minflt <span class='Operator'>- </span><a href="postgres.c.html#LN4380"><span class='Ref_to_Global_Var'>Save_r</span></a><span class='Operator'>.</span>ru_minflt<span class='Delimiter'>, 
</span>                     <a href="postgres.c.html#LN4397"><span class='Ref_To_Local'>r</span></a><span class='Operator'>.</span>ru_majflt<span class='Delimiter'>, </span><a href="postgres.c.html#LN4397"><span class='Ref_To_Local'>r</span></a><span class='Operator'>.</span>ru_minflt<span class='Delimiter'>, 
</span>                     <a href="postgres.c.html#LN4397"><span class='Ref_To_Local'>r</span></a><span class='Operator'>.</span>ru_nswap <span class='Operator'>- </span><a href="postgres.c.html#LN4380"><span class='Ref_to_Global_Var'>Save_r</span></a><span class='Operator'>.</span>ru_nswap<span class='Delimiter'>, 
</span>                     <a href="postgres.c.html#LN4397"><span class='Ref_To_Local'>r</span></a><span class='Operator'>.</span>ru_nswap<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres.c.html#LN4393"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, 
</span>         <span class='String'>"!\t%ld [%ld] signals rcvd, %ld/%ld [%ld/%ld] messages rcvd/sent\n"</span><span class='Delimiter'>, 
</span>                     <a href="postgres.c.html#LN4397"><span class='Ref_To_Local'>r</span></a><span class='Operator'>.</span>ru_nsignals <span class='Operator'>- </span><a href="postgres.c.html#LN4380"><span class='Ref_to_Global_Var'>Save_r</span></a><span class='Operator'>.</span>ru_nsignals<span class='Delimiter'>, 
</span>                     <a href="postgres.c.html#LN4397"><span class='Ref_To_Local'>r</span></a><span class='Operator'>.</span>ru_nsignals<span class='Delimiter'>, 
</span>                     <a href="postgres.c.html#LN4397"><span class='Ref_To_Local'>r</span></a><span class='Operator'>.</span>ru_msgrcv <span class='Operator'>- </span><a href="postgres.c.html#LN4380"><span class='Ref_to_Global_Var'>Save_r</span></a><span class='Operator'>.</span>ru_msgrcv<span class='Delimiter'>, 
</span>                     <a href="postgres.c.html#LN4397"><span class='Ref_To_Local'>r</span></a><span class='Operator'>.</span>ru_msgsnd <span class='Operator'>- </span><a href="postgres.c.html#LN4380"><span class='Ref_to_Global_Var'>Save_r</span></a><span class='Operator'>.</span>ru_msgsnd<span class='Delimiter'>, 
</span>                     <a href="postgres.c.html#LN4397"><span class='Ref_To_Local'>r</span></a><span class='Operator'>.</span>ru_msgrcv<span class='Delimiter'>, </span><a href="postgres.c.html#LN4397"><span class='Ref_To_Local'>r</span></a><span class='Operator'>.</span>ru_msgsnd<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres.c.html#LN4393"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, 
</span>             <span class='String'>"!\t%ld/%ld [%ld/%ld] voluntary/involuntary context switches\n"</span><span class='Delimiter'>, 
</span>                     <a href="postgres.c.html#LN4397"><span class='Ref_To_Local'>r</span></a><span class='Operator'>.</span>ru_nvcsw <span class='Operator'>- </span><a href="postgres.c.html#LN4380"><span class='Ref_to_Global_Var'>Save_r</span></a><span class='Operator'>.</span>ru_nvcsw<span class='Delimiter'>, 
</span>                     <a href="postgres.c.html#LN4397"><span class='Ref_To_Local'>r</span></a><span class='Operator'>.</span>ru_nivcsw <span class='Operator'>- </span><a href="postgres.c.html#LN4380"><span class='Ref_to_Global_Var'>Save_r</span></a><span class='Operator'>.</span>ru_nivcsw<span class='Delimiter'>, 
</span>                     <a href="postgres.c.html#LN4397"><span class='Ref_To_Local'>r</span></a><span class='Operator'>.</span>ru_nvcsw<span class='Delimiter'>, </span><a href="postgres.c.html#LN4397"><span class='Ref_To_Local'>r</span></a><span class='Operator'>.</span>ru_nivcsw<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* HAVE_GETRUSAGE */ 
</span> 
    <span class='Comment_Multi_Line'>/* remove trailing newline */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres.c.html#LN4393"><span class='Ref_To_Local'>str</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>[</span><a href="postgres.c.html#LN4393"><span class='Ref_To_Local'>str</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\n'</span><span class='Parentheses'>) 
</span>        <a href="postgres.c.html#LN4393"><span class='Ref_To_Local'>str</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>[</span><span class='Operator'>--</span><a href="postgres.c.html#LN4393"><span class='Ref_To_Local'>str</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, 
</span>            <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN825"><span class='Ref_to_Func'>errmsg_internal</span></a><span class='Parentheses'>(</span><span class='String'>"%s"</span><span class='Delimiter'>, </span><a href="postgres.c.html#LN4391"><span class='Ref_to_Parameter'>title</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../utils/error/elog.c.html#LN898"><span class='Ref_to_Func'>errdetail_internal</span></a><span class='Parentheses'>(</span><span class='String'>"%s"</span><span class='Delimiter'>, </span><a href="postgres.c.html#LN4393"><span class='Ref_To_Local'>str</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN4393"><span class='Ref_To_Local'>str</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ShowUsage &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * on_proc_exit handler to log end of session 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN4486"></a><span class='Declare_Function'>log_disconnections</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>code</span><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>arg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4488"></a>    <a href="../../include/libpq/libpq-be.h.html#LN115"><span class='Ref_to_Struct'>Port</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>port</span> <span class='Operator'>= </span><a href="../utils/init/globals.c.html#LN40"><span class='Ref_to_Global_Var'>MyProcPort</span></a><span class='Delimiter'>; 
</span><a name="LN4489"></a>    <span class='Keyword'>long</span>        <span class='Declare_Local'>secs</span><span class='Delimiter'>; 
</span><a name="LN4490"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>usecs</span><span class='Delimiter'>; 
</span><a name="LN4491"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>msecs</span><span class='Delimiter'>; 
</span><a name="LN4492"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>hours</span><span class='Delimiter'>, 
</span><a name="LN4493"></a>                <span class='Declare_Local'>minutes</span><span class='Delimiter'>, 
</span><a name="LN4494"></a>                <span class='Declare_Local'>seconds</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/timestamp.h.html#LN72"><span class='Ref_to_Proto'>TimestampDifference</span></a><span class='Parentheses'>(</span><a href="postgres.c.html#LN4488"><span class='Ref_To_Local'>port</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/libpq-be.h.html#LN150"><span class='Ref_to_Member'>SessionStartTime</span></a><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/timestamp.h.html#LN69"><span class='Ref_to_Proto'>GetCurrentTimestamp</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                        <span class='Operator'>&</span><a href="postgres.c.html#LN4489"><span class='Ref_To_Local'>secs</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres.c.html#LN4490"><span class='Ref_To_Local'>usecs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="postgres.c.html#LN4491"><span class='Ref_To_Local'>msecs</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN4490"><span class='Ref_To_Local'>usecs</span></a> <span class='Operator'>/ </span><span class='Number'>1000</span><span class='Delimiter'>; 
</span> 
    <a href="postgres.c.html#LN4492"><span class='Ref_To_Local'>hours</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN4489"><span class='Ref_To_Local'>secs</span></a> <span class='Operator'>/ </span><a href="../../include/datatype/timestamp.h.html#LN86"><span class='Ref_to_Const'>SECS_PER_HOUR</span></a><span class='Delimiter'>; 
</span>    <a href="postgres.c.html#LN4489"><span class='Ref_To_Local'>secs</span></a> <span class='Operator'>%= </span><a href="../../include/datatype/timestamp.h.html#LN86"><span class='Ref_to_Const'>SECS_PER_HOUR</span></a><span class='Delimiter'>; 
</span>    <a href="postgres.c.html#LN4493"><span class='Ref_To_Local'>minutes</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN4489"><span class='Ref_To_Local'>secs</span></a> <span class='Operator'>/ </span><a href="../../include/datatype/timestamp.h.html#LN87"><span class='Ref_to_Const'>SECS_PER_MINUTE</span></a><span class='Delimiter'>; 
</span>    <a href="postgres.c.html#LN4494"><span class='Ref_To_Local'>seconds</span></a> <span class='Operator'>= </span><a href="postgres.c.html#LN4489"><span class='Ref_To_Local'>secs</span></a> <span class='Operator'>% </span><a href="../../include/datatype/timestamp.h.html#LN87"><span class='Ref_to_Const'>SECS_PER_MINUTE</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, 
</span>            <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"disconnection: session time: %d:%02d:%02d.%03d "</span> 
                    <span class='String'>"user=%s database=%s host=%s%s%s"</span><span class='Delimiter'>, 
</span>                    <a href="postgres.c.html#LN4492"><span class='Ref_To_Local'>hours</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN4493"><span class='Ref_To_Local'>minutes</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN4494"><span class='Ref_To_Local'>seconds</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN4491"><span class='Ref_To_Local'>msecs</span></a><span class='Delimiter'>, 
</span>                    <a href="postgres.c.html#LN4488"><span class='Ref_To_Local'>port</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/libpq-be.h.html#LN136"><span class='Ref_to_Member'>user_name</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN4488"><span class='Ref_To_Local'>port</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/libpq-be.h.html#LN135"><span class='Ref_to_Member'>database_name</span></a><span class='Delimiter'>, </span><a href="postgres.c.html#LN4488"><span class='Ref_To_Local'>port</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/libpq-be.h.html#LN122"><span class='Ref_to_Member'>remote_host</span></a><span class='Delimiter'>, 
</span>                  <a href="postgres.c.html#LN4488"><span class='Ref_To_Local'>port</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/libpq-be.h.html#LN127"><span class='Ref_to_Member'>remote_port</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>? </span><span class='String'>" port="</span> <span class='Operator'>: </span><span class='String'>""</span><span class='Delimiter'>, </span><a href="postgres.c.html#LN4488"><span class='Ref_To_Local'>port</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/libpq-be.h.html#LN127"><span class='Ref_to_Member'>remote_port</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end log_disconnections &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>