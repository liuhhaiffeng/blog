<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\tcop\pquery.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\tcop\pquery.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:50 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * pquery.c 
 *    POSTGRES process query command code 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/tcop/pquery.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span> 
<span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;limits.h&GT;</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/xact.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/prepare.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"executor/tstoreReceiver.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"pg_trace.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"tcop/pquery.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"tcop/utility.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/memutils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/snapmgr.h"</span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * ActivePortal is the currently executing Portal (the most closely nested, 
 * if there are several). 
 */ 
</span><a name="LN34"></a><a href="../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a>      <span class='Declare_Var'>ActivePortal</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
 
<a name="LN37"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ProcessQuery</span><span class='Parentheses'>(</span><a href="../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>plan</span><span class='Delimiter'>, 
</span><a name="LN38"></a>             <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>sourceText</span><span class='Delimiter'>, 
</span><a name="LN39"></a>             <a href="../../include/nodes/params.h.html#LN61"><span class='Ref_to_Typedef'>ParamListInfo</span></a> <span class='Declare_Parameter'>params</span><span class='Delimiter'>, 
</span><a name="LN40"></a>             <a href="../utils/misc/queryenvironment.c.html#LN31"><span class='Ref_to_Struct'>QueryEnvironment</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>queryEnv</span><span class='Delimiter'>, 
</span><a name="LN41"></a>             <a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>dest</span><span class='Delimiter'>, 
</span><a name="LN42"></a>             <span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>completionTag</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN43"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>FillPortalStore</span><span class='Parentheses'>(</span><a href="../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a> <span class='Declare_Parameter'>portal</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isTopLevel</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN44"></a><span class='Keyword'>static </span><a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> <span class='Declare_Prototype'>RunFromStore</span><span class='Parentheses'>(</span><a href="../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a> <span class='Declare_Parameter'>portal</span><span class='Delimiter'>, </span><a href="../../include/access/sdir.h.html#LN21"><span class='Ref_to_Enum'>ScanDirection</span></a> <span class='Declare_Parameter'>direction</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> <span class='Declare_Parameter'>count</span><span class='Delimiter'>, 
</span><a name="LN45"></a>             <a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>dest</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN46"></a><span class='Keyword'>static </span><a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> <span class='Declare_Prototype'>PortalRunSelect</span><span class='Parentheses'>(</span><a href="../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a> <span class='Declare_Parameter'>portal</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>forward</span><span class='Delimiter'>, </span><span class='Keyword'>long </span><span class='Declare_Parameter'>count</span><span class='Delimiter'>, 
</span><a name="LN47"></a>                <a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>dest</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN48"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>PortalRunUtility</span><span class='Parentheses'>(</span><a href="../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a> <span class='Declare_Parameter'>portal</span><span class='Delimiter'>, </span><a href="../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstmt</span><span class='Delimiter'>, 
</span><a name="LN49"></a>                 <span class='Keyword'>bool </span><span class='Declare_Parameter'>isTopLevel</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>setHoldSnapshot</span><span class='Delimiter'>, 
</span><a name="LN50"></a>                 <a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>dest</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>completionTag</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN51"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>PortalRunMulti</span><span class='Parentheses'>(</span><a href="../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a> <span class='Declare_Parameter'>portal</span><span class='Delimiter'>, 
</span><a name="LN52"></a>               <span class='Keyword'>bool </span><span class='Declare_Parameter'>isTopLevel</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>setHoldSnapshot</span><span class='Delimiter'>, 
</span><a name="LN53"></a>               <a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>dest</span><span class='Delimiter'>, </span><a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>altdest</span><span class='Delimiter'>, 
</span><a name="LN54"></a>               <span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>completionTag</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN55"></a><span class='Keyword'>static </span><a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> <span class='Declare_Prototype'>DoPortalRunFetch</span><span class='Parentheses'>(</span><a href="../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a> <span class='Declare_Parameter'>portal</span><span class='Delimiter'>, 
</span><a name="LN56"></a>                 <a href="../../include/nodes/parsenodes.h.html#LN2635"><span class='Ref_to_Enum'>FetchDirection</span></a> <span class='Declare_Parameter'>fdirection</span><span class='Delimiter'>, 
</span><a name="LN57"></a>                 <span class='Keyword'>long </span><span class='Declare_Parameter'>count</span><span class='Delimiter'>, 
</span><a name="LN58"></a>                 <a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>dest</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN59"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>DoPortalRewind</span><span class='Parentheses'>(</span><a href="../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a> <span class='Declare_Parameter'>portal</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * CreateQueryDesc 
 */ 
</span><a href="../../include/executor/execdesc.h.html#LN32"><span class='Ref_to_Struct'>QueryDesc</span></a> <span class='Operator'>* 
</span><a name="LN66"></a><span class='Declare_Function'>CreateQueryDesc</span><span class='Parentheses'>(</span><a href="../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>plannedstmt</span><span class='Delimiter'>, 
</span><a name="LN67"></a>                <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>sourceText</span><span class='Delimiter'>, 
</span><a name="LN68"></a>                <a href="../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a> <span class='Declare_Parameter'>snapshot</span><span class='Delimiter'>, 
</span><a name="LN69"></a>                <a href="../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a> <span class='Declare_Parameter'>crosscheck_snapshot</span><span class='Delimiter'>, 
</span><a name="LN70"></a>                <a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>dest</span><span class='Delimiter'>, 
</span><a name="LN71"></a>                <a href="../../include/nodes/params.h.html#LN61"><span class='Ref_to_Typedef'>ParamListInfo</span></a> <span class='Declare_Parameter'>params</span><span class='Delimiter'>, 
</span><a name="LN72"></a>                <a href="../utils/misc/queryenvironment.c.html#LN31"><span class='Ref_to_Struct'>QueryEnvironment</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>queryEnv</span><span class='Delimiter'>, 
</span><a name="LN73"></a>                <span class='Keyword'>int </span><span class='Declare_Parameter'>instrument_options</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN75"></a>    <a href="../../include/executor/execdesc.h.html#LN32"><span class='Ref_to_Struct'>QueryDesc</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>qd</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/executor/execdesc.h.html#LN32"><span class='Ref_to_Struct'>QueryDesc</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/executor/execdesc.h.html#LN32"><span class='Ref_to_Struct'>QueryDesc</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="pquery.c.html#LN75"><span class='Ref_To_Local'>qd</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN35"><span class='Ref_to_Member'>operation</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN66"><span class='Ref_to_Parameter'>plannedstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN44"><span class='Ref_to_Member'>commandType</span></a><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* operation */ 
</span>    <a href="pquery.c.html#LN75"><span class='Ref_To_Local'>qd</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN36"><span class='Ref_to_Member'>plannedstmt</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN66"><span class='Ref_to_Parameter'>plannedstmt</span></a><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* plan */ 
</span>    <a href="pquery.c.html#LN75"><span class='Ref_To_Local'>qd</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN37"><span class='Ref_to_Member'>sourceText</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN67"><span class='Ref_to_Parameter'>sourceText</span></a><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* query text */ 
</span>    <a href="pquery.c.html#LN75"><span class='Ref_To_Local'>qd</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN38"><span class='Ref_to_Member'>snapshot</span></a> <span class='Operator'>= </span><a href="../../include/utils/snapmgr.h.html#LN80"><span class='Ref_to_Proto'>RegisterSnapshot</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN68"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* snapshot */ 
</span>    <span class='Comment_Multi_Line'>/* RI check snapshot */ 
</span>    <a href="pquery.c.html#LN75"><span class='Ref_To_Local'>qd</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN39"><span class='Ref_to_Member'>crosscheck_snapshot</span></a> <span class='Operator'>= </span><a href="../../include/utils/snapmgr.h.html#LN80"><span class='Ref_to_Proto'>RegisterSnapshot</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN69"><span class='Ref_to_Parameter'>crosscheck_snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pquery.c.html#LN75"><span class='Ref_To_Local'>qd</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN40"><span class='Ref_to_Member'>dest</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN70"><span class='Ref_to_Parameter'>dest</span></a><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* output dest */ 
</span>    <a href="pquery.c.html#LN75"><span class='Ref_To_Local'>qd</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN41"><span class='Ref_to_Member'>params</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN71"><span class='Ref_to_Parameter'>params</span></a><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* parameter values passed into query */ 
</span>    <a href="pquery.c.html#LN75"><span class='Ref_To_Local'>qd</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN42"><span class='Ref_to_Member'>queryEnv</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN72"><span class='Ref_to_Parameter'>queryEnv</span></a><span class='Delimiter'>; 
</span>    <a href="pquery.c.html#LN75"><span class='Ref_To_Local'>qd</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN43"><span class='Ref_to_Member'>instrument_options</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN73"><span class='Ref_to_Parameter'>instrument_options</span></a><span class='Delimiter'>;</span>        <span class='Comment_Multi_Line'>/* instrumentation 
                                                         * wanted? */ 
</span> 
    <span class='Comment_Multi_Line'>/* null these fields until set by ExecutorStart */ 
</span>    <a href="pquery.c.html#LN75"><span class='Ref_To_Local'>qd</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN46"><span class='Ref_to_Member'>tupDesc</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="pquery.c.html#LN75"><span class='Ref_To_Local'>qd</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN47"><span class='Ref_to_Member'>estate</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="pquery.c.html#LN75"><span class='Ref_To_Local'>qd</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN48"><span class='Ref_to_Member'>planstate</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="pquery.c.html#LN75"><span class='Ref_To_Local'>qd</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN54"><span class='Ref_to_Member'>totaltime</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* not yet executed */ 
</span>    <a href="pquery.c.html#LN75"><span class='Ref_To_Local'>qd</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN51"><span class='Ref_to_Member'>already_executed</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pquery.c.html#LN75"><span class='Ref_To_Local'>qd</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end CreateQueryDesc &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * FreeQueryDesc 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN105"></a><span class='Declare_Function'>FreeQueryDesc</span><span class='Parentheses'>(</span><a href="../../include/executor/execdesc.h.html#LN32"><span class='Ref_to_Struct'>QueryDesc</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>qdesc</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Can't be a live query */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pquery.c.html#LN105"><span class='Ref_to_Parameter'>qdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN47"><span class='Ref_to_Member'>estate</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* forget our snapshots */ 
</span>    <a href="../../include/utils/snapmgr.h.html#LN81"><span class='Ref_to_Proto'>UnregisterSnapshot</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN105"><span class='Ref_to_Parameter'>qdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN38"><span class='Ref_to_Member'>snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/utils/snapmgr.h.html#LN81"><span class='Ref_to_Proto'>UnregisterSnapshot</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN105"><span class='Ref_to_Parameter'>qdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN39"><span class='Ref_to_Member'>crosscheck_snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Only the QueryDesc itself need be freed */ 
</span>    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN105"><span class='Ref_to_Parameter'>qdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * ProcessQuery 
 *      Execute a single plannable query within a PORTAL_MULTI_QUERY, 
 *      PORTAL_ONE_RETURNING, or PORTAL_ONE_MOD_WITH portal 
 * 
 *  plan: the plan tree for the query 
 *  sourceText: the source text of the query 
 *  params: any parameters needed 
 *  dest: where to send results 
 *  completionTag: points to a buffer of size COMPLETION_TAG_BUFSIZE 
 *      in which to store a command completion status string. 
 * 
 * completionTag may be NULL if caller doesn't want a status string. 
 * 
 * Must be called in a memory context that will be reset or deleted on 
 * error; otherwise the executor's memory usage will be leaked. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN137"></a><span class='Declare_Function'>ProcessQuery</span><span class='Parentheses'>(</span><a href="../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>plan</span><span class='Delimiter'>, 
</span><a name="LN138"></a>             <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>sourceText</span><span class='Delimiter'>, 
</span><a name="LN139"></a>             <a href="../../include/nodes/params.h.html#LN61"><span class='Ref_to_Typedef'>ParamListInfo</span></a> <span class='Declare_Parameter'>params</span><span class='Delimiter'>, 
</span><a name="LN140"></a>             <a href="../utils/misc/queryenvironment.c.html#LN31"><span class='Ref_to_Struct'>QueryEnvironment</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>queryEnv</span><span class='Delimiter'>, 
</span><a name="LN141"></a>             <a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>dest</span><span class='Delimiter'>, 
</span><a name="LN142"></a>             <span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>completionTag</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN144"></a>    <a href="../../include/executor/execdesc.h.html#LN32"><span class='Ref_to_Struct'>QueryDesc</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>queryDesc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Create the QueryDesc object 
     */ 
</span>    <a href="pquery.c.html#LN144"><span class='Ref_To_Local'>queryDesc</span></a> <span class='Operator'>= </span><a href="../../include/executor/execdesc.h.html#LN58"><span class='Ref_to_Proto'>CreateQueryDesc</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN137"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>, </span><a href="pquery.c.html#LN138"><span class='Ref_to_Parameter'>sourceText</span></a><span class='Delimiter'>, 
</span>                                <a href="../../include/utils/snapmgr.h.html#LN77"><span class='Ref_to_Proto'>GetActiveSnapshot</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="../../include/utils/snapshot.h.html#LN24"><span class='Ref_to_Const'>InvalidSnapshot</span></a><span class='Delimiter'>, 
</span>                                <a href="pquery.c.html#LN141"><span class='Ref_to_Parameter'>dest</span></a><span class='Delimiter'>, </span><a href="pquery.c.html#LN139"><span class='Ref_to_Parameter'>params</span></a><span class='Delimiter'>, </span><a href="pquery.c.html#LN140"><span class='Ref_to_Parameter'>queryEnv</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Call ExecutorStart to prepare the plan for execution 
     */ 
</span>    <a href="../executor/execMain.c.html#LN144"><span class='Ref_to_Func'>ExecutorStart</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN144"><span class='Ref_To_Local'>queryDesc</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Run the plan to completion. 
     */ 
</span>    <a href="../../include/executor/executor.h.html#LN169"><span class='Ref_to_Proto'>ExecutorRun</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN144"><span class='Ref_To_Local'>queryDesc</span></a><span class='Delimiter'>, </span><a href="../../include/access/sdir.h.html#LN25"><span class='Ref_to_EnumConst'>ForwardScanDirection</span></a><span class='Delimiter'>, </span><span class='Number'>0L</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Build command completion status string, if caller wants one. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN142"><span class='Ref_to_Parameter'>completionTag</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN168"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>lastOid</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN144"><span class='Ref_To_Local'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN35"><span class='Ref_to_Member'>operation</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/nodes.h.html#LN650"><span class='Ref_to_EnumConst'>CMD_SELECT</span></a><span class='Operator'>: 
</span>                <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN142"><span class='Ref_to_Parameter'>completionTag</span></a><span class='Delimiter'>, </span><a href="../../include/tcop/dest.h.html#LN73"><span class='Ref_to_Const'>COMPLETION_TAG_BUFSIZE</span></a><span class='Delimiter'>, 
</span>                         <span class='String'>"SELECT "</span> <a href="../../include/c.h.html#LN315"><span class='Ref_to_Const'>UINT64_FORMAT</span></a><span class='Delimiter'>, 
</span>                         <a href="pquery.c.html#LN144"><span class='Ref_To_Local'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN47"><span class='Ref_to_Member'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN453"><span class='Ref_to_Member'>es_processed</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/nodes.h.html#LN652"><span class='Ref_to_EnumConst'>CMD_INSERT</span></a><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN144"><span class='Ref_To_Local'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN47"><span class='Ref_to_Member'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN453"><span class='Ref_to_Member'>es_processed</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                    <a href="pquery.c.html#LN168"><span class='Ref_To_Local'>lastOid</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN144"><span class='Ref_To_Local'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN47"><span class='Ref_to_Member'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN454"><span class='Ref_to_Member'>es_lastoid</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="pquery.c.html#LN168"><span class='Ref_To_Local'>lastOid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>                <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN142"><span class='Ref_to_Parameter'>completionTag</span></a><span class='Delimiter'>, </span><a href="../../include/tcop/dest.h.html#LN73"><span class='Ref_to_Const'>COMPLETION_TAG_BUFSIZE</span></a><span class='Delimiter'>, 
</span>                         <span class='String'>"INSERT %u "</span> <a href="../../include/c.h.html#LN315"><span class='Ref_to_Const'>UINT64_FORMAT</span></a><span class='Delimiter'>, 
</span>                         <a href="pquery.c.html#LN168"><span class='Ref_To_Local'>lastOid</span></a><span class='Delimiter'>, </span><a href="pquery.c.html#LN144"><span class='Ref_To_Local'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN47"><span class='Ref_to_Member'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN453"><span class='Ref_to_Member'>es_processed</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/nodes.h.html#LN651"><span class='Ref_to_EnumConst'>CMD_UPDATE</span></a><span class='Operator'>: 
</span>                <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN142"><span class='Ref_to_Parameter'>completionTag</span></a><span class='Delimiter'>, </span><a href="../../include/tcop/dest.h.html#LN73"><span class='Ref_to_Const'>COMPLETION_TAG_BUFSIZE</span></a><span class='Delimiter'>, 
</span>                         <span class='String'>"UPDATE "</span> <a href="../../include/c.h.html#LN315"><span class='Ref_to_Const'>UINT64_FORMAT</span></a><span class='Delimiter'>, 
</span>                         <a href="pquery.c.html#LN144"><span class='Ref_To_Local'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN47"><span class='Ref_to_Member'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN453"><span class='Ref_to_Member'>es_processed</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/nodes.h.html#LN653"><span class='Ref_to_EnumConst'>CMD_DELETE</span></a><span class='Operator'>: 
</span>                <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN142"><span class='Ref_to_Parameter'>completionTag</span></a><span class='Delimiter'>, </span><a href="../../include/tcop/dest.h.html#LN73"><span class='Ref_to_Const'>COMPLETION_TAG_BUFSIZE</span></a><span class='Delimiter'>, 
</span>                         <span class='String'>"DELETE "</span> <a href="../../include/c.h.html#LN315"><span class='Ref_to_Const'>UINT64_FORMAT</span></a><span class='Delimiter'>, 
</span>                         <a href="pquery.c.html#LN144"><span class='Ref_To_Local'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN47"><span class='Ref_to_Member'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN453"><span class='Ref_to_Member'>es_processed</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../../../contrib/cube/cubeparse.y.html#LN150"><span class='Ref_to_Proto'>strcpy</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN142"><span class='Ref_to_Parameter'>completionTag</span></a><span class='Delimiter'>, </span><span class='String'>"???"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch queryDesc-&GT;operation &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if completionTag &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Now, we close down all the scans and free allocated resources. 
     */ 
</span>    <a href="../../include/executor/executor.h.html#LN173"><span class='Ref_to_Proto'>ExecutorFinish</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN144"><span class='Ref_To_Local'>queryDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/executor/executor.h.html#LN175"><span class='Ref_to_Proto'>ExecutorEnd</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN144"><span class='Ref_To_Local'>queryDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/executor/execdesc.h.html#LN67"><span class='Ref_to_Proto'>FreeQueryDesc</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN144"><span class='Ref_To_Local'>queryDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ProcessQuery &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ChoosePortalStrategy 
 *      Select portal execution strategy given the intended statement list. 
 * 
 * The list elements can be Querys or PlannedStmts. 
 * That's more general than portals need, but plancache.c uses this too. 
 * 
 * See the comments in portal.h. 
 */ 
</span><a href="../../include/utils/portal.h.html#LN87"><span class='Ref_to_Enum'>PortalStrategy</span></a> 
<a name="LN221"></a><span class='Declare_Function'>ChoosePortalStrategy</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmts</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN223"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nSetTag</span><span class='Delimiter'>; 
</span><a name="LN224"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * PORTAL_ONE_SELECT and PORTAL_UTIL_SELECT need only consider the 
     * single-statement case, since there are no rewrite rules that can add 
     * auxiliary queries to a SELECT or a utility command. PORTAL_ONE_MOD_WITH 
     * likewise allows only one top-level statement. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN221"><span class='Ref_to_Parameter'>stmts</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN234"></a>        <a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>stmt</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN221"><span class='Ref_to_Parameter'>stmts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN234"><span class='Ref_To_Local'>stmt</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN238"></a>            <a href="../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>query</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pquery.c.html#LN234"><span class='Ref_To_Local'>stmt</span></a><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN238"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN115"><span class='Ref_to_Member'>canSetTag</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN238"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN109"><span class='Ref_to_Member'>commandType</span></a> <span class='Operator'>== </span><a href="../../include/nodes/nodes.h.html#LN650"><span class='Ref_to_EnumConst'>CMD_SELECT</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN238"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN128"><span class='Ref_to_Member'>hasModifyingCTE</span></a><span class='Parentheses'>) 
</span>                        <span class='Control'>return</span> <a href="../../include/utils/portal.h.html#LN91"><span class='Ref_to_EnumConst'>PORTAL_ONE_MOD_WITH</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> 
                        <span class='Control'>return</span> <a href="../../include/utils/portal.h.html#LN89"><span class='Ref_to_EnumConst'>PORTAL_ONE_SELECT</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN238"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN109"><span class='Ref_to_Member'>commandType</span></a> <span class='Operator'>== </span><a href="../../include/nodes/nodes.h.html#LN654"><span class='Ref_to_EnumConst'>CMD_UTILITY</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/tcop/utility.h.html#LN42"><span class='Ref_to_Proto'>UtilityReturnsTuples</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN238"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN117"><span class='Ref_to_Member'>utilityStmt</span></a><span class='Parentheses'>))</span> 
                        <span class='Control'>return</span> <a href="../../include/utils/portal.h.html#LN92"><span class='Ref_to_EnumConst'>PORTAL_UTIL_SELECT</span></a><span class='Delimiter'>; 
</span>                    <span class='Comment_Multi_Line'>/* it can't be ONE_RETURNING, so give up */ 
</span>                    <span class='Control'>return</span> <a href="../../include/utils/portal.h.html#LN93"><span class='Ref_to_EnumConst'>PORTAL_MULTI_QUERY</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IsA(stmt,Query) &raquo; </span> 
        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN234"><span class='Ref_To_Local'>stmt</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN260"></a>            <a href="../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pstmt</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pquery.c.html#LN234"><span class='Ref_To_Local'>stmt</span></a><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN260"><span class='Ref_To_Local'>pstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN52"><span class='Ref_to_Member'>canSetTag</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN260"><span class='Ref_To_Local'>pstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN44"><span class='Ref_to_Member'>commandType</span></a> <span class='Operator'>== </span><a href="../../include/nodes/nodes.h.html#LN650"><span class='Ref_to_EnumConst'>CMD_SELECT</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN260"><span class='Ref_To_Local'>pstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN50"><span class='Ref_to_Member'>hasModifyingCTE</span></a><span class='Parentheses'>) 
</span>                        <span class='Control'>return</span> <a href="../../include/utils/portal.h.html#LN91"><span class='Ref_to_EnumConst'>PORTAL_ONE_MOD_WITH</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> 
                        <span class='Control'>return</span> <a href="../../include/utils/portal.h.html#LN89"><span class='Ref_to_EnumConst'>PORTAL_ONE_SELECT</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN260"><span class='Ref_To_Local'>pstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN44"><span class='Ref_to_Member'>commandType</span></a> <span class='Operator'>== </span><a href="../../include/nodes/nodes.h.html#LN654"><span class='Ref_to_EnumConst'>CMD_UTILITY</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/tcop/utility.h.html#LN42"><span class='Ref_to_Proto'>UtilityReturnsTuples</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN260"><span class='Ref_To_Local'>pstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN93"><span class='Ref_to_Member'>utilityStmt</span></a><span class='Parentheses'>))</span> 
                        <span class='Control'>return</span> <a href="../../include/utils/portal.h.html#LN92"><span class='Ref_to_EnumConst'>PORTAL_UTIL_SELECT</span></a><span class='Delimiter'>; 
</span>                    <span class='Comment_Multi_Line'>/* it can't be ONE_RETURNING, so give up */ 
</span>                    <span class='Control'>return</span> <a href="../../include/utils/portal.h.html#LN93"><span class='Ref_to_EnumConst'>PORTAL_MULTI_QUERY</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IsA(stmt,PlannedStmt) &raquo; </span> 
        <span class='Control'>else</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized node type: %d"</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="../../include/nodes/nodes.h.html#LN513"><span class='Ref_to_Macro'>nodeTag</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN234"><span class='Ref_To_Local'>stmt</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if list_length(stmts)==1 &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * PORTAL_ONE_RETURNING has to allow auxiliary queries added by rewrite. 
     * Choose PORTAL_ONE_RETURNING if there is exactly one canSetTag query and 
     * it has a RETURNING list. 
     */ 
</span>    <a href="pquery.c.html#LN223"><span class='Ref_To_Local'>nSetTag</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN224"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="pquery.c.html#LN221"><span class='Ref_to_Parameter'>stmts</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN292"></a>        <a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>stmt</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN224"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN292"><span class='Ref_To_Local'>stmt</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN296"></a>            <a href="../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>query</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pquery.c.html#LN292"><span class='Ref_To_Local'>stmt</span></a><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN296"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN115"><span class='Ref_to_Member'>canSetTag</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>++</span><a href="pquery.c.html#LN223"><span class='Ref_To_Local'>nSetTag</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                    <span class='Control'>return</span> <a href="../../include/utils/portal.h.html#LN93"><span class='Ref_to_EnumConst'>PORTAL_MULTI_QUERY</span></a><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* no need to look further */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN296"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN109"><span class='Ref_to_Member'>commandType</span></a> <span class='Operator'>== </span><a href="../../include/nodes/nodes.h.html#LN654"><span class='Ref_to_EnumConst'>CMD_UTILITY</span></a> <span class='Operator'>|| 
</span>                    <a href="pquery.c.html#LN296"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN143"><span class='Ref_to_Member'>returningList</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>                    <span class='Control'>return</span> <a href="../../include/utils/portal.h.html#LN93"><span class='Ref_to_EnumConst'>PORTAL_MULTI_QUERY</span></a><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* no need to look further */ 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN292"><span class='Ref_To_Local'>stmt</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN309"></a>            <a href="../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pstmt</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pquery.c.html#LN292"><span class='Ref_To_Local'>stmt</span></a><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN309"><span class='Ref_To_Local'>pstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN52"><span class='Ref_to_Member'>canSetTag</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>++</span><a href="pquery.c.html#LN223"><span class='Ref_To_Local'>nSetTag</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                    <span class='Control'>return</span> <a href="../../include/utils/portal.h.html#LN93"><span class='Ref_to_EnumConst'>PORTAL_MULTI_QUERY</span></a><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* no need to look further */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN309"><span class='Ref_To_Local'>pstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN44"><span class='Ref_to_Member'>commandType</span></a> <span class='Operator'>== </span><a href="../../include/nodes/nodes.h.html#LN654"><span class='Ref_to_EnumConst'>CMD_UTILITY</span></a> <span class='Operator'>|| 
</span>                    <span class='Operator'>!</span><a href="pquery.c.html#LN309"><span class='Ref_To_Local'>pstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN48"><span class='Ref_to_Member'>hasReturning</span></a><span class='Parentheses'>) 
</span>                    <span class='Control'>return</span> <a href="../../include/utils/portal.h.html#LN93"><span class='Ref_to_EnumConst'>PORTAL_MULTI_QUERY</span></a><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* no need to look further */ 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized node type: %d"</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="../../include/nodes/nodes.h.html#LN513"><span class='Ref_to_Macro'>nodeTag</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN292"><span class='Ref_To_Local'>stmt</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN223"><span class='Ref_To_Local'>nSetTag</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../include/utils/portal.h.html#LN90"><span class='Ref_to_EnumConst'>PORTAL_ONE_RETURNING</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Else, it's the general case... */ 
</span>    <span class='Control'>return</span> <a href="../../include/utils/portal.h.html#LN93"><span class='Ref_to_EnumConst'>PORTAL_MULTI_QUERY</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ChoosePortalStrategy &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * FetchPortalTargetList 
 *      Given a portal that returns tuples, extract the query targetlist. 
 *      Returns NIL if the portal doesn't have a determinable targetlist. 
 * 
 * Note: do not modify the result. 
 */ 
</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN338"></a><span class='Declare_Function'>FetchPortalTargetList</span><span class='Parentheses'>(</span><a href="../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a> <span class='Declare_Parameter'>portal</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* no point in looking if we determined it doesn't return tuples */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN338"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN142"><span class='Ref_to_Member'>strategy</span></a> <span class='Operator'>== </span><a href="../../include/utils/portal.h.html#LN93"><span class='Ref_to_EnumConst'>PORTAL_MULTI_QUERY</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* get the primary statement and find out what it returns */ 
</span>    <span class='Control'>return</span> <a href="../../include/tcop/pquery.h.html#LN27"><span class='Ref_to_Proto'>FetchStatementTargetList</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../utils/mmgr/portalmem.c.html#LN148"><span class='Ref_to_Func'>PortalGetPrimaryStmt</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN338"><span class='Ref_to_Parameter'>portal</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * FetchStatementTargetList 
 *      Given a statement that returns tuples, extract the query targetlist. 
 *      Returns NIL if the statement doesn't have a determinable targetlist. 
 * 
 * This can be applied to a Query or a PlannedStmt. 
 * That's more general than portals need, but plancache.c uses this too. 
 * 
 * Note: do not modify the result. 
 * 
 * XXX be careful to keep this in sync with UtilityReturnsTuples. 
 */ 
</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN360"></a><span class='Declare_Function'>FetchStatementTargetList</span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN360"><span class='Ref_to_Parameter'>stmt</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN360"><span class='Ref_to_Parameter'>stmt</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN366"></a>        <a href="../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>query</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pquery.c.html#LN360"><span class='Ref_to_Parameter'>stmt</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN366"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN109"><span class='Ref_to_Member'>commandType</span></a> <span class='Operator'>== </span><a href="../../include/nodes/nodes.h.html#LN654"><span class='Ref_to_EnumConst'>CMD_UTILITY</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* transfer attention to utility statement */ 
</span>            <a href="pquery.c.html#LN360"><span class='Ref_to_Parameter'>stmt</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN366"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN117"><span class='Ref_to_Member'>utilityStmt</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN366"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN109"><span class='Ref_to_Member'>commandType</span></a> <span class='Operator'>== </span><a href="../../include/nodes/nodes.h.html#LN650"><span class='Ref_to_EnumConst'>CMD_SELECT</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <a href="pquery.c.html#LN366"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN137"><span class='Ref_to_Member'>targetList</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN366"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN143"><span class='Ref_to_Member'>returningList</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <a href="pquery.c.html#LN366"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN143"><span class='Ref_to_Member'>returningList</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN360"><span class='Ref_to_Parameter'>stmt</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN384"></a>        <a href="../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pstmt</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pquery.c.html#LN360"><span class='Ref_to_Parameter'>stmt</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN384"><span class='Ref_To_Local'>pstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN44"><span class='Ref_to_Member'>commandType</span></a> <span class='Operator'>== </span><a href="../../include/nodes/nodes.h.html#LN654"><span class='Ref_to_EnumConst'>CMD_UTILITY</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* transfer attention to utility statement */ 
</span>            <a href="pquery.c.html#LN360"><span class='Ref_to_Parameter'>stmt</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN384"><span class='Ref_To_Local'>pstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN93"><span class='Ref_to_Member'>utilityStmt</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN384"><span class='Ref_To_Local'>pstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN44"><span class='Ref_to_Member'>commandType</span></a> <span class='Operator'>== </span><a href="../../include/nodes/nodes.h.html#LN650"><span class='Ref_to_EnumConst'>CMD_SELECT</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <a href="pquery.c.html#LN384"><span class='Ref_To_Local'>pstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN60"><span class='Ref_to_Member'>planTree</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN384"><span class='Ref_To_Local'>pstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN48"><span class='Ref_to_Member'>hasReturning</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <a href="pquery.c.html#LN384"><span class='Ref_To_Local'>pstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN60"><span class='Ref_to_Member'>planTree</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN360"><span class='Ref_to_Parameter'>stmt</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN2647"><span class='Ref_to_Struct'>FetchStmt</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN402"></a>        <a href="../../include/nodes/parsenodes.h.html#LN2647"><span class='Ref_to_Struct'>FetchStmt</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>fstmt</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2647"><span class='Ref_to_Struct'>FetchStmt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pquery.c.html#LN360"><span class='Ref_to_Parameter'>stmt</span></a><span class='Delimiter'>; 
</span><a name="LN403"></a>        <a href="../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a>      <span class='Declare_Local'>subportal</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pquery.c.html#LN402"><span class='Ref_To_Local'>fstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2653"><span class='Ref_to_Member'>ismove</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pquery.c.html#LN403"><span class='Ref_To_Local'>subportal</span></a> <span class='Operator'>= </span><a href="../utils/mmgr/portalmem.c.html#LN127"><span class='Ref_to_Func'>GetPortalByName</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN402"><span class='Ref_To_Local'>fstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2652"><span class='Ref_to_Member'>portalname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/utils/portal.h.html#LN198"><span class='Ref_to_Macro'>PortalIsValid</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN403"><span class='Ref_To_Local'>subportal</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="../../include/tcop/pquery.h.html#LN25"><span class='Ref_to_Proto'>FetchPortalTargetList</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN403"><span class='Ref_To_Local'>subportal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN360"><span class='Ref_to_Parameter'>stmt</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN3268"><span class='Ref_to_Struct'>ExecuteStmt</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN412"></a>        <a href="../../include/nodes/parsenodes.h.html#LN3268"><span class='Ref_to_Struct'>ExecuteStmt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>estmt</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN3268"><span class='Ref_to_Struct'>ExecuteStmt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pquery.c.html#LN360"><span class='Ref_to_Parameter'>stmt</span></a><span class='Delimiter'>; 
</span><a name="LN413"></a>        <a href="../../include/commands/prepare.h.html#LN26"><span class='Ref_to_Typedef'>PreparedStatement</span></a> <span class='Operator'>*</span><span class='Declare_Local'>entry</span><span class='Delimiter'>; 
</span> 
        <a href="pquery.c.html#LN413"><span class='Ref_To_Local'>entry</span></a> <span class='Operator'>= </span><a href="../../include/commands/prepare.h.html#LN51"><span class='Ref_to_Proto'>FetchPreparedStatement</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN412"><span class='Ref_To_Local'>estmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3271"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="../../include/commands/prepare.h.html#LN55"><span class='Ref_to_Proto'>FetchPreparedStatementTargetList</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN413"><span class='Ref_To_Local'>entry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end FetchStatementTargetList &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * PortalStart 
 *      Prepare a portal for execution. 
 * 
 * Caller must already have created the portal, done PortalDefineQuery(), 
 * and adjusted portal options if needed. 
 * 
 * If parameters are needed by the query, they must be passed in "params" 
 * (caller is responsible for giving them appropriate lifetime). 
 * 
 * The caller can also provide an initial set of "eflags" to be passed to 
 * ExecutorStart (but note these can be modified internally, and they are 
 * currently only honored for PORTAL_ONE_SELECT portals).  Most callers 
 * should simply pass zero. 
 * 
 * The caller can optionally pass a snapshot to be used; pass InvalidSnapshot 
 * for the normal behavior of setting a new snapshot.  This parameter is 
 * presently ignored for non-PORTAL_ONE_SELECT portals (it's only intended 
 * to be used for cursors). 
 * 
 * On return, portal is ready to accept PortalRun() calls, and the result 
 * tupdesc (if any) is known. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN445"></a><span class='Declare_Function'>PortalStart</span><span class='Parentheses'>(</span><a href="../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a> <span class='Declare_Parameter'>portal</span><span class='Delimiter'>, </span><a href="../../include/nodes/params.h.html#LN61"><span class='Ref_to_Typedef'>ParamListInfo</span></a> <span class='Declare_Parameter'>params</span><span class='Delimiter'>, 
</span><a name="LN446"></a>            <span class='Keyword'>int </span><span class='Declare_Parameter'>eflags</span><span class='Delimiter'>, </span><a href="../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a> <span class='Declare_Parameter'>snapshot</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN448"></a>    <a href="../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a>      <span class='Declare_Local'>saveActivePortal</span><span class='Delimiter'>; 
</span><a name="LN449"></a>    <a href="../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Local'>saveResourceOwner</span><span class='Delimiter'>; 
</span><a name="LN450"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>savePortalContext</span><span class='Delimiter'>; 
</span><a name="LN451"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldContext</span><span class='Delimiter'>; 
</span><a name="LN452"></a>    <a href="../../include/executor/execdesc.h.html#LN32"><span class='Ref_to_Struct'>QueryDesc</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>queryDesc</span><span class='Delimiter'>; 
</span><a name="LN453"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>myeflags</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/c.h.html#LN676"><span class='Ref_to_Macro'>AssertArg</span></a><span class='Parentheses'>(</span><a href="../../include/utils/portal.h.html#LN198"><span class='Ref_to_Macro'>PortalIsValid</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN445"><span class='Ref_to_Parameter'>portal</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/c.h.html#LN677"><span class='Ref_to_Macro'>AssertState</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN445"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN147"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>== </span><a href="../../include/utils/portal.h.html#LN104"><span class='Ref_to_EnumConst'>PORTAL_DEFINED</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Set up global portal context pointers. 
     */ 
</span>    <a href="pquery.c.html#LN448"><span class='Ref_To_Local'>saveActivePortal</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN34"><span class='Ref_to_Global_Var'>ActivePortal</span></a><span class='Delimiter'>; 
</span>    <a href="pquery.c.html#LN449"><span class='Ref_To_Local'>saveResourceOwner</span></a> <span class='Operator'>= </span><a href="../utils/resowner/resowner.c.html#LN137"><span class='Ref_to_Global_Var'>CurrentResourceOwner</span></a><span class='Delimiter'>; 
</span>    <a href="pquery.c.html#LN450"><span class='Ref_To_Local'>savePortalContext</span></a> <span class='Operator'>= </span><a href="../utils/mmgr/mcxt.c.html#LN51"><span class='Ref_to_Global_Var'>PortalContext</span></a><span class='Delimiter'>; 
</span>    <a href="../../include/utils/elog.h.html#LN283"><span class='Ref_to_Macro'>PG_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pquery.c.html#LN34"><span class='Ref_to_Global_Var'>ActivePortal</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN445"><span class='Ref_to_Parameter'>portal</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN445"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN119"><span class='Ref_to_Member'>resowner</span></a><span class='Parentheses'>) 
</span>            <a href="../utils/resowner/resowner.c.html#LN137"><span class='Ref_to_Global_Var'>CurrentResourceOwner</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN445"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN119"><span class='Ref_to_Member'>resowner</span></a><span class='Delimiter'>; 
</span>        <a href="../utils/mmgr/mcxt.c.html#LN51"><span class='Ref_to_Global_Var'>PortalContext</span></a> <span class='Operator'>= </span><a href="../../include/utils/portal.h.html#LN204"><span class='Ref_to_Macro'>PortalGetHeapMemory</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN445"><span class='Ref_to_Parameter'>portal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pquery.c.html#LN451"><span class='Ref_To_Local'>oldContext</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../../include/utils/portal.h.html#LN204"><span class='Ref_to_Macro'>PortalGetHeapMemory</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN445"><span class='Ref_to_Parameter'>portal</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Must remember portal param list, if any */ 
</span>        <a href="pquery.c.html#LN445"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN138"><span class='Ref_to_Member'>portalParams</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN445"><span class='Ref_to_Parameter'>params</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Determine the portal execution strategy 
         */ 
</span>        <a href="pquery.c.html#LN445"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN142"><span class='Ref_to_Member'>strategy</span></a> <span class='Operator'>= </span><a href="../../include/tcop/pquery.h.html#LN23"><span class='Ref_to_Proto'>ChoosePortalStrategy</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN445"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN135"><span class='Ref_to_Member'>stmts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Fire her up according to the strategy 
         */ 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN445"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN142"><span class='Ref_to_Member'>strategy</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../include/utils/portal.h.html#LN89"><span class='Ref_to_EnumConst'>PORTAL_ONE_SELECT</span></a><span class='Operator'>: 
</span> 
                <span class='Comment_Multi_Line'>/* Must set snapshot before starting executor. */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN446"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/utils/snapmgr.h.html#LN73"><span class='Ref_to_Proto'>PushActiveSnapshot</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN446"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="../../include/utils/snapmgr.h.html#LN73"><span class='Ref_to_Proto'>PushActiveSnapshot</span></a><span class='Parentheses'>(</span><a href="../../include/utils/snapmgr.h.html#LN63"><span class='Ref_to_Proto'>GetTransactionSnapshot</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Create QueryDesc in portal's context; for the moment, set 
                 * the destination to DestNone. 
                 */ 
</span>                <a href="pquery.c.html#LN452"><span class='Ref_To_Local'>queryDesc</span></a> <span class='Operator'>= </span><a href="../../include/executor/execdesc.h.html#LN58"><span class='Ref_to_Proto'>CreateQueryDesc</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN113"><span class='Ref_to_Macro'>linitial_node</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a><span class='Delimiter'>, </span><a href="pquery.c.html#LN445"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN135"><span class='Ref_to_Member'>stmts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                            <a href="pquery.c.html#LN445"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN133"><span class='Ref_to_Member'>sourceText</span></a><span class='Delimiter'>, 
</span>                                            <a href="../../include/utils/snapmgr.h.html#LN77"><span class='Ref_to_Proto'>GetActiveSnapshot</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                                            <a href="../../include/utils/snapshot.h.html#LN24"><span class='Ref_to_Const'>InvalidSnapshot</span></a><span class='Delimiter'>, 
</span>                                            <a href="dest.c.html#LN90"><span class='Ref_to_Global_Var'>None_Receiver</span></a><span class='Delimiter'>, 
</span>                                            <a href="pquery.c.html#LN445"><span class='Ref_to_Parameter'>params</span></a><span class='Delimiter'>, 
</span>                                            <a href="pquery.c.html#LN445"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN139"><span class='Ref_to_Member'>queryEnv</span></a><span class='Delimiter'>, 
</span>                                            <span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * If it's a scrollable cursor, executor needs to support 
                 * REWIND and backwards scan, as well as whatever the caller 
                 * might've asked for. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN445"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN143"><span class='Ref_to_Member'>cursorOptions</span></a> <span class='Operator'>& </span><a href="../../include/nodes/parsenodes.h.html#LN2602"><span class='Ref_to_Const'>CURSOR_OPT_SCROLL</span></a><span class='Parentheses'>) 
</span>                    <a href="pquery.c.html#LN453"><span class='Ref_To_Local'>myeflags</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN446"><span class='Ref_to_Parameter'>eflags</span></a> <span class='Operator'>| </span><a href="../../include/executor/executor.h.html#LN58"><span class='Ref_to_Const'>EXEC_FLAG_REWIND</span></a> <span class='Operator'>| </span><a href="../../include/executor/executor.h.html#LN59"><span class='Ref_to_Const'>EXEC_FLAG_BACKWARD</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="pquery.c.html#LN453"><span class='Ref_To_Local'>myeflags</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN446"><span class='Ref_to_Parameter'>eflags</span></a><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Call ExecutorStart to prepare the plan for execution 
                 */ 
</span>                <a href="../executor/execMain.c.html#LN144"><span class='Ref_to_Func'>ExecutorStart</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN452"><span class='Ref_To_Local'>queryDesc</span></a><span class='Delimiter'>, </span><a href="pquery.c.html#LN453"><span class='Ref_To_Local'>myeflags</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * This tells PortalCleanup to shut down the executor 
                 */ 
</span>                <a href="pquery.c.html#LN445"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN151"><span class='Ref_to_Member'>queryDesc</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN452"><span class='Ref_To_Local'>queryDesc</span></a><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Remember tuple descriptor (computed by ExecutorStart) 
                 */ 
</span>                <a href="pquery.c.html#LN445"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN154"><span class='Ref_to_Member'>tupDesc</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN452"><span class='Ref_To_Local'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN46"><span class='Ref_to_Member'>tupDesc</span></a><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Reset cursor position data to "start of query" 
                 */ 
</span>                <a href="pquery.c.html#LN445"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN185"><span class='Ref_to_Member'>atStart</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="pquery.c.html#LN445"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN186"><span class='Ref_to_Member'>atEnd</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* allow fetches */ 
</span>                <a href="pquery.c.html#LN445"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN187"><span class='Ref_to_Member'>portalPos</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
                <a href="../../include/utils/snapmgr.h.html#LN76"><span class='Ref_to_Proto'>PopActiveSnapshot</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../include/utils/portal.h.html#LN90"><span class='Ref_to_EnumConst'>PORTAL_ONE_RETURNING</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/utils/portal.h.html#LN91"><span class='Ref_to_EnumConst'>PORTAL_ONE_MOD_WITH</span></a><span class='Operator'>: 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * We don't start the executor until we are told to run the 
                 * portal.  We do need to set up the result tupdesc. 
                 */ 
</span>                <span class='Delimiter'>{ 
</span><a name="LN550"></a>                    <a href="../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pstmt</span><span class='Delimiter'>; 
</span> 
                    <a href="pquery.c.html#LN550"><span class='Ref_To_Local'>pstmt</span></a> <span class='Operator'>= </span><a href="../utils/mmgr/portalmem.c.html#LN148"><span class='Ref_to_Func'>PortalGetPrimaryStmt</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN445"><span class='Ref_to_Parameter'>portal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="pquery.c.html#LN445"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN154"><span class='Ref_to_Member'>tupDesc</span></a> <span class='Operator'>= 
</span>                        <a href="../../include/executor/executor.h.html#LN406"><span class='Ref_to_Proto'>ExecCleanTypeFromTL</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN550"><span class='Ref_To_Local'>pstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN60"><span class='Ref_to_Member'>planTree</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Delimiter'>, 
</span>                                            <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Reset cursor position data to "start of query" 
                 */ 
</span>                <a href="pquery.c.html#LN445"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN185"><span class='Ref_to_Member'>atStart</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="pquery.c.html#LN445"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN186"><span class='Ref_to_Member'>atEnd</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* allow fetches */ 
</span>                <a href="pquery.c.html#LN445"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN187"><span class='Ref_to_Member'>portalPos</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../include/utils/portal.h.html#LN92"><span class='Ref_to_EnumConst'>PORTAL_UTIL_SELECT</span></a><span class='Operator'>: 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * We don't set snapshot here, because PortalRunUtility will 
                 * take care of it if needed. 
                 */ 
</span>                <span class='Delimiter'>{ 
</span><a name="LN573"></a>                    <a href="../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pstmt</span> <span class='Operator'>= </span><a href="../utils/mmgr/portalmem.c.html#LN148"><span class='Ref_to_Func'>PortalGetPrimaryStmt</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN445"><span class='Ref_to_Parameter'>portal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pquery.c.html#LN573"><span class='Ref_To_Local'>pstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN44"><span class='Ref_to_Member'>commandType</span></a> <span class='Operator'>== </span><a href="../../include/nodes/nodes.h.html#LN654"><span class='Ref_to_EnumConst'>CMD_UTILITY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="pquery.c.html#LN445"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN154"><span class='Ref_to_Member'>tupDesc</span></a> <span class='Operator'>= </span><a href="../../include/tcop/utility.h.html#LN44"><span class='Ref_to_Proto'>UtilityTupleDescriptor</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN573"><span class='Ref_To_Local'>pstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN93"><span class='Ref_to_Member'>utilityStmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Reset cursor position data to "start of query" 
                 */ 
</span>                <a href="pquery.c.html#LN445"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN185"><span class='Ref_to_Member'>atStart</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="pquery.c.html#LN445"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN186"><span class='Ref_to_Member'>atEnd</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* allow fetches */ 
</span>                <a href="pquery.c.html#LN445"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN187"><span class='Ref_to_Member'>portalPos</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../include/utils/portal.h.html#LN93"><span class='Ref_to_EnumConst'>PORTAL_MULTI_QUERY</span></a><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* Need do nothing now */ 
</span>                <a href="pquery.c.html#LN445"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN154"><span class='Ref_to_Member'>tupDesc</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch portal-&GT;strategy &raquo; </span> 
    <span class='Delimiter'>} 
</span>    <a href="../../include/utils/elog.h.html#LN292"><span class='Ref_to_Macro'>PG_CATCH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Uncaught error while executing portal: mark it dead */ 
</span>        <a href="../../include/utils/portal.h.html#LN226"><span class='Ref_to_Proto'>MarkPortalFailed</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN445"><span class='Ref_to_Parameter'>portal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Restore global vars and propagate error */ 
</span>        <a href="pquery.c.html#LN34"><span class='Ref_to_Global_Var'>ActivePortal</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN448"><span class='Ref_To_Local'>saveActivePortal</span></a><span class='Delimiter'>; 
</span>        <a href="../utils/resowner/resowner.c.html#LN137"><span class='Ref_to_Global_Var'>CurrentResourceOwner</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN449"><span class='Ref_To_Local'>saveResourceOwner</span></a><span class='Delimiter'>; 
</span>        <a href="../utils/mmgr/mcxt.c.html#LN51"><span class='Ref_to_Global_Var'>PortalContext</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN450"><span class='Ref_To_Local'>savePortalContext</span></a><span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/elog.h.html#LN310"><span class='Ref_to_Macro'>PG_RE_THROW</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../include/utils/elog.h.html#LN299"><span class='Ref_to_Macro'>PG_END_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN451"><span class='Ref_To_Local'>oldContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pquery.c.html#LN34"><span class='Ref_to_Global_Var'>ActivePortal</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN448"><span class='Ref_To_Local'>saveActivePortal</span></a><span class='Delimiter'>; 
</span>    <a href="../utils/resowner/resowner.c.html#LN137"><span class='Ref_to_Global_Var'>CurrentResourceOwner</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN449"><span class='Ref_To_Local'>saveResourceOwner</span></a><span class='Delimiter'>; 
</span>    <a href="../utils/mmgr/mcxt.c.html#LN51"><span class='Ref_to_Global_Var'>PortalContext</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN450"><span class='Ref_To_Local'>savePortalContext</span></a><span class='Delimiter'>; 
</span> 
    <a href="pquery.c.html#LN445"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN147"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="../../include/utils/portal.h.html#LN105"><span class='Ref_to_EnumConst'>PORTAL_READY</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end PortalStart &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * PortalSetResultFormat 
 *      Select the format codes for a portal's output. 
 * 
 * This must be run after PortalStart for a portal that will be read by 
 * a DestRemote or DestRemoteExecute destination.  It is not presently needed 
 * for other destination types. 
 * 
 * formats[] is the client format request, as per Bind message conventions. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN627"></a><span class='Declare_Function'>PortalSetResultFormat</span><span class='Parentheses'>(</span><a href="../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a> <span class='Declare_Parameter'>portal</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>nFormats</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>formats</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN629"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>natts</span><span class='Delimiter'>; 
</span><a name="LN630"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Do nothing if portal won't return tuples */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN627"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN154"><span class='Ref_to_Member'>tupDesc</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <a href="pquery.c.html#LN629"><span class='Ref_To_Local'>natts</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN627"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN154"><span class='Ref_to_Member'>tupDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; 
</span>    <a href="pquery.c.html#LN627"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN156"><span class='Ref_to_Member'>formats</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="../../include/utils/portal.h.html#LN204"><span class='Ref_to_Macro'>PortalGetHeapMemory</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN627"><span class='Ref_to_Parameter'>portal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="pquery.c.html#LN629"><span class='Ref_To_Local'>natts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN627"><span class='Ref_to_Parameter'>nFormats</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* format specified for each column */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN627"><span class='Ref_to_Parameter'>nFormats</span></a> <span class='Operator'>!= </span><a href="pquery.c.html#LN629"><span class='Ref_To_Local'>natts</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_PROTOCOL_VIOLATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"bind message has %d result formats but query has %d columns"</span><span class='Delimiter'>, 
</span>                            <a href="pquery.c.html#LN627"><span class='Ref_to_Parameter'>nFormats</span></a><span class='Delimiter'>, </span><a href="pquery.c.html#LN629"><span class='Ref_To_Local'>natts</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><a href="pquery.c.html#LN627"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN156"><span class='Ref_to_Member'>formats</span></a><span class='Delimiter'>, </span><a href="pquery.c.html#LN627"><span class='Ref_to_Parameter'>formats</span></a><span class='Delimiter'>, </span><a href="pquery.c.html#LN629"><span class='Ref_To_Local'>natts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN627"><span class='Ref_to_Parameter'>nFormats</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* single format specified, use for all columns */ 
</span><a name="LN652"></a>        <a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>       <span class='Declare_Local'>format1</span> <span class='Operator'>= </span><a href="pquery.c.html#LN627"><span class='Ref_to_Parameter'>formats</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN630"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pquery.c.html#LN630"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pquery.c.html#LN629"><span class='Ref_To_Local'>natts</span></a><span class='Delimiter'>; </span><a href="pquery.c.html#LN630"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <a href="pquery.c.html#LN627"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN156"><span class='Ref_to_Member'>formats</span></a><span class='Delimiter'>[</span><a href="pquery.c.html#LN630"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pquery.c.html#LN652"><span class='Ref_To_Local'>format1</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* use default format for all columns */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN630"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pquery.c.html#LN630"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pquery.c.html#LN629"><span class='Ref_To_Local'>natts</span></a><span class='Delimiter'>; </span><a href="pquery.c.html#LN630"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <a href="pquery.c.html#LN627"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN156"><span class='Ref_to_Member'>formats</span></a><span class='Delimiter'>[</span><a href="pquery.c.html#LN630"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end PortalSetResultFormat &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * PortalRun 
 *      Run a portal's query or queries. 
 * 
 * count &LT;= 0 is interpreted as a no-op: the destination gets started up 
 * and shut down, but nothing else happens.  Also, count == FETCH_ALL is 
 * interpreted as "all rows".  Note that count is ignored in multi-query 
 * situations, where we always run the portal to completion. 
 * 
 * isTopLevel: true if query is being executed at backend "top level" 
 * (that is, directly from a client command message) 
 * 
 * dest: where to send output of primary (canSetTag) query 
 * 
 * altdest: where to send output of non-primary queries 
 * 
 * completionTag: points to a buffer of size COMPLETION_TAG_BUFSIZE 
 *      in which to store a command completion status string. 
 *      May be NULL if caller doesn't want a status string. 
 * 
 * Returns TRUE if the portal's execution is complete, FALSE if it was 
 * suspended due to exhaustion of the count parameter. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN689"></a><span class='Declare_Function'>PortalRun</span><span class='Parentheses'>(</span><a href="../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a> <span class='Declare_Parameter'>portal</span><span class='Delimiter'>, </span><span class='Keyword'>long </span><span class='Declare_Parameter'>count</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isTopLevel</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>run_once</span><span class='Delimiter'>, 
</span><a name="LN690"></a>          <a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>dest</span><span class='Delimiter'>, </span><a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>altdest</span><span class='Delimiter'>, 
</span><a name="LN691"></a>          <span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>completionTag</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN693"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN694"></a>    <a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a>      <span class='Declare_Local'>nprocessed</span><span class='Delimiter'>; 
</span><a name="LN695"></a>    <a href="../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Local'>saveTopTransactionResourceOwner</span><span class='Delimiter'>; 
</span><a name="LN696"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>saveTopTransactionContext</span><span class='Delimiter'>; 
</span><a name="LN697"></a>    <a href="../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a>      <span class='Declare_Local'>saveActivePortal</span><span class='Delimiter'>; 
</span><a name="LN698"></a>    <a href="../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Local'>saveResourceOwner</span><span class='Delimiter'>; 
</span><a name="LN699"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>savePortalContext</span><span class='Delimiter'>; 
</span><a name="LN700"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>saveMemoryContext</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/c.h.html#LN676"><span class='Ref_to_Macro'>AssertArg</span></a><span class='Parentheses'>(</span><a href="../../include/utils/portal.h.html#LN198"><span class='Ref_to_Macro'>PortalIsValid</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN689"><span class='Ref_to_Parameter'>portal</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    TRACE_POSTGRESQL_QUERY_EXECUTE_START<span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Initialize completion tag to empty string */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN691"><span class='Ref_to_Parameter'>completionTag</span></a><span class='Parentheses'>) 
</span>        <a href="pquery.c.html#LN691"><span class='Ref_to_Parameter'>completionTag</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/guc.c.html#LN439"><span class='Ref_to_Global_Var'>log_executor_stats</span></a> <span class='Operator'>&& </span><a href="pquery.c.html#LN689"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN142"><span class='Ref_to_Member'>strategy</span></a> <span class='Operator'>!= </span><a href="../../include/utils/portal.h.html#LN93"><span class='Ref_to_EnumConst'>PORTAL_MULTI_QUERY</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN22"><span class='Ref_to_Const'>DEBUG3</span></a><span class='Delimiter'>, </span><span class='String'>"PortalRun"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* PORTAL_MULTI_QUERY logs its own stats per query */ 
</span>        <a href="../../include/tcop/tcopprot.h.html#LN82"><span class='Ref_to_Proto'>ResetUsage</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check for improper portal use, and mark portal active. 
     */ 
</span>    <a href="../../include/utils/portal.h.html#LN224"><span class='Ref_to_Proto'>MarkPortalActive</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN689"><span class='Ref_to_Parameter'>portal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Set run_once flag.  Shouldn't be clear if previously set. */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pquery.c.html#LN689"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN144"><span class='Ref_to_Member'>run_once</span></a> <span class='Operator'>|| </span><a href="pquery.c.html#LN689"><span class='Ref_to_Parameter'>run_once</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pquery.c.html#LN689"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN144"><span class='Ref_to_Member'>run_once</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN689"><span class='Ref_to_Parameter'>run_once</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Set up global portal context pointers. 
     * 
     * We have to play a special game here to support utility commands like 
     * VACUUM and CLUSTER, which internally start and commit transactions. 
     * When we are called to execute such a command, CurrentResourceOwner will 
     * be pointing to the TopTransactionResourceOwner --- which will be 
     * destroyed and replaced in the course of the internal commit and 
     * restart.  So we need to be prepared to restore it as pointing to the 
     * exit-time TopTransactionResourceOwner.  (Ain't that ugly?  This idea of 
     * internally starting whole new transactions is not good.) 
     * CurrentMemoryContext has a similar problem, but the other pointers we 
     * save here will be NULL or pointing to longer-lived objects. 
     */ 
</span>    <a href="pquery.c.html#LN695"><span class='Ref_To_Local'>saveTopTransactionResourceOwner</span></a> <span class='Operator'>= </span><a href="../utils/resowner/resowner.c.html#LN139"><span class='Ref_to_Global_Var'>TopTransactionResourceOwner</span></a><span class='Delimiter'>; 
</span>    <a href="pquery.c.html#LN696"><span class='Ref_To_Local'>saveTopTransactionContext</span></a> <span class='Operator'>= </span><a href="../utils/mmgr/mcxt.c.html#LN47"><span class='Ref_to_Global_Var'>TopTransactionContext</span></a><span class='Delimiter'>; 
</span>    <a href="pquery.c.html#LN697"><span class='Ref_To_Local'>saveActivePortal</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN34"><span class='Ref_to_Global_Var'>ActivePortal</span></a><span class='Delimiter'>; 
</span>    <a href="pquery.c.html#LN698"><span class='Ref_To_Local'>saveResourceOwner</span></a> <span class='Operator'>= </span><a href="../utils/resowner/resowner.c.html#LN137"><span class='Ref_to_Global_Var'>CurrentResourceOwner</span></a><span class='Delimiter'>; 
</span>    <a href="pquery.c.html#LN699"><span class='Ref_To_Local'>savePortalContext</span></a> <span class='Operator'>= </span><a href="../utils/mmgr/mcxt.c.html#LN51"><span class='Ref_to_Global_Var'>PortalContext</span></a><span class='Delimiter'>; 
</span>    <a href="pquery.c.html#LN700"><span class='Ref_To_Local'>saveMemoryContext</span></a> <span class='Operator'>= </span><a href="../utils/mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>; 
</span>    <a href="../../include/utils/elog.h.html#LN283"><span class='Ref_to_Macro'>PG_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pquery.c.html#LN34"><span class='Ref_to_Global_Var'>ActivePortal</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN689"><span class='Ref_to_Parameter'>portal</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN689"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN119"><span class='Ref_to_Member'>resowner</span></a><span class='Parentheses'>) 
</span>            <a href="../utils/resowner/resowner.c.html#LN137"><span class='Ref_to_Global_Var'>CurrentResourceOwner</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN689"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN119"><span class='Ref_to_Member'>resowner</span></a><span class='Delimiter'>; 
</span>        <a href="../utils/mmgr/mcxt.c.html#LN51"><span class='Ref_to_Global_Var'>PortalContext</span></a> <span class='Operator'>= </span><a href="../../include/utils/portal.h.html#LN204"><span class='Ref_to_Macro'>PortalGetHeapMemory</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN689"><span class='Ref_to_Parameter'>portal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN51"><span class='Ref_to_Global_Var'>PortalContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN689"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN142"><span class='Ref_to_Member'>strategy</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../include/utils/portal.h.html#LN89"><span class='Ref_to_EnumConst'>PORTAL_ONE_SELECT</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/utils/portal.h.html#LN90"><span class='Ref_to_EnumConst'>PORTAL_ONE_RETURNING</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/utils/portal.h.html#LN91"><span class='Ref_to_EnumConst'>PORTAL_ONE_MOD_WITH</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/utils/portal.h.html#LN92"><span class='Ref_to_EnumConst'>PORTAL_UTIL_SELECT</span></a><span class='Operator'>: 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * If we have not yet run the command, do so, storing its 
                 * results in the portal's tuplestore.  But we don't do that 
                 * for the PORTAL_ONE_SELECT case. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN689"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN142"><span class='Ref_to_Member'>strategy</span></a> <span class='Operator'>!= </span><a href="../../include/utils/portal.h.html#LN89"><span class='Ref_to_EnumConst'>PORTAL_ONE_SELECT</span></a> <span class='Operator'>&& !</span><a href="pquery.c.html#LN689"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN163"><span class='Ref_to_Member'>holdStore</span></a><span class='Parentheses'>) 
</span>                    <a href="pquery.c.html#LN43"><span class='Ref_to_Proto'>FillPortalStore</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN689"><span class='Ref_to_Parameter'>portal</span></a><span class='Delimiter'>, </span><a href="pquery.c.html#LN689"><span class='Ref_to_Parameter'>isTopLevel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Now fetch desired portion of results. 
                 */ 
</span>                <a href="pquery.c.html#LN694"><span class='Ref_To_Local'>nprocessed</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN46"><span class='Ref_to_Proto'>PortalRunSelect</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN689"><span class='Ref_to_Parameter'>portal</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="pquery.c.html#LN689"><span class='Ref_to_Parameter'>count</span></a><span class='Delimiter'>, </span><a href="pquery.c.html#LN690"><span class='Ref_to_Parameter'>dest</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * If the portal result contains a command tag and the caller 
                 * gave us a pointer to store it, copy it. Patch the "SELECT" 
                 * tag to also provide the rowcount. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN691"><span class='Ref_to_Parameter'>completionTag</span></a> <span class='Operator'>&& </span><a href="pquery.c.html#LN689"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN134"><span class='Ref_to_Member'>commandTag</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pquery.c.html#LN689"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN134"><span class='Ref_to_Member'>commandTag</span></a><span class='Delimiter'>, </span><span class='String'>"SELECT"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN691"><span class='Ref_to_Parameter'>completionTag</span></a><span class='Delimiter'>, </span><a href="../../include/tcop/dest.h.html#LN73"><span class='Ref_to_Const'>COMPLETION_TAG_BUFSIZE</span></a><span class='Delimiter'>, 
</span>                                 <span class='String'>"SELECT "</span> <a href="../../include/c.h.html#LN315"><span class='Ref_to_Const'>UINT64_FORMAT</span></a><span class='Delimiter'>, </span><a href="pquery.c.html#LN694"><span class='Ref_To_Local'>nprocessed</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> 
                        <a href="../../../contrib/cube/cubeparse.y.html#LN150"><span class='Ref_to_Proto'>strcpy</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN691"><span class='Ref_to_Parameter'>completionTag</span></a><span class='Delimiter'>, </span><a href="pquery.c.html#LN689"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN134"><span class='Ref_to_Member'>commandTag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Comment_Multi_Line'>/* Mark portal not active */ 
</span>                <a href="pquery.c.html#LN689"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN147"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="../../include/utils/portal.h.html#LN105"><span class='Ref_to_EnumConst'>PORTAL_READY</span></a><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Since it's a forward fetch, say DONE iff atEnd is now true. 
                 */ 
</span>                <a href="pquery.c.html#LN693"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN689"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN186"><span class='Ref_to_Member'>atEnd</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../include/utils/portal.h.html#LN93"><span class='Ref_to_EnumConst'>PORTAL_MULTI_QUERY</span></a><span class='Operator'>: 
</span>                <a href="pquery.c.html#LN51"><span class='Ref_to_Proto'>PortalRunMulti</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN689"><span class='Ref_to_Parameter'>portal</span></a><span class='Delimiter'>, </span><a href="pquery.c.html#LN689"><span class='Ref_to_Parameter'>isTopLevel</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                               <a href="pquery.c.html#LN690"><span class='Ref_to_Parameter'>dest</span></a><span class='Delimiter'>, </span><a href="pquery.c.html#LN690"><span class='Ref_to_Parameter'>altdest</span></a><span class='Delimiter'>, </span><a href="pquery.c.html#LN691"><span class='Ref_to_Parameter'>completionTag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Prevent portal's commands from being re-executed */ 
</span>                <a href="../../include/utils/portal.h.html#LN225"><span class='Ref_to_Proto'>MarkPortalDone</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN689"><span class='Ref_to_Parameter'>portal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Always complete at end of RunMulti */ 
</span>                <a href="pquery.c.html#LN693"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized portal strategy: %d"</span><span class='Delimiter'>, 
</span>                     <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="pquery.c.html#LN689"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN142"><span class='Ref_to_Member'>strategy</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pquery.c.html#LN693"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch portal-&GT;strategy &raquo; </span> 
    <span class='Delimiter'>} 
</span>    <a href="../../include/utils/elog.h.html#LN292"><span class='Ref_to_Macro'>PG_CATCH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Uncaught error while executing portal: mark it dead */ 
</span>        <a href="../../include/utils/portal.h.html#LN226"><span class='Ref_to_Proto'>MarkPortalFailed</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN689"><span class='Ref_to_Parameter'>portal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Restore global vars and propagate error */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN700"><span class='Ref_To_Local'>saveMemoryContext</span></a> <span class='Operator'>== </span><a href="pquery.c.html#LN696"><span class='Ref_To_Local'>saveTopTransactionContext</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN47"><span class='Ref_to_Global_Var'>TopTransactionContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN700"><span class='Ref_To_Local'>saveMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pquery.c.html#LN34"><span class='Ref_to_Global_Var'>ActivePortal</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN697"><span class='Ref_To_Local'>saveActivePortal</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN698"><span class='Ref_To_Local'>saveResourceOwner</span></a> <span class='Operator'>== </span><a href="pquery.c.html#LN695"><span class='Ref_To_Local'>saveTopTransactionResourceOwner</span></a><span class='Parentheses'>) 
</span>            <a href="../utils/resowner/resowner.c.html#LN137"><span class='Ref_to_Global_Var'>CurrentResourceOwner</span></a> <span class='Operator'>= </span><a href="../utils/resowner/resowner.c.html#LN139"><span class='Ref_to_Global_Var'>TopTransactionResourceOwner</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../utils/resowner/resowner.c.html#LN137"><span class='Ref_to_Global_Var'>CurrentResourceOwner</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN698"><span class='Ref_To_Local'>saveResourceOwner</span></a><span class='Delimiter'>; 
</span>        <a href="../utils/mmgr/mcxt.c.html#LN51"><span class='Ref_to_Global_Var'>PortalContext</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN699"><span class='Ref_To_Local'>savePortalContext</span></a><span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/elog.h.html#LN310"><span class='Ref_to_Macro'>PG_RE_THROW</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../include/utils/elog.h.html#LN299"><span class='Ref_to_Macro'>PG_END_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN700"><span class='Ref_To_Local'>saveMemoryContext</span></a> <span class='Operator'>== </span><a href="pquery.c.html#LN696"><span class='Ref_To_Local'>saveTopTransactionContext</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN47"><span class='Ref_to_Global_Var'>TopTransactionContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN700"><span class='Ref_To_Local'>saveMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pquery.c.html#LN34"><span class='Ref_to_Global_Var'>ActivePortal</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN697"><span class='Ref_To_Local'>saveActivePortal</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN698"><span class='Ref_To_Local'>saveResourceOwner</span></a> <span class='Operator'>== </span><a href="pquery.c.html#LN695"><span class='Ref_To_Local'>saveTopTransactionResourceOwner</span></a><span class='Parentheses'>) 
</span>        <a href="../utils/resowner/resowner.c.html#LN137"><span class='Ref_to_Global_Var'>CurrentResourceOwner</span></a> <span class='Operator'>= </span><a href="../utils/resowner/resowner.c.html#LN139"><span class='Ref_to_Global_Var'>TopTransactionResourceOwner</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../utils/resowner/resowner.c.html#LN137"><span class='Ref_to_Global_Var'>CurrentResourceOwner</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN698"><span class='Ref_To_Local'>saveResourceOwner</span></a><span class='Delimiter'>; 
</span>    <a href="../utils/mmgr/mcxt.c.html#LN51"><span class='Ref_to_Global_Var'>PortalContext</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN699"><span class='Ref_To_Local'>savePortalContext</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/guc.c.html#LN439"><span class='Ref_to_Global_Var'>log_executor_stats</span></a> <span class='Operator'>&& </span><a href="pquery.c.html#LN689"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN142"><span class='Ref_to_Member'>strategy</span></a> <span class='Operator'>!= </span><a href="../../include/utils/portal.h.html#LN93"><span class='Ref_to_EnumConst'>PORTAL_MULTI_QUERY</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/tcop/tcopprot.h.html#LN83"><span class='Ref_to_Proto'>ShowUsage</span></a><span class='Parentheses'>(</span><span class='String'>"EXECUTOR STATISTICS"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    TRACE_POSTGRESQL_QUERY_EXECUTE_DONE<span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pquery.c.html#LN693"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end PortalRun &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * PortalRunSelect 
 *      Execute a portal's query in PORTAL_ONE_SELECT mode, and also 
 *      when fetching from a completed holdStore in PORTAL_ONE_RETURNING, 
 *      PORTAL_ONE_MOD_WITH, and PORTAL_UTIL_SELECT cases. 
 * 
 * This handles simple N-rows-forward-or-backward cases.  For more complex 
 * nonsequential access to a portal, see PortalRunFetch. 
 * 
 * count &LT;= 0 is interpreted as a no-op: the destination gets started up 
 * and shut down, but nothing else happens.  Also, count == FETCH_ALL is 
 * interpreted as "all rows".  (cf FetchStmt.howMany) 
 * 
 * Caller must already have validated the Portal and done appropriate 
 * setup (cf. PortalRun). 
 * 
 * Returns number of rows processed (suitable for use in result tag) 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> 
<a name="LN875"></a><span class='Declare_Function'>PortalRunSelect</span><span class='Parentheses'>(</span><a href="../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a> <span class='Declare_Parameter'>portal</span><span class='Delimiter'>, 
</span><a name="LN876"></a>                <span class='Keyword'>bool </span><span class='Declare_Parameter'>forward</span><span class='Delimiter'>, 
</span><a name="LN877"></a>                <span class='Keyword'>long </span><span class='Declare_Parameter'>count</span><span class='Delimiter'>, 
</span><a name="LN878"></a>                <a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>dest</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN880"></a>    <a href="../../include/executor/execdesc.h.html#LN32"><span class='Ref_to_Struct'>QueryDesc</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>queryDesc</span><span class='Delimiter'>; 
</span><a name="LN881"></a>    <a href="../../include/access/sdir.h.html#LN21"><span class='Ref_to_Enum'>ScanDirection</span></a> <span class='Declare_Local'>direction</span><span class='Delimiter'>; 
</span><a name="LN882"></a>    <a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a>      <span class='Declare_Local'>nprocessed</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * NB: queryDesc will be NULL if we are fetching from a held cursor or a 
     * completed utility query; can't use it in that path. 
     */ 
</span>    <a href="pquery.c.html#LN880"><span class='Ref_To_Local'>queryDesc</span></a> <span class='Operator'>= </span><a href="../../include/utils/portal.h.html#LN203"><span class='Ref_to_Macro'>PortalGetQueryDesc</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN875"><span class='Ref_to_Parameter'>portal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Caller messed up if we have neither a ready query nor held data. */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pquery.c.html#LN880"><span class='Ref_To_Local'>queryDesc</span></a> <span class='Operator'>|| </span><a href="pquery.c.html#LN875"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN163"><span class='Ref_to_Member'>holdStore</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Force the queryDesc destination to the right thing.  This supports 
     * MOVE, for example, which will pass in dest = DestNone.  This is okay to 
     * change as long as we do it on every fetch.  (The Executor must not 
     * assume that dest never changes.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN880"><span class='Ref_To_Local'>queryDesc</span></a><span class='Parentheses'>) 
</span>        <a href="pquery.c.html#LN880"><span class='Ref_To_Local'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN40"><span class='Ref_to_Member'>dest</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN878"><span class='Ref_to_Parameter'>dest</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Determine which direction to go in, and check to see if we're already 
     * at the end of the available tuples in that direction.  If so, set the 
     * direction to NoMovement to avoid trying to fetch any tuples.  (This 
     * check exists because not all plan node types are robust about being 
     * called again if they've already returned NULL once.)  Then call the 
     * executor (we must not skip this, because the destination needs to see a 
     * setup and shutdown even if no tuples are available).  Finally, update 
     * the portal position state depending on the number of tuples that were 
     * retrieved. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN876"><span class='Ref_to_Parameter'>forward</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN875"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN186"><span class='Ref_to_Member'>atEnd</span></a> <span class='Operator'>|| </span><a href="pquery.c.html#LN877"><span class='Ref_to_Parameter'>count</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pquery.c.html#LN881"><span class='Ref_To_Local'>direction</span></a> <span class='Operator'>= </span><a href="../../include/access/sdir.h.html#LN24"><span class='Ref_to_EnumConst'>NoMovementScanDirection</span></a><span class='Delimiter'>; 
</span>            <a href="pquery.c.html#LN877"><span class='Ref_to_Parameter'>count</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* don't pass negative count to executor */ 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="pquery.c.html#LN881"><span class='Ref_To_Local'>direction</span></a> <span class='Operator'>= </span><a href="../../include/access/sdir.h.html#LN25"><span class='Ref_to_EnumConst'>ForwardScanDirection</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* In the executor, zero count processes all rows */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN877"><span class='Ref_to_Parameter'>count</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN2645"><span class='Ref_to_Const'>FETCH_ALL</span></a><span class='Parentheses'>) 
</span>            <a href="pquery.c.html#LN877"><span class='Ref_to_Parameter'>count</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN875"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN163"><span class='Ref_to_Member'>holdStore</span></a><span class='Parentheses'>) 
</span>            <a href="pquery.c.html#LN882"><span class='Ref_To_Local'>nprocessed</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN44"><span class='Ref_to_Proto'>RunFromStore</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN875"><span class='Ref_to_Parameter'>portal</span></a><span class='Delimiter'>, </span><a href="pquery.c.html#LN881"><span class='Ref_To_Local'>direction</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a><span class='Parentheses'>) </span><a href="pquery.c.html#LN877"><span class='Ref_to_Parameter'>count</span></a><span class='Delimiter'>, </span><a href="pquery.c.html#LN878"><span class='Ref_to_Parameter'>dest</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/snapmgr.h.html#LN73"><span class='Ref_to_Proto'>PushActiveSnapshot</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN880"><span class='Ref_To_Local'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN38"><span class='Ref_to_Member'>snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/executor/executor.h.html#LN169"><span class='Ref_to_Proto'>ExecutorRun</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN880"><span class='Ref_To_Local'>queryDesc</span></a><span class='Delimiter'>, </span><a href="pquery.c.html#LN881"><span class='Ref_To_Local'>direction</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a><span class='Parentheses'>) </span><a href="pquery.c.html#LN877"><span class='Ref_to_Parameter'>count</span></a><span class='Delimiter'>, 
</span>                        <a href="pquery.c.html#LN875"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN144"><span class='Ref_to_Member'>run_once</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pquery.c.html#LN882"><span class='Ref_To_Local'>nprocessed</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN880"><span class='Ref_To_Local'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN47"><span class='Ref_to_Member'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN453"><span class='Ref_to_Member'>es_processed</span></a><span class='Delimiter'>; 
</span>            <a href="../../include/utils/snapmgr.h.html#LN76"><span class='Ref_to_Proto'>PopActiveSnapshot</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/sdir.h.html#LN47"><span class='Ref_to_Macro'>ScanDirectionIsNoMovement</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN881"><span class='Ref_To_Local'>direction</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN882"><span class='Ref_To_Local'>nprocessed</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="pquery.c.html#LN875"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN185"><span class='Ref_to_Member'>atStart</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* OK to go backward now */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN877"><span class='Ref_to_Parameter'>count</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="pquery.c.html#LN882"><span class='Ref_To_Local'>nprocessed</span></a> <span class='Operator'>&LT; </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a><span class='Parentheses'>) </span><a href="pquery.c.html#LN877"><span class='Ref_to_Parameter'>count</span></a><span class='Parentheses'>)</span> 
                <a href="pquery.c.html#LN875"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN186"><span class='Ref_to_Member'>atEnd</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* we retrieved 'em all */ 
</span>            <a href="pquery.c.html#LN875"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN187"><span class='Ref_to_Member'>portalPos</span></a> <span class='Operator'>+= </span><a href="pquery.c.html#LN882"><span class='Ref_To_Local'>nprocessed</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if forward &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN875"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN143"><span class='Ref_to_Member'>cursorOptions</span></a> <span class='Operator'>& </span><a href="../../include/nodes/parsenodes.h.html#LN2603"><span class='Ref_to_Const'>CURSOR_OPT_NO_SCROLL</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cursor can only scan forward"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Declare it with SCROLL option to enable backward scan."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN875"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN185"><span class='Ref_to_Member'>atStart</span></a> <span class='Operator'>|| </span><a href="pquery.c.html#LN877"><span class='Ref_to_Parameter'>count</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pquery.c.html#LN881"><span class='Ref_To_Local'>direction</span></a> <span class='Operator'>= </span><a href="../../include/access/sdir.h.html#LN24"><span class='Ref_to_EnumConst'>NoMovementScanDirection</span></a><span class='Delimiter'>; 
</span>            <a href="pquery.c.html#LN877"><span class='Ref_to_Parameter'>count</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* don't pass negative count to executor */ 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="pquery.c.html#LN881"><span class='Ref_To_Local'>direction</span></a> <span class='Operator'>= </span><a href="../../include/access/sdir.h.html#LN23"><span class='Ref_to_EnumConst'>BackwardScanDirection</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* In the executor, zero count processes all rows */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN877"><span class='Ref_to_Parameter'>count</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN2645"><span class='Ref_to_Const'>FETCH_ALL</span></a><span class='Parentheses'>) 
</span>            <a href="pquery.c.html#LN877"><span class='Ref_to_Parameter'>count</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN875"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN163"><span class='Ref_to_Member'>holdStore</span></a><span class='Parentheses'>) 
</span>            <a href="pquery.c.html#LN882"><span class='Ref_To_Local'>nprocessed</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN44"><span class='Ref_to_Proto'>RunFromStore</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN875"><span class='Ref_to_Parameter'>portal</span></a><span class='Delimiter'>, </span><a href="pquery.c.html#LN881"><span class='Ref_To_Local'>direction</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a><span class='Parentheses'>) </span><a href="pquery.c.html#LN877"><span class='Ref_to_Parameter'>count</span></a><span class='Delimiter'>, </span><a href="pquery.c.html#LN878"><span class='Ref_to_Parameter'>dest</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/snapmgr.h.html#LN73"><span class='Ref_to_Proto'>PushActiveSnapshot</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN880"><span class='Ref_To_Local'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN38"><span class='Ref_to_Member'>snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/executor/executor.h.html#LN169"><span class='Ref_to_Proto'>ExecutorRun</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN880"><span class='Ref_To_Local'>queryDesc</span></a><span class='Delimiter'>, </span><a href="pquery.c.html#LN881"><span class='Ref_To_Local'>direction</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a><span class='Parentheses'>) </span><a href="pquery.c.html#LN877"><span class='Ref_to_Parameter'>count</span></a><span class='Delimiter'>, 
</span>                        <a href="pquery.c.html#LN875"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN144"><span class='Ref_to_Member'>run_once</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pquery.c.html#LN882"><span class='Ref_To_Local'>nprocessed</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN880"><span class='Ref_To_Local'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN47"><span class='Ref_to_Member'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN453"><span class='Ref_to_Member'>es_processed</span></a><span class='Delimiter'>; 
</span>            <a href="../../include/utils/snapmgr.h.html#LN76"><span class='Ref_to_Proto'>PopActiveSnapshot</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/sdir.h.html#LN47"><span class='Ref_to_Macro'>ScanDirectionIsNoMovement</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN881"><span class='Ref_To_Local'>direction</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN882"><span class='Ref_To_Local'>nprocessed</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="pquery.c.html#LN875"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN186"><span class='Ref_to_Member'>atEnd</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="pquery.c.html#LN875"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN186"><span class='Ref_to_Member'>atEnd</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* OK to go forward now */ 
</span>                <a href="pquery.c.html#LN875"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN187"><span class='Ref_to_Member'>portalPos</span></a><span class='Operator'>++</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* adjust for endpoint case */ 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN877"><span class='Ref_to_Parameter'>count</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="pquery.c.html#LN882"><span class='Ref_To_Local'>nprocessed</span></a> <span class='Operator'>&LT; </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a><span class='Parentheses'>) </span><a href="pquery.c.html#LN877"><span class='Ref_to_Parameter'>count</span></a><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <a href="pquery.c.html#LN875"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN185"><span class='Ref_to_Member'>atStart</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* we retrieved 'em all */ 
</span>                <a href="pquery.c.html#LN875"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN187"><span class='Ref_to_Member'>portalPos</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="pquery.c.html#LN875"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN187"><span class='Ref_to_Member'>portalPos</span></a> <span class='Operator'>-= </span><a href="pquery.c.html#LN882"><span class='Ref_To_Local'>nprocessed</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Control'>return</span> <a href="pquery.c.html#LN882"><span class='Ref_To_Local'>nprocessed</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end PortalRunSelect &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * FillPortalStore 
 *      Run the query and load result tuples into the portal's tuple store. 
 * 
 * This is used for PORTAL_ONE_RETURNING, PORTAL_ONE_MOD_WITH, and 
 * PORTAL_UTIL_SELECT cases only. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1008"></a><span class='Declare_Function'>FillPortalStore</span><span class='Parentheses'>(</span><a href="../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a> <span class='Declare_Parameter'>portal</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isTopLevel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1010"></a>    <a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Local'>treceiver</span><span class='Delimiter'>; 
</span><a name="LN1011"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>completionTag</span><span class='Delimiter'>[</span><a href="../../include/tcop/dest.h.html#LN73"><span class='Ref_to_Const'>COMPLETION_TAG_BUFSIZE</span></a><span class='Delimiter'>]; 
</span> 
    <a href="../../include/utils/portal.h.html#LN236"><span class='Ref_to_Proto'>PortalCreateHoldStore</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1008"><span class='Ref_to_Parameter'>portal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pquery.c.html#LN1010"><span class='Ref_To_Local'>treceiver</span></a> <span class='Operator'>= </span><a href="dest.c.html#LN107"><span class='Ref_to_Func'>CreateDestReceiver</span></a><span class='Parentheses'>(</span><a href="../../include/tcop/dest.h.html#LN93"><span class='Ref_to_EnumConst'>DestTuplestore</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/executor/tstoreReceiver.h.html#LN23"><span class='Ref_to_Proto'>SetTuplestoreDestReceiverParams</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1010"><span class='Ref_To_Local'>treceiver</span></a><span class='Delimiter'>, 
</span>                                    <a href="pquery.c.html#LN1008"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN163"><span class='Ref_to_Member'>holdStore</span></a><span class='Delimiter'>, 
</span>                                    <a href="pquery.c.html#LN1008"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN164"><span class='Ref_to_Member'>holdContext</span></a><span class='Delimiter'>, 
</span>                                    <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pquery.c.html#LN1011"><span class='Ref_To_Local'>completionTag</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN1008"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN142"><span class='Ref_to_Member'>strategy</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/utils/portal.h.html#LN90"><span class='Ref_to_EnumConst'>PORTAL_ONE_RETURNING</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/utils/portal.h.html#LN91"><span class='Ref_to_EnumConst'>PORTAL_ONE_MOD_WITH</span></a><span class='Operator'>: 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Run the portal to completion just as for the default 
             * MULTI_QUERY case, but send the primary query's output to the 
             * tuplestore.  Auxiliary query outputs are discarded.  Set the 
             * portal's holdSnapshot to the snapshot used (or a copy of it). 
             */ 
</span>            <a href="pquery.c.html#LN51"><span class='Ref_to_Proto'>PortalRunMulti</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1008"><span class='Ref_to_Parameter'>portal</span></a><span class='Delimiter'>, </span><a href="pquery.c.html#LN1008"><span class='Ref_to_Parameter'>isTopLevel</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                           <a href="pquery.c.html#LN1010"><span class='Ref_To_Local'>treceiver</span></a><span class='Delimiter'>, </span><a href="dest.c.html#LN90"><span class='Ref_to_Global_Var'>None_Receiver</span></a><span class='Delimiter'>, </span><a href="pquery.c.html#LN1011"><span class='Ref_To_Local'>completionTag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../include/utils/portal.h.html#LN92"><span class='Ref_to_EnumConst'>PORTAL_UTIL_SELECT</span></a><span class='Operator'>: 
</span>            <a href="pquery.c.html#LN48"><span class='Ref_to_Proto'>PortalRunUtility</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1008"><span class='Ref_to_Parameter'>portal</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN113"><span class='Ref_to_Macro'>linitial_node</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a><span class='Delimiter'>, </span><a href="pquery.c.html#LN1008"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN135"><span class='Ref_to_Member'>stmts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="pquery.c.html#LN1008"><span class='Ref_to_Parameter'>isTopLevel</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="pquery.c.html#LN1010"><span class='Ref_To_Local'>treceiver</span></a><span class='Delimiter'>, </span><a href="pquery.c.html#LN1011"><span class='Ref_To_Local'>completionTag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unsupported portal strategy: %d"</span><span class='Delimiter'>, 
</span>                 <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="pquery.c.html#LN1008"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN142"><span class='Ref_to_Member'>strategy</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch portal-&GT;strategy &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Override default completion tag with actual command result */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN1011"><span class='Ref_To_Local'>completionTag</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>        <a href="pquery.c.html#LN1008"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN134"><span class='Ref_to_Member'>commandTag</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1011"><span class='Ref_To_Local'>completionTag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pquery.c.html#LN1010"><span class='Ref_To_Local'>treceiver</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/dest.h.html#LN125"><span class='Ref_to_Member'>rDestroy</span></a><span class='Parentheses'>) (</span><a href="pquery.c.html#LN1010"><span class='Ref_To_Local'>treceiver</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end FillPortalStore &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * RunFromStore 
 *      Fetch tuples from the portal's tuple store. 
 * 
 * Calling conventions are similar to ExecutorRun, except that we 
 * do not depend on having a queryDesc or estate.  Therefore we return the 
 * number of tuples processed as the result, not in estate-&GT;es_processed. 
 * 
 * One difference from ExecutorRun is that the destination receiver functions 
 * are run in the caller's memory context (since we have no estate).  Watch 
 * out for memory leaks. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> 
<a name="LN1068"></a><span class='Declare_Function'>RunFromStore</span><span class='Parentheses'>(</span><a href="../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a> <span class='Declare_Parameter'>portal</span><span class='Delimiter'>, </span><a href="../../include/access/sdir.h.html#LN21"><span class='Ref_to_Enum'>ScanDirection</span></a> <span class='Declare_Parameter'>direction</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> <span class='Declare_Parameter'>count</span><span class='Delimiter'>, 
</span><a name="LN1069"></a>             <a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>dest</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1071"></a>    <a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a>      <span class='Declare_Local'>current_tuple_count</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN1072"></a>    <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>slot</span><span class='Delimiter'>; 
</span> 
    <a href="pquery.c.html#LN1072"><span class='Ref_To_Local'>slot</span></a> <span class='Operator'>= </span><a href="../../include/executor/tuptable.h.html#LN144"><span class='Ref_to_Proto'>MakeSingleTupleTableSlot</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1068"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN154"><span class='Ref_to_Member'>tupDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pquery.c.html#LN1069"><span class='Ref_to_Parameter'>dest</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/dest.h.html#LN120"><span class='Ref_to_Member'>rStartup</span></a><span class='Parentheses'>) (</span><a href="pquery.c.html#LN1069"><span class='Ref_to_Parameter'>dest</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/nodes.h.html#LN650"><span class='Ref_to_EnumConst'>CMD_SELECT</span></a><span class='Delimiter'>, </span><a href="pquery.c.html#LN1068"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN154"><span class='Ref_to_Member'>tupDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/sdir.h.html#LN47"><span class='Ref_to_Macro'>ScanDirectionIsNoMovement</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1068"><span class='Ref_to_Parameter'>direction</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* do nothing except start/stop the destination */ 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1084"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>forward</span> <span class='Operator'>= </span><a href="../../include/access/sdir.h.html#LN54"><span class='Ref_to_Macro'>ScanDirectionIsForward</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1068"><span class='Ref_to_Parameter'>direction</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1088"></a>            <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span><a name="LN1089"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>ok</span><span class='Delimiter'>; 
</span> 
            <a href="pquery.c.html#LN1088"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1068"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN164"><span class='Ref_to_Member'>holdContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="pquery.c.html#LN1089"><span class='Ref_To_Local'>ok</span></a> <span class='Operator'>= </span><a href="../../include/utils/tuplestore.h.html#LN72"><span class='Ref_to_Proto'>tuplestore_gettupleslot</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1068"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN163"><span class='Ref_to_Member'>holdStore</span></a><span class='Delimiter'>, </span><a href="pquery.c.html#LN1084"><span class='Ref_To_Local'>forward</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                         <a href="pquery.c.html#LN1072"><span class='Ref_To_Local'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1088"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pquery.c.html#LN1089"><span class='Ref_To_Local'>ok</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * If we are not able to send the tuple, we assume the destination 
             * has closed and no more tuples can be sent. If that's the case, 
             * end the loop. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>((</span><span class='Operator'>*</span><a href="pquery.c.html#LN1069"><span class='Ref_to_Parameter'>dest</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/dest.h.html#LN117"><span class='Ref_to_Member'>receiveSlot</span></a><span class='Parentheses'>) (</span><a href="pquery.c.html#LN1072"><span class='Ref_To_Local'>slot</span></a><span class='Delimiter'>, </span><a href="pquery.c.html#LN1069"><span class='Ref_to_Parameter'>dest</span></a><span class='Parentheses'>)))</span> 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/executor/tuptable.h.html#LN154"><span class='Ref_to_Proto'>ExecClearTuple</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1072"><span class='Ref_To_Local'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * check our tuple count.. if we've processed the proper number 
             * then quit, else loop again and process more tuples. Zero count 
             * means no limit. 
             */ 
</span>            <a href="pquery.c.html#LN1071"><span class='Ref_To_Local'>current_tuple_count</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN1068"><span class='Ref_to_Parameter'>count</span></a> <span class='Operator'>&& </span><a href="pquery.c.html#LN1068"><span class='Ref_to_Parameter'>count</span></a> <span class='Operator'>== </span><a href="pquery.c.html#LN1071"><span class='Ref_To_Local'>current_tuple_count</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pquery.c.html#LN1069"><span class='Ref_to_Parameter'>dest</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/dest.h.html#LN123"><span class='Ref_to_Member'>rShutdown</span></a><span class='Parentheses'>) (</span><a href="pquery.c.html#LN1069"><span class='Ref_to_Parameter'>dest</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/executor/tuptable.h.html#LN145"><span class='Ref_to_Proto'>ExecDropSingleTupleTableSlot</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1072"><span class='Ref_To_Local'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pquery.c.html#LN1071"><span class='Ref_To_Local'>current_tuple_count</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RunFromStore &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * PortalRunUtility 
 *      Execute a utility statement inside a portal. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1134"></a><span class='Declare_Function'>PortalRunUtility</span><span class='Parentheses'>(</span><a href="../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a> <span class='Declare_Parameter'>portal</span><span class='Delimiter'>, </span><a href="../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstmt</span><span class='Delimiter'>, 
</span><a name="LN1135"></a>                 <span class='Keyword'>bool </span><span class='Declare_Parameter'>isTopLevel</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>setHoldSnapshot</span><span class='Delimiter'>, 
</span><a name="LN1136"></a>                 <a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>dest</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>completionTag</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1138"></a>    <a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>utilityStmt</span> <span class='Operator'>= </span><a href="pquery.c.html#LN1134"><span class='Ref_to_Parameter'>pstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN93"><span class='Ref_to_Member'>utilityStmt</span></a><span class='Delimiter'>; 
</span><a name="LN1139"></a>    <a href="../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a>    <span class='Declare_Local'>snapshot</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Set snapshot if utility stmt needs one.  Most reliable way to do this 
     * seems to be to enumerate those that do not need one; this is a short 
     * list.  Transaction control, LOCK, and SET must *not* set a snapshot 
     * since they need to be executable at the start of a transaction-snapshot 
     * mode transaction without freezing a snapshot.  By extension we allow 
     * SHOW not to set a snapshot.  The other stmts listed are just efficiency 
     * hacks.  Beware of listing anything that can modify the database --- if, 
     * say, it has to update an index with expressions that invoke 
     * user-defined functions, then it had better have a snapshot. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1138"><span class='Ref_To_Local'>utilityStmt</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN2902"><span class='Ref_to_Struct'>TransactionStmt</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>          <a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1138"><span class='Ref_To_Local'>utilityStmt</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN3162"><span class='Ref_to_Struct'>LockStmt</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>          <a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1138"><span class='Ref_To_Local'>utilityStmt</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1942"><span class='Ref_to_Struct'>VariableSetStmt</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>          <a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1138"><span class='Ref_To_Local'>utilityStmt</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1955"><span class='Ref_to_Struct'>VariableShowStmt</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>          <a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1138"><span class='Ref_To_Local'>utilityStmt</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN3174"><span class='Ref_to_Struct'>ConstraintsSetStmt</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>    <span class='Comment_Multi_Line'>/* efficiency hacks from here down */ 
</span>          <a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1138"><span class='Ref_To_Local'>utilityStmt</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN2647"><span class='Ref_to_Struct'>FetchStmt</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>          <a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1138"><span class='Ref_To_Local'>utilityStmt</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN2868"><span class='Ref_to_Struct'>ListenStmt</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>          <a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1138"><span class='Ref_To_Local'>utilityStmt</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN2857"><span class='Ref_to_Struct'>NotifyStmt</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>          <a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1138"><span class='Ref_To_Local'>utilityStmt</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN2878"><span class='Ref_to_Struct'>UnlistenStmt</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>          <a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1138"><span class='Ref_To_Local'>utilityStmt</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN3134"><span class='Ref_to_Struct'>CheckPointStmt</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pquery.c.html#LN1139"><span class='Ref_To_Local'>snapshot</span></a> <span class='Operator'>= </span><a href="../../include/utils/snapmgr.h.html#LN63"><span class='Ref_to_Proto'>GetTransactionSnapshot</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* If told to, register the snapshot we're using and save in portal */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN1135"><span class='Ref_to_Parameter'>setHoldSnapshot</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pquery.c.html#LN1139"><span class='Ref_To_Local'>snapshot</span></a> <span class='Operator'>= </span><a href="../../include/utils/snapmgr.h.html#LN80"><span class='Ref_to_Proto'>RegisterSnapshot</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1139"><span class='Ref_To_Local'>snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pquery.c.html#LN1134"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN174"><span class='Ref_to_Member'>holdSnapshot</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN1139"><span class='Ref_To_Local'>snapshot</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../include/utils/snapmgr.h.html#LN73"><span class='Ref_to_Proto'>PushActiveSnapshot</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1139"><span class='Ref_To_Local'>snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* PushActiveSnapshot might have copied the snapshot */ 
</span>        <a href="pquery.c.html#LN1139"><span class='Ref_To_Local'>snapshot</span></a> <span class='Operator'>= </span><a href="../../include/utils/snapmgr.h.html#LN77"><span class='Ref_to_Proto'>GetActiveSnapshot</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !(IsA(utilityStmt,Tra... &raquo; </span> 
    <span class='Control'>else</span> 
        <a href="pquery.c.html#LN1139"><span class='Ref_To_Local'>snapshot</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/tcop/utility.h.html#LN33"><span class='Ref_to_Proto'>ProcessUtility</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1134"><span class='Ref_to_Parameter'>pstmt</span></a><span class='Delimiter'>, 
</span>                   <a href="pquery.c.html#LN1134"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN133"><span class='Ref_to_Member'>sourceText</span></a><span class='Delimiter'>, 
</span>               <a href="pquery.c.html#LN1135"><span class='Ref_to_Parameter'>isTopLevel</span></a> <span class='Operator'>? </span><a href="../../include/tcop/utility.h.html#LN20"><span class='Ref_to_EnumConst'>PROCESS_UTILITY_TOPLEVEL</span></a> <span class='Operator'>: </span><a href="../../include/tcop/utility.h.html#LN21"><span class='Ref_to_EnumConst'>PROCESS_UTILITY_QUERY</span></a><span class='Delimiter'>, 
</span>                   <a href="pquery.c.html#LN1134"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN138"><span class='Ref_to_Member'>portalParams</span></a><span class='Delimiter'>, 
</span>                   <a href="pquery.c.html#LN1134"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN139"><span class='Ref_to_Member'>queryEnv</span></a><span class='Delimiter'>, 
</span>                   <a href="pquery.c.html#LN1136"><span class='Ref_to_Parameter'>dest</span></a><span class='Delimiter'>, 
</span>                   <a href="pquery.c.html#LN1136"><span class='Ref_to_Parameter'>completionTag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Some utility statements may change context on us */ 
</span>    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../../include/utils/portal.h.html#LN204"><span class='Ref_to_Macro'>PortalGetHeapMemory</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1134"><span class='Ref_to_Parameter'>portal</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Some utility commands may pop the ActiveSnapshot stack from under us, 
     * so be careful to only pop the stack if our snapshot is still at the 
     * top. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN1139"><span class='Ref_To_Local'>snapshot</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="../../include/utils/snapmgr.h.html#LN78"><span class='Ref_to_Proto'>ActiveSnapshotSet</span></a><span class='Parentheses'>() </span><span class='Operator'>&& 
</span>        <a href="pquery.c.html#LN1139"><span class='Ref_To_Local'>snapshot</span></a> <span class='Operator'>== </span><a href="../../include/utils/snapmgr.h.html#LN77"><span class='Ref_to_Proto'>GetActiveSnapshot</span></a><span class='Parentheses'>())</span> 
        <a href="../../include/utils/snapmgr.h.html#LN76"><span class='Ref_to_Proto'>PopActiveSnapshot</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end PortalRunUtility &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * PortalRunMulti 
 *      Execute a portal's queries in the general case (multi queries 
 *      or non-SELECT-like queries) 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1205"></a><span class='Declare_Function'>PortalRunMulti</span><span class='Parentheses'>(</span><a href="../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a> <span class='Declare_Parameter'>portal</span><span class='Delimiter'>, 
</span><a name="LN1206"></a>               <span class='Keyword'>bool </span><span class='Declare_Parameter'>isTopLevel</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>setHoldSnapshot</span><span class='Delimiter'>, 
</span><a name="LN1207"></a>               <a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>dest</span><span class='Delimiter'>, </span><a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>altdest</span><span class='Delimiter'>, 
</span><a name="LN1208"></a>               <span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>completionTag</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1210"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>active_snapshot_set</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN1211"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>stmtlist_item</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the destination is DestRemoteExecute, change to DestNone.  The 
     * reason is that the client won't be expecting any tuples, and indeed has 
     * no way to know what they are, since there is no provision for Describe 
     * to send a RowDescription message when this portal execution strategy is 
     * in effect.  This presently will only affect SELECT commands added to 
     * non-SELECT queries by rewrite rules: such commands will be executed, 
     * but the results will be discarded unless you use "simple Query" 
     * protocol. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN1207"><span class='Ref_to_Parameter'>dest</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/dest.h.html#LN127"><span class='Ref_to_Member'>mydest</span></a> <span class='Operator'>== </span><a href="../../include/tcop/dest.h.html#LN90"><span class='Ref_to_EnumConst'>DestRemoteExecute</span></a><span class='Parentheses'>) 
</span>        <a href="pquery.c.html#LN1207"><span class='Ref_to_Parameter'>dest</span></a> <span class='Operator'>= </span><a href="dest.c.html#LN90"><span class='Ref_to_Global_Var'>None_Receiver</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN1207"><span class='Ref_to_Parameter'>altdest</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/dest.h.html#LN127"><span class='Ref_to_Member'>mydest</span></a> <span class='Operator'>== </span><a href="../../include/tcop/dest.h.html#LN90"><span class='Ref_to_EnumConst'>DestRemoteExecute</span></a><span class='Parentheses'>) 
</span>        <a href="pquery.c.html#LN1207"><span class='Ref_to_Parameter'>altdest</span></a> <span class='Operator'>= </span><a href="dest.c.html#LN90"><span class='Ref_to_Global_Var'>None_Receiver</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Loop to handle the individual queries generated from a single parsetree 
     * by analysis and rewrite. 
     */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1211"><span class='Ref_To_Local'>stmtlist_item</span></a><span class='Delimiter'>, </span><a href="pquery.c.html#LN1205"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN135"><span class='Ref_to_Member'>stmts</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1234"></a>        <a href="../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pstmt</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN108"><span class='Ref_to_Macro'>lfirst_node</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a><span class='Delimiter'>, </span><a href="pquery.c.html#LN1211"><span class='Ref_To_Local'>stmtlist_item</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If we got a cancel signal in prior command, quit 
         */ 
</span>        <a href="../../include/miscadmin.h.html#LN99"><span class='Ref_to_Macro'>CHECK_FOR_INTERRUPTS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN1234"><span class='Ref_To_Local'>pstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN93"><span class='Ref_to_Member'>utilityStmt</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * process a plannable query. 
             */ 
</span>            TRACE_POSTGRESQL_QUERY_EXECUTE_START<span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/guc.c.html#LN439"><span class='Ref_to_Global_Var'>log_executor_stats</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/tcop/tcopprot.h.html#LN82"><span class='Ref_to_Proto'>ResetUsage</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Must always have a snapshot for plannable queries.  First time 
             * through, take a new snapshot; for subsequent queries in the 
             * same portal, just update the snapshot's copy of the command 
             * counter. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pquery.c.html#LN1210"><span class='Ref_To_Local'>active_snapshot_set</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1259"></a>                <a href="../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a>    <span class='Declare_Local'>snapshot</span> <span class='Operator'>= </span><a href="../../include/utils/snapmgr.h.html#LN63"><span class='Ref_to_Proto'>GetTransactionSnapshot</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* If told to, register the snapshot and save in portal */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN1206"><span class='Ref_to_Parameter'>setHoldSnapshot</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="pquery.c.html#LN1259"><span class='Ref_To_Local'>snapshot</span></a> <span class='Operator'>= </span><a href="../../include/utils/snapmgr.h.html#LN80"><span class='Ref_to_Proto'>RegisterSnapshot</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1259"><span class='Ref_To_Local'>snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="pquery.c.html#LN1205"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN174"><span class='Ref_to_Member'>holdSnapshot</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN1259"><span class='Ref_To_Local'>snapshot</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * We can't have the holdSnapshot also be the active one, 
                 * because UpdateActiveSnapshotCommandId would complain.  So 
                 * force an extra snapshot copy.  Plain PushActiveSnapshot 
                 * would have copied the transaction snapshot anyway, so this 
                 * only adds a copy step when setHoldSnapshot is true.  (It's 
                 * okay for the command ID of the active snapshot to diverge 
                 * from what holdSnapshot has.) 
                 */ 
</span>                <a href="../../include/utils/snapmgr.h.html#LN74"><span class='Ref_to_Proto'>PushCopiedSnapshot</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1259"><span class='Ref_To_Local'>snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pquery.c.html#LN1210"><span class='Ref_To_Local'>active_snapshot_set</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !active_snapshot_set &raquo; </span> 
            <span class='Control'>else</span> 
                <a href="../../include/utils/snapmgr.h.html#LN75"><span class='Ref_to_Proto'>UpdateActiveSnapshotCommandId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN1234"><span class='Ref_To_Local'>pstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN52"><span class='Ref_to_Member'>canSetTag</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* statement can set tag string */ 
</span>                <a href="pquery.c.html#LN37"><span class='Ref_to_Proto'>ProcessQuery</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1234"><span class='Ref_To_Local'>pstmt</span></a><span class='Delimiter'>, 
</span>                             <a href="pquery.c.html#LN1205"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN133"><span class='Ref_to_Member'>sourceText</span></a><span class='Delimiter'>, 
</span>                             <a href="pquery.c.html#LN1205"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN138"><span class='Ref_to_Member'>portalParams</span></a><span class='Delimiter'>, 
</span>                             <a href="pquery.c.html#LN1205"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN139"><span class='Ref_to_Member'>queryEnv</span></a><span class='Delimiter'>, 
</span>                             <a href="pquery.c.html#LN1207"><span class='Ref_to_Parameter'>dest</span></a><span class='Delimiter'>, </span><a href="pquery.c.html#LN1208"><span class='Ref_to_Parameter'>completionTag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* stmt added by rewrite cannot set tag */ 
</span>                <a href="pquery.c.html#LN37"><span class='Ref_to_Proto'>ProcessQuery</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1234"><span class='Ref_To_Local'>pstmt</span></a><span class='Delimiter'>, 
</span>                             <a href="pquery.c.html#LN1205"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN133"><span class='Ref_to_Member'>sourceText</span></a><span class='Delimiter'>, 
</span>                             <a href="pquery.c.html#LN1205"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN138"><span class='Ref_to_Member'>portalParams</span></a><span class='Delimiter'>, 
</span>                             <a href="pquery.c.html#LN1205"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN139"><span class='Ref_to_Member'>queryEnv</span></a><span class='Delimiter'>, 
</span>                             <a href="pquery.c.html#LN1207"><span class='Ref_to_Parameter'>altdest</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/guc.c.html#LN439"><span class='Ref_to_Global_Var'>log_executor_stats</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/tcop/tcopprot.h.html#LN83"><span class='Ref_to_Proto'>ShowUsage</span></a><span class='Parentheses'>(</span><span class='String'>"EXECUTOR STATISTICS"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            TRACE_POSTGRESQL_QUERY_EXECUTE_DONE<span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if pstmt-&GT;utilityStmt==N... &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * process utility functions (create, destroy, etc..) 
             * 
             * We must not set a snapshot here for utility commands (if one is 
             * needed, PortalRunUtility will do it).  If a utility command is 
             * alone in a portal then everything's fine.  The only case where 
             * a utility command can be part of a longer list is that rules 
             * are allowed to include NotifyStmt.  NotifyStmt doesn't care 
             * whether it has a snapshot or not, so we just leave the current 
             * snapshot alone if we have one. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN1234"><span class='Ref_To_Local'>pstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN52"><span class='Ref_to_Member'>canSetTag</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pquery.c.html#LN1210"><span class='Ref_To_Local'>active_snapshot_set</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* statement can set tag string */ 
</span>                <a href="pquery.c.html#LN48"><span class='Ref_to_Proto'>PortalRunUtility</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1205"><span class='Ref_to_Parameter'>portal</span></a><span class='Delimiter'>, </span><a href="pquery.c.html#LN1234"><span class='Ref_To_Local'>pstmt</span></a><span class='Delimiter'>, </span><a href="pquery.c.html#LN1206"><span class='Ref_to_Parameter'>isTopLevel</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                 <a href="pquery.c.html#LN1207"><span class='Ref_to_Parameter'>dest</span></a><span class='Delimiter'>, </span><a href="pquery.c.html#LN1208"><span class='Ref_to_Parameter'>completionTag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1234"><span class='Ref_To_Local'>pstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN93"><span class='Ref_to_Member'>utilityStmt</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN2857"><span class='Ref_to_Struct'>NotifyStmt</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* stmt added by rewrite cannot set tag */ 
</span>                <a href="pquery.c.html#LN48"><span class='Ref_to_Proto'>PortalRunUtility</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1205"><span class='Ref_to_Parameter'>portal</span></a><span class='Delimiter'>, </span><a href="pquery.c.html#LN1234"><span class='Ref_To_Local'>pstmt</span></a><span class='Delimiter'>, </span><a href="pquery.c.html#LN1206"><span class='Ref_to_Parameter'>isTopLevel</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                 <a href="pquery.c.html#LN1207"><span class='Ref_to_Parameter'>altdest</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* 
         * Increment command counter between queries, but not after the last 
         * one. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1211"><span class='Ref_To_Local'>stmtlist_item</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
            <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Clear subsidiary contexts to recover temporary memory. 
         */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/utils/portal.h.html#LN204"><span class='Ref_to_Macro'>PortalGetHeapMemory</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1205"><span class='Ref_to_Parameter'>portal</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../utils/mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/memutils.h.html#LN77"><span class='Ref_to_Proto'>MemoryContextDeleteChildren</span></a><span class='Parentheses'>(</span><a href="../../include/utils/portal.h.html#LN204"><span class='Ref_to_Macro'>PortalGetHeapMemory</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1205"><span class='Ref_to_Parameter'>portal</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Pop the snapshot if we pushed one. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN1210"><span class='Ref_To_Local'>active_snapshot_set</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/snapmgr.h.html#LN76"><span class='Ref_to_Proto'>PopActiveSnapshot</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If a command completion tag was supplied, use it.  Otherwise use the 
     * portal's commandTag as the default completion tag. 
     * 
     * Exception: Clients expect INSERT/UPDATE/DELETE tags to have counts, so 
     * fake them with zeros.  This can happen with DO INSTEAD rules if there 
     * is no replacement query of the same type as the original.  We print "0 
     * 0" here because technically there is no query of the matching tag type, 
     * and printing a non-zero count for a different query type seems wrong, 
     * e.g.  an INSERT that does an UPDATE instead should not print "0 1" if 
     * one row was updated.  See QueryRewrite(), step 3, for details. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN1208"><span class='Ref_to_Parameter'>completionTag</span></a> <span class='Operator'>&& </span><a href="pquery.c.html#LN1208"><span class='Ref_to_Parameter'>completionTag</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN1205"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN134"><span class='Ref_to_Member'>commandTag</span></a><span class='Parentheses'>) 
</span>            <a href="../../../contrib/cube/cubeparse.y.html#LN150"><span class='Ref_to_Proto'>strcpy</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1208"><span class='Ref_to_Parameter'>completionTag</span></a><span class='Delimiter'>, </span><a href="pquery.c.html#LN1205"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN134"><span class='Ref_to_Member'>commandTag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pquery.c.html#LN1208"><span class='Ref_to_Parameter'>completionTag</span></a><span class='Delimiter'>, </span><span class='String'>"SELECT"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1208"><span class='Ref_to_Parameter'>completionTag</span></a><span class='Delimiter'>, </span><span class='String'>"SELECT 0 0"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pquery.c.html#LN1208"><span class='Ref_to_Parameter'>completionTag</span></a><span class='Delimiter'>, </span><span class='String'>"INSERT"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../../../contrib/cube/cubeparse.y.html#LN150"><span class='Ref_to_Proto'>strcpy</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1208"><span class='Ref_to_Parameter'>completionTag</span></a><span class='Delimiter'>, </span><span class='String'>"INSERT 0 0"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pquery.c.html#LN1208"><span class='Ref_to_Parameter'>completionTag</span></a><span class='Delimiter'>, </span><span class='String'>"UPDATE"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../../../contrib/cube/cubeparse.y.html#LN150"><span class='Ref_to_Proto'>strcpy</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1208"><span class='Ref_to_Parameter'>completionTag</span></a><span class='Delimiter'>, </span><span class='String'>"UPDATE 0"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pquery.c.html#LN1208"><span class='Ref_to_Parameter'>completionTag</span></a><span class='Delimiter'>, </span><span class='String'>"DELETE"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../../../contrib/cube/cubeparse.y.html#LN150"><span class='Ref_to_Proto'>strcpy</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1208"><span class='Ref_to_Parameter'>completionTag</span></a><span class='Delimiter'>, </span><span class='String'>"DELETE 0"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end PortalRunMulti &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * PortalRunFetch 
 *      Variant form of PortalRun that supports SQL FETCH directions. 
 * 
 * Note: we presently assume that no callers of this want isTopLevel = true. 
 * 
 * count &LT;= 0 is interpreted as a no-op: the destination gets started up 
 * and shut down, but nothing else happens.  Also, count == FETCH_ALL is 
 * interpreted as "all rows".  (cf FetchStmt.howMany) 
 * 
 * Returns number of rows processed (suitable for use in result tag) 
 */ 
</span><a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> 
<a name="LN1395"></a><span class='Declare_Function'>PortalRunFetch</span><span class='Parentheses'>(</span><a href="../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a> <span class='Declare_Parameter'>portal</span><span class='Delimiter'>, 
</span><a name="LN1396"></a>               <a href="../../include/nodes/parsenodes.h.html#LN2635"><span class='Ref_to_Enum'>FetchDirection</span></a> <span class='Declare_Parameter'>fdirection</span><span class='Delimiter'>, 
</span><a name="LN1397"></a>               <span class='Keyword'>long </span><span class='Declare_Parameter'>count</span><span class='Delimiter'>, 
</span><a name="LN1398"></a>               <a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>dest</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1400"></a>    <a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a>      <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN1401"></a>    <a href="../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a>      <span class='Declare_Local'>saveActivePortal</span><span class='Delimiter'>; 
</span><a name="LN1402"></a>    <a href="../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Local'>saveResourceOwner</span><span class='Delimiter'>; 
</span><a name="LN1403"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>savePortalContext</span><span class='Delimiter'>; 
</span><a name="LN1404"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldContext</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/c.h.html#LN676"><span class='Ref_to_Macro'>AssertArg</span></a><span class='Parentheses'>(</span><a href="../../include/utils/portal.h.html#LN198"><span class='Ref_to_Macro'>PortalIsValid</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1395"><span class='Ref_to_Parameter'>portal</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check for improper portal use, and mark portal active. 
     */ 
</span>    <a href="../../include/utils/portal.h.html#LN224"><span class='Ref_to_Proto'>MarkPortalActive</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1395"><span class='Ref_to_Parameter'>portal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If supporting FETCH, portal can't be run-once. */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pquery.c.html#LN1395"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN144"><span class='Ref_to_Member'>run_once</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Set up global portal context pointers. 
     */ 
</span>    <a href="pquery.c.html#LN1401"><span class='Ref_To_Local'>saveActivePortal</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN34"><span class='Ref_to_Global_Var'>ActivePortal</span></a><span class='Delimiter'>; 
</span>    <a href="pquery.c.html#LN1402"><span class='Ref_To_Local'>saveResourceOwner</span></a> <span class='Operator'>= </span><a href="../utils/resowner/resowner.c.html#LN137"><span class='Ref_to_Global_Var'>CurrentResourceOwner</span></a><span class='Delimiter'>; 
</span>    <a href="pquery.c.html#LN1403"><span class='Ref_To_Local'>savePortalContext</span></a> <span class='Operator'>= </span><a href="../utils/mmgr/mcxt.c.html#LN51"><span class='Ref_to_Global_Var'>PortalContext</span></a><span class='Delimiter'>; 
</span>    <a href="../../include/utils/elog.h.html#LN283"><span class='Ref_to_Macro'>PG_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pquery.c.html#LN34"><span class='Ref_to_Global_Var'>ActivePortal</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN1395"><span class='Ref_to_Parameter'>portal</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN1395"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN119"><span class='Ref_to_Member'>resowner</span></a><span class='Parentheses'>) 
</span>            <a href="../utils/resowner/resowner.c.html#LN137"><span class='Ref_to_Global_Var'>CurrentResourceOwner</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN1395"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN119"><span class='Ref_to_Member'>resowner</span></a><span class='Delimiter'>; 
</span>        <a href="../utils/mmgr/mcxt.c.html#LN51"><span class='Ref_to_Global_Var'>PortalContext</span></a> <span class='Operator'>= </span><a href="../../include/utils/portal.h.html#LN204"><span class='Ref_to_Macro'>PortalGetHeapMemory</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1395"><span class='Ref_to_Parameter'>portal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pquery.c.html#LN1404"><span class='Ref_To_Local'>oldContext</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN51"><span class='Ref_to_Global_Var'>PortalContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN1395"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN142"><span class='Ref_to_Member'>strategy</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../include/utils/portal.h.html#LN89"><span class='Ref_to_EnumConst'>PORTAL_ONE_SELECT</span></a><span class='Operator'>: 
</span>                <a href="pquery.c.html#LN1400"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN55"><span class='Ref_to_Proto'>DoPortalRunFetch</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1395"><span class='Ref_to_Parameter'>portal</span></a><span class='Delimiter'>, </span><a href="pquery.c.html#LN1396"><span class='Ref_to_Parameter'>fdirection</span></a><span class='Delimiter'>, </span><a href="pquery.c.html#LN1397"><span class='Ref_to_Parameter'>count</span></a><span class='Delimiter'>, </span><a href="pquery.c.html#LN1398"><span class='Ref_to_Parameter'>dest</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../include/utils/portal.h.html#LN90"><span class='Ref_to_EnumConst'>PORTAL_ONE_RETURNING</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/utils/portal.h.html#LN91"><span class='Ref_to_EnumConst'>PORTAL_ONE_MOD_WITH</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/utils/portal.h.html#LN92"><span class='Ref_to_EnumConst'>PORTAL_UTIL_SELECT</span></a><span class='Operator'>: 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * If we have not yet run the command, do so, storing its 
                 * results in the portal's tuplestore. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pquery.c.html#LN1395"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN163"><span class='Ref_to_Member'>holdStore</span></a><span class='Parentheses'>) 
</span>                    <a href="pquery.c.html#LN43"><span class='Ref_to_Proto'>FillPortalStore</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1395"><span class='Ref_to_Parameter'>portal</span></a><span class='Delimiter'>, </span><span class='Boolean'>false </span><span class='Comment_Multi_Line'>/* isTopLevel */ </span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Now fetch desired portion of results. 
                 */ 
</span>                <a href="pquery.c.html#LN1400"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN55"><span class='Ref_to_Proto'>DoPortalRunFetch</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1395"><span class='Ref_to_Parameter'>portal</span></a><span class='Delimiter'>, </span><a href="pquery.c.html#LN1396"><span class='Ref_to_Parameter'>fdirection</span></a><span class='Delimiter'>, </span><a href="pquery.c.html#LN1397"><span class='Ref_to_Parameter'>count</span></a><span class='Delimiter'>, </span><a href="pquery.c.html#LN1398"><span class='Ref_to_Parameter'>dest</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unsupported portal strategy"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pquery.c.html#LN1400"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch portal-&GT;strategy &raquo; </span> 
    <span class='Delimiter'>} 
</span>    <a href="../../include/utils/elog.h.html#LN292"><span class='Ref_to_Macro'>PG_CATCH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Uncaught error while executing portal: mark it dead */ 
</span>        <a href="../../include/utils/portal.h.html#LN226"><span class='Ref_to_Proto'>MarkPortalFailed</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1395"><span class='Ref_to_Parameter'>portal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Restore global vars and propagate error */ 
</span>        <a href="pquery.c.html#LN34"><span class='Ref_to_Global_Var'>ActivePortal</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN1401"><span class='Ref_To_Local'>saveActivePortal</span></a><span class='Delimiter'>; 
</span>        <a href="../utils/resowner/resowner.c.html#LN137"><span class='Ref_to_Global_Var'>CurrentResourceOwner</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN1402"><span class='Ref_To_Local'>saveResourceOwner</span></a><span class='Delimiter'>; 
</span>        <a href="../utils/mmgr/mcxt.c.html#LN51"><span class='Ref_to_Global_Var'>PortalContext</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN1403"><span class='Ref_To_Local'>savePortalContext</span></a><span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/elog.h.html#LN310"><span class='Ref_to_Macro'>PG_RE_THROW</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../include/utils/elog.h.html#LN299"><span class='Ref_to_Macro'>PG_END_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1404"><span class='Ref_To_Local'>oldContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Mark portal not active */ 
</span>    <a href="pquery.c.html#LN1395"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN147"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="../../include/utils/portal.h.html#LN105"><span class='Ref_to_EnumConst'>PORTAL_READY</span></a><span class='Delimiter'>; 
</span> 
    <a href="pquery.c.html#LN34"><span class='Ref_to_Global_Var'>ActivePortal</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN1401"><span class='Ref_To_Local'>saveActivePortal</span></a><span class='Delimiter'>; 
</span>    <a href="../utils/resowner/resowner.c.html#LN137"><span class='Ref_to_Global_Var'>CurrentResourceOwner</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN1402"><span class='Ref_To_Local'>saveResourceOwner</span></a><span class='Delimiter'>; 
</span>    <a href="../utils/mmgr/mcxt.c.html#LN51"><span class='Ref_to_Global_Var'>PortalContext</span></a> <span class='Operator'>= </span><a href="pquery.c.html#LN1403"><span class='Ref_To_Local'>savePortalContext</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pquery.c.html#LN1400"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end PortalRunFetch &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * DoPortalRunFetch 
 *      Guts of PortalRunFetch --- the portal context is already set up 
 * 
 * count &LT;= 0 is interpreted as a no-op: the destination gets started up 
 * and shut down, but nothing else happens.  Also, count == FETCH_ALL is 
 * interpreted as "all rows".  (cf FetchStmt.howMany) 
 * 
 * Returns number of rows processed (suitable for use in result tag) 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> 
<a name="LN1497"></a><span class='Declare_Function'>DoPortalRunFetch</span><span class='Parentheses'>(</span><a href="../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a> <span class='Declare_Parameter'>portal</span><span class='Delimiter'>, 
</span><a name="LN1498"></a>                 <a href="../../include/nodes/parsenodes.h.html#LN2635"><span class='Ref_to_Enum'>FetchDirection</span></a> <span class='Declare_Parameter'>fdirection</span><span class='Delimiter'>, 
</span><a name="LN1499"></a>                 <span class='Keyword'>long </span><span class='Declare_Parameter'>count</span><span class='Delimiter'>, 
</span><a name="LN1500"></a>                 <a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>dest</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1502"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>forward</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pquery.c.html#LN1497"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN142"><span class='Ref_to_Member'>strategy</span></a> <span class='Operator'>== </span><a href="../../include/utils/portal.h.html#LN89"><span class='Ref_to_EnumConst'>PORTAL_ONE_SELECT</span></a> <span class='Operator'>|| 
</span>           <a href="pquery.c.html#LN1497"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN142"><span class='Ref_to_Member'>strategy</span></a> <span class='Operator'>== </span><a href="../../include/utils/portal.h.html#LN90"><span class='Ref_to_EnumConst'>PORTAL_ONE_RETURNING</span></a> <span class='Operator'>|| 
</span>           <a href="pquery.c.html#LN1497"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN142"><span class='Ref_to_Member'>strategy</span></a> <span class='Operator'>== </span><a href="../../include/utils/portal.h.html#LN91"><span class='Ref_to_EnumConst'>PORTAL_ONE_MOD_WITH</span></a> <span class='Operator'>|| 
</span>           <a href="pquery.c.html#LN1497"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN142"><span class='Ref_to_Member'>strategy</span></a> <span class='Operator'>== </span><a href="../../include/utils/portal.h.html#LN92"><span class='Ref_to_EnumConst'>PORTAL_UTIL_SELECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN1498"><span class='Ref_to_Parameter'>fdirection</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2638"><span class='Ref_to_EnumConst'>FETCH_FORWARD</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN1499"><span class='Ref_to_Parameter'>count</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="pquery.c.html#LN1498"><span class='Ref_to_Parameter'>fdirection</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN2639"><span class='Ref_to_EnumConst'>FETCH_BACKWARD</span></a><span class='Delimiter'>; 
</span>                <a href="pquery.c.html#LN1499"><span class='Ref_to_Parameter'>count</span></a> <span class='Operator'>= -</span><a href="pquery.c.html#LN1499"><span class='Ref_to_Parameter'>count</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Comment_Multi_Line'>/* fall out of switch to share code with FETCH_BACKWARD */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2639"><span class='Ref_to_EnumConst'>FETCH_BACKWARD</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN1499"><span class='Ref_to_Parameter'>count</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="pquery.c.html#LN1498"><span class='Ref_to_Parameter'>fdirection</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN2638"><span class='Ref_to_EnumConst'>FETCH_FORWARD</span></a><span class='Delimiter'>; 
</span>                <a href="pquery.c.html#LN1499"><span class='Ref_to_Parameter'>count</span></a> <span class='Operator'>= -</span><a href="pquery.c.html#LN1499"><span class='Ref_to_Parameter'>count</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Comment_Multi_Line'>/* fall out of switch to share code with FETCH_FORWARD */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2641"><span class='Ref_to_EnumConst'>FETCH_ABSOLUTE</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN1499"><span class='Ref_to_Parameter'>count</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * Definition: Rewind to start, advance count-1 rows, return 
                 * next row (if any). 
                 * 
                 * In practice, if the goal is less than halfway back to the 
                 * start, it's better to scan from where we are. 
                 * 
                 * Also, if current portalPos is outside the range of "long", 
                 * do it the hard way to avoid possible overflow of the count 
                 * argument to PortalRunSelect.  We must exclude exactly 
                 * LONG_MAX, as well, lest the count look like FETCH_ALL. 
                 * 
                 * In any case, we arrange to fetch the target row going 
                 * forwards. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a><span class='Parentheses'>) (</span><a href="pquery.c.html#LN1499"><span class='Ref_to_Parameter'>count</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><a href="pquery.c.html#LN1497"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN187"><span class='Ref_to_Member'>portalPos</span></a> <span class='Operator'>/ </span><span class='Number'>2</span> <span class='Operator'>|| 
</span>                    <a href="pquery.c.html#LN1497"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN187"><span class='Ref_to_Member'>portalPos</span></a> <span class='Operator'>&GT;= </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a><span class='Parentheses'>) </span>LONG_MAX<span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="pquery.c.html#LN59"><span class='Ref_to_Proto'>DoPortalRewind</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1497"><span class='Ref_to_Parameter'>portal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN1499"><span class='Ref_to_Parameter'>count</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                        <a href="pquery.c.html#LN46"><span class='Ref_to_Proto'>PortalRunSelect</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1497"><span class='Ref_to_Parameter'>portal</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="pquery.c.html#LN1499"><span class='Ref_to_Parameter'>count</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                        <a href="dest.c.html#LN90"><span class='Ref_to_Global_Var'>None_Receiver</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span><a name="LN1555"></a>                    <span class='Keyword'>long</span>        <span class='Declare_Local'>pos</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>long</span><span class='Parentheses'>) </span><a href="pquery.c.html#LN1497"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN187"><span class='Ref_to_Member'>portalPos</span></a><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN1497"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN186"><span class='Ref_to_Member'>atEnd</span></a><span class='Parentheses'>) 
</span>                        <a href="pquery.c.html#LN1555"><span class='Ref_To_Local'>pos</span></a><span class='Operator'>++</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* need one extra fetch if off end */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN1499"><span class='Ref_to_Parameter'>count</span></a> <span class='Operator'>&LT;= </span><a href="pquery.c.html#LN1555"><span class='Ref_To_Local'>pos</span></a><span class='Parentheses'>) 
</span>                        <a href="pquery.c.html#LN46"><span class='Ref_to_Proto'>PortalRunSelect</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1497"><span class='Ref_to_Parameter'>portal</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="pquery.c.html#LN1555"><span class='Ref_To_Local'>pos</span></a> <span class='Operator'>- </span><a href="pquery.c.html#LN1499"><span class='Ref_to_Parameter'>count</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                        <a href="dest.c.html#LN90"><span class='Ref_to_Global_Var'>None_Receiver</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN1499"><span class='Ref_to_Parameter'>count</span></a> <span class='Operator'>&GT; </span><a href="pquery.c.html#LN1555"><span class='Ref_To_Local'>pos</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                        <a href="pquery.c.html#LN46"><span class='Ref_to_Proto'>PortalRunSelect</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1497"><span class='Ref_to_Parameter'>portal</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="pquery.c.html#LN1499"><span class='Ref_to_Parameter'>count</span></a> <span class='Operator'>- </span><a href="pquery.c.html#LN1555"><span class='Ref_To_Local'>pos</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                        <a href="dest.c.html#LN90"><span class='Ref_to_Global_Var'>None_Receiver</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>return</span> <a href="pquery.c.html#LN46"><span class='Ref_to_Proto'>PortalRunSelect</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1497"><span class='Ref_to_Parameter'>portal</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Number'>1L</span><span class='Delimiter'>, </span><a href="pquery.c.html#LN1500"><span class='Ref_to_Parameter'>dest</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if count&GT;0 &raquo; </span> 
            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN1499"><span class='Ref_to_Parameter'>count</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * Definition: Advance to end, back up abs(count)-1 rows, 
                 * return prior row (if any).  We could optimize this if we 
                 * knew in advance where the end was, but typically we won't. 
                 * (Is it worth considering case where count &GT; half of size of 
                 * query?  We could rewind once we know the size ...) 
                 */ 
</span>                <a href="pquery.c.html#LN46"><span class='Ref_to_Proto'>PortalRunSelect</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1497"><span class='Ref_to_Parameter'>portal</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN2645"><span class='Ref_to_Const'>FETCH_ALL</span></a><span class='Delimiter'>, </span><a href="dest.c.html#LN90"><span class='Ref_to_Global_Var'>None_Receiver</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN1499"><span class='Ref_to_Parameter'>count</span></a> <span class='Operator'>&LT; -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                    <a href="pquery.c.html#LN46"><span class='Ref_to_Proto'>PortalRunSelect</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1497"><span class='Ref_to_Parameter'>portal</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Operator'>-</span><a href="pquery.c.html#LN1499"><span class='Ref_to_Parameter'>count</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="dest.c.html#LN90"><span class='Ref_to_Global_Var'>None_Receiver</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <a href="pquery.c.html#LN46"><span class='Ref_to_Proto'>PortalRunSelect</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1497"><span class='Ref_to_Parameter'>portal</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Number'>1L</span><span class='Delimiter'>, </span><a href="pquery.c.html#LN1500"><span class='Ref_to_Parameter'>dest</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* count == 0 */ 
</span>                <span class='Comment_Multi_Line'>/* Rewind to start, return zero rows */ 
</span>                <a href="pquery.c.html#LN59"><span class='Ref_to_Proto'>DoPortalRewind</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1497"><span class='Ref_to_Parameter'>portal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <a href="pquery.c.html#LN46"><span class='Ref_to_Proto'>PortalRunSelect</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1497"><span class='Ref_to_Parameter'>portal</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Number'>0L</span><span class='Delimiter'>, </span><a href="pquery.c.html#LN1500"><span class='Ref_to_Parameter'>dest</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2642"><span class='Ref_to_EnumConst'>FETCH_RELATIVE</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN1499"><span class='Ref_to_Parameter'>count</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * Definition: advance count-1 rows, return next row (if any). 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN1499"><span class='Ref_to_Parameter'>count</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                    <a href="pquery.c.html#LN46"><span class='Ref_to_Proto'>PortalRunSelect</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1497"><span class='Ref_to_Parameter'>portal</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="pquery.c.html#LN1499"><span class='Ref_to_Parameter'>count</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="dest.c.html#LN90"><span class='Ref_to_Global_Var'>None_Receiver</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <a href="pquery.c.html#LN46"><span class='Ref_to_Proto'>PortalRunSelect</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1497"><span class='Ref_to_Parameter'>portal</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Number'>1L</span><span class='Delimiter'>, </span><a href="pquery.c.html#LN1500"><span class='Ref_to_Parameter'>dest</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN1499"><span class='Ref_to_Parameter'>count</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * Definition: back up abs(count)-1 rows, return prior row (if 
                 * any). 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN1499"><span class='Ref_to_Parameter'>count</span></a> <span class='Operator'>&LT; -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                    <a href="pquery.c.html#LN46"><span class='Ref_to_Proto'>PortalRunSelect</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1497"><span class='Ref_to_Parameter'>portal</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Operator'>-</span><a href="pquery.c.html#LN1499"><span class='Ref_to_Parameter'>count</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="dest.c.html#LN90"><span class='Ref_to_Global_Var'>None_Receiver</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <a href="pquery.c.html#LN46"><span class='Ref_to_Proto'>PortalRunSelect</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1497"><span class='Ref_to_Parameter'>portal</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Number'>1L</span><span class='Delimiter'>, </span><a href="pquery.c.html#LN1500"><span class='Ref_to_Parameter'>dest</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* count == 0 */ 
</span>                <span class='Comment_Multi_Line'>/* Same as FETCH FORWARD 0, so fall out of switch */ 
</span>                <a href="pquery.c.html#LN1498"><span class='Ref_to_Parameter'>fdirection</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN2638"><span class='Ref_to_EnumConst'>FETCH_FORWARD</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"bogus direction"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch fdirection &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Get here with fdirection == FETCH_FORWARD or FETCH_BACKWARD, and count 
     * &GT;= 0. 
     */ 
</span>    <a href="pquery.c.html#LN1502"><span class='Ref_To_Local'>forward</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pquery.c.html#LN1498"><span class='Ref_to_Parameter'>fdirection</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN2638"><span class='Ref_to_EnumConst'>FETCH_FORWARD</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Zero count means to re-fetch the current row, if any (per SQL) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN1499"><span class='Ref_to_Parameter'>count</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1633"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>on_row</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Are we sitting on a row? */ 
</span>        <a href="pquery.c.html#LN1633"><span class='Ref_To_Local'>on_row</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pquery.c.html#LN1497"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN185"><span class='Ref_to_Member'>atStart</span></a> <span class='Operator'>&& !</span><a href="pquery.c.html#LN1497"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN186"><span class='Ref_to_Member'>atEnd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN1500"><span class='Ref_to_Parameter'>dest</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/dest.h.html#LN127"><span class='Ref_to_Member'>mydest</span></a> <span class='Operator'>== </span><a href="../../include/tcop/dest.h.html#LN87"><span class='Ref_to_EnumConst'>DestNone</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* MOVE 0 returns 0/1 based on if FETCH 0 would return a row */ 
</span>            <span class='Control'>return</span> <a href="pquery.c.html#LN1633"><span class='Ref_To_Local'>on_row</span></a> <span class='Operator'>? </span><span class='Number'>1</span> <span class='Operator'>: </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * If we are sitting on a row, back up one so we can re-fetch it. 
             * If we are not sitting on a row, we still have to start up and 
             * shut down the executor so that the destination is initialized 
             * and shut down correctly; so keep going.  To PortalRunSelect, 
             * count == 0 means we will retrieve no row. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN1633"><span class='Ref_To_Local'>on_row</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="pquery.c.html#LN46"><span class='Ref_to_Proto'>PortalRunSelect</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1497"><span class='Ref_to_Parameter'>portal</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Number'>1L</span><span class='Delimiter'>, </span><a href="dest.c.html#LN90"><span class='Ref_to_Global_Var'>None_Receiver</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* Set up to fetch one row forward */ 
</span>                <a href="pquery.c.html#LN1499"><span class='Ref_to_Parameter'>count</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <a href="pquery.c.html#LN1502"><span class='Ref_To_Local'>forward</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if count==0 &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Optimize MOVE BACKWARD ALL into a Rewind. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pquery.c.html#LN1502"><span class='Ref_To_Local'>forward</span></a> <span class='Operator'>&& </span><a href="pquery.c.html#LN1499"><span class='Ref_to_Parameter'>count</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN2645"><span class='Ref_to_Const'>FETCH_ALL</span></a> <span class='Operator'>&& </span><a href="pquery.c.html#LN1500"><span class='Ref_to_Parameter'>dest</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/dest.h.html#LN127"><span class='Ref_to_Member'>mydest</span></a> <span class='Operator'>== </span><a href="../../include/tcop/dest.h.html#LN87"><span class='Ref_to_EnumConst'>DestNone</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1667"></a>        <a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a>      <span class='Declare_Local'>result</span> <span class='Operator'>= </span><a href="pquery.c.html#LN1497"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN187"><span class='Ref_to_Member'>portalPos</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN1667"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& !</span><a href="pquery.c.html#LN1497"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN186"><span class='Ref_to_Member'>atEnd</span></a><span class='Parentheses'>) 
</span>            <a href="pquery.c.html#LN1667"><span class='Ref_To_Local'>result</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <a href="pquery.c.html#LN59"><span class='Ref_to_Proto'>DoPortalRewind</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1497"><span class='Ref_to_Parameter'>portal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="pquery.c.html#LN1667"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="pquery.c.html#LN46"><span class='Ref_to_Proto'>PortalRunSelect</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1497"><span class='Ref_to_Parameter'>portal</span></a><span class='Delimiter'>, </span><a href="pquery.c.html#LN1502"><span class='Ref_To_Local'>forward</span></a><span class='Delimiter'>, </span><a href="pquery.c.html#LN1499"><span class='Ref_to_Parameter'>count</span></a><span class='Delimiter'>, </span><a href="pquery.c.html#LN1500"><span class='Ref_to_Parameter'>dest</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end DoPortalRunFetch &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * DoPortalRewind - rewind a Portal to starting point 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1682"></a><span class='Declare_Function'>DoPortalRewind</span><span class='Parentheses'>(</span><a href="../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a> <span class='Declare_Parameter'>portal</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1684"></a>    <a href="../../include/executor/execdesc.h.html#LN32"><span class='Ref_to_Struct'>QueryDesc</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>queryDesc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Rewind holdStore, if we have one */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN1682"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN163"><span class='Ref_to_Member'>holdStore</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1689"></a>        <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
        <a href="pquery.c.html#LN1689"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1682"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN164"><span class='Ref_to_Member'>holdContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/tuplestore.h.html#LN84"><span class='Ref_to_Proto'>tuplestore_rescan</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1682"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN163"><span class='Ref_to_Member'>holdStore</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1689"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Rewind executor, if active */ 
</span>    <a href="pquery.c.html#LN1684"><span class='Ref_To_Local'>queryDesc</span></a> <span class='Operator'>= </span><a href="../../include/utils/portal.h.html#LN203"><span class='Ref_to_Macro'>PortalGetQueryDesc</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1682"><span class='Ref_to_Parameter'>portal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pquery.c.html#LN1684"><span class='Ref_To_Local'>queryDesc</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/snapmgr.h.html#LN73"><span class='Ref_to_Proto'>PushActiveSnapshot</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1684"><span class='Ref_To_Local'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN38"><span class='Ref_to_Member'>snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/executor/executor.h.html#LN177"><span class='Ref_to_Proto'>ExecutorRewind</span></a><span class='Parentheses'>(</span><a href="pquery.c.html#LN1684"><span class='Ref_To_Local'>queryDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/snapmgr.h.html#LN76"><span class='Ref_to_Proto'>PopActiveSnapshot</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pquery.c.html#LN1682"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN185"><span class='Ref_to_Member'>atStart</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="pquery.c.html#LN1682"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN186"><span class='Ref_to_Member'>atEnd</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="pquery.c.html#LN1682"><span class='Ref_to_Parameter'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN187"><span class='Ref_to_Member'>portalPos</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end DoPortalRewind &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>