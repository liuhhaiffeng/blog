<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\utils\adt\acl.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\utils\adt\acl.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:50 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * acl.c 
 *    Basic access control list data structures manipulation routines. 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/utils/adt/acl.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;ctype.h&GT;</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/catalog.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/namespace.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_authid.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_auth_members.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_class.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/dbcommands.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/proclang.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/tablespace.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"foreign/foreign.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"funcapi.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/acl.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/catcache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/inval.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/memutils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/syscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/varlena.h"</span> 
 
 
<span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN43"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Member'>name</span><span class='Delimiter'>; 
</span><a name="LN44"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Member'>value</span><span class='Delimiter'>; 
</span><a name="LN45"></a>} <span class='Declare_Typedef'>priv_map</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * We frequently need to test whether a given role is a member of some other 
 * role.  In most of these tests the "given role" is the same, namely the 
 * active current user.  So we can optimize it by keeping a cached list of 
 * all the roles the "given role" is a member of, directly or indirectly. 
 * The cache is flushed whenever we detect a change in pg_auth_members. 
 * 
 * There are actually two caches, one computed under "has_privs" rules 
 * (do not recurse where rolinherit isn't true) and one computed under 
 * "is_member" rules (recurse regardless of rolinherit). 
 * 
 * Possibly this mechanism should be generalized to allow caching membership 
 * info for multiple roles? 
 * 
 * The has_privs cache is: 
 * cached_privs_role is the role OID the cache is for. 
 * cached_privs_roles is an OID list of roles that cached_privs_role 
 *      has the privileges of (always including itself). 
 * The cache is valid if cached_privs_role is not InvalidOid. 
 * 
 * The is_member cache is similarly: 
 * cached_member_role is the role OID the cache is for. 
 * cached_membership_roles is an OID list of roles that cached_member_role 
 *      is a member of (always including itself). 
 * The cache is valid if cached_member_role is not InvalidOid. 
 */ 
</span><a name="LN73"></a><span class='Keyword'>static </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>  <span class='Declare_Var'>cached_privs_role</span> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span><a name="LN74"></a><span class='Keyword'>static </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Var'>cached_privs_roles</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN75"></a><span class='Keyword'>static </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>  <span class='Declare_Var'>cached_member_role</span> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span><a name="LN76"></a><span class='Keyword'>static </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Var'>cached_membership_roles</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
 
<a name="LN79"></a><span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Declare_Prototype'>getid</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>s</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>n</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN80"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>putid</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>p</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>s</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN81"></a><span class='Keyword'>static </span><a href="../../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>allocacl</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>n</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN82"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>check_acl</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>acl</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN83"></a><span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Declare_Prototype'>aclparse</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>s</span><span class='Delimiter'>, </span><a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>aip</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN84"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>aclitem_match</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>a1</span><span class='Delimiter'>, </span><span class='Keyword'>const </span><a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>a2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN85"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>aclitemComparator</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg1</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN86"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>check_circularity</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>old_acl</span><span class='Delimiter'>, </span><span class='Keyword'>const </span><a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>mod_aip</span><span class='Delimiter'>, 
</span><a name="LN87"></a>                  <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>ownerId</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN88"></a><span class='Keyword'>static </span><a href="../../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>recursive_revoke</span><span class='Parentheses'>(</span><a href="../../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>acl</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>grantee</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Parameter'>revoke_privs</span><span class='Delimiter'>, 
</span><a name="LN89"></a>                 <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>ownerId</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN1652"><span class='Ref_to_Enum'>DropBehavior</span></a> <span class='Declare_Parameter'>behavior</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN91"></a><span class='Keyword'>static </span><a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Prototype'>convert_priv_string</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>priv_type_text</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN92"></a><span class='Keyword'>static </span><a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Prototype'>convert_any_priv_string</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>priv_type_text</span><span class='Delimiter'>, 
</span><a name="LN93"></a>                        <span class='Keyword'>const </span><a href="acl.c.html#LN41"><span class='Ref_to_Typedef'>priv_map</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>privileges</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN95"></a><span class='Keyword'>static </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>  <span class='Declare_Prototype'>convert_table_name</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tablename</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN96"></a><span class='Keyword'>static </span><a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Prototype'>convert_table_priv_string</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>priv_type_text</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN97"></a><span class='Keyword'>static </span><a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Prototype'>convert_sequence_priv_string</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>priv_type_text</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN98"></a><span class='Keyword'>static </span><a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a> <span class='Declare_Prototype'>convert_column_name</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>tableoid</span><span class='Delimiter'>, </span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>column</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN99"></a><span class='Keyword'>static </span><a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Prototype'>convert_column_priv_string</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>priv_type_text</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN100"></a><span class='Keyword'>static </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>  <span class='Declare_Prototype'>convert_database_name</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>databasename</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN101"></a><span class='Keyword'>static </span><a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Prototype'>convert_database_priv_string</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>priv_type_text</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN102"></a><span class='Keyword'>static </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>  <span class='Declare_Prototype'>convert_foreign_data_wrapper_name</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fdwname</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN103"></a><span class='Keyword'>static </span><a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Prototype'>convert_foreign_data_wrapper_priv_string</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>priv_type_text</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN104"></a><span class='Keyword'>static </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>  <span class='Declare_Prototype'>convert_function_name</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>functionname</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN105"></a><span class='Keyword'>static </span><a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Prototype'>convert_function_priv_string</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>priv_type_text</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN106"></a><span class='Keyword'>static </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>  <span class='Declare_Prototype'>convert_language_name</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>languagename</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN107"></a><span class='Keyword'>static </span><a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Prototype'>convert_language_priv_string</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>priv_type_text</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN108"></a><span class='Keyword'>static </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>  <span class='Declare_Prototype'>convert_schema_name</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>schemaname</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN109"></a><span class='Keyword'>static </span><a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Prototype'>convert_schema_priv_string</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>priv_type_text</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN110"></a><span class='Keyword'>static </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>  <span class='Declare_Prototype'>convert_server_name</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>servername</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN111"></a><span class='Keyword'>static </span><a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Prototype'>convert_server_priv_string</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>priv_type_text</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN112"></a><span class='Keyword'>static </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>  <span class='Declare_Prototype'>convert_tablespace_name</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tablespacename</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN113"></a><span class='Keyword'>static </span><a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Prototype'>convert_tablespace_priv_string</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>priv_type_text</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN114"></a><span class='Keyword'>static </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>  <span class='Declare_Prototype'>convert_type_name</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typename</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN115"></a><span class='Keyword'>static </span><a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Prototype'>convert_type_priv_string</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>priv_type_text</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN116"></a><span class='Keyword'>static </span><a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Prototype'>convert_role_priv_string</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>priv_type_text</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN117"></a><span class='Keyword'>static </span><a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a> <span class='Declare_Prototype'>pg_role_aclcheck</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>role_oid</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Parameter'>mode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN119"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>RoleMembershipCacheCallback</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>cacheid</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Parameter'>hashvalue</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * getid 
 *      Consumes the first alphanumeric string (identifier) found in string 
 *      's', ignoring any leading white space.  If it finds a double quote 
 *      it returns the word inside the quotes. 
 * 
 * RETURNS: 
 *      the string position in 's' that points to the next non-space character 
 *      in 's', after any quotes.  Also: 
 *      - loads the identifier into 'n'.  (If no identifier is found, 'n' 
 *        contains an empty string.)  'n' must be NAMEDATALEN bytes. 
 */ 
</span><span class='Keyword'>static const char </span><span class='Operator'>* 
</span><a name="LN135"></a><span class='Declare_Function'>getid</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>s</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>n</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN137"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN138"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>in_quotes</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="acl.c.html#LN135"><span class='Ref_to_Parameter'>s</span></a> <span class='Operator'>&& </span><a href="acl.c.html#LN135"><span class='Ref_to_Parameter'>n</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span>isspace<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="acl.c.html#LN135"><span class='Ref_to_Parameter'>s</span></a><span class='Parentheses'>))</span> 
        <a href="acl.c.html#LN135"><span class='Ref_to_Parameter'>s</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* This code had better match what putid() does, below */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>; 
</span>         <span class='Operator'>*</span><a href="acl.c.html#LN135"><span class='Ref_to_Parameter'>s</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span> <span class='Operator'>&& 
</span>         <span class='Parentheses'>(</span>isalnum<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="acl.c.html#LN135"><span class='Ref_to_Parameter'>s</span></a><span class='Parentheses'>)</span> <span class='Operator'>|| 
</span>          <span class='Operator'>*</span><a href="acl.c.html#LN135"><span class='Ref_to_Parameter'>s</span></a> <span class='Operator'>== </span><span class='String'>'_'</span> <span class='Operator'>|| 
</span>          <span class='Operator'>*</span><a href="acl.c.html#LN135"><span class='Ref_to_Parameter'>s</span></a> <span class='Operator'>== </span><span class='String'>'"'</span> <span class='Operator'>|| 
</span>          <a href="acl.c.html#LN138"><span class='Ref_To_Local'>in_quotes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>         <a href="acl.c.html#LN135"><span class='Ref_to_Parameter'>s</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN135"><span class='Ref_to_Parameter'>s</span></a> <span class='Operator'>== </span><span class='String'>'"'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* safe to look at next char (could be '\0' though) */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><span class='Parentheses'>(</span><a href="acl.c.html#LN135"><span class='Ref_to_Parameter'>s</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='String'>'"'</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <a href="acl.c.html#LN138"><span class='Ref_To_Local'>in_quotes</span></a> <span class='Operator'>= !</span><a href="acl.c.html#LN138"><span class='Ref_To_Local'>in_quotes</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Comment_Multi_Line'>/* it's an escaped double quote; skip the escaping char */ 
</span>            <a href="acl.c.html#LN135"><span class='Ref_to_Parameter'>s</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Add the character to the string */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN137"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>&GT;= </span><a href="../../../interfaces/ecpg/include/sqlda-native.h.html#LN15"><span class='Ref_to_Const'>NAMEDATALEN</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NAME_TOO_LONG<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"identifier too long"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Identifier must be less than %d characters."</span><span class='Delimiter'>, 
</span>                               <a href="../../../interfaces/ecpg/include/sqlda-native.h.html#LN15"><span class='Ref_to_Const'>NAMEDATALEN</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="acl.c.html#LN135"><span class='Ref_to_Parameter'>n</span></a><span class='Delimiter'>[</span><a href="acl.c.html#LN137"><span class='Ref_To_Local'>len</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= *</span><a href="acl.c.html#LN135"><span class='Ref_to_Parameter'>s</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;*s!='\0'&&(isalnum((... &raquo; </span> 
    <a href="acl.c.html#LN135"><span class='Ref_to_Parameter'>n</span></a><span class='Delimiter'>[</span><a href="acl.c.html#LN137"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span>isspace<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="acl.c.html#LN135"><span class='Ref_to_Parameter'>s</span></a><span class='Parentheses'>))</span> 
        <a href="acl.c.html#LN135"><span class='Ref_to_Parameter'>s</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="acl.c.html#LN135"><span class='Ref_to_Parameter'>s</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end getid &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Write a role name at *p, adding double quotes if needed. 
 * There must be at least (2*NAMEDATALEN)+2 bytes available at *p. 
 * This needs to be kept in sync with copyAclUserName in pg_dump/dumputils.c 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN187"></a><span class='Declare_Function'>putid</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>p</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>s</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN189"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>src</span><span class='Delimiter'>; 
</span><a name="LN190"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>safe</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN189"><span class='Ref_To_Local'>src</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN187"><span class='Ref_to_Parameter'>s</span></a><span class='Delimiter'>; </span><span class='Operator'>*</span><a href="acl.c.html#LN189"><span class='Ref_To_Local'>src</span></a><span class='Delimiter'>; </span><a href="acl.c.html#LN189"><span class='Ref_To_Local'>src</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* This test had better match what getid() does, above */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span>isalnum<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="acl.c.html#LN189"><span class='Ref_To_Local'>src</span></a><span class='Parentheses'>)</span> <span class='Operator'>&& *</span><a href="acl.c.html#LN189"><span class='Ref_To_Local'>src</span></a> <span class='Operator'>!= </span><span class='String'>'_'</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="acl.c.html#LN190"><span class='Ref_To_Local'>safe</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="acl.c.html#LN190"><span class='Ref_To_Local'>safe</span></a><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="acl.c.html#LN187"><span class='Ref_to_Parameter'>p</span></a><span class='Operator'>++ = </span><span class='String'>'"'</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN189"><span class='Ref_To_Local'>src</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN187"><span class='Ref_to_Parameter'>s</span></a><span class='Delimiter'>; </span><span class='Operator'>*</span><a href="acl.c.html#LN189"><span class='Ref_To_Local'>src</span></a><span class='Delimiter'>; </span><a href="acl.c.html#LN189"><span class='Ref_To_Local'>src</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* A double quote character in a username is encoded as "" */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN189"><span class='Ref_To_Local'>src</span></a> <span class='Operator'>== </span><span class='String'>'"'</span><span class='Parentheses'>) 
</span>            <span class='Operator'>*</span><a href="acl.c.html#LN187"><span class='Ref_to_Parameter'>p</span></a><span class='Operator'>++ = </span><span class='String'>'"'</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="acl.c.html#LN187"><span class='Ref_to_Parameter'>p</span></a><span class='Operator'>++ = *</span><a href="acl.c.html#LN189"><span class='Ref_To_Local'>src</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="acl.c.html#LN190"><span class='Ref_To_Local'>safe</span></a><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="acl.c.html#LN187"><span class='Ref_to_Parameter'>p</span></a><span class='Operator'>++ = </span><span class='String'>'"'</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="acl.c.html#LN187"><span class='Ref_to_Parameter'>p</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end putid &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * aclparse 
 *      Consumes and parses an ACL specification of the form: 
 *              [group|user] [A-Za-z0-9]*=[rwaR]* 
 *      from string 's', ignoring any leading white space or white space 
 *      between the optional id type keyword (group|user) and the actual 
 *      ACL specification. 
 * 
 *      The group|user decoration is unnecessary in the roles world, 
 *      but we still accept it for backward compatibility. 
 * 
 *      This routine is called by the parser as well as aclitemin(), hence 
 *      the added generality. 
 * 
 * RETURNS: 
 *      the string position in 's' immediately following the ACL 
 *      specification.  Also: 
 *      - loads the structure pointed to by 'aip' with the appropriate 
 *        UID/GID, id type identifier and mode type values. 
 */ 
</span><span class='Keyword'>static const char </span><span class='Operator'>* 
</span><a name="LN236"></a><span class='Declare_Function'>aclparse</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>s</span><span class='Delimiter'>, </span><a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>aip</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN238"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>privs</span><span class='Delimiter'>, 
</span><a name="LN239"></a>                <span class='Declare_Local'>goption</span><span class='Delimiter'>, 
</span><a name="LN240"></a>                <span class='Declare_Local'>read</span><span class='Delimiter'>; 
</span><a name="LN241"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>name</span><span class='Delimiter'>[</span><a href="../../../interfaces/ecpg/include/sqlda-native.h.html#LN15"><span class='Ref_to_Const'>NAMEDATALEN</span></a><span class='Delimiter'>]; 
</span><a name="LN242"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>name2</span><span class='Delimiter'>[</span><a href="../../../interfaces/ecpg/include/sqlda-native.h.html#LN15"><span class='Ref_to_Const'>NAMEDATALEN</span></a><span class='Delimiter'>]; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="acl.c.html#LN236"><span class='Ref_to_Parameter'>s</span></a> <span class='Operator'>&& </span><a href="acl.c.html#LN236"><span class='Ref_to_Parameter'>aip</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> ACLDEBUG 
    <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, </span><span class='String'>"aclparse: input = \"%s\""</span><span class='Delimiter'>, </span><a href="acl.c.html#LN236"><span class='Ref_to_Parameter'>s</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
    <a href="acl.c.html#LN236"><span class='Ref_to_Parameter'>s</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN79"><span class='Ref_to_Proto'>getid</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN236"><span class='Ref_to_Parameter'>s</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN241"><span class='Ref_To_Local'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN236"><span class='Ref_to_Parameter'>s</span></a> <span class='Operator'>!= </span><span class='String'>'='</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* we just read a keyword, not a name */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="acl.c.html#LN241"><span class='Ref_To_Local'>name</span></a><span class='Delimiter'>, </span><span class='String'>"group"</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="acl.c.html#LN241"><span class='Ref_To_Local'>name</span></a><span class='Delimiter'>, </span><span class='String'>"user"</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"unrecognized key word: \"%s\""</span><span class='Delimiter'>, </span><a href="acl.c.html#LN241"><span class='Ref_To_Local'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"ACL key word must be \"group\" or \"user\"."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="acl.c.html#LN236"><span class='Ref_to_Parameter'>s</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN79"><span class='Ref_to_Proto'>getid</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN236"><span class='Ref_to_Parameter'>s</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN241"><span class='Ref_To_Local'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* move s to the name beyond the keyword */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN241"><span class='Ref_To_Local'>name</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"missing name"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"A name must follow the \"group\" or \"user\" key word."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN236"><span class='Ref_to_Parameter'>s</span></a> <span class='Operator'>!= </span><span class='String'>'='</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"missing \"=\" sign"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN238"><span class='Ref_To_Local'>privs</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN239"><span class='Ref_To_Local'>goption</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Operator'>++</span><a href="acl.c.html#LN236"><span class='Ref_to_Parameter'>s</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN240"><span class='Ref_To_Local'>read</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span>isalpha<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="acl.c.html#LN236"><span class='Ref_to_Parameter'>s</span></a><span class='Parentheses'>)</span> <span class='Operator'>|| *</span><a href="acl.c.html#LN236"><span class='Ref_to_Parameter'>s</span></a> <span class='Operator'>== </span><span class='String'>'*'</span><span class='Delimiter'>; </span><a href="acl.c.html#LN236"><span class='Ref_to_Parameter'>s</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN236"><span class='Ref_to_Parameter'>s</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <span class='String'>'*'</span><span class='Operator'>: 
</span>                <a href="acl.c.html#LN239"><span class='Ref_To_Local'>goption</span></a> <span class='Operator'>|= </span><a href="acl.c.html#LN240"><span class='Ref_To_Local'>read</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/acl.h.html#LN129"><span class='Ref_to_Const'>ACL_INSERT_CHR</span></a><span class='Operator'>: 
</span>                <a href="acl.c.html#LN240"><span class='Ref_To_Local'>read</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/parsenodes.h.html#LN71"><span class='Ref_to_Const'>ACL_INSERT</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/acl.h.html#LN130"><span class='Ref_to_Const'>ACL_SELECT_CHR</span></a><span class='Operator'>: 
</span>                <a href="acl.c.html#LN240"><span class='Ref_To_Local'>read</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/parsenodes.h.html#LN72"><span class='Ref_to_Const'>ACL_SELECT</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/acl.h.html#LN131"><span class='Ref_to_Const'>ACL_UPDATE_CHR</span></a><span class='Operator'>: 
</span>                <a href="acl.c.html#LN240"><span class='Ref_To_Local'>read</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/parsenodes.h.html#LN73"><span class='Ref_to_Const'>ACL_UPDATE</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/acl.h.html#LN132"><span class='Ref_to_Const'>ACL_DELETE_CHR</span></a><span class='Operator'>: 
</span>                <a href="acl.c.html#LN240"><span class='Ref_To_Local'>read</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/parsenodes.h.html#LN74"><span class='Ref_to_Const'>ACL_DELETE</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/acl.h.html#LN133"><span class='Ref_to_Const'>ACL_TRUNCATE_CHR</span></a><span class='Operator'>: 
</span>                <a href="acl.c.html#LN240"><span class='Ref_To_Local'>read</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/parsenodes.h.html#LN75"><span class='Ref_to_Const'>ACL_TRUNCATE</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/acl.h.html#LN134"><span class='Ref_to_Const'>ACL_REFERENCES_CHR</span></a><span class='Operator'>: 
</span>                <a href="acl.c.html#LN240"><span class='Ref_To_Local'>read</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/parsenodes.h.html#LN76"><span class='Ref_to_Const'>ACL_REFERENCES</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/acl.h.html#LN135"><span class='Ref_to_Const'>ACL_TRIGGER_CHR</span></a><span class='Operator'>: 
</span>                <a href="acl.c.html#LN240"><span class='Ref_To_Local'>read</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/parsenodes.h.html#LN77"><span class='Ref_to_Const'>ACL_TRIGGER</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/acl.h.html#LN136"><span class='Ref_to_Const'>ACL_EXECUTE_CHR</span></a><span class='Operator'>: 
</span>                <a href="acl.c.html#LN240"><span class='Ref_To_Local'>read</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/parsenodes.h.html#LN78"><span class='Ref_to_Const'>ACL_EXECUTE</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/acl.h.html#LN137"><span class='Ref_to_Const'>ACL_USAGE_CHR</span></a><span class='Operator'>: 
</span>                <a href="acl.c.html#LN240"><span class='Ref_To_Local'>read</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/parsenodes.h.html#LN79"><span class='Ref_to_Const'>ACL_USAGE</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/acl.h.html#LN138"><span class='Ref_to_Const'>ACL_CREATE_CHR</span></a><span class='Operator'>: 
</span>                <a href="acl.c.html#LN240"><span class='Ref_To_Local'>read</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/parsenodes.h.html#LN81"><span class='Ref_to_Const'>ACL_CREATE</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/acl.h.html#LN139"><span class='Ref_to_Const'>ACL_CREATE_TEMP_CHR</span></a><span class='Operator'>: 
</span>                <a href="acl.c.html#LN240"><span class='Ref_To_Local'>read</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/parsenodes.h.html#LN82"><span class='Ref_to_Const'>ACL_CREATE_TEMP</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/acl.h.html#LN140"><span class='Ref_to_Const'>ACL_CONNECT_CHR</span></a><span class='Operator'>: 
</span>                <a href="acl.c.html#LN240"><span class='Ref_To_Local'>read</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/parsenodes.h.html#LN83"><span class='Ref_to_Const'>ACL_CONNECT</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'R'</span><span class='Operator'>:</span>           <span class='Comment_Single_Line'>/* ignore old RULE privileges */ 
</span>                <a href="acl.c.html#LN240"><span class='Ref_To_Local'>read</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                      <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid mode character: must be one of \"%s\""</span><span class='Delimiter'>, 
</span>                             <a href="../../../include/utils/acl.h.html#LN143"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_STR</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch *s &raquo; </span> 
 
        <a href="acl.c.html#LN238"><span class='Ref_To_Local'>privs</span></a> <span class='Operator'>|= </span><a href="acl.c.html#LN240"><span class='Ref_To_Local'>read</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ++s,read=0;isalpha((u... &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN241"><span class='Ref_To_Local'>name</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>        <a href="acl.c.html#LN236"><span class='Ref_to_Parameter'>aip</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN48"><span class='Ref_to_Member'>ai_grantee</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN38"><span class='Ref_to_Const'>ACL_ID_PUBLIC</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="acl.c.html#LN236"><span class='Ref_to_Parameter'>aip</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN48"><span class='Ref_to_Member'>ai_grantee</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN234"><span class='Ref_to_Proto'>get_role_oid</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN241"><span class='Ref_To_Local'>name</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * XXX Allow a degree of backward compatibility by defaulting the grantor 
     * to the superuser. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN236"><span class='Ref_to_Parameter'>s</span></a> <span class='Operator'>== </span><span class='String'>'/'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="acl.c.html#LN236"><span class='Ref_to_Parameter'>s</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN79"><span class='Ref_to_Proto'>getid</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN236"><span class='Ref_to_Parameter'>s</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="acl.c.html#LN242"><span class='Ref_To_Local'>name2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN242"><span class='Ref_To_Local'>name2</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"a name must follow the \"/\" sign"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="acl.c.html#LN236"><span class='Ref_to_Parameter'>aip</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN49"><span class='Ref_to_Member'>ai_grantor</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN234"><span class='Ref_to_Proto'>get_role_oid</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN242"><span class='Ref_To_Local'>name2</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="acl.c.html#LN236"><span class='Ref_to_Parameter'>aip</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN49"><span class='Ref_to_Member'>ai_grantor</span></a> <span class='Operator'>= </span><a href="../../../include/catalog/pg_authid.h.html#LN101"><span class='Ref_to_Const'>BOOTSTRAP_SUPERUSERID</span></a><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_GRANTOR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"defaulting grantor to user ID %u"</span><span class='Delimiter'>, 
</span>                        <a href="../../../include/catalog/pg_authid.h.html#LN101"><span class='Ref_to_Const'>BOOTSTRAP_SUPERUSERID</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/utils/acl.h.html#LN74"><span class='Ref_to_Macro'>ACLITEM_SET_PRIVS_GOPTIONS</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN236"><span class='Ref_to_Parameter'>aip</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN238"><span class='Ref_To_Local'>privs</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN239"><span class='Ref_To_Local'>goption</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> ACLDEBUG 
    <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, </span><span class='String'>"aclparse: correctly read [%u %x %x]"</span><span class='Delimiter'>, 
</span>         <a href="acl.c.html#LN236"><span class='Ref_to_Parameter'>aip</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN48"><span class='Ref_to_Member'>ai_grantee</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN238"><span class='Ref_To_Local'>privs</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN239"><span class='Ref_To_Local'>goption</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <span class='Control'>return</span> <a href="acl.c.html#LN236"><span class='Ref_to_Parameter'>s</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end aclparse &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * allocacl 
 *      Allocates storage for a new Acl with 'n' entries. 
 * 
 * RETURNS: 
 *      the new Acl 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a> <span class='Operator'>* 
</span><a name="LN374"></a><span class='Declare_Function'>allocacl</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>n</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN376"></a>    <a href="../../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>new_acl</span><span class='Delimiter'>; 
</span><a name="LN377"></a>    <a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>size</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN374"><span class='Ref_to_Parameter'>n</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid size: %d"</span><span class='Delimiter'>, </span><a href="acl.c.html#LN374"><span class='Ref_to_Parameter'>n</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN377"><span class='Ref_To_Local'>size</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN102"><span class='Ref_to_Macro'>ACL_N_SIZE</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN374"><span class='Ref_to_Parameter'>n</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN376"><span class='Ref_To_Local'>new_acl</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN377"><span class='Ref_To_Local'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN376"><span class='Ref_To_Local'>new_acl</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN377"><span class='Ref_To_Local'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN376"><span class='Ref_To_Local'>new_acl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN78"><span class='Ref_to_Member'>ndim</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN376"><span class='Ref_To_Local'>new_acl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN79"><span class='Ref_to_Member'>dataoffset</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* we never put in any nulls */ 
</span>    <a href="acl.c.html#LN376"><span class='Ref_To_Local'>new_acl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN80"><span class='Ref_to_Member'>elemtype</span></a> <span class='Operator'>= </span><a href="../../../include/catalog/pg_type.h.html#LN492"><span class='Ref_to_Const'>ACLITEMOID</span></a><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/array.h.html#LN276"><span class='Ref_to_Macro'>ARR_LBOUND</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN376"><span class='Ref_To_Local'>new_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN376"><span class='Ref_To_Local'>new_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="acl.c.html#LN374"><span class='Ref_to_Parameter'>n</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="acl.c.html#LN376"><span class='Ref_To_Local'>new_acl</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Create a zero-entry ACL 
 */ 
</span><a href="../../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a> <span class='Operator'>* 
</span><a name="LN396"></a><span class='Declare_Function'>make_empty_acl</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="acl.c.html#LN81"><span class='Ref_to_Proto'>allocacl</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Copy an ACL 
 */ 
</span><a href="../../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a> <span class='Operator'>* 
</span><a name="LN405"></a><span class='Declare_Function'>aclcopy</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>orig_acl</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN407"></a>    <a href="../../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>result_acl</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN407"><span class='Ref_To_Local'>result_acl</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN81"><span class='Ref_to_Proto'>allocacl</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/acl.h.html#LN100"><span class='Ref_to_Macro'>ACL_NUM</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN405"><span class='Ref_to_Parameter'>orig_acl</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    memcpy<span class='Parentheses'>(</span><a href="../../../include/utils/acl.h.html#LN101"><span class='Ref_to_Macro'>ACL_DAT</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN407"><span class='Ref_To_Local'>result_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>           <a href="../../../include/utils/acl.h.html#LN101"><span class='Ref_to_Macro'>ACL_DAT</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN405"><span class='Ref_to_Parameter'>orig_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>           <a href="../../../include/utils/acl.h.html#LN100"><span class='Ref_to_Macro'>ACL_NUM</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN405"><span class='Ref_to_Parameter'>orig_acl</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="acl.c.html#LN407"><span class='Ref_To_Local'>result_acl</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Concatenate two ACLs 
 * 
 * This is a bit cheesy, since we may produce an ACL with redundant entries. 
 * Be careful what the result is used for! 
 */ 
</span><a href="../../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a> <span class='Operator'>* 
</span><a name="LN425"></a><span class='Declare_Function'>aclconcat</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>left_acl</span><span class='Delimiter'>, </span><span class='Keyword'>const </span><a href="../../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>right_acl</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN427"></a>    <a href="../../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>result_acl</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN427"><span class='Ref_To_Local'>result_acl</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN81"><span class='Ref_to_Proto'>allocacl</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/acl.h.html#LN100"><span class='Ref_to_Macro'>ACL_NUM</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN425"><span class='Ref_to_Parameter'>left_acl</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="../../../include/utils/acl.h.html#LN100"><span class='Ref_to_Macro'>ACL_NUM</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN425"><span class='Ref_to_Parameter'>right_acl</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    memcpy<span class='Parentheses'>(</span><a href="../../../include/utils/acl.h.html#LN101"><span class='Ref_to_Macro'>ACL_DAT</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN427"><span class='Ref_To_Local'>result_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>           <a href="../../../include/utils/acl.h.html#LN101"><span class='Ref_to_Macro'>ACL_DAT</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN425"><span class='Ref_to_Parameter'>left_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>           <a href="../../../include/utils/acl.h.html#LN100"><span class='Ref_to_Macro'>ACL_NUM</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN425"><span class='Ref_to_Parameter'>left_acl</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    memcpy<span class='Parentheses'>(</span><a href="../../../include/utils/acl.h.html#LN101"><span class='Ref_to_Macro'>ACL_DAT</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN427"><span class='Ref_To_Local'>result_acl</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="../../../include/utils/acl.h.html#LN100"><span class='Ref_to_Macro'>ACL_NUM</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN425"><span class='Ref_to_Parameter'>left_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>           <a href="../../../include/utils/acl.h.html#LN101"><span class='Ref_to_Macro'>ACL_DAT</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN425"><span class='Ref_to_Parameter'>right_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>           <a href="../../../include/utils/acl.h.html#LN100"><span class='Ref_to_Macro'>ACL_NUM</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN425"><span class='Ref_to_Parameter'>right_acl</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="acl.c.html#LN427"><span class='Ref_To_Local'>result_acl</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Merge two ACLs 
 * 
 * This produces a properly merged ACL with no redundant entries. 
 * Returns NULL on NULL input. 
 */ 
</span><a href="../../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a> <span class='Operator'>* 
</span><a name="LN449"></a><span class='Declare_Function'>aclmerge</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>left_acl</span><span class='Delimiter'>, </span><span class='Keyword'>const </span><a href="../../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>right_acl</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>ownerId</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN451"></a>    <a href="../../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>result_acl</span><span class='Delimiter'>; 
</span><a name="LN452"></a>    <a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>aip</span><span class='Delimiter'>; 
</span><a name="LN453"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN454"></a>                <span class='Declare_Local'>num</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check for cases where one or both are empty/null */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN449"><span class='Ref_to_Parameter'>left_acl</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="../../../include/utils/acl.h.html#LN100"><span class='Ref_to_Macro'>ACL_NUM</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN449"><span class='Ref_to_Parameter'>left_acl</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN449"><span class='Ref_to_Parameter'>right_acl</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="../../../include/utils/acl.h.html#LN100"><span class='Ref_to_Macro'>ACL_NUM</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN449"><span class='Ref_to_Parameter'>right_acl</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <span class='Control'>return</span> <a href="../../../include/utils/acl.h.html#LN219"><span class='Ref_to_Proto'>aclcopy</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN449"><span class='Ref_to_Parameter'>right_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN449"><span class='Ref_to_Parameter'>right_acl</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="../../../include/utils/acl.h.html#LN100"><span class='Ref_to_Macro'>ACL_NUM</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN449"><span class='Ref_to_Parameter'>right_acl</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <a href="../../../include/utils/acl.h.html#LN219"><span class='Ref_to_Proto'>aclcopy</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN449"><span class='Ref_to_Parameter'>left_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Merge them the hard way, one item at a time */ 
</span>    <a href="acl.c.html#LN451"><span class='Ref_To_Local'>result_acl</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN219"><span class='Ref_to_Proto'>aclcopy</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN449"><span class='Ref_to_Parameter'>left_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN452"><span class='Ref_To_Local'>aip</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN101"><span class='Ref_to_Macro'>ACL_DAT</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN449"><span class='Ref_to_Parameter'>right_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN454"><span class='Ref_To_Local'>num</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN100"><span class='Ref_to_Macro'>ACL_NUM</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN449"><span class='Ref_to_Parameter'>right_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN453"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="acl.c.html#LN453"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="acl.c.html#LN454"><span class='Ref_To_Local'>num</span></a><span class='Delimiter'>; </span><a href="acl.c.html#LN453"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>, </span><a href="acl.c.html#LN452"><span class='Ref_To_Local'>aip</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN478"></a>        <a href="../../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>tmp_acl</span><span class='Delimiter'>; 
</span> 
        <a href="acl.c.html#LN478"><span class='Ref_To_Local'>tmp_acl</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN215"><span class='Ref_to_Proto'>aclupdate</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN451"><span class='Ref_To_Local'>result_acl</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN452"><span class='Ref_To_Local'>aip</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/acl.h.html#LN121"><span class='Ref_to_Const'>ACL_MODECHG_ADD</span></a><span class='Delimiter'>, 
</span>                            <a href="acl.c.html#LN449"><span class='Ref_to_Parameter'>ownerId</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN1654"><span class='Ref_to_EnumConst'>DROP_RESTRICT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN451"><span class='Ref_To_Local'>result_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="acl.c.html#LN451"><span class='Ref_To_Local'>result_acl</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN478"><span class='Ref_To_Local'>tmp_acl</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="acl.c.html#LN451"><span class='Ref_To_Local'>result_acl</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end aclmerge &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Sort the items in an ACL (into an arbitrary but consistent order) 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN493"></a><span class='Declare_Function'>aclitemsort</span><span class='Parentheses'>(</span><a href="../../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>acl</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN493"><span class='Ref_to_Parameter'>acl</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="../../../include/utils/acl.h.html#LN100"><span class='Ref_to_Macro'>ACL_NUM</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN493"><span class='Ref_to_Parameter'>acl</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <a href="../../../include/port.h.html#LN439"><span class='Ref_to_Macro'>qsort</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/acl.h.html#LN101"><span class='Ref_to_Macro'>ACL_DAT</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN493"><span class='Ref_to_Parameter'>acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/utils/acl.h.html#LN100"><span class='Ref_to_Macro'>ACL_NUM</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN493"><span class='Ref_to_Parameter'>acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="acl.c.html#LN85"><span class='Ref_to_Proto'>aclitemComparator</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Check if two ACLs are exactly equal 
 * 
 * This will not detect equality if the two arrays contain the same items 
 * in different orders.  To handle that case, sort both inputs first, 
 * using aclitemsort(). 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN507"></a><span class='Declare_Function'>aclequal</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>left_acl</span><span class='Delimiter'>, </span><span class='Keyword'>const </span><a href="../../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>right_acl</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Check for cases where one or both are empty/null */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN507"><span class='Ref_to_Parameter'>left_acl</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="../../../include/utils/acl.h.html#LN100"><span class='Ref_to_Macro'>ACL_NUM</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN507"><span class='Ref_to_Parameter'>left_acl</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN507"><span class='Ref_to_Parameter'>right_acl</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="../../../include/utils/acl.h.html#LN100"><span class='Ref_to_Macro'>ACL_NUM</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN507"><span class='Ref_to_Parameter'>right_acl</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN507"><span class='Ref_to_Parameter'>right_acl</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="../../../include/utils/acl.h.html#LN100"><span class='Ref_to_Macro'>ACL_NUM</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN507"><span class='Ref_to_Parameter'>right_acl</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/acl.h.html#LN100"><span class='Ref_to_Macro'>ACL_NUM</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN507"><span class='Ref_to_Parameter'>left_acl</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../../include/utils/acl.h.html#LN100"><span class='Ref_to_Macro'>ACL_NUM</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN507"><span class='Ref_to_Parameter'>right_acl</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>memcmp<span class='Parentheses'>(</span><a href="../../../include/utils/acl.h.html#LN101"><span class='Ref_to_Macro'>ACL_DAT</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN507"><span class='Ref_to_Parameter'>left_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>               <a href="../../../include/utils/acl.h.html#LN101"><span class='Ref_to_Macro'>ACL_DAT</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN507"><span class='Ref_to_Parameter'>right_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>               <a href="../../../include/utils/acl.h.html#LN100"><span class='Ref_to_Macro'>ACL_NUM</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN507"><span class='Ref_to_Parameter'>left_acl</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end aclequal &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Verify that an ACL array is acceptable (one-dimensional and has no nulls) 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN538"></a><span class='Declare_Function'>check_acl</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>acl</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN272"><span class='Ref_to_Macro'>ARR_ELEMTYPE</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN538"><span class='Ref_to_Parameter'>acl</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../../include/catalog/pg_type.h.html#LN492"><span class='Ref_to_Const'>ACLITEMOID</span></a><span class='Parentheses'>)</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"ACL array contains wrong data type"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN538"><span class='Ref_to_Parameter'>acl</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"ACL arrays must be one-dimensional"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN271"><span class='Ref_to_Macro'>ARR_HASNULL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN538"><span class='Ref_to_Parameter'>acl</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NULL_VALUE_NOT_ALLOWED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"ACL arrays must not contain null values"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * aclitemin 
 *      Allocates storage for, and fills in, a new AclItem given a string 
 *      's' that contains an ACL specification.  See aclparse for details. 
 * 
 * RETURNS: 
 *      the new AclItem 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN563"></a><span class='Declare_Function'>aclitemin</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN565"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>s</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN241"><span class='Ref_to_Macro'>PG_GETARG_CSTRING</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN566"></a>    <a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>aip</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN566"><span class='Ref_To_Local'>aip</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN565"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN83"><span class='Ref_to_Proto'>aclparse</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN565"><span class='Ref_To_Local'>s</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN566"><span class='Ref_To_Local'>aip</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span>isspace<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="acl.c.html#LN565"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>))</span> 
        <span class='Operator'>++</span><a href="acl.c.html#LN565"><span class='Ref_To_Local'>s</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN565"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>               <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"extra garbage at the end of the ACL specification"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/acl.h.html#LN110"><span class='Ref_to_Macro'>PG_RETURN_ACLITEM_P</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN566"><span class='Ref_To_Local'>aip</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * aclitemout 
 *      Allocates storage for, and fills in, a new null-delimited string 
 *      containing a formatted ACL specification.  See aclparse for details. 
 * 
 * RETURNS: 
 *      the new string 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN589"></a><span class='Declare_Function'>aclitemout</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN591"></a>    <a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>aip</span> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN109"><span class='Ref_to_Macro'>PG_GETARG_ACLITEM_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN592"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span><a name="LN593"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>out</span><span class='Delimiter'>; 
</span><a name="LN594"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>htup</span><span class='Delimiter'>; 
</span><a name="LN595"></a>    <span class='Keyword'>unsigned</span>    <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN593"><span class='Ref_To_Local'>out</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><span class='String'>"=/"</span><span class='Parentheses'>) </span><span class='Operator'>+ 
</span>                 <span class='Number'>2</span> <span class='Operator'>* </span><a href="../../../include/nodes/parsenodes.h.html#LN84"><span class='Ref_to_Const'>N_ACL_RIGHTS</span></a> <span class='Operator'>+ 
</span>                 <span class='Number'>2</span> <span class='Operator'>* </span><span class='Parentheses'>(</span><span class='Number'>2</span> <span class='Operator'>* </span><a href="../../../interfaces/ecpg/include/sqlda-native.h.html#LN15"><span class='Ref_to_Const'>NAMEDATALEN</span></a> <span class='Operator'>+ </span><span class='Number'>2</span><span class='Parentheses'>) </span><span class='Operator'>+ 
</span>                 <span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN592"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN593"><span class='Ref_To_Local'>out</span></a><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="acl.c.html#LN592"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN591"><span class='Ref_To_Local'>aip</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN48"><span class='Ref_to_Member'>ai_grantee</span></a> <span class='Operator'>!= </span><a href="../../../include/utils/acl.h.html#LN38"><span class='Ref_to_Const'>ACL_ID_PUBLIC</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="acl.c.html#LN594"><span class='Ref_To_Local'>htup</span></a> <span class='Operator'>= </span><a href="../../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN44"><span class='Ref_to_EnumConst'>AUTHOID</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN591"><span class='Ref_To_Local'>aip</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN48"><span class='Ref_to_Member'>ai_grantee</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN594"><span class='Ref_To_Local'>htup</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="acl.c.html#LN80"><span class='Ref_to_Proto'>putid</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN592"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(((</span><a href="../../../include/catalog/pg_authid.h.html#LN71"><span class='Ref_to_Typedef'>Form_pg_authid</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN594"><span class='Ref_To_Local'>htup</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>rolname<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN594"><span class='Ref_To_Local'>htup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Generate numeric OID if we don't find an entry */ 
</span>            <a href="../../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN592"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><span class='String'>"%u"</span><span class='Delimiter'>, </span><a href="acl.c.html#LN591"><span class='Ref_To_Local'>aip</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN48"><span class='Ref_to_Member'>ai_grantee</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN592"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>) 
</span>        <span class='Operator'>++</span><a href="acl.c.html#LN592"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="acl.c.html#LN592"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++ = </span><span class='String'>'='</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN595"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="acl.c.html#LN595"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="../../../include/nodes/parsenodes.h.html#LN84"><span class='Ref_to_Const'>N_ACL_RIGHTS</span></a><span class='Delimiter'>; </span><span class='Operator'>++</span><a href="acl.c.html#LN595"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/acl.h.html#LN58"><span class='Ref_to_Macro'>ACLITEM_GET_PRIVS</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN591"><span class='Ref_To_Local'>aip</span></a><span class='Parentheses'>) </span><span class='Operator'>& </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><a href="acl.c.html#LN595"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>))</span> 
            <span class='Operator'>*</span><a href="acl.c.html#LN592"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++ = </span><a href="../../../include/utils/acl.h.html#LN143"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_STR</span></a><span class='Delimiter'>[</span><a href="acl.c.html#LN595"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/acl.h.html#LN59"><span class='Ref_to_Macro'>ACLITEM_GET_GOPTIONS</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN591"><span class='Ref_To_Local'>aip</span></a><span class='Parentheses'>) </span><span class='Operator'>& </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><a href="acl.c.html#LN595"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>))</span> 
            <span class='Operator'>*</span><a href="acl.c.html#LN592"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++ = </span><span class='String'>'*'</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Operator'>*</span><a href="acl.c.html#LN592"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++ = </span><span class='String'>'/'</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="acl.c.html#LN592"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN594"><span class='Ref_To_Local'>htup</span></a> <span class='Operator'>= </span><a href="../../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN44"><span class='Ref_to_EnumConst'>AUTHOID</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN591"><span class='Ref_To_Local'>aip</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN49"><span class='Ref_to_Member'>ai_grantor</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN594"><span class='Ref_To_Local'>htup</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="acl.c.html#LN80"><span class='Ref_to_Proto'>putid</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN592"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(((</span><a href="../../../include/catalog/pg_authid.h.html#LN71"><span class='Ref_to_Typedef'>Form_pg_authid</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN594"><span class='Ref_To_Local'>htup</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>rolname<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN594"><span class='Ref_To_Local'>htup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Generate numeric OID if we don't find an entry */ 
</span>        <a href="../../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN592"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><span class='String'>"%u"</span><span class='Delimiter'>, </span><a href="acl.c.html#LN591"><span class='Ref_To_Local'>aip</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN49"><span class='Ref_to_Member'>ai_grantor</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/fmgr.h.html#LN321"><span class='Ref_to_Macro'>PG_RETURN_CSTRING</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN593"><span class='Ref_To_Local'>out</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end aclitemout &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * aclitem_match 
 *      Two AclItems are considered to match iff they have the same 
 *      grantee and grantor; the privileges are ignored. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN656"></a><span class='Declare_Function'>aclitem_match</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>a1</span><span class='Delimiter'>, </span><span class='Keyword'>const </span><a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>a2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="acl.c.html#LN656"><span class='Ref_to_Parameter'>a1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN48"><span class='Ref_to_Member'>ai_grantee</span></a> <span class='Operator'>== </span><a href="acl.c.html#LN656"><span class='Ref_to_Parameter'>a2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN48"><span class='Ref_to_Member'>ai_grantee</span></a> <span class='Operator'>&& 
</span>        <a href="acl.c.html#LN656"><span class='Ref_to_Parameter'>a1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN49"><span class='Ref_to_Member'>ai_grantor</span></a> <span class='Operator'>== </span><a href="acl.c.html#LN656"><span class='Ref_to_Parameter'>a2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN49"><span class='Ref_to_Member'>ai_grantor</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * aclitemComparator 
 *      qsort comparison function for AclItems 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN667"></a><span class='Declare_Function'>aclitemComparator</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg1</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN669"></a>    <span class='Keyword'>const </span><a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>a1</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="acl.c.html#LN667"><span class='Ref_to_Parameter'>arg1</span></a><span class='Delimiter'>; 
</span><a name="LN670"></a>    <span class='Keyword'>const </span><a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>a2</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="acl.c.html#LN667"><span class='Ref_to_Parameter'>arg2</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN669"><span class='Ref_To_Local'>a1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN48"><span class='Ref_to_Member'>ai_grantee</span></a> <span class='Operator'>&GT; </span><a href="acl.c.html#LN670"><span class='Ref_To_Local'>a2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN48"><span class='Ref_to_Member'>ai_grantee</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN669"><span class='Ref_To_Local'>a1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN48"><span class='Ref_to_Member'>ai_grantee</span></a> <span class='Operator'>&LT; </span><a href="acl.c.html#LN670"><span class='Ref_To_Local'>a2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN48"><span class='Ref_to_Member'>ai_grantee</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN669"><span class='Ref_To_Local'>a1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN49"><span class='Ref_to_Member'>ai_grantor</span></a> <span class='Operator'>&GT; </span><a href="acl.c.html#LN670"><span class='Ref_To_Local'>a2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN49"><span class='Ref_to_Member'>ai_grantor</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN669"><span class='Ref_To_Local'>a1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN49"><span class='Ref_to_Member'>ai_grantor</span></a> <span class='Operator'>&LT; </span><a href="acl.c.html#LN670"><span class='Ref_To_Local'>a2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN49"><span class='Ref_to_Member'>ai_grantor</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN669"><span class='Ref_To_Local'>a1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN50"><span class='Ref_to_Member'>ai_privs</span></a> <span class='Operator'>&GT; </span><a href="acl.c.html#LN670"><span class='Ref_To_Local'>a2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN50"><span class='Ref_to_Member'>ai_privs</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN669"><span class='Ref_To_Local'>a1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN50"><span class='Ref_to_Member'>ai_privs</span></a> <span class='Operator'>&LT; </span><a href="acl.c.html#LN670"><span class='Ref_To_Local'>a2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN50"><span class='Ref_to_Member'>ai_privs</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end aclitemComparator &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * aclitem equality operator 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN691"></a><span class='Declare_Function'>aclitem_eq</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN693"></a>    <a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>a1</span> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN109"><span class='Ref_to_Macro'>PG_GETARG_ACLITEM_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN694"></a>    <a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>a2</span> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN109"><span class='Ref_to_Macro'>PG_GETARG_ACLITEM_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN695"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN695"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN693"><span class='Ref_To_Local'>a1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN50"><span class='Ref_to_Member'>ai_privs</span></a> <span class='Operator'>== </span><a href="acl.c.html#LN694"><span class='Ref_To_Local'>a2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN50"><span class='Ref_to_Member'>ai_privs</span></a> <span class='Operator'>&& 
</span>        <a href="acl.c.html#LN693"><span class='Ref_To_Local'>a1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN48"><span class='Ref_to_Member'>ai_grantee</span></a> <span class='Operator'>== </span><a href="acl.c.html#LN694"><span class='Ref_To_Local'>a2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN48"><span class='Ref_to_Member'>ai_grantee</span></a> <span class='Operator'>&& 
</span>        <a href="acl.c.html#LN693"><span class='Ref_To_Local'>a1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN49"><span class='Ref_to_Member'>ai_grantor</span></a> <span class='Operator'>== </span><a href="acl.c.html#LN694"><span class='Ref_To_Local'>a2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN49"><span class='Ref_to_Member'>ai_grantor</span></a><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN695"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * aclitem hash function 
 * 
 * We make aclitems hashable not so much because anyone is likely to hash 
 * them, as because we want array equality to work on aclitem arrays, and 
 * with the typcache mechanism we must have a hash or btree opclass. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN711"></a><span class='Declare_Function'>hash_aclitem</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN713"></a>    <a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>a</span> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN109"><span class='Ref_to_Macro'>PG_GETARG_ACLITEM_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* not very bright, but avoids any issue of padding in struct */ 
</span>    <a href="../../../include/fmgr.h.html#LN314"><span class='Ref_to_Macro'>PG_RETURN_UINT32</span></a><span class='Parentheses'>((</span><a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) (</span><a href="acl.c.html#LN713"><span class='Ref_To_Local'>a</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN50"><span class='Ref_to_Member'>ai_privs</span></a> <span class='Operator'>+ </span><a href="acl.c.html#LN713"><span class='Ref_To_Local'>a</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN48"><span class='Ref_to_Member'>ai_grantee</span></a> <span class='Operator'>+ </span><a href="acl.c.html#LN713"><span class='Ref_To_Local'>a</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN49"><span class='Ref_to_Member'>ai_grantor</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * acldefault()  --- create an ACL describing default access permissions 
 * 
 * Change this routine if you want to alter the default access policy for 
 * newly-created objects (or any object with a NULL acl entry). 
 * 
 * Note that these are the hard-wired "defaults" that are used in the 
 * absence of any pg_default_acl entry. 
 */ 
</span><a href="../../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a> <span class='Operator'>* 
</span><a name="LN730"></a><span class='Declare_Function'>acldefault</span><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN1811"><span class='Ref_to_Enum'>GrantObjectType</span></a> <span class='Declare_Parameter'>objtype</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>ownerId</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN732"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>world_default</span><span class='Delimiter'>; 
</span><a name="LN733"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>owner_default</span><span class='Delimiter'>; 
</span><a name="LN734"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nacl</span><span class='Delimiter'>; 
</span><a name="LN735"></a>    <a href="../../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>acl</span><span class='Delimiter'>; 
</span><a name="LN736"></a>    <a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>aip</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN730"><span class='Ref_to_Parameter'>objtype</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN1813"><span class='Ref_to_EnumConst'>ACL_OBJECT_COLUMN</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* by default, columns have no extra privileges */ 
</span>            <a href="acl.c.html#LN732"><span class='Ref_To_Local'>world_default</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Delimiter'>; 
</span>            <a href="acl.c.html#LN733"><span class='Ref_To_Local'>owner_default</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN1814"><span class='Ref_to_EnumConst'>ACL_OBJECT_RELATION</span></a><span class='Operator'>: 
</span>            <a href="acl.c.html#LN732"><span class='Ref_To_Local'>world_default</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Delimiter'>; 
</span>            <a href="acl.c.html#LN733"><span class='Ref_To_Local'>owner_default</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN149"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_RELATION</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN1815"><span class='Ref_to_EnumConst'>ACL_OBJECT_SEQUENCE</span></a><span class='Operator'>: 
</span>            <a href="acl.c.html#LN732"><span class='Ref_To_Local'>world_default</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Delimiter'>; 
</span>            <a href="acl.c.html#LN733"><span class='Ref_To_Local'>owner_default</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN150"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_SEQUENCE</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN1816"><span class='Ref_to_EnumConst'>ACL_OBJECT_DATABASE</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* for backwards compatibility, grant some rights by default */ 
</span>            <a href="acl.c.html#LN732"><span class='Ref_To_Local'>world_default</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/parsenodes.h.html#LN82"><span class='Ref_to_Const'>ACL_CREATE_TEMP</span></a> <span class='Operator'>| </span><a href="../../../include/nodes/parsenodes.h.html#LN83"><span class='Ref_to_Const'>ACL_CONNECT</span></a><span class='Delimiter'>; 
</span>            <a href="acl.c.html#LN733"><span class='Ref_To_Local'>owner_default</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN151"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_DATABASE</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN1820"><span class='Ref_to_EnumConst'>ACL_OBJECT_FUNCTION</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* Grant EXECUTE by default, for now */ 
</span>            <a href="acl.c.html#LN732"><span class='Ref_To_Local'>world_default</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/parsenodes.h.html#LN78"><span class='Ref_to_Const'>ACL_EXECUTE</span></a><span class='Delimiter'>; 
</span>            <a href="acl.c.html#LN733"><span class='Ref_To_Local'>owner_default</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN154"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_FUNCTION</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN1821"><span class='Ref_to_EnumConst'>ACL_OBJECT_LANGUAGE</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* Grant USAGE by default, for now */ 
</span>            <a href="acl.c.html#LN732"><span class='Ref_To_Local'>world_default</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/parsenodes.h.html#LN79"><span class='Ref_to_Const'>ACL_USAGE</span></a><span class='Delimiter'>; 
</span>            <a href="acl.c.html#LN733"><span class='Ref_To_Local'>owner_default</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN155"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_LANGUAGE</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN1822"><span class='Ref_to_EnumConst'>ACL_OBJECT_LARGEOBJECT</span></a><span class='Operator'>: 
</span>            <a href="acl.c.html#LN732"><span class='Ref_To_Local'>world_default</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Delimiter'>; 
</span>            <a href="acl.c.html#LN733"><span class='Ref_To_Local'>owner_default</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN156"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_LARGEOBJECT</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN1823"><span class='Ref_to_EnumConst'>ACL_OBJECT_NAMESPACE</span></a><span class='Operator'>: 
</span>            <a href="acl.c.html#LN732"><span class='Ref_To_Local'>world_default</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Delimiter'>; 
</span>            <a href="acl.c.html#LN733"><span class='Ref_To_Local'>owner_default</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN157"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_NAMESPACE</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN1824"><span class='Ref_to_EnumConst'>ACL_OBJECT_TABLESPACE</span></a><span class='Operator'>: 
</span>            <a href="acl.c.html#LN732"><span class='Ref_To_Local'>world_default</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Delimiter'>; 
</span>            <a href="acl.c.html#LN733"><span class='Ref_To_Local'>owner_default</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN158"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_TABLESPACE</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN1818"><span class='Ref_to_EnumConst'>ACL_OBJECT_FDW</span></a><span class='Operator'>: 
</span>            <a href="acl.c.html#LN732"><span class='Ref_To_Local'>world_default</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Delimiter'>; 
</span>            <a href="acl.c.html#LN733"><span class='Ref_To_Local'>owner_default</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN152"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_FDW</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN1819"><span class='Ref_to_EnumConst'>ACL_OBJECT_FOREIGN_SERVER</span></a><span class='Operator'>: 
</span>            <a href="acl.c.html#LN732"><span class='Ref_To_Local'>world_default</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Delimiter'>; 
</span>            <a href="acl.c.html#LN733"><span class='Ref_To_Local'>owner_default</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN153"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_FOREIGN_SERVER</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN1817"><span class='Ref_to_EnumConst'>ACL_OBJECT_DOMAIN</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN1825"><span class='Ref_to_EnumConst'>ACL_OBJECT_TYPE</span></a><span class='Operator'>: 
</span>            <a href="acl.c.html#LN732"><span class='Ref_To_Local'>world_default</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/parsenodes.h.html#LN79"><span class='Ref_to_Const'>ACL_USAGE</span></a><span class='Delimiter'>; 
</span>            <a href="acl.c.html#LN733"><span class='Ref_To_Local'>owner_default</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN159"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_TYPE</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized objtype: %d"</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="acl.c.html#LN730"><span class='Ref_to_Parameter'>objtype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="acl.c.html#LN732"><span class='Ref_To_Local'>world_default</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>            <a href="acl.c.html#LN733"><span class='Ref_To_Local'>owner_default</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch objtype &raquo; </span> 
 
    <a href="acl.c.html#LN734"><span class='Ref_To_Local'>nacl</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN732"><span class='Ref_To_Local'>world_default</span></a> <span class='Operator'>!= </span><a href="../../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Parentheses'>) 
</span>        <a href="acl.c.html#LN734"><span class='Ref_To_Local'>nacl</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN733"><span class='Ref_To_Local'>owner_default</span></a> <span class='Operator'>!= </span><a href="../../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Parentheses'>) 
</span>        <a href="acl.c.html#LN734"><span class='Ref_To_Local'>nacl</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN735"><span class='Ref_To_Local'>acl</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN81"><span class='Ref_to_Proto'>allocacl</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN734"><span class='Ref_To_Local'>nacl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN736"><span class='Ref_To_Local'>aip</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN101"><span class='Ref_to_Macro'>ACL_DAT</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN735"><span class='Ref_To_Local'>acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN732"><span class='Ref_To_Local'>world_default</span></a> <span class='Operator'>!= </span><a href="../../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="acl.c.html#LN736"><span class='Ref_To_Local'>aip</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN48"><span class='Ref_to_Member'>ai_grantee</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN38"><span class='Ref_to_Const'>ACL_ID_PUBLIC</span></a><span class='Delimiter'>; 
</span>        <a href="acl.c.html#LN736"><span class='Ref_To_Local'>aip</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN49"><span class='Ref_to_Member'>ai_grantor</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN730"><span class='Ref_to_Parameter'>ownerId</span></a><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/acl.h.html#LN74"><span class='Ref_to_Macro'>ACLITEM_SET_PRIVS_GOPTIONS</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN736"><span class='Ref_To_Local'>aip</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN732"><span class='Ref_To_Local'>world_default</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="acl.c.html#LN736"><span class='Ref_To_Local'>aip</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Note that the owner's entry shows all ordinary privileges but no grant 
     * options.  This is because his grant options come "from the system" and 
     * not from his own efforts.  (The SQL spec says that the owner's rights 
     * come from a "_SYSTEM" authid.)  However, we do consider that the 
     * owner's ordinary privileges are self-granted; this lets him revoke 
     * them.  We implement the owner's grant options without any explicit 
     * "_SYSTEM"-like ACL entry, by internally special-casing the owner 
     * wherever we are testing grant options. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN733"><span class='Ref_To_Local'>owner_default</span></a> <span class='Operator'>!= </span><a href="../../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="acl.c.html#LN736"><span class='Ref_To_Local'>aip</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN48"><span class='Ref_to_Member'>ai_grantee</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN730"><span class='Ref_to_Parameter'>ownerId</span></a><span class='Delimiter'>; 
</span>        <a href="acl.c.html#LN736"><span class='Ref_To_Local'>aip</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN49"><span class='Ref_to_Member'>ai_grantor</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN730"><span class='Ref_to_Parameter'>ownerId</span></a><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/acl.h.html#LN74"><span class='Ref_to_Macro'>ACLITEM_SET_PRIVS_GOPTIONS</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN736"><span class='Ref_To_Local'>aip</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN733"><span class='Ref_To_Local'>owner_default</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="acl.c.html#LN735"><span class='Ref_To_Local'>acl</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end acldefault &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * SQL-accessible version of acldefault().  Hackish mapping from "char" type to 
 * ACL_OBJECT_* values, but it's only used in the information schema, not 
 * documented for general use. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN844"></a><span class='Declare_Function'>acldefault_sql</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN846"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>objtypec</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN237"><span class='Ref_to_Macro'>PG_GETARG_CHAR</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN847"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>owner</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN848"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN1811"><span class='Ref_to_Enum'>GrantObjectType</span></a> <span class='Declare_Local'>objtype</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN846"><span class='Ref_To_Local'>objtypec</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <span class='String'>'c'</span><span class='Operator'>: 
</span>            <a href="acl.c.html#LN848"><span class='Ref_To_Local'>objtype</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/parsenodes.h.html#LN1813"><span class='Ref_to_EnumConst'>ACL_OBJECT_COLUMN</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <span class='String'>'r'</span><span class='Operator'>: 
</span>            <a href="acl.c.html#LN848"><span class='Ref_To_Local'>objtype</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/parsenodes.h.html#LN1814"><span class='Ref_to_EnumConst'>ACL_OBJECT_RELATION</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <span class='String'>'s'</span><span class='Operator'>: 
</span>            <a href="acl.c.html#LN848"><span class='Ref_To_Local'>objtype</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/parsenodes.h.html#LN1815"><span class='Ref_to_EnumConst'>ACL_OBJECT_SEQUENCE</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <span class='String'>'d'</span><span class='Operator'>: 
</span>            <a href="acl.c.html#LN848"><span class='Ref_To_Local'>objtype</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/parsenodes.h.html#LN1816"><span class='Ref_to_EnumConst'>ACL_OBJECT_DATABASE</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <span class='String'>'f'</span><span class='Operator'>: 
</span>            <a href="acl.c.html#LN848"><span class='Ref_To_Local'>objtype</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/parsenodes.h.html#LN1820"><span class='Ref_to_EnumConst'>ACL_OBJECT_FUNCTION</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <span class='String'>'l'</span><span class='Operator'>: 
</span>            <a href="acl.c.html#LN848"><span class='Ref_To_Local'>objtype</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/parsenodes.h.html#LN1821"><span class='Ref_to_EnumConst'>ACL_OBJECT_LANGUAGE</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <span class='String'>'L'</span><span class='Operator'>: 
</span>            <a href="acl.c.html#LN848"><span class='Ref_To_Local'>objtype</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/parsenodes.h.html#LN1822"><span class='Ref_to_EnumConst'>ACL_OBJECT_LARGEOBJECT</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <span class='String'>'n'</span><span class='Operator'>: 
</span>            <a href="acl.c.html#LN848"><span class='Ref_To_Local'>objtype</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/parsenodes.h.html#LN1823"><span class='Ref_to_EnumConst'>ACL_OBJECT_NAMESPACE</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <span class='String'>'t'</span><span class='Operator'>: 
</span>            <a href="acl.c.html#LN848"><span class='Ref_To_Local'>objtype</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/parsenodes.h.html#LN1824"><span class='Ref_to_EnumConst'>ACL_OBJECT_TABLESPACE</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <span class='String'>'F'</span><span class='Operator'>: 
</span>            <a href="acl.c.html#LN848"><span class='Ref_To_Local'>objtype</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/parsenodes.h.html#LN1818"><span class='Ref_to_EnumConst'>ACL_OBJECT_FDW</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <span class='String'>'S'</span><span class='Operator'>: 
</span>            <a href="acl.c.html#LN848"><span class='Ref_To_Local'>objtype</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/parsenodes.h.html#LN1819"><span class='Ref_to_EnumConst'>ACL_OBJECT_FOREIGN_SERVER</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <span class='String'>'T'</span><span class='Operator'>: 
</span>            <a href="acl.c.html#LN848"><span class='Ref_To_Local'>objtype</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/parsenodes.h.html#LN1825"><span class='Ref_to_EnumConst'>ACL_OBJECT_TYPE</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized objtype abbreviation: %c"</span><span class='Delimiter'>, </span><a href="acl.c.html#LN846"><span class='Ref_To_Local'>objtypec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch objtypec &raquo; </span> 
 
    <a href="../../../include/utils/acl.h.html#LN116"><span class='Ref_to_Macro'>PG_RETURN_ACL_P</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/acl.h.html#LN211"><span class='Ref_to_Proto'>acldefault</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN848"><span class='Ref_To_Local'>objtype</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN847"><span class='Ref_To_Local'>owner</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end acldefault_sql &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Update an ACL array to add or remove specified privileges. 
 * 
 *  old_acl: the input ACL array 
 *  mod_aip: defines the privileges to be added, removed, or substituted 
 *  modechg: ACL_MODECHG_ADD, ACL_MODECHG_DEL, or ACL_MODECHG_EQL 
 *  ownerId: Oid of object owner 
 *  behavior: RESTRICT or CASCADE behavior for recursive removal 
 * 
 * ownerid and behavior are only relevant when the update operation specifies 
 * deletion of grant options. 
 * 
 * The result is a modified copy; the input object is not changed. 
 * 
 * NB: caller is responsible for having detoasted the input ACL, if needed. 
 */ 
</span><a href="../../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a> <span class='Operator'>* 
</span><a name="LN913"></a><span class='Declare_Function'>aclupdate</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>old_acl</span><span class='Delimiter'>, </span><span class='Keyword'>const </span><a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>mod_aip</span><span class='Delimiter'>, 
</span><a name="LN914"></a>          <span class='Keyword'>int </span><span class='Declare_Parameter'>modechg</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>ownerId</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN1652"><span class='Ref_to_Enum'>DropBehavior</span></a> <span class='Declare_Parameter'>behavior</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN916"></a>    <a href="../../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>new_acl</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN917"></a>    <a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>old_aip</span><span class='Delimiter'>, 
</span><a name="LN918"></a>               <span class='Operator'>*</span><span class='Declare_Local'>new_aip</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN919"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>old_rights</span><span class='Delimiter'>, 
</span><a name="LN920"></a>                <span class='Declare_Local'>old_goptions</span><span class='Delimiter'>, 
</span><a name="LN921"></a>                <span class='Declare_Local'>new_rights</span><span class='Delimiter'>, 
</span><a name="LN922"></a>                <span class='Declare_Local'>new_goptions</span><span class='Delimiter'>; 
</span><a name="LN923"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>dst</span><span class='Delimiter'>, 
</span><a name="LN924"></a>                <span class='Declare_Local'>num</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Caller probably already checked old_acl, but be safe */ 
</span>    <a href="acl.c.html#LN82"><span class='Ref_to_Proto'>check_acl</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN913"><span class='Ref_to_Parameter'>old_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If granting grant options, check for circularity */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN914"><span class='Ref_to_Parameter'>modechg</span></a> <span class='Operator'>!= </span><a href="../../../include/utils/acl.h.html#LN122"><span class='Ref_to_Const'>ACL_MODECHG_DEL</span></a> <span class='Operator'>&& 
</span>        <a href="../../../include/utils/acl.h.html#LN59"><span class='Ref_to_Macro'>ACLITEM_GET_GOPTIONS</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN913"><span class='Ref_to_Parameter'>mod_aip</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Parentheses'>)</span> 
        <a href="acl.c.html#LN86"><span class='Ref_to_Proto'>check_circularity</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN913"><span class='Ref_to_Parameter'>old_acl</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN913"><span class='Ref_to_Parameter'>mod_aip</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN914"><span class='Ref_to_Parameter'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN924"><span class='Ref_To_Local'>num</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN100"><span class='Ref_to_Macro'>ACL_NUM</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN913"><span class='Ref_to_Parameter'>old_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN917"><span class='Ref_To_Local'>old_aip</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN101"><span class='Ref_to_Macro'>ACL_DAT</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN913"><span class='Ref_to_Parameter'>old_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Search the ACL for an existing entry for this grantee and grantor. If 
     * one exists, just modify the entry in-place (well, in the same position, 
     * since we actually return a copy); otherwise, insert the new entry at 
     * the end. 
     */ 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN923"><span class='Ref_To_Local'>dst</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="acl.c.html#LN923"><span class='Ref_To_Local'>dst</span></a> <span class='Operator'>&LT; </span><a href="acl.c.html#LN924"><span class='Ref_To_Local'>num</span></a><span class='Delimiter'>; </span><span class='Operator'>++</span><a href="acl.c.html#LN923"><span class='Ref_To_Local'>dst</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN84"><span class='Ref_to_Proto'>aclitem_match</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN913"><span class='Ref_to_Parameter'>mod_aip</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN917"><span class='Ref_To_Local'>old_aip</span></a> <span class='Operator'>+ </span><a href="acl.c.html#LN923"><span class='Ref_To_Local'>dst</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* found a match, so modify existing item */ 
</span>            <a href="acl.c.html#LN916"><span class='Ref_To_Local'>new_acl</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN81"><span class='Ref_to_Proto'>allocacl</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN924"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="acl.c.html#LN918"><span class='Ref_To_Local'>new_aip</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN101"><span class='Ref_to_Macro'>ACL_DAT</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN916"><span class='Ref_To_Local'>new_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            memcpy<span class='Parentheses'>(</span><a href="acl.c.html#LN916"><span class='Ref_To_Local'>new_acl</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN913"><span class='Ref_to_Parameter'>old_acl</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/acl.h.html#LN103"><span class='Ref_to_Macro'>ACL_SIZE</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN913"><span class='Ref_to_Parameter'>old_acl</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN923"><span class='Ref_To_Local'>dst</span></a> <span class='Operator'>== </span><a href="acl.c.html#LN924"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* need to append a new item */ 
</span>        <a href="acl.c.html#LN916"><span class='Ref_To_Local'>new_acl</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN81"><span class='Ref_to_Proto'>allocacl</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN924"><span class='Ref_To_Local'>num</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="acl.c.html#LN918"><span class='Ref_To_Local'>new_aip</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN101"><span class='Ref_to_Macro'>ACL_DAT</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN916"><span class='Ref_To_Local'>new_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><a href="acl.c.html#LN918"><span class='Ref_To_Local'>new_aip</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN917"><span class='Ref_To_Local'>old_aip</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN924"><span class='Ref_To_Local'>num</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* initialize the new entry with no permissions */ 
</span>        <a href="acl.c.html#LN918"><span class='Ref_To_Local'>new_aip</span></a><span class='Delimiter'>[</span><a href="acl.c.html#LN923"><span class='Ref_To_Local'>dst</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/utils/acl.h.html#LN48"><span class='Ref_to_Member'>ai_grantee</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN913"><span class='Ref_to_Parameter'>mod_aip</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN48"><span class='Ref_to_Member'>ai_grantee</span></a><span class='Delimiter'>; 
</span>        <a href="acl.c.html#LN918"><span class='Ref_To_Local'>new_aip</span></a><span class='Delimiter'>[</span><a href="acl.c.html#LN923"><span class='Ref_To_Local'>dst</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/utils/acl.h.html#LN49"><span class='Ref_to_Member'>ai_grantor</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN913"><span class='Ref_to_Parameter'>mod_aip</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN49"><span class='Ref_to_Member'>ai_grantor</span></a><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/acl.h.html#LN74"><span class='Ref_to_Macro'>ACLITEM_SET_PRIVS_GOPTIONS</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN918"><span class='Ref_To_Local'>new_aip</span></a><span class='Delimiter'>[</span><a href="acl.c.html#LN923"><span class='Ref_To_Local'>dst</span></a><span class='Delimiter'>], 
</span>                                   <a href="../../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="acl.c.html#LN924"><span class='Ref_To_Local'>num</span></a><span class='Operator'>++</span><span class='Delimiter'>;</span>                  <span class='Comment_Single_Line'>/* set num to the size of new_acl */ 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="acl.c.html#LN919"><span class='Ref_To_Local'>old_rights</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN60"><span class='Ref_to_Macro'>ACLITEM_GET_RIGHTS</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN918"><span class='Ref_To_Local'>new_aip</span></a><span class='Delimiter'>[</span><a href="acl.c.html#LN923"><span class='Ref_To_Local'>dst</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN920"><span class='Ref_To_Local'>old_goptions</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN59"><span class='Ref_to_Macro'>ACLITEM_GET_GOPTIONS</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN918"><span class='Ref_To_Local'>new_aip</span></a><span class='Delimiter'>[</span><a href="acl.c.html#LN923"><span class='Ref_To_Local'>dst</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* apply the specified permissions change */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN914"><span class='Ref_to_Parameter'>modechg</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/acl.h.html#LN121"><span class='Ref_to_Const'>ACL_MODECHG_ADD</span></a><span class='Operator'>: 
</span>            <a href="../../../include/utils/acl.h.html#LN71"><span class='Ref_to_Macro'>ACLITEM_SET_RIGHTS</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN918"><span class='Ref_To_Local'>new_aip</span></a><span class='Delimiter'>[</span><a href="acl.c.html#LN923"><span class='Ref_To_Local'>dst</span></a><span class='Delimiter'>], 
</span>                               <a href="acl.c.html#LN919"><span class='Ref_To_Local'>old_rights</span></a> <span class='Operator'>| </span><a href="../../../include/utils/acl.h.html#LN60"><span class='Ref_to_Macro'>ACLITEM_GET_RIGHTS</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN913"><span class='Ref_to_Parameter'>mod_aip</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/acl.h.html#LN122"><span class='Ref_to_Const'>ACL_MODECHG_DEL</span></a><span class='Operator'>: 
</span>            <a href="../../../include/utils/acl.h.html#LN71"><span class='Ref_to_Macro'>ACLITEM_SET_RIGHTS</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN918"><span class='Ref_To_Local'>new_aip</span></a><span class='Delimiter'>[</span><a href="acl.c.html#LN923"><span class='Ref_To_Local'>dst</span></a><span class='Delimiter'>], 
</span>                               <a href="acl.c.html#LN919"><span class='Ref_To_Local'>old_rights</span></a> <span class='Operator'>& </span>~ACLITEM_GET_RIGHTS<span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN913"><span class='Ref_to_Parameter'>mod_aip</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/acl.h.html#LN123"><span class='Ref_to_Const'>ACL_MODECHG_EQL</span></a><span class='Operator'>: 
</span>            <a href="../../../include/utils/acl.h.html#LN71"><span class='Ref_to_Macro'>ACLITEM_SET_RIGHTS</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN918"><span class='Ref_To_Local'>new_aip</span></a><span class='Delimiter'>[</span><a href="acl.c.html#LN923"><span class='Ref_To_Local'>dst</span></a><span class='Delimiter'>], 
</span>                               <a href="../../../include/utils/acl.h.html#LN60"><span class='Ref_to_Macro'>ACLITEM_GET_RIGHTS</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN913"><span class='Ref_to_Parameter'>mod_aip</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="acl.c.html#LN921"><span class='Ref_To_Local'>new_rights</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN60"><span class='Ref_to_Macro'>ACLITEM_GET_RIGHTS</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN918"><span class='Ref_To_Local'>new_aip</span></a><span class='Delimiter'>[</span><a href="acl.c.html#LN923"><span class='Ref_To_Local'>dst</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN922"><span class='Ref_To_Local'>new_goptions</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN59"><span class='Ref_to_Macro'>ACLITEM_GET_GOPTIONS</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN918"><span class='Ref_To_Local'>new_aip</span></a><span class='Delimiter'>[</span><a href="acl.c.html#LN923"><span class='Ref_To_Local'>dst</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the adjusted entry has no permissions, delete it from the list. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN921"><span class='Ref_To_Local'>new_rights</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/c.h.html#LN1057"><span class='Ref_to_Macro'>memmove</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN918"><span class='Ref_To_Local'>new_aip</span></a> <span class='Operator'>+ </span><a href="acl.c.html#LN923"><span class='Ref_To_Local'>dst</span></a><span class='Delimiter'>, 
</span>                <a href="acl.c.html#LN918"><span class='Ref_To_Local'>new_aip</span></a> <span class='Operator'>+ </span><a href="acl.c.html#LN923"><span class='Ref_To_Local'>dst</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="acl.c.html#LN924"><span class='Ref_To_Local'>num</span></a> <span class='Operator'>- </span><a href="acl.c.html#LN923"><span class='Ref_To_Local'>dst</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Adjust array size to be 'num - 1' items */ 
</span>        <a href="../../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN916"><span class='Ref_To_Local'>new_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="acl.c.html#LN924"><span class='Ref_To_Local'>num</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="../../../include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN916"><span class='Ref_To_Local'>new_acl</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/acl.h.html#LN102"><span class='Ref_to_Macro'>ACL_N_SIZE</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN924"><span class='Ref_To_Local'>num</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Remove abandoned privileges (cascading revoke).  Currently we can only 
     * handle this when the grantee is not PUBLIC. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="acl.c.html#LN920"><span class='Ref_To_Local'>old_goptions</span></a> <span class='Operator'>& ~</span><a href="acl.c.html#LN922"><span class='Ref_To_Local'>new_goptions</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="acl.c.html#LN913"><span class='Ref_to_Parameter'>mod_aip</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN48"><span class='Ref_to_Member'>ai_grantee</span></a> <span class='Operator'>!= </span><a href="../../../include/utils/acl.h.html#LN38"><span class='Ref_to_Const'>ACL_ID_PUBLIC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="acl.c.html#LN916"><span class='Ref_To_Local'>new_acl</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN88"><span class='Ref_to_Proto'>recursive_revoke</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN916"><span class='Ref_To_Local'>new_acl</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN913"><span class='Ref_to_Parameter'>mod_aip</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN48"><span class='Ref_to_Member'>ai_grantee</span></a><span class='Delimiter'>, 
</span>                                   <span class='Parentheses'>(</span><a href="acl.c.html#LN920"><span class='Ref_To_Local'>old_goptions</span></a> <span class='Operator'>& ~</span><a href="acl.c.html#LN922"><span class='Ref_To_Local'>new_goptions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                   <a href="acl.c.html#LN914"><span class='Ref_to_Parameter'>ownerId</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN914"><span class='Ref_to_Parameter'>behavior</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="acl.c.html#LN916"><span class='Ref_To_Local'>new_acl</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end aclupdate &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Update an ACL array to reflect a change of owner to the parent object 
 * 
 *  old_acl: the input ACL array (must not be NULL) 
 *  oldOwnerId: Oid of the old object owner 
 *  newOwnerId: Oid of the new object owner 
 * 
 * The result is a modified copy; the input object is not changed. 
 * 
 * NB: caller is responsible for having detoasted the input ACL, if needed. 
 */ 
</span><a href="../../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a> <span class='Operator'>* 
</span><a name="LN1034"></a><span class='Declare_Function'>aclnewowner</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>old_acl</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>oldOwnerId</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>newOwnerId</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1036"></a>    <a href="../../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>new_acl</span><span class='Delimiter'>; 
</span><a name="LN1037"></a>    <a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>new_aip</span><span class='Delimiter'>; 
</span><a name="LN1038"></a>    <a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>old_aip</span><span class='Delimiter'>; 
</span><a name="LN1039"></a>    <a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>dst_aip</span><span class='Delimiter'>; 
</span><a name="LN1040"></a>    <a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>src_aip</span><span class='Delimiter'>; 
</span><a name="LN1041"></a>    <a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>targ_aip</span><span class='Delimiter'>; 
</span><a name="LN1042"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>newpresent</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN1043"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>dst</span><span class='Delimiter'>, 
</span><a name="LN1044"></a>                <span class='Declare_Local'>src</span><span class='Delimiter'>, 
</span><a name="LN1045"></a>                <span class='Declare_Local'>targ</span><span class='Delimiter'>, 
</span><a name="LN1046"></a>                <span class='Declare_Local'>num</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN82"><span class='Ref_to_Proto'>check_acl</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1034"><span class='Ref_to_Parameter'>old_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Make a copy of the given ACL, substituting new owner ID for old 
     * wherever it appears as either grantor or grantee.  Also note if the new 
     * owner ID is already present. 
     */ 
</span>    <a href="acl.c.html#LN1046"><span class='Ref_To_Local'>num</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN100"><span class='Ref_to_Macro'>ACL_NUM</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1034"><span class='Ref_to_Parameter'>old_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN1038"><span class='Ref_To_Local'>old_aip</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN101"><span class='Ref_to_Macro'>ACL_DAT</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1034"><span class='Ref_to_Parameter'>old_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN1036"><span class='Ref_To_Local'>new_acl</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN81"><span class='Ref_to_Proto'>allocacl</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1046"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN1037"><span class='Ref_To_Local'>new_aip</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN101"><span class='Ref_to_Macro'>ACL_DAT</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1036"><span class='Ref_To_Local'>new_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="acl.c.html#LN1037"><span class='Ref_To_Local'>new_aip</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN1038"><span class='Ref_To_Local'>old_aip</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN1046"><span class='Ref_To_Local'>num</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN1043"><span class='Ref_To_Local'>dst</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="acl.c.html#LN1039"><span class='Ref_To_Local'>dst_aip</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN1037"><span class='Ref_To_Local'>new_aip</span></a><span class='Delimiter'>; </span><a href="acl.c.html#LN1043"><span class='Ref_To_Local'>dst</span></a> <span class='Operator'>&LT; </span><a href="acl.c.html#LN1046"><span class='Ref_To_Local'>num</span></a><span class='Delimiter'>; </span><a href="acl.c.html#LN1043"><span class='Ref_To_Local'>dst</span></a><span class='Operator'>++</span><span class='Delimiter'>, </span><a href="acl.c.html#LN1039"><span class='Ref_To_Local'>dst_aip</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN1039"><span class='Ref_To_Local'>dst_aip</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN49"><span class='Ref_to_Member'>ai_grantor</span></a> <span class='Operator'>== </span><a href="acl.c.html#LN1034"><span class='Ref_to_Parameter'>oldOwnerId</span></a><span class='Parentheses'>) 
</span>            <a href="acl.c.html#LN1039"><span class='Ref_To_Local'>dst_aip</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN49"><span class='Ref_to_Member'>ai_grantor</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN1034"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN1039"><span class='Ref_To_Local'>dst_aip</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN49"><span class='Ref_to_Member'>ai_grantor</span></a> <span class='Operator'>== </span><a href="acl.c.html#LN1034"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Parentheses'>) 
</span>            <a href="acl.c.html#LN1042"><span class='Ref_To_Local'>newpresent</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN1039"><span class='Ref_To_Local'>dst_aip</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN48"><span class='Ref_to_Member'>ai_grantee</span></a> <span class='Operator'>== </span><a href="acl.c.html#LN1034"><span class='Ref_to_Parameter'>oldOwnerId</span></a><span class='Parentheses'>) 
</span>            <a href="acl.c.html#LN1039"><span class='Ref_To_Local'>dst_aip</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN48"><span class='Ref_to_Member'>ai_grantee</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN1034"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN1039"><span class='Ref_To_Local'>dst_aip</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN48"><span class='Ref_to_Member'>ai_grantee</span></a> <span class='Operator'>== </span><a href="acl.c.html#LN1034"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Parentheses'>) 
</span>            <a href="acl.c.html#LN1042"><span class='Ref_To_Local'>newpresent</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the old ACL contained any references to the new owner, then we may 
     * now have generated an ACL containing duplicate entries.  Find them and 
     * merge them so that there are not duplicates.  (This is relatively 
     * expensive since we use a stupid O(N^2) algorithm, but it's unlikely to 
     * be the normal case.) 
     * 
     * To simplify deletion of duplicate entries, we temporarily leave them in 
     * the array but set their privilege masks to zero; when we reach such an 
     * entry it's just skipped.  (Thus, a side effect of this code will be to 
     * remove privilege-free entries, should there be any in the input.)  dst 
     * is the next output slot, targ is the currently considered input slot 
     * (always &GT;= dst), and src scans entries to the right of targ looking for 
     * duplicates.  Once an entry has been emitted to dst it is known 
     * duplicate-free and need not be considered anymore. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN1042"><span class='Ref_To_Local'>newpresent</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="acl.c.html#LN1043"><span class='Ref_To_Local'>dst</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN1045"><span class='Ref_To_Local'>targ</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="acl.c.html#LN1041"><span class='Ref_To_Local'>targ_aip</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN1037"><span class='Ref_To_Local'>new_aip</span></a><span class='Delimiter'>; </span><a href="acl.c.html#LN1045"><span class='Ref_To_Local'>targ</span></a> <span class='Operator'>&LT; </span><a href="acl.c.html#LN1046"><span class='Ref_To_Local'>num</span></a><span class='Delimiter'>; </span><a href="acl.c.html#LN1045"><span class='Ref_To_Local'>targ</span></a><span class='Operator'>++</span><span class='Delimiter'>, </span><a href="acl.c.html#LN1041"><span class='Ref_To_Local'>targ_aip</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* ignore if deleted in an earlier pass */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/acl.h.html#LN60"><span class='Ref_to_Macro'>ACLITEM_GET_RIGHTS</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN1041"><span class='Ref_To_Local'>targ_aip</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Parentheses'>)</span> 
                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* find and merge any duplicates */ 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN1044"><span class='Ref_To_Local'>src</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN1045"><span class='Ref_To_Local'>targ</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="acl.c.html#LN1040"><span class='Ref_To_Local'>src_aip</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN1041"><span class='Ref_To_Local'>targ_aip</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="acl.c.html#LN1044"><span class='Ref_To_Local'>src</span></a> <span class='Operator'>&LT; </span><a href="acl.c.html#LN1046"><span class='Ref_To_Local'>num</span></a><span class='Delimiter'>; 
</span>                 <a href="acl.c.html#LN1044"><span class='Ref_To_Local'>src</span></a><span class='Operator'>++</span><span class='Delimiter'>, </span><a href="acl.c.html#LN1040"><span class='Ref_To_Local'>src_aip</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/acl.h.html#LN60"><span class='Ref_to_Macro'>ACLITEM_GET_RIGHTS</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN1040"><span class='Ref_To_Local'>src_aip</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Parentheses'>)</span> 
                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN84"><span class='Ref_to_Proto'>aclitem_match</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1041"><span class='Ref_To_Local'>targ_aip</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN1040"><span class='Ref_To_Local'>src_aip</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="../../../include/utils/acl.h.html#LN71"><span class='Ref_to_Macro'>ACLITEM_SET_RIGHTS</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN1041"><span class='Ref_To_Local'>targ_aip</span></a><span class='Delimiter'>, 
</span>                                       <a href="../../../include/utils/acl.h.html#LN60"><span class='Ref_to_Macro'>ACLITEM_GET_RIGHTS</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN1041"><span class='Ref_To_Local'>targ_aip</span></a><span class='Parentheses'>) </span><span class='Operator'>| 
</span>                                       <a href="../../../include/utils/acl.h.html#LN60"><span class='Ref_to_Macro'>ACLITEM_GET_RIGHTS</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN1040"><span class='Ref_To_Local'>src_aip</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <span class='Comment_Multi_Line'>/* mark the duplicate deleted */ 
</span>                    <a href="../../../include/utils/acl.h.html#LN71"><span class='Ref_to_Macro'>ACLITEM_SET_RIGHTS</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN1040"><span class='Ref_To_Local'>src_aip</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>            <span class='Comment_Multi_Line'>/* and emit to output */ 
</span>            <a href="acl.c.html#LN1037"><span class='Ref_To_Local'>new_aip</span></a><span class='Delimiter'>[</span><a href="acl.c.html#LN1043"><span class='Ref_To_Local'>dst</span></a><span class='Delimiter'>] </span><span class='Operator'>= *</span><a href="acl.c.html#LN1041"><span class='Ref_To_Local'>targ_aip</span></a><span class='Delimiter'>; 
</span>            <a href="acl.c.html#LN1043"><span class='Ref_To_Local'>dst</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for targ=0,targ_aip=new_a... &raquo; </span> 
        <span class='Comment_Multi_Line'>/* Adjust array size to be 'dst' items */ 
</span>        <a href="../../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1036"><span class='Ref_To_Local'>new_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="acl.c.html#LN1043"><span class='Ref_To_Local'>dst</span></a><span class='Delimiter'>; 
</span>        <a href="../../../include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1036"><span class='Ref_To_Local'>new_acl</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/acl.h.html#LN102"><span class='Ref_to_Macro'>ACL_N_SIZE</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1043"><span class='Ref_To_Local'>dst</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if newpresent &raquo; </span> 
 
    <span class='Control'>return</span> <a href="acl.c.html#LN1036"><span class='Ref_To_Local'>new_acl</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end aclnewowner &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * When granting grant options, we must disallow attempts to set up circular 
 * chains of grant options.  Suppose A (the object owner) grants B some 
 * privileges with grant option, and B re-grants them to C.  If C could 
 * grant the privileges to B as well, then A would be unable to effectively 
 * revoke the privileges from B, since recursive_revoke would consider that 
 * B still has 'em from C. 
 * 
 * We check for this by recursively deleting all grant options belonging to 
 * the target grantee, and then seeing if the would-be grantor still has the 
 * grant option or not. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1137"></a><span class='Declare_Function'>check_circularity</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>old_acl</span><span class='Delimiter'>, </span><span class='Keyword'>const </span><a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>mod_aip</span><span class='Delimiter'>, 
</span><a name="LN1138"></a>                  <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>ownerId</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1140"></a>    <a href="../../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>acl</span><span class='Delimiter'>; 
</span><a name="LN1141"></a>    <a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>aip</span><span class='Delimiter'>; 
</span><a name="LN1142"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN1143"></a>                <span class='Declare_Local'>num</span><span class='Delimiter'>; 
</span><a name="LN1144"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>own_privs</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN82"><span class='Ref_to_Proto'>check_acl</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1137"><span class='Ref_to_Parameter'>old_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * For now, grant options can only be granted to roles, not PUBLIC. 
     * Otherwise we'd have to work a bit harder here. 
     */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="acl.c.html#LN1137"><span class='Ref_to_Parameter'>mod_aip</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN48"><span class='Ref_to_Member'>ai_grantee</span></a> <span class='Operator'>!= </span><a href="../../../include/utils/acl.h.html#LN38"><span class='Ref_to_Const'>ACL_ID_PUBLIC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* The owner always has grant options, no need to check */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN1137"><span class='Ref_to_Parameter'>mod_aip</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN49"><span class='Ref_to_Member'>ai_grantor</span></a> <span class='Operator'>== </span><a href="acl.c.html#LN1138"><span class='Ref_to_Parameter'>ownerId</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Make a working copy */ 
</span>    <a href="acl.c.html#LN1140"><span class='Ref_To_Local'>acl</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN81"><span class='Ref_to_Proto'>allocacl</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/acl.h.html#LN100"><span class='Ref_to_Macro'>ACL_NUM</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1137"><span class='Ref_to_Parameter'>old_acl</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="acl.c.html#LN1140"><span class='Ref_To_Local'>acl</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN1137"><span class='Ref_to_Parameter'>old_acl</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/acl.h.html#LN103"><span class='Ref_to_Macro'>ACL_SIZE</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1137"><span class='Ref_to_Parameter'>old_acl</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Zap all grant options of target grantee, plus what depends on 'em */ 
</span><a name="LN1163"></a><span class='Label'>cc_restart</span><span class='Operator'>: 
</span>    <a href="acl.c.html#LN1143"><span class='Ref_To_Local'>num</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN100"><span class='Ref_to_Macro'>ACL_NUM</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1140"><span class='Ref_To_Local'>acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN1141"><span class='Ref_To_Local'>aip</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN101"><span class='Ref_to_Macro'>ACL_DAT</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1140"><span class='Ref_To_Local'>acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN1142"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="acl.c.html#LN1142"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="acl.c.html#LN1143"><span class='Ref_To_Local'>num</span></a><span class='Delimiter'>; </span><a href="acl.c.html#LN1142"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN1141"><span class='Ref_To_Local'>aip</span></a><span class='Delimiter'>[</span><a href="acl.c.html#LN1142"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/utils/acl.h.html#LN48"><span class='Ref_to_Member'>ai_grantee</span></a> <span class='Operator'>== </span><a href="acl.c.html#LN1137"><span class='Ref_to_Parameter'>mod_aip</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN48"><span class='Ref_to_Member'>ai_grantee</span></a> <span class='Operator'>&& 
</span>            <a href="../../../include/utils/acl.h.html#LN59"><span class='Ref_to_Macro'>ACLITEM_GET_GOPTIONS</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1141"><span class='Ref_To_Local'>aip</span></a><span class='Delimiter'>[</span><a href="acl.c.html#LN1142"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><a name="LN1171"></a>            <a href="../../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>new_acl</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* We'll actually zap ordinary privs too, but no matter */ 
</span>            <a href="acl.c.html#LN1171"><span class='Ref_To_Local'>new_acl</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN215"><span class='Ref_to_Proto'>aclupdate</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1140"><span class='Ref_To_Local'>acl</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="acl.c.html#LN1141"><span class='Ref_To_Local'>aip</span></a><span class='Delimiter'>[</span><a href="acl.c.html#LN1142"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="../../../include/utils/acl.h.html#LN122"><span class='Ref_to_Const'>ACL_MODECHG_DEL</span></a><span class='Delimiter'>, 
</span>                                <a href="acl.c.html#LN1138"><span class='Ref_to_Parameter'>ownerId</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN1655"><span class='Ref_to_EnumConst'>DROP_CASCADE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1140"><span class='Ref_To_Local'>acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="acl.c.html#LN1140"><span class='Ref_To_Local'>acl</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN1171"><span class='Ref_To_Local'>new_acl</span></a><span class='Delimiter'>; 
</span> 
            <span class='Control'>goto</span> <span class='Symbol_Characters'>&uarr;</span><a href="acl.c.html#LN1163"><span class='Ref_to_Label'>cc_restart</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Now we can compute grantor's independently-derived privileges */ 
</span>    <a href="acl.c.html#LN1144"><span class='Ref_To_Local'>own_privs</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN225"><span class='Ref_to_Proto'>aclmask</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1140"><span class='Ref_To_Local'>acl</span></a><span class='Delimiter'>, 
</span>                        <a href="acl.c.html#LN1137"><span class='Ref_to_Parameter'>mod_aip</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN49"><span class='Ref_to_Member'>ai_grantor</span></a><span class='Delimiter'>, 
</span>                        <a href="acl.c.html#LN1138"><span class='Ref_to_Parameter'>ownerId</span></a><span class='Delimiter'>, 
</span>                        <a href="../../../include/utils/acl.h.html#LN62"><span class='Ref_to_Macro'>ACL_GRANT_OPTION_FOR</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/acl.h.html#LN59"><span class='Ref_to_Macro'>ACLITEM_GET_GOPTIONS</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN1137"><span class='Ref_to_Parameter'>mod_aip</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                        <a href="../../../include/utils/acl.h.html#LN164"><span class='Ref_to_EnumConst'>ACLMASK_ALL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN1144"><span class='Ref_To_Local'>own_privs</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN63"><span class='Ref_to_Macro'>ACL_OPTION_TO_PRIVS</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1144"><span class='Ref_To_Local'>own_privs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="../../../include/utils/acl.h.html#LN59"><span class='Ref_to_Macro'>ACLITEM_GET_GOPTIONS</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN1137"><span class='Ref_to_Parameter'>mod_aip</span></a><span class='Parentheses'>) </span><span class='Operator'>& ~</span><a href="acl.c.html#LN1144"><span class='Ref_To_Local'>own_privs</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_GRANT_OPERATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"grant options cannot be granted back to your own grantor"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1140"><span class='Ref_To_Local'>acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end check_circularity &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Ensure that no privilege is "abandoned".  A privilege is abandoned 
 * if the user that granted the privilege loses the grant option.  (So 
 * the chain through which it was granted is broken.)  Either the 
 * abandoned privileges are revoked as well, or an error message is 
 * printed, depending on the drop behavior option. 
 * 
 *  acl: the input ACL list 
 *  grantee: the user from whom some grant options have been revoked 
 *  revoke_privs: the grant options being revoked 
 *  ownerId: Oid of object owner 
 *  behavior: RESTRICT or CASCADE behavior for recursive removal 
 * 
 * The input Acl object is pfree'd if replaced. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a> <span class='Operator'>* 
</span><a name="LN1217"></a><span class='Declare_Function'>recursive_revoke</span><span class='Parentheses'>(</span><a href="../../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>acl</span><span class='Delimiter'>, 
</span><a name="LN1218"></a>                 <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>grantee</span><span class='Delimiter'>, 
</span><a name="LN1219"></a>                 <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Parameter'>revoke_privs</span><span class='Delimiter'>, 
</span><a name="LN1220"></a>                 <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>ownerId</span><span class='Delimiter'>, 
</span><a name="LN1221"></a>                 <a href="../../../include/nodes/parsenodes.h.html#LN1652"><span class='Ref_to_Enum'>DropBehavior</span></a> <span class='Declare_Parameter'>behavior</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1223"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>still_has</span><span class='Delimiter'>; 
</span><a name="LN1224"></a>    <a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>aip</span><span class='Delimiter'>; 
</span><a name="LN1225"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN1226"></a>                <span class='Declare_Local'>num</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN82"><span class='Ref_to_Proto'>check_acl</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1217"><span class='Ref_to_Parameter'>acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* The owner can never truly lose grant options, so short-circuit */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN1218"><span class='Ref_to_Parameter'>grantee</span></a> <span class='Operator'>== </span><a href="acl.c.html#LN1220"><span class='Ref_to_Parameter'>ownerId</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="acl.c.html#LN1217"><span class='Ref_to_Parameter'>acl</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* The grantee might still have some grant options via another grantor */ 
</span>    <a href="acl.c.html#LN1223"><span class='Ref_To_Local'>still_has</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN225"><span class='Ref_to_Proto'>aclmask</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1217"><span class='Ref_to_Parameter'>acl</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN1218"><span class='Ref_to_Parameter'>grantee</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN1220"><span class='Ref_to_Parameter'>ownerId</span></a><span class='Delimiter'>, 
</span>                        <a href="../../../include/utils/acl.h.html#LN62"><span class='Ref_to_Macro'>ACL_GRANT_OPTION_FOR</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1219"><span class='Ref_to_Parameter'>revoke_privs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="../../../include/utils/acl.h.html#LN164"><span class='Ref_to_EnumConst'>ACLMASK_ALL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN1219"><span class='Ref_to_Parameter'>revoke_privs</span></a> <span class='Operator'>&= </span>~ACL_OPTION_TO_PRIVS<span class='Parentheses'>(</span><a href="acl.c.html#LN1223"><span class='Ref_To_Local'>still_has</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN1219"><span class='Ref_to_Parameter'>revoke_privs</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="acl.c.html#LN1217"><span class='Ref_to_Parameter'>acl</span></a><span class='Delimiter'>; 
</span> 
<a name="LN1242"></a><span class='Label'>restart</span><span class='Operator'>: 
</span>    <a href="acl.c.html#LN1226"><span class='Ref_To_Local'>num</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN100"><span class='Ref_to_Macro'>ACL_NUM</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1217"><span class='Ref_to_Parameter'>acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN1224"><span class='Ref_To_Local'>aip</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN101"><span class='Ref_to_Macro'>ACL_DAT</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1217"><span class='Ref_to_Parameter'>acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN1225"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="acl.c.html#LN1225"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="acl.c.html#LN1226"><span class='Ref_To_Local'>num</span></a><span class='Delimiter'>; </span><a href="acl.c.html#LN1225"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN1224"><span class='Ref_To_Local'>aip</span></a><span class='Delimiter'>[</span><a href="acl.c.html#LN1225"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/utils/acl.h.html#LN49"><span class='Ref_to_Member'>ai_grantor</span></a> <span class='Operator'>== </span><a href="acl.c.html#LN1218"><span class='Ref_to_Parameter'>grantee</span></a> 
            <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="../../../include/utils/acl.h.html#LN58"><span class='Ref_to_Macro'>ACLITEM_GET_PRIVS</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1224"><span class='Ref_To_Local'>aip</span></a><span class='Delimiter'>[</span><a href="acl.c.html#LN1225"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) </span><span class='Operator'>& </span><a href="acl.c.html#LN1219"><span class='Ref_to_Parameter'>revoke_privs</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><a name="LN1250"></a>            <a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a>     <span class='Declare_Local'>mod_acl</span><span class='Delimiter'>; 
</span><a name="LN1251"></a>            <a href="../../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>new_acl</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN1221"><span class='Ref_to_Parameter'>behavior</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/parsenodes.h.html#LN1654"><span class='Ref_to_EnumConst'>DROP_RESTRICT</span></a><span class='Parentheses'>) 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DEPENDENT_OBJECTS_STILL_EXIST<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"dependent privileges exist"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Use CASCADE to revoke them too."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <a href="acl.c.html#LN1250"><span class='Ref_To_Local'>mod_acl</span></a><span class='Operator'>.</span><a href="../../../include/utils/acl.h.html#LN49"><span class='Ref_to_Member'>ai_grantor</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN1218"><span class='Ref_to_Parameter'>grantee</span></a><span class='Delimiter'>; 
</span>            <a href="acl.c.html#LN1250"><span class='Ref_To_Local'>mod_acl</span></a><span class='Operator'>.</span><a href="../../../include/utils/acl.h.html#LN48"><span class='Ref_to_Member'>ai_grantee</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN1224"><span class='Ref_To_Local'>aip</span></a><span class='Delimiter'>[</span><a href="acl.c.html#LN1225"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/utils/acl.h.html#LN48"><span class='Ref_to_Member'>ai_grantee</span></a><span class='Delimiter'>; 
</span>            <a href="../../../include/utils/acl.h.html#LN74"><span class='Ref_to_Macro'>ACLITEM_SET_PRIVS_GOPTIONS</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1250"><span class='Ref_To_Local'>mod_acl</span></a><span class='Delimiter'>, 
</span>                                       <a href="acl.c.html#LN1219"><span class='Ref_to_Parameter'>revoke_privs</span></a><span class='Delimiter'>, 
</span>                                       <a href="acl.c.html#LN1219"><span class='Ref_to_Parameter'>revoke_privs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="acl.c.html#LN1251"><span class='Ref_To_Local'>new_acl</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN215"><span class='Ref_to_Proto'>aclupdate</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1217"><span class='Ref_to_Parameter'>acl</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="acl.c.html#LN1250"><span class='Ref_To_Local'>mod_acl</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/acl.h.html#LN122"><span class='Ref_to_Const'>ACL_MODECHG_DEL</span></a><span class='Delimiter'>, 
</span>                                <a href="acl.c.html#LN1220"><span class='Ref_to_Parameter'>ownerId</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN1221"><span class='Ref_to_Parameter'>behavior</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1217"><span class='Ref_to_Parameter'>acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="acl.c.html#LN1217"><span class='Ref_to_Parameter'>acl</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN1251"><span class='Ref_To_Local'>new_acl</span></a><span class='Delimiter'>; 
</span> 
            <span class='Control'>goto</span> <span class='Symbol_Characters'>&uarr;</span><a href="acl.c.html#LN1242"><span class='Ref_to_Label'>restart</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if aip[i].ai_grantor==gr... &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;num;i++ &raquo; </span> 
 
    <span class='Control'>return</span> <a href="acl.c.html#LN1217"><span class='Ref_to_Parameter'>acl</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end recursive_revoke &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * aclmask --- compute bitmask of all privileges held by roleid. 
 * 
 * When 'how' = ACLMASK_ALL, this simply returns the privilege bits 
 * held by the given roleid according to the given ACL list, ANDed 
 * with 'mask'.  (The point of passing 'mask' is to let the routine 
 * exit early if all privileges of interest have been found.) 
 * 
 * When 'how' = ACLMASK_ANY, returns as soon as any bit in the mask 
 * is known true.  (This lets us exit soonest in cases where the 
 * caller is only going to test for zero or nonzero result.) 
 * 
 * Usage patterns: 
 * 
 * To see if any of a set of privileges are held: 
 *      if (aclmask(acl, roleid, ownerId, privs, ACLMASK_ANY) != 0) 
 * 
 * To see if all of a set of privileges are held: 
 *      if (aclmask(acl, roleid, ownerId, privs, ACLMASK_ALL) == privs) 
 * 
 * To determine exactly which of a set of privileges are held: 
 *      heldprivs = aclmask(acl, roleid, ownerId, privs, ACLMASK_ALL); 
 */ 
</span><a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> 
<a name="LN1303"></a><span class='Declare_Function'>aclmask</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>acl</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>ownerId</span><span class='Delimiter'>, 
</span><a name="LN1304"></a>        <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Parameter'>mask</span><span class='Delimiter'>, </span><a href="../../../include/utils/acl.h.html#LN162"><span class='Ref_to_Typedef'>AclMaskHow</span></a> <span class='Declare_Parameter'>how</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1306"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN1307"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>remaining</span><span class='Delimiter'>; 
</span><a name="LN1308"></a>    <a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>aidat</span><span class='Delimiter'>; 
</span><a name="LN1309"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN1310"></a>                <span class='Declare_Local'>num</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Null ACL should not happen, since caller should have inserted 
     * appropriate default 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN1303"><span class='Ref_to_Parameter'>acl</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"null ACL"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN82"><span class='Ref_to_Proto'>check_acl</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1303"><span class='Ref_to_Parameter'>acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Quick exit for mask == 0 */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN1304"><span class='Ref_to_Parameter'>mask</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN1306"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Owner always implicitly has all grant options */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="acl.c.html#LN1304"><span class='Ref_to_Parameter'>mask</span></a> <span class='Operator'>& </span><a href="../../../include/utils/acl.h.html#LN80"><span class='Ref_to_Const'>ACLITEM_ALL_GOPTION_BITS</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>        <a href="../../../include/utils/acl.h.html#LN229"><span class='Ref_to_Proto'>has_privs_of_role</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1303"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN1303"><span class='Ref_to_Parameter'>ownerId</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="acl.c.html#LN1306"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN1304"><span class='Ref_to_Parameter'>mask</span></a> <span class='Operator'>& </span><a href="../../../include/utils/acl.h.html#LN80"><span class='Ref_to_Const'>ACLITEM_ALL_GOPTION_BITS</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="acl.c.html#LN1304"><span class='Ref_to_Parameter'>how</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN164"><span class='Ref_to_EnumConst'>ACLMASK_ALL</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Parentheses'>(</span><a href="acl.c.html#LN1306"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>== </span><a href="acl.c.html#LN1304"><span class='Ref_to_Parameter'>mask</span></a><span class='Parentheses'>) </span><span class='Operator'>: </span><span class='Parentheses'>(</span><a href="acl.c.html#LN1306"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <a href="acl.c.html#LN1306"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="acl.c.html#LN1310"><span class='Ref_To_Local'>num</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN100"><span class='Ref_to_Macro'>ACL_NUM</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1303"><span class='Ref_to_Parameter'>acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN1308"><span class='Ref_To_Local'>aidat</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN101"><span class='Ref_to_Macro'>ACL_DAT</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1303"><span class='Ref_to_Parameter'>acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check privileges granted directly to roleid or to public 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN1309"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="acl.c.html#LN1309"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="acl.c.html#LN1310"><span class='Ref_To_Local'>num</span></a><span class='Delimiter'>; </span><a href="acl.c.html#LN1309"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1344"></a>        <a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>aidata</span> <span class='Operator'>= &</span><a href="acl.c.html#LN1308"><span class='Ref_To_Local'>aidat</span></a><span class='Delimiter'>[</span><a href="acl.c.html#LN1309"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN1344"><span class='Ref_To_Local'>aidata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN48"><span class='Ref_to_Member'>ai_grantee</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN38"><span class='Ref_to_Const'>ACL_ID_PUBLIC</span></a> <span class='Operator'>|| 
</span>            <a href="acl.c.html#LN1344"><span class='Ref_To_Local'>aidata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN48"><span class='Ref_to_Member'>ai_grantee</span></a> <span class='Operator'>== </span><a href="acl.c.html#LN1303"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="acl.c.html#LN1306"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>|= </span><a href="acl.c.html#LN1344"><span class='Ref_To_Local'>aidata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN50"><span class='Ref_to_Member'>ai_privs</span></a> <span class='Operator'>& </span><a href="acl.c.html#LN1304"><span class='Ref_to_Parameter'>mask</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="acl.c.html#LN1304"><span class='Ref_to_Parameter'>how</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN164"><span class='Ref_to_EnumConst'>ACLMASK_ALL</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Parentheses'>(</span><a href="acl.c.html#LN1306"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>== </span><a href="acl.c.html#LN1304"><span class='Ref_to_Parameter'>mask</span></a><span class='Parentheses'>) </span><span class='Operator'>: </span><span class='Parentheses'>(</span><a href="acl.c.html#LN1306"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <a href="acl.c.html#LN1306"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check privileges granted indirectly via role memberships. We do this in 
     * a separate pass to minimize expensive indirect membership tests.  In 
     * particular, it's worth testing whether a given ACL entry grants any 
     * privileges still of interest before we perform the has_privs_of_role 
     * test. 
     */ 
</span>    <a href="acl.c.html#LN1307"><span class='Ref_To_Local'>remaining</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN1304"><span class='Ref_to_Parameter'>mask</span></a> <span class='Operator'>& ~</span><a href="acl.c.html#LN1306"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN1309"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="acl.c.html#LN1309"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="acl.c.html#LN1310"><span class='Ref_To_Local'>num</span></a><span class='Delimiter'>; </span><a href="acl.c.html#LN1309"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1365"></a>        <a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>aidata</span> <span class='Operator'>= &</span><a href="acl.c.html#LN1308"><span class='Ref_To_Local'>aidat</span></a><span class='Delimiter'>[</span><a href="acl.c.html#LN1309"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN1365"><span class='Ref_To_Local'>aidata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN48"><span class='Ref_to_Member'>ai_grantee</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN38"><span class='Ref_to_Const'>ACL_ID_PUBLIC</span></a> <span class='Operator'>|| 
</span>            <a href="acl.c.html#LN1365"><span class='Ref_To_Local'>aidata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN48"><span class='Ref_to_Member'>ai_grantee</span></a> <span class='Operator'>== </span><a href="acl.c.html#LN1303"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* already checked it */ 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="acl.c.html#LN1365"><span class='Ref_To_Local'>aidata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN50"><span class='Ref_to_Member'>ai_privs</span></a> <span class='Operator'>& </span><a href="acl.c.html#LN1307"><span class='Ref_To_Local'>remaining</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>            <a href="../../../include/utils/acl.h.html#LN229"><span class='Ref_to_Proto'>has_privs_of_role</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1303"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN1365"><span class='Ref_To_Local'>aidata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN48"><span class='Ref_to_Member'>ai_grantee</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="acl.c.html#LN1306"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>|= </span><a href="acl.c.html#LN1365"><span class='Ref_To_Local'>aidata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN50"><span class='Ref_to_Member'>ai_privs</span></a> <span class='Operator'>& </span><a href="acl.c.html#LN1304"><span class='Ref_to_Parameter'>mask</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="acl.c.html#LN1304"><span class='Ref_to_Parameter'>how</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN164"><span class='Ref_to_EnumConst'>ACLMASK_ALL</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Parentheses'>(</span><a href="acl.c.html#LN1306"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>== </span><a href="acl.c.html#LN1304"><span class='Ref_to_Parameter'>mask</span></a><span class='Parentheses'>) </span><span class='Operator'>: </span><span class='Parentheses'>(</span><a href="acl.c.html#LN1306"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <a href="acl.c.html#LN1306"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span>            <a href="acl.c.html#LN1307"><span class='Ref_To_Local'>remaining</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN1304"><span class='Ref_to_Parameter'>mask</span></a> <span class='Operator'>& ~</span><a href="acl.c.html#LN1306"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="acl.c.html#LN1306"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end aclmask &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * aclmask_direct --- compute bitmask of all privileges held by roleid. 
 * 
 * This is exactly like aclmask() except that we consider only privileges 
 * held *directly* by roleid, not those inherited via role membership. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> 
<a name="LN1392"></a><span class='Declare_Function'>aclmask_direct</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>acl</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>ownerId</span><span class='Delimiter'>, 
</span><a name="LN1393"></a>               <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Parameter'>mask</span><span class='Delimiter'>, </span><a href="../../../include/utils/acl.h.html#LN162"><span class='Ref_to_Typedef'>AclMaskHow</span></a> <span class='Declare_Parameter'>how</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1395"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN1396"></a>    <a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>aidat</span><span class='Delimiter'>; 
</span><a name="LN1397"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN1398"></a>                <span class='Declare_Local'>num</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Null ACL should not happen, since caller should have inserted 
     * appropriate default 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN1392"><span class='Ref_to_Parameter'>acl</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"null ACL"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN82"><span class='Ref_to_Proto'>check_acl</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1392"><span class='Ref_to_Parameter'>acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Quick exit for mask == 0 */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN1393"><span class='Ref_to_Parameter'>mask</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN1395"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Owner always implicitly has all grant options */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="acl.c.html#LN1393"><span class='Ref_to_Parameter'>mask</span></a> <span class='Operator'>& </span><a href="../../../include/utils/acl.h.html#LN80"><span class='Ref_to_Const'>ACLITEM_ALL_GOPTION_BITS</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>        <a href="acl.c.html#LN1392"><span class='Ref_to_Parameter'>roleid</span></a> <span class='Operator'>== </span><a href="acl.c.html#LN1392"><span class='Ref_to_Parameter'>ownerId</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="acl.c.html#LN1395"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN1393"><span class='Ref_to_Parameter'>mask</span></a> <span class='Operator'>& </span><a href="../../../include/utils/acl.h.html#LN80"><span class='Ref_to_Const'>ACLITEM_ALL_GOPTION_BITS</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="acl.c.html#LN1393"><span class='Ref_to_Parameter'>how</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN164"><span class='Ref_to_EnumConst'>ACLMASK_ALL</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Parentheses'>(</span><a href="acl.c.html#LN1395"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>== </span><a href="acl.c.html#LN1393"><span class='Ref_to_Parameter'>mask</span></a><span class='Parentheses'>) </span><span class='Operator'>: </span><span class='Parentheses'>(</span><a href="acl.c.html#LN1395"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <a href="acl.c.html#LN1395"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="acl.c.html#LN1398"><span class='Ref_To_Local'>num</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN100"><span class='Ref_to_Macro'>ACL_NUM</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1392"><span class='Ref_to_Parameter'>acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN1396"><span class='Ref_To_Local'>aidat</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN101"><span class='Ref_to_Macro'>ACL_DAT</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1392"><span class='Ref_to_Parameter'>acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check privileges granted directly to roleid (and not to public) 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN1397"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="acl.c.html#LN1397"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="acl.c.html#LN1398"><span class='Ref_To_Local'>num</span></a><span class='Delimiter'>; </span><a href="acl.c.html#LN1397"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1432"></a>        <a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>aidata</span> <span class='Operator'>= &</span><a href="acl.c.html#LN1396"><span class='Ref_To_Local'>aidat</span></a><span class='Delimiter'>[</span><a href="acl.c.html#LN1397"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN1432"><span class='Ref_To_Local'>aidata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN48"><span class='Ref_to_Member'>ai_grantee</span></a> <span class='Operator'>== </span><a href="acl.c.html#LN1392"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="acl.c.html#LN1395"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>|= </span><a href="acl.c.html#LN1432"><span class='Ref_To_Local'>aidata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN50"><span class='Ref_to_Member'>ai_privs</span></a> <span class='Operator'>& </span><a href="acl.c.html#LN1393"><span class='Ref_to_Parameter'>mask</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="acl.c.html#LN1393"><span class='Ref_to_Parameter'>how</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN164"><span class='Ref_to_EnumConst'>ACLMASK_ALL</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Parentheses'>(</span><a href="acl.c.html#LN1395"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>== </span><a href="acl.c.html#LN1393"><span class='Ref_to_Parameter'>mask</span></a><span class='Parentheses'>) </span><span class='Operator'>: </span><span class='Parentheses'>(</span><a href="acl.c.html#LN1395"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <a href="acl.c.html#LN1395"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="acl.c.html#LN1395"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end aclmask_direct &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * aclmembers 
 *      Find out all the roleids mentioned in an Acl. 
 *      Note that we do not distinguish grantors from grantees. 
 * 
 * *roleids is set to point to a palloc'd array containing distinct OIDs 
 * in sorted order.  The length of the array is the function result. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN1455"></a><span class='Declare_Function'>aclmembers</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>acl</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>roleids</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1457"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>list</span><span class='Delimiter'>; 
</span><a name="LN1458"></a>    <span class='Keyword'>const </span><a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>acldat</span><span class='Delimiter'>; 
</span><a name="LN1459"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN1460"></a>                <span class='Declare_Local'>j</span><span class='Delimiter'>, 
</span><a name="LN1461"></a>                <span class='Declare_Local'>k</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN1455"><span class='Ref_to_Parameter'>acl</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="../../../include/utils/acl.h.html#LN100"><span class='Ref_to_Macro'>ACL_NUM</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1455"><span class='Ref_to_Parameter'>acl</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="acl.c.html#LN1455"><span class='Ref_to_Parameter'>roleids</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="acl.c.html#LN82"><span class='Ref_to_Proto'>check_acl</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1455"><span class='Ref_to_Parameter'>acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Allocate the worst-case space requirement */ 
</span>    <a href="acl.c.html#LN1457"><span class='Ref_To_Local'>list</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/acl.h.html#LN100"><span class='Ref_to_Macro'>ACL_NUM</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1455"><span class='Ref_to_Parameter'>acl</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Number'>2</span> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN1458"><span class='Ref_To_Local'>acldat</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN101"><span class='Ref_to_Macro'>ACL_DAT</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1455"><span class='Ref_to_Parameter'>acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Walk the ACL collecting mentioned RoleIds. 
     */ 
</span>    <a href="acl.c.html#LN1460"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN1459"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="acl.c.html#LN1459"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="../../../include/utils/acl.h.html#LN100"><span class='Ref_to_Macro'>ACL_NUM</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1455"><span class='Ref_to_Parameter'>acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><a href="acl.c.html#LN1459"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1481"></a>        <span class='Keyword'>const </span><a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ai</span> <span class='Operator'>= &</span><a href="acl.c.html#LN1458"><span class='Ref_To_Local'>acldat</span></a><span class='Delimiter'>[</span><a href="acl.c.html#LN1459"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN1481"><span class='Ref_To_Local'>ai</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN48"><span class='Ref_to_Member'>ai_grantee</span></a> <span class='Operator'>!= </span><a href="../../../include/utils/acl.h.html#LN38"><span class='Ref_to_Const'>ACL_ID_PUBLIC</span></a><span class='Parentheses'>) 
</span>            <a href="acl.c.html#LN1457"><span class='Ref_To_Local'>list</span></a><span class='Delimiter'>[</span><a href="acl.c.html#LN1460"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="acl.c.html#LN1481"><span class='Ref_To_Local'>ai</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN48"><span class='Ref_to_Member'>ai_grantee</span></a><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* grantor is currently never PUBLIC, but let's check anyway */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN1481"><span class='Ref_To_Local'>ai</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN49"><span class='Ref_to_Member'>ai_grantor</span></a> <span class='Operator'>!= </span><a href="../../../include/utils/acl.h.html#LN38"><span class='Ref_to_Const'>ACL_ID_PUBLIC</span></a><span class='Parentheses'>) 
</span>            <a href="acl.c.html#LN1457"><span class='Ref_To_Local'>list</span></a><span class='Delimiter'>[</span><a href="acl.c.html#LN1460"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="acl.c.html#LN1481"><span class='Ref_To_Local'>ai</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN49"><span class='Ref_to_Member'>ai_grantor</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Sort the array */ 
</span>    <a href="../../../include/port.h.html#LN439"><span class='Ref_to_Macro'>qsort</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1457"><span class='Ref_To_Local'>list</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN1460"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/utils/builtins.h.html#LN69"><span class='Ref_to_Proto'>oid_cmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Remove duplicates from the array */ 
</span>    <a href="acl.c.html#LN1461"><span class='Ref_To_Local'>k</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN1459"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="acl.c.html#LN1459"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="acl.c.html#LN1460"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>; </span><a href="acl.c.html#LN1459"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN1457"><span class='Ref_To_Local'>list</span></a><span class='Delimiter'>[</span><a href="acl.c.html#LN1461"><span class='Ref_To_Local'>k</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="acl.c.html#LN1457"><span class='Ref_To_Local'>list</span></a><span class='Delimiter'>[</span><a href="acl.c.html#LN1459"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <a href="acl.c.html#LN1457"><span class='Ref_To_Local'>list</span></a><span class='Delimiter'>[</span><span class='Operator'>++</span><a href="acl.c.html#LN1461"><span class='Ref_To_Local'>k</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="acl.c.html#LN1457"><span class='Ref_To_Local'>list</span></a><span class='Delimiter'>[</span><a href="acl.c.html#LN1459"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We could repalloc the array down to minimum size, but it's hardly worth 
     * it since it's only transient memory. 
     */ 
</span>    <span class='Operator'>*</span><a href="acl.c.html#LN1455"><span class='Ref_to_Parameter'>roleids</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN1457"><span class='Ref_To_Local'>list</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="acl.c.html#LN1461"><span class='Ref_To_Local'>k</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end aclmembers &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * aclinsert (exported function) 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1515"></a><span class='Declare_Function'>aclinsert</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>            <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"aclinsert is no longer supported"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span><span class='Delimiter'>} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1525"></a><span class='Declare_Function'>aclremove</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>            <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"aclremove is no longer supported"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span><span class='Delimiter'>} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1535"></a><span class='Declare_Function'>aclcontains</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1537"></a>    <a href="../../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>acl</span> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN114"><span class='Ref_to_Macro'>PG_GETARG_ACL_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1538"></a>    <a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>aip</span> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN109"><span class='Ref_to_Macro'>PG_GETARG_ACLITEM_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1539"></a>    <a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>aidat</span><span class='Delimiter'>; 
</span><a name="LN1540"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN1541"></a>                <span class='Declare_Local'>num</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN82"><span class='Ref_to_Proto'>check_acl</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1537"><span class='Ref_To_Local'>acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN1541"><span class='Ref_To_Local'>num</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN100"><span class='Ref_to_Macro'>ACL_NUM</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1537"><span class='Ref_To_Local'>acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN1539"><span class='Ref_To_Local'>aidat</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN101"><span class='Ref_to_Macro'>ACL_DAT</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1537"><span class='Ref_To_Local'>acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN1540"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="acl.c.html#LN1540"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="acl.c.html#LN1541"><span class='Ref_To_Local'>num</span></a><span class='Delimiter'>; </span><span class='Operator'>++</span><a href="acl.c.html#LN1540"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN1538"><span class='Ref_To_Local'>aip</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN48"><span class='Ref_to_Member'>ai_grantee</span></a> <span class='Operator'>== </span><a href="acl.c.html#LN1539"><span class='Ref_To_Local'>aidat</span></a><span class='Delimiter'>[</span><a href="acl.c.html#LN1540"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/utils/acl.h.html#LN48"><span class='Ref_to_Member'>ai_grantee</span></a> <span class='Operator'>&& 
</span>            <a href="acl.c.html#LN1538"><span class='Ref_To_Local'>aip</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN49"><span class='Ref_to_Member'>ai_grantor</span></a> <span class='Operator'>== </span><a href="acl.c.html#LN1539"><span class='Ref_To_Local'>aidat</span></a><span class='Delimiter'>[</span><a href="acl.c.html#LN1540"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/utils/acl.h.html#LN49"><span class='Ref_to_Member'>ai_grantor</span></a> <span class='Operator'>&& 
</span>            <span class='Parentheses'>(</span><a href="../../../include/utils/acl.h.html#LN60"><span class='Ref_to_Macro'>ACLITEM_GET_RIGHTS</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN1538"><span class='Ref_To_Local'>aip</span></a><span class='Parentheses'>) </span><span class='Operator'>& </span><a href="../../../include/utils/acl.h.html#LN60"><span class='Ref_to_Macro'>ACLITEM_GET_RIGHTS</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1539"><span class='Ref_To_Local'>aidat</span></a><span class='Delimiter'>[</span><a href="acl.c.html#LN1540"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN60"><span class='Ref_to_Macro'>ACLITEM_GET_RIGHTS</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN1538"><span class='Ref_To_Local'>aip</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end aclcontains &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1557"></a><span class='Declare_Function'>makeaclitem</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1559"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>grantee</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1560"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>grantor</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1561"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>privtext</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1562"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>goption</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN238"><span class='Ref_to_Macro'>PG_GETARG_BOOL</span></a><span class='Parentheses'>(</span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1563"></a>    <a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN1564"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>priv</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN1564"><span class='Ref_To_Local'>priv</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN91"><span class='Ref_to_Proto'>convert_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1561"><span class='Ref_To_Local'>privtext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN1563"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN1563"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN48"><span class='Ref_to_Member'>ai_grantee</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN1559"><span class='Ref_To_Local'>grantee</span></a><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN1563"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN49"><span class='Ref_to_Member'>ai_grantor</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN1560"><span class='Ref_To_Local'>grantor</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/acl.h.html#LN74"><span class='Ref_to_Macro'>ACLITEM_SET_PRIVS_GOPTIONS</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN1563"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN1564"><span class='Ref_To_Local'>priv</span></a><span class='Delimiter'>, 
</span>                               <span class='Parentheses'>(</span><a href="acl.c.html#LN1562"><span class='Ref_To_Local'>goption</span></a> <span class='Operator'>? </span><a href="acl.c.html#LN1564"><span class='Ref_To_Local'>priv</span></a> <span class='Operator'>: </span><a href="../../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/acl.h.html#LN110"><span class='Ref_to_Macro'>PG_RETURN_ACLITEM_P</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1563"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end makeaclitem &raquo; </span> 
 
<span class='Keyword'>static </span><a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> 
<a name="LN1580"></a><span class='Declare_Function'>convert_priv_string</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>priv_type_text</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1582"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type</span> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1580"><span class='Ref_to_Parameter'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1582"><span class='Ref_To_Local'>priv_type</span></a><span class='Delimiter'>, </span><span class='String'>"SELECT"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="../../../include/nodes/parsenodes.h.html#LN72"><span class='Ref_to_Const'>ACL_SELECT</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1582"><span class='Ref_To_Local'>priv_type</span></a><span class='Delimiter'>, </span><span class='String'>"INSERT"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="../../../include/nodes/parsenodes.h.html#LN71"><span class='Ref_to_Const'>ACL_INSERT</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1582"><span class='Ref_To_Local'>priv_type</span></a><span class='Delimiter'>, </span><span class='String'>"UPDATE"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="../../../include/nodes/parsenodes.h.html#LN73"><span class='Ref_to_Const'>ACL_UPDATE</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1582"><span class='Ref_To_Local'>priv_type</span></a><span class='Delimiter'>, </span><span class='String'>"DELETE"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="../../../include/nodes/parsenodes.h.html#LN74"><span class='Ref_to_Const'>ACL_DELETE</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1582"><span class='Ref_To_Local'>priv_type</span></a><span class='Delimiter'>, </span><span class='String'>"TRUNCATE"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="../../../include/nodes/parsenodes.h.html#LN75"><span class='Ref_to_Const'>ACL_TRUNCATE</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1582"><span class='Ref_To_Local'>priv_type</span></a><span class='Delimiter'>, </span><span class='String'>"REFERENCES"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="../../../include/nodes/parsenodes.h.html#LN76"><span class='Ref_to_Const'>ACL_REFERENCES</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1582"><span class='Ref_To_Local'>priv_type</span></a><span class='Delimiter'>, </span><span class='String'>"TRIGGER"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="../../../include/nodes/parsenodes.h.html#LN77"><span class='Ref_to_Const'>ACL_TRIGGER</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1582"><span class='Ref_To_Local'>priv_type</span></a><span class='Delimiter'>, </span><span class='String'>"EXECUTE"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="../../../include/nodes/parsenodes.h.html#LN78"><span class='Ref_to_Const'>ACL_EXECUTE</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1582"><span class='Ref_To_Local'>priv_type</span></a><span class='Delimiter'>, </span><span class='String'>"USAGE"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="../../../include/nodes/parsenodes.h.html#LN79"><span class='Ref_to_Const'>ACL_USAGE</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1582"><span class='Ref_To_Local'>priv_type</span></a><span class='Delimiter'>, </span><span class='String'>"CREATE"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="../../../include/nodes/parsenodes.h.html#LN81"><span class='Ref_to_Const'>ACL_CREATE</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1582"><span class='Ref_To_Local'>priv_type</span></a><span class='Delimiter'>, </span><span class='String'>"TEMP"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="../../../include/nodes/parsenodes.h.html#LN82"><span class='Ref_to_Const'>ACL_CREATE_TEMP</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1582"><span class='Ref_To_Local'>priv_type</span></a><span class='Delimiter'>, </span><span class='String'>"TEMPORARY"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="../../../include/nodes/parsenodes.h.html#LN82"><span class='Ref_to_Const'>ACL_CREATE_TEMP</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1582"><span class='Ref_To_Local'>priv_type</span></a><span class='Delimiter'>, </span><span class='String'>"CONNECT"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="../../../include/nodes/parsenodes.h.html#LN83"><span class='Ref_to_Const'>ACL_CONNECT</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1582"><span class='Ref_To_Local'>priv_type</span></a><span class='Delimiter'>, </span><span class='String'>"RULE"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>;</span>               <span class='Comment_Single_Line'>/* ignore old RULE privileges */ 
</span> 
    <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>            <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"unrecognized privilege type: \"%s\""</span><span class='Delimiter'>, </span><a href="acl.c.html#LN1582"><span class='Ref_To_Local'>priv_type</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="../../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end convert_priv_string &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * convert_any_priv_string: recognize privilege strings for has_foo_privilege 
 * 
 * We accept a comma-separated list of case-insensitive privilege names, 
 * producing a bitmask of the OR'd privilege bits.  We are liberal about 
 * whitespace between items, not so much about whitespace within items. 
 * The allowed privilege names are given as an array of priv_map structs, 
 * terminated by one with a NULL name pointer. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> 
<a name="LN1630"></a><span class='Declare_Function'>convert_any_priv_string</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>priv_type_text</span><span class='Delimiter'>, 
</span><a name="LN1631"></a>                        <span class='Keyword'>const </span><a href="acl.c.html#LN41"><span class='Ref_to_Typedef'>priv_map</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>privileges</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1633"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>result</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN1634"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type</span> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1630"><span class='Ref_to_Parameter'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1635"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>chunk</span><span class='Delimiter'>; 
</span><a name="LN1636"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>next_chunk</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* We rely on priv_type being a private, modifiable string */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN1635"><span class='Ref_To_Local'>chunk</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN1634"><span class='Ref_To_Local'>priv_type</span></a><span class='Delimiter'>; </span><a href="acl.c.html#LN1635"><span class='Ref_To_Local'>chunk</span></a><span class='Delimiter'>; </span><a href="acl.c.html#LN1635"><span class='Ref_To_Local'>chunk</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN1636"><span class='Ref_To_Local'>next_chunk</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1641"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>chunk_len</span><span class='Delimiter'>; 
</span><a name="LN1642"></a>        <span class='Keyword'>const </span><a href="acl.c.html#LN41"><span class='Ref_to_Typedef'>priv_map</span></a> <span class='Operator'>*</span><span class='Declare_Local'>this_priv</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Split string at commas */ 
</span>        <a href="acl.c.html#LN1636"><span class='Ref_To_Local'>next_chunk</span></a> <span class='Operator'>= </span>strchr<span class='Parentheses'>(</span><a href="acl.c.html#LN1635"><span class='Ref_To_Local'>chunk</span></a><span class='Delimiter'>, </span><span class='String'>','</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN1636"><span class='Ref_To_Local'>next_chunk</span></a><span class='Parentheses'>) 
</span>            <span class='Operator'>*</span><a href="acl.c.html#LN1636"><span class='Ref_To_Local'>next_chunk</span></a><span class='Operator'>++ = </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Drop leading/trailing whitespace in this chunk */ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN1635"><span class='Ref_To_Local'>chunk</span></a> <span class='Operator'>&& </span>isspace<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="acl.c.html#LN1635"><span class='Ref_To_Local'>chunk</span></a><span class='Parentheses'>))</span> 
            <a href="acl.c.html#LN1635"><span class='Ref_To_Local'>chunk</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="acl.c.html#LN1641"><span class='Ref_To_Local'>chunk_len</span></a> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="acl.c.html#LN1635"><span class='Ref_To_Local'>chunk</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN1641"><span class='Ref_To_Local'>chunk_len</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span>isspace<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><a href="acl.c.html#LN1635"><span class='Ref_To_Local'>chunk</span></a><span class='Delimiter'>[</span><a href="acl.c.html#LN1641"><span class='Ref_To_Local'>chunk_len</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>))</span> 
            <a href="acl.c.html#LN1641"><span class='Ref_To_Local'>chunk_len</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <a href="acl.c.html#LN1635"><span class='Ref_To_Local'>chunk</span></a><span class='Delimiter'>[</span><a href="acl.c.html#LN1641"><span class='Ref_To_Local'>chunk_len</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Match to the privileges list */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN1642"><span class='Ref_To_Local'>this_priv</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN1631"><span class='Ref_to_Parameter'>privileges</span></a><span class='Delimiter'>; </span><a href="acl.c.html#LN1642"><span class='Ref_To_Local'>this_priv</span></a><span class='Operator'>-&GT;</span><a href="acl.c.html#LN43"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>; </span><a href="acl.c.html#LN1642"><span class='Ref_To_Local'>this_priv</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1642"><span class='Ref_To_Local'>this_priv</span></a><span class='Operator'>-&GT;</span><a href="acl.c.html#LN43"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN1635"><span class='Ref_To_Local'>chunk</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <a href="acl.c.html#LN1633"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>|= </span><a href="acl.c.html#LN1642"><span class='Ref_To_Local'>this_priv</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="acl.c.html#LN1642"><span class='Ref_To_Local'>this_priv</span></a><span class='Operator'>-&GT;</span><a href="acl.c.html#LN43"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"unrecognized privilege type: \"%s\""</span><span class='Delimiter'>, </span><a href="acl.c.html#LN1635"><span class='Ref_To_Local'>chunk</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for chunk=priv_type;chunk... &raquo; </span> 
 
    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1634"><span class='Ref_To_Local'>priv_type</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="acl.c.html#LN1633"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end convert_any_priv_string &raquo; </span> 
 
 
<span class='Keyword'>static const char </span><span class='Operator'>* 
</span><a name="LN1678"></a><span class='Declare_Function'>convert_aclright_to_string</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>aclright</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN1678"><span class='Ref_to_Parameter'>aclright</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN71"><span class='Ref_to_Const'>ACL_INSERT</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"INSERT"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN72"><span class='Ref_to_Const'>ACL_SELECT</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"SELECT"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN73"><span class='Ref_to_Const'>ACL_UPDATE</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"UPDATE"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN74"><span class='Ref_to_Const'>ACL_DELETE</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"DELETE"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN75"><span class='Ref_to_Const'>ACL_TRUNCATE</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"TRUNCATE"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN76"><span class='Ref_to_Const'>ACL_REFERENCES</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"REFERENCES"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN77"><span class='Ref_to_Const'>ACL_TRIGGER</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"TRIGGER"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN78"><span class='Ref_to_Const'>ACL_EXECUTE</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"EXECUTE"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN79"><span class='Ref_to_Const'>ACL_USAGE</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"USAGE"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN81"><span class='Ref_to_Const'>ACL_CREATE</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"CREATE"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN82"><span class='Ref_to_Const'>ACL_CREATE_TEMP</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"TEMPORARY"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN83"><span class='Ref_to_Const'>ACL_CONNECT</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"CONNECT"</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized aclright: %d"</span><span class='Delimiter'>, </span><a href="acl.c.html#LN1678"><span class='Ref_to_Parameter'>aclright</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch aclright &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end convert_aclright_to_string &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/*---------- 
 * Convert an aclitem[] to a table. 
 * 
 * Example: 
 * 
 * aclexplode('{=r/joe,foo=a*w/joe}'::aclitem[]) 
 * 
 * returns the table 
 * 
 * {{ OID(joe), 0::OID,   'SELECT', false }, 
 *  { OID(joe), OID(foo), 'INSERT', true }, 
 *  { OID(joe), OID(foo), 'UPDATE', false }} 
 *---------- 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1728"></a><span class='Declare_Function'>aclexplode</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1730"></a>    <a href="../../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>acl</span> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN114"><span class='Ref_to_Macro'>PG_GETARG_ACL_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1731"></a>    <a href="../../../include/funcapi.h.html#LN56"><span class='Ref_to_Struct'>FuncCallContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>funcctx</span><span class='Delimiter'>; 
</span><a name="LN1732"></a>    <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Local'>idx</span><span class='Delimiter'>; 
</span><a name="LN1733"></a>    <a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>aidat</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/funcapi.h.html#LN284"><span class='Ref_to_Macro'>SRF_IS_FIRSTCALL</span></a><span class='Parentheses'>())</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1737"></a>        <a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupdesc</span><span class='Delimiter'>; 
</span><a name="LN1738"></a>        <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
        <a href="acl.c.html#LN82"><span class='Ref_to_Proto'>check_acl</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1730"><span class='Ref_To_Local'>acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="acl.c.html#LN1731"><span class='Ref_To_Local'>funcctx</span></a> <span class='Operator'>= </span><a href="../../../include/funcapi.h.html#LN286"><span class='Ref_to_Macro'>SRF_FIRSTCALL_INIT</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <a href="acl.c.html#LN1738"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1731"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN108"><span class='Ref_to_Member'>multi_call_memory_ctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * build tupdesc for result tuples (matches out parameters in pg_proc 
         * entry) 
         */ 
</span>        <a href="acl.c.html#LN1737"><span class='Ref_To_Local'>tupdesc</span></a> <span class='Operator'>= </span><a href="../../access/common/tupdesc.c.html#LN39"><span class='Ref_to_Func'>CreateTemplateTupleDesc</span></a><span class='Parentheses'>(</span><span class='Number'>4</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/access/tupdesc.h.html#LN114"><span class='Ref_to_Proto'>TupleDescInitEntry</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1737"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a><span class='Parentheses'>) </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='String'>"grantor"</span><span class='Delimiter'>, 
</span>                           <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN27"><span class='Ref_to_Const'>OIDOID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/access/tupdesc.h.html#LN114"><span class='Ref_to_Proto'>TupleDescInitEntry</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1737"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a><span class='Parentheses'>) </span><span class='Number'>2</span><span class='Delimiter'>, </span><span class='String'>"grantee"</span><span class='Delimiter'>, 
</span>                           <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN27"><span class='Ref_to_Const'>OIDOID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/access/tupdesc.h.html#LN114"><span class='Ref_to_Proto'>TupleDescInitEntry</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1737"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a><span class='Parentheses'>) </span><span class='Number'>3</span><span class='Delimiter'>, </span><span class='String'>"privilege_type"</span><span class='Delimiter'>, 
</span>                           <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/access/tupdesc.h.html#LN114"><span class='Ref_to_Proto'>TupleDescInitEntry</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1737"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a><span class='Parentheses'>) </span><span class='Number'>4</span><span class='Delimiter'>, </span><span class='String'>"is_grantable"</span><span class='Delimiter'>, 
</span>                           <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN17"><span class='Ref_to_Const'>BOOLOID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="acl.c.html#LN1731"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN119"><span class='Ref_to_Member'>tuple_desc</span></a> <span class='Operator'>= </span><a href="../../../include/funcapi.h.html#LN229"><span class='Ref_to_Proto'>BlessTupleDesc</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1737"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* allocate memory for user context */ 
</span>        <a href="acl.c.html#LN1732"><span class='Ref_To_Local'>idx</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="acl.c.html#LN1732"><span class='Ref_To_Local'>idx</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>             <span class='Comment_Single_Line'>/* ACL array item index */ 
</span>        <a href="acl.c.html#LN1732"><span class='Ref_To_Local'>idx</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* privilege type counter */ 
</span>        <a href="acl.c.html#LN1731"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN89"><span class='Ref_to_Member'>user_fctx</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="acl.c.html#LN1732"><span class='Ref_To_Local'>idx</span></a><span class='Delimiter'>; 
</span> 
        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1738"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if SRF_IS_FIRSTCALL() &raquo; </span> 
 
    <a href="acl.c.html#LN1731"><span class='Ref_To_Local'>funcctx</span></a> <span class='Operator'>= </span><a href="../../../include/funcapi.h.html#LN288"><span class='Ref_to_Macro'>SRF_PERCALL_SETUP</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN1732"><span class='Ref_To_Local'>idx</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="acl.c.html#LN1731"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN89"><span class='Ref_to_Member'>user_fctx</span></a><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN1733"><span class='Ref_To_Local'>aidat</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN101"><span class='Ref_to_Macro'>ACL_DAT</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1730"><span class='Ref_To_Local'>acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* need test here in case acl has no items */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN1732"><span class='Ref_To_Local'>idx</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>&LT; </span><a href="../../../include/utils/acl.h.html#LN100"><span class='Ref_to_Macro'>ACL_NUM</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1730"><span class='Ref_To_Local'>acl</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1777"></a>        <a href="../../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>aidata</span><span class='Delimiter'>; 
</span><a name="LN1778"></a>        <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>priv_bit</span><span class='Delimiter'>; 
</span> 
        <a href="acl.c.html#LN1732"><span class='Ref_To_Local'>idx</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN1732"><span class='Ref_To_Local'>idx</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>== </span><a href="../../../include/nodes/parsenodes.h.html#LN84"><span class='Ref_to_Const'>N_ACL_RIGHTS</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="acl.c.html#LN1732"><span class='Ref_To_Local'>idx</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="acl.c.html#LN1732"><span class='Ref_To_Local'>idx</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN1732"><span class='Ref_To_Local'>idx</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>&GT;= </span><a href="../../../include/utils/acl.h.html#LN100"><span class='Ref_to_Macro'>ACL_NUM</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1730"><span class='Ref_To_Local'>acl</span></a><span class='Parentheses'>))</span> <span class='Comment_Single_Line'>/* done */ 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="acl.c.html#LN1777"><span class='Ref_To_Local'>aidata</span></a> <span class='Operator'>= &</span><a href="acl.c.html#LN1733"><span class='Ref_To_Local'>aidat</span></a><span class='Delimiter'>[</span><a href="acl.c.html#LN1732"><span class='Ref_To_Local'>idx</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]]; 
</span>        <a href="acl.c.html#LN1778"><span class='Ref_To_Local'>priv_bit</span></a> <span class='Operator'>= </span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><a href="acl.c.html#LN1732"><span class='Ref_To_Local'>idx</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/acl.h.html#LN58"><span class='Ref_to_Macro'>ACLITEM_GET_PRIVS</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN1777"><span class='Ref_To_Local'>aidata</span></a><span class='Parentheses'>) </span><span class='Operator'>& </span><a href="acl.c.html#LN1778"><span class='Ref_To_Local'>priv_bit</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><a name="LN1793"></a>            <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN1794"></a>            <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><span class='Number'>4</span><span class='Delimiter'>]; 
</span><a name="LN1795"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><span class='Number'>4</span><span class='Delimiter'>]; 
</span><a name="LN1796"></a>            <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span> 
            <a href="acl.c.html#LN1794"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1777"><span class='Ref_To_Local'>aidata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN49"><span class='Ref_to_Member'>ai_grantor</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="acl.c.html#LN1794"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1777"><span class='Ref_To_Local'>aidata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/acl.h.html#LN48"><span class='Ref_to_Member'>ai_grantee</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="acl.c.html#LN1794"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1677"><span class='Ref_to_Func'>convert_aclright_to_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1778"><span class='Ref_To_Local'>priv_bit</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="acl.c.html#LN1794"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>((</span><a href="../../../include/utils/acl.h.html#LN59"><span class='Ref_to_Macro'>ACLITEM_GET_GOPTIONS</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN1777"><span class='Ref_To_Local'>aidata</span></a><span class='Parentheses'>) </span><span class='Operator'>& </span><a href="acl.c.html#LN1778"><span class='Ref_To_Local'>priv_bit</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1795"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="acl.c.html#LN1795"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <a href="acl.c.html#LN1796"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1731"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN119"><span class='Ref_to_Member'>tuple_desc</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN1794"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN1795"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="acl.c.html#LN1793"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/funcapi.h.html#LN221"><span class='Ref_to_Macro'>HeapTupleGetDatum</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1796"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../../include/funcapi.h.html#LN290"><span class='Ref_to_Macro'>SRF_RETURN_NEXT</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1731"><span class='Ref_To_Local'>funcctx</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN1793"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while idx[0]&LT;ACL_NUM(acl) &raquo; </span> 
 
    <a href="../../../include/funcapi.h.html#LN308"><span class='Ref_to_Macro'>SRF_RETURN_DONE</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1731"><span class='Ref_To_Local'>funcctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end aclexplode &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * has_table_privilege variants 
 *      These are all named "has_table_privilege" at the SQL level. 
 *      They take various combinations of relation name, relation OID, 
 *      user name, user OID, or implicit user = current_user. 
 * 
 *      The result is a boolean value: true if user has the indicated 
 *      privilege, false if not.  The variants that take a relation OID 
 *      return NULL if the OID doesn't exist (rather than failing, as 
 *      they did before Postgres 8.4). 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_table_privilege_name_name 
 *      Check user privileges on a table given 
 *      name username, text tablename, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1834"></a><span class='Declare_Function'>has_table_privilege_name_name</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1836"></a>    <a href="../../../include/c.h.html#LN496"><span class='Ref_to_Typedef'>Name</span></a>        <span class='Declare_Local'>rolename</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN242"><span class='Ref_to_Macro'>PG_GETARG_NAME</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1837"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>tablename</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1838"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1839"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN1840"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tableoid</span><span class='Delimiter'>; 
</span><a name="LN1841"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN1842"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN1839"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN235"><span class='Ref_to_Proto'>get_role_oid_or_public</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN1836"><span class='Ref_To_Local'>rolename</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN1840"><span class='Ref_To_Local'>tableoid</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN95"><span class='Ref_to_Proto'>convert_table_name</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1837"><span class='Ref_To_Local'>tablename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN1841"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN96"><span class='Ref_to_Proto'>convert_table_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1838"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN1842"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN283"><span class='Ref_to_Proto'>pg_class_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1840"><span class='Ref_To_Local'>tableoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN1839"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN1841"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1842"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_table_privilege_name 
 *      Check user privileges on a table given 
 *      text tablename and text priv name. 
 *      current_user is assumed 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1860"></a><span class='Declare_Function'>has_table_privilege_name</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1862"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>tablename</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1863"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1864"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN1865"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tableoid</span><span class='Delimiter'>; 
</span><a name="LN1866"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN1867"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN1864"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN1865"><span class='Ref_To_Local'>tableoid</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN95"><span class='Ref_to_Proto'>convert_table_name</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1862"><span class='Ref_To_Local'>tablename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN1866"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN96"><span class='Ref_to_Proto'>convert_table_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1863"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN1867"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN283"><span class='Ref_to_Proto'>pg_class_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1865"><span class='Ref_To_Local'>tableoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN1864"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN1866"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1867"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_table_privilege_name_id 
 *      Check user privileges on a table given 
 *      name usename, table oid, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1884"></a><span class='Declare_Function'>has_table_privilege_name_id</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1886"></a>    <a href="../../../include/c.h.html#LN496"><span class='Ref_to_Typedef'>Name</span></a>        <span class='Declare_Local'>username</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN242"><span class='Ref_to_Macro'>PG_GETARG_NAME</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1887"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tableoid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1888"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1889"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN1890"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN1891"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN1889"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN235"><span class='Ref_to_Proto'>get_role_oid_or_public</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN1886"><span class='Ref_To_Local'>username</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN1890"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN96"><span class='Ref_to_Proto'>convert_table_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1888"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/syscache.h.html#LN173"><span class='Ref_to_Macro'>SearchSysCacheExists1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1887"><span class='Ref_To_Local'>tableoid</span></a><span class='Parentheses'>)))</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN1891"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN283"><span class='Ref_to_Proto'>pg_class_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1887"><span class='Ref_To_Local'>tableoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN1889"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN1890"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1891"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end has_table_privilege_name_id &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * has_table_privilege_id 
 *      Check user privileges on a table given 
 *      table oid, and text priv name. 
 *      current_user is assumed 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1911"></a><span class='Declare_Function'>has_table_privilege_id</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1913"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tableoid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1914"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1915"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN1916"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN1917"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN1915"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN1916"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN96"><span class='Ref_to_Proto'>convert_table_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1914"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/syscache.h.html#LN173"><span class='Ref_to_Macro'>SearchSysCacheExists1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1913"><span class='Ref_To_Local'>tableoid</span></a><span class='Parentheses'>)))</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN1917"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN283"><span class='Ref_to_Proto'>pg_class_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1913"><span class='Ref_To_Local'>tableoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN1915"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN1916"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1917"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_table_privilege_id_name 
 *      Check user privileges on a table given 
 *      roleid, text tablename, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1936"></a><span class='Declare_Function'>has_table_privilege_id_name</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1938"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1939"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>tablename</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1940"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1941"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tableoid</span><span class='Delimiter'>; 
</span><a name="LN1942"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN1943"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN1941"><span class='Ref_To_Local'>tableoid</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN95"><span class='Ref_to_Proto'>convert_table_name</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1939"><span class='Ref_To_Local'>tablename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN1942"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN96"><span class='Ref_to_Proto'>convert_table_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1940"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN1943"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN283"><span class='Ref_to_Proto'>pg_class_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1941"><span class='Ref_To_Local'>tableoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN1938"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN1942"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1943"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_table_privilege_id_id 
 *      Check user privileges on a table given 
 *      roleid, table oid, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1959"></a><span class='Declare_Function'>has_table_privilege_id_id</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1961"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1962"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tableoid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1963"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1964"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN1965"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN1964"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN96"><span class='Ref_to_Proto'>convert_table_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1963"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/syscache.h.html#LN173"><span class='Ref_to_Macro'>SearchSysCacheExists1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1962"><span class='Ref_To_Local'>tableoid</span></a><span class='Parentheses'>)))</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN1965"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN283"><span class='Ref_to_Proto'>pg_class_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1962"><span class='Ref_To_Local'>tableoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN1961"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN1964"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1965"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 *      Support routines for has_table_privilege family. 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Given a table name expressed as a string, look it up and return Oid 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN1985"></a><span class='Declare_Function'>convert_table_name</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tablename</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1987"></a>    <a href="../../../include/nodes/primnodes.h.html#LN62"><span class='Ref_to_Struct'>RangeVar</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>relrv</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN1987"><span class='Ref_To_Local'>relrv</span></a> <span class='Operator'>= </span><a href="../../../include/catalog/namespace.h.html#LN119"><span class='Ref_to_Proto'>makeRangeVarFromNameList</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/varlena.h.html#LN28"><span class='Ref_to_Proto'>textToQualifiedNameList</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1985"><span class='Ref_to_Parameter'>tablename</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* We might not even have permissions on this relation; don't lock it. */ 
</span>    <span class='Control'>return</span> <a href="../../../include/catalog/namespace.h.html#LN52"><span class='Ref_to_Macro'>RangeVarGetRelid</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN1987"><span class='Ref_To_Local'>relrv</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * convert_table_priv_string 
 *      Convert text string to AclMode value. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> 
<a name="LN2000"></a><span class='Declare_Function'>convert_table_priv_string</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>priv_type_text</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2002"></a>    <span class='Keyword'>static const </span><a href="acl.c.html#LN41"><span class='Ref_to_Typedef'>priv_map</span></a> <span class='Declare_Local'>table_priv_map</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><span class='Delimiter'>{ 
</span>        <span class='Delimiter'>{</span><span class='String'>"SELECT"</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN72"><span class='Ref_to_Const'>ACL_SELECT</span></a><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"SELECT WITH GRANT OPTION"</span><span class='Delimiter'>, </span><a href="../../../include/utils/acl.h.html#LN62"><span class='Ref_to_Macro'>ACL_GRANT_OPTION_FOR</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN72"><span class='Ref_to_Const'>ACL_SELECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"INSERT"</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN71"><span class='Ref_to_Const'>ACL_INSERT</span></a><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"INSERT WITH GRANT OPTION"</span><span class='Delimiter'>, </span><a href="../../../include/utils/acl.h.html#LN62"><span class='Ref_to_Macro'>ACL_GRANT_OPTION_FOR</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN71"><span class='Ref_to_Const'>ACL_INSERT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"UPDATE"</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN73"><span class='Ref_to_Const'>ACL_UPDATE</span></a><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"UPDATE WITH GRANT OPTION"</span><span class='Delimiter'>, </span><a href="../../../include/utils/acl.h.html#LN62"><span class='Ref_to_Macro'>ACL_GRANT_OPTION_FOR</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN73"><span class='Ref_to_Const'>ACL_UPDATE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"DELETE"</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN74"><span class='Ref_to_Const'>ACL_DELETE</span></a><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"DELETE WITH GRANT OPTION"</span><span class='Delimiter'>, </span><a href="../../../include/utils/acl.h.html#LN62"><span class='Ref_to_Macro'>ACL_GRANT_OPTION_FOR</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN74"><span class='Ref_to_Const'>ACL_DELETE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"TRUNCATE"</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN75"><span class='Ref_to_Const'>ACL_TRUNCATE</span></a><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"TRUNCATE WITH GRANT OPTION"</span><span class='Delimiter'>, </span><a href="../../../include/utils/acl.h.html#LN62"><span class='Ref_to_Macro'>ACL_GRANT_OPTION_FOR</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN75"><span class='Ref_to_Const'>ACL_TRUNCATE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"REFERENCES"</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN76"><span class='Ref_to_Const'>ACL_REFERENCES</span></a><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"REFERENCES WITH GRANT OPTION"</span><span class='Delimiter'>, </span><a href="../../../include/utils/acl.h.html#LN62"><span class='Ref_to_Macro'>ACL_GRANT_OPTION_FOR</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN76"><span class='Ref_to_Const'>ACL_REFERENCES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"TRIGGER"</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN77"><span class='Ref_to_Const'>ACL_TRIGGER</span></a><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"TRIGGER WITH GRANT OPTION"</span><span class='Delimiter'>, </span><a href="../../../include/utils/acl.h.html#LN62"><span class='Ref_to_Macro'>ACL_GRANT_OPTION_FOR</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN77"><span class='Ref_to_Const'>ACL_TRIGGER</span></a><span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"RULE"</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>},</span>            <span class='Comment_Single_Line'>/* ignore old RULE privileges */ 
</span>        <span class='Delimiter'>{</span><span class='String'>"RULE WITH GRANT OPTION"</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>} 
</span>    <span class='Delimiter'>}; 
</span> 
    <span class='Control'>return</span> <a href="acl.c.html#LN92"><span class='Ref_to_Proto'>convert_any_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2000"><span class='Ref_to_Parameter'>priv_type_text</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2002"><span class='Ref_To_Local'>table_priv_map</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end convert_table_priv_string &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * has_sequence_privilege variants 
 *      These are all named "has_sequence_privilege" at the SQL level. 
 *      They take various combinations of relation name, relation OID, 
 *      user name, user OID, or implicit user = current_user. 
 * 
 *      The result is a boolean value: true if user has the indicated 
 *      privilege, false if not.  The variants that take a relation OID 
 *      return NULL if the OID doesn't exist. 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_sequence_privilege_name_name 
 *      Check user privileges on a sequence given 
 *      name username, text sequencename, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2042"></a><span class='Declare_Function'>has_sequence_privilege_name_name</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2044"></a>    <a href="../../../include/c.h.html#LN496"><span class='Ref_to_Typedef'>Name</span></a>        <span class='Declare_Local'>rolename</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN242"><span class='Ref_to_Macro'>PG_GETARG_NAME</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2045"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>sequencename</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2046"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2047"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN2048"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>sequenceoid</span><span class='Delimiter'>; 
</span><a name="LN2049"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN2050"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2047"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN235"><span class='Ref_to_Proto'>get_role_oid_or_public</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN2044"><span class='Ref_To_Local'>rolename</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN2049"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN97"><span class='Ref_to_Proto'>convert_sequence_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2046"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN2048"><span class='Ref_To_Local'>sequenceoid</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN95"><span class='Ref_to_Proto'>convert_table_name</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2045"><span class='Ref_To_Local'>sequencename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/lsyscache.h.html#LN127"><span class='Ref_to_Proto'>get_rel_relkind</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2048"><span class='Ref_To_Local'>sequenceoid</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../../include/catalog/pg_class.h.html#LN161"><span class='Ref_to_Const'>RELKIND_SEQUENCE</span></a><span class='Parentheses'>)</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is not a sequence"</span><span class='Delimiter'>, 
</span>                        <a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2045"><span class='Ref_To_Local'>sequencename</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2050"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN283"><span class='Ref_to_Proto'>pg_class_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2048"><span class='Ref_To_Local'>sequenceoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2047"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2049"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2050"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end has_sequence_privilege_name_name &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * has_sequence_privilege_name 
 *      Check user privileges on a sequence given 
 *      text sequencename and text priv name. 
 *      current_user is assumed 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2073"></a><span class='Declare_Function'>has_sequence_privilege_name</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2075"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>sequencename</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2076"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2077"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN2078"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>sequenceoid</span><span class='Delimiter'>; 
</span><a name="LN2079"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN2080"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2077"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN2079"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN97"><span class='Ref_to_Proto'>convert_sequence_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2076"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN2078"><span class='Ref_To_Local'>sequenceoid</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN95"><span class='Ref_to_Proto'>convert_table_name</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2075"><span class='Ref_To_Local'>sequencename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/lsyscache.h.html#LN127"><span class='Ref_to_Proto'>get_rel_relkind</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2078"><span class='Ref_To_Local'>sequenceoid</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../../include/catalog/pg_class.h.html#LN161"><span class='Ref_to_Const'>RELKIND_SEQUENCE</span></a><span class='Parentheses'>)</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is not a sequence"</span><span class='Delimiter'>, 
</span>                        <a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2075"><span class='Ref_To_Local'>sequencename</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2080"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN283"><span class='Ref_to_Proto'>pg_class_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2078"><span class='Ref_To_Local'>sequenceoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2077"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2079"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2080"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end has_sequence_privilege_name &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * has_sequence_privilege_name_id 
 *      Check user privileges on a sequence given 
 *      name usename, sequence oid, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2102"></a><span class='Declare_Function'>has_sequence_privilege_name_id</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2104"></a>    <a href="../../../include/c.h.html#LN496"><span class='Ref_to_Typedef'>Name</span></a>        <span class='Declare_Local'>username</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN242"><span class='Ref_to_Macro'>PG_GETARG_NAME</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2105"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>sequenceoid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2106"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2107"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN2108"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN2109"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span><a name="LN2110"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>relkind</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2107"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN235"><span class='Ref_to_Proto'>get_role_oid_or_public</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN2104"><span class='Ref_To_Local'>username</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN2108"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN97"><span class='Ref_to_Proto'>convert_sequence_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2106"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN2110"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN127"><span class='Ref_to_Proto'>get_rel_relkind</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2105"><span class='Ref_To_Local'>sequenceoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN2110"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN2110"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>!= </span><a href="../../../include/catalog/pg_class.h.html#LN161"><span class='Ref_to_Const'>RELKIND_SEQUENCE</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is not a sequence"</span><span class='Delimiter'>, 
</span>                        <a href="../../../include/utils/lsyscache.h.html#LN124"><span class='Ref_to_Proto'>get_rel_name</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2105"><span class='Ref_To_Local'>sequenceoid</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2109"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN283"><span class='Ref_to_Proto'>pg_class_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2105"><span class='Ref_To_Local'>sequenceoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2107"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2108"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2109"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end has_sequence_privilege_name_id &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * has_sequence_privilege_id 
 *      Check user privileges on a sequence given 
 *      sequence oid, and text priv name. 
 *      current_user is assumed 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2135"></a><span class='Declare_Function'>has_sequence_privilege_id</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2137"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>sequenceoid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2138"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2139"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN2140"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN2141"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span><a name="LN2142"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>relkind</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2139"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN2140"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN97"><span class='Ref_to_Proto'>convert_sequence_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2138"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN2142"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN127"><span class='Ref_to_Proto'>get_rel_relkind</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2137"><span class='Ref_To_Local'>sequenceoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN2142"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN2142"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>!= </span><a href="../../../include/catalog/pg_class.h.html#LN161"><span class='Ref_to_Const'>RELKIND_SEQUENCE</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is not a sequence"</span><span class='Delimiter'>, 
</span>                        <a href="../../../include/utils/lsyscache.h.html#LN124"><span class='Ref_to_Proto'>get_rel_name</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2137"><span class='Ref_To_Local'>sequenceoid</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2141"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN283"><span class='Ref_to_Proto'>pg_class_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2137"><span class='Ref_To_Local'>sequenceoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2139"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2140"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2141"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end has_sequence_privilege_id &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * has_sequence_privilege_id_name 
 *      Check user privileges on a sequence given 
 *      roleid, text sequencename, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2166"></a><span class='Declare_Function'>has_sequence_privilege_id_name</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2168"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2169"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>sequencename</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2170"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2171"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>sequenceoid</span><span class='Delimiter'>; 
</span><a name="LN2172"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN2173"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2172"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN97"><span class='Ref_to_Proto'>convert_sequence_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2170"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN2171"><span class='Ref_To_Local'>sequenceoid</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN95"><span class='Ref_to_Proto'>convert_table_name</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2169"><span class='Ref_To_Local'>sequencename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/lsyscache.h.html#LN127"><span class='Ref_to_Proto'>get_rel_relkind</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2171"><span class='Ref_To_Local'>sequenceoid</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../../include/catalog/pg_class.h.html#LN161"><span class='Ref_to_Const'>RELKIND_SEQUENCE</span></a><span class='Parentheses'>)</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is not a sequence"</span><span class='Delimiter'>, 
</span>                        <a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2169"><span class='Ref_To_Local'>sequencename</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2173"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN283"><span class='Ref_to_Proto'>pg_class_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2171"><span class='Ref_To_Local'>sequenceoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2168"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2172"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2173"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end has_sequence_privilege_id_name &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * has_sequence_privilege_id_id 
 *      Check user privileges on a sequence given 
 *      roleid, sequence oid, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2194"></a><span class='Declare_Function'>has_sequence_privilege_id_id</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2196"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2197"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>sequenceoid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2198"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2199"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN2200"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span><a name="LN2201"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>relkind</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2199"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN97"><span class='Ref_to_Proto'>convert_sequence_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2198"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN2201"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN127"><span class='Ref_to_Proto'>get_rel_relkind</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2197"><span class='Ref_To_Local'>sequenceoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN2201"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN2201"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>!= </span><a href="../../../include/catalog/pg_class.h.html#LN161"><span class='Ref_to_Const'>RELKIND_SEQUENCE</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is not a sequence"</span><span class='Delimiter'>, 
</span>                        <a href="../../../include/utils/lsyscache.h.html#LN124"><span class='Ref_to_Proto'>get_rel_name</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2197"><span class='Ref_To_Local'>sequenceoid</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2200"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN283"><span class='Ref_to_Proto'>pg_class_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2197"><span class='Ref_To_Local'>sequenceoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2196"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2199"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2200"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end has_sequence_privilege_id_id &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * convert_sequence_priv_string 
 *      Convert text string to AclMode value. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> 
<a name="LN2223"></a><span class='Declare_Function'>convert_sequence_priv_string</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>priv_type_text</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2225"></a>    <span class='Keyword'>static const </span><a href="acl.c.html#LN41"><span class='Ref_to_Typedef'>priv_map</span></a> <span class='Declare_Local'>sequence_priv_map</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><span class='Delimiter'>{ 
</span>        <span class='Delimiter'>{</span><span class='String'>"USAGE"</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN79"><span class='Ref_to_Const'>ACL_USAGE</span></a><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"SELECT"</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN72"><span class='Ref_to_Const'>ACL_SELECT</span></a><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"UPDATE"</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN73"><span class='Ref_to_Const'>ACL_UPDATE</span></a><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>} 
</span>    <span class='Delimiter'>}; 
</span> 
    <span class='Control'>return</span> <a href="acl.c.html#LN92"><span class='Ref_to_Proto'>convert_any_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2223"><span class='Ref_to_Parameter'>priv_type_text</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2225"><span class='Ref_To_Local'>sequence_priv_map</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * has_any_column_privilege variants 
 *      These are all named "has_any_column_privilege" at the SQL level. 
 *      They take various combinations of relation name, relation OID, 
 *      user name, user OID, or implicit user = current_user. 
 * 
 *      The result is a boolean value: true if user has the indicated 
 *      privilege for any column of the table, false if not.  The variants 
 *      that take a relation OID return NULL if the OID doesn't exist. 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_any_column_privilege_name_name 
 *      Check user privileges on any column of a table given 
 *      name username, text tablename, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2253"></a><span class='Declare_Function'>has_any_column_privilege_name_name</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2255"></a>    <a href="../../../include/c.h.html#LN496"><span class='Ref_to_Typedef'>Name</span></a>        <span class='Declare_Local'>rolename</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN242"><span class='Ref_to_Macro'>PG_GETARG_NAME</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2256"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>tablename</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2257"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2258"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN2259"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tableoid</span><span class='Delimiter'>; 
</span><a name="LN2260"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN2261"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2258"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN235"><span class='Ref_to_Proto'>get_role_oid_or_public</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN2255"><span class='Ref_To_Local'>rolename</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN2259"><span class='Ref_To_Local'>tableoid</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN95"><span class='Ref_to_Proto'>convert_table_name</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2256"><span class='Ref_To_Local'>tablename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN2260"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN99"><span class='Ref_to_Proto'>convert_column_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2257"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* First check at table level, then examine each column if needed */ 
</span>    <a href="acl.c.html#LN2261"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN283"><span class='Ref_to_Proto'>pg_class_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2259"><span class='Ref_To_Local'>tableoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2258"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2260"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN2261"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>!= </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>) 
</span>        <a href="acl.c.html#LN2261"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN281"><span class='Ref_to_Proto'>pg_attribute_aclcheck_all</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2259"><span class='Ref_To_Local'>tableoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2258"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2260"><span class='Ref_To_Local'>mode</span></a><span class='Delimiter'>, 
</span>                                              <a href="../../../include/utils/acl.h.html#LN165"><span class='Ref_to_EnumConst'>ACLMASK_ANY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2261"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end has_any_column_privilege_name_name &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * has_any_column_privilege_name 
 *      Check user privileges on any column of a table given 
 *      text tablename and text priv name. 
 *      current_user is assumed 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2283"></a><span class='Declare_Function'>has_any_column_privilege_name</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2285"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>tablename</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2286"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2287"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN2288"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tableoid</span><span class='Delimiter'>; 
</span><a name="LN2289"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN2290"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2287"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN2288"><span class='Ref_To_Local'>tableoid</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN95"><span class='Ref_to_Proto'>convert_table_name</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2285"><span class='Ref_To_Local'>tablename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN2289"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN99"><span class='Ref_to_Proto'>convert_column_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2286"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* First check at table level, then examine each column if needed */ 
</span>    <a href="acl.c.html#LN2290"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN283"><span class='Ref_to_Proto'>pg_class_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2288"><span class='Ref_To_Local'>tableoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2287"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2289"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN2290"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>!= </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>) 
</span>        <a href="acl.c.html#LN2290"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN281"><span class='Ref_to_Proto'>pg_attribute_aclcheck_all</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2288"><span class='Ref_To_Local'>tableoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2287"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2289"><span class='Ref_To_Local'>mode</span></a><span class='Delimiter'>, 
</span>                                              <a href="../../../include/utils/acl.h.html#LN165"><span class='Ref_to_EnumConst'>ACLMASK_ANY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2290"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end has_any_column_privilege_name &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * has_any_column_privilege_name_id 
 *      Check user privileges on any column of a table given 
 *      name usename, table oid, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2311"></a><span class='Declare_Function'>has_any_column_privilege_name_id</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2313"></a>    <a href="../../../include/c.h.html#LN496"><span class='Ref_to_Typedef'>Name</span></a>        <span class='Declare_Local'>username</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN242"><span class='Ref_to_Macro'>PG_GETARG_NAME</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2314"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tableoid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2315"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2316"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN2317"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN2318"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2316"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN235"><span class='Ref_to_Proto'>get_role_oid_or_public</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN2313"><span class='Ref_To_Local'>username</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN2317"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN99"><span class='Ref_to_Proto'>convert_column_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2315"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/syscache.h.html#LN173"><span class='Ref_to_Macro'>SearchSysCacheExists1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2314"><span class='Ref_To_Local'>tableoid</span></a><span class='Parentheses'>)))</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* First check at table level, then examine each column if needed */ 
</span>    <a href="acl.c.html#LN2318"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN283"><span class='Ref_to_Proto'>pg_class_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2314"><span class='Ref_To_Local'>tableoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2316"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2317"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN2318"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>!= </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>) 
</span>        <a href="acl.c.html#LN2318"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN281"><span class='Ref_to_Proto'>pg_attribute_aclcheck_all</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2314"><span class='Ref_To_Local'>tableoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2316"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2317"><span class='Ref_To_Local'>mode</span></a><span class='Delimiter'>, 
</span>                                              <a href="../../../include/utils/acl.h.html#LN165"><span class='Ref_to_EnumConst'>ACLMASK_ANY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2318"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end has_any_column_privilege_name_id &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * has_any_column_privilege_id 
 *      Check user privileges on any column of a table given 
 *      table oid, and text priv name. 
 *      current_user is assumed 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2342"></a><span class='Declare_Function'>has_any_column_privilege_id</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2344"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tableoid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2345"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2346"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN2347"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN2348"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2346"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN2347"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN99"><span class='Ref_to_Proto'>convert_column_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2345"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/syscache.h.html#LN173"><span class='Ref_to_Macro'>SearchSysCacheExists1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2344"><span class='Ref_To_Local'>tableoid</span></a><span class='Parentheses'>)))</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* First check at table level, then examine each column if needed */ 
</span>    <a href="acl.c.html#LN2348"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN283"><span class='Ref_to_Proto'>pg_class_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2344"><span class='Ref_To_Local'>tableoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2346"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2347"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN2348"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>!= </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>) 
</span>        <a href="acl.c.html#LN2348"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN281"><span class='Ref_to_Proto'>pg_attribute_aclcheck_all</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2344"><span class='Ref_To_Local'>tableoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2346"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2347"><span class='Ref_To_Local'>mode</span></a><span class='Delimiter'>, 
</span>                                              <a href="../../../include/utils/acl.h.html#LN165"><span class='Ref_to_EnumConst'>ACLMASK_ANY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2348"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end has_any_column_privilege_id &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * has_any_column_privilege_id_name 
 *      Check user privileges on any column of a table given 
 *      roleid, text tablename, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2371"></a><span class='Declare_Function'>has_any_column_privilege_id_name</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2373"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2374"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>tablename</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2375"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2376"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tableoid</span><span class='Delimiter'>; 
</span><a name="LN2377"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN2378"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2376"><span class='Ref_To_Local'>tableoid</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN95"><span class='Ref_to_Proto'>convert_table_name</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2374"><span class='Ref_To_Local'>tablename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN2377"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN99"><span class='Ref_to_Proto'>convert_column_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2375"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* First check at table level, then examine each column if needed */ 
</span>    <a href="acl.c.html#LN2378"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN283"><span class='Ref_to_Proto'>pg_class_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2376"><span class='Ref_To_Local'>tableoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2373"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2377"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN2378"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>!= </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>) 
</span>        <a href="acl.c.html#LN2378"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN281"><span class='Ref_to_Proto'>pg_attribute_aclcheck_all</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2376"><span class='Ref_To_Local'>tableoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2373"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2377"><span class='Ref_To_Local'>mode</span></a><span class='Delimiter'>, 
</span>                                              <a href="../../../include/utils/acl.h.html#LN165"><span class='Ref_to_EnumConst'>ACLMASK_ANY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2378"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end has_any_column_privilege_id_name &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * has_any_column_privilege_id_id 
 *      Check user privileges on any column of a table given 
 *      roleid, table oid, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2398"></a><span class='Declare_Function'>has_any_column_privilege_id_id</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2400"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2401"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tableoid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2402"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2403"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN2404"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2403"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN99"><span class='Ref_to_Proto'>convert_column_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2402"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/syscache.h.html#LN173"><span class='Ref_to_Macro'>SearchSysCacheExists1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2401"><span class='Ref_To_Local'>tableoid</span></a><span class='Parentheses'>)))</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* First check at table level, then examine each column if needed */ 
</span>    <a href="acl.c.html#LN2404"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN283"><span class='Ref_to_Proto'>pg_class_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2401"><span class='Ref_To_Local'>tableoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2400"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2403"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN2404"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>!= </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>) 
</span>        <a href="acl.c.html#LN2404"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN281"><span class='Ref_to_Proto'>pg_attribute_aclcheck_all</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2401"><span class='Ref_To_Local'>tableoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2400"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2403"><span class='Ref_To_Local'>mode</span></a><span class='Delimiter'>, 
</span>                                              <a href="../../../include/utils/acl.h.html#LN165"><span class='Ref_to_EnumConst'>ACLMASK_ANY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2404"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end has_any_column_privilege_id_id &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * has_column_privilege variants 
 *      These are all named "has_column_privilege" at the SQL level. 
 *      They take various combinations of relation name, relation OID, 
 *      column name, column attnum, user name, user OID, or 
 *      implicit user = current_user. 
 * 
 *      The result is a boolean value: true if user has the indicated 
 *      privilege, false if not.  The variants that take a relation OID 
 *      and an integer attnum return NULL (rather than throwing an error) 
 *      if the column doesn't exist or is dropped. 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * column_privilege_check: check column privileges, but don't throw an error 
 *      for dropped column or table 
 * 
 * Returns 1 if have the privilege, 0 if not, -1 if dropped column/table. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN2441"></a><span class='Declare_Function'>column_privilege_check</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>tableoid</span><span class='Delimiter'>, </span><a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a> <span class='Declare_Parameter'>attnum</span><span class='Delimiter'>, 
</span><a name="LN2442"></a>                       <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Parameter'>mode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2444"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span><a name="LN2445"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>attTuple</span><span class='Delimiter'>; 
</span><a name="LN2446"></a>    <a href="../../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>attributeForm</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * First check if we have the privilege at the table level.  We check 
     * existence of the pg_class row before risking calling pg_class_aclcheck. 
     * Note: it might seem there's a race condition against concurrent DROP, 
     * but really it's safe because there will be no syscache flush between 
     * here and there.  So if we see the row in the syscache, so will 
     * pg_class_aclcheck. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/syscache.h.html#LN173"><span class='Ref_to_Macro'>SearchSysCacheExists1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2441"><span class='Ref_to_Parameter'>tableoid</span></a><span class='Parentheses'>)))</span> 
        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2444"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN283"><span class='Ref_to_Proto'>pg_class_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2441"><span class='Ref_to_Parameter'>tableoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2442"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2442"><span class='Ref_to_Parameter'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN2444"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * No table privilege, so try per-column privileges.  Again, we have to 
     * check for dropped attribute first, and we rely on the syscache not to 
     * notice a concurrent drop before pg_attribute_aclcheck fetches the row. 
     */ 
</span>    <a href="acl.c.html#LN2445"><span class='Ref_To_Local'>attTuple</span></a> <span class='Operator'>= </span><a href="../../../include/utils/syscache.h.html#LN157"><span class='Ref_to_Macro'>SearchSysCache2</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN40"><span class='Ref_to_EnumConst'>ATTNUM</span></a><span class='Delimiter'>, 
</span>                               <a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2441"><span class='Ref_to_Parameter'>tableoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                               <a href="../../../include/postgres.h.html#LN456"><span class='Ref_to_Macro'>Int16GetDatum</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2441"><span class='Ref_to_Parameter'>attnum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2445"><span class='Ref_To_Local'>attTuple</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN2446"><span class='Ref_To_Local'>attributeForm</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2445"><span class='Ref_To_Local'>attTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN2446"><span class='Ref_To_Local'>attributeForm</span></a><span class='Operator'>-&GT;</span>attisdropped<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2445"><span class='Ref_To_Local'>attTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2445"><span class='Ref_To_Local'>attTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2444"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN279"><span class='Ref_to_Proto'>pg_attribute_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2441"><span class='Ref_to_Parameter'>tableoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2441"><span class='Ref_to_Parameter'>attnum</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2442"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2442"><span class='Ref_to_Parameter'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN2444"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end column_privilege_check &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * has_column_privilege_name_name_name 
 *      Check user privileges on a column given 
 *      name username, text tablename, text colname, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2493"></a><span class='Declare_Function'>has_column_privilege_name_name_name</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2495"></a>    <a href="../../../include/c.h.html#LN496"><span class='Ref_to_Typedef'>Name</span></a>        <span class='Declare_Local'>rolename</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN242"><span class='Ref_to_Macro'>PG_GETARG_NAME</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2496"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>tablename</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2497"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>column</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2498"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2499"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN2500"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tableoid</span><span class='Delimiter'>; 
</span><a name="LN2501"></a>    <a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>colattnum</span><span class='Delimiter'>; 
</span><a name="LN2502"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN2503"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>privresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2499"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN235"><span class='Ref_to_Proto'>get_role_oid_or_public</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN2495"><span class='Ref_To_Local'>rolename</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN2500"><span class='Ref_To_Local'>tableoid</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN95"><span class='Ref_to_Proto'>convert_table_name</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2496"><span class='Ref_To_Local'>tablename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN2501"><span class='Ref_To_Local'>colattnum</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN98"><span class='Ref_to_Proto'>convert_column_name</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2500"><span class='Ref_To_Local'>tableoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2497"><span class='Ref_To_Local'>column</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN2502"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN99"><span class='Ref_to_Proto'>convert_column_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2498"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2503"><span class='Ref_To_Local'>privresult</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN2440"><span class='Ref_to_Func'>column_privilege_check</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2500"><span class='Ref_To_Local'>tableoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2501"><span class='Ref_To_Local'>colattnum</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2499"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2502"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN2503"><span class='Ref_To_Local'>privresult</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2503"><span class='Ref_To_Local'>privresult</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end has_column_privilege_name_name_name &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * has_column_privilege_name_name_attnum 
 *      Check user privileges on a column given 
 *      name username, text tablename, int attnum, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2522"></a><span class='Declare_Function'>has_column_privilege_name_name_attnum</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2524"></a>    <a href="../../../include/c.h.html#LN496"><span class='Ref_to_Typedef'>Name</span></a>        <span class='Declare_Local'>rolename</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN242"><span class='Ref_to_Macro'>PG_GETARG_NAME</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2525"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>tablename</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2526"></a>    <a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>colattnum</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN235"><span class='Ref_to_Macro'>PG_GETARG_INT16</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2527"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2528"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN2529"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tableoid</span><span class='Delimiter'>; 
</span><a name="LN2530"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN2531"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>privresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2528"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN235"><span class='Ref_to_Proto'>get_role_oid_or_public</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN2524"><span class='Ref_To_Local'>rolename</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN2529"><span class='Ref_To_Local'>tableoid</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN95"><span class='Ref_to_Proto'>convert_table_name</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2525"><span class='Ref_To_Local'>tablename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN2530"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN99"><span class='Ref_to_Proto'>convert_column_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2527"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2531"><span class='Ref_To_Local'>privresult</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN2440"><span class='Ref_to_Func'>column_privilege_check</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2529"><span class='Ref_To_Local'>tableoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2526"><span class='Ref_To_Local'>colattnum</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2528"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2530"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN2531"><span class='Ref_To_Local'>privresult</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2531"><span class='Ref_To_Local'>privresult</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end has_column_privilege_name_name_attnum &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * has_column_privilege_name_id_name 
 *      Check user privileges on a column given 
 *      name username, table oid, text colname, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2549"></a><span class='Declare_Function'>has_column_privilege_name_id_name</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2551"></a>    <a href="../../../include/c.h.html#LN496"><span class='Ref_to_Typedef'>Name</span></a>        <span class='Declare_Local'>username</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN242"><span class='Ref_to_Macro'>PG_GETARG_NAME</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2552"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tableoid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2553"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>column</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2554"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2555"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN2556"></a>    <a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>colattnum</span><span class='Delimiter'>; 
</span><a name="LN2557"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN2558"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>privresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2555"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN235"><span class='Ref_to_Proto'>get_role_oid_or_public</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN2551"><span class='Ref_To_Local'>username</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN2556"><span class='Ref_To_Local'>colattnum</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN98"><span class='Ref_to_Proto'>convert_column_name</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2552"><span class='Ref_To_Local'>tableoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2553"><span class='Ref_To_Local'>column</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN2557"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN99"><span class='Ref_to_Proto'>convert_column_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2554"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2558"><span class='Ref_To_Local'>privresult</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN2440"><span class='Ref_to_Func'>column_privilege_check</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2552"><span class='Ref_To_Local'>tableoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2556"><span class='Ref_To_Local'>colattnum</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2555"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2557"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN2558"><span class='Ref_To_Local'>privresult</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2558"><span class='Ref_To_Local'>privresult</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end has_column_privilege_name_id_name &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * has_column_privilege_name_id_attnum 
 *      Check user privileges on a column given 
 *      name username, table oid, int attnum, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2576"></a><span class='Declare_Function'>has_column_privilege_name_id_attnum</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2578"></a>    <a href="../../../include/c.h.html#LN496"><span class='Ref_to_Typedef'>Name</span></a>        <span class='Declare_Local'>username</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN242"><span class='Ref_to_Macro'>PG_GETARG_NAME</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2579"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tableoid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2580"></a>    <a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>colattnum</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN235"><span class='Ref_to_Macro'>PG_GETARG_INT16</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2581"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2582"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN2583"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN2584"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>privresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2582"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN235"><span class='Ref_to_Proto'>get_role_oid_or_public</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN2578"><span class='Ref_To_Local'>username</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN2583"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN99"><span class='Ref_to_Proto'>convert_column_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2581"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2584"><span class='Ref_To_Local'>privresult</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN2440"><span class='Ref_to_Func'>column_privilege_check</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2579"><span class='Ref_To_Local'>tableoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2580"><span class='Ref_To_Local'>colattnum</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2582"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2583"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN2584"><span class='Ref_To_Local'>privresult</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2584"><span class='Ref_To_Local'>privresult</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_column_privilege_id_name_name 
 *      Check user privileges on a column given 
 *      oid roleid, text tablename, text colname, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2601"></a><span class='Declare_Function'>has_column_privilege_id_name_name</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2603"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2604"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>tablename</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2605"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>column</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2606"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2607"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tableoid</span><span class='Delimiter'>; 
</span><a name="LN2608"></a>    <a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>colattnum</span><span class='Delimiter'>; 
</span><a name="LN2609"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN2610"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>privresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2607"><span class='Ref_To_Local'>tableoid</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN95"><span class='Ref_to_Proto'>convert_table_name</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2604"><span class='Ref_To_Local'>tablename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN2608"><span class='Ref_To_Local'>colattnum</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN98"><span class='Ref_to_Proto'>convert_column_name</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2607"><span class='Ref_To_Local'>tableoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2605"><span class='Ref_To_Local'>column</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN2609"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN99"><span class='Ref_to_Proto'>convert_column_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2606"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2610"><span class='Ref_To_Local'>privresult</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN2440"><span class='Ref_to_Func'>column_privilege_check</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2607"><span class='Ref_To_Local'>tableoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2608"><span class='Ref_To_Local'>colattnum</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2603"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2609"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN2610"><span class='Ref_To_Local'>privresult</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2610"><span class='Ref_To_Local'>privresult</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end has_column_privilege_id_name_name &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * has_column_privilege_id_name_attnum 
 *      Check user privileges on a column given 
 *      oid roleid, text tablename, int attnum, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2628"></a><span class='Declare_Function'>has_column_privilege_id_name_attnum</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2630"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2631"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>tablename</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2632"></a>    <a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>colattnum</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN235"><span class='Ref_to_Macro'>PG_GETARG_INT16</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2633"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2634"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tableoid</span><span class='Delimiter'>; 
</span><a name="LN2635"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN2636"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>privresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2634"><span class='Ref_To_Local'>tableoid</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN95"><span class='Ref_to_Proto'>convert_table_name</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2631"><span class='Ref_To_Local'>tablename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN2635"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN99"><span class='Ref_to_Proto'>convert_column_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2633"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2636"><span class='Ref_To_Local'>privresult</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN2440"><span class='Ref_to_Func'>column_privilege_check</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2634"><span class='Ref_To_Local'>tableoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2632"><span class='Ref_To_Local'>colattnum</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2630"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2635"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN2636"><span class='Ref_To_Local'>privresult</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2636"><span class='Ref_To_Local'>privresult</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_column_privilege_id_id_name 
 *      Check user privileges on a column given 
 *      oid roleid, table oid, text colname, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2653"></a><span class='Declare_Function'>has_column_privilege_id_id_name</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2655"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2656"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tableoid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2657"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>column</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2658"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2659"></a>    <a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>colattnum</span><span class='Delimiter'>; 
</span><a name="LN2660"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN2661"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>privresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2659"><span class='Ref_To_Local'>colattnum</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN98"><span class='Ref_to_Proto'>convert_column_name</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2656"><span class='Ref_To_Local'>tableoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2657"><span class='Ref_To_Local'>column</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN2660"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN99"><span class='Ref_to_Proto'>convert_column_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2658"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2661"><span class='Ref_To_Local'>privresult</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN2440"><span class='Ref_to_Func'>column_privilege_check</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2656"><span class='Ref_To_Local'>tableoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2659"><span class='Ref_To_Local'>colattnum</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2655"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2660"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN2661"><span class='Ref_To_Local'>privresult</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2661"><span class='Ref_To_Local'>privresult</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_column_privilege_id_id_attnum 
 *      Check user privileges on a column given 
 *      oid roleid, table oid, int attnum, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2678"></a><span class='Declare_Function'>has_column_privilege_id_id_attnum</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2680"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2681"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tableoid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2682"></a>    <a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>colattnum</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN235"><span class='Ref_to_Macro'>PG_GETARG_INT16</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2683"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2684"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN2685"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>privresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2684"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN99"><span class='Ref_to_Proto'>convert_column_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2683"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2685"><span class='Ref_To_Local'>privresult</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN2440"><span class='Ref_to_Func'>column_privilege_check</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2681"><span class='Ref_To_Local'>tableoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2682"><span class='Ref_To_Local'>colattnum</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2680"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2684"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN2685"><span class='Ref_To_Local'>privresult</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2685"><span class='Ref_To_Local'>privresult</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_column_privilege_name_name 
 *      Check user privileges on a column given 
 *      text tablename, text colname, and text priv name. 
 *      current_user is assumed 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2702"></a><span class='Declare_Function'>has_column_privilege_name_name</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2704"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>tablename</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2705"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>column</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2706"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2707"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN2708"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tableoid</span><span class='Delimiter'>; 
</span><a name="LN2709"></a>    <a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>colattnum</span><span class='Delimiter'>; 
</span><a name="LN2710"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN2711"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>privresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2707"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN2708"><span class='Ref_To_Local'>tableoid</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN95"><span class='Ref_to_Proto'>convert_table_name</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2704"><span class='Ref_To_Local'>tablename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN2709"><span class='Ref_To_Local'>colattnum</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN98"><span class='Ref_to_Proto'>convert_column_name</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2708"><span class='Ref_To_Local'>tableoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2705"><span class='Ref_To_Local'>column</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN2710"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN99"><span class='Ref_to_Proto'>convert_column_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2706"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2711"><span class='Ref_To_Local'>privresult</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN2440"><span class='Ref_to_Func'>column_privilege_check</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2708"><span class='Ref_To_Local'>tableoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2709"><span class='Ref_To_Local'>colattnum</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2707"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2710"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN2711"><span class='Ref_To_Local'>privresult</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2711"><span class='Ref_To_Local'>privresult</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end has_column_privilege_name_name &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * has_column_privilege_name_attnum 
 *      Check user privileges on a column given 
 *      text tablename, int attnum, and text priv name. 
 *      current_user is assumed 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2731"></a><span class='Declare_Function'>has_column_privilege_name_attnum</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2733"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>tablename</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2734"></a>    <a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>colattnum</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN235"><span class='Ref_to_Macro'>PG_GETARG_INT16</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2735"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2736"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN2737"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tableoid</span><span class='Delimiter'>; 
</span><a name="LN2738"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN2739"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>privresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2736"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN2737"><span class='Ref_To_Local'>tableoid</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN95"><span class='Ref_to_Proto'>convert_table_name</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2733"><span class='Ref_To_Local'>tablename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN2738"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN99"><span class='Ref_to_Proto'>convert_column_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2735"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2739"><span class='Ref_To_Local'>privresult</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN2440"><span class='Ref_to_Func'>column_privilege_check</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2737"><span class='Ref_To_Local'>tableoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2734"><span class='Ref_To_Local'>colattnum</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2736"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2738"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN2739"><span class='Ref_To_Local'>privresult</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2739"><span class='Ref_To_Local'>privresult</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end has_column_privilege_name_attnum &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * has_column_privilege_id_name 
 *      Check user privileges on a column given 
 *      table oid, text colname, and text priv name. 
 *      current_user is assumed 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2758"></a><span class='Declare_Function'>has_column_privilege_id_name</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2760"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tableoid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2761"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>column</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2762"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2763"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN2764"></a>    <a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>colattnum</span><span class='Delimiter'>; 
</span><a name="LN2765"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN2766"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>privresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2763"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN2764"><span class='Ref_To_Local'>colattnum</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN98"><span class='Ref_to_Proto'>convert_column_name</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2760"><span class='Ref_To_Local'>tableoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2761"><span class='Ref_To_Local'>column</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN2765"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN99"><span class='Ref_to_Proto'>convert_column_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2762"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2766"><span class='Ref_To_Local'>privresult</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN2440"><span class='Ref_to_Func'>column_privilege_check</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2760"><span class='Ref_To_Local'>tableoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2764"><span class='Ref_To_Local'>colattnum</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2763"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2765"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN2766"><span class='Ref_To_Local'>privresult</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2766"><span class='Ref_To_Local'>privresult</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end has_column_privilege_id_name &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * has_column_privilege_id_attnum 
 *      Check user privileges on a column given 
 *      table oid, int attnum, and text priv name. 
 *      current_user is assumed 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2785"></a><span class='Declare_Function'>has_column_privilege_id_attnum</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2787"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tableoid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2788"></a>    <a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>colattnum</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN235"><span class='Ref_to_Macro'>PG_GETARG_INT16</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2789"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2790"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN2791"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN2792"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>privresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2790"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN2791"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN99"><span class='Ref_to_Proto'>convert_column_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2789"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2792"><span class='Ref_To_Local'>privresult</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN2440"><span class='Ref_to_Func'>column_privilege_check</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2787"><span class='Ref_To_Local'>tableoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2788"><span class='Ref_To_Local'>colattnum</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2790"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2791"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN2792"><span class='Ref_To_Local'>privresult</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2792"><span class='Ref_To_Local'>privresult</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 *      Support routines for has_column_privilege family. 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Given a table OID and a column name expressed as a string, look it up 
 * and return the column number 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a> 
<a name="LN2812"></a><span class='Declare_Function'>convert_column_name</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>tableoid</span><span class='Delimiter'>, </span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>column</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2814"></a>    <a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>attnum</span><span class='Delimiter'>; 
</span><a name="LN2815"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>colname</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2815"><span class='Ref_To_Local'>colname</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2812"><span class='Ref_to_Parameter'>column</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN2814"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN87"><span class='Ref_to_Proto'>get_attnum</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2812"><span class='Ref_to_Parameter'>tableoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2815"><span class='Ref_To_Local'>colname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN2814"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>== </span><a href="../../../include/access/attnum.h.html#LN22"><span class='Ref_to_Const'>InvalidAttrNumber</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_COLUMN<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" of relation \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                        <a href="acl.c.html#LN2815"><span class='Ref_To_Local'>colname</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/lsyscache.h.html#LN124"><span class='Ref_to_Proto'>get_rel_name</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2812"><span class='Ref_to_Parameter'>tableoid</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2815"><span class='Ref_To_Local'>colname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="acl.c.html#LN2814"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * convert_column_priv_string 
 *      Convert text string to AclMode value. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> 
<a name="LN2833"></a><span class='Declare_Function'>convert_column_priv_string</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>priv_type_text</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2835"></a>    <span class='Keyword'>static const </span><a href="acl.c.html#LN41"><span class='Ref_to_Typedef'>priv_map</span></a> <span class='Declare_Local'>column_priv_map</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><span class='Delimiter'>{ 
</span>        <span class='Delimiter'>{</span><span class='String'>"SELECT"</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN72"><span class='Ref_to_Const'>ACL_SELECT</span></a><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"SELECT WITH GRANT OPTION"</span><span class='Delimiter'>, </span><a href="../../../include/utils/acl.h.html#LN62"><span class='Ref_to_Macro'>ACL_GRANT_OPTION_FOR</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN72"><span class='Ref_to_Const'>ACL_SELECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"INSERT"</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN71"><span class='Ref_to_Const'>ACL_INSERT</span></a><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"INSERT WITH GRANT OPTION"</span><span class='Delimiter'>, </span><a href="../../../include/utils/acl.h.html#LN62"><span class='Ref_to_Macro'>ACL_GRANT_OPTION_FOR</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN71"><span class='Ref_to_Const'>ACL_INSERT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"UPDATE"</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN73"><span class='Ref_to_Const'>ACL_UPDATE</span></a><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"UPDATE WITH GRANT OPTION"</span><span class='Delimiter'>, </span><a href="../../../include/utils/acl.h.html#LN62"><span class='Ref_to_Macro'>ACL_GRANT_OPTION_FOR</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN73"><span class='Ref_to_Const'>ACL_UPDATE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"REFERENCES"</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN76"><span class='Ref_to_Const'>ACL_REFERENCES</span></a><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"REFERENCES WITH GRANT OPTION"</span><span class='Delimiter'>, </span><a href="../../../include/utils/acl.h.html#LN62"><span class='Ref_to_Macro'>ACL_GRANT_OPTION_FOR</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN76"><span class='Ref_to_Const'>ACL_REFERENCES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>} 
</span>    <span class='Delimiter'>}; 
</span> 
    <span class='Control'>return</span> <a href="acl.c.html#LN92"><span class='Ref_to_Proto'>convert_any_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2833"><span class='Ref_to_Parameter'>priv_type_text</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2835"><span class='Ref_To_Local'>column_priv_map</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * has_database_privilege variants 
 *      These are all named "has_database_privilege" at the SQL level. 
 *      They take various combinations of database name, database OID, 
 *      user name, user OID, or implicit user = current_user. 
 * 
 *      The result is a boolean value: true if user has the indicated 
 *      privilege, false if not, or NULL if object doesn't exist. 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_database_privilege_name_name 
 *      Check user privileges on a database given 
 *      name username, text databasename, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2867"></a><span class='Declare_Function'>has_database_privilege_name_name</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2869"></a>    <a href="../../../include/c.h.html#LN496"><span class='Ref_to_Typedef'>Name</span></a>        <span class='Declare_Local'>username</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN242"><span class='Ref_to_Macro'>PG_GETARG_NAME</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2870"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>databasename</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2871"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2872"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN2873"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>databaseoid</span><span class='Delimiter'>; 
</span><a name="LN2874"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN2875"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2872"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN235"><span class='Ref_to_Proto'>get_role_oid_or_public</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN2869"><span class='Ref_To_Local'>username</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN2873"><span class='Ref_To_Local'>databaseoid</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN100"><span class='Ref_to_Proto'>convert_database_name</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2870"><span class='Ref_To_Local'>databasename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN2874"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN101"><span class='Ref_to_Proto'>convert_database_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2871"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2875"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN284"><span class='Ref_to_Proto'>pg_database_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2873"><span class='Ref_To_Local'>databaseoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2872"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2874"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2875"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_database_privilege_name 
 *      Check user privileges on a database given 
 *      text databasename and text priv name. 
 *      current_user is assumed 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2893"></a><span class='Declare_Function'>has_database_privilege_name</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2895"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>databasename</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2896"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2897"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN2898"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>databaseoid</span><span class='Delimiter'>; 
</span><a name="LN2899"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN2900"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2897"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN2898"><span class='Ref_To_Local'>databaseoid</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN100"><span class='Ref_to_Proto'>convert_database_name</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2895"><span class='Ref_To_Local'>databasename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN2899"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN101"><span class='Ref_to_Proto'>convert_database_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2896"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2900"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN284"><span class='Ref_to_Proto'>pg_database_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2898"><span class='Ref_To_Local'>databaseoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2897"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2899"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2900"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_database_privilege_name_id 
 *      Check user privileges on a database given 
 *      name usename, database oid, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2917"></a><span class='Declare_Function'>has_database_privilege_name_id</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2919"></a>    <a href="../../../include/c.h.html#LN496"><span class='Ref_to_Typedef'>Name</span></a>        <span class='Declare_Local'>username</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN242"><span class='Ref_to_Macro'>PG_GETARG_NAME</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2920"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>databaseoid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2921"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2922"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN2923"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN2924"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2922"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN235"><span class='Ref_to_Proto'>get_role_oid_or_public</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN2919"><span class='Ref_To_Local'>username</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN2923"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN101"><span class='Ref_to_Proto'>convert_database_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2921"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/syscache.h.html#LN173"><span class='Ref_to_Macro'>SearchSysCacheExists1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN54"><span class='Ref_to_EnumConst'>DATABASEOID</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2920"><span class='Ref_To_Local'>databaseoid</span></a><span class='Parentheses'>)))</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2924"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN284"><span class='Ref_to_Proto'>pg_database_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2920"><span class='Ref_To_Local'>databaseoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2922"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2923"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2924"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end has_database_privilege_name_id &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * has_database_privilege_id 
 *      Check user privileges on a database given 
 *      database oid, and text priv name. 
 *      current_user is assumed 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2944"></a><span class='Declare_Function'>has_database_privilege_id</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2946"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>databaseoid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2947"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2948"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN2949"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN2950"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2948"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN2949"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN101"><span class='Ref_to_Proto'>convert_database_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2947"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/syscache.h.html#LN173"><span class='Ref_to_Macro'>SearchSysCacheExists1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN54"><span class='Ref_to_EnumConst'>DATABASEOID</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2946"><span class='Ref_To_Local'>databaseoid</span></a><span class='Parentheses'>)))</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2950"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN284"><span class='Ref_to_Proto'>pg_database_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2946"><span class='Ref_To_Local'>databaseoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2948"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2949"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2950"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_database_privilege_id_name 
 *      Check user privileges on a database given 
 *      roleid, text databasename, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2969"></a><span class='Declare_Function'>has_database_privilege_id_name</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2971"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2972"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>databasename</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2973"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2974"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>databaseoid</span><span class='Delimiter'>; 
</span><a name="LN2975"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN2976"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2974"><span class='Ref_To_Local'>databaseoid</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN100"><span class='Ref_to_Proto'>convert_database_name</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2972"><span class='Ref_To_Local'>databasename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN2975"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN101"><span class='Ref_to_Proto'>convert_database_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2973"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2976"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN284"><span class='Ref_to_Proto'>pg_database_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2974"><span class='Ref_To_Local'>databaseoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2971"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2975"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2976"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_database_privilege_id_id 
 *      Check user privileges on a database given 
 *      roleid, database oid, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2992"></a><span class='Declare_Function'>has_database_privilege_id_id</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2994"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2995"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>databaseoid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2996"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2997"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN2998"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2997"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN101"><span class='Ref_to_Proto'>convert_database_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2996"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/syscache.h.html#LN173"><span class='Ref_to_Macro'>SearchSysCacheExists1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN54"><span class='Ref_to_EnumConst'>DATABASEOID</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2995"><span class='Ref_To_Local'>databaseoid</span></a><span class='Parentheses'>)))</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN2998"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN284"><span class='Ref_to_Proto'>pg_database_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2995"><span class='Ref_To_Local'>databaseoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2994"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN2997"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN2998"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 *      Support routines for has_database_privilege family. 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Given a database name expressed as a string, look it up and return Oid 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN3018"></a><span class='Declare_Function'>convert_database_name</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>databasename</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3020"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>dbname</span> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3018"><span class='Ref_to_Parameter'>databasename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../../include/commands/dbcommands.h.html#LN28"><span class='Ref_to_Proto'>get_database_oid</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3020"><span class='Ref_To_Local'>dbname</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * convert_database_priv_string 
 *      Convert text string to AclMode value. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> 
<a name="LN3030"></a><span class='Declare_Function'>convert_database_priv_string</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>priv_type_text</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3032"></a>    <span class='Keyword'>static const </span><a href="acl.c.html#LN41"><span class='Ref_to_Typedef'>priv_map</span></a> <span class='Declare_Local'>database_priv_map</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><span class='Delimiter'>{ 
</span>        <span class='Delimiter'>{</span><span class='String'>"CREATE"</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN81"><span class='Ref_to_Const'>ACL_CREATE</span></a><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"CREATE WITH GRANT OPTION"</span><span class='Delimiter'>, </span><a href="../../../include/utils/acl.h.html#LN62"><span class='Ref_to_Macro'>ACL_GRANT_OPTION_FOR</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN81"><span class='Ref_to_Const'>ACL_CREATE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"TEMPORARY"</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN82"><span class='Ref_to_Const'>ACL_CREATE_TEMP</span></a><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"TEMPORARY WITH GRANT OPTION"</span><span class='Delimiter'>, </span><a href="../../../include/utils/acl.h.html#LN62"><span class='Ref_to_Macro'>ACL_GRANT_OPTION_FOR</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN82"><span class='Ref_to_Const'>ACL_CREATE_TEMP</span></a><span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"TEMP"</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN82"><span class='Ref_to_Const'>ACL_CREATE_TEMP</span></a><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"TEMP WITH GRANT OPTION"</span><span class='Delimiter'>, </span><a href="../../../include/utils/acl.h.html#LN62"><span class='Ref_to_Macro'>ACL_GRANT_OPTION_FOR</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN82"><span class='Ref_to_Const'>ACL_CREATE_TEMP</span></a><span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"CONNECT"</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN83"><span class='Ref_to_Const'>ACL_CONNECT</span></a><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"CONNECT WITH GRANT OPTION"</span><span class='Delimiter'>, </span><a href="../../../include/utils/acl.h.html#LN62"><span class='Ref_to_Macro'>ACL_GRANT_OPTION_FOR</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN83"><span class='Ref_to_Const'>ACL_CONNECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>} 
</span>    <span class='Delimiter'>}; 
</span> 
    <span class='Control'>return</span> <a href="acl.c.html#LN92"><span class='Ref_to_Proto'>convert_any_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3030"><span class='Ref_to_Parameter'>priv_type_text</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3032"><span class='Ref_To_Local'>database_priv_map</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Delimiter'>} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * has_foreign_data_wrapper_privilege variants 
 *      These are all named "has_foreign_data_wrapper_privilege" at the SQL level. 
 *      They take various combinations of foreign-data wrapper name, 
 *      fdw OID, user name, user OID, or implicit user = current_user. 
 * 
 *      The result is a boolean value: true if user has the indicated 
 *      privilege, false if not. 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_foreign_data_wrapper_privilege_name_name 
 *      Check user privileges on a foreign-data wrapper given 
 *      name username, text fdwname, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3065"></a><span class='Declare_Function'>has_foreign_data_wrapper_privilege_name_name</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3067"></a>    <a href="../../../include/c.h.html#LN496"><span class='Ref_to_Typedef'>Name</span></a>        <span class='Declare_Local'>username</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN242"><span class='Ref_to_Macro'>PG_GETARG_NAME</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3068"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>fdwname</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3069"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3070"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN3071"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>fdwid</span><span class='Delimiter'>; 
</span><a name="LN3072"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN3073"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3070"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN235"><span class='Ref_to_Proto'>get_role_oid_or_public</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN3067"><span class='Ref_To_Local'>username</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN3071"><span class='Ref_To_Local'>fdwid</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN102"><span class='Ref_to_Proto'>convert_foreign_data_wrapper_name</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3068"><span class='Ref_To_Local'>fdwname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN3072"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN103"><span class='Ref_to_Proto'>convert_foreign_data_wrapper_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3069"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3073"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN291"><span class='Ref_to_Proto'>pg_foreign_data_wrapper_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3071"><span class='Ref_To_Local'>fdwid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3070"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3072"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3073"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_foreign_data_wrapper_privilege_name 
 *      Check user privileges on a foreign-data wrapper given 
 *      text fdwname and text priv name. 
 *      current_user is assumed 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3091"></a><span class='Declare_Function'>has_foreign_data_wrapper_privilege_name</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3093"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>fdwname</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3094"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3095"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN3096"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>fdwid</span><span class='Delimiter'>; 
</span><a name="LN3097"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN3098"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3095"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN3096"><span class='Ref_To_Local'>fdwid</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN102"><span class='Ref_to_Proto'>convert_foreign_data_wrapper_name</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3093"><span class='Ref_To_Local'>fdwname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN3097"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN103"><span class='Ref_to_Proto'>convert_foreign_data_wrapper_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3094"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3098"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN291"><span class='Ref_to_Proto'>pg_foreign_data_wrapper_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3096"><span class='Ref_To_Local'>fdwid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3095"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3097"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3098"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_foreign_data_wrapper_privilege_name_id 
 *      Check user privileges on a foreign-data wrapper given 
 *      name usename, foreign-data wrapper oid, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3115"></a><span class='Declare_Function'>has_foreign_data_wrapper_privilege_name_id</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3117"></a>    <a href="../../../include/c.h.html#LN496"><span class='Ref_to_Typedef'>Name</span></a>        <span class='Declare_Local'>username</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN242"><span class='Ref_to_Macro'>PG_GETARG_NAME</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3118"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>fdwid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3119"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3120"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN3121"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN3122"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3120"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN235"><span class='Ref_to_Proto'>get_role_oid_or_public</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN3117"><span class='Ref_To_Local'>username</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN3121"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN103"><span class='Ref_to_Proto'>convert_foreign_data_wrapper_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3119"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3122"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN291"><span class='Ref_to_Proto'>pg_foreign_data_wrapper_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3118"><span class='Ref_To_Local'>fdwid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3120"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3121"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3122"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_foreign_data_wrapper_privilege_id 
 *      Check user privileges on a foreign-data wrapper given 
 *      foreign-data wrapper oid, and text priv name. 
 *      current_user is assumed 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3139"></a><span class='Declare_Function'>has_foreign_data_wrapper_privilege_id</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3141"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>fdwid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3142"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3143"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN3144"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN3145"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3143"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN3144"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN103"><span class='Ref_to_Proto'>convert_foreign_data_wrapper_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3142"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3145"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN291"><span class='Ref_to_Proto'>pg_foreign_data_wrapper_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3141"><span class='Ref_To_Local'>fdwid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3143"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3144"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3145"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_foreign_data_wrapper_privilege_id_name 
 *      Check user privileges on a foreign-data wrapper given 
 *      roleid, text fdwname, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3161"></a><span class='Declare_Function'>has_foreign_data_wrapper_privilege_id_name</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3163"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3164"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>fdwname</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3165"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3166"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>fdwid</span><span class='Delimiter'>; 
</span><a name="LN3167"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN3168"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3166"><span class='Ref_To_Local'>fdwid</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN102"><span class='Ref_to_Proto'>convert_foreign_data_wrapper_name</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3164"><span class='Ref_To_Local'>fdwname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN3167"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN103"><span class='Ref_to_Proto'>convert_foreign_data_wrapper_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3165"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3168"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN291"><span class='Ref_to_Proto'>pg_foreign_data_wrapper_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3166"><span class='Ref_To_Local'>fdwid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3163"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3167"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3168"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_foreign_data_wrapper_privilege_id_id 
 *      Check user privileges on a foreign-data wrapper given 
 *      roleid, fdw oid, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3184"></a><span class='Declare_Function'>has_foreign_data_wrapper_privilege_id_id</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3186"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3187"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>fdwid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3188"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3189"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN3190"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3189"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN103"><span class='Ref_to_Proto'>convert_foreign_data_wrapper_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3188"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3190"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN291"><span class='Ref_to_Proto'>pg_foreign_data_wrapper_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3187"><span class='Ref_To_Local'>fdwid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3186"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3189"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3190"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 *      Support routines for has_foreign_data_wrapper_privilege family. 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Given a FDW name expressed as a string, look it up and return Oid 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN3207"></a><span class='Declare_Function'>convert_foreign_data_wrapper_name</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fdwname</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3209"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>fdwstr</span> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3207"><span class='Ref_to_Parameter'>fdwname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../../include/foreign/foreign.h.html#LN81"><span class='Ref_to_Proto'>get_foreign_data_wrapper_oid</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3209"><span class='Ref_To_Local'>fdwstr</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * convert_foreign_data_wrapper_priv_string 
 *      Convert text string to AclMode value. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> 
<a name="LN3219"></a><span class='Declare_Function'>convert_foreign_data_wrapper_priv_string</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>priv_type_text</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3221"></a>    <span class='Keyword'>static const </span><a href="acl.c.html#LN41"><span class='Ref_to_Typedef'>priv_map</span></a> <span class='Declare_Local'>foreign_data_wrapper_priv_map</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><span class='Delimiter'>{ 
</span>        <span class='Delimiter'>{</span><span class='String'>"USAGE"</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN79"><span class='Ref_to_Const'>ACL_USAGE</span></a><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"USAGE WITH GRANT OPTION"</span><span class='Delimiter'>, </span><a href="../../../include/utils/acl.h.html#LN62"><span class='Ref_to_Macro'>ACL_GRANT_OPTION_FOR</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN79"><span class='Ref_to_Const'>ACL_USAGE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>} 
</span>    <span class='Delimiter'>}; 
</span> 
    <span class='Control'>return</span> <a href="acl.c.html#LN92"><span class='Ref_to_Proto'>convert_any_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3219"><span class='Ref_to_Parameter'>priv_type_text</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3221"><span class='Ref_To_Local'>foreign_data_wrapper_priv_map</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * has_function_privilege variants 
 *      These are all named "has_function_privilege" at the SQL level. 
 *      They take various combinations of function name, function OID, 
 *      user name, user OID, or implicit user = current_user. 
 * 
 *      The result is a boolean value: true if user has the indicated 
 *      privilege, false if not, or NULL if object doesn't exist. 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_function_privilege_name_name 
 *      Check user privileges on a function given 
 *      name username, text functionname, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3247"></a><span class='Declare_Function'>has_function_privilege_name_name</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3249"></a>    <a href="../../../include/c.h.html#LN496"><span class='Ref_to_Typedef'>Name</span></a>        <span class='Declare_Local'>username</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN242"><span class='Ref_to_Macro'>PG_GETARG_NAME</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3250"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>functionname</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3251"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3252"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN3253"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>functionoid</span><span class='Delimiter'>; 
</span><a name="LN3254"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN3255"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3252"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN235"><span class='Ref_to_Proto'>get_role_oid_or_public</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN3249"><span class='Ref_To_Local'>username</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN3253"><span class='Ref_To_Local'>functionoid</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN104"><span class='Ref_to_Proto'>convert_function_name</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3250"><span class='Ref_To_Local'>functionname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN3254"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN105"><span class='Ref_to_Proto'>convert_function_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3251"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3255"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN285"><span class='Ref_to_Proto'>pg_proc_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3253"><span class='Ref_To_Local'>functionoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3252"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3254"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3255"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_function_privilege_name 
 *      Check user privileges on a function given 
 *      text functionname and text priv name. 
 *      current_user is assumed 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3273"></a><span class='Declare_Function'>has_function_privilege_name</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3275"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>functionname</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3276"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3277"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN3278"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>functionoid</span><span class='Delimiter'>; 
</span><a name="LN3279"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN3280"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3277"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN3278"><span class='Ref_To_Local'>functionoid</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN104"><span class='Ref_to_Proto'>convert_function_name</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3275"><span class='Ref_To_Local'>functionname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN3279"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN105"><span class='Ref_to_Proto'>convert_function_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3276"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3280"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN285"><span class='Ref_to_Proto'>pg_proc_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3278"><span class='Ref_To_Local'>functionoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3277"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3279"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3280"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_function_privilege_name_id 
 *      Check user privileges on a function given 
 *      name usename, function oid, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3297"></a><span class='Declare_Function'>has_function_privilege_name_id</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3299"></a>    <a href="../../../include/c.h.html#LN496"><span class='Ref_to_Typedef'>Name</span></a>        <span class='Declare_Local'>username</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN242"><span class='Ref_to_Macro'>PG_GETARG_NAME</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3300"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>functionoid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3301"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3302"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN3303"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN3304"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3302"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN235"><span class='Ref_to_Proto'>get_role_oid_or_public</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN3299"><span class='Ref_To_Local'>username</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN3303"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN105"><span class='Ref_to_Proto'>convert_function_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3301"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/syscache.h.html#LN173"><span class='Ref_to_Macro'>SearchSysCacheExists1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN76"><span class='Ref_to_EnumConst'>PROCOID</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3300"><span class='Ref_To_Local'>functionoid</span></a><span class='Parentheses'>)))</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3304"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN285"><span class='Ref_to_Proto'>pg_proc_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3300"><span class='Ref_To_Local'>functionoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3302"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3303"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3304"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end has_function_privilege_name_id &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * has_function_privilege_id 
 *      Check user privileges on a function given 
 *      function oid, and text priv name. 
 *      current_user is assumed 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3324"></a><span class='Declare_Function'>has_function_privilege_id</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3326"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>functionoid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3327"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3328"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN3329"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN3330"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3328"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN3329"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN105"><span class='Ref_to_Proto'>convert_function_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3327"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/syscache.h.html#LN173"><span class='Ref_to_Macro'>SearchSysCacheExists1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN76"><span class='Ref_to_EnumConst'>PROCOID</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3326"><span class='Ref_To_Local'>functionoid</span></a><span class='Parentheses'>)))</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3330"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN285"><span class='Ref_to_Proto'>pg_proc_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3326"><span class='Ref_To_Local'>functionoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3328"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3329"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3330"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_function_privilege_id_name 
 *      Check user privileges on a function given 
 *      roleid, text functionname, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3349"></a><span class='Declare_Function'>has_function_privilege_id_name</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3351"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3352"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>functionname</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3353"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3354"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>functionoid</span><span class='Delimiter'>; 
</span><a name="LN3355"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN3356"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3354"><span class='Ref_To_Local'>functionoid</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN104"><span class='Ref_to_Proto'>convert_function_name</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3352"><span class='Ref_To_Local'>functionname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN3355"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN105"><span class='Ref_to_Proto'>convert_function_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3353"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3356"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN285"><span class='Ref_to_Proto'>pg_proc_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3354"><span class='Ref_To_Local'>functionoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3351"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3355"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3356"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_function_privilege_id_id 
 *      Check user privileges on a function given 
 *      roleid, function oid, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3372"></a><span class='Declare_Function'>has_function_privilege_id_id</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3374"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3375"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>functionoid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3376"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3377"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN3378"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3377"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN105"><span class='Ref_to_Proto'>convert_function_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3376"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/syscache.h.html#LN173"><span class='Ref_to_Macro'>SearchSysCacheExists1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN76"><span class='Ref_to_EnumConst'>PROCOID</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3375"><span class='Ref_To_Local'>functionoid</span></a><span class='Parentheses'>)))</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3378"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN285"><span class='Ref_to_Proto'>pg_proc_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3375"><span class='Ref_To_Local'>functionoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3374"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3377"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3378"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 *      Support routines for has_function_privilege family. 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Given a function name expressed as a string, look it up and return Oid 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN3398"></a><span class='Declare_Function'>convert_function_name</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>functionname</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3400"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>funcname</span> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3398"><span class='Ref_to_Parameter'>functionname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3401"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>oid</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3401"><span class='Ref_To_Local'>oid</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN505"><span class='Ref_to_Macro'>DatumGetObjectId</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="regproc.c.html#LN229"><span class='Ref_to_Func'>regprocedurein</span></a><span class='Delimiter'>, 
</span>                                               <a href="../../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3400"><span class='Ref_To_Local'>funcname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3401"><span class='Ref_To_Local'>oid</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_FUNCTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"function \"%s\" does not exist"</span><span class='Delimiter'>, </span><a href="acl.c.html#LN3400"><span class='Ref_To_Local'>funcname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="acl.c.html#LN3401"><span class='Ref_To_Local'>oid</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * convert_function_priv_string 
 *      Convert text string to AclMode value. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> 
<a name="LN3419"></a><span class='Declare_Function'>convert_function_priv_string</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>priv_type_text</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3421"></a>    <span class='Keyword'>static const </span><a href="acl.c.html#LN41"><span class='Ref_to_Typedef'>priv_map</span></a> <span class='Declare_Local'>function_priv_map</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><span class='Delimiter'>{ 
</span>        <span class='Delimiter'>{</span><span class='String'>"EXECUTE"</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN78"><span class='Ref_to_Const'>ACL_EXECUTE</span></a><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"EXECUTE WITH GRANT OPTION"</span><span class='Delimiter'>, </span><a href="../../../include/utils/acl.h.html#LN62"><span class='Ref_to_Macro'>ACL_GRANT_OPTION_FOR</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN78"><span class='Ref_to_Const'>ACL_EXECUTE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>} 
</span>    <span class='Delimiter'>}; 
</span> 
    <span class='Control'>return</span> <a href="acl.c.html#LN92"><span class='Ref_to_Proto'>convert_any_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3419"><span class='Ref_to_Parameter'>priv_type_text</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3421"><span class='Ref_To_Local'>function_priv_map</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * has_language_privilege variants 
 *      These are all named "has_language_privilege" at the SQL level. 
 *      They take various combinations of language name, language OID, 
 *      user name, user OID, or implicit user = current_user. 
 * 
 *      The result is a boolean value: true if user has the indicated 
 *      privilege, false if not, or NULL if object doesn't exist. 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_language_privilege_name_name 
 *      Check user privileges on a language given 
 *      name username, text languagename, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3447"></a><span class='Declare_Function'>has_language_privilege_name_name</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3449"></a>    <a href="../../../include/c.h.html#LN496"><span class='Ref_to_Typedef'>Name</span></a>        <span class='Declare_Local'>username</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN242"><span class='Ref_to_Macro'>PG_GETARG_NAME</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3450"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>languagename</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3451"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3452"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN3453"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>languageoid</span><span class='Delimiter'>; 
</span><a name="LN3454"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN3455"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3452"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN235"><span class='Ref_to_Proto'>get_role_oid_or_public</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN3449"><span class='Ref_To_Local'>username</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN3453"><span class='Ref_To_Local'>languageoid</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN106"><span class='Ref_to_Proto'>convert_language_name</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3450"><span class='Ref_To_Local'>languagename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN3454"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN107"><span class='Ref_to_Proto'>convert_language_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3451"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3455"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN286"><span class='Ref_to_Proto'>pg_language_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3453"><span class='Ref_To_Local'>languageoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3452"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3454"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3455"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_language_privilege_name 
 *      Check user privileges on a language given 
 *      text languagename and text priv name. 
 *      current_user is assumed 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3473"></a><span class='Declare_Function'>has_language_privilege_name</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3475"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>languagename</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3476"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3477"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN3478"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>languageoid</span><span class='Delimiter'>; 
</span><a name="LN3479"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN3480"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3477"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN3478"><span class='Ref_To_Local'>languageoid</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN106"><span class='Ref_to_Proto'>convert_language_name</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3475"><span class='Ref_To_Local'>languagename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN3479"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN107"><span class='Ref_to_Proto'>convert_language_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3476"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3480"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN286"><span class='Ref_to_Proto'>pg_language_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3478"><span class='Ref_To_Local'>languageoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3477"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3479"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3480"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_language_privilege_name_id 
 *      Check user privileges on a language given 
 *      name usename, language oid, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3497"></a><span class='Declare_Function'>has_language_privilege_name_id</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3499"></a>    <a href="../../../include/c.h.html#LN496"><span class='Ref_to_Typedef'>Name</span></a>        <span class='Declare_Local'>username</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN242"><span class='Ref_to_Macro'>PG_GETARG_NAME</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3500"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>languageoid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3501"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3502"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN3503"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN3504"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3502"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN235"><span class='Ref_to_Proto'>get_role_oid_or_public</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN3499"><span class='Ref_To_Local'>username</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN3503"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN107"><span class='Ref_to_Proto'>convert_language_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3501"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/syscache.h.html#LN173"><span class='Ref_to_Macro'>SearchSysCacheExists1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN67"><span class='Ref_to_EnumConst'>LANGOID</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3500"><span class='Ref_To_Local'>languageoid</span></a><span class='Parentheses'>)))</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3504"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN286"><span class='Ref_to_Proto'>pg_language_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3500"><span class='Ref_To_Local'>languageoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3502"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3503"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3504"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end has_language_privilege_name_id &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * has_language_privilege_id 
 *      Check user privileges on a language given 
 *      language oid, and text priv name. 
 *      current_user is assumed 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3524"></a><span class='Declare_Function'>has_language_privilege_id</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3526"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>languageoid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3527"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3528"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN3529"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN3530"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3528"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN3529"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN107"><span class='Ref_to_Proto'>convert_language_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3527"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/syscache.h.html#LN173"><span class='Ref_to_Macro'>SearchSysCacheExists1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN67"><span class='Ref_to_EnumConst'>LANGOID</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3526"><span class='Ref_To_Local'>languageoid</span></a><span class='Parentheses'>)))</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3530"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN286"><span class='Ref_to_Proto'>pg_language_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3526"><span class='Ref_To_Local'>languageoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3528"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3529"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3530"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_language_privilege_id_name 
 *      Check user privileges on a language given 
 *      roleid, text languagename, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3549"></a><span class='Declare_Function'>has_language_privilege_id_name</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3551"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3552"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>languagename</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3553"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3554"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>languageoid</span><span class='Delimiter'>; 
</span><a name="LN3555"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN3556"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3554"><span class='Ref_To_Local'>languageoid</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN106"><span class='Ref_to_Proto'>convert_language_name</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3552"><span class='Ref_To_Local'>languagename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN3555"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN107"><span class='Ref_to_Proto'>convert_language_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3553"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3556"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN286"><span class='Ref_to_Proto'>pg_language_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3554"><span class='Ref_To_Local'>languageoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3551"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3555"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3556"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_language_privilege_id_id 
 *      Check user privileges on a language given 
 *      roleid, language oid, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3572"></a><span class='Declare_Function'>has_language_privilege_id_id</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3574"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3575"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>languageoid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3576"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3577"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN3578"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3577"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN107"><span class='Ref_to_Proto'>convert_language_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3576"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/syscache.h.html#LN173"><span class='Ref_to_Macro'>SearchSysCacheExists1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN67"><span class='Ref_to_EnumConst'>LANGOID</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3575"><span class='Ref_To_Local'>languageoid</span></a><span class='Parentheses'>)))</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3578"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN286"><span class='Ref_to_Proto'>pg_language_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3575"><span class='Ref_To_Local'>languageoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3574"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3577"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3578"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 *      Support routines for has_language_privilege family. 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Given a language name expressed as a string, look it up and return Oid 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN3598"></a><span class='Declare_Function'>convert_language_name</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>languagename</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3600"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>langname</span> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3598"><span class='Ref_to_Parameter'>languagename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../../include/commands/proclang.h.html#LN20"><span class='Ref_to_Proto'>get_language_oid</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3600"><span class='Ref_To_Local'>langname</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * convert_language_priv_string 
 *      Convert text string to AclMode value. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> 
<a name="LN3610"></a><span class='Declare_Function'>convert_language_priv_string</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>priv_type_text</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3612"></a>    <span class='Keyword'>static const </span><a href="acl.c.html#LN41"><span class='Ref_to_Typedef'>priv_map</span></a> <span class='Declare_Local'>language_priv_map</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><span class='Delimiter'>{ 
</span>        <span class='Delimiter'>{</span><span class='String'>"USAGE"</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN79"><span class='Ref_to_Const'>ACL_USAGE</span></a><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"USAGE WITH GRANT OPTION"</span><span class='Delimiter'>, </span><a href="../../../include/utils/acl.h.html#LN62"><span class='Ref_to_Macro'>ACL_GRANT_OPTION_FOR</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN79"><span class='Ref_to_Const'>ACL_USAGE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>} 
</span>    <span class='Delimiter'>}; 
</span> 
    <span class='Control'>return</span> <a href="acl.c.html#LN92"><span class='Ref_to_Proto'>convert_any_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3610"><span class='Ref_to_Parameter'>priv_type_text</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3612"><span class='Ref_To_Local'>language_priv_map</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * has_schema_privilege variants 
 *      These are all named "has_schema_privilege" at the SQL level. 
 *      They take various combinations of schema name, schema OID, 
 *      user name, user OID, or implicit user = current_user. 
 * 
 *      The result is a boolean value: true if user has the indicated 
 *      privilege, false if not, or NULL if object doesn't exist. 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_schema_privilege_name_name 
 *      Check user privileges on a schema given 
 *      name username, text schemaname, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3638"></a><span class='Declare_Function'>has_schema_privilege_name_name</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3640"></a>    <a href="../../../include/c.h.html#LN496"><span class='Ref_to_Typedef'>Name</span></a>        <span class='Declare_Local'>username</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN242"><span class='Ref_to_Macro'>PG_GETARG_NAME</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3641"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>schemaname</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3642"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3643"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN3644"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>schemaoid</span><span class='Delimiter'>; 
</span><a name="LN3645"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN3646"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3643"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN235"><span class='Ref_to_Proto'>get_role_oid_or_public</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN3640"><span class='Ref_To_Local'>username</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN3644"><span class='Ref_To_Local'>schemaoid</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN108"><span class='Ref_to_Proto'>convert_schema_name</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3641"><span class='Ref_To_Local'>schemaname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN3645"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN109"><span class='Ref_to_Proto'>convert_schema_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3642"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3646"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN289"><span class='Ref_to_Proto'>pg_namespace_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3644"><span class='Ref_To_Local'>schemaoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3643"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3645"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3646"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_schema_privilege_name 
 *      Check user privileges on a schema given 
 *      text schemaname and text priv name. 
 *      current_user is assumed 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3664"></a><span class='Declare_Function'>has_schema_privilege_name</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3666"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>schemaname</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3667"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3668"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN3669"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>schemaoid</span><span class='Delimiter'>; 
</span><a name="LN3670"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN3671"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3668"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN3669"><span class='Ref_To_Local'>schemaoid</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN108"><span class='Ref_to_Proto'>convert_schema_name</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3666"><span class='Ref_To_Local'>schemaname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN3670"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN109"><span class='Ref_to_Proto'>convert_schema_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3667"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3671"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN289"><span class='Ref_to_Proto'>pg_namespace_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3669"><span class='Ref_To_Local'>schemaoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3668"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3670"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3671"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_schema_privilege_name_id 
 *      Check user privileges on a schema given 
 *      name usename, schema oid, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3688"></a><span class='Declare_Function'>has_schema_privilege_name_id</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3690"></a>    <a href="../../../include/c.h.html#LN496"><span class='Ref_to_Typedef'>Name</span></a>        <span class='Declare_Local'>username</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN242"><span class='Ref_to_Macro'>PG_GETARG_NAME</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3691"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>schemaoid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3692"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3693"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN3694"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN3695"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3693"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN235"><span class='Ref_to_Proto'>get_role_oid_or_public</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN3690"><span class='Ref_To_Local'>username</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN3694"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN109"><span class='Ref_to_Proto'>convert_schema_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3692"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/syscache.h.html#LN173"><span class='Ref_to_Macro'>SearchSysCacheExists1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN69"><span class='Ref_to_EnumConst'>NAMESPACEOID</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3691"><span class='Ref_To_Local'>schemaoid</span></a><span class='Parentheses'>)))</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3695"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN289"><span class='Ref_to_Proto'>pg_namespace_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3691"><span class='Ref_To_Local'>schemaoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3693"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3694"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3695"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end has_schema_privilege_name_id &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * has_schema_privilege_id 
 *      Check user privileges on a schema given 
 *      schema oid, and text priv name. 
 *      current_user is assumed 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3715"></a><span class='Declare_Function'>has_schema_privilege_id</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3717"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>schemaoid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3718"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3719"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN3720"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN3721"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3719"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN3720"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN109"><span class='Ref_to_Proto'>convert_schema_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3718"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/syscache.h.html#LN173"><span class='Ref_to_Macro'>SearchSysCacheExists1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN69"><span class='Ref_to_EnumConst'>NAMESPACEOID</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3717"><span class='Ref_To_Local'>schemaoid</span></a><span class='Parentheses'>)))</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3721"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN289"><span class='Ref_to_Proto'>pg_namespace_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3717"><span class='Ref_To_Local'>schemaoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3719"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3720"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3721"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_schema_privilege_id_name 
 *      Check user privileges on a schema given 
 *      roleid, text schemaname, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3740"></a><span class='Declare_Function'>has_schema_privilege_id_name</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3742"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3743"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>schemaname</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3744"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3745"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>schemaoid</span><span class='Delimiter'>; 
</span><a name="LN3746"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN3747"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3745"><span class='Ref_To_Local'>schemaoid</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN108"><span class='Ref_to_Proto'>convert_schema_name</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3743"><span class='Ref_To_Local'>schemaname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN3746"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN109"><span class='Ref_to_Proto'>convert_schema_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3744"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3747"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN289"><span class='Ref_to_Proto'>pg_namespace_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3745"><span class='Ref_To_Local'>schemaoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3742"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3746"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3747"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_schema_privilege_id_id 
 *      Check user privileges on a schema given 
 *      roleid, schema oid, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3763"></a><span class='Declare_Function'>has_schema_privilege_id_id</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3765"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3766"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>schemaoid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3767"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3768"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN3769"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3768"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN109"><span class='Ref_to_Proto'>convert_schema_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3767"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/syscache.h.html#LN173"><span class='Ref_to_Macro'>SearchSysCacheExists1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN69"><span class='Ref_to_EnumConst'>NAMESPACEOID</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3766"><span class='Ref_To_Local'>schemaoid</span></a><span class='Parentheses'>)))</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3769"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN289"><span class='Ref_to_Proto'>pg_namespace_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3766"><span class='Ref_To_Local'>schemaoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3765"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3768"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3769"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 *      Support routines for has_schema_privilege family. 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Given a schema name expressed as a string, look it up and return Oid 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN3789"></a><span class='Declare_Function'>convert_schema_name</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>schemaname</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3791"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>nspname</span> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3789"><span class='Ref_to_Parameter'>schemaname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../../include/catalog/namespace.h.html#LN114"><span class='Ref_to_Proto'>get_namespace_oid</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3791"><span class='Ref_To_Local'>nspname</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * convert_schema_priv_string 
 *      Convert text string to AclMode value. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> 
<a name="LN3801"></a><span class='Declare_Function'>convert_schema_priv_string</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>priv_type_text</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3803"></a>    <span class='Keyword'>static const </span><a href="acl.c.html#LN41"><span class='Ref_to_Typedef'>priv_map</span></a> <span class='Declare_Local'>schema_priv_map</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><span class='Delimiter'>{ 
</span>        <span class='Delimiter'>{</span><span class='String'>"CREATE"</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN81"><span class='Ref_to_Const'>ACL_CREATE</span></a><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"CREATE WITH GRANT OPTION"</span><span class='Delimiter'>, </span><a href="../../../include/utils/acl.h.html#LN62"><span class='Ref_to_Macro'>ACL_GRANT_OPTION_FOR</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN81"><span class='Ref_to_Const'>ACL_CREATE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"USAGE"</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN79"><span class='Ref_to_Const'>ACL_USAGE</span></a><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"USAGE WITH GRANT OPTION"</span><span class='Delimiter'>, </span><a href="../../../include/utils/acl.h.html#LN62"><span class='Ref_to_Macro'>ACL_GRANT_OPTION_FOR</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN79"><span class='Ref_to_Const'>ACL_USAGE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>} 
</span>    <span class='Delimiter'>}; 
</span> 
    <span class='Control'>return</span> <a href="acl.c.html#LN92"><span class='Ref_to_Proto'>convert_any_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3801"><span class='Ref_to_Parameter'>priv_type_text</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3803"><span class='Ref_To_Local'>schema_priv_map</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * has_server_privilege variants 
 *      These are all named "has_server_privilege" at the SQL level. 
 *      They take various combinations of foreign server name, 
 *      server OID, user name, user OID, or implicit user = current_user. 
 * 
 *      The result is a boolean value: true if user has the indicated 
 *      privilege, false if not. 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_server_privilege_name_name 
 *      Check user privileges on a foreign server given 
 *      name username, text servername, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3831"></a><span class='Declare_Function'>has_server_privilege_name_name</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3833"></a>    <a href="../../../include/c.h.html#LN496"><span class='Ref_to_Typedef'>Name</span></a>        <span class='Declare_Local'>username</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN242"><span class='Ref_to_Macro'>PG_GETARG_NAME</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3834"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>servername</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3835"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3836"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN3837"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>serverid</span><span class='Delimiter'>; 
</span><a name="LN3838"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN3839"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3836"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN235"><span class='Ref_to_Proto'>get_role_oid_or_public</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN3833"><span class='Ref_To_Local'>username</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN3837"><span class='Ref_To_Local'>serverid</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN110"><span class='Ref_to_Proto'>convert_server_name</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3834"><span class='Ref_To_Local'>servername</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN3838"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN111"><span class='Ref_to_Proto'>convert_server_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3835"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3839"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN292"><span class='Ref_to_Proto'>pg_foreign_server_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3837"><span class='Ref_To_Local'>serverid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3836"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3838"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3839"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_server_privilege_name 
 *      Check user privileges on a foreign server given 
 *      text servername and text priv name. 
 *      current_user is assumed 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3857"></a><span class='Declare_Function'>has_server_privilege_name</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3859"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>servername</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3860"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3861"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN3862"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>serverid</span><span class='Delimiter'>; 
</span><a name="LN3863"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN3864"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3861"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN3862"><span class='Ref_To_Local'>serverid</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN110"><span class='Ref_to_Proto'>convert_server_name</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3859"><span class='Ref_To_Local'>servername</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN3863"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN111"><span class='Ref_to_Proto'>convert_server_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3860"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3864"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN292"><span class='Ref_to_Proto'>pg_foreign_server_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3862"><span class='Ref_To_Local'>serverid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3861"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3863"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3864"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_server_privilege_name_id 
 *      Check user privileges on a foreign server given 
 *      name usename, foreign server oid, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3881"></a><span class='Declare_Function'>has_server_privilege_name_id</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3883"></a>    <a href="../../../include/c.h.html#LN496"><span class='Ref_to_Typedef'>Name</span></a>        <span class='Declare_Local'>username</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN242"><span class='Ref_to_Macro'>PG_GETARG_NAME</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3884"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>serverid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3885"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3886"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN3887"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN3888"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3886"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN235"><span class='Ref_to_Proto'>get_role_oid_or_public</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN3883"><span class='Ref_To_Local'>username</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN3887"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN111"><span class='Ref_to_Proto'>convert_server_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3885"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3888"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN292"><span class='Ref_to_Proto'>pg_foreign_server_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3884"><span class='Ref_To_Local'>serverid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3886"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3887"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3888"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_server_privilege_id 
 *      Check user privileges on a foreign server given 
 *      server oid, and text priv name. 
 *      current_user is assumed 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3905"></a><span class='Declare_Function'>has_server_privilege_id</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3907"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>serverid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3908"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3909"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN3910"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN3911"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3909"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN3910"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN111"><span class='Ref_to_Proto'>convert_server_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3908"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3911"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN292"><span class='Ref_to_Proto'>pg_foreign_server_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3907"><span class='Ref_To_Local'>serverid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3909"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3910"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3911"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_server_privilege_id_name 
 *      Check user privileges on a foreign server given 
 *      roleid, text servername, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3927"></a><span class='Declare_Function'>has_server_privilege_id_name</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3929"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3930"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>servername</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3931"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3932"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>serverid</span><span class='Delimiter'>; 
</span><a name="LN3933"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN3934"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3932"><span class='Ref_To_Local'>serverid</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN110"><span class='Ref_to_Proto'>convert_server_name</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3930"><span class='Ref_To_Local'>servername</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN3933"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN111"><span class='Ref_to_Proto'>convert_server_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3931"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3934"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN292"><span class='Ref_to_Proto'>pg_foreign_server_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3932"><span class='Ref_To_Local'>serverid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3929"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3933"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3934"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_server_privilege_id_id 
 *      Check user privileges on a foreign server given 
 *      roleid, server oid, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3950"></a><span class='Declare_Function'>has_server_privilege_id_id</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3952"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3953"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>serverid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3954"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3955"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN3956"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3955"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN111"><span class='Ref_to_Proto'>convert_server_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3954"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN3956"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN292"><span class='Ref_to_Proto'>pg_foreign_server_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3953"><span class='Ref_To_Local'>serverid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3952"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3955"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3956"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 *      Support routines for has_server_privilege family. 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Given a server name expressed as a string, look it up and return Oid 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN3973"></a><span class='Declare_Function'>convert_server_name</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>servername</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3975"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>serverstr</span> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3973"><span class='Ref_to_Parameter'>servername</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../../include/foreign/foreign.h.html#LN82"><span class='Ref_to_Proto'>get_foreign_server_oid</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3975"><span class='Ref_To_Local'>serverstr</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * convert_server_priv_string 
 *      Convert text string to AclMode value. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> 
<a name="LN3985"></a><span class='Declare_Function'>convert_server_priv_string</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>priv_type_text</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3987"></a>    <span class='Keyword'>static const </span><a href="acl.c.html#LN41"><span class='Ref_to_Typedef'>priv_map</span></a> <span class='Declare_Local'>server_priv_map</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><span class='Delimiter'>{ 
</span>        <span class='Delimiter'>{</span><span class='String'>"USAGE"</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN79"><span class='Ref_to_Const'>ACL_USAGE</span></a><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"USAGE WITH GRANT OPTION"</span><span class='Delimiter'>, </span><a href="../../../include/utils/acl.h.html#LN62"><span class='Ref_to_Macro'>ACL_GRANT_OPTION_FOR</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN79"><span class='Ref_to_Const'>ACL_USAGE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>} 
</span>    <span class='Delimiter'>}; 
</span> 
    <span class='Control'>return</span> <a href="acl.c.html#LN92"><span class='Ref_to_Proto'>convert_any_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN3985"><span class='Ref_to_Parameter'>priv_type_text</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN3987"><span class='Ref_To_Local'>server_priv_map</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * has_tablespace_privilege variants 
 *      These are all named "has_tablespace_privilege" at the SQL level. 
 *      They take various combinations of tablespace name, tablespace OID, 
 *      user name, user OID, or implicit user = current_user. 
 * 
 *      The result is a boolean value: true if user has the indicated 
 *      privilege, false if not. 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_tablespace_privilege_name_name 
 *      Check user privileges on a tablespace given 
 *      name username, text tablespacename, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4013"></a><span class='Declare_Function'>has_tablespace_privilege_name_name</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4015"></a>    <a href="../../../include/c.h.html#LN496"><span class='Ref_to_Typedef'>Name</span></a>        <span class='Declare_Local'>username</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN242"><span class='Ref_to_Macro'>PG_GETARG_NAME</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4016"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>tablespacename</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4017"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4018"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN4019"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tablespaceoid</span><span class='Delimiter'>; 
</span><a name="LN4020"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN4021"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN4018"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN235"><span class='Ref_to_Proto'>get_role_oid_or_public</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN4015"><span class='Ref_To_Local'>username</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN4019"><span class='Ref_To_Local'>tablespaceoid</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN112"><span class='Ref_to_Proto'>convert_tablespace_name</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4016"><span class='Ref_To_Local'>tablespacename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN4020"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN113"><span class='Ref_to_Proto'>convert_tablespace_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4017"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN4021"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN290"><span class='Ref_to_Proto'>pg_tablespace_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4019"><span class='Ref_To_Local'>tablespaceoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN4018"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN4020"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4021"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_tablespace_privilege_name 
 *      Check user privileges on a tablespace given 
 *      text tablespacename and text priv name. 
 *      current_user is assumed 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4039"></a><span class='Declare_Function'>has_tablespace_privilege_name</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4041"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>tablespacename</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4042"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4043"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN4044"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tablespaceoid</span><span class='Delimiter'>; 
</span><a name="LN4045"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN4046"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN4043"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN4044"><span class='Ref_To_Local'>tablespaceoid</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN112"><span class='Ref_to_Proto'>convert_tablespace_name</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4041"><span class='Ref_To_Local'>tablespacename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN4045"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN113"><span class='Ref_to_Proto'>convert_tablespace_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4042"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN4046"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN290"><span class='Ref_to_Proto'>pg_tablespace_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4044"><span class='Ref_To_Local'>tablespaceoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN4043"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN4045"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4046"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_tablespace_privilege_name_id 
 *      Check user privileges on a tablespace given 
 *      name usename, tablespace oid, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4063"></a><span class='Declare_Function'>has_tablespace_privilege_name_id</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4065"></a>    <a href="../../../include/c.h.html#LN496"><span class='Ref_to_Typedef'>Name</span></a>        <span class='Declare_Local'>username</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN242"><span class='Ref_to_Macro'>PG_GETARG_NAME</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4066"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tablespaceoid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4067"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4068"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN4069"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN4070"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN4068"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN235"><span class='Ref_to_Proto'>get_role_oid_or_public</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN4065"><span class='Ref_To_Local'>username</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN4069"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN113"><span class='Ref_to_Proto'>convert_tablespace_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4067"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN4070"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN290"><span class='Ref_to_Proto'>pg_tablespace_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4066"><span class='Ref_To_Local'>tablespaceoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN4068"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN4069"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4070"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_tablespace_privilege_id 
 *      Check user privileges on a tablespace given 
 *      tablespace oid, and text priv name. 
 *      current_user is assumed 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4087"></a><span class='Declare_Function'>has_tablespace_privilege_id</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4089"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tablespaceoid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4090"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4091"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN4092"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN4093"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN4091"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN4092"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN113"><span class='Ref_to_Proto'>convert_tablespace_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4090"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN4093"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN290"><span class='Ref_to_Proto'>pg_tablespace_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4089"><span class='Ref_To_Local'>tablespaceoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN4091"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN4092"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4093"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_tablespace_privilege_id_name 
 *      Check user privileges on a tablespace given 
 *      roleid, text tablespacename, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4109"></a><span class='Declare_Function'>has_tablespace_privilege_id_name</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4111"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4112"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>tablespacename</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4113"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4114"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tablespaceoid</span><span class='Delimiter'>; 
</span><a name="LN4115"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN4116"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN4114"><span class='Ref_To_Local'>tablespaceoid</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN112"><span class='Ref_to_Proto'>convert_tablespace_name</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4112"><span class='Ref_To_Local'>tablespacename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN4115"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN113"><span class='Ref_to_Proto'>convert_tablespace_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4113"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN4116"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN290"><span class='Ref_to_Proto'>pg_tablespace_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4114"><span class='Ref_To_Local'>tablespaceoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN4111"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN4115"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4116"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_tablespace_privilege_id_id 
 *      Check user privileges on a tablespace given 
 *      roleid, tablespace oid, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4132"></a><span class='Declare_Function'>has_tablespace_privilege_id_id</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4134"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4135"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tablespaceoid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4136"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4137"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN4138"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN4137"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN113"><span class='Ref_to_Proto'>convert_tablespace_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4136"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN4138"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN290"><span class='Ref_to_Proto'>pg_tablespace_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4135"><span class='Ref_To_Local'>tablespaceoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN4134"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN4137"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4138"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 *      Support routines for has_tablespace_privilege family. 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Given a tablespace name expressed as a string, look it up and return Oid 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN4155"></a><span class='Declare_Function'>convert_tablespace_name</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tablespacename</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4157"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>spcname</span> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4155"><span class='Ref_to_Parameter'>tablespacename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../../include/commands/tablespace.h.html#LN55"><span class='Ref_to_Proto'>get_tablespace_oid</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4157"><span class='Ref_To_Local'>spcname</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * convert_tablespace_priv_string 
 *      Convert text string to AclMode value. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> 
<a name="LN4167"></a><span class='Declare_Function'>convert_tablespace_priv_string</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>priv_type_text</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4169"></a>    <span class='Keyword'>static const </span><a href="acl.c.html#LN41"><span class='Ref_to_Typedef'>priv_map</span></a> <span class='Declare_Local'>tablespace_priv_map</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><span class='Delimiter'>{ 
</span>        <span class='Delimiter'>{</span><span class='String'>"CREATE"</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN81"><span class='Ref_to_Const'>ACL_CREATE</span></a><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"CREATE WITH GRANT OPTION"</span><span class='Delimiter'>, </span><a href="../../../include/utils/acl.h.html#LN62"><span class='Ref_to_Macro'>ACL_GRANT_OPTION_FOR</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN81"><span class='Ref_to_Const'>ACL_CREATE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>} 
</span>    <span class='Delimiter'>}; 
</span> 
    <span class='Control'>return</span> <a href="acl.c.html#LN92"><span class='Ref_to_Proto'>convert_any_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4167"><span class='Ref_to_Parameter'>priv_type_text</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN4169"><span class='Ref_To_Local'>tablespace_priv_map</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_type_privilege variants 
 *      These are all named "has_type_privilege" at the SQL level. 
 *      They take various combinations of type name, type OID, 
 *      user name, user OID, or implicit user = current_user. 
 * 
 *      The result is a boolean value: true if user has the indicated 
 *      privilege, false if not, or NULL if object doesn't exist. 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_type_privilege_name_name 
 *      Check user privileges on a type given 
 *      name username, text typename, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4194"></a><span class='Declare_Function'>has_type_privilege_name_name</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4196"></a>    <a href="../../../include/c.h.html#LN496"><span class='Ref_to_Typedef'>Name</span></a>        <span class='Declare_Local'>username</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN242"><span class='Ref_to_Macro'>PG_GETARG_NAME</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4197"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>typename</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4198"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4199"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN4200"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typeoid</span><span class='Delimiter'>; 
</span><a name="LN4201"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN4202"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN4199"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN235"><span class='Ref_to_Proto'>get_role_oid_or_public</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN4196"><span class='Ref_To_Local'>username</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN4200"><span class='Ref_To_Local'>typeoid</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN114"><span class='Ref_to_Proto'>convert_type_name</span></a><span class='Parentheses'>(</span><span class='Keyword'>typename</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN4201"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN115"><span class='Ref_to_Proto'>convert_type_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4198"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN4202"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN293"><span class='Ref_to_Proto'>pg_type_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4200"><span class='Ref_To_Local'>typeoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN4199"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN4201"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4202"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_type_privilege_name 
 *      Check user privileges on a type given 
 *      text typename and text priv name. 
 *      current_user is assumed 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4220"></a><span class='Declare_Function'>has_type_privilege_name</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4222"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>typename</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4223"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4224"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN4225"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typeoid</span><span class='Delimiter'>; 
</span><a name="LN4226"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN4227"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN4224"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN4225"><span class='Ref_To_Local'>typeoid</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN114"><span class='Ref_to_Proto'>convert_type_name</span></a><span class='Parentheses'>(</span><span class='Keyword'>typename</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN4226"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN115"><span class='Ref_to_Proto'>convert_type_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4223"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN4227"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN293"><span class='Ref_to_Proto'>pg_type_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4225"><span class='Ref_To_Local'>typeoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN4224"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN4226"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4227"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_type_privilege_name_id 
 *      Check user privileges on a type given 
 *      name usename, type oid, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4244"></a><span class='Declare_Function'>has_type_privilege_name_id</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4246"></a>    <a href="../../../include/c.h.html#LN496"><span class='Ref_to_Typedef'>Name</span></a>        <span class='Declare_Local'>username</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN242"><span class='Ref_to_Macro'>PG_GETARG_NAME</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4247"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typeoid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4248"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4249"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN4250"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN4251"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN4249"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN235"><span class='Ref_to_Proto'>get_role_oid_or_public</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN4246"><span class='Ref_To_Local'>username</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN4250"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN115"><span class='Ref_to_Proto'>convert_type_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4248"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/syscache.h.html#LN173"><span class='Ref_to_Macro'>SearchSysCacheExists1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN107"><span class='Ref_to_EnumConst'>TYPEOID</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4247"><span class='Ref_To_Local'>typeoid</span></a><span class='Parentheses'>)))</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN4251"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN293"><span class='Ref_to_Proto'>pg_type_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4247"><span class='Ref_To_Local'>typeoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN4249"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN4250"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4251"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end has_type_privilege_name_id &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * has_type_privilege_id 
 *      Check user privileges on a type given 
 *      type oid, and text priv name. 
 *      current_user is assumed 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4271"></a><span class='Declare_Function'>has_type_privilege_id</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4273"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typeoid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4274"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4275"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN4276"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN4277"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN4275"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN4276"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN115"><span class='Ref_to_Proto'>convert_type_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4274"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/syscache.h.html#LN173"><span class='Ref_to_Macro'>SearchSysCacheExists1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN107"><span class='Ref_to_EnumConst'>TYPEOID</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4273"><span class='Ref_To_Local'>typeoid</span></a><span class='Parentheses'>)))</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN4277"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN293"><span class='Ref_to_Proto'>pg_type_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4273"><span class='Ref_To_Local'>typeoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN4275"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN4276"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4277"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_type_privilege_id_name 
 *      Check user privileges on a type given 
 *      roleid, text typename, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4296"></a><span class='Declare_Function'>has_type_privilege_id_name</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4298"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4299"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>typename</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4300"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4301"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typeoid</span><span class='Delimiter'>; 
</span><a name="LN4302"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN4303"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN4301"><span class='Ref_To_Local'>typeoid</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN114"><span class='Ref_to_Proto'>convert_type_name</span></a><span class='Parentheses'>(</span><span class='Keyword'>typename</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN4302"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN115"><span class='Ref_to_Proto'>convert_type_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4300"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN4303"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN293"><span class='Ref_to_Proto'>pg_type_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4301"><span class='Ref_To_Local'>typeoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN4298"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN4302"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4303"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * has_type_privilege_id_id 
 *      Check user privileges on a type given 
 *      roleid, type oid, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4319"></a><span class='Declare_Function'>has_type_privilege_id_id</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4321"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4322"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typeoid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4323"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4324"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN4325"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN4324"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN115"><span class='Ref_to_Proto'>convert_type_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4323"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/syscache.h.html#LN173"><span class='Ref_to_Macro'>SearchSysCacheExists1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN107"><span class='Ref_to_EnumConst'>TYPEOID</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4322"><span class='Ref_To_Local'>typeoid</span></a><span class='Parentheses'>)))</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN4325"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN293"><span class='Ref_to_Proto'>pg_type_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4322"><span class='Ref_To_Local'>typeoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN4321"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN4324"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4325"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 *      Support routines for has_type_privilege family. 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Given a type name expressed as a string, look it up and return Oid 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN4345"></a><span class='Declare_Function'>convert_type_name</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typename</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4347"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>typname</span> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><span class='Keyword'>typename</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4348"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>oid</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN4348"><span class='Ref_To_Local'>oid</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN505"><span class='Ref_to_Macro'>DatumGetObjectId</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="regproc.c.html#LN1059"><span class='Ref_to_Func'>regtypein</span></a><span class='Delimiter'>, 
</span>                                               <a href="../../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4347"><span class='Ref_To_Local'>typname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4348"><span class='Ref_To_Local'>oid</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"type \"%s\" does not exist"</span><span class='Delimiter'>, </span><a href="acl.c.html#LN4347"><span class='Ref_To_Local'>typname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="acl.c.html#LN4348"><span class='Ref_To_Local'>oid</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * convert_type_priv_string 
 *      Convert text string to AclMode value. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> 
<a name="LN4366"></a><span class='Declare_Function'>convert_type_priv_string</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>priv_type_text</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4368"></a>    <span class='Keyword'>static const </span><a href="acl.c.html#LN41"><span class='Ref_to_Typedef'>priv_map</span></a> <span class='Declare_Local'>type_priv_map</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><span class='Delimiter'>{ 
</span>        <span class='Delimiter'>{</span><span class='String'>"USAGE"</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN79"><span class='Ref_to_Const'>ACL_USAGE</span></a><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"USAGE WITH GRANT OPTION"</span><span class='Delimiter'>, </span><a href="../../../include/utils/acl.h.html#LN62"><span class='Ref_to_Macro'>ACL_GRANT_OPTION_FOR</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN79"><span class='Ref_to_Const'>ACL_USAGE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>} 
</span>    <span class='Delimiter'>}; 
</span> 
    <span class='Control'>return</span> <a href="acl.c.html#LN92"><span class='Ref_to_Proto'>convert_any_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4366"><span class='Ref_to_Parameter'>priv_type_text</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN4368"><span class='Ref_To_Local'>type_priv_map</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * pg_has_role variants 
 *      These are all named "pg_has_role" at the SQL level. 
 *      They take various combinations of role name, role OID, 
 *      user name, user OID, or implicit user = current_user. 
 * 
 *      The result is a boolean value: true if user has the indicated 
 *      privilege, false if not. 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * pg_has_role_name_name 
 *      Check user privileges on a role given 
 *      name username, name rolename, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4394"></a><span class='Declare_Function'>pg_has_role_name_name</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4396"></a>    <a href="../../../include/c.h.html#LN496"><span class='Ref_to_Typedef'>Name</span></a>        <span class='Declare_Local'>username</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN242"><span class='Ref_to_Macro'>PG_GETARG_NAME</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4397"></a>    <a href="../../../include/c.h.html#LN496"><span class='Ref_to_Typedef'>Name</span></a>        <span class='Declare_Local'>rolename</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN242"><span class='Ref_to_Macro'>PG_GETARG_NAME</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4398"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4399"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN4400"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleoid</span><span class='Delimiter'>; 
</span><a name="LN4401"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN4402"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN4399"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN234"><span class='Ref_to_Proto'>get_role_oid</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN4396"><span class='Ref_To_Local'>username</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN4400"><span class='Ref_To_Local'>roleoid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN234"><span class='Ref_to_Proto'>get_role_oid</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN4397"><span class='Ref_To_Local'>rolename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN4401"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN116"><span class='Ref_to_Proto'>convert_role_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4398"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN4402"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN117"><span class='Ref_to_Proto'>pg_role_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4400"><span class='Ref_To_Local'>roleoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN4399"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN4401"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4402"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * pg_has_role_name 
 *      Check user privileges on a role given 
 *      name rolename and text priv name. 
 *      current_user is assumed 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4420"></a><span class='Declare_Function'>pg_has_role_name</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4422"></a>    <a href="../../../include/c.h.html#LN496"><span class='Ref_to_Typedef'>Name</span></a>        <span class='Declare_Local'>rolename</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN242"><span class='Ref_to_Macro'>PG_GETARG_NAME</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4423"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4424"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN4425"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleoid</span><span class='Delimiter'>; 
</span><a name="LN4426"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN4427"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN4424"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN4425"><span class='Ref_To_Local'>roleoid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN234"><span class='Ref_to_Proto'>get_role_oid</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN4422"><span class='Ref_To_Local'>rolename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN4426"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN116"><span class='Ref_to_Proto'>convert_role_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4423"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN4427"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN117"><span class='Ref_to_Proto'>pg_role_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4425"><span class='Ref_To_Local'>roleoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN4424"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN4426"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4427"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * pg_has_role_name_id 
 *      Check user privileges on a role given 
 *      name usename, role oid, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4444"></a><span class='Declare_Function'>pg_has_role_name_id</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4446"></a>    <a href="../../../include/c.h.html#LN496"><span class='Ref_to_Typedef'>Name</span></a>        <span class='Declare_Local'>username</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN242"><span class='Ref_to_Macro'>PG_GETARG_NAME</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4447"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleoid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4448"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4449"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN4450"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN4451"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN4449"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN234"><span class='Ref_to_Proto'>get_role_oid</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN4446"><span class='Ref_To_Local'>username</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN4450"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN116"><span class='Ref_to_Proto'>convert_role_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4448"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN4451"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN117"><span class='Ref_to_Proto'>pg_role_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4447"><span class='Ref_To_Local'>roleoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN4449"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN4450"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4451"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * pg_has_role_id 
 *      Check user privileges on a role given 
 *      role oid, and text priv name. 
 *      current_user is assumed 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4468"></a><span class='Declare_Function'>pg_has_role_id</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4470"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleoid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4471"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4472"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN4473"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN4474"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN4472"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN4473"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN116"><span class='Ref_to_Proto'>convert_role_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4471"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN4474"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN117"><span class='Ref_to_Proto'>pg_role_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4470"><span class='Ref_To_Local'>roleoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN4472"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN4473"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4474"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * pg_has_role_id_name 
 *      Check user privileges on a role given 
 *      roleid, name rolename, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4490"></a><span class='Declare_Function'>pg_has_role_id_name</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4492"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4493"></a>    <a href="../../../include/c.h.html#LN496"><span class='Ref_to_Typedef'>Name</span></a>        <span class='Declare_Local'>rolename</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN242"><span class='Ref_to_Macro'>PG_GETARG_NAME</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4494"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4495"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleoid</span><span class='Delimiter'>; 
</span><a name="LN4496"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN4497"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN4495"><span class='Ref_To_Local'>roleoid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN234"><span class='Ref_to_Proto'>get_role_oid</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="acl.c.html#LN4493"><span class='Ref_To_Local'>rolename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN4496"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN116"><span class='Ref_to_Proto'>convert_role_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4494"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN4497"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN117"><span class='Ref_to_Proto'>pg_role_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4495"><span class='Ref_To_Local'>roleoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN4492"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN4496"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4497"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * pg_has_role_id_id 
 *      Check user privileges on a role given 
 *      roleid, role oid, and text priv name. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4513"></a><span class='Declare_Function'>pg_has_role_id_id</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4515"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4516"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleoid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4517"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>priv_type_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4518"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>mode</span><span class='Delimiter'>; 
</span><a name="LN4519"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN4518"><span class='Ref_To_Local'>mode</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN116"><span class='Ref_to_Proto'>convert_role_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4517"><span class='Ref_To_Local'>priv_type_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN4519"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN117"><span class='Ref_to_Proto'>pg_role_aclcheck</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4516"><span class='Ref_To_Local'>roleoid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN4515"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN4518"><span class='Ref_To_Local'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4519"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 *      Support routines for pg_has_role family. 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * convert_role_priv_string 
 *      Convert text string to AclMode value. 
 * 
 * We use USAGE to denote whether the privileges of the role are accessible 
 * (has_privs), MEMBER to denote is_member, and MEMBER WITH GRANT OPTION 
 * (or ADMIN OPTION) to denote is_admin.  There is no ACL bit corresponding 
 * to MEMBER so we cheat and use ACL_CREATE for that.  This convention 
 * is shared only with pg_role_aclcheck, below. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> 
<a name="LN4543"></a><span class='Declare_Function'>convert_role_priv_string</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>priv_type_text</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4545"></a>    <span class='Keyword'>static const </span><a href="acl.c.html#LN41"><span class='Ref_to_Typedef'>priv_map</span></a> <span class='Declare_Local'>role_priv_map</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><span class='Delimiter'>{ 
</span>        <span class='Delimiter'>{</span><span class='String'>"USAGE"</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN79"><span class='Ref_to_Const'>ACL_USAGE</span></a><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"MEMBER"</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN81"><span class='Ref_to_Const'>ACL_CREATE</span></a><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"USAGE WITH GRANT OPTION"</span><span class='Delimiter'>, </span><a href="../../../include/utils/acl.h.html#LN62"><span class='Ref_to_Macro'>ACL_GRANT_OPTION_FOR</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN81"><span class='Ref_to_Const'>ACL_CREATE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"USAGE WITH ADMIN OPTION"</span><span class='Delimiter'>, </span><a href="../../../include/utils/acl.h.html#LN62"><span class='Ref_to_Macro'>ACL_GRANT_OPTION_FOR</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN81"><span class='Ref_to_Const'>ACL_CREATE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"MEMBER WITH GRANT OPTION"</span><span class='Delimiter'>, </span><a href="../../../include/utils/acl.h.html#LN62"><span class='Ref_to_Macro'>ACL_GRANT_OPTION_FOR</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN81"><span class='Ref_to_Const'>ACL_CREATE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"MEMBER WITH ADMIN OPTION"</span><span class='Delimiter'>, </span><a href="../../../include/utils/acl.h.html#LN62"><span class='Ref_to_Macro'>ACL_GRANT_OPTION_FOR</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN81"><span class='Ref_to_Const'>ACL_CREATE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>} 
</span>    <span class='Delimiter'>}; 
</span> 
    <span class='Control'>return</span> <a href="acl.c.html#LN92"><span class='Ref_to_Proto'>convert_any_priv_string</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4543"><span class='Ref_to_Parameter'>priv_type_text</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN4545"><span class='Ref_To_Local'>role_priv_map</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * pg_role_aclcheck 
 *      Quick-and-dirty support for pg_has_role 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a> 
<a name="LN4563"></a><span class='Declare_Function'>pg_role_aclcheck</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>role_oid</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Parameter'>mode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN4563"><span class='Ref_to_Parameter'>mode</span></a> <span class='Operator'>& </span><a href="../../../include/utils/acl.h.html#LN62"><span class='Ref_to_Macro'>ACL_GRANT_OPTION_FOR</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN81"><span class='Ref_to_Const'>ACL_CREATE</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * XXX For roleid == role_oid, is_admin_of_role() also examines the 
         * session and call stack.  That suits two-argument pg_has_role(), but 
         * it gives the three-argument version a lamentable whimsy. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/acl.h.html#LN232"><span class='Ref_to_Proto'>is_admin_of_role</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4563"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN4563"><span class='Ref_to_Parameter'>role_oid</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN4563"><span class='Ref_to_Parameter'>mode</span></a> <span class='Operator'>& </span><a href="../../../include/nodes/parsenodes.h.html#LN81"><span class='Ref_to_Const'>ACL_CREATE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/acl.h.html#LN230"><span class='Ref_to_Proto'>is_member_of_role</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4563"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN4563"><span class='Ref_to_Parameter'>role_oid</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN4563"><span class='Ref_to_Parameter'>mode</span></a> <span class='Operator'>& </span><a href="../../../include/nodes/parsenodes.h.html#LN79"><span class='Ref_to_Const'>ACL_USAGE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/acl.h.html#LN229"><span class='Ref_to_Proto'>has_privs_of_role</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4563"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN4563"><span class='Ref_to_Parameter'>role_oid</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="../../../include/utils/acl.h.html#LN172"><span class='Ref_to_EnumConst'>ACLCHECK_NO_PRIV</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_role_aclcheck &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * initialization function (called by InitPostgres) 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN4593"></a><span class='Declare_Function'>initialize_acl</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/miscadmin.h.html#LN369"><span class='Ref_to_Macro'>IsBootstrapProcessingMode</span></a><span class='Parentheses'>())</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * In normal mode, set a callback on any syscache invalidation of 
         * pg_auth_members rows 
         */ 
</span>        <a href="../../../include/utils/inval.h.html#LN55"><span class='Ref_to_Proto'>CacheRegisterSyscacheCallback</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN42"><span class='Ref_to_EnumConst'>AUTHMEMROLEMEM</span></a><span class='Delimiter'>, 
</span>                                      <a href="acl.c.html#LN119"><span class='Ref_to_Proto'>RoleMembershipCacheCallback</span></a><span class='Delimiter'>, 
</span>                                      <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * RoleMembershipCacheCallback 
 *      Syscache inval callback function 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN4612"></a><span class='Declare_Function'>RoleMembershipCacheCallback</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>cacheid</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Parameter'>hashvalue</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Force membership caches to be recomputed on next use */ 
</span>    <a href="acl.c.html#LN73"><span class='Ref_to_Global_Var'>cached_privs_role</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN75"><span class='Ref_to_Global_Var'>cached_member_role</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* Check if specified role has rolinherit set */ 
</span><span class='Keyword'>static bool 
</span><a name="LN4622"></a><span class='Declare_Function'>has_rolinherit</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4624"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>result</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN4625"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>utup</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN4625"><span class='Ref_To_Local'>utup</span></a> <span class='Operator'>= </span><a href="../../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN44"><span class='Ref_to_EnumConst'>AUTHOID</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4622"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4625"><span class='Ref_To_Local'>utup</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="acl.c.html#LN4624"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../../include/catalog/pg_authid.h.html#LN71"><span class='Ref_to_Typedef'>Form_pg_authid</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4625"><span class='Ref_To_Local'>utup</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>rolinherit<span class='Delimiter'>; 
</span>        <a href="../../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4625"><span class='Ref_To_Local'>utup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="acl.c.html#LN4624"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Get a list of roles that the specified roleid has the privileges of 
 * 
 * This is defined not to recurse through roles that don't have rolinherit 
 * set; for such roles, membership implies the ability to do SET ROLE, but 
 * the privileges are not available until you've done so. 
 * 
 * Since indirect membership testing is relatively expensive, we cache 
 * a list of memberships.  Hence, the result is only guaranteed good until 
 * the next call of roles_has_privs_of()! 
 * 
 * For the benefit of select_best_grantor, the result is defined to be 
 * in breadth-first order, ie, closer relationships earlier. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN4652"></a><span class='Declare_Function'>roles_has_privs_of</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4654"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>roles_list</span><span class='Delimiter'>; 
</span><a name="LN4655"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span><a name="LN4656"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>new_cached_privs_roles</span><span class='Delimiter'>; 
</span><a name="LN4657"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldctx</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If cache is already valid, just return the list */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN73"><span class='Ref_to_Global_Var'>cached_privs_role</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="acl.c.html#LN73"><span class='Ref_to_Global_Var'>cached_privs_role</span></a> <span class='Operator'>== </span><a href="acl.c.html#LN4652"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="acl.c.html#LN74"><span class='Ref_to_Global_Var'>cached_privs_roles</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Find all the roles that roleid is a member of, including multi-level 
     * recursion.  The role itself will always be the first element of the 
     * resulting list. 
     * 
     * Each element of the list is scanned to see if it adds any indirect 
     * memberships.  We can use a single list as both the record of 
     * already-found memberships and the agenda of roles yet to be scanned. 
     * This is a bit tricky but works because the foreach() macro doesn't 
     * fetch the next list element until the bottom of the loop. 
     */ 
</span>    <a href="acl.c.html#LN4654"><span class='Ref_To_Local'>roles_list</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN150"><span class='Ref_to_Macro'>list_make1_oid</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4652"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4655"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN4654"><span class='Ref_To_Local'>roles_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4678"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>memberid</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4655"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4679"></a>        <a href="../../../include/utils/catcache.h.html#LN119"><span class='Ref_to_Typedef'>CatCList</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>memlist</span><span class='Delimiter'>; 
</span><a name="LN4680"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Ignore non-inheriting roles */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="acl.c.html#LN4621"><span class='Ref_to_Func'>has_rolinherit</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4678"><span class='Ref_To_Local'>memberid</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Find roles that memberid is directly a member of */ 
</span>        <a href="acl.c.html#LN4679"><span class='Ref_To_Local'>memlist</span></a> <span class='Operator'>= </span><a href="../../../include/utils/syscache.h.html#LN200"><span class='Ref_to_Macro'>SearchSysCacheList1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN41"><span class='Ref_to_EnumConst'>AUTHMEMMEMROLE</span></a><span class='Delimiter'>, 
</span>                                      <a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4678"><span class='Ref_To_Local'>memberid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN4680"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="acl.c.html#LN4680"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="acl.c.html#LN4679"><span class='Ref_To_Local'>memlist</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN153"><span class='Ref_to_Member'>n_members</span></a><span class='Delimiter'>; </span><a href="acl.c.html#LN4680"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN4691"></a>            <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span> <span class='Operator'>= &</span><a href="acl.c.html#LN4679"><span class='Ref_To_Local'>memlist</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN154"><span class='Ref_to_Member'>members</span></a><span class='Delimiter'>[</span><a href="acl.c.html#LN4680"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN115"><span class='Ref_to_Member'>tuple</span></a><span class='Delimiter'>; 
</span><a name="LN4692"></a>            <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>otherid</span> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../../include/catalog/pg_auth_members.h.html#LN44"><span class='Ref_to_Typedef'>Form_pg_auth_members</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4691"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>roleid<span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Even though there shouldn't be any loops in the membership 
             * graph, we must test for having already seen this role. It is 
             * legal for instance to have both A-&GT;B and A-&GT;C-&GT;B. 
             */ 
</span>            <a href="acl.c.html#LN4654"><span class='Ref_To_Local'>roles_list</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN258"><span class='Ref_to_Proto'>list_append_unique_oid</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4654"><span class='Ref_To_Local'>roles_list</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN4692"><span class='Ref_To_Local'>otherid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../../include/utils/syscache.h.html#LN209"><span class='Ref_to_Macro'>ReleaseSysCacheList</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4679"><span class='Ref_To_Local'>memlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Copy the completed list into TopMemoryContext so it will persist. 
     */ 
</span>    <a href="acl.c.html#LN4657"><span class='Ref_To_Local'>oldctx</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN42"><span class='Ref_to_Global_Var'>TopMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN4656"><span class='Ref_To_Local'>new_cached_privs_roles</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN268"><span class='Ref_to_Proto'>list_copy</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4654"><span class='Ref_To_Local'>roles_list</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4657"><span class='Ref_To_Local'>oldctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4654"><span class='Ref_To_Local'>roles_list</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now safe to assign to state variable 
     */ 
</span>    <a href="acl.c.html#LN73"><span class='Ref_to_Global_Var'>cached_privs_role</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* just paranoia */ 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN74"><span class='Ref_to_Global_Var'>cached_privs_roles</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN74"><span class='Ref_to_Global_Var'>cached_privs_roles</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN4656"><span class='Ref_To_Local'>new_cached_privs_roles</span></a><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN73"><span class='Ref_to_Global_Var'>cached_privs_role</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN4652"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* And now we can return the answer */ 
</span>    <span class='Control'>return</span> <a href="acl.c.html#LN74"><span class='Ref_to_Global_Var'>cached_privs_roles</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end roles_has_privs_of &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Get a list of roles that the specified roleid is a member of 
 * 
 * This is defined to recurse through roles regardless of rolinherit. 
 * 
 * Since indirect membership testing is relatively expensive, we cache 
 * a list of memberships.  Hence, the result is only guaranteed good until 
 * the next call of roles_is_member_of()! 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN4735"></a><span class='Declare_Function'>roles_is_member_of</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4737"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>roles_list</span><span class='Delimiter'>; 
</span><a name="LN4738"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span><a name="LN4739"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>new_cached_membership_roles</span><span class='Delimiter'>; 
</span><a name="LN4740"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldctx</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If cache is already valid, just return the list */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN75"><span class='Ref_to_Global_Var'>cached_member_role</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="acl.c.html#LN75"><span class='Ref_to_Global_Var'>cached_member_role</span></a> <span class='Operator'>== </span><a href="acl.c.html#LN4735"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="acl.c.html#LN76"><span class='Ref_to_Global_Var'>cached_membership_roles</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Find all the roles that roleid is a member of, including multi-level 
     * recursion.  The role itself will always be the first element of the 
     * resulting list. 
     * 
     * Each element of the list is scanned to see if it adds any indirect 
     * memberships.  We can use a single list as both the record of 
     * already-found memberships and the agenda of roles yet to be scanned. 
     * This is a bit tricky but works because the foreach() macro doesn't 
     * fetch the next list element until the bottom of the loop. 
     */ 
</span>    <a href="acl.c.html#LN4737"><span class='Ref_To_Local'>roles_list</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN150"><span class='Ref_to_Macro'>list_make1_oid</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4735"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4738"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN4737"><span class='Ref_To_Local'>roles_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4761"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>memberid</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4738"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4762"></a>        <a href="../../../include/utils/catcache.h.html#LN119"><span class='Ref_to_Typedef'>CatCList</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>memlist</span><span class='Delimiter'>; 
</span><a name="LN4763"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Find roles that memberid is directly a member of */ 
</span>        <a href="acl.c.html#LN4762"><span class='Ref_To_Local'>memlist</span></a> <span class='Operator'>= </span><a href="../../../include/utils/syscache.h.html#LN200"><span class='Ref_to_Macro'>SearchSysCacheList1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN41"><span class='Ref_to_EnumConst'>AUTHMEMMEMROLE</span></a><span class='Delimiter'>, 
</span>                                      <a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4761"><span class='Ref_To_Local'>memberid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN4763"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="acl.c.html#LN4763"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="acl.c.html#LN4762"><span class='Ref_To_Local'>memlist</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN153"><span class='Ref_to_Member'>n_members</span></a><span class='Delimiter'>; </span><a href="acl.c.html#LN4763"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN4770"></a>            <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span> <span class='Operator'>= &</span><a href="acl.c.html#LN4762"><span class='Ref_To_Local'>memlist</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN154"><span class='Ref_to_Member'>members</span></a><span class='Delimiter'>[</span><a href="acl.c.html#LN4763"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN115"><span class='Ref_to_Member'>tuple</span></a><span class='Delimiter'>; 
</span><a name="LN4771"></a>            <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>otherid</span> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../../include/catalog/pg_auth_members.h.html#LN44"><span class='Ref_to_Typedef'>Form_pg_auth_members</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4770"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>roleid<span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Even though there shouldn't be any loops in the membership 
             * graph, we must test for having already seen this role. It is 
             * legal for instance to have both A-&GT;B and A-&GT;C-&GT;B. 
             */ 
</span>            <a href="acl.c.html#LN4737"><span class='Ref_To_Local'>roles_list</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN258"><span class='Ref_to_Proto'>list_append_unique_oid</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4737"><span class='Ref_To_Local'>roles_list</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN4771"><span class='Ref_To_Local'>otherid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../../include/utils/syscache.h.html#LN209"><span class='Ref_to_Macro'>ReleaseSysCacheList</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4762"><span class='Ref_To_Local'>memlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Copy the completed list into TopMemoryContext so it will persist. 
     */ 
</span>    <a href="acl.c.html#LN4740"><span class='Ref_To_Local'>oldctx</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN42"><span class='Ref_to_Global_Var'>TopMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN4739"><span class='Ref_To_Local'>new_cached_membership_roles</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN268"><span class='Ref_to_Proto'>list_copy</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4737"><span class='Ref_To_Local'>roles_list</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4740"><span class='Ref_To_Local'>oldctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4737"><span class='Ref_To_Local'>roles_list</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now safe to assign to state variable 
     */ 
</span>    <a href="acl.c.html#LN75"><span class='Ref_to_Global_Var'>cached_member_role</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* just paranoia */ 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN76"><span class='Ref_to_Global_Var'>cached_membership_roles</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN76"><span class='Ref_to_Global_Var'>cached_membership_roles</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN4739"><span class='Ref_To_Local'>new_cached_membership_roles</span></a><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN75"><span class='Ref_to_Global_Var'>cached_member_role</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN4735"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* And now we can return the answer */ 
</span>    <span class='Control'>return</span> <a href="acl.c.html#LN76"><span class='Ref_to_Global_Var'>cached_membership_roles</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end roles_is_member_of &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Does member have the privileges of role (directly or indirectly)? 
 * 
 * This is defined not to recurse through roles that don't have rolinherit 
 * set; for such roles, membership implies the ability to do SET ROLE, but 
 * the privileges are not available until you've done so. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN4812"></a><span class='Declare_Function'>has_privs_of_role</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>member</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>role</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Fast path for simple case */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN4812"><span class='Ref_to_Parameter'>member</span></a> <span class='Operator'>== </span><a href="acl.c.html#LN4812"><span class='Ref_to_Parameter'>role</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Superusers have every privilege, so are part of every role */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../misc/superuser.c.html#LN55"><span class='Ref_to_Func'>superuser_arg</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4812"><span class='Ref_to_Parameter'>member</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Find all the roles that member has the privileges of, including 
     * multi-level recursion, then see if target role is any one of them. 
     */ 
</span>    <span class='Control'>return</span> <a href="../../../include/nodes/pg_list.h.html#LN231"><span class='Ref_to_Proto'>list_member_oid</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4651"><span class='Ref_to_Func'>roles_has_privs_of</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4812"><span class='Ref_to_Parameter'>member</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="acl.c.html#LN4812"><span class='Ref_to_Parameter'>role</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Is member a member of role (directly or indirectly)? 
 * 
 * This is defined to recurse through roles regardless of rolinherit. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN4836"></a><span class='Declare_Function'>is_member_of_role</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>member</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>role</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Fast path for simple case */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN4836"><span class='Ref_to_Parameter'>member</span></a> <span class='Operator'>== </span><a href="acl.c.html#LN4836"><span class='Ref_to_Parameter'>role</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Superusers have every privilege, so are part of every role */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../misc/superuser.c.html#LN55"><span class='Ref_to_Func'>superuser_arg</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4836"><span class='Ref_to_Parameter'>member</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Find all the roles that member is a member of, including multi-level 
     * recursion, then see if target role is any one of them. 
     */ 
</span>    <span class='Control'>return</span> <a href="../../../include/nodes/pg_list.h.html#LN231"><span class='Ref_to_Proto'>list_member_oid</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4734"><span class='Ref_to_Func'>roles_is_member_of</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4836"><span class='Ref_to_Parameter'>member</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="acl.c.html#LN4836"><span class='Ref_to_Parameter'>role</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * check_is_member_of_role 
 *      is_member_of_role with a standard permission-violation error if not 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN4858"></a><span class='Declare_Function'>check_is_member_of_role</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>member</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>role</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/acl.h.html#LN230"><span class='Ref_to_Proto'>is_member_of_role</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4858"><span class='Ref_to_Parameter'>member</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN4858"><span class='Ref_to_Parameter'>role</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"must be member of role \"%s\""</span><span class='Delimiter'>, 
</span>                        <a href="../../../include/miscadmin.h.html#LN307"><span class='Ref_to_Proto'>GetUserNameFromId</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4858"><span class='Ref_to_Parameter'>role</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>))))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Is member a member of role, not considering superuserness? 
 * 
 * This is identical to is_member_of_role except we ignore superuser 
 * status. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN4874"></a><span class='Declare_Function'>is_member_of_role_nosuper</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>member</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>role</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Fast path for simple case */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN4874"><span class='Ref_to_Parameter'>member</span></a> <span class='Operator'>== </span><a href="acl.c.html#LN4874"><span class='Ref_to_Parameter'>role</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Find all the roles that member is a member of, including multi-level 
     * recursion, then see if target role is any one of them. 
     */ 
</span>    <span class='Control'>return</span> <a href="../../../include/nodes/pg_list.h.html#LN231"><span class='Ref_to_Proto'>list_member_oid</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4734"><span class='Ref_to_Func'>roles_is_member_of</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4874"><span class='Ref_to_Parameter'>member</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="acl.c.html#LN4874"><span class='Ref_to_Parameter'>role</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Is member an admin of role?  That is, is member the role itself (subject to 
 * restrictions below), a member (directly or indirectly) WITH ADMIN OPTION, 
 * or a superuser? 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN4894"></a><span class='Declare_Function'>is_admin_of_role</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>member</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>role</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4896"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>result</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN4897"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>roles_list</span><span class='Delimiter'>; 
</span><a name="LN4898"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../misc/superuser.c.html#LN55"><span class='Ref_to_Func'>superuser_arg</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4894"><span class='Ref_to_Parameter'>member</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN4894"><span class='Ref_to_Parameter'>member</span></a> <span class='Operator'>== </span><a href="acl.c.html#LN4894"><span class='Ref_to_Parameter'>role</span></a><span class='Parentheses'>) 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * A role can admin itself when it matches the session user and we're 
         * outside any security-restricted operation, SECURITY DEFINER or 
         * similar context.  SQL-standard roles cannot self-admin.  However, 
         * SQL-standard users are distinct from roles, and they are not 
         * grantable like roles: PostgreSQL's role-user duality extends the 
         * standard.  Checking for a session user match has the effect of 
         * letting a role self-admin only when it's conspicuously behaving 
         * like a user.  Note that allowing self-admin under a mere SET ROLE 
         * would make WITH ADMIN OPTION largely irrelevant; any member could 
         * SET ROLE to issue the otherwise-forbidden command. 
         * 
         * Withholding self-admin in a security-restricted operation prevents 
         * object owners from harnessing the session user identity during 
         * administrative maintenance.  Suppose Alice owns a database, has 
         * issued "GRANT alice TO bob", and runs a daily ANALYZE.  Bob creates 
         * an alice-owned SECURITY DEFINER function that issues "REVOKE alice 
         * FROM carol".  If he creates an expression index calling that 
         * function, Alice will attempt the REVOKE during each ANALYZE. 
         * Checking InSecurityRestrictedOperation() thwarts that attack. 
         * 
         * Withholding self-admin in SECURITY DEFINER functions makes their 
         * behavior independent of the calling user.  There's no security or 
         * SQL-standard-conformance need for that restriction, though. 
         * 
         * A role cannot have actual WITH ADMIN OPTION on itself, because that 
         * would imply a membership loop.  Therefore, we're done either way. 
         */ 
</span>        <span class='Control'>return</span> <a href="acl.c.html#LN4894"><span class='Ref_to_Parameter'>member</span></a> <span class='Operator'>== </span><a href="../../../include/miscadmin.h.html#LN310"><span class='Ref_to_Proto'>GetSessionUserId</span></a><span class='Parentheses'>() </span><span class='Operator'>&& 
</span>            <span class='Operator'>!</span><a href="../../../include/miscadmin.h.html#LN314"><span class='Ref_to_Proto'>InLocalUserIdChange</span></a><span class='Parentheses'>() </span><span class='Operator'>&& !</span><a href="../../../include/miscadmin.h.html#LN315"><span class='Ref_to_Proto'>InSecurityRestrictedOperation</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Find all the roles that member is a member of, including multi-level 
     * recursion.  We build a list in the same way that is_member_of_role does 
     * to track visited and unvisited roles. 
     */ 
</span>    <a href="acl.c.html#LN4897"><span class='Ref_To_Local'>roles_list</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN150"><span class='Ref_to_Macro'>list_make1_oid</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4894"><span class='Ref_to_Parameter'>member</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4898"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN4897"><span class='Ref_To_Local'>roles_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4945"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>memberid</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4898"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4946"></a>        <a href="../../../include/utils/catcache.h.html#LN119"><span class='Ref_to_Typedef'>CatCList</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>memlist</span><span class='Delimiter'>; 
</span><a name="LN4947"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Find roles that memberid is directly a member of */ 
</span>        <a href="acl.c.html#LN4946"><span class='Ref_To_Local'>memlist</span></a> <span class='Operator'>= </span><a href="../../../include/utils/syscache.h.html#LN200"><span class='Ref_to_Macro'>SearchSysCacheList1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN41"><span class='Ref_to_EnumConst'>AUTHMEMMEMROLE</span></a><span class='Delimiter'>, 
</span>                                      <a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4945"><span class='Ref_To_Local'>memberid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN4947"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="acl.c.html#LN4947"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="acl.c.html#LN4946"><span class='Ref_To_Local'>memlist</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN153"><span class='Ref_to_Member'>n_members</span></a><span class='Delimiter'>; </span><a href="acl.c.html#LN4947"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN4954"></a>            <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span> <span class='Operator'>= &</span><a href="acl.c.html#LN4946"><span class='Ref_To_Local'>memlist</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN154"><span class='Ref_to_Member'>members</span></a><span class='Delimiter'>[</span><a href="acl.c.html#LN4947"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN115"><span class='Ref_to_Member'>tuple</span></a><span class='Delimiter'>; 
</span><a name="LN4955"></a>            <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>otherid</span> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../../include/catalog/pg_auth_members.h.html#LN44"><span class='Ref_to_Typedef'>Form_pg_auth_members</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4954"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>roleid<span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN4955"><span class='Ref_To_Local'>otherid</span></a> <span class='Operator'>== </span><a href="acl.c.html#LN4894"><span class='Ref_to_Parameter'>role</span></a> <span class='Operator'>&& 
</span>                <span class='Parentheses'>((</span><a href="../../../include/catalog/pg_auth_members.h.html#LN44"><span class='Ref_to_Typedef'>Form_pg_auth_members</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4954"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>admin_option<span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Found what we came for, so can stop searching */ 
</span>                <a href="acl.c.html#LN4896"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="acl.c.html#LN4897"><span class='Ref_To_Local'>roles_list</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN258"><span class='Ref_to_Proto'>list_append_unique_oid</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4897"><span class='Ref_To_Local'>roles_list</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN4955"><span class='Ref_To_Local'>otherid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../../include/utils/syscache.h.html#LN209"><span class='Ref_to_Macro'>ReleaseSysCacheList</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4946"><span class='Ref_To_Local'>memlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN4896"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN4897"><span class='Ref_To_Local'>roles_list</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="acl.c.html#LN4896"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end is_admin_of_role &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* does what it says ... */ 
</span><span class='Keyword'>static int 
</span><a name="LN4980"></a><span class='Declare_Function'>count_one_bits</span><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Parameter'>mask</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4982"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nbits</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* this code relies on AclMode being an unsigned type */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN4980"><span class='Ref_to_Parameter'>mask</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN4980"><span class='Ref_to_Parameter'>mask</span></a> <span class='Operator'>& </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <a href="acl.c.html#LN4982"><span class='Ref_To_Local'>nbits</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="acl.c.html#LN4980"><span class='Ref_to_Parameter'>mask</span></a> <span class='Operator'>&GT;&GT;= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="acl.c.html#LN4982"><span class='Ref_To_Local'>nbits</span></a><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Select the effective grantor ID for a GRANT or REVOKE operation. 
 * 
 * The grantor must always be either the object owner or some role that has 
 * been explicitly granted grant options.  This ensures that all granted 
 * privileges appear to flow from the object owner, and there are never 
 * multiple "original sources" of a privilege.  Therefore, if the would-be 
 * grantor is a member of a role that has the needed grant options, we have 
 * to do the grant as that role instead. 
 * 
 * It is possible that the would-be grantor is a member of several roles 
 * that have different subsets of the desired grant options, but no one 
 * role has 'em all.  In this case we pick a role with the largest number 
 * of desired options.  Ties are broken in favor of closer ancestors. 
 * 
 * roleId: the role attempting to do the GRANT/REVOKE 
 * privileges: the privileges to be granted/revoked 
 * acl: the ACL of the object in question 
 * ownerId: the role owning the object in question 
 * *grantorId: receives the OID of the role to do the grant as 
 * *grantOptions: receives the grant options actually held by grantorId 
 * 
 * If no grant options exist, we set grantorId to roleId, grantOptions to 0. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN5020"></a><span class='Declare_Function'>select_best_grantor</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleId</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Parameter'>privileges</span><span class='Delimiter'>, 
</span><a name="LN5021"></a>                    <span class='Keyword'>const </span><a href="../../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>acl</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>ownerId</span><span class='Delimiter'>, 
</span><a name="LN5022"></a>                    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>grantorId</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>grantOptions</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5024"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>needed_goptions</span> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN62"><span class='Ref_to_Macro'>ACL_GRANT_OPTION_FOR</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN5020"><span class='Ref_to_Parameter'>privileges</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN5025"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>roles_list</span><span class='Delimiter'>; 
</span><a name="LN5026"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nrights</span><span class='Delimiter'>; 
</span><a name="LN5027"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The object owner is always treated as having all grant options, so if 
     * roleId is the owner it's easy.  Also, if roleId is a superuser it's 
     * easy: superusers are implicitly members of every role, so they act as 
     * the object owner. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN5020"><span class='Ref_to_Parameter'>roleId</span></a> <span class='Operator'>== </span><a href="acl.c.html#LN5021"><span class='Ref_to_Parameter'>ownerId</span></a> <span class='Operator'>|| </span><a href="../misc/superuser.c.html#LN55"><span class='Ref_to_Func'>superuser_arg</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN5020"><span class='Ref_to_Parameter'>roleId</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="acl.c.html#LN5022"><span class='Ref_to_Parameter'>grantorId</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN5021"><span class='Ref_to_Parameter'>ownerId</span></a><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="acl.c.html#LN5022"><span class='Ref_to_Parameter'>grantOptions</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN5024"><span class='Ref_To_Local'>needed_goptions</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Otherwise we have to do a careful search to see if roleId has the 
     * privileges of any suitable role.  Note: we can hang onto the result of 
     * roles_has_privs_of() throughout this loop, because aclmask_direct() 
     * doesn't query any role memberships. 
     */ 
</span>    <a href="acl.c.html#LN5025"><span class='Ref_To_Local'>roles_list</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN4651"><span class='Ref_to_Func'>roles_has_privs_of</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN5020"><span class='Ref_to_Parameter'>roleId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* initialize candidate result as default */ 
</span>    <span class='Operator'>*</span><a href="acl.c.html#LN5022"><span class='Ref_to_Parameter'>grantorId</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN5020"><span class='Ref_to_Parameter'>roleId</span></a><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="acl.c.html#LN5022"><span class='Ref_to_Parameter'>grantOptions</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN5026"><span class='Ref_To_Local'>nrights</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN5027"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN5025"><span class='Ref_To_Local'>roles_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN5057"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>otherrole</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN5027"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN5058"></a>        <a href="../../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>otherprivs</span><span class='Delimiter'>; 
</span> 
        <a href="acl.c.html#LN5058"><span class='Ref_To_Local'>otherprivs</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN1391"><span class='Ref_to_Func'>aclmask_direct</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN5021"><span class='Ref_to_Parameter'>acl</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN5057"><span class='Ref_To_Local'>otherrole</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN5021"><span class='Ref_to_Parameter'>ownerId</span></a><span class='Delimiter'>, 
</span>                                    <a href="acl.c.html#LN5024"><span class='Ref_To_Local'>needed_goptions</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/acl.h.html#LN164"><span class='Ref_to_EnumConst'>ACLMASK_ALL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN5058"><span class='Ref_To_Local'>otherprivs</span></a> <span class='Operator'>== </span><a href="acl.c.html#LN5024"><span class='Ref_To_Local'>needed_goptions</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Found a suitable grantor */ 
</span>            <span class='Operator'>*</span><a href="acl.c.html#LN5022"><span class='Ref_to_Parameter'>grantorId</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN5057"><span class='Ref_To_Local'>otherrole</span></a><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="acl.c.html#LN5022"><span class='Ref_to_Parameter'>grantOptions</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN5058"><span class='Ref_To_Local'>otherprivs</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>return</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If it has just some of the needed privileges, remember best 
         * candidate. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN5058"><span class='Ref_To_Local'>otherprivs</span></a> <span class='Operator'>!= </span><a href="../../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN5076"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>nnewrights</span> <span class='Operator'>= </span><a href="acl.c.html#LN4979"><span class='Ref_to_Func'>count_one_bits</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN5058"><span class='Ref_To_Local'>otherprivs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN5076"><span class='Ref_To_Local'>nnewrights</span></a> <span class='Operator'>&GT; </span><a href="acl.c.html#LN5026"><span class='Ref_To_Local'>nrights</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Operator'>*</span><a href="acl.c.html#LN5022"><span class='Ref_to_Parameter'>grantorId</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN5057"><span class='Ref_To_Local'>otherrole</span></a><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><a href="acl.c.html#LN5022"><span class='Ref_to_Parameter'>grantOptions</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN5058"><span class='Ref_To_Local'>otherprivs</span></a><span class='Delimiter'>; 
</span>                <a href="acl.c.html#LN5026"><span class='Ref_To_Local'>nrights</span></a> <span class='Operator'>= </span><a href="acl.c.html#LN5076"><span class='Ref_To_Local'>nnewrights</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end select_best_grantor &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * get_role_oid - Given a role name, look up the role's OID. 
 * 
 * If missing_ok is false, throw an error if role name not found.  If 
 * true, just return InvalidOid. 
 */ 
</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN5095"></a><span class='Declare_Function'>get_role_oid</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>rolname</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>missing_ok</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5097"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>oid</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN5097"><span class='Ref_To_Local'>oid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/syscache.h.html#LN182"><span class='Ref_to_Macro'>GetSysCacheOid1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN43"><span class='Ref_to_EnumConst'>AUTHNAME</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN5095"><span class='Ref_to_Parameter'>rolname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN5097"><span class='Ref_To_Local'>oid</span></a><span class='Parentheses'>) </span><span class='Operator'>&& !</span><a href="acl.c.html#LN5095"><span class='Ref_to_Parameter'>missing_ok</span></a><span class='Parentheses'>)</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"role \"%s\" does not exist"</span><span class='Delimiter'>, </span><a href="acl.c.html#LN5095"><span class='Ref_to_Parameter'>rolname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="acl.c.html#LN5097"><span class='Ref_To_Local'>oid</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * get_role_oid_or_public - As above, but return ACL_ID_PUBLIC if the 
 *      role name is "public". 
 */ 
</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN5112"></a><span class='Declare_Function'>get_role_oid_or_public</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>rolname</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="acl.c.html#LN5112"><span class='Ref_to_Parameter'>rolname</span></a><span class='Delimiter'>, </span><span class='String'>"public"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="../../../include/utils/acl.h.html#LN38"><span class='Ref_to_Const'>ACL_ID_PUBLIC</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../../include/utils/acl.h.html#LN234"><span class='Ref_to_Proto'>get_role_oid</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN5112"><span class='Ref_to_Parameter'>rolname</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Given a RoleSpec node, return the OID it corresponds to.  If missing_ok is 
 * true, return InvalidOid if the role does not exist. 
 * 
 * PUBLIC is always disallowed here.  Routines wanting to handle the PUBLIC 
 * case must check the case separately. 
 */ 
</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN5128"></a><span class='Declare_Function'>get_rolespec_oid</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../../include/nodes/parsenodes.h.html#LN324"><span class='Ref_to_Struct'>RoleSpec</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>role</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>missing_ok</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5130"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>oid</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN5128"><span class='Ref_to_Parameter'>role</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN327"><span class='Ref_to_Member'>roletype</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN318"><span class='Ref_to_EnumConst'>ROLESPEC_CSTRING</span></a><span class='Operator'>: 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="acl.c.html#LN5128"><span class='Ref_to_Parameter'>role</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN328"><span class='Ref_to_Member'>rolename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="acl.c.html#LN5130"><span class='Ref_To_Local'>oid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN234"><span class='Ref_to_Proto'>get_role_oid</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN5128"><span class='Ref_to_Parameter'>role</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN328"><span class='Ref_to_Member'>rolename</span></a><span class='Delimiter'>, </span><a href="acl.c.html#LN5128"><span class='Ref_to_Parameter'>missing_ok</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN319"><span class='Ref_to_EnumConst'>ROLESPEC_CURRENT_USER</span></a><span class='Operator'>: 
</span>            <a href="acl.c.html#LN5130"><span class='Ref_To_Local'>oid</span></a> <span class='Operator'>= </span><a href="../init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN320"><span class='Ref_to_EnumConst'>ROLESPEC_SESSION_USER</span></a><span class='Operator'>: 
</span>            <a href="acl.c.html#LN5130"><span class='Ref_To_Local'>oid</span></a> <span class='Operator'>= </span><a href="../../../include/miscadmin.h.html#LN310"><span class='Ref_to_Proto'>GetSessionUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN321"><span class='Ref_to_EnumConst'>ROLESPEC_PUBLIC</span></a><span class='Operator'>: 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"role \"%s\" does not exist"</span><span class='Delimiter'>, </span><span class='String'>"public"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="acl.c.html#LN5130"><span class='Ref_To_Local'>oid</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* make compiler happy */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected role type %d"</span><span class='Delimiter'>, </span><a href="acl.c.html#LN5128"><span class='Ref_to_Parameter'>role</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN327"><span class='Ref_to_Member'>roletype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch role-&GT;roletype &raquo; </span> 
 
    <span class='Control'>return</span> <a href="acl.c.html#LN5130"><span class='Ref_To_Local'>oid</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_rolespec_oid &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Given a RoleSpec node, return the pg_authid HeapTuple it corresponds to. 
 * Caller must ReleaseSysCache when done with the result tuple. 
 */ 
</span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> 
<a name="LN5166"></a><span class='Declare_Function'>get_rolespec_tuple</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../../include/nodes/parsenodes.h.html#LN324"><span class='Ref_to_Struct'>RoleSpec</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>role</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5168"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN5166"><span class='Ref_to_Parameter'>role</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN327"><span class='Ref_to_Member'>roletype</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN318"><span class='Ref_to_EnumConst'>ROLESPEC_CSTRING</span></a><span class='Operator'>: 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="acl.c.html#LN5166"><span class='Ref_to_Parameter'>role</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN328"><span class='Ref_to_Member'>rolename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="acl.c.html#LN5168"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN43"><span class='Ref_to_EnumConst'>AUTHNAME</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN5166"><span class='Ref_to_Parameter'>role</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN328"><span class='Ref_to_Member'>rolename</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN5168"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                      <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"role \"%s\" does not exist"</span><span class='Delimiter'>, </span><a href="acl.c.html#LN5166"><span class='Ref_to_Parameter'>role</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN328"><span class='Ref_to_Member'>rolename</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN319"><span class='Ref_to_EnumConst'>ROLESPEC_CURRENT_USER</span></a><span class='Operator'>: 
</span>            <a href="acl.c.html#LN5168"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN44"><span class='Ref_to_EnumConst'>AUTHOID</span></a><span class='Delimiter'>, </span><a href="../init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN5168"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
                <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for role %u"</span><span class='Delimiter'>, </span><a href="../init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN320"><span class='Ref_to_EnumConst'>ROLESPEC_SESSION_USER</span></a><span class='Operator'>: 
</span>            <a href="acl.c.html#LN5168"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN44"><span class='Ref_to_EnumConst'>AUTHOID</span></a><span class='Delimiter'>, </span><a href="../../../include/miscadmin.h.html#LN310"><span class='Ref_to_Proto'>GetSessionUserId</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN5168"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
                <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for role %u"</span><span class='Delimiter'>, </span><a href="../../../include/miscadmin.h.html#LN310"><span class='Ref_to_Proto'>GetSessionUserId</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/parsenodes.h.html#LN321"><span class='Ref_to_EnumConst'>ROLESPEC_PUBLIC</span></a><span class='Operator'>: 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"role \"%s\" does not exist"</span><span class='Delimiter'>, </span><span class='String'>"public"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="acl.c.html#LN5168"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* make compiler happy */ 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected role type %d"</span><span class='Delimiter'>, </span><a href="acl.c.html#LN5166"><span class='Ref_to_Parameter'>role</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN327"><span class='Ref_to_Member'>roletype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch role-&GT;roletype &raquo; </span> 
 
    <span class='Control'>return</span> <a href="acl.c.html#LN5168"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_rolespec_tuple &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Given a RoleSpec, returns a palloc'ed copy of the corresponding role's name. 
 */ 
</span><span class='Keyword'>char </span><span class='Operator'>* 
</span><a name="LN5210"></a><span class='Declare_Function'>get_rolespec_name</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../../include/nodes/parsenodes.h.html#LN324"><span class='Ref_to_Struct'>RoleSpec</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>role</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5212"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tp</span><span class='Delimiter'>; 
</span><a name="LN5213"></a>    <a href="../../../include/catalog/pg_authid.h.html#LN71"><span class='Ref_to_Typedef'>Form_pg_authid</span></a> <span class='Declare_Local'>authForm</span><span class='Delimiter'>; 
</span><a name="LN5214"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>rolename</span><span class='Delimiter'>; 
</span> 
    <a href="acl.c.html#LN5212"><span class='Ref_To_Local'>tp</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN238"><span class='Ref_to_Proto'>get_rolespec_tuple</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN5210"><span class='Ref_to_Parameter'>role</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN5213"><span class='Ref_To_Local'>authForm</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_authid.h.html#LN71"><span class='Ref_to_Typedef'>Form_pg_authid</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN5212"><span class='Ref_To_Local'>tp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="acl.c.html#LN5214"><span class='Ref_To_Local'>rolename</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN5213"><span class='Ref_To_Local'>authForm</span></a><span class='Operator'>-&GT;</span>rolname<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN5212"><span class='Ref_To_Local'>tp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="acl.c.html#LN5214"><span class='Ref_To_Local'>rolename</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Given a RoleSpec, throw an error if the name is reserved, using detail_msg, 
 * if provided. 
 * 
 * If node is NULL, no error is thrown.  If detail_msg is NULL then no detail 
 * message is provided. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN5232"></a><span class='Declare_Function'>check_rolespec_name</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../../include/nodes/parsenodes.h.html#LN324"><span class='Ref_to_Struct'>RoleSpec</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>role</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>detail_msg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="acl.c.html#LN5232"><span class='Ref_to_Parameter'>role</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN5232"><span class='Ref_to_Parameter'>role</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN327"><span class='Ref_to_Member'>roletype</span></a> <span class='Operator'>!= </span><a href="../../../include/nodes/parsenodes.h.html#LN318"><span class='Ref_to_EnumConst'>ROLESPEC_CSTRING</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/catalog/catalog.h.html#LN40"><span class='Ref_to_Proto'>IsReservedName</span></a><span class='Parentheses'>(</span><a href="acl.c.html#LN5232"><span class='Ref_to_Parameter'>role</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN328"><span class='Ref_to_Member'>rolename</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="acl.c.html#LN5232"><span class='Ref_to_Parameter'>detail_msg</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_RESERVED_NAME<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"role name \"%s\" is reserved"</span><span class='Delimiter'>, 
</span>                            <a href="acl.c.html#LN5232"><span class='Ref_to_Parameter'>role</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN328"><span class='Ref_to_Member'>rolename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"%s"</span><span class='Delimiter'>, </span><a href="acl.c.html#LN5232"><span class='Ref_to_Parameter'>detail_msg</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_RESERVED_NAME<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"role name \"%s\" is reserved"</span><span class='Delimiter'>, 
</span>                            <a href="acl.c.html#LN5232"><span class='Ref_to_Parameter'>role</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN328"><span class='Ref_to_Member'>rolename</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end check_rolespec_name &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>