<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\utils\adt\array_expanded.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\utils\adt\array_expanded.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:50 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * array_expanded.c 
 *    Basic functions for manipulating expanded arrays. 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/utils/adt/array_expanded.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/tupmacs.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/array.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/memutils.h"</span> 
 
 
<span class='Comment_Multi_Line'>/* "Methods" required for an expanded object */ 
</span><a name="LN23"></a><span class='Keyword'>static </span><a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Declare_Prototype'>EA_get_flat_size</span><span class='Parentheses'>(</span><a href="../../../include/utils/expandeddatum.h.html#LN97"><span class='Ref_to_Struct'>ExpandedObjectHeader</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>eohptr</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN24"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>EA_flatten_into</span><span class='Parentheses'>(</span><a href="../../../include/utils/expandeddatum.h.html#LN97"><span class='Ref_to_Struct'>ExpandedObjectHeader</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>eohptr</span><span class='Delimiter'>, 
</span><a name="LN25"></a>                <span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>result</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Declare_Parameter'>allocated_size</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN27"></a><span class='Keyword'>static const </span><a href="../../../include/utils/expandeddatum.h.html#LN71"><span class='Ref_to_Struct'>ExpandedObjectMethods</span></a> <span class='Declare_Var'>EA_methods</span> <span class='Operator'>= 
</span><span class='Delimiter'>{ 
</span>    <a href="array_expanded.c.html#LN23"><span class='Ref_to_Proto'>EA_get_flat_size</span></a><span class='Delimiter'>, 
</span>    <a href="array_expanded.c.html#LN24"><span class='Ref_to_Proto'>EA_flatten_into</span></a> 
<span class='Delimiter'>}; 
</span> 
<span class='Comment_Multi_Line'>/* Other local functions */ 
</span><a name="LN34"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>copy_byval_expanded_array</span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN98"><span class='Ref_to_Struct'>ExpandedArrayHeader</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>eah</span><span class='Delimiter'>, 
</span><a name="LN35"></a>                          <a href="../../../include/utils/array.h.html#LN98"><span class='Ref_to_Struct'>ExpandedArrayHeader</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>oldeah</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * expand_array: convert an array Datum into an expanded array 
 * 
 * The expanded object will be a child of parentcontext. 
 * 
 * Some callers can provide cache space to avoid repeated lookups of element 
 * type data across calls; if so, pass a metacache pointer, making sure that 
 * metacache-&GT;element_type is initialized to InvalidOid before first call. 
 * If no cross-call caching is required, pass NULL for metacache. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN49"></a><span class='Declare_Function'>expand_array</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>arraydatum</span><span class='Delimiter'>, </span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>parentcontext</span><span class='Delimiter'>, 
</span><a name="LN50"></a>             <a href="../../../include/utils/array.h.html#LN216"><span class='Ref_to_Struct'>ArrayMetaState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>metacache</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN52"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>array</span><span class='Delimiter'>; 
</span><a name="LN53"></a>    <a href="../../../include/utils/array.h.html#LN98"><span class='Ref_to_Struct'>ExpandedArrayHeader</span></a> <span class='Operator'>*</span><span class='Declare_Local'>eah</span><span class='Delimiter'>; 
</span><a name="LN54"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>objcxt</span><span class='Delimiter'>; 
</span><a name="LN55"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span><a name="LN56"></a>    <a href="../../../include/utils/array.h.html#LN216"><span class='Ref_to_Struct'>ArrayMetaState</span></a> <span class='Declare_Local'>fakecache</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Allocate private context for expanded object.  We start by assuming 
     * that the array won't be very large; but if it does grow a lot, don't 
     * constrain aset.c's large-context behavior. 
     */ 
</span>    <a href="array_expanded.c.html#LN54"><span class='Ref_To_Local'>objcxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN49"><span class='Ref_to_Parameter'>parentcontext</span></a><span class='Delimiter'>, 
</span>                                   <span class='String'>"expanded array"</span><span class='Delimiter'>, 
</span>                                   <a href="../../../include/utils/memutils.h.html#LN181"><span class='Ref_to_Const'>ALLOCSET_START_SMALL_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Set up expanded array header */ 
</span>    <a href="array_expanded.c.html#LN53"><span class='Ref_To_Local'>eah</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN98"><span class='Ref_to_Struct'>ExpandedArrayHeader</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN54"><span class='Ref_To_Local'>objcxt</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN98"><span class='Ref_to_Struct'>ExpandedArrayHeader</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="expandeddatum.c.html#LN46"><span class='Ref_to_Func'>EOH_init_header</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="array_expanded.c.html#LN53"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN101"><span class='Ref_to_Member'>hdr</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="array_expanded.c.html#LN27"><span class='Ref_to_Global_Var'>EA_methods</span></a><span class='Delimiter'>, </span><a href="array_expanded.c.html#LN54"><span class='Ref_To_Local'>objcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="array_expanded.c.html#LN53"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN104"><span class='Ref_to_Member'>ea_magic</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN96"><span class='Ref_to_Const'>EA_MAGIC</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If the source is an expanded array, we may be able to optimize */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN322"><span class='Ref_to_Macro'>VARATT_IS_EXTERNAL_EXPANDED</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN49"><span class='Ref_to_Parameter'>arraydatum</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN77"></a>        <a href="../../../include/utils/array.h.html#LN98"><span class='Ref_to_Struct'>ExpandedArrayHeader</span></a> <span class='Operator'>*</span><span class='Declare_Local'>oldeah</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN98"><span class='Ref_to_Struct'>ExpandedArrayHeader</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="expandeddatum.c.html#LN27"><span class='Ref_to_Func'>DatumGetEOHP</span></a><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN49"><span class='Ref_to_Parameter'>arraydatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN77"><span class='Ref_To_Local'>oldeah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN104"><span class='Ref_to_Member'>ea_magic</span></a> <span class='Operator'>== </span><a href="../../../include/utils/array.h.html#LN96"><span class='Ref_to_Const'>EA_MAGIC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Update caller's cache if provided; we don't need it this time, but 
         * next call might be for a non-expanded source array.  Furthermore, 
         * if the caller didn't provide a cache area, use some local storage 
         * to cache anyway, thereby avoiding a catalog lookup in the case 
         * where we fall through to the flat-copy code path. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_expanded.c.html#LN50"><span class='Ref_to_Parameter'>metacache</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="array_expanded.c.html#LN50"><span class='Ref_to_Parameter'>metacache</span></a> <span class='Operator'>= &</span><a href="array_expanded.c.html#LN56"><span class='Ref_To_Local'>fakecache</span></a><span class='Delimiter'>; 
</span>        <a href="array_expanded.c.html#LN50"><span class='Ref_to_Parameter'>metacache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN218"><span class='Ref_to_Member'>element_type</span></a> <span class='Operator'>= </span><a href="array_expanded.c.html#LN77"><span class='Ref_To_Local'>oldeah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN112"><span class='Ref_to_Member'>element_type</span></a><span class='Delimiter'>; 
</span>        <a href="array_expanded.c.html#LN50"><span class='Ref_to_Parameter'>metacache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN219"><span class='Ref_to_Member'>typlen</span></a> <span class='Operator'>= </span><a href="array_expanded.c.html#LN77"><span class='Ref_To_Local'>oldeah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN113"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>; 
</span>        <a href="array_expanded.c.html#LN50"><span class='Ref_to_Parameter'>metacache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN220"><span class='Ref_to_Member'>typbyval</span></a> <span class='Operator'>= </span><a href="array_expanded.c.html#LN77"><span class='Ref_To_Local'>oldeah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN114"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>; 
</span>        <a href="array_expanded.c.html#LN50"><span class='Ref_to_Parameter'>metacache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN221"><span class='Ref_to_Member'>typalign</span></a> <span class='Operator'>= </span><a href="array_expanded.c.html#LN77"><span class='Ref_To_Local'>oldeah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN115"><span class='Ref_to_Member'>typalign</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If element type is pass-by-value and we have a Datum-array 
         * representation, just copy the source's metadata and Datum/isnull 
         * arrays.  The original flat array, if present at all, adds no 
         * additional information so we need not copy it. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_expanded.c.html#LN77"><span class='Ref_To_Local'>oldeah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN114"><span class='Ref_to_Member'>typbyval</span></a> <span class='Operator'>&& </span><a href="array_expanded.c.html#LN77"><span class='Ref_To_Local'>oldeah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN129"><span class='Ref_to_Member'>dvalues</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="array_expanded.c.html#LN34"><span class='Ref_to_Proto'>copy_byval_expanded_array</span></a><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN53"><span class='Ref_To_Local'>eah</span></a><span class='Delimiter'>, </span><a href="array_expanded.c.html#LN77"><span class='Ref_To_Local'>oldeah</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* return a R/W pointer to the expanded array */ 
</span>            <span class='Control'>return</span> <a href="../../../include/utils/expandeddatum.h.html#LN135"><span class='Ref_to_Macro'>EOHPGetRWDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="array_expanded.c.html#LN53"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN101"><span class='Ref_to_Member'>hdr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Otherwise, either we have only a flat representation or the 
         * elements are pass-by-reference.  In either case, the best thing 
         * seems to be to copy the source as a flat representation and then 
         * deconstruct that later if necessary.  For the pass-by-ref case, we 
         * could perhaps save some cycles with custom code that generates the 
         * deconstructed representation in parallel with copying the values, 
         * but it would be a lot of extra code for fairly marginal gain.  So, 
         * fall through into the flat-source code path. 
         */ 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if VARATT_IS_EXTERNAL_EX... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Detoast and copy source array into private context, as a flat array. 
     * 
     * Note that this coding risks leaking some memory in the private context 
     * if we have to fetch data from a TOAST table; however, experimentation 
     * says that the leak is minimal.  Doing it this way saves a copy step, 
     * which seems worthwhile, especially if the array is large enough to need 
     * external storage. 
     */ 
</span>    <a href="array_expanded.c.html#LN55"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN54"><span class='Ref_To_Local'>objcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="array_expanded.c.html#LN52"><span class='Ref_To_Local'>array</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN242"><span class='Ref_to_Macro'>DatumGetArrayTypePCopy</span></a><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN49"><span class='Ref_to_Parameter'>arraydatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN55"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="array_expanded.c.html#LN53"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN107"><span class='Ref_to_Member'>ndims</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN52"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* note these pointers point into the fvalue header! */ 
</span>    <a href="array_expanded.c.html#LN53"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN108"><span class='Ref_to_Member'>dims</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN52"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="array_expanded.c.html#LN53"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN109"><span class='Ref_to_Member'>lbound</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN276"><span class='Ref_to_Macro'>ARR_LBOUND</span></a><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN52"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Save array's element-type data for possible use later */ 
</span>    <a href="array_expanded.c.html#LN53"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN112"><span class='Ref_to_Member'>element_type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN272"><span class='Ref_to_Macro'>ARR_ELEMTYPE</span></a><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN52"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_expanded.c.html#LN50"><span class='Ref_to_Parameter'>metacache</span></a> <span class='Operator'>&& </span><a href="array_expanded.c.html#LN50"><span class='Ref_to_Parameter'>metacache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN218"><span class='Ref_to_Member'>element_type</span></a> <span class='Operator'>== </span><a href="array_expanded.c.html#LN53"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN112"><span class='Ref_to_Member'>element_type</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* We have a valid cache of representational data */ 
</span>        <a href="array_expanded.c.html#LN53"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN113"><span class='Ref_to_Member'>typlen</span></a> <span class='Operator'>= </span><a href="array_expanded.c.html#LN50"><span class='Ref_to_Parameter'>metacache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN219"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>; 
</span>        <a href="array_expanded.c.html#LN53"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN114"><span class='Ref_to_Member'>typbyval</span></a> <span class='Operator'>= </span><a href="array_expanded.c.html#LN50"><span class='Ref_to_Parameter'>metacache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN220"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>; 
</span>        <a href="array_expanded.c.html#LN53"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN115"><span class='Ref_to_Member'>typalign</span></a> <span class='Operator'>= </span><a href="array_expanded.c.html#LN50"><span class='Ref_to_Parameter'>metacache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN221"><span class='Ref_to_Member'>typalign</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* No, so look it up */ 
</span>        <a href="../../../include/utils/lsyscache.h.html#LN136"><span class='Ref_to_Proto'>get_typlenbyvalalign</span></a><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN53"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN112"><span class='Ref_to_Member'>element_type</span></a><span class='Delimiter'>, 
</span>                             <span class='Operator'>&</span><a href="array_expanded.c.html#LN53"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN113"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>, 
</span>                             <span class='Operator'>&</span><a href="array_expanded.c.html#LN53"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN114"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>, 
</span>                             <span class='Operator'>&</span><a href="array_expanded.c.html#LN53"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN115"><span class='Ref_to_Member'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Update cache if provided */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_expanded.c.html#LN50"><span class='Ref_to_Parameter'>metacache</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="array_expanded.c.html#LN50"><span class='Ref_to_Parameter'>metacache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN218"><span class='Ref_to_Member'>element_type</span></a> <span class='Operator'>= </span><a href="array_expanded.c.html#LN53"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN112"><span class='Ref_to_Member'>element_type</span></a><span class='Delimiter'>; 
</span>            <a href="array_expanded.c.html#LN50"><span class='Ref_to_Parameter'>metacache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN219"><span class='Ref_to_Member'>typlen</span></a> <span class='Operator'>= </span><a href="array_expanded.c.html#LN53"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN113"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>; 
</span>            <a href="array_expanded.c.html#LN50"><span class='Ref_to_Parameter'>metacache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN220"><span class='Ref_to_Member'>typbyval</span></a> <span class='Operator'>= </span><a href="array_expanded.c.html#LN53"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN114"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>; 
</span>            <a href="array_expanded.c.html#LN50"><span class='Ref_to_Parameter'>metacache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN221"><span class='Ref_to_Member'>typalign</span></a> <span class='Operator'>= </span><a href="array_expanded.c.html#LN53"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN115"><span class='Ref_to_Member'>typalign</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* we don't make a deconstructed representation now */ 
</span>    <a href="array_expanded.c.html#LN53"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN129"><span class='Ref_to_Member'>dvalues</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="array_expanded.c.html#LN53"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN130"><span class='Ref_to_Member'>dnulls</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="array_expanded.c.html#LN53"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN131"><span class='Ref_to_Member'>dvalueslen</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="array_expanded.c.html#LN53"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN132"><span class='Ref_to_Member'>nelems</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="array_expanded.c.html#LN53"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN139"><span class='Ref_to_Member'>flat_size</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* remember we have a flat representation */ 
</span>    <a href="array_expanded.c.html#LN53"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN148"><span class='Ref_to_Member'>fvalue</span></a> <span class='Operator'>= </span><a href="array_expanded.c.html#LN52"><span class='Ref_To_Local'>array</span></a><span class='Delimiter'>; 
</span>    <a href="array_expanded.c.html#LN53"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN149"><span class='Ref_to_Member'>fstartptr</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN302"><span class='Ref_to_Macro'>ARR_DATA_PTR</span></a><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN52"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="array_expanded.c.html#LN53"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN150"><span class='Ref_to_Member'>fendptr</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="array_expanded.c.html#LN52"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span> <span class='Operator'>+ </span><a href="../../../include/utils/array.h.html#LN269"><span class='Ref_to_Macro'>ARR_SIZE</span></a><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN52"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* return a R/W pointer to the expanded array */ 
</span>    <span class='Control'>return</span> <a href="../../../include/utils/expandeddatum.h.html#LN135"><span class='Ref_to_Macro'>EOHPGetRWDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="array_expanded.c.html#LN53"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN101"><span class='Ref_to_Member'>hdr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end expand_array &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * helper for expand_array(): copy pass-by-value Datum-array representation 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN184"></a><span class='Declare_Function'>copy_byval_expanded_array</span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN98"><span class='Ref_to_Struct'>ExpandedArrayHeader</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>eah</span><span class='Delimiter'>, 
</span><a name="LN185"></a>                          <a href="../../../include/utils/array.h.html#LN98"><span class='Ref_to_Struct'>ExpandedArrayHeader</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>oldeah</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN187"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>objcxt</span> <span class='Operator'>= </span><a href="array_expanded.c.html#LN184"><span class='Ref_to_Parameter'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN101"><span class='Ref_to_Member'>hdr</span></a><span class='Operator'>.</span><a href="../../../include/utils/expandeddatum.h.html#LN106"><span class='Ref_to_Member'>eoh_context</span></a><span class='Delimiter'>; 
</span><a name="LN188"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ndims</span> <span class='Operator'>= </span><a href="array_expanded.c.html#LN185"><span class='Ref_to_Parameter'>oldeah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN107"><span class='Ref_to_Member'>ndims</span></a><span class='Delimiter'>; 
</span><a name="LN189"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>dvalueslen</span> <span class='Operator'>= </span><a href="array_expanded.c.html#LN185"><span class='Ref_to_Parameter'>oldeah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN131"><span class='Ref_to_Member'>dvalueslen</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Copy array dimensionality information */ 
</span>    <a href="array_expanded.c.html#LN184"><span class='Ref_to_Parameter'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN107"><span class='Ref_to_Member'>ndims</span></a> <span class='Operator'>= </span><a href="array_expanded.c.html#LN188"><span class='Ref_To_Local'>ndims</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* We can alloc both dimensionality arrays with one palloc */ 
</span>    <a href="array_expanded.c.html#LN184"><span class='Ref_to_Parameter'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN108"><span class='Ref_to_Member'>dims</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN187"><span class='Ref_To_Local'>objcxt</span></a><span class='Delimiter'>, </span><a href="array_expanded.c.html#LN188"><span class='Ref_To_Local'>ndims</span></a> <span class='Operator'>* </span><span class='Number'>2</span> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="array_expanded.c.html#LN184"><span class='Ref_to_Parameter'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN109"><span class='Ref_to_Member'>lbound</span></a> <span class='Operator'>= </span><a href="array_expanded.c.html#LN184"><span class='Ref_to_Parameter'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN108"><span class='Ref_to_Member'>dims</span></a> <span class='Operator'>+ </span><a href="array_expanded.c.html#LN188"><span class='Ref_To_Local'>ndims</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* .. but don't assume the source's arrays are contiguous */ 
</span>    memcpy<span class='Parentheses'>(</span><a href="array_expanded.c.html#LN184"><span class='Ref_to_Parameter'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN108"><span class='Ref_to_Member'>dims</span></a><span class='Delimiter'>, </span><a href="array_expanded.c.html#LN185"><span class='Ref_to_Parameter'>oldeah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN108"><span class='Ref_to_Member'>dims</span></a><span class='Delimiter'>, </span><a href="array_expanded.c.html#LN188"><span class='Ref_To_Local'>ndims</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="array_expanded.c.html#LN184"><span class='Ref_to_Parameter'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN109"><span class='Ref_to_Member'>lbound</span></a><span class='Delimiter'>, </span><a href="array_expanded.c.html#LN185"><span class='Ref_to_Parameter'>oldeah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN109"><span class='Ref_to_Member'>lbound</span></a><span class='Delimiter'>, </span><a href="array_expanded.c.html#LN188"><span class='Ref_To_Local'>ndims</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Copy element-type data */ 
</span>    <a href="array_expanded.c.html#LN184"><span class='Ref_to_Parameter'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN112"><span class='Ref_to_Member'>element_type</span></a> <span class='Operator'>= </span><a href="array_expanded.c.html#LN185"><span class='Ref_to_Parameter'>oldeah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN112"><span class='Ref_to_Member'>element_type</span></a><span class='Delimiter'>; 
</span>    <a href="array_expanded.c.html#LN184"><span class='Ref_to_Parameter'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN113"><span class='Ref_to_Member'>typlen</span></a> <span class='Operator'>= </span><a href="array_expanded.c.html#LN185"><span class='Ref_to_Parameter'>oldeah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN113"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>; 
</span>    <a href="array_expanded.c.html#LN184"><span class='Ref_to_Parameter'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN114"><span class='Ref_to_Member'>typbyval</span></a> <span class='Operator'>= </span><a href="array_expanded.c.html#LN185"><span class='Ref_to_Parameter'>oldeah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN114"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>; 
</span>    <a href="array_expanded.c.html#LN184"><span class='Ref_to_Parameter'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN115"><span class='Ref_to_Member'>typalign</span></a> <span class='Operator'>= </span><a href="array_expanded.c.html#LN185"><span class='Ref_to_Parameter'>oldeah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN115"><span class='Ref_to_Member'>typalign</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Copy the deconstructed representation */ 
</span>    <a href="array_expanded.c.html#LN184"><span class='Ref_to_Parameter'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN129"><span class='Ref_to_Member'>dvalues</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN187"><span class='Ref_To_Local'>objcxt</span></a><span class='Delimiter'>, 
</span>                                                <a href="array_expanded.c.html#LN189"><span class='Ref_To_Local'>dvalueslen</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="array_expanded.c.html#LN184"><span class='Ref_to_Parameter'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN129"><span class='Ref_to_Member'>dvalues</span></a><span class='Delimiter'>, </span><a href="array_expanded.c.html#LN185"><span class='Ref_to_Parameter'>oldeah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN129"><span class='Ref_to_Member'>dvalues</span></a><span class='Delimiter'>, </span><a href="array_expanded.c.html#LN189"><span class='Ref_To_Local'>dvalueslen</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_expanded.c.html#LN185"><span class='Ref_to_Parameter'>oldeah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN130"><span class='Ref_to_Member'>dnulls</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="array_expanded.c.html#LN184"><span class='Ref_to_Parameter'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN130"><span class='Ref_to_Member'>dnulls</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN187"><span class='Ref_To_Local'>objcxt</span></a><span class='Delimiter'>, 
</span>                                                  <a href="array_expanded.c.html#LN189"><span class='Ref_To_Local'>dvalueslen</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><a href="array_expanded.c.html#LN184"><span class='Ref_to_Parameter'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN130"><span class='Ref_to_Member'>dnulls</span></a><span class='Delimiter'>, </span><a href="array_expanded.c.html#LN185"><span class='Ref_to_Parameter'>oldeah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN130"><span class='Ref_to_Member'>dnulls</span></a><span class='Delimiter'>, </span><a href="array_expanded.c.html#LN189"><span class='Ref_To_Local'>dvalueslen</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="array_expanded.c.html#LN184"><span class='Ref_to_Parameter'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN130"><span class='Ref_to_Member'>dnulls</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="array_expanded.c.html#LN184"><span class='Ref_to_Parameter'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN131"><span class='Ref_to_Member'>dvalueslen</span></a> <span class='Operator'>= </span><a href="array_expanded.c.html#LN189"><span class='Ref_To_Local'>dvalueslen</span></a><span class='Delimiter'>; 
</span>    <a href="array_expanded.c.html#LN184"><span class='Ref_to_Parameter'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN132"><span class='Ref_to_Member'>nelems</span></a> <span class='Operator'>= </span><a href="array_expanded.c.html#LN185"><span class='Ref_to_Parameter'>oldeah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN132"><span class='Ref_to_Member'>nelems</span></a><span class='Delimiter'>; 
</span>    <a href="array_expanded.c.html#LN184"><span class='Ref_to_Parameter'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN139"><span class='Ref_to_Member'>flat_size</span></a> <span class='Operator'>= </span><a href="array_expanded.c.html#LN185"><span class='Ref_to_Parameter'>oldeah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN139"><span class='Ref_to_Member'>flat_size</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* we don't make a flat representation */ 
</span>    <a href="array_expanded.c.html#LN184"><span class='Ref_to_Parameter'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN148"><span class='Ref_to_Member'>fvalue</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="array_expanded.c.html#LN184"><span class='Ref_to_Parameter'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN149"><span class='Ref_to_Member'>fstartptr</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="array_expanded.c.html#LN184"><span class='Ref_to_Parameter'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN150"><span class='Ref_to_Member'>fendptr</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end copy_byval_expanded_array &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * get_flat_size method for expanded arrays 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> 
<a name="LN232"></a><span class='Declare_Function'>EA_get_flat_size</span><span class='Parentheses'>(</span><a href="../../../include/utils/expandeddatum.h.html#LN97"><span class='Ref_to_Struct'>ExpandedObjectHeader</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>eohptr</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN234"></a>    <a href="../../../include/utils/array.h.html#LN98"><span class='Ref_to_Struct'>ExpandedArrayHeader</span></a> <span class='Operator'>*</span><span class='Declare_Local'>eah</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN98"><span class='Ref_to_Struct'>ExpandedArrayHeader</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="array_expanded.c.html#LN232"><span class='Ref_to_Parameter'>eohptr</span></a><span class='Delimiter'>; 
</span><a name="LN235"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nelems</span><span class='Delimiter'>; 
</span><a name="LN236"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ndims</span><span class='Delimiter'>; 
</span><a name="LN237"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>dvalues</span><span class='Delimiter'>; 
</span><a name="LN238"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>dnulls</span><span class='Delimiter'>; 
</span><a name="LN239"></a>    <a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>nbytes</span><span class='Delimiter'>; 
</span><a name="LN240"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN234"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN104"><span class='Ref_to_Member'>ea_magic</span></a> <span class='Operator'>== </span><a href="../../../include/utils/array.h.html#LN96"><span class='Ref_to_Const'>EA_MAGIC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Easy if we have a valid flattened value */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_expanded.c.html#LN234"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN148"><span class='Ref_to_Member'>fvalue</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../../include/utils/array.h.html#LN269"><span class='Ref_to_Macro'>ARR_SIZE</span></a><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN234"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN148"><span class='Ref_to_Member'>fvalue</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If we have a cached size value, believe that */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_expanded.c.html#LN234"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN139"><span class='Ref_to_Member'>flat_size</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="array_expanded.c.html#LN234"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN139"><span class='Ref_to_Member'>flat_size</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Compute space needed by examining dvalues/dnulls.  Note that the result 
     * array will have a nulls bitmap if dnulls isn't NULL, even if the array 
     * doesn't actually contain any nulls now. 
     */ 
</span>    <a href="array_expanded.c.html#LN235"><span class='Ref_To_Local'>nelems</span></a> <span class='Operator'>= </span><a href="array_expanded.c.html#LN234"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN132"><span class='Ref_to_Member'>nelems</span></a><span class='Delimiter'>; 
</span>    <a href="array_expanded.c.html#LN236"><span class='Ref_To_Local'>ndims</span></a> <span class='Operator'>= </span><a href="array_expanded.c.html#LN234"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN107"><span class='Ref_to_Member'>ndims</span></a><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN235"><span class='Ref_To_Local'>nelems</span></a> <span class='Operator'>== </span><a href="arrayutils.c.html#LN73"><span class='Ref_to_Func'>ArrayGetNItems</span></a><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN236"><span class='Ref_To_Local'>ndims</span></a><span class='Delimiter'>, </span><a href="array_expanded.c.html#LN234"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN108"><span class='Ref_to_Member'>dims</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="array_expanded.c.html#LN237"><span class='Ref_To_Local'>dvalues</span></a> <span class='Operator'>= </span><a href="array_expanded.c.html#LN234"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN129"><span class='Ref_to_Member'>dvalues</span></a><span class='Delimiter'>; 
</span>    <a href="array_expanded.c.html#LN238"><span class='Ref_To_Local'>dnulls</span></a> <span class='Operator'>= </span><a href="array_expanded.c.html#LN234"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN130"><span class='Ref_to_Member'>dnulls</span></a><span class='Delimiter'>; 
</span>    <a href="array_expanded.c.html#LN239"><span class='Ref_To_Local'>nbytes</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="array_expanded.c.html#LN240"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="array_expanded.c.html#LN240"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="array_expanded.c.html#LN235"><span class='Ref_To_Local'>nelems</span></a><span class='Delimiter'>; </span><a href="array_expanded.c.html#LN240"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_expanded.c.html#LN238"><span class='Ref_To_Local'>dnulls</span></a> <span class='Operator'>&& </span><a href="array_expanded.c.html#LN238"><span class='Ref_To_Local'>dnulls</span></a><span class='Delimiter'>[</span><a href="array_expanded.c.html#LN240"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <a href="array_expanded.c.html#LN239"><span class='Ref_To_Local'>nbytes</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN159"><span class='Ref_to_Macro'>att_addlength_datum</span></a><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN239"><span class='Ref_To_Local'>nbytes</span></a><span class='Delimiter'>, </span><a href="array_expanded.c.html#LN234"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN113"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>, </span><a href="array_expanded.c.html#LN237"><span class='Ref_To_Local'>dvalues</span></a><span class='Delimiter'>[</span><a href="array_expanded.c.html#LN240"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="array_expanded.c.html#LN239"><span class='Ref_To_Local'>nbytes</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN143"><span class='Ref_to_Macro'>att_align_nominal</span></a><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN239"><span class='Ref_To_Local'>nbytes</span></a><span class='Delimiter'>, </span><a href="array_expanded.c.html#LN234"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN115"><span class='Ref_to_Member'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* check for overflow of total request */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/memutils.h.html#LN41"><span class='Ref_to_Macro'>AllocSizeIsValid</span></a><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN239"><span class='Ref_To_Local'>nbytes</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_PROGRAM_LIMIT_EXCEEDED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"array size exceeds the maximum allowed (%d)"</span><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="../../../common/psprintf.c.html#LN27"><span class='Ref_to_Const'>MaxAllocSize</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_expanded.c.html#LN238"><span class='Ref_To_Local'>dnulls</span></a><span class='Parentheses'>) 
</span>        <a href="array_expanded.c.html#LN239"><span class='Ref_To_Local'>nbytes</span></a> <span class='Operator'>+= </span><a href="../../../include/utils/array.h.html#LN292"><span class='Ref_to_Macro'>ARR_OVERHEAD_WITHNULLS</span></a><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN236"><span class='Ref_To_Local'>ndims</span></a><span class='Delimiter'>, </span><a href="array_expanded.c.html#LN235"><span class='Ref_To_Local'>nelems</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="array_expanded.c.html#LN239"><span class='Ref_To_Local'>nbytes</span></a> <span class='Operator'>+= </span><a href="../../../include/utils/array.h.html#LN290"><span class='Ref_to_Macro'>ARR_OVERHEAD_NONULLS</span></a><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN236"><span class='Ref_To_Local'>ndims</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* cache for next time */ 
</span>    <a href="array_expanded.c.html#LN234"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN139"><span class='Ref_to_Member'>flat_size</span></a> <span class='Operator'>= </span><a href="array_expanded.c.html#LN239"><span class='Ref_To_Local'>nbytes</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="array_expanded.c.html#LN239"><span class='Ref_To_Local'>nbytes</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end EA_get_flat_size &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * flatten_into method for expanded arrays 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN292"></a><span class='Declare_Function'>EA_flatten_into</span><span class='Parentheses'>(</span><a href="../../../include/utils/expandeddatum.h.html#LN97"><span class='Ref_to_Struct'>ExpandedObjectHeader</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>eohptr</span><span class='Delimiter'>, 
</span><a name="LN293"></a>                <span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>result</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Declare_Parameter'>allocated_size</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN295"></a>    <a href="../../../include/utils/array.h.html#LN98"><span class='Ref_to_Struct'>ExpandedArrayHeader</span></a> <span class='Operator'>*</span><span class='Declare_Local'>eah</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN98"><span class='Ref_to_Struct'>ExpandedArrayHeader</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="array_expanded.c.html#LN292"><span class='Ref_to_Parameter'>eohptr</span></a><span class='Delimiter'>; 
</span><a name="LN296"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>aresult</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="array_expanded.c.html#LN293"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>; 
</span><a name="LN297"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nelems</span><span class='Delimiter'>; 
</span><a name="LN298"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ndims</span><span class='Delimiter'>; 
</span><a name="LN299"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>dataoffset</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN295"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN104"><span class='Ref_to_Member'>ea_magic</span></a> <span class='Operator'>== </span><a href="../../../include/utils/array.h.html#LN96"><span class='Ref_to_Const'>EA_MAGIC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Easy if we have a valid flattened value */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_expanded.c.html#LN295"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN148"><span class='Ref_to_Member'>fvalue</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN293"><span class='Ref_to_Parameter'>allocated_size</span></a> <span class='Operator'>== </span><a href="../../../include/utils/array.h.html#LN269"><span class='Ref_to_Macro'>ARR_SIZE</span></a><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN295"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN148"><span class='Ref_to_Member'>fvalue</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><a href="array_expanded.c.html#LN293"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><a href="array_expanded.c.html#LN295"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN148"><span class='Ref_to_Member'>fvalue</span></a><span class='Delimiter'>, </span><a href="array_expanded.c.html#LN293"><span class='Ref_to_Parameter'>allocated_size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Else allocation should match previous get_flat_size result */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN293"><span class='Ref_to_Parameter'>allocated_size</span></a> <span class='Operator'>== </span><a href="array_expanded.c.html#LN295"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN139"><span class='Ref_to_Member'>flat_size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Fill result array from dvalues/dnulls */ 
</span>    <a href="array_expanded.c.html#LN297"><span class='Ref_To_Local'>nelems</span></a> <span class='Operator'>= </span><a href="array_expanded.c.html#LN295"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN132"><span class='Ref_to_Member'>nelems</span></a><span class='Delimiter'>; 
</span>    <a href="array_expanded.c.html#LN298"><span class='Ref_To_Local'>ndims</span></a> <span class='Operator'>= </span><a href="array_expanded.c.html#LN295"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN107"><span class='Ref_to_Member'>ndims</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_expanded.c.html#LN295"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN130"><span class='Ref_to_Member'>dnulls</span></a><span class='Parentheses'>) 
</span>        <a href="array_expanded.c.html#LN299"><span class='Ref_To_Local'>dataoffset</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN292"><span class='Ref_to_Macro'>ARR_OVERHEAD_WITHNULLS</span></a><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN298"><span class='Ref_To_Local'>ndims</span></a><span class='Delimiter'>, </span><a href="array_expanded.c.html#LN297"><span class='Ref_To_Local'>nelems</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="array_expanded.c.html#LN299"><span class='Ref_To_Local'>dataoffset</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* marker for no null bitmap */ 
</span> 
    <span class='Comment_Multi_Line'>/* We must ensure that any pad space is zero-filled */ 
</span>    memset<span class='Parentheses'>(</span><a href="array_expanded.c.html#LN296"><span class='Ref_To_Local'>aresult</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="array_expanded.c.html#LN293"><span class='Ref_to_Parameter'>allocated_size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN296"><span class='Ref_To_Local'>aresult</span></a><span class='Delimiter'>, </span><a href="array_expanded.c.html#LN293"><span class='Ref_to_Parameter'>allocated_size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="array_expanded.c.html#LN296"><span class='Ref_To_Local'>aresult</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN78"><span class='Ref_to_Member'>ndim</span></a> <span class='Operator'>= </span><a href="array_expanded.c.html#LN298"><span class='Ref_To_Local'>ndims</span></a><span class='Delimiter'>; 
</span>    <a href="array_expanded.c.html#LN296"><span class='Ref_To_Local'>aresult</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN79"><span class='Ref_to_Member'>dataoffset</span></a> <span class='Operator'>= </span><a href="array_expanded.c.html#LN299"><span class='Ref_To_Local'>dataoffset</span></a><span class='Delimiter'>; 
</span>    <a href="array_expanded.c.html#LN296"><span class='Ref_To_Local'>aresult</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN80"><span class='Ref_to_Member'>elemtype</span></a> <span class='Operator'>= </span><a href="array_expanded.c.html#LN295"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN112"><span class='Ref_to_Member'>element_type</span></a><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN296"><span class='Ref_To_Local'>aresult</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="array_expanded.c.html#LN295"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN108"><span class='Ref_to_Member'>dims</span></a><span class='Delimiter'>, </span><a href="array_expanded.c.html#LN298"><span class='Ref_To_Local'>ndims</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN276"><span class='Ref_to_Macro'>ARR_LBOUND</span></a><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN296"><span class='Ref_To_Local'>aresult</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="array_expanded.c.html#LN295"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN109"><span class='Ref_to_Member'>lbound</span></a><span class='Delimiter'>, </span><a href="array_expanded.c.html#LN298"><span class='Ref_To_Local'>ndims</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/array.h.html#LN330"><span class='Ref_to_Proto'>CopyArrayEls</span></a><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN296"><span class='Ref_To_Local'>aresult</span></a><span class='Delimiter'>, 
</span>                 <a href="array_expanded.c.html#LN295"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN129"><span class='Ref_to_Member'>dvalues</span></a><span class='Delimiter'>, </span><a href="array_expanded.c.html#LN295"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN130"><span class='Ref_to_Member'>dnulls</span></a><span class='Delimiter'>, </span><a href="array_expanded.c.html#LN297"><span class='Ref_To_Local'>nelems</span></a><span class='Delimiter'>, 
</span>                 <a href="array_expanded.c.html#LN295"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN113"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>, </span><a href="array_expanded.c.html#LN295"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN114"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>, </span><a href="array_expanded.c.html#LN295"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN115"><span class='Ref_to_Member'>typalign</span></a><span class='Delimiter'>, 
</span>                 <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end EA_flatten_into &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Argument fetching support code 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * DatumGetExpandedArray: get a writable expanded array from an input argument 
 * 
 * Caution: if the input is a read/write pointer, this returns the input 
 * argument; so callers must be sure that their changes are "safe", that is 
 * they cannot leave the array in a corrupt state. 
 */ 
</span><a href="../../../include/utils/array.h.html#LN98"><span class='Ref_to_Struct'>ExpandedArrayHeader</span></a> <span class='Operator'>* 
</span><a name="LN351"></a><span class='Declare_Function'>DatumGetExpandedArray</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>d</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* If it's a writable expanded array already, just return it */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN320"><span class='Ref_to_Macro'>VARATT_IS_EXTERNAL_EXPANDED_RW</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN351"><span class='Ref_to_Parameter'>d</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN356"></a>        <a href="../../../include/utils/array.h.html#LN98"><span class='Ref_to_Struct'>ExpandedArrayHeader</span></a> <span class='Operator'>*</span><span class='Declare_Local'>eah</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN98"><span class='Ref_to_Struct'>ExpandedArrayHeader</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="expandeddatum.c.html#LN27"><span class='Ref_to_Func'>DatumGetEOHP</span></a><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN351"><span class='Ref_to_Parameter'>d</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN356"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN104"><span class='Ref_to_Member'>ea_magic</span></a> <span class='Operator'>== </span><a href="../../../include/utils/array.h.html#LN96"><span class='Ref_to_Const'>EA_MAGIC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="array_expanded.c.html#LN356"><span class='Ref_To_Local'>eah</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Else expand the hard way */ 
</span>    <a href="array_expanded.c.html#LN351"><span class='Ref_to_Parameter'>d</span></a> <span class='Operator'>= </span><a href="array_expanded.c.html#LN48"><span class='Ref_to_Func'>expand_array</span></a><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN351"><span class='Ref_to_Parameter'>d</span></a><span class='Delimiter'>, </span><a href="../mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN98"><span class='Ref_to_Struct'>ExpandedArrayHeader</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="expandeddatum.c.html#LN27"><span class='Ref_to_Func'>DatumGetEOHP</span></a><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN351"><span class='Ref_to_Parameter'>d</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * As above, when caller has the ability to cache element type info 
 */ 
</span><a href="../../../include/utils/array.h.html#LN98"><span class='Ref_to_Struct'>ExpandedArrayHeader</span></a> <span class='Operator'>* 
</span><a name="LN371"></a><span class='Declare_Function'>DatumGetExpandedArrayX</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>d</span><span class='Delimiter'>, </span><a href="../../../include/utils/array.h.html#LN216"><span class='Ref_to_Struct'>ArrayMetaState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>metacache</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* If it's a writable expanded array already, just return it */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN320"><span class='Ref_to_Macro'>VARATT_IS_EXTERNAL_EXPANDED_RW</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN371"><span class='Ref_to_Parameter'>d</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN376"></a>        <a href="../../../include/utils/array.h.html#LN98"><span class='Ref_to_Struct'>ExpandedArrayHeader</span></a> <span class='Operator'>*</span><span class='Declare_Local'>eah</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN98"><span class='Ref_to_Struct'>ExpandedArrayHeader</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="expandeddatum.c.html#LN27"><span class='Ref_to_Func'>DatumGetEOHP</span></a><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN371"><span class='Ref_to_Parameter'>d</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN376"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN104"><span class='Ref_to_Member'>ea_magic</span></a> <span class='Operator'>== </span><a href="../../../include/utils/array.h.html#LN96"><span class='Ref_to_Const'>EA_MAGIC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Update cache if provided */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_expanded.c.html#LN371"><span class='Ref_to_Parameter'>metacache</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="array_expanded.c.html#LN371"><span class='Ref_to_Parameter'>metacache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN218"><span class='Ref_to_Member'>element_type</span></a> <span class='Operator'>= </span><a href="array_expanded.c.html#LN376"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN112"><span class='Ref_to_Member'>element_type</span></a><span class='Delimiter'>; 
</span>            <a href="array_expanded.c.html#LN371"><span class='Ref_to_Parameter'>metacache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN219"><span class='Ref_to_Member'>typlen</span></a> <span class='Operator'>= </span><a href="array_expanded.c.html#LN376"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN113"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>; 
</span>            <a href="array_expanded.c.html#LN371"><span class='Ref_to_Parameter'>metacache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN220"><span class='Ref_to_Member'>typbyval</span></a> <span class='Operator'>= </span><a href="array_expanded.c.html#LN376"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN114"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>; 
</span>            <a href="array_expanded.c.html#LN371"><span class='Ref_to_Parameter'>metacache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN221"><span class='Ref_to_Member'>typalign</span></a> <span class='Operator'>= </span><a href="array_expanded.c.html#LN376"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN115"><span class='Ref_to_Member'>typalign</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>return</span> <a href="array_expanded.c.html#LN376"><span class='Ref_To_Local'>eah</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Else expand using caller's cache if any */ 
</span>    <a href="array_expanded.c.html#LN371"><span class='Ref_to_Parameter'>d</span></a> <span class='Operator'>= </span><a href="array_expanded.c.html#LN48"><span class='Ref_to_Func'>expand_array</span></a><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN371"><span class='Ref_to_Parameter'>d</span></a><span class='Delimiter'>, </span><a href="../mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>, </span><a href="array_expanded.c.html#LN371"><span class='Ref_to_Parameter'>metacache</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN98"><span class='Ref_to_Struct'>ExpandedArrayHeader</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="expandeddatum.c.html#LN27"><span class='Ref_to_Func'>DatumGetEOHP</span></a><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN371"><span class='Ref_to_Parameter'>d</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end DatumGetExpandedArrayX &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * DatumGetAnyArray: return either an expanded array or a detoasted varlena 
 * array.  The result must not be modified in-place. 
 */ 
</span><a href="../../../include/utils/array.h.html#LN157"><span class='Ref_to_Union'>AnyArrayType</span></a> <span class='Operator'>* 
</span><a name="LN400"></a><span class='Declare_Function'>DatumGetAnyArray</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>d</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN402"></a>    <a href="../../../include/utils/array.h.html#LN98"><span class='Ref_to_Struct'>ExpandedArrayHeader</span></a> <span class='Operator'>*</span><span class='Declare_Local'>eah</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If it's an expanded array (RW or RO), return the header pointer. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN322"><span class='Ref_to_Macro'>VARATT_IS_EXTERNAL_EXPANDED</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN400"><span class='Ref_to_Parameter'>d</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="array_expanded.c.html#LN402"><span class='Ref_To_Local'>eah</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN98"><span class='Ref_to_Struct'>ExpandedArrayHeader</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="expandeddatum.c.html#LN27"><span class='Ref_to_Func'>DatumGetEOHP</span></a><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN400"><span class='Ref_to_Parameter'>d</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN402"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN104"><span class='Ref_to_Member'>ea_magic</span></a> <span class='Operator'>== </span><a href="../../../include/utils/array.h.html#LN96"><span class='Ref_to_Const'>EA_MAGIC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN157"><span class='Ref_to_Union'>AnyArrayType</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="array_expanded.c.html#LN402"><span class='Ref_To_Local'>eah</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Else do regular detoasting as needed */ 
</span>    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN157"><span class='Ref_to_Union'>AnyArrayType</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN204"><span class='Ref_to_Macro'>PG_DETOAST_DATUM</span></a><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN400"><span class='Ref_to_Parameter'>d</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Create the Datum/isnull representation of an expanded array object 
 * if we didn't do so previously 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN423"></a><span class='Declare_Function'>deconstruct_expanded_array</span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN98"><span class='Ref_to_Struct'>ExpandedArrayHeader</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>eah</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_expanded.c.html#LN423"><span class='Ref_to_Parameter'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN129"><span class='Ref_to_Member'>dvalues</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN427"></a>        <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN423"><span class='Ref_to_Parameter'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN101"><span class='Ref_to_Member'>hdr</span></a><span class='Operator'>.</span><a href="../../../include/utils/expandeddatum.h.html#LN106"><span class='Ref_to_Member'>eoh_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN428"></a>        <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>dvalues</span><span class='Delimiter'>; 
</span><a name="LN429"></a>        <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>dnulls</span><span class='Delimiter'>; 
</span><a name="LN430"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>nelems</span><span class='Delimiter'>; 
</span> 
        <a href="array_expanded.c.html#LN429"><span class='Ref_To_Local'>dnulls</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/array.h.html#LN382"><span class='Ref_to_Proto'>deconstruct_array</span></a><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN423"><span class='Ref_to_Parameter'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN148"><span class='Ref_to_Member'>fvalue</span></a><span class='Delimiter'>, 
</span>                          <a href="array_expanded.c.html#LN423"><span class='Ref_to_Parameter'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN112"><span class='Ref_to_Member'>element_type</span></a><span class='Delimiter'>, 
</span>                          <a href="array_expanded.c.html#LN423"><span class='Ref_to_Parameter'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN113"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>, </span><a href="array_expanded.c.html#LN423"><span class='Ref_to_Parameter'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN114"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>, </span><a href="array_expanded.c.html#LN423"><span class='Ref_to_Parameter'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN115"><span class='Ref_to_Member'>typalign</span></a><span class='Delimiter'>, 
</span>                          <span class='Operator'>&</span><a href="array_expanded.c.html#LN428"><span class='Ref_To_Local'>dvalues</span></a><span class='Delimiter'>, 
</span>                          <a href="../../../include/utils/array.h.html#LN271"><span class='Ref_to_Macro'>ARR_HASNULL</span></a><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN423"><span class='Ref_to_Parameter'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN148"><span class='Ref_to_Member'>fvalue</span></a><span class='Parentheses'>) </span><span class='Operator'>? &</span><a href="array_expanded.c.html#LN429"><span class='Ref_To_Local'>dnulls</span></a> <span class='Operator'>: </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                          <span class='Operator'>&</span><a href="array_expanded.c.html#LN430"><span class='Ref_To_Local'>nelems</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Update header only after successful completion of this step.  If 
         * deconstruct_array fails partway through, worst consequence is some 
         * leaked memory in the object's context.  If the caller fails at a 
         * later point, that's fine, since the deconstructed representation is 
         * valid anyhow. 
         */ 
</span>        <a href="array_expanded.c.html#LN423"><span class='Ref_to_Parameter'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN129"><span class='Ref_to_Member'>dvalues</span></a> <span class='Operator'>= </span><a href="array_expanded.c.html#LN428"><span class='Ref_To_Local'>dvalues</span></a><span class='Delimiter'>; 
</span>        <a href="array_expanded.c.html#LN423"><span class='Ref_to_Parameter'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN130"><span class='Ref_to_Member'>dnulls</span></a> <span class='Operator'>= </span><a href="array_expanded.c.html#LN429"><span class='Ref_To_Local'>dnulls</span></a><span class='Delimiter'>; 
</span>        <a href="array_expanded.c.html#LN423"><span class='Ref_to_Parameter'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN131"><span class='Ref_to_Member'>dvalueslen</span></a> <span class='Operator'>= </span><a href="array_expanded.c.html#LN423"><span class='Ref_to_Parameter'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN132"><span class='Ref_to_Member'>nelems</span></a> <span class='Operator'>= </span><a href="array_expanded.c.html#LN430"><span class='Ref_To_Local'>nelems</span></a><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="array_expanded.c.html#LN427"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if eah-&GT;dvalues==NULL &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end deconstruct_expanded_array &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>