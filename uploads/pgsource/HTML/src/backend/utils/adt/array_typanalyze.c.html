<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\utils\adt\array_typanalyze.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\utils\adt\array_typanalyze.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:50 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * array_typanalyze.c 
 *    Functions for gathering statistics from array columns 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/utils/adt/array_typanalyze.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/tuptoaster.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_collation.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/vacuum.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/array.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/datum.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/typcache.h"</span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * To avoid consuming too much memory, IO and CPU load during analysis, and/or 
 * too much space in the resulting pg_statistic rows, we ignore arrays that 
 * are wider than ARRAY_WIDTH_THRESHOLD (after detoasting!).  Note that this 
 * number is considerably more than the similar WIDTH_THRESHOLD limit used 
 * in analyze.c's standard typanalyze code. 
 */ 
</span><a name="LN33"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>ARRAY_WIDTH_THRESHOLD</span> <span class='Number'>0x10000</span> 
 
<span class='Comment_Multi_Line'>/* Extra data for compute_array_stats function */ 
</span><span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Information about array element type */ 
</span><a name="LN39"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>type_id</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* element type's OID */ 
</span><a name="LN40"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>eq_opr</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* default equality operator's OID */ 
</span><a name="LN41"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>typbyval</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* physical properties of element type */ 
</span><a name="LN42"></a>    <a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>       <span class='Declare_Member'>typlen</span><span class='Delimiter'>; 
</span><a name="LN43"></a>    <span class='Keyword'>char</span>        <span class='Declare_Member'>typalign</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Lookup data for element type's comparison and hash functions (these are 
     * in the type's typcache entry, which we expect to remain valid over the 
     * lifespan of the ANALYZE run) 
     */ 
</span><a name="LN50"></a>    <a href="../../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a>   <span class='Operator'>*</span><span class='Declare_Member'>cmp</span><span class='Delimiter'>; 
</span><a name="LN51"></a>    <a href="../../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a>   <span class='Operator'>*</span><span class='Declare_Member'>hash</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Saved state from std_typanalyze() */ 
</span><a name="LN54"></a>    <a href="../../../include/commands/vacuum.h.html#LN63"><span class='Ref_to_Typedef'>AnalyzeAttrComputeStatsFunc</span></a> <span class='Declare_Member'>std_compute_stats</span><span class='Delimiter'>; 
</span><a name="LN55"></a>    <span class='Keyword'>void</span>       <span class='Operator'>*</span><span class='Declare_Member'>std_extra_data</span><span class='Delimiter'>; 
</span><a name="LN56"></a>}<span class='Auto_Annotations'> &laquo; end {anonArrayAnalyzeExtraData} &raquo; </span> <span class='Declare_Typedef'>ArrayAnalyzeExtraData</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * While compute_array_stats is running, we keep a pointer to the extra data 
 * here for use by assorted subroutines.  compute_array_stats doesn't 
 * currently need to be re-entrant, so avoiding this is not worth the extra 
 * notational cruft that would be needed. 
 */ 
</span><a name="LN64"></a><span class='Keyword'>static </span><a href="array_typanalyze.c.html#LN36"><span class='Ref_to_Typedef'>ArrayAnalyzeExtraData</span></a> <span class='Operator'>*</span><span class='Declare_Var'>array_extra_data</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* A hash table entry for the Lossy Counting algorithm */ 
</span><span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN69"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Member'>key</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* This is 'e' from the LC algorithm. */ 
</span><a name="LN70"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>frequency</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* This is 'f'. */ 
</span><a name="LN71"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>delta</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* And this is 'delta'. */ 
</span><a name="LN72"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>last_container</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* For de-duplication of array elements. */ 
</span><a name="LN73"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>TrackItem</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* A hash table entry for distinct-elements counts */ 
</span><span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN78"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>count</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* Count of distinct elements in an array */ 
</span><a name="LN79"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>frequency</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* Number of arrays seen with this count */ 
</span><a name="LN80"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>DECountItem</span><span class='Delimiter'>; 
</span> 
<a name="LN82"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>compute_array_stats</span><span class='Parentheses'>(</span><a href="../../../include/commands/vacuum.h.html#LN68"><span class='Ref_to_Struct'>VacAttrStats</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stats</span><span class='Delimiter'>, 
</span><a name="LN83"></a>           <a href="../../../include/commands/vacuum.h.html#LN60"><span class='Ref_to_Typedef'>AnalyzeAttrFetchFunc</span></a> <span class='Declare_Parameter'>fetchfunc</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>samplerows</span><span class='Delimiter'>, </span><span class='Keyword'>double </span><span class='Declare_Parameter'>totalrows</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN84"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>prune_element_hashtable</span><span class='Parentheses'>(</span><a href="../hash/dynahash.c.html#LN192"><span class='Ref_to_Struct'>HTAB</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>elements_tab</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>b_current</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN85"></a><span class='Keyword'>static </span><a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Prototype'>element_hash</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>key</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Declare_Parameter'>keysize</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN86"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>element_match</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>key1</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>key2</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Declare_Parameter'>keysize</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN87"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>element_compare</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>key1</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>key2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN88"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>trackitem_compare_frequencies_desc</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>e1</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>e2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN89"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>trackitem_compare_element</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>e1</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>e2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN90"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>countitem_compare_count</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>e1</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>e2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * array_typanalyze -- typanalyze function for array columns 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN97"></a><span class='Declare_Function'>array_typanalyze</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN99"></a>    <a href="../../../include/commands/vacuum.h.html#LN68"><span class='Ref_to_Struct'>VacAttrStats</span></a> <span class='Operator'>*</span><span class='Declare_Local'>stats</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/commands/vacuum.h.html#LN68"><span class='Ref_to_Struct'>VacAttrStats</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN100"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>element_typeid</span><span class='Delimiter'>; 
</span><a name="LN101"></a>    <a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>typentry</span><span class='Delimiter'>; 
</span><a name="LN102"></a>    <a href="array_typanalyze.c.html#LN36"><span class='Ref_to_Typedef'>ArrayAnalyzeExtraData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>extra_data</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Call the standard typanalyze function.  It may fail to find needed 
     * operators, in which case we also can't do anything, so just fail. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/commands/vacuum.h.html#LN198"><span class='Ref_to_Proto'>std_typanalyze</span></a><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN99"><span class='Ref_To_Local'>stats</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check attribute data type is a varlena array (or a domain over one). 
     */ 
</span>    <a href="array_typanalyze.c.html#LN100"><span class='Ref_To_Local'>element_typeid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN160"><span class='Ref_to_Proto'>get_base_element_type</span></a><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN99"><span class='Ref_To_Local'>stats</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/vacuum.h.html#LN81"><span class='Ref_to_Member'>attrtypid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN100"><span class='Ref_To_Local'>element_typeid</span></a><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"array_typanalyze was invoked for non-array type %u"</span><span class='Delimiter'>, 
</span>             <a href="array_typanalyze.c.html#LN99"><span class='Ref_To_Local'>stats</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/vacuum.h.html#LN81"><span class='Ref_to_Member'>attrtypid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Gather information about the element type.  If we fail to find 
     * something, return leaving the state from std_typanalyze() in place. 
     */ 
</span>    <a href="array_typanalyze.c.html#LN101"><span class='Ref_To_Local'>typentry</span></a> <span class='Operator'>= </span><a href="../../../include/utils/typcache.h.html#LN142"><span class='Ref_to_Proto'>lookup_type_cache</span></a><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN100"><span class='Ref_To_Local'>element_typeid</span></a><span class='Delimiter'>, 
</span>                                 <a href="../../../include/utils/typcache.h.html#LN109"><span class='Ref_to_Const'>TYPECACHE_EQ_OPR</span></a> <span class='Operator'>| 
</span>                                 <a href="../../../include/utils/typcache.h.html#LN115"><span class='Ref_to_Const'>TYPECACHE_CMP_PROC_FINFO</span></a> <span class='Operator'>| 
</span>                                 <a href="../../../include/utils/typcache.h.html#LN116"><span class='Ref_to_Const'>TYPECACHE_HASH_PROC_FINFO</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN101"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN53"><span class='Ref_to_Member'>eq_opr</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>        <span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN101"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN67"><span class='Ref_to_Member'>cmp_proc_finfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN58"><span class='Ref_to_Member'>fn_oid</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>        <span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN101"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN68"><span class='Ref_to_Member'>hash_proc_finfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN58"><span class='Ref_to_Member'>fn_oid</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Store our findings for use by compute_array_stats() */ 
</span>    <a href="array_typanalyze.c.html#LN102"><span class='Ref_To_Local'>extra_data</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN36"><span class='Ref_to_Typedef'>ArrayAnalyzeExtraData</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN36"><span class='Ref_to_Typedef'>ArrayAnalyzeExtraData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="array_typanalyze.c.html#LN102"><span class='Ref_To_Local'>extra_data</span></a><span class='Operator'>-&GT;</span><a href="array_typanalyze.c.html#LN39"><span class='Ref_to_Member'>type_id</span></a> <span class='Operator'>= </span><a href="array_typanalyze.c.html#LN101"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN31"><span class='Ref_to_Member'>type_id</span></a><span class='Delimiter'>; 
</span>    <a href="array_typanalyze.c.html#LN102"><span class='Ref_To_Local'>extra_data</span></a><span class='Operator'>-&GT;</span><a href="array_typanalyze.c.html#LN40"><span class='Ref_to_Member'>eq_opr</span></a> <span class='Operator'>= </span><a href="array_typanalyze.c.html#LN101"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN53"><span class='Ref_to_Member'>eq_opr</span></a><span class='Delimiter'>; 
</span>    <a href="array_typanalyze.c.html#LN102"><span class='Ref_To_Local'>extra_data</span></a><span class='Operator'>-&GT;</span><a href="array_typanalyze.c.html#LN41"><span class='Ref_to_Member'>typbyval</span></a> <span class='Operator'>= </span><a href="array_typanalyze.c.html#LN101"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN35"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>; 
</span>    <a href="array_typanalyze.c.html#LN102"><span class='Ref_To_Local'>extra_data</span></a><span class='Operator'>-&GT;</span><a href="array_typanalyze.c.html#LN42"><span class='Ref_to_Member'>typlen</span></a> <span class='Operator'>= </span><a href="array_typanalyze.c.html#LN101"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN34"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>; 
</span>    <a href="array_typanalyze.c.html#LN102"><span class='Ref_To_Local'>extra_data</span></a><span class='Operator'>-&GT;</span><a href="array_typanalyze.c.html#LN43"><span class='Ref_to_Member'>typalign</span></a> <span class='Operator'>= </span><a href="array_typanalyze.c.html#LN101"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN36"><span class='Ref_to_Member'>typalign</span></a><span class='Delimiter'>; 
</span>    <a href="array_typanalyze.c.html#LN102"><span class='Ref_To_Local'>extra_data</span></a><span class='Operator'>-&GT;</span><a href="array_typanalyze.c.html#LN50"><span class='Ref_to_Member'>cmp</span></a> <span class='Operator'>= &</span><a href="array_typanalyze.c.html#LN101"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN67"><span class='Ref_to_Member'>cmp_proc_finfo</span></a><span class='Delimiter'>; 
</span>    <a href="array_typanalyze.c.html#LN102"><span class='Ref_To_Local'>extra_data</span></a><span class='Operator'>-&GT;</span><a href="array_typanalyze.c.html#LN51"><span class='Ref_to_Member'>hash</span></a> <span class='Operator'>= &</span><a href="array_typanalyze.c.html#LN101"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN68"><span class='Ref_to_Member'>hash_proc_finfo</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Save old compute_stats and extra_data for scalar statistics ... */ 
</span>    <a href="array_typanalyze.c.html#LN102"><span class='Ref_To_Local'>extra_data</span></a><span class='Operator'>-&GT;</span><a href="array_typanalyze.c.html#LN54"><span class='Ref_to_Member'>std_compute_stats</span></a> <span class='Operator'>= </span><a href="array_typanalyze.c.html#LN99"><span class='Ref_To_Local'>stats</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/vacuum.h.html#LN90"><span class='Ref_to_Member'>compute_stats</span></a><span class='Delimiter'>; 
</span>    <a href="array_typanalyze.c.html#LN102"><span class='Ref_To_Local'>extra_data</span></a><span class='Operator'>-&GT;</span><a href="array_typanalyze.c.html#LN55"><span class='Ref_to_Member'>std_extra_data</span></a> <span class='Operator'>= </span><a href="array_typanalyze.c.html#LN99"><span class='Ref_To_Local'>stats</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/vacuum.h.html#LN92"><span class='Ref_to_Member'>extra_data</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* ... and replace with our info */ 
</span>    <a href="array_typanalyze.c.html#LN99"><span class='Ref_To_Local'>stats</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/vacuum.h.html#LN90"><span class='Ref_to_Member'>compute_stats</span></a> <span class='Operator'>= </span><a href="array_typanalyze.c.html#LN82"><span class='Ref_to_Proto'>compute_array_stats</span></a><span class='Delimiter'>; 
</span>    <a href="array_typanalyze.c.html#LN99"><span class='Ref_To_Local'>stats</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/vacuum.h.html#LN92"><span class='Ref_to_Member'>extra_data</span></a> <span class='Operator'>= </span><a href="array_typanalyze.c.html#LN102"><span class='Ref_To_Local'>extra_data</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Note we leave stats-&GT;minrows set as std_typanalyze set it.  Should it 
     * be increased for array analysis purposes? 
     */ 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end array_typanalyze &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * compute_array_stats() -- compute statistics for an array column 
 * 
 * This function computes statistics useful for determining selectivity of 
 * the array operators &LT;@, &&, and @&GT;.  It is invoked by ANALYZE via the 
 * compute_stats hook after sample rows have been collected. 
 * 
 * We also invoke the standard compute_stats function, which will compute 
 * "scalar" statistics relevant to the btree-style array comparison operators. 
 * However, exact duplicates of an entire array may be rare despite many 
 * arrays sharing individual elements.  This especially afflicts long arrays, 
 * which are also liable to lack all scalar statistics due to the low 
 * WIDTH_THRESHOLD used in analyze.c.  So, in addition to the standard stats, 
 * we find the most common array elements and compute a histogram of distinct 
 * element counts. 
 * 
 * The algorithm used is Lossy Counting, as proposed in the paper "Approximate 
 * frequency counts over data streams" by G. S. Manku and R. Motwani, in 
 * Proceedings of the 28th International Conference on Very Large Data Bases, 
 * Hong Kong, China, August 2002, section 4.2. The paper is available at 
 * http://www.vldb.org/conf/2002/S10P03.pdf 
 * 
 * The Lossy Counting (aka LC) algorithm goes like this: 
 * Let s be the threshold frequency for an item (the minimum frequency we 
 * are interested in) and epsilon the error margin for the frequency. Let D 
 * be a set of triples (e, f, delta), where e is an element value, f is that 
 * element's frequency (actually, its current occurrence count) and delta is 
 * the maximum error in f. We start with D empty and process the elements in 
 * batches of size w. (The batch size is also known as "bucket size" and is 
 * equal to 1/epsilon.) Let the current batch number be b_current, starting 
 * with 1. For each element e we either increment its f count, if it's 
 * already in D, or insert a new triple into D with values (e, 1, b_current 
 * - 1). After processing each batch we prune D, by removing from it all 
 * elements with f + delta &LT;= b_current.  After the algorithm finishes we 
 * suppress all elements from D that do not satisfy f &GT;= (s - epsilon) * N, 
 * where N is the total number of elements in the input.  We emit the 
 * remaining elements with estimated frequency f/N.  The LC paper proves 
 * that this algorithm finds all elements with true frequency at least s, 
 * and that no frequency is overestimated or is underestimated by more than 
 * epsilon.  Furthermore, given reasonable assumptions about the input 
 * distribution, the required table size is no more than about 7 times w. 
 * 
 * In the absence of a principled basis for other particular values, we 
 * follow ts_typanalyze() and use parameters s = 0.07/K, epsilon = s/10. 
 * But we leave out the correction for stopwords, which do not apply to 
 * arrays.  These parameters give bucket width w = K/0.007 and maximum 
 * expected hashtable size of about 1000 * K. 
 * 
 * Elements may repeat within an array.  Since duplicates do not change the 
 * behavior of &LT;@, && or @&GT;, we want to count each element only once per 
 * array.  Therefore, we store in the finished pg_statistic entry each 
 * element's frequency as the fraction of all non-null rows that contain it. 
 * We divide the raw counts by nonnull_cnt to get those figures. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN214"></a><span class='Declare_Function'>compute_array_stats</span><span class='Parentheses'>(</span><a href="../../../include/commands/vacuum.h.html#LN68"><span class='Ref_to_Struct'>VacAttrStats</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stats</span><span class='Delimiter'>, </span><a href="../../../include/commands/vacuum.h.html#LN60"><span class='Ref_to_Typedef'>AnalyzeAttrFetchFunc</span></a> <span class='Declare_Parameter'>fetchfunc</span><span class='Delimiter'>, 
</span><a name="LN215"></a>                    <span class='Keyword'>int </span><span class='Declare_Parameter'>samplerows</span><span class='Delimiter'>, </span><span class='Keyword'>double </span><span class='Declare_Parameter'>totalrows</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN217"></a>    <a href="array_typanalyze.c.html#LN36"><span class='Ref_to_Typedef'>ArrayAnalyzeExtraData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>extra_data</span><span class='Delimiter'>; 
</span><a name="LN218"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>num_mcelem</span><span class='Delimiter'>; 
</span><a name="LN219"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>null_cnt</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN220"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>null_elem_cnt</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN221"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>analyzed_rows</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* This is D from the LC algorithm. */ 
</span><a name="LN224"></a>    <a href="../hash/dynahash.c.html#LN192"><span class='Ref_to_Struct'>HTAB</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>elements_tab</span><span class='Delimiter'>; 
</span><a name="LN225"></a>    <a href="../../../include/utils/hsearch.h.html#LN64"><span class='Ref_to_Struct'>HASHCTL</span></a>     <span class='Declare_Local'>elem_hash_ctl</span><span class='Delimiter'>; 
</span><a name="LN226"></a>    <a href="../../../include/utils/hsearch.h.html#LN111"><span class='Ref_to_Typedef'>HASH_SEQ_STATUS</span></a> <span class='Declare_Local'>scan_status</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* This is the current bucket number from the LC algorithm */ 
</span><a name="LN229"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>b_current</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* This is 'w' from the LC algorithm */ 
</span><a name="LN232"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>bucket_width</span><span class='Delimiter'>; 
</span><a name="LN233"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>array_no</span><span class='Delimiter'>; 
</span><a name="LN234"></a>    <a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>element_no</span><span class='Delimiter'>; 
</span><a name="LN235"></a>    <a href="../../tsearch/ts_typanalyze.c.html#LN30"><span class='Ref_to_Typedef'>TrackItem</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>item</span><span class='Delimiter'>; 
</span><a name="LN236"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>slot_idx</span><span class='Delimiter'>; 
</span><a name="LN237"></a>    <a href="../hash/dynahash.c.html#LN192"><span class='Ref_to_Struct'>HTAB</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>count_tab</span><span class='Delimiter'>; 
</span><a name="LN238"></a>    <a href="../../../include/utils/hsearch.h.html#LN64"><span class='Ref_to_Struct'>HASHCTL</span></a>     <span class='Declare_Local'>count_hash_ctl</span><span class='Delimiter'>; 
</span><a name="LN239"></a>    <a href="array_typanalyze.c.html#LN76"><span class='Ref_to_Typedef'>DECountItem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>count_item</span><span class='Delimiter'>; 
</span> 
    <a href="array_typanalyze.c.html#LN217"><span class='Ref_To_Local'>extra_data</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN36"><span class='Ref_to_Typedef'>ArrayAnalyzeExtraData</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="array_typanalyze.c.html#LN214"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/vacuum.h.html#LN92"><span class='Ref_to_Member'>extra_data</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Invoke analyze.c's standard analysis function to create scalar-style 
     * stats for the column.  It will expect its own extra_data pointer, so 
     * temporarily install that. 
     */ 
</span>    <a href="array_typanalyze.c.html#LN214"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/vacuum.h.html#LN92"><span class='Ref_to_Member'>extra_data</span></a> <span class='Operator'>= </span><a href="array_typanalyze.c.html#LN217"><span class='Ref_To_Local'>extra_data</span></a><span class='Operator'>-&GT;</span><a href="array_typanalyze.c.html#LN55"><span class='Ref_to_Member'>std_extra_data</span></a><span class='Delimiter'>; 
</span>    <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="array_typanalyze.c.html#LN217"><span class='Ref_To_Local'>extra_data</span></a><span class='Operator'>-&GT;</span><a href="array_typanalyze.c.html#LN54"><span class='Ref_to_Member'>std_compute_stats</span></a><span class='Parentheses'>) (</span><a href="array_typanalyze.c.html#LN214"><span class='Ref_to_Parameter'>stats</span></a><span class='Delimiter'>, </span><a href="array_typanalyze.c.html#LN214"><span class='Ref_to_Parameter'>fetchfunc</span></a><span class='Delimiter'>, </span><a href="array_typanalyze.c.html#LN215"><span class='Ref_to_Parameter'>samplerows</span></a><span class='Delimiter'>, </span><a href="array_typanalyze.c.html#LN215"><span class='Ref_to_Parameter'>totalrows</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="array_typanalyze.c.html#LN214"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/vacuum.h.html#LN92"><span class='Ref_to_Member'>extra_data</span></a> <span class='Operator'>= </span><a href="array_typanalyze.c.html#LN217"><span class='Ref_To_Local'>extra_data</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Set up static pointer for use by subroutines.  We wait till here in 
     * case std_compute_stats somehow recursively invokes us (probably not 
     * possible, but ...) 
     */ 
</span>    <a href="array_typanalyze.c.html#LN64"><span class='Ref_to_Global_Var'>array_extra_data</span></a> <span class='Operator'>= </span><a href="array_typanalyze.c.html#LN217"><span class='Ref_To_Local'>extra_data</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We want statistics_target * 10 elements in the MCELEM array. This 
     * multiplier is pretty arbitrary, but is meant to reflect the fact that 
     * the number of individual elements tracked in pg_statistic ought to be 
     * more than the number of values for a simple scalar column. 
     */ 
</span>    <a href="array_typanalyze.c.html#LN218"><span class='Ref_To_Local'>num_mcelem</span></a> <span class='Operator'>= </span><a href="array_typanalyze.c.html#LN214"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/vacuum.h.html#LN80"><span class='Ref_to_Member'>attr</span></a><span class='Operator'>-&GT;</span>attstattarget <span class='Operator'>* </span><span class='Number'>10</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We set bucket width equal to num_mcelem / 0.007 as per the comment 
     * above. 
     */ 
</span>    <a href="array_typanalyze.c.html#LN232"><span class='Ref_To_Local'>bucket_width</span></a> <span class='Operator'>= </span><a href="array_typanalyze.c.html#LN218"><span class='Ref_To_Local'>num_mcelem</span></a> <span class='Operator'>* </span><span class='Number'>1000</span> <span class='Operator'>/ </span><span class='Number'>7</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Create the hashtable. It will be in local memory, so we don't need to 
     * worry about overflowing the initial size. Also we don't need to pay any 
     * attention to locking and memory management. 
     */ 
</span>    <a href="../../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="array_typanalyze.c.html#LN225"><span class='Ref_To_Local'>elem_hash_ctl</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN225"><span class='Ref_To_Local'>elem_hash_ctl</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="array_typanalyze.c.html#LN225"><span class='Ref_To_Local'>elem_hash_ctl</span></a><span class='Operator'>.</span><a href="../../../include/utils/hsearch.h.html#LN71"><span class='Ref_to_Member'>keysize</span></a> <span class='Operator'>= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="array_typanalyze.c.html#LN225"><span class='Ref_To_Local'>elem_hash_ctl</span></a><span class='Operator'>.</span><a href="../../../include/utils/hsearch.h.html#LN72"><span class='Ref_to_Member'>entrysize</span></a> <span class='Operator'>= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../tsearch/ts_typanalyze.c.html#LN30"><span class='Ref_to_Typedef'>TrackItem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="array_typanalyze.c.html#LN225"><span class='Ref_To_Local'>elem_hash_ctl</span></a><span class='Operator'>.</span><a href="../../../include/utils/hsearch.h.html#LN73"><span class='Ref_to_Member'>hash</span></a> <span class='Operator'>= </span><a href="array_typanalyze.c.html#LN85"><span class='Ref_to_Proto'>element_hash</span></a><span class='Delimiter'>; 
</span>    <a href="array_typanalyze.c.html#LN225"><span class='Ref_To_Local'>elem_hash_ctl</span></a><span class='Operator'>.</span><a href="../../../include/utils/hsearch.h.html#LN74"><span class='Ref_to_Member'>match</span></a> <span class='Operator'>= </span><a href="array_typanalyze.c.html#LN86"><span class='Ref_to_Proto'>element_match</span></a><span class='Delimiter'>; 
</span>    <a href="array_typanalyze.c.html#LN225"><span class='Ref_To_Local'>elem_hash_ctl</span></a><span class='Operator'>.</span><a href="../../../include/utils/hsearch.h.html#LN77"><span class='Ref_to_Member'>hcxt</span></a> <span class='Operator'>= </span><a href="../mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>; 
</span>    <a href="array_typanalyze.c.html#LN224"><span class='Ref_To_Local'>elements_tab</span></a> <span class='Operator'>= </span><a href="../../../include/utils/hsearch.h.html#LN121"><span class='Ref_to_Proto'>hash_create</span></a><span class='Parentheses'>(</span><span class='String'>"Analyzed elements table"</span><span class='Delimiter'>, 
</span>                               <a href="array_typanalyze.c.html#LN218"><span class='Ref_To_Local'>num_mcelem</span></a><span class='Delimiter'>, 
</span>                               <span class='Operator'>&</span><a href="array_typanalyze.c.html#LN225"><span class='Ref_To_Local'>elem_hash_ctl</span></a><span class='Delimiter'>, 
</span>                    <a href="../../../include/utils/hsearch.h.html#LN86"><span class='Ref_to_Const'>HASH_ELEM</span></a> <span class='Operator'>| </span><a href="../../../include/utils/hsearch.h.html#LN88"><span class='Ref_to_Const'>HASH_FUNCTION</span></a> <span class='Operator'>| </span><a href="../../../include/utils/hsearch.h.html#LN89"><span class='Ref_to_Const'>HASH_COMPARE</span></a> <span class='Operator'>| </span><a href="../../../include/utils/hsearch.h.html#LN92"><span class='Ref_to_Const'>HASH_CONTEXT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* hashtable for array distinct elements counts */ 
</span>    <a href="../../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="array_typanalyze.c.html#LN238"><span class='Ref_To_Local'>count_hash_ctl</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN238"><span class='Ref_To_Local'>count_hash_ctl</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="array_typanalyze.c.html#LN238"><span class='Ref_To_Local'>count_hash_ctl</span></a><span class='Operator'>.</span><a href="../../../include/utils/hsearch.h.html#LN71"><span class='Ref_to_Member'>keysize</span></a> <span class='Operator'>= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="array_typanalyze.c.html#LN238"><span class='Ref_To_Local'>count_hash_ctl</span></a><span class='Operator'>.</span><a href="../../../include/utils/hsearch.h.html#LN72"><span class='Ref_to_Member'>entrysize</span></a> <span class='Operator'>= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN76"><span class='Ref_to_Typedef'>DECountItem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="array_typanalyze.c.html#LN238"><span class='Ref_To_Local'>count_hash_ctl</span></a><span class='Operator'>.</span><a href="../../../include/utils/hsearch.h.html#LN77"><span class='Ref_to_Member'>hcxt</span></a> <span class='Operator'>= </span><a href="../mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>; 
</span>    <a href="array_typanalyze.c.html#LN237"><span class='Ref_To_Local'>count_tab</span></a> <span class='Operator'>= </span><a href="../../../include/utils/hsearch.h.html#LN121"><span class='Ref_to_Proto'>hash_create</span></a><span class='Parentheses'>(</span><span class='String'>"Array distinct element count table"</span><span class='Delimiter'>, 
</span>                            <span class='Number'>64</span><span class='Delimiter'>, 
</span>                            <span class='Operator'>&</span><a href="array_typanalyze.c.html#LN238"><span class='Ref_To_Local'>count_hash_ctl</span></a><span class='Delimiter'>, 
</span>                            <a href="../../../include/utils/hsearch.h.html#LN86"><span class='Ref_to_Const'>HASH_ELEM</span></a> <span class='Operator'>| </span><a href="../../../include/utils/hsearch.h.html#LN87"><span class='Ref_to_Const'>HASH_BLOBS</span></a> <span class='Operator'>| </span><a href="../../../include/utils/hsearch.h.html#LN92"><span class='Ref_to_Const'>HASH_CONTEXT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Initialize counters. */ 
</span>    <a href="array_typanalyze.c.html#LN229"><span class='Ref_To_Local'>b_current</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="array_typanalyze.c.html#LN234"><span class='Ref_To_Local'>element_no</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Loop over the arrays. */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN233"><span class='Ref_To_Local'>array_no</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="array_typanalyze.c.html#LN233"><span class='Ref_To_Local'>array_no</span></a> <span class='Operator'>&LT; </span><a href="array_typanalyze.c.html#LN215"><span class='Ref_to_Parameter'>samplerows</span></a><span class='Delimiter'>; </span><a href="array_typanalyze.c.html#LN233"><span class='Ref_To_Local'>array_no</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN306"></a>        <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>value</span><span class='Delimiter'>; 
</span><a name="LN307"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN308"></a>        <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>array</span><span class='Delimiter'>; 
</span><a name="LN309"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>num_elems</span><span class='Delimiter'>; 
</span><a name="LN310"></a>        <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>elem_values</span><span class='Delimiter'>; 
</span><a name="LN311"></a>        <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>elem_nulls</span><span class='Delimiter'>; 
</span><a name="LN312"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>null_present</span><span class='Delimiter'>; 
</span><a name="LN313"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>j</span><span class='Delimiter'>; 
</span><a name="LN314"></a>        <a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>prev_element_no</span> <span class='Operator'>= </span><a href="array_typanalyze.c.html#LN234"><span class='Ref_To_Local'>element_no</span></a><span class='Delimiter'>; 
</span><a name="LN315"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>distinct_count</span><span class='Delimiter'>; 
</span><a name="LN316"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>count_item_found</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/commands/vacuum.h.html#LN188"><span class='Ref_to_Proto'>vacuum_delay_point</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Keyword'>value </span><span class='Operator'>= </span><a href="array_typanalyze.c.html#LN214"><span class='Ref_to_Parameter'>fetchfunc</span></a><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN214"><span class='Ref_to_Parameter'>stats</span></a><span class='Delimiter'>, </span><a href="array_typanalyze.c.html#LN233"><span class='Ref_To_Local'>array_no</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="array_typanalyze.c.html#LN307"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN307"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* array is null, just count that */ 
</span>            <a href="array_typanalyze.c.html#LN219"><span class='Ref_To_Local'>null_cnt</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Skip too-large values. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/tuptoaster.h.html#LN220"><span class='Ref_to_Proto'>toast_raw_datum_size</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><a href="array_typanalyze.c.html#LN33"><span class='Ref_to_Const'>ARRAY_WIDTH_THRESHOLD</span></a><span class='Parentheses'>)</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="array_typanalyze.c.html#LN221"><span class='Ref_To_Local'>analyzed_rows</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Now detoast the array if needed, and deconstruct into datums. 
         */ 
</span>        <a href="array_typanalyze.c.html#LN308"><span class='Ref_To_Local'>array</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN241"><span class='Ref_to_Macro'>DatumGetArrayTypeP</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN272"><span class='Ref_to_Macro'>ARR_ELEMTYPE</span></a><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN308"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="array_typanalyze.c.html#LN217"><span class='Ref_To_Local'>extra_data</span></a><span class='Operator'>-&GT;</span><a href="array_typanalyze.c.html#LN39"><span class='Ref_to_Member'>type_id</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/array.h.html#LN382"><span class='Ref_to_Proto'>deconstruct_array</span></a><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN308"><span class='Ref_To_Local'>array</span></a><span class='Delimiter'>, 
</span>                          <a href="array_typanalyze.c.html#LN217"><span class='Ref_To_Local'>extra_data</span></a><span class='Operator'>-&GT;</span><a href="array_typanalyze.c.html#LN39"><span class='Ref_to_Member'>type_id</span></a><span class='Delimiter'>, 
</span>                          <a href="array_typanalyze.c.html#LN217"><span class='Ref_To_Local'>extra_data</span></a><span class='Operator'>-&GT;</span><a href="array_typanalyze.c.html#LN42"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>, 
</span>                          <a href="array_typanalyze.c.html#LN217"><span class='Ref_To_Local'>extra_data</span></a><span class='Operator'>-&GT;</span><a href="array_typanalyze.c.html#LN41"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>, 
</span>                          <a href="array_typanalyze.c.html#LN217"><span class='Ref_To_Local'>extra_data</span></a><span class='Operator'>-&GT;</span><a href="array_typanalyze.c.html#LN43"><span class='Ref_to_Member'>typalign</span></a><span class='Delimiter'>, 
</span>                          <span class='Operator'>&</span><a href="array_typanalyze.c.html#LN310"><span class='Ref_To_Local'>elem_values</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="array_typanalyze.c.html#LN311"><span class='Ref_To_Local'>elem_nulls</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="array_typanalyze.c.html#LN309"><span class='Ref_To_Local'>num_elems</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We loop through the elements in the array and add them to our 
         * tracking hashtable. 
         */ 
</span>        <a href="array_typanalyze.c.html#LN312"><span class='Ref_To_Local'>null_present</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN313"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="array_typanalyze.c.html#LN313"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>&LT; </span><a href="array_typanalyze.c.html#LN309"><span class='Ref_To_Local'>num_elems</span></a><span class='Delimiter'>; </span><a href="array_typanalyze.c.html#LN313"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN354"></a>            <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>elem_value</span><span class='Delimiter'>; 
</span><a name="LN355"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>found</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* No null element processing other than flag setting here */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN311"><span class='Ref_To_Local'>elem_nulls</span></a><span class='Delimiter'>[</span><a href="array_typanalyze.c.html#LN313"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="array_typanalyze.c.html#LN312"><span class='Ref_To_Local'>null_present</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* Lookup current element in hashtable, adding it if new */ 
</span>            <a href="array_typanalyze.c.html#LN354"><span class='Ref_To_Local'>elem_value</span></a> <span class='Operator'>= </span><a href="array_typanalyze.c.html#LN310"><span class='Ref_To_Local'>elem_values</span></a><span class='Delimiter'>[</span><a href="array_typanalyze.c.html#LN313"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]; 
</span>            <a href="array_typanalyze.c.html#LN235"><span class='Ref_To_Local'>item</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../tsearch/ts_typanalyze.c.html#LN30"><span class='Ref_to_Typedef'>TrackItem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/hsearch.h.html#LN125"><span class='Ref_to_Proto'>hash_search</span></a><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN224"><span class='Ref_To_Local'>elements_tab</span></a><span class='Delimiter'>, 
</span>                                             <span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="array_typanalyze.c.html#LN354"><span class='Ref_To_Local'>elem_value</span></a><span class='Delimiter'>, 
</span>                                             <a href="../../../include/utils/hsearch.h.html#LN105"><span class='Ref_to_EnumConst'>HASH_ENTER</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="array_typanalyze.c.html#LN355"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN355"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* The element value is already on the tracking list */ 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * The operators we assist ignore duplicate array elements, so 
                 * count a given distinct element only once per array. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN235"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="array_typanalyze.c.html#LN72"><span class='Ref_to_Member'>last_container</span></a> <span class='Operator'>== </span><a href="array_typanalyze.c.html#LN233"><span class='Ref_To_Local'>array_no</span></a><span class='Parentheses'>) 
</span>                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
                <a href="array_typanalyze.c.html#LN235"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../tsearch/ts_typanalyze.c.html#LN33"><span class='Ref_to_Member'>frequency</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <a href="array_typanalyze.c.html#LN235"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="array_typanalyze.c.html#LN72"><span class='Ref_to_Member'>last_container</span></a> <span class='Operator'>= </span><a href="array_typanalyze.c.html#LN233"><span class='Ref_To_Local'>array_no</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Initialize new tracking list element */ 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * If element type is pass-by-reference, we must copy it into 
                 * palloc'd space, so that we can release the array below. (We 
                 * do this so that the space needed for element values is 
                 * limited by the size of the hashtable; if we kept all the 
                 * array values around, it could be much more.) 
                 */ 
</span>                <a href="array_typanalyze.c.html#LN235"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../tsearch/ts_typanalyze.c.html#LN32"><span class='Ref_to_Member'>key</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datum.h.html#LN30"><span class='Ref_to_Proto'>datumCopy</span></a><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN354"><span class='Ref_To_Local'>elem_value</span></a><span class='Delimiter'>, 
</span>                                      <a href="array_typanalyze.c.html#LN217"><span class='Ref_To_Local'>extra_data</span></a><span class='Operator'>-&GT;</span><a href="array_typanalyze.c.html#LN41"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>, 
</span>                                      <a href="array_typanalyze.c.html#LN217"><span class='Ref_To_Local'>extra_data</span></a><span class='Operator'>-&GT;</span><a href="array_typanalyze.c.html#LN42"><span class='Ref_to_Member'>typlen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="array_typanalyze.c.html#LN235"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../tsearch/ts_typanalyze.c.html#LN33"><span class='Ref_to_Member'>frequency</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <a href="array_typanalyze.c.html#LN235"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../tsearch/ts_typanalyze.c.html#LN34"><span class='Ref_to_Member'>delta</span></a> <span class='Operator'>= </span><a href="array_typanalyze.c.html#LN229"><span class='Ref_To_Local'>b_current</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <a href="array_typanalyze.c.html#LN235"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="array_typanalyze.c.html#LN72"><span class='Ref_to_Member'>last_container</span></a> <span class='Operator'>= </span><a href="array_typanalyze.c.html#LN233"><span class='Ref_To_Local'>array_no</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* element_no is the number of elements processed (ie N) */ 
</span>            <a href="array_typanalyze.c.html#LN234"><span class='Ref_To_Local'>element_no</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* We prune the D structure after processing each bucket */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN234"><span class='Ref_To_Local'>element_no</span></a> <span class='Operator'>% </span><a href="array_typanalyze.c.html#LN232"><span class='Ref_To_Local'>bucket_width</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="array_typanalyze.c.html#LN84"><span class='Ref_to_Proto'>prune_element_hashtable</span></a><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN224"><span class='Ref_To_Local'>elements_tab</span></a><span class='Delimiter'>, </span><a href="array_typanalyze.c.html#LN229"><span class='Ref_To_Local'>b_current</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="array_typanalyze.c.html#LN229"><span class='Ref_To_Local'>b_current</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for j=0;j&LT;num_elems;j++ &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* Count null element presence once per array. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN312"><span class='Ref_To_Local'>null_present</span></a><span class='Parentheses'>) 
</span>            <a href="array_typanalyze.c.html#LN220"><span class='Ref_To_Local'>null_elem_cnt</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Update frequency of the particular array distinct element count. */ 
</span>        <a href="array_typanalyze.c.html#LN315"><span class='Ref_To_Local'>distinct_count</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) (</span><a href="array_typanalyze.c.html#LN234"><span class='Ref_To_Local'>element_no</span></a> <span class='Operator'>- </span><a href="array_typanalyze.c.html#LN314"><span class='Ref_To_Local'>prev_element_no</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="array_typanalyze.c.html#LN239"><span class='Ref_To_Local'>count_item</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN76"><span class='Ref_to_Typedef'>DECountItem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/hsearch.h.html#LN125"><span class='Ref_to_Proto'>hash_search</span></a><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN237"><span class='Ref_To_Local'>count_tab</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="array_typanalyze.c.html#LN315"><span class='Ref_To_Local'>distinct_count</span></a><span class='Delimiter'>, 
</span>                                                 <a href="../../../include/utils/hsearch.h.html#LN105"><span class='Ref_to_EnumConst'>HASH_ENTER</span></a><span class='Delimiter'>, 
</span>                                                 <span class='Operator'>&</span><a href="array_typanalyze.c.html#LN316"><span class='Ref_To_Local'>count_item_found</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN316"><span class='Ref_To_Local'>count_item_found</span></a><span class='Parentheses'>) 
</span>            <a href="array_typanalyze.c.html#LN239"><span class='Ref_To_Local'>count_item</span></a><span class='Operator'>-&GT;</span><a href="array_typanalyze.c.html#LN79"><span class='Ref_to_Member'>frequency</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="array_typanalyze.c.html#LN239"><span class='Ref_To_Local'>count_item</span></a><span class='Operator'>-&GT;</span><a href="array_typanalyze.c.html#LN79"><span class='Ref_to_Member'>frequency</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Free memory allocated while detoasting. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN308"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Keyword'>value</span><span class='Parentheses'>)</span> 
            <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN308"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN310"><span class='Ref_To_Local'>elem_values</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN311"><span class='Ref_To_Local'>elem_nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for array_no=0;array_no&LT;s... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Skip pg_statistic slots occupied by standard statistics */ 
</span>    <a href="array_typanalyze.c.html#LN236"><span class='Ref_To_Local'>slot_idx</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN236"><span class='Ref_To_Local'>slot_idx</span></a> <span class='Operator'>&LT; </span><a href="../../../include/catalog/pg_statistic.h.html#LN120"><span class='Ref_to_Const'>STATISTIC_NUM_SLOTS</span></a> <span class='Operator'>&& </span><a href="array_typanalyze.c.html#LN214"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/vacuum.h.html#LN102"><span class='Ref_to_Member'>stakind</span></a><span class='Delimiter'>[</span><a href="array_typanalyze.c.html#LN236"><span class='Ref_To_Local'>slot_idx</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="array_typanalyze.c.html#LN236"><span class='Ref_To_Local'>slot_idx</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN236"><span class='Ref_To_Local'>slot_idx</span></a> <span class='Operator'>&GT; </span><a href="../../../include/catalog/pg_statistic.h.html#LN120"><span class='Ref_to_Const'>STATISTIC_NUM_SLOTS</span></a> <span class='Operator'>- </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"insufficient pg_statistic slots for array stats"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* We can only compute real stats if we found some non-null values. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN221"><span class='Ref_To_Local'>analyzed_rows</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN447"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>nonnull_cnt</span> <span class='Operator'>= </span><a href="array_typanalyze.c.html#LN221"><span class='Ref_To_Local'>analyzed_rows</span></a><span class='Delimiter'>; 
</span><a name="LN448"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>count_items_count</span><span class='Delimiter'>; 
</span><a name="LN449"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN450"></a>        <a href="../../tsearch/ts_typanalyze.c.html#LN30"><span class='Ref_to_Typedef'>TrackItem</span></a> <span class='Operator'>**</span><span class='Declare_Local'>sort_table</span><span class='Delimiter'>; 
</span><a name="LN451"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>track_len</span><span class='Delimiter'>; 
</span><a name="LN452"></a>        <a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>cutoff_freq</span><span class='Delimiter'>; 
</span><a name="LN453"></a>        <a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>minfreq</span><span class='Delimiter'>, 
</span><a name="LN454"></a>                    <span class='Declare_Local'>maxfreq</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We assume the standard stats code already took care of setting 
         * stats_valid, stanullfrac, stawidth, stadistinct.  We'd have to 
         * re-compute those values if we wanted to not store the standard 
         * stats. 
         */ 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Construct an array of the interesting hashtable items, that is, 
         * those meeting the cutoff frequency (s - epsilon)*N.  Also identify 
         * the minimum and maximum frequencies among these items. 
         * 
         * Since epsilon = s/10 and bucket_width = 1/epsilon, the cutoff 
         * frequency is 9*N / bucket_width. 
         */ 
</span>        <a href="array_typanalyze.c.html#LN452"><span class='Ref_To_Local'>cutoff_freq</span></a> <span class='Operator'>= </span><span class='Number'>9</span> <span class='Operator'>* </span><a href="array_typanalyze.c.html#LN234"><span class='Ref_To_Local'>element_no</span></a> <span class='Operator'>/ </span><a href="array_typanalyze.c.html#LN232"><span class='Ref_To_Local'>bucket_width</span></a><span class='Delimiter'>; 
</span> 
        <a href="array_typanalyze.c.html#LN449"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="../../../include/utils/hsearch.h.html#LN133"><span class='Ref_to_Proto'>hash_get_num_entries</span></a><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN224"><span class='Ref_To_Local'>elements_tab</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* surely enough space */ 
</span>        <a href="array_typanalyze.c.html#LN450"><span class='Ref_To_Local'>sort_table</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../tsearch/ts_typanalyze.c.html#LN30"><span class='Ref_to_Typedef'>TrackItem</span></a> <span class='Operator'>**</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../tsearch/ts_typanalyze.c.html#LN30"><span class='Ref_to_Typedef'>TrackItem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="array_typanalyze.c.html#LN449"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/utils/hsearch.h.html#LN134"><span class='Ref_to_Proto'>hash_seq_init</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="array_typanalyze.c.html#LN226"><span class='Ref_To_Local'>scan_status</span></a><span class='Delimiter'>, </span><a href="array_typanalyze.c.html#LN224"><span class='Ref_To_Local'>elements_tab</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="array_typanalyze.c.html#LN451"><span class='Ref_To_Local'>track_len</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="array_typanalyze.c.html#LN453"><span class='Ref_To_Local'>minfreq</span></a> <span class='Operator'>= </span><a href="array_typanalyze.c.html#LN234"><span class='Ref_To_Local'>element_no</span></a><span class='Delimiter'>; 
</span>        <a href="array_typanalyze.c.html#LN454"><span class='Ref_To_Local'>maxfreq</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="array_typanalyze.c.html#LN235"><span class='Ref_To_Local'>item</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../tsearch/ts_typanalyze.c.html#LN30"><span class='Ref_to_Typedef'>TrackItem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/hsearch.h.html#LN135"><span class='Ref_to_Proto'>hash_seq_search</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="array_typanalyze.c.html#LN226"><span class='Ref_To_Local'>scan_status</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN235"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../tsearch/ts_typanalyze.c.html#LN33"><span class='Ref_to_Member'>frequency</span></a> <span class='Operator'>&GT; </span><a href="array_typanalyze.c.html#LN452"><span class='Ref_To_Local'>cutoff_freq</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="array_typanalyze.c.html#LN450"><span class='Ref_To_Local'>sort_table</span></a><span class='Delimiter'>[</span><a href="array_typanalyze.c.html#LN451"><span class='Ref_To_Local'>track_len</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="array_typanalyze.c.html#LN235"><span class='Ref_To_Local'>item</span></a><span class='Delimiter'>; 
</span>                <a href="array_typanalyze.c.html#LN453"><span class='Ref_To_Local'>minfreq</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN453"><span class='Ref_To_Local'>minfreq</span></a><span class='Delimiter'>, </span><a href="array_typanalyze.c.html#LN235"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../tsearch/ts_typanalyze.c.html#LN33"><span class='Ref_to_Member'>frequency</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="array_typanalyze.c.html#LN454"><span class='Ref_To_Local'>maxfreq</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN454"><span class='Ref_To_Local'>maxfreq</span></a><span class='Delimiter'>, </span><a href="array_typanalyze.c.html#LN235"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../tsearch/ts_typanalyze.c.html#LN33"><span class='Ref_to_Member'>frequency</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN451"><span class='Ref_To_Local'>track_len</span></a> <span class='Operator'>&LT;= </span><a href="array_typanalyze.c.html#LN449"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* emit some statistics for debug purposes */ 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN22"><span class='Ref_to_Const'>DEBUG3</span></a><span class='Delimiter'>, </span><span class='String'>"compute_array_stats: target # mces = %d, "</span> 
             <span class='String'>"bucket width = %d, "</span> 
             <span class='String'>"# elements = "</span> <a href="../../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a> <span class='String'>", hashtable size = %d, "</span> 
             <span class='String'>"usable entries = %d"</span><span class='Delimiter'>, 
</span>             <a href="array_typanalyze.c.html#LN218"><span class='Ref_To_Local'>num_mcelem</span></a><span class='Delimiter'>, </span><a href="array_typanalyze.c.html#LN232"><span class='Ref_To_Local'>bucket_width</span></a><span class='Delimiter'>, </span><a href="array_typanalyze.c.html#LN234"><span class='Ref_To_Local'>element_no</span></a><span class='Delimiter'>, </span><a href="array_typanalyze.c.html#LN449"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><a href="array_typanalyze.c.html#LN451"><span class='Ref_To_Local'>track_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If we obtained more elements than we really want, get rid of those 
         * with least frequencies.  The easiest way is to qsort the array into 
         * descending frequency order and truncate the array. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN218"><span class='Ref_To_Local'>num_mcelem</span></a> <span class='Operator'>&LT; </span><a href="array_typanalyze.c.html#LN451"><span class='Ref_To_Local'>track_len</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../include/port.h.html#LN439"><span class='Ref_to_Macro'>qsort</span></a><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN450"><span class='Ref_To_Local'>sort_table</span></a><span class='Delimiter'>, </span><a href="array_typanalyze.c.html#LN451"><span class='Ref_To_Local'>track_len</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../tsearch/ts_typanalyze.c.html#LN30"><span class='Ref_to_Typedef'>TrackItem</span></a> <span class='Operator'>*</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                  <a href="../../tsearch/ts_typanalyze.c.html#LN45"><span class='Ref_to_Proto'>trackitem_compare_frequencies_desc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* reset minfreq to the smallest frequency we're keeping */ 
</span>            <a href="array_typanalyze.c.html#LN453"><span class='Ref_To_Local'>minfreq</span></a> <span class='Operator'>= </span><a href="array_typanalyze.c.html#LN450"><span class='Ref_To_Local'>sort_table</span></a><span class='Delimiter'>[</span><a href="array_typanalyze.c.html#LN218"><span class='Ref_To_Local'>num_mcelem</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="../../tsearch/ts_typanalyze.c.html#LN33"><span class='Ref_to_Member'>frequency</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="array_typanalyze.c.html#LN218"><span class='Ref_To_Local'>num_mcelem</span></a> <span class='Operator'>= </span><a href="array_typanalyze.c.html#LN451"><span class='Ref_To_Local'>track_len</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Generate MCELEM slot entry */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN218"><span class='Ref_To_Local'>num_mcelem</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN516"></a>            <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>old_context</span><span class='Delimiter'>; 
</span><a name="LN517"></a>            <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>mcelem_values</span><span class='Delimiter'>; 
</span><a name="LN518"></a>            <a href="../../../include/c.h.html#LN379"><span class='Ref_to_Typedef'>float4</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>mcelem_freqs</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * We want to store statistics sorted on the element value using 
             * the element type's default comparison function.  This permits 
             * fast binary searches in selectivity estimation functions. 
             */ 
</span>            <a href="../../../include/port.h.html#LN439"><span class='Ref_to_Macro'>qsort</span></a><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN450"><span class='Ref_To_Local'>sort_table</span></a><span class='Delimiter'>, </span><a href="array_typanalyze.c.html#LN218"><span class='Ref_To_Local'>num_mcelem</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../tsearch/ts_typanalyze.c.html#LN30"><span class='Ref_to_Typedef'>TrackItem</span></a> <span class='Operator'>*</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                  <a href="array_typanalyze.c.html#LN89"><span class='Ref_to_Proto'>trackitem_compare_element</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Must copy the target values into anl_context */ 
</span>            <a href="array_typanalyze.c.html#LN516"><span class='Ref_To_Local'>old_context</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN214"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/vacuum.h.html#LN84"><span class='Ref_to_Member'>anl_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * We sorted statistics on the element value, but we want to be 
             * able to find the minimal and maximal frequencies without going 
             * through all the values.  We also want the frequency of null 
             * elements.  Store these three values at the end of mcelem_freqs. 
             */ 
</span>            <a href="array_typanalyze.c.html#LN517"><span class='Ref_To_Local'>mcelem_values</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN218"><span class='Ref_To_Local'>num_mcelem</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="array_typanalyze.c.html#LN518"><span class='Ref_To_Local'>mcelem_freqs</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN379"><span class='Ref_to_Typedef'>float4</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>((</span><a href="array_typanalyze.c.html#LN218"><span class='Ref_To_Local'>num_mcelem</span></a> <span class='Operator'>+ </span><span class='Number'>3</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN379"><span class='Ref_to_Typedef'>float4</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * See comments above about use of nonnull_cnt as the divisor for 
             * the final frequency estimates. 
             */ 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN449"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="array_typanalyze.c.html#LN449"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="array_typanalyze.c.html#LN218"><span class='Ref_To_Local'>num_mcelem</span></a><span class='Delimiter'>; </span><a href="array_typanalyze.c.html#LN449"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN546"></a>                <a href="../../tsearch/ts_typanalyze.c.html#LN30"><span class='Ref_to_Typedef'>TrackItem</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>item</span> <span class='Operator'>= </span><a href="array_typanalyze.c.html#LN450"><span class='Ref_To_Local'>sort_table</span></a><span class='Delimiter'>[</span><a href="array_typanalyze.c.html#LN449"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
                <a href="array_typanalyze.c.html#LN517"><span class='Ref_To_Local'>mcelem_values</span></a><span class='Delimiter'>[</span><a href="array_typanalyze.c.html#LN449"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/utils/datum.h.html#LN30"><span class='Ref_to_Proto'>datumCopy</span></a><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN546"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../tsearch/ts_typanalyze.c.html#LN32"><span class='Ref_to_Member'>key</span></a><span class='Delimiter'>, 
</span>                                             <a href="array_typanalyze.c.html#LN217"><span class='Ref_To_Local'>extra_data</span></a><span class='Operator'>-&GT;</span><a href="array_typanalyze.c.html#LN41"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>, 
</span>                                             <a href="array_typanalyze.c.html#LN217"><span class='Ref_To_Local'>extra_data</span></a><span class='Operator'>-&GT;</span><a href="array_typanalyze.c.html#LN42"><span class='Ref_to_Member'>typlen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="array_typanalyze.c.html#LN518"><span class='Ref_To_Local'>mcelem_freqs</span></a><span class='Delimiter'>[</span><a href="array_typanalyze.c.html#LN449"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="array_typanalyze.c.html#LN546"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../tsearch/ts_typanalyze.c.html#LN33"><span class='Ref_to_Member'>frequency</span></a> <span class='Operator'>/ 
</span>                    <span class='Parentheses'>(</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="array_typanalyze.c.html#LN447"><span class='Ref_To_Local'>nonnull_cnt</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="array_typanalyze.c.html#LN518"><span class='Ref_To_Local'>mcelem_freqs</span></a><span class='Delimiter'>[</span><a href="array_typanalyze.c.html#LN449"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="array_typanalyze.c.html#LN453"><span class='Ref_To_Local'>minfreq</span></a> <span class='Operator'>/ </span><span class='Parentheses'>(</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="array_typanalyze.c.html#LN447"><span class='Ref_To_Local'>nonnull_cnt</span></a><span class='Delimiter'>; 
</span>            <a href="array_typanalyze.c.html#LN518"><span class='Ref_To_Local'>mcelem_freqs</span></a><span class='Delimiter'>[</span><a href="array_typanalyze.c.html#LN449"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="array_typanalyze.c.html#LN454"><span class='Ref_To_Local'>maxfreq</span></a> <span class='Operator'>/ </span><span class='Parentheses'>(</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="array_typanalyze.c.html#LN447"><span class='Ref_To_Local'>nonnull_cnt</span></a><span class='Delimiter'>; 
</span>            <a href="array_typanalyze.c.html#LN518"><span class='Ref_To_Local'>mcelem_freqs</span></a><span class='Delimiter'>[</span><a href="array_typanalyze.c.html#LN449"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="array_typanalyze.c.html#LN220"><span class='Ref_To_Local'>null_elem_cnt</span></a> <span class='Operator'>/ </span><span class='Parentheses'>(</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="array_typanalyze.c.html#LN447"><span class='Ref_To_Local'>nonnull_cnt</span></a><span class='Delimiter'>; 
</span> 
            <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN516"><span class='Ref_To_Local'>old_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="array_typanalyze.c.html#LN214"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/vacuum.h.html#LN102"><span class='Ref_to_Member'>stakind</span></a><span class='Delimiter'>[</span><a href="array_typanalyze.c.html#LN236"><span class='Ref_To_Local'>slot_idx</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/catalog/pg_statistic.h.html#LN256"><span class='Ref_to_Const'>STATISTIC_KIND_MCELEM</span></a><span class='Delimiter'>; 
</span>            <a href="array_typanalyze.c.html#LN214"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/vacuum.h.html#LN103"><span class='Ref_to_Member'>staop</span></a><span class='Delimiter'>[</span><a href="array_typanalyze.c.html#LN236"><span class='Ref_To_Local'>slot_idx</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="array_typanalyze.c.html#LN217"><span class='Ref_To_Local'>extra_data</span></a><span class='Operator'>-&GT;</span><a href="array_typanalyze.c.html#LN40"><span class='Ref_to_Member'>eq_opr</span></a><span class='Delimiter'>; 
</span>            <a href="array_typanalyze.c.html#LN214"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/vacuum.h.html#LN105"><span class='Ref_to_Member'>stanumbers</span></a><span class='Delimiter'>[</span><a href="array_typanalyze.c.html#LN236"><span class='Ref_To_Local'>slot_idx</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="array_typanalyze.c.html#LN518"><span class='Ref_To_Local'>mcelem_freqs</span></a><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* See above comment about extra stanumber entries */ 
</span>            <a href="array_typanalyze.c.html#LN214"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/vacuum.h.html#LN104"><span class='Ref_to_Member'>numnumbers</span></a><span class='Delimiter'>[</span><a href="array_typanalyze.c.html#LN236"><span class='Ref_To_Local'>slot_idx</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="array_typanalyze.c.html#LN218"><span class='Ref_To_Local'>num_mcelem</span></a> <span class='Operator'>+ </span><span class='Number'>3</span><span class='Delimiter'>; 
</span>            <a href="array_typanalyze.c.html#LN214"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/vacuum.h.html#LN107"><span class='Ref_to_Member'>stavalues</span></a><span class='Delimiter'>[</span><a href="array_typanalyze.c.html#LN236"><span class='Ref_To_Local'>slot_idx</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="array_typanalyze.c.html#LN517"><span class='Ref_To_Local'>mcelem_values</span></a><span class='Delimiter'>; 
</span>            <a href="array_typanalyze.c.html#LN214"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/vacuum.h.html#LN106"><span class='Ref_to_Member'>numvalues</span></a><span class='Delimiter'>[</span><a href="array_typanalyze.c.html#LN236"><span class='Ref_To_Local'>slot_idx</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="array_typanalyze.c.html#LN218"><span class='Ref_To_Local'>num_mcelem</span></a><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* We are storing values of element type */ 
</span>            <a href="array_typanalyze.c.html#LN214"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/vacuum.h.html#LN115"><span class='Ref_to_Member'>statypid</span></a><span class='Delimiter'>[</span><a href="array_typanalyze.c.html#LN236"><span class='Ref_To_Local'>slot_idx</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="array_typanalyze.c.html#LN217"><span class='Ref_To_Local'>extra_data</span></a><span class='Operator'>-&GT;</span><a href="array_typanalyze.c.html#LN39"><span class='Ref_to_Member'>type_id</span></a><span class='Delimiter'>; 
</span>            <a href="array_typanalyze.c.html#LN214"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/vacuum.h.html#LN116"><span class='Ref_to_Member'>statyplen</span></a><span class='Delimiter'>[</span><a href="array_typanalyze.c.html#LN236"><span class='Ref_To_Local'>slot_idx</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="array_typanalyze.c.html#LN217"><span class='Ref_To_Local'>extra_data</span></a><span class='Operator'>-&GT;</span><a href="array_typanalyze.c.html#LN42"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>; 
</span>            <a href="array_typanalyze.c.html#LN214"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/vacuum.h.html#LN117"><span class='Ref_to_Member'>statypbyval</span></a><span class='Delimiter'>[</span><a href="array_typanalyze.c.html#LN236"><span class='Ref_To_Local'>slot_idx</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="array_typanalyze.c.html#LN217"><span class='Ref_To_Local'>extra_data</span></a><span class='Operator'>-&GT;</span><a href="array_typanalyze.c.html#LN41"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>; 
</span>            <a href="array_typanalyze.c.html#LN214"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/vacuum.h.html#LN118"><span class='Ref_to_Member'>statypalign</span></a><span class='Delimiter'>[</span><a href="array_typanalyze.c.html#LN236"><span class='Ref_To_Local'>slot_idx</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="array_typanalyze.c.html#LN217"><span class='Ref_To_Local'>extra_data</span></a><span class='Operator'>-&GT;</span><a href="array_typanalyze.c.html#LN43"><span class='Ref_to_Member'>typalign</span></a><span class='Delimiter'>; 
</span>            <a href="array_typanalyze.c.html#LN236"><span class='Ref_To_Local'>slot_idx</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if num_mcelem&GT;0 &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* Generate DECHIST slot entry */ 
</span>        <a href="array_typanalyze.c.html#LN448"><span class='Ref_To_Local'>count_items_count</span></a> <span class='Operator'>= </span><a href="../../../include/utils/hsearch.h.html#LN133"><span class='Ref_to_Proto'>hash_get_num_entries</span></a><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN237"><span class='Ref_To_Local'>count_tab</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN448"><span class='Ref_To_Local'>count_items_count</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN579"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>num_hist</span> <span class='Operator'>= </span><a href="array_typanalyze.c.html#LN214"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/vacuum.h.html#LN80"><span class='Ref_to_Member'>attr</span></a><span class='Operator'>-&GT;</span>attstattarget<span class='Delimiter'>; 
</span><a name="LN580"></a>            <a href="array_typanalyze.c.html#LN76"><span class='Ref_to_Typedef'>DECountItem</span></a> <span class='Operator'>**</span><span class='Declare_Local'>sorted_count_items</span><span class='Delimiter'>; 
</span><a name="LN581"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>j</span><span class='Delimiter'>; 
</span><a name="LN582"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>delta</span><span class='Delimiter'>; 
</span><a name="LN583"></a>            <a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>frac</span><span class='Delimiter'>; 
</span><a name="LN584"></a>            <a href="../../../include/c.h.html#LN379"><span class='Ref_to_Typedef'>float4</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>hist</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* num_hist must be at least 2 for the loop below to work */ 
</span>            <a href="array_typanalyze.c.html#LN579"><span class='Ref_To_Local'>num_hist</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN579"><span class='Ref_To_Local'>num_hist</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Create an array of DECountItem pointers, and sort them into 
             * increasing count order. 
             */ 
</span>            <a href="array_typanalyze.c.html#LN580"><span class='Ref_To_Local'>sorted_count_items</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN76"><span class='Ref_to_Typedef'>DECountItem</span></a> <span class='Operator'>**</span><span class='Parentheses'>) 
</span>                <a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN76"><span class='Ref_to_Typedef'>DECountItem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="array_typanalyze.c.html#LN448"><span class='Ref_To_Local'>count_items_count</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/utils/hsearch.h.html#LN134"><span class='Ref_to_Proto'>hash_seq_init</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="array_typanalyze.c.html#LN226"><span class='Ref_To_Local'>scan_status</span></a><span class='Delimiter'>, </span><a href="array_typanalyze.c.html#LN237"><span class='Ref_To_Local'>count_tab</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="array_typanalyze.c.html#LN581"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="array_typanalyze.c.html#LN239"><span class='Ref_To_Local'>count_item</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN76"><span class='Ref_to_Typedef'>DECountItem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/hsearch.h.html#LN135"><span class='Ref_to_Proto'>hash_seq_search</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="array_typanalyze.c.html#LN226"><span class='Ref_To_Local'>scan_status</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <a href="array_typanalyze.c.html#LN580"><span class='Ref_To_Local'>sorted_count_items</span></a><span class='Delimiter'>[</span><a href="array_typanalyze.c.html#LN581"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="array_typanalyze.c.html#LN239"><span class='Ref_To_Local'>count_item</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="../../../include/port.h.html#LN439"><span class='Ref_to_Macro'>qsort</span></a><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN580"><span class='Ref_To_Local'>sorted_count_items</span></a><span class='Delimiter'>, </span><a href="array_typanalyze.c.html#LN448"><span class='Ref_To_Local'>count_items_count</span></a><span class='Delimiter'>, 
</span>                  <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN76"><span class='Ref_to_Typedef'>DECountItem</span></a> <span class='Operator'>*</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="array_typanalyze.c.html#LN90"><span class='Ref_to_Proto'>countitem_compare_count</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Prepare to fill stanumbers with the histogram, followed by the 
             * average count.  This array must be stored in anl_context. 
             */ 
</span>            <a href="array_typanalyze.c.html#LN584"><span class='Ref_To_Local'>hist</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN379"><span class='Ref_to_Typedef'>float4</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>                <a href="../../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN214"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/vacuum.h.html#LN84"><span class='Ref_to_Member'>anl_context</span></a><span class='Delimiter'>, 
</span>                                   <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN379"><span class='Ref_to_Typedef'>float4</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN579"><span class='Ref_To_Local'>num_hist</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="array_typanalyze.c.html#LN584"><span class='Ref_To_Local'>hist</span></a><span class='Delimiter'>[</span><a href="array_typanalyze.c.html#LN579"><span class='Ref_To_Local'>num_hist</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="array_typanalyze.c.html#LN234"><span class='Ref_To_Local'>element_no</span></a> <span class='Operator'>/ </span><span class='Parentheses'>(</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="array_typanalyze.c.html#LN447"><span class='Ref_To_Local'>nonnull_cnt</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/*---------- 
             * Construct the histogram of distinct-element counts (DECs). 
             * 
             * The object of this loop is to copy the min and max DECs to 
             * hist[0] and hist[num_hist - 1], along with evenly-spaced DECs 
             * in between (where "evenly-spaced" is with reference to the 
             * whole input population of arrays).  If we had a complete sorted 
             * array of DECs, one per analyzed row, the i'th hist value would 
             * come from DECs[i * (analyzed_rows - 1) / (num_hist - 1)] 
             * (compare the histogram-making loop in compute_scalar_stats()). 
             * But instead of that we have the sorted_count_items[] array, 
             * which holds unique DEC values with their frequencies (that is, 
             * a run-length-compressed version of the full array).  So we 
             * control advancing through sorted_count_items[] with the 
             * variable "frac", which is defined as (x - y) * (num_hist - 1), 
             * where x is the index in the notional DECs array corresponding 
             * to the start of the next sorted_count_items[] element's run, 
             * and y is the index in DECs from which we should take the next 
             * histogram value.  We have to advance whenever x &LT;= y, that is 
             * frac &LT;= 0.  The x component is the sum of the frequencies seen 
             * so far (up through the current sorted_count_items[] element), 
             * and of course y * (num_hist - 1) = i * (analyzed_rows - 1), 
             * per the subscript calculation above.  (The subscript calculation 
             * implies dropping any fractional part of y; in this formulation 
             * that's handled by not advancing until frac reaches 1.) 
             * 
             * Even though frac has a bounded range, it could overflow int32 
             * when working with very large statistics targets, so we do that 
             * math in int64. 
             *---------- 
             */ 
</span>            <a href="array_typanalyze.c.html#LN582"><span class='Ref_To_Local'>delta</span></a> <span class='Operator'>= </span><a href="array_typanalyze.c.html#LN221"><span class='Ref_To_Local'>analyzed_rows</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <a href="array_typanalyze.c.html#LN581"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>              <span class='Comment_Single_Line'>/* current index in sorted_count_items */ 
</span>            <span class='Comment_Multi_Line'>/* Initialize frac for sorted_count_items[0]; y is initially 0 */ 
</span>            <a href="array_typanalyze.c.html#LN583"><span class='Ref_To_Local'>frac</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) </span><a href="array_typanalyze.c.html#LN580"><span class='Ref_To_Local'>sorted_count_items</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="array_typanalyze.c.html#LN79"><span class='Ref_to_Member'>frequency</span></a> <span class='Operator'>* </span><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN579"><span class='Ref_To_Local'>num_hist</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN449"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="array_typanalyze.c.html#LN449"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="array_typanalyze.c.html#LN579"><span class='Ref_To_Local'>num_hist</span></a><span class='Delimiter'>; </span><a href="array_typanalyze.c.html#LN449"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN583"><span class='Ref_To_Local'>frac</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* Advance, and update x component of frac */ 
</span>                    <a href="array_typanalyze.c.html#LN581"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                    <a href="array_typanalyze.c.html#LN583"><span class='Ref_To_Local'>frac</span></a> <span class='Operator'>+= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) </span><a href="array_typanalyze.c.html#LN580"><span class='Ref_To_Local'>sorted_count_items</span></a><span class='Delimiter'>[</span><a href="array_typanalyze.c.html#LN581"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="array_typanalyze.c.html#LN79"><span class='Ref_to_Member'>frequency</span></a> <span class='Operator'>* </span><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN579"><span class='Ref_To_Local'>num_hist</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="array_typanalyze.c.html#LN584"><span class='Ref_To_Local'>hist</span></a><span class='Delimiter'>[</span><a href="array_typanalyze.c.html#LN449"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="array_typanalyze.c.html#LN580"><span class='Ref_To_Local'>sorted_count_items</span></a><span class='Delimiter'>[</span><a href="array_typanalyze.c.html#LN581"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="array_typanalyze.c.html#LN78"><span class='Ref_to_Member'>count</span></a><span class='Delimiter'>; 
</span>                <a href="array_typanalyze.c.html#LN583"><span class='Ref_To_Local'>frac</span></a> <span class='Operator'>-= </span><a href="array_typanalyze.c.html#LN582"><span class='Ref_To_Local'>delta</span></a><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* update y for upcoming i increment */ 
</span>            <span class='Delimiter'>} 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN581"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>== </span><a href="array_typanalyze.c.html#LN448"><span class='Ref_To_Local'>count_items_count</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="array_typanalyze.c.html#LN214"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/vacuum.h.html#LN102"><span class='Ref_to_Member'>stakind</span></a><span class='Delimiter'>[</span><a href="array_typanalyze.c.html#LN236"><span class='Ref_To_Local'>slot_idx</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/catalog/pg_statistic.h.html#LN269"><span class='Ref_to_Const'>STATISTIC_KIND_DECHIST</span></a><span class='Delimiter'>; 
</span>            <a href="array_typanalyze.c.html#LN214"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/vacuum.h.html#LN103"><span class='Ref_to_Member'>staop</span></a><span class='Delimiter'>[</span><a href="array_typanalyze.c.html#LN236"><span class='Ref_To_Local'>slot_idx</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="array_typanalyze.c.html#LN217"><span class='Ref_To_Local'>extra_data</span></a><span class='Operator'>-&GT;</span><a href="array_typanalyze.c.html#LN40"><span class='Ref_to_Member'>eq_opr</span></a><span class='Delimiter'>; 
</span>            <a href="array_typanalyze.c.html#LN214"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/vacuum.h.html#LN105"><span class='Ref_to_Member'>stanumbers</span></a><span class='Delimiter'>[</span><a href="array_typanalyze.c.html#LN236"><span class='Ref_To_Local'>slot_idx</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="array_typanalyze.c.html#LN584"><span class='Ref_To_Local'>hist</span></a><span class='Delimiter'>; 
</span>            <a href="array_typanalyze.c.html#LN214"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/vacuum.h.html#LN104"><span class='Ref_to_Member'>numnumbers</span></a><span class='Delimiter'>[</span><a href="array_typanalyze.c.html#LN236"><span class='Ref_To_Local'>slot_idx</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="array_typanalyze.c.html#LN579"><span class='Ref_To_Local'>num_hist</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <a href="array_typanalyze.c.html#LN236"><span class='Ref_To_Local'>slot_idx</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if count_items_count&GT;0 &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if analyzed_rows&GT;0 &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * We don't need to bother cleaning up any of our temporary palloc's. The 
     * hashtable should also go away, as it used a child memory context. 
     */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end compute_array_stats &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * A function to prune the D structure from the Lossy Counting algorithm. 
 * Consult compute_tsvector_stats() for wider explanation. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN680"></a><span class='Declare_Function'>prune_element_hashtable</span><span class='Parentheses'>(</span><a href="../hash/dynahash.c.html#LN192"><span class='Ref_to_Struct'>HTAB</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>elements_tab</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>b_current</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN682"></a>    <a href="../../../include/utils/hsearch.h.html#LN111"><span class='Ref_to_Typedef'>HASH_SEQ_STATUS</span></a> <span class='Declare_Local'>scan_status</span><span class='Delimiter'>; 
</span><a name="LN683"></a>    <a href="../../tsearch/ts_typanalyze.c.html#LN30"><span class='Ref_to_Typedef'>TrackItem</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>item</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/hsearch.h.html#LN134"><span class='Ref_to_Proto'>hash_seq_init</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="array_typanalyze.c.html#LN682"><span class='Ref_To_Local'>scan_status</span></a><span class='Delimiter'>, </span><a href="array_typanalyze.c.html#LN680"><span class='Ref_to_Parameter'>elements_tab</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="array_typanalyze.c.html#LN683"><span class='Ref_To_Local'>item</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../tsearch/ts_typanalyze.c.html#LN30"><span class='Ref_to_Typedef'>TrackItem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/hsearch.h.html#LN135"><span class='Ref_to_Proto'>hash_seq_search</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="array_typanalyze.c.html#LN682"><span class='Ref_To_Local'>scan_status</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN683"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../tsearch/ts_typanalyze.c.html#LN33"><span class='Ref_to_Member'>frequency</span></a> <span class='Operator'>+ </span><a href="array_typanalyze.c.html#LN683"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../tsearch/ts_typanalyze.c.html#LN34"><span class='Ref_to_Member'>delta</span></a> <span class='Operator'>&LT;= </span><a href="array_typanalyze.c.html#LN680"><span class='Ref_to_Parameter'>b_current</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN690"></a>            <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>value</span> <span class='Operator'>= </span><a href="array_typanalyze.c.html#LN683"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../tsearch/ts_typanalyze.c.html#LN32"><span class='Ref_to_Member'>key</span></a><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/hsearch.h.html#LN125"><span class='Ref_to_Proto'>hash_search</span></a><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN680"><span class='Ref_to_Parameter'>elements_tab</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="array_typanalyze.c.html#LN683"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../tsearch/ts_typanalyze.c.html#LN32"><span class='Ref_to_Member'>key</span></a><span class='Delimiter'>, 
</span>                            <a href="../../../include/utils/hsearch.h.html#LN106"><span class='Ref_to_EnumConst'>HASH_REMOVE</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
                <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"hash table corrupted"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* We should free memory if element is not passed by value */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="array_typanalyze.c.html#LN64"><span class='Ref_to_Global_Var'>array_extra_data</span></a><span class='Operator'>-&GT;</span><a href="array_typanalyze.c.html#LN41"><span class='Ref_to_Member'>typbyval</span></a><span class='Parentheses'>) 
</span>                <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end prune_element_hashtable &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Hash function for elements. 
 * 
 * We use the element type's default hash opclass, and the default collation 
 * if the type is collation-sensitive. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> 
<a name="LN709"></a><span class='Declare_Function'>element_hash</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>key</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Declare_Parameter'>keysize</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN711"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>d</span> <span class='Operator'>= *</span><span class='Parentheses'>((</span><span class='Keyword'>const </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="array_typanalyze.c.html#LN709"><span class='Ref_to_Parameter'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN712"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>h</span><span class='Delimiter'>; 
</span> 
    <a href="array_typanalyze.c.html#LN712"><span class='Ref_To_Local'>h</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN510"><span class='Ref_to_Proto'>FunctionCall1Coll</span></a><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN64"><span class='Ref_to_Global_Var'>array_extra_data</span></a><span class='Operator'>-&GT;</span><a href="array_typanalyze.c.html#LN51"><span class='Ref_to_Member'>hash</span></a><span class='Delimiter'>, </span><a href="../../../include/catalog/pg_collation.h.html#LN74"><span class='Ref_to_Const'>DEFAULT_COLLATION_OID</span></a><span class='Delimiter'>, </span><a href="array_typanalyze.c.html#LN711"><span class='Ref_To_Local'>d</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="../../../include/postgres.h.html#LN491"><span class='Ref_to_Macro'>DatumGetUInt32</span></a><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN712"><span class='Ref_To_Local'>h</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Matching function for elements, to be used in hashtable lookups. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN722"></a><span class='Declare_Function'>element_match</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>key1</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>key2</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Declare_Parameter'>keysize</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* The keysize parameter is superfluous here */ 
</span>    <span class='Control'>return</span> <a href="array_selfuncs.c.html#LN63"><span class='Ref_to_Proto'>element_compare</span></a><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN722"><span class='Ref_to_Parameter'>key1</span></a><span class='Delimiter'>, </span><a href="array_typanalyze.c.html#LN722"><span class='Ref_to_Parameter'>key2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Comparison function for elements. 
 * 
 * We use the element type's default btree opclass, and the default collation 
 * if the type is collation-sensitive. 
 * 
 * XXX consider using SortSupport infrastructure 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN737"></a><span class='Declare_Function'>element_compare</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>key1</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>key2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN739"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>d1</span> <span class='Operator'>= *</span><span class='Parentheses'>((</span><span class='Keyword'>const </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="array_typanalyze.c.html#LN737"><span class='Ref_to_Parameter'>key1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN740"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>d2</span> <span class='Operator'>= *</span><span class='Parentheses'>((</span><span class='Keyword'>const </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="array_typanalyze.c.html#LN737"><span class='Ref_to_Parameter'>key2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN741"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>c</span><span class='Delimiter'>; 
</span> 
    <a href="array_typanalyze.c.html#LN741"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN512"><span class='Ref_to_Proto'>FunctionCall2Coll</span></a><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN64"><span class='Ref_to_Global_Var'>array_extra_data</span></a><span class='Operator'>-&GT;</span><a href="array_typanalyze.c.html#LN50"><span class='Ref_to_Member'>cmp</span></a><span class='Delimiter'>, </span><a href="../../../include/catalog/pg_collation.h.html#LN74"><span class='Ref_to_Const'>DEFAULT_COLLATION_OID</span></a><span class='Delimiter'>, </span><a href="array_typanalyze.c.html#LN739"><span class='Ref_To_Local'>d1</span></a><span class='Delimiter'>, </span><a href="array_typanalyze.c.html#LN740"><span class='Ref_To_Local'>d2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="../../../include/postgres.h.html#LN477"><span class='Ref_to_Macro'>DatumGetInt32</span></a><span class='Parentheses'>(</span><a href="array_typanalyze.c.html#LN741"><span class='Ref_To_Local'>c</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * qsort() comparator for sorting TrackItems by frequencies (descending sort) 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN751"></a><span class='Declare_Function'>trackitem_compare_frequencies_desc</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>e1</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>e2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN753"></a>    <span class='Keyword'>const </span><a href="../../tsearch/ts_typanalyze.c.html#LN30"><span class='Ref_to_Typedef'>TrackItem</span></a> <span class='Operator'>*</span><span class='Keyword'>const </span><span class='Operator'>* </span><span class='Declare_Local'>t1</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../tsearch/ts_typanalyze.c.html#LN30"><span class='Ref_to_Typedef'>TrackItem</span></a> <span class='Operator'>*</span><span class='Keyword'>const </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="array_typanalyze.c.html#LN751"><span class='Ref_to_Parameter'>e1</span></a><span class='Delimiter'>; 
</span><a name="LN754"></a>    <span class='Keyword'>const </span><a href="../../tsearch/ts_typanalyze.c.html#LN30"><span class='Ref_to_Typedef'>TrackItem</span></a> <span class='Operator'>*</span><span class='Keyword'>const </span><span class='Operator'>* </span><span class='Declare_Local'>t2</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../tsearch/ts_typanalyze.c.html#LN30"><span class='Ref_to_Typedef'>TrackItem</span></a> <span class='Operator'>*</span><span class='Keyword'>const </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="array_typanalyze.c.html#LN751"><span class='Ref_to_Parameter'>e2</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="array_typanalyze.c.html#LN754"><span class='Ref_To_Local'>t2</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>frequency <span class='Operator'>- </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="array_typanalyze.c.html#LN753"><span class='Ref_To_Local'>t1</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span><a href="../../tsearch/ts_typanalyze.c.html#LN33"><span class='Ref_to_Member'>frequency</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * qsort() comparator for sorting TrackItems by element values 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN763"></a><span class='Declare_Function'>trackitem_compare_element</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>e1</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>e2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN765"></a>    <span class='Keyword'>const </span><a href="../../tsearch/ts_typanalyze.c.html#LN30"><span class='Ref_to_Typedef'>TrackItem</span></a> <span class='Operator'>*</span><span class='Keyword'>const </span><span class='Operator'>* </span><span class='Declare_Local'>t1</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../tsearch/ts_typanalyze.c.html#LN30"><span class='Ref_to_Typedef'>TrackItem</span></a> <span class='Operator'>*</span><span class='Keyword'>const </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="array_typanalyze.c.html#LN763"><span class='Ref_to_Parameter'>e1</span></a><span class='Delimiter'>; 
</span><a name="LN766"></a>    <span class='Keyword'>const </span><a href="../../tsearch/ts_typanalyze.c.html#LN30"><span class='Ref_to_Typedef'>TrackItem</span></a> <span class='Operator'>*</span><span class='Keyword'>const </span><span class='Operator'>* </span><span class='Declare_Local'>t2</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../tsearch/ts_typanalyze.c.html#LN30"><span class='Ref_to_Typedef'>TrackItem</span></a> <span class='Operator'>*</span><span class='Keyword'>const </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="array_typanalyze.c.html#LN763"><span class='Ref_to_Parameter'>e2</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="array_selfuncs.c.html#LN63"><span class='Ref_to_Proto'>element_compare</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="array_typanalyze.c.html#LN765"><span class='Ref_To_Local'>t1</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span><a href="../../tsearch/ts_typanalyze.c.html#LN32"><span class='Ref_to_Member'>key</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="array_typanalyze.c.html#LN766"><span class='Ref_To_Local'>t2</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span><a href="../../tsearch/ts_typanalyze.c.html#LN32"><span class='Ref_to_Member'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * qsort() comparator for sorting DECountItems by count 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN775"></a><span class='Declare_Function'>countitem_compare_count</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>e1</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>e2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN777"></a>    <span class='Keyword'>const </span><a href="array_typanalyze.c.html#LN76"><span class='Ref_to_Typedef'>DECountItem</span></a> <span class='Operator'>*</span><span class='Keyword'>const </span><span class='Operator'>* </span><span class='Declare_Local'>t1</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="array_typanalyze.c.html#LN76"><span class='Ref_to_Typedef'>DECountItem</span></a> <span class='Operator'>*</span><span class='Keyword'>const </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="array_typanalyze.c.html#LN775"><span class='Ref_to_Parameter'>e1</span></a><span class='Delimiter'>; 
</span><a name="LN778"></a>    <span class='Keyword'>const </span><a href="array_typanalyze.c.html#LN76"><span class='Ref_to_Typedef'>DECountItem</span></a> <span class='Operator'>*</span><span class='Keyword'>const </span><span class='Operator'>* </span><span class='Declare_Local'>t2</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="array_typanalyze.c.html#LN76"><span class='Ref_to_Typedef'>DECountItem</span></a> <span class='Operator'>*</span><span class='Keyword'>const </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="array_typanalyze.c.html#LN775"><span class='Ref_to_Parameter'>e2</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><span class='Operator'>*</span><a href="array_typanalyze.c.html#LN777"><span class='Ref_To_Local'>t1</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span><a href="array_typanalyze.c.html#LN78"><span class='Ref_to_Member'>count</span></a> <span class='Operator'>&LT; </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="array_typanalyze.c.html#LN778"><span class='Ref_To_Local'>t2</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span><a href="array_typanalyze.c.html#LN78"><span class='Ref_to_Member'>count</span></a><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>((</span><span class='Operator'>*</span><a href="array_typanalyze.c.html#LN777"><span class='Ref_To_Local'>t1</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span><a href="array_typanalyze.c.html#LN78"><span class='Ref_to_Member'>count</span></a> <span class='Operator'>== </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="array_typanalyze.c.html#LN778"><span class='Ref_To_Local'>t2</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span><a href="array_typanalyze.c.html#LN78"><span class='Ref_to_Member'>count</span></a><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
} 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>