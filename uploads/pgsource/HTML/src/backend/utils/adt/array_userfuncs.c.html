<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\utils\adt\array_userfuncs.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\utils\adt\array_userfuncs.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:50 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * array_userfuncs.c 
 *    Misc user-visible array support functions 
 * 
 * Copyright (c) 2003-2017, PostgreSQL Global Development Group 
 * 
 * IDENTIFICATION 
 *    src/backend/utils/adt/array_userfuncs.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/array.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/typcache.h"</span> 
 
 
<a name="LN21"></a><span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Prototype'>array_position_common</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN37"><span class='Ref_to_Typedef'>FunctionCallInfo</span></a> <span class='Declare_Parameter'>fcinfo</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * fetch_array_arg_replace_nulls 
 * 
 * Fetch an array-valued argument in expanded form; if it's null, construct an 
 * empty array value of the proper data type.  Also cache basic element type 
 * information in fn_extra. 
 * 
 * Caution: if the input is a read/write pointer, this returns the input 
 * argument; so callers must be sure that their changes are "safe", that is 
 * they cannot leave the array in a corrupt state. 
 * 
 * If we're being called as an aggregate function, make sure any newly-made 
 * expanded array is allocated in the aggregate state context, so as to save 
 * copying operations. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/utils/array.h.html#LN98"><span class='Ref_to_Struct'>ExpandedArrayHeader</span></a> <span class='Operator'>* 
</span><a name="LN40"></a><span class='Declare_Function'>fetch_array_arg_replace_nulls</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN37"><span class='Ref_to_Typedef'>FunctionCallInfo</span></a> <span class='Declare_Parameter'>fcinfo</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>argno</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN42"></a>    <a href="../../../include/utils/array.h.html#LN98"><span class='Ref_to_Struct'>ExpandedArrayHeader</span></a> <span class='Operator'>*</span><span class='Declare_Local'>eah</span><span class='Delimiter'>; 
</span><a name="LN43"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>element_type</span><span class='Delimiter'>; 
</span><a name="LN44"></a>    <a href="../../../include/utils/array.h.html#LN216"><span class='Ref_to_Struct'>ArrayMetaState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>my_extra</span><span class='Delimiter'>; 
</span><a name="LN45"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>resultcxt</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If first time through, create datatype cache struct */ 
</span>    <a href="array_userfuncs.c.html#LN44"><span class='Ref_To_Local'>my_extra</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN216"><span class='Ref_to_Struct'>ArrayMetaState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="array_userfuncs.c.html#LN40"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN78"><span class='Ref_to_Member'>flinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN63"><span class='Ref_to_Member'>fn_extra</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN44"><span class='Ref_To_Local'>my_extra</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="array_userfuncs.c.html#LN44"><span class='Ref_To_Local'>my_extra</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN216"><span class='Ref_to_Struct'>ArrayMetaState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN40"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN78"><span class='Ref_to_Member'>flinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN64"><span class='Ref_to_Member'>fn_mcxt</span></a><span class='Delimiter'>, 
</span>                               <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN216"><span class='Ref_to_Struct'>ArrayMetaState</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="array_userfuncs.c.html#LN44"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN218"><span class='Ref_to_Member'>element_type</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <a href="array_userfuncs.c.html#LN40"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN78"><span class='Ref_to_Member'>flinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN63"><span class='Ref_to_Member'>fn_extra</span></a> <span class='Operator'>= </span><a href="array_userfuncs.c.html#LN44"><span class='Ref_To_Local'>my_extra</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Figure out which context we want the result in */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/fmgr.h.html#LN695"><span class='Ref_to_Proto'>AggCheckCallContext</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN40"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="array_userfuncs.c.html#LN45"><span class='Ref_To_Local'>resultcxt</span></a><span class='Parentheses'>))</span> 
        <a href="array_userfuncs.c.html#LN45"><span class='Ref_To_Local'>resultcxt</span></a> <span class='Operator'>= </span><a href="../mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Now collect the array value */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN40"><span class='Ref_to_Parameter'>argno</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN65"></a>        <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN45"><span class='Ref_To_Local'>resultcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="array_userfuncs.c.html#LN42"><span class='Ref_To_Local'>eah</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN249"><span class='Ref_to_Macro'>PG_GETARG_EXPANDED_ARRAYX</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN40"><span class='Ref_to_Parameter'>argno</span></a><span class='Delimiter'>, </span><a href="array_userfuncs.c.html#LN44"><span class='Ref_To_Local'>my_extra</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN65"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* We have to look up the array type and element type */ 
</span><a name="LN73"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>arr_typeid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN663"><span class='Ref_to_Proto'>get_fn_expr_argtype</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN40"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN78"><span class='Ref_to_Member'>flinfo</span></a><span class='Delimiter'>, </span><a href="array_userfuncs.c.html#LN40"><span class='Ref_to_Parameter'>argno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN73"><span class='Ref_To_Local'>arr_typeid</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not determine input data type"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="array_userfuncs.c.html#LN43"><span class='Ref_To_Local'>element_type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN157"><span class='Ref_to_Proto'>get_element_type</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN73"><span class='Ref_To_Local'>arr_typeid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN43"><span class='Ref_To_Local'>element_type</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"input data type is not an array"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="array_userfuncs.c.html#LN42"><span class='Ref_To_Local'>eah</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN379"><span class='Ref_to_Proto'>construct_empty_expanded_array</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN43"><span class='Ref_To_Local'>element_type</span></a><span class='Delimiter'>, 
</span>                                             <a href="array_userfuncs.c.html#LN45"><span class='Ref_To_Local'>resultcxt</span></a><span class='Delimiter'>, 
</span>                                             <a href="array_userfuncs.c.html#LN44"><span class='Ref_To_Local'>my_extra</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="array_userfuncs.c.html#LN42"><span class='Ref_To_Local'>eah</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end fetch_array_arg_replace_nulls &raquo; </span> 
 
<span class='Comment_Multi_Line'>/*----------------------------------------------------------------------------- 
 * array_append : 
 *      push an element onto the end of a one-dimensional array 
 *---------------------------------------------------------------------------- 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN99"></a><span class='Declare_Function'>array_append</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN101"></a>    <a href="../../../include/utils/array.h.html#LN98"><span class='Ref_to_Struct'>ExpandedArrayHeader</span></a> <span class='Operator'>*</span><span class='Declare_Local'>eah</span><span class='Delimiter'>; 
</span><a name="LN102"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>newelem</span><span class='Delimiter'>; 
</span><a name="LN103"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span><a name="LN104"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN105"></a>    <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Local'>dimv</span><span class='Delimiter'>, 
</span><a name="LN106"></a>               <span class='Operator'>*</span><span class='Declare_Local'>lb</span><span class='Delimiter'>; 
</span><a name="LN107"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>indx</span><span class='Delimiter'>; 
</span><a name="LN108"></a>    <a href="../../../include/utils/array.h.html#LN216"><span class='Ref_to_Struct'>ArrayMetaState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>my_extra</span><span class='Delimiter'>; 
</span> 
    <a href="array_userfuncs.c.html#LN101"><span class='Ref_To_Local'>eah</span></a> <span class='Operator'>= </span><a href="array_userfuncs.c.html#LN39"><span class='Ref_to_Func'>fetch_array_arg_replace_nulls</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="array_userfuncs.c.html#LN103"><span class='Ref_To_Local'>isNull</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN103"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>        <a href="array_userfuncs.c.html#LN102"><span class='Ref_To_Local'>newelem</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="array_userfuncs.c.html#LN102"><span class='Ref_To_Local'>newelem</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN101"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN107"><span class='Ref_to_Member'>ndims</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* append newelem */ 
</span><a name="LN120"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>ub</span><span class='Delimiter'>; 
</span> 
        <a href="array_userfuncs.c.html#LN106"><span class='Ref_To_Local'>lb</span></a> <span class='Operator'>= </span><a href="array_userfuncs.c.html#LN101"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN109"><span class='Ref_to_Member'>lbound</span></a><span class='Delimiter'>; 
</span>        <a href="array_userfuncs.c.html#LN105"><span class='Ref_To_Local'>dimv</span></a> <span class='Operator'>= </span><a href="array_userfuncs.c.html#LN101"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN108"><span class='Ref_to_Member'>dims</span></a><span class='Delimiter'>; 
</span>        <a href="array_userfuncs.c.html#LN120"><span class='Ref_To_Local'>ub</span></a> <span class='Operator'>= </span><a href="array_userfuncs.c.html#LN105"><span class='Ref_To_Local'>dimv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>+ </span><a href="array_userfuncs.c.html#LN106"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="array_userfuncs.c.html#LN107"><span class='Ref_To_Local'>indx</span></a> <span class='Operator'>= </span><a href="array_userfuncs.c.html#LN120"><span class='Ref_To_Local'>ub</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* overflow? */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN107"><span class='Ref_To_Local'>indx</span></a> <span class='Operator'>&LT; </span><a href="array_userfuncs.c.html#LN120"><span class='Ref_To_Local'>ub</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NUMERIC_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"integer out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN101"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN107"><span class='Ref_to_Member'>ndims</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="array_userfuncs.c.html#LN107"><span class='Ref_To_Local'>indx</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATA_EXCEPTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"argument must be empty or one-dimensional array"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Perform element insertion */ 
</span>    <a href="array_userfuncs.c.html#LN108"><span class='Ref_To_Local'>my_extra</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN216"><span class='Ref_to_Struct'>ArrayMetaState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_extra<span class='Delimiter'>; 
</span> 
    <a href="array_userfuncs.c.html#LN104"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN342"><span class='Ref_to_Proto'>array_set_element</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/expandeddatum.h.html#LN135"><span class='Ref_to_Macro'>EOHPGetRWDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="array_userfuncs.c.html#LN101"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN101"><span class='Ref_to_Member'>hdr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                               <span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="array_userfuncs.c.html#LN107"><span class='Ref_To_Local'>indx</span></a><span class='Delimiter'>, </span><a href="array_userfuncs.c.html#LN102"><span class='Ref_To_Local'>newelem</span></a><span class='Delimiter'>, </span><a href="array_userfuncs.c.html#LN103"><span class='Ref_To_Local'>isNull</span></a><span class='Delimiter'>, 
</span>               <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="array_userfuncs.c.html#LN108"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN219"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>, </span><a href="array_userfuncs.c.html#LN108"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN220"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>, </span><a href="array_userfuncs.c.html#LN108"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN221"><span class='Ref_to_Member'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN312"><span class='Ref_to_Macro'>PG_RETURN_DATUM</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN104"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end array_append &raquo; </span> 
 
<span class='Comment_Multi_Line'>/*----------------------------------------------------------------------------- 
 * array_prepend : 
 *      push an element onto the front of a one-dimensional array 
 *---------------------------------------------------------------------------- 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN156"></a><span class='Declare_Function'>array_prepend</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN158"></a>    <a href="../../../include/utils/array.h.html#LN98"><span class='Ref_to_Struct'>ExpandedArrayHeader</span></a> <span class='Operator'>*</span><span class='Declare_Local'>eah</span><span class='Delimiter'>; 
</span><a name="LN159"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>newelem</span><span class='Delimiter'>; 
</span><a name="LN160"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span><a name="LN161"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN162"></a>    <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Local'>lb</span><span class='Delimiter'>; 
</span><a name="LN163"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>indx</span><span class='Delimiter'>; 
</span><a name="LN164"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>lb0</span><span class='Delimiter'>; 
</span><a name="LN165"></a>    <a href="../../../include/utils/array.h.html#LN216"><span class='Ref_to_Struct'>ArrayMetaState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>my_extra</span><span class='Delimiter'>; 
</span> 
    <a href="array_userfuncs.c.html#LN160"><span class='Ref_To_Local'>isNull</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN160"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>        <a href="array_userfuncs.c.html#LN159"><span class='Ref_To_Local'>newelem</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="array_userfuncs.c.html#LN159"><span class='Ref_To_Local'>newelem</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="array_userfuncs.c.html#LN158"><span class='Ref_To_Local'>eah</span></a> <span class='Operator'>= </span><a href="array_userfuncs.c.html#LN39"><span class='Ref_to_Func'>fetch_array_arg_replace_nulls</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN158"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN107"><span class='Ref_to_Member'>ndims</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* prepend newelem */ 
</span>        <a href="array_userfuncs.c.html#LN162"><span class='Ref_To_Local'>lb</span></a> <span class='Operator'>= </span><a href="array_userfuncs.c.html#LN158"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN109"><span class='Ref_to_Member'>lbound</span></a><span class='Delimiter'>; 
</span>        <a href="array_userfuncs.c.html#LN163"><span class='Ref_To_Local'>indx</span></a> <span class='Operator'>= </span><a href="array_userfuncs.c.html#LN162"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="array_userfuncs.c.html#LN164"><span class='Ref_To_Local'>lb0</span></a> <span class='Operator'>= </span><a href="array_userfuncs.c.html#LN162"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span> 
        <span class='Comment_Multi_Line'>/* overflow? */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN163"><span class='Ref_To_Local'>indx</span></a> <span class='Operator'>&GT; </span><a href="array_userfuncs.c.html#LN162"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NUMERIC_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"integer out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN158"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN107"><span class='Ref_to_Member'>ndims</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="array_userfuncs.c.html#LN163"><span class='Ref_To_Local'>indx</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="array_userfuncs.c.html#LN164"><span class='Ref_To_Local'>lb0</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATA_EXCEPTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"argument must be empty or one-dimensional array"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Perform element insertion */ 
</span>    <a href="array_userfuncs.c.html#LN165"><span class='Ref_To_Local'>my_extra</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN216"><span class='Ref_to_Struct'>ArrayMetaState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_extra<span class='Delimiter'>; 
</span> 
    <a href="array_userfuncs.c.html#LN161"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN342"><span class='Ref_to_Proto'>array_set_element</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/expandeddatum.h.html#LN135"><span class='Ref_to_Macro'>EOHPGetRWDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="array_userfuncs.c.html#LN158"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN101"><span class='Ref_to_Member'>hdr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                               <span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="array_userfuncs.c.html#LN163"><span class='Ref_To_Local'>indx</span></a><span class='Delimiter'>, </span><a href="array_userfuncs.c.html#LN159"><span class='Ref_To_Local'>newelem</span></a><span class='Delimiter'>, </span><a href="array_userfuncs.c.html#LN160"><span class='Ref_To_Local'>isNull</span></a><span class='Delimiter'>, 
</span>               <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="array_userfuncs.c.html#LN165"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN219"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>, </span><a href="array_userfuncs.c.html#LN165"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN220"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>, </span><a href="array_userfuncs.c.html#LN165"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN221"><span class='Ref_to_Member'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Readjust result's LB to match the input's, as expected for prepend */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN161"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>== </span><a href="../../../include/utils/expandeddatum.h.html#LN135"><span class='Ref_to_Macro'>EOHPGetRWDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="array_userfuncs.c.html#LN158"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN101"><span class='Ref_to_Member'>hdr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN158"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN107"><span class='Ref_to_Member'>ndims</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* This is ok whether we've deconstructed or not */ 
</span>        <a href="array_userfuncs.c.html#LN158"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN109"><span class='Ref_to_Member'>lbound</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="array_userfuncs.c.html#LN164"><span class='Ref_To_Local'>lb0</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/fmgr.h.html#LN312"><span class='Ref_to_Macro'>PG_RETURN_DATUM</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN161"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end array_prepend &raquo; </span> 
 
<span class='Comment_Multi_Line'>/*----------------------------------------------------------------------------- 
 * array_cat : 
 *      concatenate two nD arrays to form an nD array, or 
 *      push an (n-1)D array onto the end of an nD array 
 *---------------------------------------------------------------------------- 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN222"></a><span class='Declare_Function'>array_cat</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN224"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>v1</span><span class='Delimiter'>, 
</span><a name="LN225"></a>               <span class='Operator'>*</span><span class='Declare_Local'>v2</span><span class='Delimiter'>; 
</span><a name="LN226"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN227"></a>    <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Local'>dims</span><span class='Delimiter'>, 
</span><a name="LN228"></a>               <span class='Operator'>*</span><span class='Declare_Local'>lbs</span><span class='Delimiter'>, 
</span><a name="LN229"></a>                <span class='Declare_Local'>ndims</span><span class='Delimiter'>, 
</span><a name="LN230"></a>                <span class='Declare_Local'>nitems</span><span class='Delimiter'>, 
</span><a name="LN231"></a>                <span class='Declare_Local'>ndatabytes</span><span class='Delimiter'>, 
</span><a name="LN232"></a>                <span class='Declare_Local'>nbytes</span><span class='Delimiter'>; 
</span><a name="LN233"></a>    <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Local'>dims1</span><span class='Delimiter'>, 
</span><a name="LN234"></a>               <span class='Operator'>*</span><span class='Declare_Local'>lbs1</span><span class='Delimiter'>, 
</span><a name="LN235"></a>                <span class='Declare_Local'>ndims1</span><span class='Delimiter'>, 
</span><a name="LN236"></a>                <span class='Declare_Local'>nitems1</span><span class='Delimiter'>, 
</span><a name="LN237"></a>                <span class='Declare_Local'>ndatabytes1</span><span class='Delimiter'>; 
</span><a name="LN238"></a>    <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Local'>dims2</span><span class='Delimiter'>, 
</span><a name="LN239"></a>               <span class='Operator'>*</span><span class='Declare_Local'>lbs2</span><span class='Delimiter'>, 
</span><a name="LN240"></a>                <span class='Declare_Local'>ndims2</span><span class='Delimiter'>, 
</span><a name="LN241"></a>                <span class='Declare_Local'>nitems2</span><span class='Delimiter'>, 
</span><a name="LN242"></a>                <span class='Declare_Local'>ndatabytes2</span><span class='Delimiter'>; 
</span><a name="LN243"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN244"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>dat1</span><span class='Delimiter'>, 
</span><a name="LN245"></a>               <span class='Operator'>*</span><span class='Declare_Local'>dat2</span><span class='Delimiter'>; 
</span><a name="LN246"></a>    <a href="../../../include/c.h.html#LN274"><span class='Ref_to_Typedef'>bits8</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>bitmap1</span><span class='Delimiter'>, 
</span><a name="LN247"></a>               <span class='Operator'>*</span><span class='Declare_Local'>bitmap2</span><span class='Delimiter'>; 
</span><a name="LN248"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>element_type</span><span class='Delimiter'>; 
</span><a name="LN249"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>element_type1</span><span class='Delimiter'>; 
</span><a name="LN250"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>element_type2</span><span class='Delimiter'>; 
</span><a name="LN251"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>dataoffset</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Concatenating a null array is a no-op, just return the other input */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span> 
            <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <a href="array_userfuncs.c.html#LN226"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/array.h.html#LN245"><span class='Ref_to_Macro'>PG_RETURN_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN226"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="array_userfuncs.c.html#LN226"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/array.h.html#LN245"><span class='Ref_to_Macro'>PG_RETURN_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN226"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="array_userfuncs.c.html#LN224"><span class='Ref_To_Local'>v1</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="array_userfuncs.c.html#LN225"><span class='Ref_To_Local'>v2</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="array_userfuncs.c.html#LN249"><span class='Ref_To_Local'>element_type1</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN272"><span class='Ref_to_Macro'>ARR_ELEMTYPE</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN224"><span class='Ref_To_Local'>v1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="array_userfuncs.c.html#LN250"><span class='Ref_To_Local'>element_type2</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN272"><span class='Ref_to_Macro'>ARR_ELEMTYPE</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN225"><span class='Ref_To_Local'>v2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check we have matching element types */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN249"><span class='Ref_To_Local'>element_type1</span></a> <span class='Operator'>!= </span><a href="array_userfuncs.c.html#LN250"><span class='Ref_To_Local'>element_type2</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot concatenate incompatible arrays"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Arrays with element types %s and %s are not "</span> 
                           <span class='String'>"compatible for concatenation."</span><span class='Delimiter'>, 
</span>                           <a href="format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN249"><span class='Ref_To_Local'>element_type1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN250"><span class='Ref_To_Local'>element_type2</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* OK, use it */ 
</span>    <a href="array_userfuncs.c.html#LN248"><span class='Ref_To_Local'>element_type</span></a> <span class='Operator'>= </span><a href="array_userfuncs.c.html#LN249"><span class='Ref_To_Local'>element_type1</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/*---------- 
     * We must have one of the following combinations of inputs: 
     * 1) one empty array, and one non-empty array 
     * 2) both arrays empty 
     * 3) two arrays with ndims1 == ndims2 
     * 4) ndims1 == ndims2 - 1 
     * 5) ndims1 == ndims2 + 1 
     *---------- 
     */ 
</span>    <a href="array_userfuncs.c.html#LN235"><span class='Ref_To_Local'>ndims1</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN224"><span class='Ref_To_Local'>v1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="array_userfuncs.c.html#LN240"><span class='Ref_To_Local'>ndims2</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN225"><span class='Ref_To_Local'>v2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * short circuit - if one input array is empty, and the other is not, we 
     * return the non-empty one as the result 
     * 
     * if both are empty, return the first one 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN235"><span class='Ref_To_Local'>ndims1</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="array_userfuncs.c.html#LN240"><span class='Ref_To_Local'>ndims2</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/array.h.html#LN245"><span class='Ref_to_Macro'>PG_RETURN_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN225"><span class='Ref_To_Local'>v2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN240"><span class='Ref_To_Local'>ndims2</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/array.h.html#LN245"><span class='Ref_to_Macro'>PG_RETURN_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN224"><span class='Ref_To_Local'>v1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* the rest fall under rule 3, 4, or 5 */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN235"><span class='Ref_To_Local'>ndims1</span></a> <span class='Operator'>!= </span><a href="array_userfuncs.c.html#LN240"><span class='Ref_To_Local'>ndims2</span></a> <span class='Operator'>&& 
</span>        <a href="array_userfuncs.c.html#LN235"><span class='Ref_To_Local'>ndims1</span></a> <span class='Operator'>!= </span><a href="array_userfuncs.c.html#LN240"><span class='Ref_To_Local'>ndims2</span></a> <span class='Operator'>- </span><span class='Number'>1</span> <span class='Operator'>&& 
</span>        <a href="array_userfuncs.c.html#LN235"><span class='Ref_To_Local'>ndims1</span></a> <span class='Operator'>!= </span><a href="array_userfuncs.c.html#LN240"><span class='Ref_To_Local'>ndims2</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ARRAY_SUBSCRIPT_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot concatenate incompatible arrays"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Arrays of %d and %d dimensions are not "</span> 
                           <span class='String'>"compatible for concatenation."</span><span class='Delimiter'>, 
</span>                           <a href="array_userfuncs.c.html#LN235"><span class='Ref_To_Local'>ndims1</span></a><span class='Delimiter'>, </span><a href="array_userfuncs.c.html#LN240"><span class='Ref_To_Local'>ndims2</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* get argument array details */ 
</span>    <a href="array_userfuncs.c.html#LN234"><span class='Ref_To_Local'>lbs1</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN276"><span class='Ref_to_Macro'>ARR_LBOUND</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN224"><span class='Ref_To_Local'>v1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="array_userfuncs.c.html#LN239"><span class='Ref_To_Local'>lbs2</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN276"><span class='Ref_to_Macro'>ARR_LBOUND</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN225"><span class='Ref_To_Local'>v2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="array_userfuncs.c.html#LN233"><span class='Ref_To_Local'>dims1</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN224"><span class='Ref_To_Local'>v1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="array_userfuncs.c.html#LN238"><span class='Ref_To_Local'>dims2</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN225"><span class='Ref_To_Local'>v2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="array_userfuncs.c.html#LN244"><span class='Ref_To_Local'>dat1</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN302"><span class='Ref_to_Macro'>ARR_DATA_PTR</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN224"><span class='Ref_To_Local'>v1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="array_userfuncs.c.html#LN245"><span class='Ref_To_Local'>dat2</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN302"><span class='Ref_to_Macro'>ARR_DATA_PTR</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN225"><span class='Ref_To_Local'>v2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="array_userfuncs.c.html#LN246"><span class='Ref_To_Local'>bitmap1</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN280"><span class='Ref_to_Macro'>ARR_NULLBITMAP</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN224"><span class='Ref_To_Local'>v1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="array_userfuncs.c.html#LN247"><span class='Ref_To_Local'>bitmap2</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN280"><span class='Ref_to_Macro'>ARR_NULLBITMAP</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN225"><span class='Ref_To_Local'>v2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="array_userfuncs.c.html#LN236"><span class='Ref_To_Local'>nitems1</span></a> <span class='Operator'>= </span><a href="arrayutils.c.html#LN73"><span class='Ref_to_Func'>ArrayGetNItems</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN235"><span class='Ref_To_Local'>ndims1</span></a><span class='Delimiter'>, </span><a href="array_userfuncs.c.html#LN233"><span class='Ref_To_Local'>dims1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="array_userfuncs.c.html#LN241"><span class='Ref_To_Local'>nitems2</span></a> <span class='Operator'>= </span><a href="arrayutils.c.html#LN73"><span class='Ref_to_Func'>ArrayGetNItems</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN240"><span class='Ref_To_Local'>ndims2</span></a><span class='Delimiter'>, </span><a href="array_userfuncs.c.html#LN238"><span class='Ref_To_Local'>dims2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="array_userfuncs.c.html#LN237"><span class='Ref_To_Local'>ndatabytes1</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN269"><span class='Ref_to_Macro'>ARR_SIZE</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN224"><span class='Ref_To_Local'>v1</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="../../../include/utils/array.h.html#LN296"><span class='Ref_to_Macro'>ARR_DATA_OFFSET</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN224"><span class='Ref_To_Local'>v1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="array_userfuncs.c.html#LN242"><span class='Ref_To_Local'>ndatabytes2</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN269"><span class='Ref_to_Macro'>ARR_SIZE</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN225"><span class='Ref_To_Local'>v2</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="../../../include/utils/array.h.html#LN296"><span class='Ref_to_Macro'>ARR_DATA_OFFSET</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN225"><span class='Ref_To_Local'>v2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN235"><span class='Ref_To_Local'>ndims1</span></a> <span class='Operator'>== </span><a href="array_userfuncs.c.html#LN240"><span class='Ref_To_Local'>ndims2</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * resulting array is made up of the elements (possibly arrays 
         * themselves) of the input argument arrays 
         */ 
</span>        <a href="array_userfuncs.c.html#LN229"><span class='Ref_To_Local'>ndims</span></a> <span class='Operator'>= </span><a href="array_userfuncs.c.html#LN235"><span class='Ref_To_Local'>ndims1</span></a><span class='Delimiter'>; 
</span>        <a href="array_userfuncs.c.html#LN227"><span class='Ref_To_Local'>dims</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN229"><span class='Ref_To_Local'>ndims</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="array_userfuncs.c.html#LN228"><span class='Ref_To_Local'>lbs</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN229"><span class='Ref_To_Local'>ndims</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="array_userfuncs.c.html#LN227"><span class='Ref_To_Local'>dims</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="array_userfuncs.c.html#LN233"><span class='Ref_To_Local'>dims1</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>+ </span><a href="array_userfuncs.c.html#LN238"><span class='Ref_To_Local'>dims2</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span>        <a href="array_userfuncs.c.html#LN228"><span class='Ref_To_Local'>lbs</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="array_userfuncs.c.html#LN234"><span class='Ref_To_Local'>lbs1</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN243"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="array_userfuncs.c.html#LN243"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="array_userfuncs.c.html#LN229"><span class='Ref_To_Local'>ndims</span></a><span class='Delimiter'>; </span><a href="array_userfuncs.c.html#LN243"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN233"><span class='Ref_To_Local'>dims1</span></a><span class='Delimiter'>[</span><a href="array_userfuncs.c.html#LN243"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="array_userfuncs.c.html#LN238"><span class='Ref_To_Local'>dims2</span></a><span class='Delimiter'>[</span><a href="array_userfuncs.c.html#LN243"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>|| </span><a href="array_userfuncs.c.html#LN234"><span class='Ref_To_Local'>lbs1</span></a><span class='Delimiter'>[</span><a href="array_userfuncs.c.html#LN243"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="array_userfuncs.c.html#LN239"><span class='Ref_To_Local'>lbs2</span></a><span class='Delimiter'>[</span><a href="array_userfuncs.c.html#LN243"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ARRAY_SUBSCRIPT_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot concatenate incompatible arrays"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Arrays with differing element dimensions are "</span> 
                              <span class='String'>"not compatible for concatenation."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <a href="array_userfuncs.c.html#LN227"><span class='Ref_To_Local'>dims</span></a><span class='Delimiter'>[</span><a href="array_userfuncs.c.html#LN243"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="array_userfuncs.c.html#LN233"><span class='Ref_To_Local'>dims1</span></a><span class='Delimiter'>[</span><a href="array_userfuncs.c.html#LN243"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>            <a href="array_userfuncs.c.html#LN228"><span class='Ref_To_Local'>lbs</span></a><span class='Delimiter'>[</span><a href="array_userfuncs.c.html#LN243"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="array_userfuncs.c.html#LN234"><span class='Ref_To_Local'>lbs1</span></a><span class='Delimiter'>[</span><a href="array_userfuncs.c.html#LN243"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if ndims1==ndims2 &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN235"><span class='Ref_To_Local'>ndims1</span></a> <span class='Operator'>== </span><a href="array_userfuncs.c.html#LN240"><span class='Ref_To_Local'>ndims2</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * resulting array has the second argument as the outer array, with 
         * the first argument inserted at the front of the outer dimension 
         */ 
</span>        <a href="array_userfuncs.c.html#LN229"><span class='Ref_To_Local'>ndims</span></a> <span class='Operator'>= </span><a href="array_userfuncs.c.html#LN240"><span class='Ref_To_Local'>ndims2</span></a><span class='Delimiter'>; 
</span>        <a href="array_userfuncs.c.html#LN227"><span class='Ref_To_Local'>dims</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN229"><span class='Ref_To_Local'>ndims</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="array_userfuncs.c.html#LN228"><span class='Ref_To_Local'>lbs</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN229"><span class='Ref_To_Local'>ndims</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN227"><span class='Ref_To_Local'>dims</span></a><span class='Delimiter'>, </span><a href="array_userfuncs.c.html#LN238"><span class='Ref_To_Local'>dims2</span></a><span class='Delimiter'>, </span><a href="array_userfuncs.c.html#LN229"><span class='Ref_To_Local'>ndims</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN228"><span class='Ref_To_Local'>lbs</span></a><span class='Delimiter'>, </span><a href="array_userfuncs.c.html#LN239"><span class='Ref_To_Local'>lbs2</span></a><span class='Delimiter'>, </span><a href="array_userfuncs.c.html#LN229"><span class='Ref_To_Local'>ndims</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* increment number of elements in outer array */ 
</span>        <a href="array_userfuncs.c.html#LN227"><span class='Ref_To_Local'>dims</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>+= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* make sure the added element matches our existing elements */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN243"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="array_userfuncs.c.html#LN243"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="array_userfuncs.c.html#LN235"><span class='Ref_To_Local'>ndims1</span></a><span class='Delimiter'>; </span><a href="array_userfuncs.c.html#LN243"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN233"><span class='Ref_To_Local'>dims1</span></a><span class='Delimiter'>[</span><a href="array_userfuncs.c.html#LN243"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="array_userfuncs.c.html#LN227"><span class='Ref_To_Local'>dims</span></a><span class='Delimiter'>[</span><a href="array_userfuncs.c.html#LN243"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>|| </span><a href="array_userfuncs.c.html#LN234"><span class='Ref_To_Local'>lbs1</span></a><span class='Delimiter'>[</span><a href="array_userfuncs.c.html#LN243"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="array_userfuncs.c.html#LN228"><span class='Ref_To_Local'>lbs</span></a><span class='Delimiter'>[</span><a href="array_userfuncs.c.html#LN243"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ARRAY_SUBSCRIPT_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot concatenate incompatible arrays"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Arrays with differing dimensions are not "</span> 
                                   <span class='String'>"compatible for concatenation."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if ndims1==ndims2-1 &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * (ndims1 == ndims2 + 1) 
         * 
         * resulting array has the first argument as the outer array, with the 
         * second argument appended to the end of the outer dimension 
         */ 
</span>        <a href="array_userfuncs.c.html#LN229"><span class='Ref_To_Local'>ndims</span></a> <span class='Operator'>= </span><a href="array_userfuncs.c.html#LN235"><span class='Ref_To_Local'>ndims1</span></a><span class='Delimiter'>; 
</span>        <a href="array_userfuncs.c.html#LN227"><span class='Ref_To_Local'>dims</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN229"><span class='Ref_To_Local'>ndims</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="array_userfuncs.c.html#LN228"><span class='Ref_To_Local'>lbs</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN229"><span class='Ref_To_Local'>ndims</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN227"><span class='Ref_To_Local'>dims</span></a><span class='Delimiter'>, </span><a href="array_userfuncs.c.html#LN233"><span class='Ref_To_Local'>dims1</span></a><span class='Delimiter'>, </span><a href="array_userfuncs.c.html#LN229"><span class='Ref_To_Local'>ndims</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN228"><span class='Ref_To_Local'>lbs</span></a><span class='Delimiter'>, </span><a href="array_userfuncs.c.html#LN234"><span class='Ref_To_Local'>lbs1</span></a><span class='Delimiter'>, </span><a href="array_userfuncs.c.html#LN229"><span class='Ref_To_Local'>ndims</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* increment number of elements in outer array */ 
</span>        <a href="array_userfuncs.c.html#LN227"><span class='Ref_To_Local'>dims</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>+= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* make sure the added element matches our existing elements */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN243"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="array_userfuncs.c.html#LN243"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="array_userfuncs.c.html#LN240"><span class='Ref_To_Local'>ndims2</span></a><span class='Delimiter'>; </span><a href="array_userfuncs.c.html#LN243"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN238"><span class='Ref_To_Local'>dims2</span></a><span class='Delimiter'>[</span><a href="array_userfuncs.c.html#LN243"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="array_userfuncs.c.html#LN227"><span class='Ref_To_Local'>dims</span></a><span class='Delimiter'>[</span><a href="array_userfuncs.c.html#LN243"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>|| </span><a href="array_userfuncs.c.html#LN239"><span class='Ref_To_Local'>lbs2</span></a><span class='Delimiter'>[</span><a href="array_userfuncs.c.html#LN243"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="array_userfuncs.c.html#LN228"><span class='Ref_To_Local'>lbs</span></a><span class='Delimiter'>[</span><a href="array_userfuncs.c.html#LN243"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ARRAY_SUBSCRIPT_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot concatenate incompatible arrays"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Arrays with differing dimensions are not "</span> 
                                   <span class='String'>"compatible for concatenation."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Do this mainly for overflow checking */ 
</span>    <a href="array_userfuncs.c.html#LN230"><span class='Ref_To_Local'>nitems</span></a> <span class='Operator'>= </span><a href="arrayutils.c.html#LN73"><span class='Ref_to_Func'>ArrayGetNItems</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN229"><span class='Ref_To_Local'>ndims</span></a><span class='Delimiter'>, </span><a href="array_userfuncs.c.html#LN227"><span class='Ref_To_Local'>dims</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* build the result array */ 
</span>    <a href="array_userfuncs.c.html#LN231"><span class='Ref_To_Local'>ndatabytes</span></a> <span class='Operator'>= </span><a href="array_userfuncs.c.html#LN237"><span class='Ref_To_Local'>ndatabytes1</span></a> <span class='Operator'>+ </span><a href="array_userfuncs.c.html#LN242"><span class='Ref_To_Local'>ndatabytes2</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN271"><span class='Ref_to_Macro'>ARR_HASNULL</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN224"><span class='Ref_To_Local'>v1</span></a><span class='Parentheses'>) </span><span class='Operator'>|| </span><a href="../../../include/utils/array.h.html#LN271"><span class='Ref_to_Macro'>ARR_HASNULL</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN225"><span class='Ref_To_Local'>v2</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="array_userfuncs.c.html#LN251"><span class='Ref_To_Local'>dataoffset</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN292"><span class='Ref_to_Macro'>ARR_OVERHEAD_WITHNULLS</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN229"><span class='Ref_To_Local'>ndims</span></a><span class='Delimiter'>, </span><a href="array_userfuncs.c.html#LN230"><span class='Ref_To_Local'>nitems</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="array_userfuncs.c.html#LN232"><span class='Ref_To_Local'>nbytes</span></a> <span class='Operator'>= </span><a href="array_userfuncs.c.html#LN231"><span class='Ref_To_Local'>ndatabytes</span></a> <span class='Operator'>+ </span><a href="array_userfuncs.c.html#LN251"><span class='Ref_To_Local'>dataoffset</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="array_userfuncs.c.html#LN251"><span class='Ref_To_Local'>dataoffset</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* marker for no null bitmap */ 
</span>        <a href="array_userfuncs.c.html#LN232"><span class='Ref_To_Local'>nbytes</span></a> <span class='Operator'>= </span><a href="array_userfuncs.c.html#LN231"><span class='Ref_To_Local'>ndatabytes</span></a> <span class='Operator'>+ </span><a href="../../../include/utils/array.h.html#LN290"><span class='Ref_to_Macro'>ARR_OVERHEAD_NONULLS</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN229"><span class='Ref_To_Local'>ndims</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="array_userfuncs.c.html#LN226"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN232"><span class='Ref_To_Local'>nbytes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN226"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="array_userfuncs.c.html#LN232"><span class='Ref_To_Local'>nbytes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="array_userfuncs.c.html#LN226"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN78"><span class='Ref_to_Member'>ndim</span></a> <span class='Operator'>= </span><a href="array_userfuncs.c.html#LN229"><span class='Ref_To_Local'>ndims</span></a><span class='Delimiter'>; 
</span>    <a href="array_userfuncs.c.html#LN226"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN79"><span class='Ref_to_Member'>dataoffset</span></a> <span class='Operator'>= </span><a href="array_userfuncs.c.html#LN251"><span class='Ref_To_Local'>dataoffset</span></a><span class='Delimiter'>; 
</span>    <a href="array_userfuncs.c.html#LN226"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN80"><span class='Ref_to_Member'>elemtype</span></a> <span class='Operator'>= </span><a href="array_userfuncs.c.html#LN248"><span class='Ref_To_Local'>element_type</span></a><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN226"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="array_userfuncs.c.html#LN227"><span class='Ref_To_Local'>dims</span></a><span class='Delimiter'>, </span><a href="array_userfuncs.c.html#LN229"><span class='Ref_To_Local'>ndims</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN276"><span class='Ref_to_Macro'>ARR_LBOUND</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN226"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="array_userfuncs.c.html#LN228"><span class='Ref_To_Local'>lbs</span></a><span class='Delimiter'>, </span><a href="array_userfuncs.c.html#LN229"><span class='Ref_To_Local'>ndims</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* data area is arg1 then arg2 */ 
</span>    memcpy<span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN302"><span class='Ref_to_Macro'>ARR_DATA_PTR</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN226"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="array_userfuncs.c.html#LN244"><span class='Ref_To_Local'>dat1</span></a><span class='Delimiter'>, </span><a href="array_userfuncs.c.html#LN237"><span class='Ref_To_Local'>ndatabytes1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN302"><span class='Ref_to_Macro'>ARR_DATA_PTR</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN226"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="array_userfuncs.c.html#LN237"><span class='Ref_To_Local'>ndatabytes1</span></a><span class='Delimiter'>, </span><a href="array_userfuncs.c.html#LN245"><span class='Ref_To_Local'>dat2</span></a><span class='Delimiter'>, </span><a href="array_userfuncs.c.html#LN242"><span class='Ref_To_Local'>ndatabytes2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* handle the null bitmap if needed */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN271"><span class='Ref_to_Macro'>ARR_HASNULL</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN226"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../include/utils/array.h.html#LN365"><span class='Ref_to_Proto'>array_bitmap_copy</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN280"><span class='Ref_to_Macro'>ARR_NULLBITMAP</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN226"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                          <a href="array_userfuncs.c.html#LN246"><span class='Ref_To_Local'>bitmap1</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                          <a href="array_userfuncs.c.html#LN236"><span class='Ref_To_Local'>nitems1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/array.h.html#LN365"><span class='Ref_to_Proto'>array_bitmap_copy</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN280"><span class='Ref_to_Macro'>ARR_NULLBITMAP</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN226"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="array_userfuncs.c.html#LN236"><span class='Ref_To_Local'>nitems1</span></a><span class='Delimiter'>, 
</span>                          <a href="array_userfuncs.c.html#LN247"><span class='Ref_To_Local'>bitmap2</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                          <a href="array_userfuncs.c.html#LN241"><span class='Ref_To_Local'>nitems2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/utils/array.h.html#LN245"><span class='Ref_to_Macro'>PG_RETURN_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN226"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end array_cat &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * ARRAY_AGG(anynonarray) aggregate function 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN460"></a><span class='Declare_Function'>array_agg_transfn</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN462"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>arg1_typeid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN663"><span class='Ref_to_Proto'>get_fn_expr_argtype</span></a><span class='Parentheses'>(</span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN463"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>aggcontext</span><span class='Delimiter'>; 
</span><a name="LN464"></a>    <a href="../../../include/utils/array.h.html#LN167"><span class='Ref_to_Struct'>ArrayBuildState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span><a name="LN465"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>elem</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN462"><span class='Ref_To_Local'>arg1_typeid</span></a> <span class='Operator'>== </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not determine input data type"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Note: we do not need a run-time check about whether arg1_typeid is a 
     * valid array element type, because the parser would have verified that 
     * while resolving the input/result types of this polymorphic aggregate. 
     */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/fmgr.h.html#LN695"><span class='Ref_to_Proto'>AggCheckCallContext</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Operator'>&</span><a href="array_userfuncs.c.html#LN463"><span class='Ref_To_Local'>aggcontext</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* cannot be called directly because of internal-type argument */ 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"array_agg_transfn called in non-aggregate context"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span> 
        <a href="array_userfuncs.c.html#LN464"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN388"><span class='Ref_to_Proto'>initArrayResult</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN462"><span class='Ref_To_Local'>arg1_typeid</span></a><span class='Delimiter'>, </span><a href="array_userfuncs.c.html#LN463"><span class='Ref_To_Local'>aggcontext</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="array_userfuncs.c.html#LN464"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN167"><span class='Ref_to_Struct'>ArrayBuildState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="array_userfuncs.c.html#LN465"><span class='Ref_To_Local'>elem</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span> <span class='Operator'>: </span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="array_userfuncs.c.html#LN464"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN390"><span class='Ref_to_Proto'>accumArrayResult</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN464"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, 
</span>                             <a href="array_userfuncs.c.html#LN465"><span class='Ref_To_Local'>elem</span></a><span class='Delimiter'>, 
</span>                             <a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="array_userfuncs.c.html#LN462"><span class='Ref_To_Local'>arg1_typeid</span></a><span class='Delimiter'>, 
</span>                             <a href="array_userfuncs.c.html#LN463"><span class='Ref_To_Local'>aggcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The transition type for array_agg() is declared to be "internal", which 
     * is a pass-by-value type the same size as a pointer.  So we can safely 
     * pass the ArrayBuildState pointer through nodeAgg.c's machinations. 
     */ 
</span>    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN464"><span class='Ref_To_Local'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end array_agg_transfn &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN506"></a><span class='Declare_Function'>array_agg_finalfn</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN508"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN509"></a>    <a href="../../../include/utils/array.h.html#LN167"><span class='Ref_to_Struct'>ArrayBuildState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span><a name="LN510"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>dims</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN511"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>lbs</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
    <span class='Comment_Multi_Line'>/* cannot be called directly because of internal-type argument */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN695"><span class='Ref_to_Proto'>AggCheckCallContext</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="array_userfuncs.c.html#LN509"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Null_Value'>NULL </span><span class='Operator'>: </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN167"><span class='Ref_to_Struct'>ArrayBuildState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN509"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* returns null iff no input values */ 
</span> 
    <a href="array_userfuncs.c.html#LN510"><span class='Ref_To_Local'>dims</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="array_userfuncs.c.html#LN509"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN173"><span class='Ref_to_Member'>nelems</span></a><span class='Delimiter'>; 
</span>    <a href="array_userfuncs.c.html#LN511"><span class='Ref_To_Local'>lbs</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Make the result.  We cannot release the ArrayBuildState because 
     * sometimes aggregate final functions are re-executed.  Rather, it is 
     * nodeAgg.c's responsibility to reset the aggcontext when it's safe to do 
     * so. 
     */ 
</span>    <a href="array_userfuncs.c.html#LN508"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN396"><span class='Ref_to_Proto'>makeMdArrayResult</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN509"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="array_userfuncs.c.html#LN510"><span class='Ref_To_Local'>dims</span></a><span class='Delimiter'>, </span><a href="array_userfuncs.c.html#LN511"><span class='Ref_To_Local'>lbs</span></a><span class='Delimiter'>, 
</span>                               <a href="../mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>, 
</span>                               <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN312"><span class='Ref_to_Macro'>PG_RETURN_DATUM</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN508"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end array_agg_finalfn &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ARRAY_AGG(anyarray) aggregate function 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN541"></a><span class='Declare_Function'>array_agg_array_transfn</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN543"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>arg1_typeid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN663"><span class='Ref_to_Proto'>get_fn_expr_argtype</span></a><span class='Parentheses'>(</span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN544"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>aggcontext</span><span class='Delimiter'>; 
</span><a name="LN545"></a>    <a href="../../../include/utils/array.h.html#LN185"><span class='Ref_to_Struct'>ArrayBuildStateArr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN543"><span class='Ref_To_Local'>arg1_typeid</span></a> <span class='Operator'>== </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not determine input data type"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Note: we do not need a run-time check about whether arg1_typeid is a 
     * valid array type, because the parser would have verified that while 
     * resolving the input/result types of this polymorphic aggregate. 
     */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/fmgr.h.html#LN695"><span class='Ref_to_Proto'>AggCheckCallContext</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Operator'>&</span><a href="array_userfuncs.c.html#LN544"><span class='Ref_To_Local'>aggcontext</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* cannot be called directly because of internal-type argument */ 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"array_agg_array_transfn called in non-aggregate context"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span> 
        <a href="array_userfuncs.c.html#LN545"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN399"><span class='Ref_to_Proto'>initArrayResultArr</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN543"><span class='Ref_To_Local'>arg1_typeid</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><a href="array_userfuncs.c.html#LN544"><span class='Ref_To_Local'>aggcontext</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="array_userfuncs.c.html#LN545"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN185"><span class='Ref_to_Struct'>ArrayBuildStateArr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="array_userfuncs.c.html#LN545"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN401"><span class='Ref_to_Proto'>accumArrayResultArr</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN545"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, 
</span>                                <a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="array_userfuncs.c.html#LN543"><span class='Ref_To_Local'>arg1_typeid</span></a><span class='Delimiter'>, 
</span>                                <a href="array_userfuncs.c.html#LN544"><span class='Ref_To_Local'>aggcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The transition type for array_agg() is declared to be "internal", which 
     * is a pass-by-value type the same size as a pointer.  So we can safely 
     * pass the ArrayBuildStateArr pointer through nodeAgg.c's machinations. 
     */ 
</span>    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN545"><span class='Ref_To_Local'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end array_agg_array_transfn &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN585"></a><span class='Declare_Function'>array_agg_array_finalfn</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN587"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN588"></a>    <a href="../../../include/utils/array.h.html#LN185"><span class='Ref_to_Struct'>ArrayBuildStateArr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* cannot be called directly because of internal-type argument */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN695"><span class='Ref_to_Proto'>AggCheckCallContext</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="array_userfuncs.c.html#LN588"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Null_Value'>NULL </span><span class='Operator'>: </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN185"><span class='Ref_to_Struct'>ArrayBuildStateArr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN588"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* returns null iff no input values */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Make the result.  We cannot release the ArrayBuildStateArr because 
     * sometimes aggregate final functions are re-executed.  Rather, it is 
     * nodeAgg.c's responsibility to reset the aggcontext when it's safe to do 
     * so. 
     */ 
</span>    <a href="array_userfuncs.c.html#LN587"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN405"><span class='Ref_to_Proto'>makeArrayResultArr</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN588"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><a href="../mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN312"><span class='Ref_to_Macro'>PG_RETURN_DATUM</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN587"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end array_agg_array_finalfn &raquo; </span> 
 
<span class='Comment_Multi_Line'>/*----------------------------------------------------------------------------- 
 * array_position, array_position_start : 
 *          return the offset of a value in an array. 
 * 
 * IS NOT DISTINCT FROM semantics are used for comparisons.  Return NULL when 
 * the value is not found. 
 *----------------------------------------------------------------------------- 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN618"></a><span class='Declare_Function'>array_position</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="array_userfuncs.c.html#LN21"><span class='Ref_to_Proto'>array_position_common</span></a><span class='Parentheses'>(</span>fcinfo<span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN624"></a><span class='Declare_Function'>array_position_start</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="array_userfuncs.c.html#LN21"><span class='Ref_to_Proto'>array_position_common</span></a><span class='Parentheses'>(</span>fcinfo<span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * array_position_common 
 *      Common code for array_position and array_position_start 
 * 
 * These are separate wrappers for the sake of opr_sanity regression test. 
 * They are not strict so we have to test for null inputs explicitly. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN637"></a><span class='Declare_Function'>array_position_common</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN37"><span class='Ref_to_Typedef'>FunctionCallInfo</span></a> <span class='Declare_Parameter'>fcinfo</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN639"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>array</span><span class='Delimiter'>; 
</span><a name="LN640"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>collation</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN162"><span class='Ref_to_Macro'>PG_GET_COLLATION</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><a name="LN641"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>element_type</span><span class='Delimiter'>; 
</span><a name="LN642"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>searched_element</span><span class='Delimiter'>, 
</span><a name="LN643"></a>                <span class='Declare_Local'>value</span><span class='Delimiter'>; 
</span><a name="LN644"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN645"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>position</span><span class='Delimiter'>, 
</span><a name="LN646"></a>                <span class='Declare_Local'>position_min</span><span class='Delimiter'>; 
</span><a name="LN647"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>found</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN648"></a>    <a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>typentry</span><span class='Delimiter'>; 
</span><a name="LN649"></a>    <a href="../../../include/utils/array.h.html#LN216"><span class='Ref_to_Struct'>ArrayMetaState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>my_extra</span><span class='Delimiter'>; 
</span><a name="LN650"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>null_search</span><span class='Delimiter'>; 
</span><a name="LN651"></a>    <a href="../../../include/utils/array.h.html#LN238"><span class='Ref_to_Typedef'>ArrayIterator</span></a> <span class='Declare_Local'>array_iterator</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="array_userfuncs.c.html#LN639"><span class='Ref_To_Local'>array</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="array_userfuncs.c.html#LN641"><span class='Ref_To_Local'>element_type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN272"><span class='Ref_to_Macro'>ARR_ELEMTYPE</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN639"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We refuse to search for elements in multi-dimensional arrays, since we 
     * have no good way to report the element's location in the array. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN639"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"searching for elements in multidimensional arrays is not supported"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* fast return when the array doesn't have nulls */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/array.h.html#LN386"><span class='Ref_to_Proto'>array_contains_nulls</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN639"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <a href="array_userfuncs.c.html#LN642"><span class='Ref_To_Local'>searched_element</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="array_userfuncs.c.html#LN650"><span class='Ref_To_Local'>null_search</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="array_userfuncs.c.html#LN642"><span class='Ref_To_Local'>searched_element</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="array_userfuncs.c.html#LN650"><span class='Ref_To_Local'>null_search</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="array_userfuncs.c.html#LN645"><span class='Ref_To_Local'>position</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN276"><span class='Ref_to_Macro'>ARR_LBOUND</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN639"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>))</span><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* figure out where to start */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN167"><span class='Ref_to_Macro'>PG_NARGS</span></a><span class='Parentheses'>() </span><span class='Operator'>== </span><span class='Number'>3</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>))</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NULL_VALUE_NOT_ALLOWED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"initial position must not be null"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="array_userfuncs.c.html#LN646"><span class='Ref_To_Local'>position_min</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="array_userfuncs.c.html#LN646"><span class='Ref_To_Local'>position_min</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN276"><span class='Ref_to_Macro'>ARR_LBOUND</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN639"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>))</span><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We arrange to look up type info for array_create_iterator only once per 
     * series of calls, assuming the element type doesn't change underneath 
     * us. 
     */ 
</span>    <a href="array_userfuncs.c.html#LN649"><span class='Ref_To_Local'>my_extra</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN216"><span class='Ref_to_Struct'>ArrayMetaState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="array_userfuncs.c.html#LN637"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN78"><span class='Ref_to_Member'>flinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN63"><span class='Ref_to_Member'>fn_extra</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN649"><span class='Ref_To_Local'>my_extra</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="array_userfuncs.c.html#LN637"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN78"><span class='Ref_to_Member'>flinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN63"><span class='Ref_to_Member'>fn_extra</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN637"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN78"><span class='Ref_to_Member'>flinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN64"><span class='Ref_to_Member'>fn_mcxt</span></a><span class='Delimiter'>, 
</span>                                                      <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN216"><span class='Ref_to_Struct'>ArrayMetaState</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="array_userfuncs.c.html#LN649"><span class='Ref_To_Local'>my_extra</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN216"><span class='Ref_to_Struct'>ArrayMetaState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="array_userfuncs.c.html#LN637"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN78"><span class='Ref_to_Member'>flinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN63"><span class='Ref_to_Member'>fn_extra</span></a><span class='Delimiter'>; 
</span>        <a href="array_userfuncs.c.html#LN649"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN218"><span class='Ref_to_Member'>element_type</span></a> <span class='Operator'>= ~</span><a href="array_userfuncs.c.html#LN641"><span class='Ref_To_Local'>element_type</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN649"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN218"><span class='Ref_to_Member'>element_type</span></a> <span class='Operator'>!= </span><a href="array_userfuncs.c.html#LN641"><span class='Ref_To_Local'>element_type</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/utils/lsyscache.h.html#LN136"><span class='Ref_to_Proto'>get_typlenbyvalalign</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN641"><span class='Ref_To_Local'>element_type</span></a><span class='Delimiter'>, 
</span>                             <span class='Operator'>&</span><a href="array_userfuncs.c.html#LN649"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN219"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>, 
</span>                             <span class='Operator'>&</span><a href="array_userfuncs.c.html#LN649"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN220"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>, 
</span>                             <span class='Operator'>&</span><a href="array_userfuncs.c.html#LN649"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN221"><span class='Ref_to_Member'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="array_userfuncs.c.html#LN648"><span class='Ref_To_Local'>typentry</span></a> <span class='Operator'>= </span><a href="../../../include/utils/typcache.h.html#LN142"><span class='Ref_to_Proto'>lookup_type_cache</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN641"><span class='Ref_To_Local'>element_type</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/typcache.h.html#LN114"><span class='Ref_to_Const'>TYPECACHE_EQ_OPR_FINFO</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN648"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN66"><span class='Ref_to_Member'>eq_opr_finfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN58"><span class='Ref_to_Member'>fn_oid</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_FUNCTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not identify an equality operator for type %s"</span><span class='Delimiter'>, 
</span>                       <a href="format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN641"><span class='Ref_To_Local'>element_type</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
        <a href="array_userfuncs.c.html#LN649"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN218"><span class='Ref_to_Member'>element_type</span></a> <span class='Operator'>= </span><a href="array_userfuncs.c.html#LN641"><span class='Ref_To_Local'>element_type</span></a><span class='Delimiter'>; 
</span>        <a href="../../../include/fmgr.h.html#LN99"><span class='Ref_to_Proto'>fmgr_info_cxt</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN648"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN66"><span class='Ref_to_Member'>eq_opr_finfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN58"><span class='Ref_to_Member'>fn_oid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="array_userfuncs.c.html#LN649"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN225"><span class='Ref_to_Member'>proc</span></a><span class='Delimiter'>, 
</span>                      <a href="array_userfuncs.c.html#LN637"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN78"><span class='Ref_to_Member'>flinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN64"><span class='Ref_to_Member'>fn_mcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Examine each array element until we find a match. */ 
</span>    <a href="array_userfuncs.c.html#LN651"><span class='Ref_To_Local'>array_iterator</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN417"><span class='Ref_to_Proto'>array_create_iterator</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN639"><span class='Ref_To_Local'>array</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="array_userfuncs.c.html#LN649"><span class='Ref_To_Local'>my_extra</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN418"><span class='Ref_to_Proto'>array_iterate</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN651"><span class='Ref_To_Local'>array_iterator</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Keyword'>value</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="array_userfuncs.c.html#LN644"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="array_userfuncs.c.html#LN645"><span class='Ref_To_Local'>position</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* skip initial elements if caller requested so */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN645"><span class='Ref_To_Local'>position</span></a> <span class='Operator'>&LT; </span><a href="array_userfuncs.c.html#LN646"><span class='Ref_To_Local'>position_min</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Can't look at the array element's value if it's null; but if we 
         * search for null, we have a hit and are done. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN644"><span class='Ref_To_Local'>isnull</span></a> <span class='Operator'>|| </span><a href="array_userfuncs.c.html#LN650"><span class='Ref_To_Local'>null_search</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN644"><span class='Ref_To_Local'>isnull</span></a> <span class='Operator'>&& </span><a href="array_userfuncs.c.html#LN650"><span class='Ref_To_Local'>null_search</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="array_userfuncs.c.html#LN647"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* not nulls, so run the operator */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN512"><span class='Ref_to_Proto'>FunctionCall2Coll</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="array_userfuncs.c.html#LN649"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN225"><span class='Ref_to_Member'>proc</span></a><span class='Delimiter'>, </span><a href="array_userfuncs.c.html#LN640"><span class='Ref_To_Local'>collation</span></a><span class='Delimiter'>, 
</span>                                           <a href="array_userfuncs.c.html#LN642"><span class='Ref_To_Local'>searched_element</span></a><span class='Delimiter'>, </span><span class='Keyword'>value</span><span class='Parentheses'>)))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="array_userfuncs.c.html#LN647"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while array_iterate(array_i... &raquo; </span> 
 
    <a href="../../../include/utils/array.h.html#LN419"><span class='Ref_to_Proto'>array_free_iterator</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN651"><span class='Ref_To_Local'>array_iterator</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Avoid leaking memory when handed toasted input */ 
</span>    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN639"><span class='Ref_To_Local'>array</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="array_userfuncs.c.html#LN647"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN313"><span class='Ref_to_Macro'>PG_RETURN_INT32</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN645"><span class='Ref_To_Local'>position</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end array_position_common &raquo; </span> 
 
<span class='Comment_Multi_Line'>/*----------------------------------------------------------------------------- 
 * array_positions : 
 *          return an array of positions of a value in an array. 
 * 
 * IS NOT DISTINCT FROM semantics are used for comparisons.  Returns NULL when 
 * the input array is NULL.  When the value is not found in the array, returns 
 * an empty array. 
 * 
 * This is not strict so we have to test for null inputs explicitly. 
 *----------------------------------------------------------------------------- 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN788"></a><span class='Declare_Function'>array_positions</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN790"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>array</span><span class='Delimiter'>; 
</span><a name="LN791"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>collation</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN162"><span class='Ref_to_Macro'>PG_GET_COLLATION</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><a name="LN792"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>element_type</span><span class='Delimiter'>; 
</span><a name="LN793"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>searched_element</span><span class='Delimiter'>, 
</span><a name="LN794"></a>                <span class='Declare_Local'>value</span><span class='Delimiter'>; 
</span><a name="LN795"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN796"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>position</span><span class='Delimiter'>; 
</span><a name="LN797"></a>    <a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>typentry</span><span class='Delimiter'>; 
</span><a name="LN798"></a>    <a href="../../../include/utils/array.h.html#LN216"><span class='Ref_to_Struct'>ArrayMetaState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>my_extra</span><span class='Delimiter'>; 
</span><a name="LN799"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>null_search</span><span class='Delimiter'>; 
</span><a name="LN800"></a>    <a href="../../../include/utils/array.h.html#LN238"><span class='Ref_to_Typedef'>ArrayIterator</span></a> <span class='Declare_Local'>array_iterator</span><span class='Delimiter'>; 
</span><a name="LN801"></a>    <a href="../../../include/utils/array.h.html#LN167"><span class='Ref_to_Struct'>ArrayBuildState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>astate</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="array_userfuncs.c.html#LN790"><span class='Ref_To_Local'>array</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="array_userfuncs.c.html#LN792"><span class='Ref_To_Local'>element_type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN272"><span class='Ref_to_Macro'>ARR_ELEMTYPE</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN790"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="array_userfuncs.c.html#LN796"><span class='Ref_To_Local'>position</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN276"><span class='Ref_to_Macro'>ARR_LBOUND</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN790"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>))</span><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We refuse to search for elements in multi-dimensional arrays, since we 
     * have no good way to report the element's location in the array. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN790"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"searching for elements in multidimensional arrays is not supported"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="array_userfuncs.c.html#LN801"><span class='Ref_To_Local'>astate</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN388"><span class='Ref_to_Proto'>initArrayResult</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN24"><span class='Ref_to_Const'>INT4OID</span></a><span class='Delimiter'>, </span><a href="../mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* fast return when the array doesn't have nulls */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/array.h.html#LN386"><span class='Ref_to_Proto'>array_contains_nulls</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN790"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/fmgr.h.html#LN312"><span class='Ref_to_Macro'>PG_RETURN_DATUM</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN394"><span class='Ref_to_Proto'>makeArrayResult</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN801"><span class='Ref_To_Local'>astate</span></a><span class='Delimiter'>, </span><a href="../mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="array_userfuncs.c.html#LN793"><span class='Ref_To_Local'>searched_element</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="array_userfuncs.c.html#LN799"><span class='Ref_To_Local'>null_search</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="array_userfuncs.c.html#LN793"><span class='Ref_To_Local'>searched_element</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="array_userfuncs.c.html#LN799"><span class='Ref_To_Local'>null_search</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We arrange to look up type info for array_create_iterator only once per 
     * series of calls, assuming the element type doesn't change underneath 
     * us. 
     */ 
</span>    <a href="array_userfuncs.c.html#LN798"><span class='Ref_To_Local'>my_extra</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN216"><span class='Ref_to_Struct'>ArrayMetaState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_extra<span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN798"><span class='Ref_To_Local'>my_extra</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_extra <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_mcxt<span class='Delimiter'>, 
</span>                                                      <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN216"><span class='Ref_to_Struct'>ArrayMetaState</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="array_userfuncs.c.html#LN798"><span class='Ref_To_Local'>my_extra</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN216"><span class='Ref_to_Struct'>ArrayMetaState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_extra<span class='Delimiter'>; 
</span>        <a href="array_userfuncs.c.html#LN798"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN218"><span class='Ref_to_Member'>element_type</span></a> <span class='Operator'>= ~</span><a href="array_userfuncs.c.html#LN792"><span class='Ref_To_Local'>element_type</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN798"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN218"><span class='Ref_to_Member'>element_type</span></a> <span class='Operator'>!= </span><a href="array_userfuncs.c.html#LN792"><span class='Ref_To_Local'>element_type</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/utils/lsyscache.h.html#LN136"><span class='Ref_to_Proto'>get_typlenbyvalalign</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN792"><span class='Ref_To_Local'>element_type</span></a><span class='Delimiter'>, 
</span>                             <span class='Operator'>&</span><a href="array_userfuncs.c.html#LN798"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN219"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>, 
</span>                             <span class='Operator'>&</span><a href="array_userfuncs.c.html#LN798"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN220"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>, 
</span>                             <span class='Operator'>&</span><a href="array_userfuncs.c.html#LN798"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN221"><span class='Ref_to_Member'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="array_userfuncs.c.html#LN797"><span class='Ref_To_Local'>typentry</span></a> <span class='Operator'>= </span><a href="../../../include/utils/typcache.h.html#LN142"><span class='Ref_to_Proto'>lookup_type_cache</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN792"><span class='Ref_To_Local'>element_type</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/typcache.h.html#LN114"><span class='Ref_to_Const'>TYPECACHE_EQ_OPR_FINFO</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN797"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN66"><span class='Ref_to_Member'>eq_opr_finfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN58"><span class='Ref_to_Member'>fn_oid</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_FUNCTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not identify an equality operator for type %s"</span><span class='Delimiter'>, 
</span>                       <a href="format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN792"><span class='Ref_To_Local'>element_type</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
        <a href="array_userfuncs.c.html#LN798"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN218"><span class='Ref_to_Member'>element_type</span></a> <span class='Operator'>= </span><a href="array_userfuncs.c.html#LN792"><span class='Ref_To_Local'>element_type</span></a><span class='Delimiter'>; 
</span>        <a href="../../../include/fmgr.h.html#LN99"><span class='Ref_to_Proto'>fmgr_info_cxt</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN797"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN66"><span class='Ref_to_Member'>eq_opr_finfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN58"><span class='Ref_to_Member'>fn_oid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="array_userfuncs.c.html#LN798"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN225"><span class='Ref_to_Member'>proc</span></a><span class='Delimiter'>, 
</span>                      fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_mcxt<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Accumulate each array position iff the element matches the given 
     * element. 
     */ 
</span>    <a href="array_userfuncs.c.html#LN800"><span class='Ref_To_Local'>array_iterator</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN417"><span class='Ref_to_Proto'>array_create_iterator</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN790"><span class='Ref_To_Local'>array</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="array_userfuncs.c.html#LN798"><span class='Ref_To_Local'>my_extra</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN418"><span class='Ref_to_Proto'>array_iterate</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN800"><span class='Ref_To_Local'>array_iterator</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Keyword'>value</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="array_userfuncs.c.html#LN795"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="array_userfuncs.c.html#LN796"><span class='Ref_To_Local'>position</span></a> <span class='Operator'>+= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Can't look at the array element's value if it's null; but if we 
         * search for null, we have a hit. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN795"><span class='Ref_To_Local'>isnull</span></a> <span class='Operator'>|| </span><a href="array_userfuncs.c.html#LN799"><span class='Ref_To_Local'>null_search</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN795"><span class='Ref_To_Local'>isnull</span></a> <span class='Operator'>&& </span><a href="array_userfuncs.c.html#LN799"><span class='Ref_To_Local'>null_search</span></a><span class='Parentheses'>) 
</span>                <a href="array_userfuncs.c.html#LN801"><span class='Ref_To_Local'>astate</span></a> <span class='Operator'>= 
</span>                    <a href="../../../include/utils/array.h.html#LN390"><span class='Ref_to_Proto'>accumArrayResult</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN801"><span class='Ref_To_Local'>astate</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN484"><span class='Ref_to_Macro'>Int32GetDatum</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN796"><span class='Ref_To_Local'>position</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                     <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN24"><span class='Ref_to_Const'>INT4OID</span></a><span class='Delimiter'>, </span><a href="../mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* not nulls, so run the operator */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN512"><span class='Ref_to_Proto'>FunctionCall2Coll</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="array_userfuncs.c.html#LN798"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN225"><span class='Ref_to_Member'>proc</span></a><span class='Delimiter'>, </span><a href="array_userfuncs.c.html#LN791"><span class='Ref_To_Local'>collation</span></a><span class='Delimiter'>, 
</span>                                           <a href="array_userfuncs.c.html#LN793"><span class='Ref_To_Local'>searched_element</span></a><span class='Delimiter'>, </span><span class='Keyword'>value</span><span class='Parentheses'>)))</span> 
            <a href="array_userfuncs.c.html#LN801"><span class='Ref_To_Local'>astate</span></a> <span class='Operator'>= 
</span>                <a href="../../../include/utils/array.h.html#LN390"><span class='Ref_to_Proto'>accumArrayResult</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN801"><span class='Ref_To_Local'>astate</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN484"><span class='Ref_to_Macro'>Int32GetDatum</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN796"><span class='Ref_To_Local'>position</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                 <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN24"><span class='Ref_to_Const'>INT4OID</span></a><span class='Delimiter'>, </span><a href="../mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while array_iterate(array_i... &raquo; </span> 
 
    <a href="../../../include/utils/array.h.html#LN419"><span class='Ref_to_Proto'>array_free_iterator</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN800"><span class='Ref_To_Local'>array_iterator</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Avoid leaking memory when handed toasted input */ 
</span>    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN790"><span class='Ref_To_Local'>array</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN312"><span class='Ref_to_Macro'>PG_RETURN_DATUM</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN394"><span class='Ref_to_Proto'>makeArrayResult</span></a><span class='Parentheses'>(</span><a href="array_userfuncs.c.html#LN801"><span class='Ref_To_Local'>astate</span></a><span class='Delimiter'>, </span><a href="../mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end array_positions &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>