<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\utils\adt\arrayfuncs.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\utils\adt\arrayfuncs.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:50 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * arrayfuncs.c 
 *    Support functions for arrays. 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/utils/adt/arrayfuncs.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;ctype.h&GT;</span> 
<span class='Directive'>#ifdef</span> _MSC_VER 
<span class='Keyword'>#include </span><span class='String'>&LT;float.h&GT;</span>              <span class='Comment_Single_Line'>/* for _isnan */ 
</span><span class='Directive'>#endif</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;math.h&GT;</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"funcapi.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"libpq/pqformat.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/array.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/arrayaccess.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/datum.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/memutils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/typcache.h"</span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * GUC parameter 
 */ 
</span><a name="LN38"></a><span class='Keyword'>bool</span>        <span class='Declare_Var'>Array_nulls</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Local definitions 
 */ 
</span><a name="LN43"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>ASSGN</span>    <span class='String'>"="</span> 
 
<a name="LN45"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>AARR_FREE_IF_COPY</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>array</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>n</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Control'>do</span> <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/expandeddatum.h.html#LN127"><span class='Ref_to_Macro'>VARATT_IS_EXPANDED_HEADER</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN45"><span class='Ref_to_Parameter'>array</span></a><span class='Parentheses'>))</span> <span class='Operator'>\ 
</span>            <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN45"><span class='Ref_to_Parameter'>array</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN45"><span class='Ref_to_Parameter'>n</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>    <span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) 
</span> 
<span class='Control'>typedef</span> <span class='Control'>enum</span> 
<span class='Delimiter'>{ 
</span><a name="LN53"></a>    <span class='Declare_Enum_Const'>ARRAY_NO_LEVEL</span><span class='Delimiter'>, 
</span><a name="LN54"></a>    <span class='Declare_Enum_Const'>ARRAY_LEVEL_STARTED</span><span class='Delimiter'>, 
</span><a name="LN55"></a>    <span class='Declare_Enum_Const'>ARRAY_ELEM_STARTED</span><span class='Delimiter'>, 
</span><a name="LN56"></a>    <span class='Declare_Enum_Const'>ARRAY_ELEM_COMPLETED</span><span class='Delimiter'>, 
</span><a name="LN57"></a>    <span class='Declare_Enum_Const'>ARRAY_QUOTED_ELEM_STARTED</span><span class='Delimiter'>, 
</span><a name="LN58"></a>    <span class='Declare_Enum_Const'>ARRAY_QUOTED_ELEM_COMPLETED</span><span class='Delimiter'>, 
</span><a name="LN59"></a>    <span class='Declare_Enum_Const'>ARRAY_ELEM_DELIMITED</span><span class='Delimiter'>, 
</span><a name="LN60"></a>    <span class='Declare_Enum_Const'>ARRAY_LEVEL_COMPLETED</span><span class='Delimiter'>, 
</span><a name="LN61"></a>    <span class='Declare_Enum_Const'>ARRAY_LEVEL_DELIMITED</span> 
<a name="LN62"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>ArrayParseState</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* Working state for array_iterate() */ 
</span><a name="LN65"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>ArrayIteratorData</span> 
<span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* basic info about the array, set up during array_create_iterator() */ 
</span><a name="LN68"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Member'>arr</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* array we're iterating through */ 
</span><a name="LN69"></a>    <a href="../../../include/c.h.html#LN274"><span class='Ref_to_Typedef'>bits8</span></a>      <span class='Operator'>*</span><span class='Declare_Member'>nullbitmap</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* its null bitmap, if any */ 
</span><a name="LN70"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>nitems</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* total number of elements in array */ 
</span><a name="LN71"></a>    <a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>       <span class='Declare_Member'>typlen</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* element type's length */ 
</span><a name="LN72"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>typbyval</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* element type's byval property */ 
</span><a name="LN73"></a>    <span class='Keyword'>char</span>        <span class='Declare_Member'>typalign</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* element type's align property */ 
</span> 
    <span class='Comment_Multi_Line'>/* information about the requested slice size */ 
</span><a name="LN76"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>slice_ndim</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* slice dimension, or 0 if not slicing */ 
</span><a name="LN77"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>slice_len</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* number of elements per slice */ 
</span><a name="LN78"></a>    <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Member'>slice_dims</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* slice dims array */ 
</span><a name="LN79"></a>    <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Member'>slice_lbound</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* slice lbound array */ 
</span><a name="LN80"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Member'>slice_values</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* workspace of length slice_len */ 
</span><a name="LN81"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Member'>slice_nulls</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* workspace of length slice_len */ 
</span> 
    <span class='Comment_Multi_Line'>/* current position information, updated on each iteration */ 
</span><a name="LN84"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>data_ptr</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* our current position in the array */ 
</span><a name="LN85"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>current_item</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* the item # we're at in the array */ 
</span><a name="LN86"></a><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end ArrayIteratorData &raquo; </span>   <span class='Declare_Typedef'>ArrayIteratorData</span><span class='Delimiter'>; 
</span> 
<a name="LN88"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>array_isspace</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Declare_Parameter'>ch</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN89"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>ArrayCount</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>dim</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>typdelim</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN90"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ReadArrayStr</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>arrayStr</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>origStr</span><span class='Delimiter'>, 
</span><a name="LN91"></a>             <span class='Keyword'>int </span><span class='Declare_Parameter'>nitems</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>ndim</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>dim</span><span class='Delimiter'>, 
</span><a name="LN92"></a>             <a href="../../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>inputproc</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typioparam</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>typmod</span><span class='Delimiter'>, 
</span><a name="LN93"></a>             <span class='Keyword'>char </span><span class='Declare_Parameter'>typdelim</span><span class='Delimiter'>, 
</span><a name="LN94"></a>             <span class='Keyword'>int </span><span class='Declare_Parameter'>typlen</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>typbyval</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>typalign</span><span class='Delimiter'>, 
</span><a name="LN95"></a>             <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>values</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>nulls</span><span class='Delimiter'>, 
</span><a name="LN96"></a>             <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>hasnulls</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>nbytes</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN97"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ReadArrayBinary</span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>nitems</span><span class='Delimiter'>, 
</span><a name="LN98"></a>                <a href="../../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>receiveproc</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typioparam</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>typmod</span><span class='Delimiter'>, 
</span><a name="LN99"></a>                <span class='Keyword'>int </span><span class='Declare_Parameter'>typlen</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>typbyval</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>typalign</span><span class='Delimiter'>, 
</span><a name="LN100"></a>                <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>values</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>nulls</span><span class='Delimiter'>, 
</span><a name="LN101"></a>                <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>hasnulls</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>nbytes</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN102"></a><span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Prototype'>array_get_element_expanded</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>arraydatum</span><span class='Delimiter'>, 
</span><a name="LN103"></a>                           <span class='Keyword'>int </span><span class='Declare_Parameter'>nSubscripts</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>indx</span><span class='Delimiter'>, 
</span><a name="LN104"></a>                           <span class='Keyword'>int </span><span class='Declare_Parameter'>arraytyplen</span><span class='Delimiter'>, 
</span><a name="LN105"></a>                           <span class='Keyword'>int </span><span class='Declare_Parameter'>elmlen</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>elmbyval</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>elmalign</span><span class='Delimiter'>, 
</span><a name="LN106"></a>                           <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>isNull</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN107"></a><span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Prototype'>array_set_element_expanded</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>arraydatum</span><span class='Delimiter'>, 
</span><a name="LN108"></a>                           <span class='Keyword'>int </span><span class='Declare_Parameter'>nSubscripts</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>indx</span><span class='Delimiter'>, 
</span><a name="LN109"></a>                           <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>dataValue</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isNull</span><span class='Delimiter'>, 
</span><a name="LN110"></a>                           <span class='Keyword'>int </span><span class='Declare_Parameter'>arraytyplen</span><span class='Delimiter'>, 
</span><a name="LN111"></a>                           <span class='Keyword'>int </span><span class='Declare_Parameter'>elmlen</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>elmbyval</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>elmalign</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN112"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>array_get_isnull</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../../include/c.h.html#LN274"><span class='Ref_to_Typedef'>bits8</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>nullbitmap</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>offset</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN113"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>array_set_isnull</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN274"><span class='Ref_to_Typedef'>bits8</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>nullbitmap</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>offset</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isNull</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN114"></a><span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Prototype'>ArrayCast</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>value</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>byval</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>len</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN115"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>ArrayCastAndSet</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>src</span><span class='Delimiter'>, 
</span><a name="LN116"></a>                <span class='Keyword'>int </span><span class='Declare_Parameter'>typlen</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>typbyval</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>typalign</span><span class='Delimiter'>, 
</span><a name="LN117"></a>                <span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>dest</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN118"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Prototype'>array_seek</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>ptr</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>offset</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN274"><span class='Ref_to_Typedef'>bits8</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>nullbitmap</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>nitems</span><span class='Delimiter'>, 
</span><a name="LN119"></a>           <span class='Keyword'>int </span><span class='Declare_Parameter'>typlen</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>typbyval</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>typalign</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN120"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>array_nelems_size</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>ptr</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>offset</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN274"><span class='Ref_to_Typedef'>bits8</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>nullbitmap</span><span class='Delimiter'>, 
</span><a name="LN121"></a>                  <span class='Keyword'>int </span><span class='Declare_Parameter'>nitems</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>typlen</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>typbyval</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>typalign</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN122"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>array_copy</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>destptr</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>nitems</span><span class='Delimiter'>, 
</span><a name="LN123"></a>           <span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>srcptr</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>offset</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN274"><span class='Ref_to_Typedef'>bits8</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>nullbitmap</span><span class='Delimiter'>, 
</span><a name="LN124"></a>           <span class='Keyword'>int </span><span class='Declare_Parameter'>typlen</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>typbyval</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>typalign</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN125"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>array_slice_size</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>arraydataptr</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN274"><span class='Ref_to_Typedef'>bits8</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arraynullsptr</span><span class='Delimiter'>, 
</span><a name="LN126"></a>                 <span class='Keyword'>int </span><span class='Declare_Parameter'>ndim</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>dim</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>lb</span><span class='Delimiter'>, 
</span><a name="LN127"></a>                 <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>st</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>endp</span><span class='Delimiter'>, 
</span><a name="LN128"></a>                 <span class='Keyword'>int </span><span class='Declare_Parameter'>typlen</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>typbyval</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>typalign</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN129"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>array_extract_slice</span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>newarray</span><span class='Delimiter'>, 
</span><a name="LN130"></a>                    <span class='Keyword'>int </span><span class='Declare_Parameter'>ndim</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>dim</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>lb</span><span class='Delimiter'>, 
</span><a name="LN131"></a>                    <span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>arraydataptr</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN274"><span class='Ref_to_Typedef'>bits8</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arraynullsptr</span><span class='Delimiter'>, 
</span><a name="LN132"></a>                    <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>st</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>endp</span><span class='Delimiter'>, 
</span><a name="LN133"></a>                    <span class='Keyword'>int </span><span class='Declare_Parameter'>typlen</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>typbyval</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>typalign</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN134"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>array_insert_slice</span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>destArray</span><span class='Delimiter'>, </span><a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>origArray</span><span class='Delimiter'>, 
</span><a name="LN135"></a>                   <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>srcArray</span><span class='Delimiter'>, 
</span><a name="LN136"></a>                   <span class='Keyword'>int </span><span class='Declare_Parameter'>ndim</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>dim</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>lb</span><span class='Delimiter'>, 
</span><a name="LN137"></a>                   <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>st</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>endp</span><span class='Delimiter'>, 
</span><a name="LN138"></a>                   <span class='Keyword'>int </span><span class='Declare_Parameter'>typlen</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>typbyval</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>typalign</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN139"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>array_cmp</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN37"><span class='Ref_to_Typedef'>FunctionCallInfo</span></a> <span class='Declare_Parameter'>fcinfo</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN140"></a><span class='Keyword'>static </span><a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>create_array_envelope</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>ndims</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>dimv</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>lbv</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>nbytes</span><span class='Delimiter'>, 
</span><a name="LN141"></a>                      <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>elmtype</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>dataoffset</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN142"></a><span class='Keyword'>static </span><a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>array_fill_internal</span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>dims</span><span class='Delimiter'>, </span><a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lbs</span><span class='Delimiter'>, 
</span><a name="LN143"></a>                    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>value</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isnull</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>elmtype</span><span class='Delimiter'>, 
</span><a name="LN144"></a>                    <a href="../../../include/fmgr.h.html#LN37"><span class='Ref_to_Typedef'>FunctionCallInfo</span></a> <span class='Declare_Parameter'>fcinfo</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN145"></a><span class='Keyword'>static </span><a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>array_replace_internal</span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>array</span><span class='Delimiter'>, 
</span><a name="LN146"></a>                       <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>search</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>search_isnull</span><span class='Delimiter'>, 
</span><a name="LN147"></a>                       <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>replace</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>replace_isnull</span><span class='Delimiter'>, 
</span><a name="LN148"></a>                       <span class='Keyword'>bool </span><span class='Declare_Parameter'>remove</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>collation</span><span class='Delimiter'>, 
</span><a name="LN149"></a>                       <a href="../../../include/fmgr.h.html#LN37"><span class='Ref_to_Typedef'>FunctionCallInfo</span></a> <span class='Declare_Parameter'>fcinfo</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN150"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>width_bucket_array_float8</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>operand</span><span class='Delimiter'>, </span><a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>thresholds</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN151"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>width_bucket_array_fixed</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>operand</span><span class='Delimiter'>, 
</span><a name="LN152"></a>                         <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>thresholds</span><span class='Delimiter'>, 
</span><a name="LN153"></a>                         <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>collation</span><span class='Delimiter'>, 
</span><a name="LN154"></a>                         <a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typentry</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN155"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>width_bucket_array_variable</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>operand</span><span class='Delimiter'>, 
</span><a name="LN156"></a>                            <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>thresholds</span><span class='Delimiter'>, 
</span><a name="LN157"></a>                            <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>collation</span><span class='Delimiter'>, 
</span><a name="LN158"></a>                            <a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typentry</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * array_in : 
 *        converts an array from the external format in "string" to 
 *        its internal format. 
 * 
 * return value : 
 *        the internal representation of the input array 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN170"></a><span class='Declare_Function'>array_in</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN172"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>string</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN241"><span class='Ref_to_Macro'>PG_GETARG_CSTRING</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* external form */ 
</span><a name="LN173"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>element_type</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>        <span class='Comment_Multi_Line'>/* type of an array 
                                                         * element */ 
</span><a name="LN175"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>typmod</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* typmod for array elements */ 
</span><a name="LN176"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>typlen</span><span class='Delimiter'>; 
</span><a name="LN177"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>typbyval</span><span class='Delimiter'>; 
</span><a name="LN178"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>typalign</span><span class='Delimiter'>; 
</span><a name="LN179"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>typdelim</span><span class='Delimiter'>; 
</span><a name="LN180"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typioparam</span><span class='Delimiter'>; 
</span><a name="LN181"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>string_save</span><span class='Delimiter'>, 
</span><a name="LN182"></a>               <span class='Operator'>*</span><span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span><a name="LN183"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN184"></a>                <span class='Declare_Local'>nitems</span><span class='Delimiter'>; 
</span><a name="LN185"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>dataPtr</span><span class='Delimiter'>; 
</span><a name="LN186"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>nullsPtr</span><span class='Delimiter'>; 
</span><a name="LN187"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>hasnulls</span><span class='Delimiter'>; 
</span><a name="LN188"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>nbytes</span><span class='Delimiter'>; 
</span><a name="LN189"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>dataoffset</span><span class='Delimiter'>; 
</span><a name="LN190"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>retval</span><span class='Delimiter'>; 
</span><a name="LN191"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ndim</span><span class='Delimiter'>, 
</span><a name="LN192"></a>                <span class='Declare_Local'>dim</span><span class='Delimiter'>[</span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Delimiter'>], 
</span><a name="LN193"></a>                <span class='Declare_Local'>lBound</span><span class='Delimiter'>[</span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Delimiter'>]; 
</span><a name="LN194"></a>    <a href="../../../include/utils/array.h.html#LN216"><span class='Ref_to_Struct'>ArrayMetaState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>my_extra</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We arrange to look up info about element type, including its input 
     * conversion proc, only once per series of calls, assuming the element 
     * type doesn't change underneath us. 
     */ 
</span>    <a href="arrayfuncs.c.html#LN194"><span class='Ref_To_Local'>my_extra</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN216"><span class='Ref_to_Struct'>ArrayMetaState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_extra<span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN194"><span class='Ref_To_Local'>my_extra</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_extra <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_mcxt<span class='Delimiter'>, 
</span>                                                      <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN216"><span class='Ref_to_Struct'>ArrayMetaState</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN194"><span class='Ref_To_Local'>my_extra</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN216"><span class='Ref_to_Struct'>ArrayMetaState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_extra<span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN194"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN218"><span class='Ref_to_Member'>element_type</span></a> <span class='Operator'>= ~</span><a href="arrayfuncs.c.html#LN173"><span class='Ref_To_Local'>element_type</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN194"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN218"><span class='Ref_to_Member'>element_type</span></a> <span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN173"><span class='Ref_To_Local'>element_type</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Get info about element type, including its input conversion proc 
         */ 
</span>        <a href="../../../include/utils/lsyscache.h.html#LN139"><span class='Ref_to_Proto'>get_type_io_data</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN173"><span class='Ref_To_Local'>element_type</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/lsyscache.h.html#LN31"><span class='Ref_to_EnumConst'>IOFunc_input</span></a><span class='Delimiter'>, 
</span>                         <span class='Operator'>&</span><a href="arrayfuncs.c.html#LN194"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN219"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN194"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN220"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>, 
</span>                         <span class='Operator'>&</span><a href="arrayfuncs.c.html#LN194"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN221"><span class='Ref_to_Member'>typalign</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN194"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN222"><span class='Ref_to_Member'>typdelim</span></a><span class='Delimiter'>, 
</span>                         <span class='Operator'>&</span><a href="arrayfuncs.c.html#LN194"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN223"><span class='Ref_to_Member'>typioparam</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN194"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN224"><span class='Ref_to_Member'>typiofunc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/fmgr.h.html#LN99"><span class='Ref_to_Proto'>fmgr_info_cxt</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN194"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN224"><span class='Ref_to_Member'>typiofunc</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN194"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN225"><span class='Ref_to_Member'>proc</span></a><span class='Delimiter'>, 
</span>                      fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_mcxt<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN194"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN218"><span class='Ref_to_Member'>element_type</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN173"><span class='Ref_To_Local'>element_type</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="arrayfuncs.c.html#LN176"><span class='Ref_To_Local'>typlen</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN194"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN219"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN177"><span class='Ref_To_Local'>typbyval</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN194"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN220"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN178"><span class='Ref_To_Local'>typalign</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN194"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN221"><span class='Ref_to_Member'>typalign</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN179"><span class='Ref_To_Local'>typdelim</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN194"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN222"><span class='Ref_to_Member'>typdelim</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN180"><span class='Ref_To_Local'>typioparam</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN194"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN223"><span class='Ref_to_Member'>typioparam</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Make a modifiable copy of the input */ 
</span>    <a href="arrayfuncs.c.html#LN181"><span class='Ref_To_Local'>string_save</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN172"><span class='Ref_To_Local'>string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the input string starts with dimension info, read and use that. 
     * Otherwise, we require the input to be in curly-brace style, and we 
     * prescan the input to determine dimensions. 
     * 
     * Dimension info takes the form of one or more [n] or [m:n] items. The 
     * outer loop iterates once per dimension item. 
     */ 
</span>    <a href="arrayfuncs.c.html#LN182"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN181"><span class='Ref_To_Local'>string_save</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN191"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN244"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>q</span><span class='Delimiter'>; 
</span><a name="LN245"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>ub</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Note: we currently allow whitespace between, but not within, 
         * dimension items. 
         */ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN88"><span class='Ref_to_Proto'>array_isspace</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="arrayfuncs.c.html#LN182"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>))</span> 
            <a href="arrayfuncs.c.html#LN182"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="arrayfuncs.c.html#LN182"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>!= </span><span class='String'>'['</span><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>;</span>              <span class='Comment_Single_Line'>/* no more dimension items */ 
</span>        <a href="arrayfuncs.c.html#LN182"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN191"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>&GT;= </span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_PROGRAM_LIMIT_EXCEEDED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"number of array dimensions (%d) exceeds the maximum allowed (%d)"</span><span class='Delimiter'>, 
</span>                            <a href="arrayfuncs.c.html#LN191"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN244"><span class='Ref_To_Local'>q</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN182"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>; </span>isdigit<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="arrayfuncs.c.html#LN244"><span class='Ref_To_Local'>q</span></a><span class='Parentheses'>)</span> <span class='Operator'>|| </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="arrayfuncs.c.html#LN244"><span class='Ref_To_Local'>q</span></a> <span class='Operator'>== </span><span class='String'>'-'</span><span class='Parentheses'>)</span> <span class='Operator'>|| </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="arrayfuncs.c.html#LN244"><span class='Ref_To_Local'>q</span></a> <span class='Operator'>== </span><span class='String'>'+'</span><span class='Parentheses'>)</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN244"><span class='Ref_To_Local'>q</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span> 
             <span class='Comment_Multi_Line'>/* skip */ </span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN244"><span class='Ref_To_Local'>q</span></a> <span class='Operator'>== </span><a href="arrayfuncs.c.html#LN182"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span>             <span class='Comment_Single_Line'>/* no digits? */ 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"malformed array literal: \"%s\""</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN172"><span class='Ref_To_Local'>string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"\"[\" must introduce explicitly-specified array dimensions."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="arrayfuncs.c.html#LN244"><span class='Ref_To_Local'>q</span></a> <span class='Operator'>== </span><span class='String'>':'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* [m:n] format */ 
</span>            <span class='Operator'>*</span><a href="arrayfuncs.c.html#LN244"><span class='Ref_To_Local'>q</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN193"><span class='Ref_To_Local'>lBound</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN191"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN182"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN182"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN244"><span class='Ref_To_Local'>q</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN244"><span class='Ref_To_Local'>q</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN182"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>; </span>isdigit<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="arrayfuncs.c.html#LN244"><span class='Ref_To_Local'>q</span></a><span class='Parentheses'>)</span> <span class='Operator'>|| </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="arrayfuncs.c.html#LN244"><span class='Ref_To_Local'>q</span></a> <span class='Operator'>== </span><span class='String'>'-'</span><span class='Parentheses'>)</span> <span class='Operator'>|| </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="arrayfuncs.c.html#LN244"><span class='Ref_To_Local'>q</span></a> <span class='Operator'>== </span><span class='String'>'+'</span><span class='Parentheses'>)</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN244"><span class='Ref_To_Local'>q</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span> 
                 <span class='Comment_Multi_Line'>/* skip */ </span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN244"><span class='Ref_To_Local'>q</span></a> <span class='Operator'>== </span><a href="arrayfuncs.c.html#LN182"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span>         <span class='Comment_Single_Line'>/* no digits? */ 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"malformed array literal: \"%s\""</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN172"><span class='Ref_To_Local'>string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Missing array dimension value."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* [n] format */ 
</span>            <a href="arrayfuncs.c.html#LN193"><span class='Ref_To_Local'>lBound</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN191"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="arrayfuncs.c.html#LN244"><span class='Ref_To_Local'>q</span></a> <span class='Operator'>!= </span><span class='String'>']'</span><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"malformed array literal: \"%s\""</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN172"><span class='Ref_To_Local'>string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Missing \"%s\" after array dimensions."</span><span class='Delimiter'>, 
</span>                               <span class='String'>"]"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Operator'>*</span><a href="arrayfuncs.c.html#LN244"><span class='Ref_To_Local'>q</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN245"><span class='Ref_To_Local'>ub</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN182"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN182"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN244"><span class='Ref_To_Local'>q</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN245"><span class='Ref_To_Local'>ub</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN193"><span class='Ref_To_Local'>lBound</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN191"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ARRAY_SUBSCRIPT_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"upper bound cannot be less than lower bound"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="arrayfuncs.c.html#LN192"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN191"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="arrayfuncs.c.html#LN245"><span class='Ref_To_Local'>ub</span></a> <span class='Operator'>- </span><a href="arrayfuncs.c.html#LN193"><span class='Ref_To_Local'>lBound</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN191"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>] </span><span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN191"><span class='Ref_To_Local'>ndim</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN191"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* No array dimensions, so intuit dimensions from brace structure */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="arrayfuncs.c.html#LN182"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>!= </span><span class='String'>'{'</span><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"malformed array literal: \"%s\""</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN172"><span class='Ref_To_Local'>string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Array value must start with \"{\" or dimension information."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN191"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN89"><span class='Ref_to_Proto'>ArrayCount</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN182"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN192"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN179"><span class='Ref_To_Local'>typdelim</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN183"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN183"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN191"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN183"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <a href="arrayfuncs.c.html#LN193"><span class='Ref_To_Local'>lBound</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN183"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN322"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>ndim_braces</span><span class='Delimiter'>, 
</span><a name="LN323"></a>                    <span class='Declare_Local'>dim_braces</span><span class='Delimiter'>[</span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Comment_Multi_Line'>/* If array dimensions are given, expect '=' operator */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strncmp<span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN182"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN43"><span class='Ref_to_Const'>ASSGN</span></a><span class='Delimiter'>, </span>strlen<span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN43"><span class='Ref_to_Const'>ASSGN</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"malformed array literal: \"%s\""</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN172"><span class='Ref_To_Local'>string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Missing \"%s\" after array dimensions."</span><span class='Delimiter'>, 
</span>                               <a href="arrayfuncs.c.html#LN43"><span class='Ref_to_Const'>ASSGN</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN182"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+= </span>strlen<span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN43"><span class='Ref_to_Const'>ASSGN</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN88"><span class='Ref_to_Proto'>array_isspace</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="arrayfuncs.c.html#LN182"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>))</span> 
            <a href="arrayfuncs.c.html#LN182"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * intuit dimensions from brace structure -- it better match what we 
         * were given 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="arrayfuncs.c.html#LN182"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>!= </span><span class='String'>'{'</span><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"malformed array literal: \"%s\""</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN172"><span class='Ref_To_Local'>string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Array contents must start with \"{\"."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN322"><span class='Ref_To_Local'>ndim_braces</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN89"><span class='Ref_to_Proto'>ArrayCount</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN182"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN323"><span class='Ref_To_Local'>dim_braces</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN179"><span class='Ref_To_Local'>typdelim</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN322"><span class='Ref_To_Local'>ndim_braces</span></a> <span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN191"><span class='Ref_To_Local'>ndim</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"malformed array literal: \"%s\""</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN172"><span class='Ref_To_Local'>string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Specified array dimensions do not match array contents."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN183"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN183"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN191"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>; </span><span class='Operator'>++</span><a href="arrayfuncs.c.html#LN183"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN192"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN183"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN323"><span class='Ref_To_Local'>dim_braces</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN183"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"malformed array literal: \"%s\""</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN172"><span class='Ref_To_Local'>string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Specified array dimensions do not match array contents."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
<span class='Directive'>#ifdef</span> ARRAYDEBUG 
    <a href="../../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"array_in- ndim %d ("</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN191"><span class='Ref_To_Local'>ndim</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN183"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN183"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN191"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN183"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>" %d"</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN192"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN183"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}; 
</span>    <a href="../../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>") for %s\n"</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN172"><span class='Ref_To_Local'>string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <span class='Comment_Multi_Line'>/* This checks for overflow of the array dimensions */ 
</span>    <a href="arrayfuncs.c.html#LN184"><span class='Ref_To_Local'>nitems</span></a> <span class='Operator'>= </span><a href="arrayutils.c.html#LN73"><span class='Ref_to_Func'>ArrayGetNItems</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN191"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN192"><span class='Ref_To_Local'>dim</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Empty array? */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN184"><span class='Ref_To_Local'>nitems</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/array.h.html#LN245"><span class='Ref_to_Macro'>PG_RETURN_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN378"><span class='Ref_to_Proto'>construct_empty_array</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN173"><span class='Ref_To_Local'>element_type</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN185"><span class='Ref_To_Local'>dataPtr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN184"><span class='Ref_To_Local'>nitems</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN186"><span class='Ref_To_Local'>nullsPtr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN184"><span class='Ref_To_Local'>nitems</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN90"><span class='Ref_to_Proto'>ReadArrayStr</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN182"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN172"><span class='Ref_To_Local'>string</span></a><span class='Delimiter'>, 
</span>                 <a href="arrayfuncs.c.html#LN184"><span class='Ref_To_Local'>nitems</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN191"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN192"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>, 
</span>                 <span class='Operator'>&</span><a href="arrayfuncs.c.html#LN194"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN225"><span class='Ref_to_Member'>proc</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN180"><span class='Ref_To_Local'>typioparam</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN175"><span class='Ref_To_Local'>typmod</span></a><span class='Delimiter'>, 
</span>                 <a href="arrayfuncs.c.html#LN179"><span class='Ref_To_Local'>typdelim</span></a><span class='Delimiter'>, 
</span>                 <a href="arrayfuncs.c.html#LN176"><span class='Ref_To_Local'>typlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN177"><span class='Ref_To_Local'>typbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN178"><span class='Ref_To_Local'>typalign</span></a><span class='Delimiter'>, 
</span>                 <a href="arrayfuncs.c.html#LN185"><span class='Ref_To_Local'>dataPtr</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN186"><span class='Ref_To_Local'>nullsPtr</span></a><span class='Delimiter'>, 
</span>                 <span class='Operator'>&</span><a href="arrayfuncs.c.html#LN187"><span class='Ref_To_Local'>hasnulls</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN188"><span class='Ref_To_Local'>nbytes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN187"><span class='Ref_To_Local'>hasnulls</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="arrayfuncs.c.html#LN189"><span class='Ref_To_Local'>dataoffset</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN292"><span class='Ref_to_Macro'>ARR_OVERHEAD_WITHNULLS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN191"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN184"><span class='Ref_To_Local'>nitems</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN188"><span class='Ref_To_Local'>nbytes</span></a> <span class='Operator'>+= </span><a href="arrayfuncs.c.html#LN189"><span class='Ref_To_Local'>dataoffset</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="arrayfuncs.c.html#LN189"><span class='Ref_To_Local'>dataoffset</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* marker for no null bitmap */ 
</span>        <a href="arrayfuncs.c.html#LN188"><span class='Ref_To_Local'>nbytes</span></a> <span class='Operator'>+= </span><a href="../../../include/utils/array.h.html#LN290"><span class='Ref_to_Macro'>ARR_OVERHEAD_NONULLS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN191"><span class='Ref_To_Local'>ndim</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="arrayfuncs.c.html#LN190"><span class='Ref_To_Local'>retval</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN188"><span class='Ref_To_Local'>nbytes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN190"><span class='Ref_To_Local'>retval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN188"><span class='Ref_To_Local'>nbytes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN190"><span class='Ref_To_Local'>retval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN78"><span class='Ref_to_Member'>ndim</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN191"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN190"><span class='Ref_To_Local'>retval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN79"><span class='Ref_to_Member'>dataoffset</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN189"><span class='Ref_To_Local'>dataoffset</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * This comes from the array's pg_type.typelem (which points to the base 
     * data type's pg_type.oid) and stores system oids in user tables. This 
     * oid must be preserved by binary upgrades. 
     */ 
</span>    <a href="arrayfuncs.c.html#LN190"><span class='Ref_To_Local'>retval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN80"><span class='Ref_to_Member'>elemtype</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN173"><span class='Ref_To_Local'>element_type</span></a><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN190"><span class='Ref_To_Local'>retval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN192"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN191"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN276"><span class='Ref_to_Macro'>ARR_LBOUND</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN190"><span class='Ref_To_Local'>retval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN193"><span class='Ref_To_Local'>lBound</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN191"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/array.h.html#LN330"><span class='Ref_to_Proto'>CopyArrayEls</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN190"><span class='Ref_To_Local'>retval</span></a><span class='Delimiter'>, 
</span>                 <a href="arrayfuncs.c.html#LN185"><span class='Ref_To_Local'>dataPtr</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN186"><span class='Ref_To_Local'>nullsPtr</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN184"><span class='Ref_To_Local'>nitems</span></a><span class='Delimiter'>, 
</span>                 <a href="arrayfuncs.c.html#LN176"><span class='Ref_To_Local'>typlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN177"><span class='Ref_To_Local'>typbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN178"><span class='Ref_To_Local'>typalign</span></a><span class='Delimiter'>, 
</span>                 <span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN185"><span class='Ref_To_Local'>dataPtr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN186"><span class='Ref_To_Local'>nullsPtr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN181"><span class='Ref_To_Local'>string_save</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/array.h.html#LN245"><span class='Ref_to_Macro'>PG_RETURN_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN190"><span class='Ref_To_Local'>retval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end array_in &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * array_isspace() --- a non-locale-dependent isspace() 
 * 
 * We used to use isspace() for parsing array values, but that has 
 * undesirable results: an array value might be silently interpreted 
 * differently depending on the locale setting.  Now we just hard-wire 
 * the traditional ASCII definition of isspace(). 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN430"></a><span class='Declare_Function'>array_isspace</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Declare_Parameter'>ch</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN430"><span class='Ref_to_Parameter'>ch</span></a> <span class='Operator'>== </span><span class='String'>' '</span> <span class='Operator'>|| 
</span>        <a href="arrayfuncs.c.html#LN430"><span class='Ref_to_Parameter'>ch</span></a> <span class='Operator'>== </span><span class='String'>'\t'</span> <span class='Operator'>|| 
</span>        <a href="arrayfuncs.c.html#LN430"><span class='Ref_to_Parameter'>ch</span></a> <span class='Operator'>== </span><span class='String'>'\n'</span> <span class='Operator'>|| 
</span>        <a href="arrayfuncs.c.html#LN430"><span class='Ref_to_Parameter'>ch</span></a> <span class='Operator'>== </span><span class='String'>'\r'</span> <span class='Operator'>|| 
</span>        <a href="arrayfuncs.c.html#LN430"><span class='Ref_to_Parameter'>ch</span></a> <span class='Operator'>== </span><span class='String'>'\v'</span> <span class='Operator'>|| 
</span>        <a href="arrayfuncs.c.html#LN430"><span class='Ref_to_Parameter'>ch</span></a> <span class='Operator'>== </span><span class='String'>'\f'</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * ArrayCount 
 *   Determines the dimensions for an array string. 
 * 
 * Returns number of dimensions as function result.  The axis lengths are 
 * returned in dim[], which must be of size MAXDIM. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN450"></a><span class='Declare_Function'>ArrayCount</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>dim</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>typdelim</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN452"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nest_level</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>, 
</span><a name="LN453"></a>                <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN454"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ndim</span> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>, 
</span><a name="LN455"></a>                <span class='Declare_Local'>temp</span><span class='Delimiter'>[</span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Delimiter'>], 
</span><a name="LN456"></a>                <span class='Declare_Local'>nelems</span><span class='Delimiter'>[</span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Delimiter'>], 
</span><a name="LN457"></a>                <span class='Declare_Local'>nelems_last</span><span class='Delimiter'>[</span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Delimiter'>]; 
</span><a name="LN458"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>in_quotes</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN459"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>eoArray</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN460"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>empty_array</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span><a name="LN461"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>ptr</span><span class='Delimiter'>; 
</span><a name="LN462"></a>    <a href="arrayfuncs.c.html#LN51"><span class='Ref_to_Typedef'>ArrayParseState</span></a> <span class='Declare_Local'>parse_state</span> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN53"><span class='Ref_to_EnumConst'>ARRAY_NO_LEVEL</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN453"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN453"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Delimiter'>; </span><span class='Operator'>++</span><a href="arrayfuncs.c.html#LN453"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="arrayfuncs.c.html#LN455"><span class='Ref_To_Local'>temp</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN453"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="arrayfuncs.c.html#LN450"><span class='Ref_to_Parameter'>dim</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN453"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="arrayfuncs.c.html#LN457"><span class='Ref_To_Local'>nelems_last</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN453"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN456"><span class='Ref_To_Local'>nelems</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN453"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="arrayfuncs.c.html#LN461"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN450"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="arrayfuncs.c.html#LN459"><span class='Ref_To_Local'>eoArray</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN473"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>itemdone</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="arrayfuncs.c.html#LN473"><span class='Ref_To_Local'>itemdone</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN462"><span class='Ref_To_Local'>parse_state</span></a> <span class='Operator'>== </span><a href="arrayfuncs.c.html#LN55"><span class='Ref_to_EnumConst'>ARRAY_ELEM_STARTED</span></a> <span class='Operator'>|| 
</span>                <a href="arrayfuncs.c.html#LN462"><span class='Ref_To_Local'>parse_state</span></a> <span class='Operator'>== </span><a href="arrayfuncs.c.html#LN57"><span class='Ref_to_EnumConst'>ARRAY_QUOTED_ELEM_STARTED</span></a><span class='Parentheses'>) 
</span>                <a href="arrayfuncs.c.html#LN460"><span class='Ref_To_Local'>empty_array</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>switch</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="arrayfuncs.c.html#LN461"><span class='Ref_To_Local'>ptr</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>case</span> <span class='String'>'\0'</span><span class='Operator'>: 
</span>                    <span class='Comment_Multi_Line'>/* Signal a premature end of the string */ 
</span>                    <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"malformed array literal: \"%s\""</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN450"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Unexpected end of input."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'\\'</span><span class='Operator'>: 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * An escape must be after a level start, after an element 
                     * start, or after an element delimiter. In any case we 
                     * now must be past an element start. 
                     */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN462"><span class='Ref_To_Local'>parse_state</span></a> <span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN54"><span class='Ref_to_EnumConst'>ARRAY_LEVEL_STARTED</span></a> <span class='Operator'>&& 
</span>                        <a href="arrayfuncs.c.html#LN462"><span class='Ref_To_Local'>parse_state</span></a> <span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN55"><span class='Ref_to_EnumConst'>ARRAY_ELEM_STARTED</span></a> <span class='Operator'>&& 
</span>                        <a href="arrayfuncs.c.html#LN462"><span class='Ref_To_Local'>parse_state</span></a> <span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN57"><span class='Ref_to_EnumConst'>ARRAY_QUOTED_ELEM_STARTED</span></a> <span class='Operator'>&& 
</span>                        <a href="arrayfuncs.c.html#LN462"><span class='Ref_To_Local'>parse_state</span></a> <span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN59"><span class='Ref_to_EnumConst'>ARRAY_ELEM_DELIMITED</span></a><span class='Parentheses'>) 
</span>                        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"malformed array literal: \"%s\""</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN450"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Unexpected \"%c\" character."</span><span class='Delimiter'>, 
</span>                                           <span class='String'>'\\'</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN462"><span class='Ref_To_Local'>parse_state</span></a> <span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN57"><span class='Ref_to_EnumConst'>ARRAY_QUOTED_ELEM_STARTED</span></a><span class='Parentheses'>) 
</span>                        <a href="arrayfuncs.c.html#LN462"><span class='Ref_To_Local'>parse_state</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN55"><span class='Ref_to_EnumConst'>ARRAY_ELEM_STARTED</span></a><span class='Delimiter'>; 
</span>                    <span class='Comment_Multi_Line'>/* skip the escaped character */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN461"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>))</span> 
                        <a href="arrayfuncs.c.html#LN461"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> 
                        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"malformed array literal: \"%s\""</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN450"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Unexpected end of input."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'"'</span><span class='Operator'>: 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * A quote must be after a level start, after a quoted 
                     * element start, or after an element delimiter. In any 
                     * case we now must be past an element start. 
                     */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN462"><span class='Ref_To_Local'>parse_state</span></a> <span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN54"><span class='Ref_to_EnumConst'>ARRAY_LEVEL_STARTED</span></a> <span class='Operator'>&& 
</span>                        <a href="arrayfuncs.c.html#LN462"><span class='Ref_To_Local'>parse_state</span></a> <span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN57"><span class='Ref_to_EnumConst'>ARRAY_QUOTED_ELEM_STARTED</span></a> <span class='Operator'>&& 
</span>                        <a href="arrayfuncs.c.html#LN462"><span class='Ref_To_Local'>parse_state</span></a> <span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN59"><span class='Ref_to_EnumConst'>ARRAY_ELEM_DELIMITED</span></a><span class='Parentheses'>) 
</span>                        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"malformed array literal: \"%s\""</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN450"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Unexpected array element."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <a href="arrayfuncs.c.html#LN458"><span class='Ref_To_Local'>in_quotes</span></a> <span class='Operator'>= !</span><a href="arrayfuncs.c.html#LN458"><span class='Ref_To_Local'>in_quotes</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN458"><span class='Ref_To_Local'>in_quotes</span></a><span class='Parentheses'>) 
</span>                        <a href="arrayfuncs.c.html#LN462"><span class='Ref_To_Local'>parse_state</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN57"><span class='Ref_to_EnumConst'>ARRAY_QUOTED_ELEM_STARTED</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> 
                        <a href="arrayfuncs.c.html#LN462"><span class='Ref_To_Local'>parse_state</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN58"><span class='Ref_to_EnumConst'>ARRAY_QUOTED_ELEM_COMPLETED</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'{'</span><span class='Operator'>: 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="arrayfuncs.c.html#LN458"><span class='Ref_To_Local'>in_quotes</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* 
                         * A left brace can occur if no nesting has occurred 
                         * yet, after a level start, or after a level 
                         * delimiter. 
                         */ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN462"><span class='Ref_To_Local'>parse_state</span></a> <span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN53"><span class='Ref_to_EnumConst'>ARRAY_NO_LEVEL</span></a> <span class='Operator'>&& 
</span>                            <a href="arrayfuncs.c.html#LN462"><span class='Ref_To_Local'>parse_state</span></a> <span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN54"><span class='Ref_to_EnumConst'>ARRAY_LEVEL_STARTED</span></a> <span class='Operator'>&& 
</span>                            <a href="arrayfuncs.c.html#LN462"><span class='Ref_To_Local'>parse_state</span></a> <span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN61"><span class='Ref_to_EnumConst'>ARRAY_LEVEL_DELIMITED</span></a><span class='Parentheses'>) 
</span>                            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                               <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"malformed array literal: \"%s\""</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN450"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Unexpected \"%c\" character."</span><span class='Delimiter'>, 
</span>                                          <span class='String'>'{'</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                        <a href="arrayfuncs.c.html#LN462"><span class='Ref_To_Local'>parse_state</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN54"><span class='Ref_to_EnumConst'>ARRAY_LEVEL_STARTED</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN452"><span class='Ref_To_Local'>nest_level</span></a> <span class='Operator'>&GT;= </span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Parentheses'>) 
</span>                            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_PROGRAM_LIMIT_EXCEEDED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"number of array dimensions (%d) exceeds the maximum allowed (%d)"</span><span class='Delimiter'>, 
</span>                                            <a href="arrayfuncs.c.html#LN452"><span class='Ref_To_Local'>nest_level</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                        <a href="arrayfuncs.c.html#LN455"><span class='Ref_To_Local'>temp</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN452"><span class='Ref_To_Local'>nest_level</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                        <a href="arrayfuncs.c.html#LN452"><span class='Ref_To_Local'>nest_level</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN454"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN452"><span class='Ref_To_Local'>nest_level</span></a><span class='Parentheses'>) 
</span>                            <a href="arrayfuncs.c.html#LN454"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN452"><span class='Ref_To_Local'>nest_level</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !in_quotes &raquo; </span> 
                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'}'</span><span class='Operator'>: 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="arrayfuncs.c.html#LN458"><span class='Ref_To_Local'>in_quotes</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* 
                         * A right brace can occur after an element start, an 
                         * element completion, a quoted element completion, or 
                         * a level completion. 
                         */ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN462"><span class='Ref_To_Local'>parse_state</span></a> <span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN55"><span class='Ref_to_EnumConst'>ARRAY_ELEM_STARTED</span></a> <span class='Operator'>&& 
</span>                            <a href="arrayfuncs.c.html#LN462"><span class='Ref_To_Local'>parse_state</span></a> <span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN56"><span class='Ref_to_EnumConst'>ARRAY_ELEM_COMPLETED</span></a> <span class='Operator'>&& 
</span>                            <a href="arrayfuncs.c.html#LN462"><span class='Ref_To_Local'>parse_state</span></a> <span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN58"><span class='Ref_to_EnumConst'>ARRAY_QUOTED_ELEM_COMPLETED</span></a> <span class='Operator'>&& 
</span>                            <a href="arrayfuncs.c.html#LN462"><span class='Ref_To_Local'>parse_state</span></a> <span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN60"><span class='Ref_to_EnumConst'>ARRAY_LEVEL_COMPLETED</span></a> <span class='Operator'>&& 
</span>                            <span class='Operator'>!</span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN452"><span class='Ref_To_Local'>nest_level</span></a> <span class='Operator'>== </span><span class='Number'>1</span> <span class='Operator'>&& </span><a href="arrayfuncs.c.html#LN462"><span class='Ref_To_Local'>parse_state</span></a> <span class='Operator'>== </span><a href="arrayfuncs.c.html#LN54"><span class='Ref_to_EnumConst'>ARRAY_LEVEL_STARTED</span></a><span class='Parentheses'>))</span> 
                            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                               <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"malformed array literal: \"%s\""</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN450"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Unexpected \"%c\" character."</span><span class='Delimiter'>, 
</span>                                          <span class='String'>'}'</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                        <a href="arrayfuncs.c.html#LN462"><span class='Ref_To_Local'>parse_state</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN60"><span class='Ref_to_EnumConst'>ARRAY_LEVEL_COMPLETED</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN452"><span class='Ref_To_Local'>nest_level</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                               <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"malformed array literal: \"%s\""</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN450"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Unmatched \"%c\" character."</span><span class='Delimiter'>, </span><span class='String'>'}'</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                        <a href="arrayfuncs.c.html#LN452"><span class='Ref_To_Local'>nest_level</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span> 
                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN457"><span class='Ref_To_Local'>nelems_last</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN452"><span class='Ref_To_Local'>nest_level</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>                            <a href="arrayfuncs.c.html#LN456"><span class='Ref_To_Local'>nelems</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN452"><span class='Ref_To_Local'>nest_level</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN457"><span class='Ref_To_Local'>nelems_last</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN452"><span class='Ref_To_Local'>nest_level</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>                            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                               <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"malformed array literal: \"%s\""</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN450"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Multidimensional arrays must have "</span> 
                                          <span class='String'>"sub-arrays with matching "</span> 
                                          <span class='String'>"dimensions."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                        <a href="arrayfuncs.c.html#LN457"><span class='Ref_To_Local'>nelems_last</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN452"><span class='Ref_To_Local'>nest_level</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="arrayfuncs.c.html#LN456"><span class='Ref_To_Local'>nelems</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN452"><span class='Ref_To_Local'>nest_level</span></a><span class='Delimiter'>]; 
</span>                        <a href="arrayfuncs.c.html#LN456"><span class='Ref_To_Local'>nelems</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN452"><span class='Ref_To_Local'>nest_level</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN452"><span class='Ref_To_Local'>nest_level</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                            <a href="arrayfuncs.c.html#LN459"><span class='Ref_To_Local'>eoArray</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN473"><span class='Ref_To_Local'>itemdone</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                        <span class='Control'>else</span> 
                        <span class='Delimiter'>{ 
</span>                            <span class='Comment_Multi_Line'>/* 
                             * We don't set itemdone here; see comments in 
                             * ReadArrayStr 
                             */ 
</span>                            <a href="arrayfuncs.c.html#LN455"><span class='Ref_To_Local'>temp</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN452"><span class='Ref_To_Local'>nest_level</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span>                    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !in_quotes &raquo; </span> 
                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>default</span><span class='Operator'>: 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="arrayfuncs.c.html#LN458"><span class='Ref_To_Local'>in_quotes</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="arrayfuncs.c.html#LN461"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>== </span><a href="arrayfuncs.c.html#LN450"><span class='Ref_to_Parameter'>typdelim</span></a><span class='Parentheses'>) 
</span>                        <span class='Delimiter'>{ 
</span>                            <span class='Comment_Multi_Line'>/* 
                             * Delimiters can occur after an element start, an 
                             * element completion, a quoted element 
                             * completion, or a level completion. 
                             */ 
</span>                            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN462"><span class='Ref_To_Local'>parse_state</span></a> <span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN55"><span class='Ref_to_EnumConst'>ARRAY_ELEM_STARTED</span></a> <span class='Operator'>&& 
</span>                                <a href="arrayfuncs.c.html#LN462"><span class='Ref_To_Local'>parse_state</span></a> <span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN56"><span class='Ref_to_EnumConst'>ARRAY_ELEM_COMPLETED</span></a> <span class='Operator'>&& 
</span>                                <a href="arrayfuncs.c.html#LN462"><span class='Ref_To_Local'>parse_state</span></a> <span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN58"><span class='Ref_to_EnumConst'>ARRAY_QUOTED_ELEM_COMPLETED</span></a> <span class='Operator'>&& 
</span>                                <a href="arrayfuncs.c.html#LN462"><span class='Ref_To_Local'>parse_state</span></a> <span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN60"><span class='Ref_to_EnumConst'>ARRAY_LEVEL_COMPLETED</span></a><span class='Parentheses'>) 
</span>                                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"malformed array literal: \"%s\""</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN450"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Unexpected \"%c\" character."</span><span class='Delimiter'>, 
</span>                                           <a href="arrayfuncs.c.html#LN450"><span class='Ref_to_Parameter'>typdelim</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN462"><span class='Ref_To_Local'>parse_state</span></a> <span class='Operator'>== </span><a href="arrayfuncs.c.html#LN60"><span class='Ref_to_EnumConst'>ARRAY_LEVEL_COMPLETED</span></a><span class='Parentheses'>) 
</span>                                <a href="arrayfuncs.c.html#LN462"><span class='Ref_To_Local'>parse_state</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN61"><span class='Ref_to_EnumConst'>ARRAY_LEVEL_DELIMITED</span></a><span class='Delimiter'>; 
</span>                            <span class='Control'>else</span> 
                                <a href="arrayfuncs.c.html#LN462"><span class='Ref_To_Local'>parse_state</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN59"><span class='Ref_to_EnumConst'>ARRAY_ELEM_DELIMITED</span></a><span class='Delimiter'>; 
</span>                            <a href="arrayfuncs.c.html#LN473"><span class='Ref_To_Local'>itemdone</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                            <a href="arrayfuncs.c.html#LN456"><span class='Ref_To_Local'>nelems</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN452"><span class='Ref_To_Local'>nest_level</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if *ptr==typdelim &raquo; </span> 
                        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="arrayfuncs.c.html#LN88"><span class='Ref_to_Proto'>array_isspace</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="arrayfuncs.c.html#LN461"><span class='Ref_To_Local'>ptr</span></a><span class='Parentheses'>))</span> 
                        <span class='Delimiter'>{ 
</span>                            <span class='Comment_Multi_Line'>/* 
                             * Other non-space characters must be after a 
                             * level start, after an element start, or after 
                             * an element delimiter. In any case we now must 
                             * be past an element start. 
                             */ 
</span>                            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN462"><span class='Ref_To_Local'>parse_state</span></a> <span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN54"><span class='Ref_to_EnumConst'>ARRAY_LEVEL_STARTED</span></a> <span class='Operator'>&& 
</span>                                <a href="arrayfuncs.c.html#LN462"><span class='Ref_To_Local'>parse_state</span></a> <span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN55"><span class='Ref_to_EnumConst'>ARRAY_ELEM_STARTED</span></a> <span class='Operator'>&& 
</span>                                <a href="arrayfuncs.c.html#LN462"><span class='Ref_To_Local'>parse_state</span></a> <span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN59"><span class='Ref_to_EnumConst'>ARRAY_ELEM_DELIMITED</span></a><span class='Parentheses'>) 
</span>                                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"malformed array literal: \"%s\""</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN450"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Unexpected array element."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                            <a href="arrayfuncs.c.html#LN462"><span class='Ref_To_Local'>parse_state</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN55"><span class='Ref_to_EnumConst'>ARRAY_ELEM_STARTED</span></a><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span>                    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !in_quotes &raquo; </span> 
                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch *ptr &raquo; </span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="arrayfuncs.c.html#LN473"><span class='Ref_To_Local'>itemdone</span></a><span class='Parentheses'>) 
</span>                <a href="arrayfuncs.c.html#LN461"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while !itemdone &raquo; </span> 
        <a href="arrayfuncs.c.html#LN455"><span class='Ref_To_Local'>temp</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN454"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN461"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while !eoArray &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* only whitespace is allowed after the closing brace */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="arrayfuncs.c.html#LN461"><span class='Ref_To_Local'>ptr</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="arrayfuncs.c.html#LN88"><span class='Ref_to_Proto'>array_isspace</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="arrayfuncs.c.html#LN461"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>++</span><span class='Parentheses'>))</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"malformed array literal: \"%s\""</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN450"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Junk after closing right brace."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* special case for an empty array */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN460"><span class='Ref_To_Local'>empty_array</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN453"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN453"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN454"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>; </span><span class='Operator'>++</span><a href="arrayfuncs.c.html#LN453"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>) 
</span>        <a href="arrayfuncs.c.html#LN450"><span class='Ref_to_Parameter'>dim</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN453"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="arrayfuncs.c.html#LN455"><span class='Ref_To_Local'>temp</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN453"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
    <span class='Control'>return</span> <a href="arrayfuncs.c.html#LN454"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ArrayCount &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ReadArrayStr : 
 *   parses the array string pointed to by "arrayStr" and converts the values 
 *   to internal format.  Unspecified elements are initialized to nulls. 
 *   The array dimensions must already have been determined. 
 * 
 * Inputs: 
 *  arrayStr: the string to parse. 
 *            CAUTION: the contents of "arrayStr" will be modified! 
 *  origStr: the unmodified input string, used only in error messages. 
 *  nitems: total number of array elements, as already determined. 
 *  ndim: number of array dimensions 
 *  dim[]: array axis lengths 
 *  inputproc: type-specific input procedure for element datatype. 
 *  typioparam, typmod: auxiliary values to pass to inputproc. 
 *  typdelim: the value delimiter (type-specific). 
 *  typlen, typbyval, typalign: storage parameters of element datatype. 
 * 
 * Outputs: 
 *  values[]: filled with converted data values. 
 *  nulls[]: filled with is-null markers. 
 *  *hasnulls: set TRUE iff there are any null elements. 
 *  *nbytes: set to total size of data area needed (including alignment 
 *      padding but not including array header overhead). 
 * 
 * Note that values[] and nulls[] are allocated by the caller, and must have 
 * nitems elements. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN715"></a><span class='Declare_Function'>ReadArrayStr</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>arrayStr</span><span class='Delimiter'>, 
</span><a name="LN716"></a>             <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>origStr</span><span class='Delimiter'>, 
</span><a name="LN717"></a>             <span class='Keyword'>int </span><span class='Declare_Parameter'>nitems</span><span class='Delimiter'>, 
</span><a name="LN718"></a>             <span class='Keyword'>int </span><span class='Declare_Parameter'>ndim</span><span class='Delimiter'>, 
</span><a name="LN719"></a>             <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>dim</span><span class='Delimiter'>, 
</span><a name="LN720"></a>             <a href="../../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>inputproc</span><span class='Delimiter'>, 
</span><a name="LN721"></a>             <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typioparam</span><span class='Delimiter'>, 
</span><a name="LN722"></a>             <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>typmod</span><span class='Delimiter'>, 
</span><a name="LN723"></a>             <span class='Keyword'>char </span><span class='Declare_Parameter'>typdelim</span><span class='Delimiter'>, 
</span><a name="LN724"></a>             <span class='Keyword'>int </span><span class='Declare_Parameter'>typlen</span><span class='Delimiter'>, 
</span><a name="LN725"></a>             <span class='Keyword'>bool </span><span class='Declare_Parameter'>typbyval</span><span class='Delimiter'>, 
</span><a name="LN726"></a>             <span class='Keyword'>char </span><span class='Declare_Parameter'>typalign</span><span class='Delimiter'>, 
</span><a name="LN727"></a>             <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>values</span><span class='Delimiter'>, 
</span><a name="LN728"></a>             <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>nulls</span><span class='Delimiter'>, 
</span><a name="LN729"></a>             <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>hasnulls</span><span class='Delimiter'>, 
</span><a name="LN730"></a>             <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>nbytes</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN732"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN733"></a>                <span class='Declare_Local'>nest_level</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN734"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>srcptr</span><span class='Delimiter'>; 
</span><a name="LN735"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>in_quotes</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN736"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>eoArray</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN737"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>hasnull</span><span class='Delimiter'>; 
</span><a name="LN738"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>totbytes</span><span class='Delimiter'>; 
</span><a name="LN739"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>indx</span><span class='Delimiter'>[</span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Delimiter'>], 
</span><a name="LN740"></a>                <span class='Declare_Local'>prod</span><span class='Delimiter'>[</span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Delimiter'>]; 
</span> 
    <a href="arrayutils.c.html#LN132"><span class='Ref_to_Func'>mda_get_prod</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN718"><span class='Ref_to_Parameter'>ndim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN719"><span class='Ref_to_Parameter'>dim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN740"><span class='Ref_To_Local'>prod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN739"><span class='Ref_To_Local'>indx</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN739"><span class='Ref_To_Local'>indx</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Initialize is-null markers to true */ 
</span>    memset<span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN728"><span class='Ref_to_Parameter'>nulls</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN717"><span class='Ref_to_Parameter'>nitems</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We have to remove " and \ characters to create a clean item value to 
     * pass to the datatype input routine.  We overwrite each item value 
     * in-place within arrayStr to do this.  srcptr is the current scan point, 
     * and dstptr is where we are copying to. 
     * 
     * We also want to suppress leading and trailing unquoted whitespace. We 
     * use the leadingspace flag to suppress leading space.  Trailing space is 
     * tracked by using dstendptr to point to the last significant output 
     * character. 
     * 
     * The error checking in this routine is mostly pro-forma, since we expect 
     * that ArrayCount() already validated the string.  So we don't bother 
     * with errdetail messages. 
     */ 
</span>    <a href="arrayfuncs.c.html#LN734"><span class='Ref_To_Local'>srcptr</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN715"><span class='Ref_to_Parameter'>arrayStr</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="arrayfuncs.c.html#LN736"><span class='Ref_To_Local'>eoArray</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN766"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>itemdone</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN767"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>leadingspace</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span><a name="LN768"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>hasquoting</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN769"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>itemstart</span><span class='Delimiter'>; 
</span><a name="LN770"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>dstptr</span><span class='Delimiter'>; 
</span><a name="LN771"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>dstendptr</span><span class='Delimiter'>; 
</span> 
        <a href="arrayfuncs.c.html#LN732"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN769"><span class='Ref_To_Local'>itemstart</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN770"><span class='Ref_To_Local'>dstptr</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN771"><span class='Ref_To_Local'>dstendptr</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN734"><span class='Ref_To_Local'>srcptr</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="arrayfuncs.c.html#LN766"><span class='Ref_To_Local'>itemdone</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>switch</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="arrayfuncs.c.html#LN734"><span class='Ref_To_Local'>srcptr</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>case</span> <span class='String'>'\0'</span><span class='Operator'>: 
</span>                    <span class='Comment_Multi_Line'>/* Signal a premature end of the string */ 
</span>                    <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"malformed array literal: \"%s\""</span><span class='Delimiter'>, 
</span>                                    <a href="arrayfuncs.c.html#LN716"><span class='Ref_to_Parameter'>origStr</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'\\'</span><span class='Operator'>: 
</span>                    <span class='Comment_Multi_Line'>/* Skip backslash, copy next character as-is. */ 
</span>                    <a href="arrayfuncs.c.html#LN734"><span class='Ref_To_Local'>srcptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="arrayfuncs.c.html#LN734"><span class='Ref_To_Local'>srcptr</span></a> <span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>                        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"malformed array literal: \"%s\""</span><span class='Delimiter'>, 
</span>                                        <a href="arrayfuncs.c.html#LN716"><span class='Ref_to_Parameter'>origStr</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <span class='Operator'>*</span><a href="arrayfuncs.c.html#LN770"><span class='Ref_To_Local'>dstptr</span></a><span class='Operator'>++ = *</span><a href="arrayfuncs.c.html#LN734"><span class='Ref_To_Local'>srcptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                    <span class='Comment_Multi_Line'>/* Treat the escaped character as non-whitespace */ 
</span>                    <a href="arrayfuncs.c.html#LN767"><span class='Ref_To_Local'>leadingspace</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                    <a href="arrayfuncs.c.html#LN771"><span class='Ref_To_Local'>dstendptr</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN770"><span class='Ref_To_Local'>dstptr</span></a><span class='Delimiter'>; 
</span>                    <a href="arrayfuncs.c.html#LN768"><span class='Ref_To_Local'>hasquoting</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* can't be a NULL marker */ 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'"'</span><span class='Operator'>: 
</span>                    <a href="arrayfuncs.c.html#LN735"><span class='Ref_To_Local'>in_quotes</span></a> <span class='Operator'>= !</span><a href="arrayfuncs.c.html#LN735"><span class='Ref_To_Local'>in_quotes</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN735"><span class='Ref_To_Local'>in_quotes</span></a><span class='Parentheses'>) 
</span>                        <a href="arrayfuncs.c.html#LN767"><span class='Ref_To_Local'>leadingspace</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* 
                         * Advance dstendptr when we exit in_quotes; this 
                         * saves having to do it in all the other in_quotes 
                         * cases. 
                         */ 
</span>                        <a href="arrayfuncs.c.html#LN771"><span class='Ref_To_Local'>dstendptr</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN770"><span class='Ref_To_Local'>dstptr</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <a href="arrayfuncs.c.html#LN768"><span class='Ref_To_Local'>hasquoting</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* can't be a NULL marker */ 
</span>                    <a href="arrayfuncs.c.html#LN734"><span class='Ref_To_Local'>srcptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'{'</span><span class='Operator'>: 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="arrayfuncs.c.html#LN735"><span class='Ref_To_Local'>in_quotes</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN733"><span class='Ref_To_Local'>nest_level</span></a> <span class='Operator'>&GT;= </span><a href="arrayfuncs.c.html#LN718"><span class='Ref_to_Parameter'>ndim</span></a><span class='Parentheses'>) 
</span>                            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                               <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"malformed array literal: \"%s\""</span><span class='Delimiter'>, 
</span>                                       <a href="arrayfuncs.c.html#LN716"><span class='Ref_to_Parameter'>origStr</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                        <a href="arrayfuncs.c.html#LN733"><span class='Ref_To_Local'>nest_level</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                        <a href="arrayfuncs.c.html#LN739"><span class='Ref_To_Local'>indx</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN733"><span class='Ref_To_Local'>nest_level</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                        <a href="arrayfuncs.c.html#LN734"><span class='Ref_To_Local'>srcptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> 
                        <span class='Operator'>*</span><a href="arrayfuncs.c.html#LN770"><span class='Ref_To_Local'>dstptr</span></a><span class='Operator'>++ = *</span><a href="arrayfuncs.c.html#LN734"><span class='Ref_To_Local'>srcptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'}'</span><span class='Operator'>: 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="arrayfuncs.c.html#LN735"><span class='Ref_To_Local'>in_quotes</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN733"><span class='Ref_To_Local'>nest_level</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                               <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"malformed array literal: \"%s\""</span><span class='Delimiter'>, 
</span>                                       <a href="arrayfuncs.c.html#LN716"><span class='Ref_to_Parameter'>origStr</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN732"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                            <a href="arrayfuncs.c.html#LN732"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="arrayutils.c.html#LN48"><span class='Ref_to_Func'>ArrayGetOffset0</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN718"><span class='Ref_to_Parameter'>ndim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN739"><span class='Ref_To_Local'>indx</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN740"><span class='Ref_To_Local'>prod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="arrayfuncs.c.html#LN739"><span class='Ref_To_Local'>indx</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN733"><span class='Ref_To_Local'>nest_level</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                        <a href="arrayfuncs.c.html#LN733"><span class='Ref_To_Local'>nest_level</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN733"><span class='Ref_To_Local'>nest_level</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                            <a href="arrayfuncs.c.html#LN736"><span class='Ref_To_Local'>eoArray</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN766"><span class='Ref_To_Local'>itemdone</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                        <span class='Control'>else</span> 
                            <a href="arrayfuncs.c.html#LN739"><span class='Ref_To_Local'>indx</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN733"><span class='Ref_To_Local'>nest_level</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                        <a href="arrayfuncs.c.html#LN734"><span class='Ref_To_Local'>srcptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> 
                        <span class='Operator'>*</span><a href="arrayfuncs.c.html#LN770"><span class='Ref_To_Local'>dstptr</span></a><span class='Operator'>++ = *</span><a href="arrayfuncs.c.html#LN734"><span class='Ref_To_Local'>srcptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>default</span><span class='Operator'>: 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN735"><span class='Ref_To_Local'>in_quotes</span></a><span class='Parentheses'>) 
</span>                        <span class='Operator'>*</span><a href="arrayfuncs.c.html#LN770"><span class='Ref_To_Local'>dstptr</span></a><span class='Operator'>++ = *</span><a href="arrayfuncs.c.html#LN734"><span class='Ref_To_Local'>srcptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="arrayfuncs.c.html#LN734"><span class='Ref_To_Local'>srcptr</span></a> <span class='Operator'>== </span><a href="arrayfuncs.c.html#LN723"><span class='Ref_to_Parameter'>typdelim</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN732"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                            <a href="arrayfuncs.c.html#LN732"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="arrayutils.c.html#LN48"><span class='Ref_to_Func'>ArrayGetOffset0</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN718"><span class='Ref_to_Parameter'>ndim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN739"><span class='Ref_To_Local'>indx</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN740"><span class='Ref_To_Local'>prod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="arrayfuncs.c.html#LN766"><span class='Ref_To_Local'>itemdone</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                        <a href="arrayfuncs.c.html#LN739"><span class='Ref_To_Local'>indx</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN718"><span class='Ref_to_Parameter'>ndim</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                        <a href="arrayfuncs.c.html#LN734"><span class='Ref_To_Local'>srcptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN88"><span class='Ref_to_Proto'>array_isspace</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="arrayfuncs.c.html#LN734"><span class='Ref_To_Local'>srcptr</span></a><span class='Parentheses'>))</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* 
                         * If leading space, drop it immediately.  Else, copy 
                         * but don't advance dstendptr. 
                         */ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN767"><span class='Ref_To_Local'>leadingspace</span></a><span class='Parentheses'>) 
</span>                            <a href="arrayfuncs.c.html#LN734"><span class='Ref_To_Local'>srcptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                        <span class='Control'>else</span> 
                            <span class='Operator'>*</span><a href="arrayfuncs.c.html#LN770"><span class='Ref_To_Local'>dstptr</span></a><span class='Operator'>++ = *</span><a href="arrayfuncs.c.html#LN734"><span class='Ref_To_Local'>srcptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Operator'>*</span><a href="arrayfuncs.c.html#LN770"><span class='Ref_To_Local'>dstptr</span></a><span class='Operator'>++ = *</span><a href="arrayfuncs.c.html#LN734"><span class='Ref_To_Local'>srcptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                        <a href="arrayfuncs.c.html#LN767"><span class='Ref_To_Local'>leadingspace</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                        <a href="arrayfuncs.c.html#LN771"><span class='Ref_To_Local'>dstendptr</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN770"><span class='Ref_To_Local'>dstptr</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch *srcptr &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while !itemdone &raquo; </span> 
 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN770"><span class='Ref_To_Local'>dstptr</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN734"><span class='Ref_To_Local'>srcptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="arrayfuncs.c.html#LN771"><span class='Ref_To_Local'>dstendptr</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN732"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="arrayfuncs.c.html#LN732"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT;= </span><a href="arrayfuncs.c.html#LN717"><span class='Ref_to_Parameter'>nitems</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"malformed array literal: \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="arrayfuncs.c.html#LN716"><span class='Ref_to_Parameter'>origStr</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN38"><span class='Ref_to_Global_Var'>Array_nulls</span></a> <span class='Operator'>&& !</span><a href="arrayfuncs.c.html#LN768"><span class='Ref_To_Local'>hasquoting</span></a> <span class='Operator'>&& 
</span>            <a href="../../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN769"><span class='Ref_To_Local'>itemstart</span></a><span class='Delimiter'>, </span><span class='String'>"NULL"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* it's a NULL item */ 
</span>            <a href="arrayfuncs.c.html#LN727"><span class='Ref_to_Parameter'>values</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN732"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN642"><span class='Ref_to_Proto'>InputFunctionCall</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN720"><span class='Ref_to_Parameter'>inputproc</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                          <a href="arrayfuncs.c.html#LN721"><span class='Ref_to_Parameter'>typioparam</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN722"><span class='Ref_to_Parameter'>typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN728"><span class='Ref_to_Parameter'>nulls</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN732"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="arrayfuncs.c.html#LN727"><span class='Ref_to_Parameter'>values</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN732"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN642"><span class='Ref_to_Proto'>InputFunctionCall</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN720"><span class='Ref_to_Parameter'>inputproc</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN769"><span class='Ref_To_Local'>itemstart</span></a><span class='Delimiter'>, 
</span>                                          <a href="arrayfuncs.c.html#LN721"><span class='Ref_to_Parameter'>typioparam</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN722"><span class='Ref_to_Parameter'>typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN728"><span class='Ref_to_Parameter'>nulls</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN732"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while !eoArray &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Check for nulls, compute total data space needed 
     */ 
</span>    <a href="arrayfuncs.c.html#LN737"><span class='Ref_To_Local'>hasnull</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN738"><span class='Ref_To_Local'>totbytes</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN732"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN732"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN717"><span class='Ref_to_Parameter'>nitems</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN732"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN728"><span class='Ref_to_Parameter'>nulls</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN732"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <a href="arrayfuncs.c.html#LN737"><span class='Ref_To_Local'>hasnull</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* let's just make sure data is not toasted */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN724"><span class='Ref_to_Parameter'>typlen</span></a> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                <a href="arrayfuncs.c.html#LN727"><span class='Ref_to_Parameter'>values</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN732"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN204"><span class='Ref_to_Macro'>PG_DETOAST_DATUM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN727"><span class='Ref_to_Parameter'>values</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN732"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN738"><span class='Ref_To_Local'>totbytes</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN159"><span class='Ref_to_Macro'>att_addlength_datum</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN738"><span class='Ref_To_Local'>totbytes</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN724"><span class='Ref_to_Parameter'>typlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN727"><span class='Ref_to_Parameter'>values</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN732"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN738"><span class='Ref_To_Local'>totbytes</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN143"><span class='Ref_to_Macro'>att_align_nominal</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN738"><span class='Ref_To_Local'>totbytes</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN726"><span class='Ref_to_Parameter'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* check for overflow of total request */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/memutils.h.html#LN41"><span class='Ref_to_Macro'>AllocSizeIsValid</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN738"><span class='Ref_To_Local'>totbytes</span></a><span class='Parentheses'>))</span> 
                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_PROGRAM_LIMIT_EXCEEDED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"array size exceeds the maximum allowed (%d)"</span><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="../../../common/psprintf.c.html#LN27"><span class='Ref_to_Const'>MaxAllocSize</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Operator'>*</span><a href="arrayfuncs.c.html#LN729"><span class='Ref_to_Parameter'>hasnulls</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN737"><span class='Ref_To_Local'>hasnull</span></a><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="arrayfuncs.c.html#LN730"><span class='Ref_to_Parameter'>nbytes</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN738"><span class='Ref_To_Local'>totbytes</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ReadArrayStr &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Copy data into an array object from a temporary array of Datums. 
 * 
 * array: array object (with header fields already filled in) 
 * values: array of Datums to be copied 
 * nulls: array of is-null flags (can be NULL if no nulls) 
 * nitems: number of Datums to be copied 
 * typbyval, typlen, typalign: info about element datatype 
 * freedata: if TRUE and element type is pass-by-ref, pfree data values 
 * referenced by Datums after copying them. 
 * 
 * If the input data is of varlena type, the caller must have ensured that 
 * the values are not toasted.  (Doing it here doesn't work since the 
 * caller has already allocated space for the array...) 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN955"></a><span class='Declare_Function'>CopyArrayEls</span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>array</span><span class='Delimiter'>, 
</span><a name="LN956"></a>             <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>values</span><span class='Delimiter'>, 
</span><a name="LN957"></a>             <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>nulls</span><span class='Delimiter'>, 
</span><a name="LN958"></a>             <span class='Keyword'>int </span><span class='Declare_Parameter'>nitems</span><span class='Delimiter'>, 
</span><a name="LN959"></a>             <span class='Keyword'>int </span><span class='Declare_Parameter'>typlen</span><span class='Delimiter'>, 
</span><a name="LN960"></a>             <span class='Keyword'>bool </span><span class='Declare_Parameter'>typbyval</span><span class='Delimiter'>, 
</span><a name="LN961"></a>             <span class='Keyword'>char </span><span class='Declare_Parameter'>typalign</span><span class='Delimiter'>, 
</span><a name="LN962"></a>             <span class='Keyword'>bool </span><span class='Declare_Parameter'>freedata</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN964"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>p</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN302"><span class='Ref_to_Macro'>ARR_DATA_PTR</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN955"><span class='Ref_to_Parameter'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN965"></a>    <a href="../../../include/c.h.html#LN274"><span class='Ref_to_Typedef'>bits8</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>bitmap</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN280"><span class='Ref_to_Macro'>ARR_NULLBITMAP</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN955"><span class='Ref_to_Parameter'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN966"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>bitval</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN967"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>bitmask</span> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span><a name="LN968"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN960"><span class='Ref_to_Parameter'>typbyval</span></a><span class='Parentheses'>) 
</span>        <a href="arrayfuncs.c.html#LN962"><span class='Ref_to_Parameter'>freedata</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN968"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN968"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN958"><span class='Ref_to_Parameter'>nitems</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN968"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN957"><span class='Ref_to_Parameter'>nulls</span></a> <span class='Operator'>&& </span><a href="arrayfuncs.c.html#LN957"><span class='Ref_to_Parameter'>nulls</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN968"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="arrayfuncs.c.html#LN965"><span class='Ref_To_Local'>bitmap</span></a><span class='Parentheses'>)</span>        <span class='Comment_Single_Line'>/* shouldn't happen */ 
</span>                <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"null array element where not supported"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* bitmap bit stays 0 */ 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="arrayfuncs.c.html#LN966"><span class='Ref_To_Local'>bitval</span></a> <span class='Operator'>|= </span><a href="arrayfuncs.c.html#LN967"><span class='Ref_To_Local'>bitmask</span></a><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN964"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+= </span><a href="arrayfuncs.c.html#LN115"><span class='Ref_to_Proto'>ArrayCastAndSet</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN956"><span class='Ref_to_Parameter'>values</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN968"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="arrayfuncs.c.html#LN959"><span class='Ref_to_Parameter'>typlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN960"><span class='Ref_to_Parameter'>typbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN961"><span class='Ref_to_Parameter'>typalign</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN964"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN962"><span class='Ref_to_Parameter'>freedata</span></a><span class='Parentheses'>) 
</span>                <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN956"><span class='Ref_to_Parameter'>values</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN968"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN965"><span class='Ref_To_Local'>bitmap</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="arrayfuncs.c.html#LN967"><span class='Ref_To_Local'>bitmask</span></a> <span class='Operator'>&LT;&LT;= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN967"><span class='Ref_To_Local'>bitmask</span></a> <span class='Operator'>== </span><span class='Number'>0x100</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Operator'>*</span><a href="arrayfuncs.c.html#LN965"><span class='Ref_To_Local'>bitmap</span></a><span class='Operator'>++ = </span><a href="arrayfuncs.c.html#LN966"><span class='Ref_To_Local'>bitval</span></a><span class='Delimiter'>; 
</span>                <a href="arrayfuncs.c.html#LN966"><span class='Ref_To_Local'>bitval</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <a href="arrayfuncs.c.html#LN967"><span class='Ref_To_Local'>bitmask</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;nitems;i++ &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN965"><span class='Ref_To_Local'>bitmap</span></a> <span class='Operator'>&& </span><a href="arrayfuncs.c.html#LN967"><span class='Ref_To_Local'>bitmask</span></a> <span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="arrayfuncs.c.html#LN965"><span class='Ref_To_Local'>bitmap</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN966"><span class='Ref_To_Local'>bitval</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end CopyArrayEls &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * array_out : 
 *         takes the internal representation of an array and returns a string 
 *        containing the array in its external format. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1010"></a><span class='Declare_Function'>array_out</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1012"></a>    <a href="../../../include/utils/array.h.html#LN157"><span class='Ref_to_Union'>AnyArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Local'>v</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN254"><span class='Ref_to_Macro'>PG_GETARG_ANY_ARRAY</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1013"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>element_type</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN314"><span class='Ref_to_Macro'>AARR_ELEMTYPE</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1012"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1014"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>typlen</span><span class='Delimiter'>; 
</span><a name="LN1015"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>typbyval</span><span class='Delimiter'>; 
</span><a name="LN1016"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>typalign</span><span class='Delimiter'>; 
</span><a name="LN1017"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>typdelim</span><span class='Delimiter'>; 
</span><a name="LN1018"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>p</span><span class='Delimiter'>, 
</span><a name="LN1019"></a>               <span class='Operator'>*</span><span class='Declare_Local'>tmp</span><span class='Delimiter'>, 
</span><a name="LN1020"></a>               <span class='Operator'>*</span><span class='Declare_Local'>retval</span><span class='Delimiter'>, 
</span><a name="LN1021"></a>              <span class='Operator'>**</span><span class='Declare_Local'>values</span><span class='Delimiter'>, 
</span><a name="LN1022"></a>                <span class='Declare_Local'>dims_str</span><span class='Delimiter'>[</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a> <span class='Operator'>* </span><span class='Number'>33</span><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>2</span><span class='Delimiter'>]; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * 33 per dim since we assume 15 digits per number + ':' +'[]' 
     * 
     * +2 allows for assignment operator + trailing null 
     */ 
</span><a name="LN1029"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>needquotes</span><span class='Delimiter'>, 
</span><a name="LN1030"></a>                <span class='Declare_Local'>needdims</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN1031"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nitems</span><span class='Delimiter'>, 
</span><a name="LN1032"></a>                <span class='Declare_Local'>overall_length</span><span class='Delimiter'>, 
</span><a name="LN1033"></a>                <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN1034"></a>                <span class='Declare_Local'>j</span><span class='Delimiter'>, 
</span><a name="LN1035"></a>                <span class='Declare_Local'>k</span><span class='Delimiter'>, 
</span><a name="LN1036"></a>                <span class='Declare_Local'>indx</span><span class='Delimiter'>[</span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Delimiter'>]; 
</span><a name="LN1037"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ndim</span><span class='Delimiter'>, 
</span><a name="LN1038"></a>               <span class='Operator'>*</span><span class='Declare_Local'>dims</span><span class='Delimiter'>, 
</span><a name="LN1039"></a>               <span class='Operator'>*</span><span class='Declare_Local'>lb</span><span class='Delimiter'>; 
</span><a name="LN1040"></a>    <a href="../../../include/utils/arrayaccess.h.html#LN32"><span class='Ref_to_Struct'>array_iter</span></a>  <span class='Declare_Local'>iter</span><span class='Delimiter'>; 
</span><a name="LN1041"></a>    <a href="../../../include/utils/array.h.html#LN216"><span class='Ref_to_Struct'>ArrayMetaState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>my_extra</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We arrange to look up info about element type, including its output 
     * conversion proc, only once per series of calls, assuming the element 
     * type doesn't change underneath us. 
     */ 
</span>    <a href="arrayfuncs.c.html#LN1041"><span class='Ref_To_Local'>my_extra</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN216"><span class='Ref_to_Struct'>ArrayMetaState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_extra<span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1041"><span class='Ref_To_Local'>my_extra</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_extra <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_mcxt<span class='Delimiter'>, 
</span>                                                      <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN216"><span class='Ref_to_Struct'>ArrayMetaState</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN1041"><span class='Ref_To_Local'>my_extra</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN216"><span class='Ref_to_Struct'>ArrayMetaState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_extra<span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN1041"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN218"><span class='Ref_to_Member'>element_type</span></a> <span class='Operator'>= ~</span><a href="arrayfuncs.c.html#LN1013"><span class='Ref_To_Local'>element_type</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1041"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN218"><span class='Ref_to_Member'>element_type</span></a> <span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN1013"><span class='Ref_To_Local'>element_type</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Get info about element type, including its output conversion proc 
         */ 
</span>        <a href="../../../include/utils/lsyscache.h.html#LN139"><span class='Ref_to_Proto'>get_type_io_data</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1013"><span class='Ref_To_Local'>element_type</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/lsyscache.h.html#LN32"><span class='Ref_to_EnumConst'>IOFunc_output</span></a><span class='Delimiter'>, 
</span>                         <span class='Operator'>&</span><a href="arrayfuncs.c.html#LN1041"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN219"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN1041"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN220"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>, 
</span>                         <span class='Operator'>&</span><a href="arrayfuncs.c.html#LN1041"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN221"><span class='Ref_to_Member'>typalign</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN1041"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN222"><span class='Ref_to_Member'>typdelim</span></a><span class='Delimiter'>, 
</span>                         <span class='Operator'>&</span><a href="arrayfuncs.c.html#LN1041"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN223"><span class='Ref_to_Member'>typioparam</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN1041"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN224"><span class='Ref_to_Member'>typiofunc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/fmgr.h.html#LN99"><span class='Ref_to_Proto'>fmgr_info_cxt</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1041"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN224"><span class='Ref_to_Member'>typiofunc</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN1041"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN225"><span class='Ref_to_Member'>proc</span></a><span class='Delimiter'>, 
</span>                      fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_mcxt<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN1041"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN218"><span class='Ref_to_Member'>element_type</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN1013"><span class='Ref_To_Local'>element_type</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="arrayfuncs.c.html#LN1014"><span class='Ref_To_Local'>typlen</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN1041"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN219"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN1015"><span class='Ref_To_Local'>typbyval</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN1041"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN220"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN1016"><span class='Ref_To_Local'>typalign</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN1041"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN221"><span class='Ref_to_Member'>typalign</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN1017"><span class='Ref_To_Local'>typdelim</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN1041"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN222"><span class='Ref_to_Member'>typdelim</span></a><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN1037"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN308"><span class='Ref_to_Macro'>AARR_NDIM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1012"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN1038"><span class='Ref_To_Local'>dims</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN316"><span class='Ref_to_Macro'>AARR_DIMS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1012"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN1039"><span class='Ref_To_Local'>lb</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN318"><span class='Ref_to_Macro'>AARR_LBOUND</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1012"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN1031"><span class='Ref_To_Local'>nitems</span></a> <span class='Operator'>= </span><a href="arrayutils.c.html#LN73"><span class='Ref_to_Func'>ArrayGetNItems</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1037"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1038"><span class='Ref_To_Local'>dims</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1031"><span class='Ref_To_Local'>nitems</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="arrayfuncs.c.html#LN1020"><span class='Ref_To_Local'>retval</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><span class='String'>"{}"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/fmgr.h.html#LN321"><span class='Ref_to_Macro'>PG_RETURN_CSTRING</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1020"><span class='Ref_To_Local'>retval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * we will need to add explicit dimensions if any dimension has a lower 
     * bound other than one 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1033"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN1033"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN1037"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN1033"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1039"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1033"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="arrayfuncs.c.html#LN1030"><span class='Ref_To_Local'>needdims</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Convert all values to string form, count total space needed (including 
     * any overhead such as escaping backslashes), and detect whether each 
     * item needs double quotes. 
     */ 
</span>    <a href="arrayfuncs.c.html#LN1021"><span class='Ref_To_Local'>values</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1031"><span class='Ref_To_Local'>nitems</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN1029"><span class='Ref_To_Local'>needquotes</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1031"><span class='Ref_To_Local'>nitems</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN1032"><span class='Ref_To_Local'>overall_length</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* don't forget to count \0 at end. */ 
</span> 
    <a href="../../../include/utils/arrayaccess.h.html#LN47"><span class='Ref_to_Func'>array_iter_setup</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN1040"><span class='Ref_To_Local'>iter</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1012"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1033"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN1033"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN1031"><span class='Ref_To_Local'>nitems</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN1033"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1112"></a>        <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>itemvalue</span><span class='Delimiter'>; 
</span><a name="LN1113"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN1114"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>needquote</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Get source element, checking for NULL */ 
</span>        <a href="arrayfuncs.c.html#LN1112"><span class='Ref_To_Local'>itemvalue</span></a> <span class='Operator'>= </span><a href="../../../include/utils/arrayaccess.h.html#LN79"><span class='Ref_to_Func'>array_iter_next</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN1040"><span class='Ref_To_Local'>iter</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN1113"><span class='Ref_To_Local'>isnull</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1033"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, 
</span>                                    <a href="arrayfuncs.c.html#LN1014"><span class='Ref_To_Local'>typlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1015"><span class='Ref_To_Local'>typbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1016"><span class='Ref_To_Local'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1113"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="arrayfuncs.c.html#LN1021"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1033"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><span class='String'>"NULL"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN1032"><span class='Ref_To_Local'>overall_length</span></a> <span class='Operator'>+= </span><span class='Number'>4</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN1114"><span class='Ref_To_Local'>needquote</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="arrayfuncs.c.html#LN1021"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1033"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN646"><span class='Ref_to_Proto'>OutputFunctionCall</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN1041"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN225"><span class='Ref_to_Member'>proc</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1112"><span class='Ref_To_Local'>itemvalue</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* count data plus backslashes; detect chars needing quotes */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1021"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1033"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>][</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>                <a href="arrayfuncs.c.html#LN1114"><span class='Ref_To_Local'>needquote</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* force quotes for empty string */ 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1021"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1033"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='String'>"NULL"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="arrayfuncs.c.html#LN1114"><span class='Ref_To_Local'>needquote</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* force quotes for literal NULL */ 
</span>            <span class='Control'>else</span> 
                <a href="arrayfuncs.c.html#LN1114"><span class='Ref_To_Local'>needquote</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1019"><span class='Ref_To_Local'>tmp</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN1021"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1033"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; </span><span class='Operator'>*</span><a href="arrayfuncs.c.html#LN1019"><span class='Ref_To_Local'>tmp</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN1019"><span class='Ref_To_Local'>tmp</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1140"></a>                <span class='Keyword'>char</span>        <span class='Declare_Local'>ch</span> <span class='Operator'>= *</span><a href="arrayfuncs.c.html#LN1019"><span class='Ref_To_Local'>tmp</span></a><span class='Delimiter'>; 
</span> 
                <a href="arrayfuncs.c.html#LN1032"><span class='Ref_To_Local'>overall_length</span></a> <span class='Operator'>+= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1140"><span class='Ref_To_Local'>ch</span></a> <span class='Operator'>== </span><span class='String'>'"'</span> <span class='Operator'>|| </span><a href="arrayfuncs.c.html#LN1140"><span class='Ref_To_Local'>ch</span></a> <span class='Operator'>== </span><span class='String'>'\\'</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="arrayfuncs.c.html#LN1114"><span class='Ref_To_Local'>needquote</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                    <a href="arrayfuncs.c.html#LN1032"><span class='Ref_To_Local'>overall_length</span></a> <span class='Operator'>+= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1140"><span class='Ref_To_Local'>ch</span></a> <span class='Operator'>== </span><span class='String'>'{'</span> <span class='Operator'>|| </span><a href="arrayfuncs.c.html#LN1140"><span class='Ref_To_Local'>ch</span></a> <span class='Operator'>== </span><span class='String'>'}'</span> <span class='Operator'>|| </span><a href="arrayfuncs.c.html#LN1140"><span class='Ref_To_Local'>ch</span></a> <span class='Operator'>== </span><a href="arrayfuncs.c.html#LN1017"><span class='Ref_To_Local'>typdelim</span></a> <span class='Operator'>|| 
</span>                         <a href="arrayfuncs.c.html#LN88"><span class='Ref_to_Proto'>array_isspace</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1140"><span class='Ref_To_Local'>ch</span></a><span class='Parentheses'>))</span> 
                    <a href="arrayfuncs.c.html#LN1114"><span class='Ref_To_Local'>needquote</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
        <a href="arrayfuncs.c.html#LN1029"><span class='Ref_To_Local'>needquotes</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1033"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="arrayfuncs.c.html#LN1114"><span class='Ref_To_Local'>needquote</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Count the pair of double quotes, if needed */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1114"><span class='Ref_To_Local'>needquote</span></a><span class='Parentheses'>) 
</span>            <a href="arrayfuncs.c.html#LN1032"><span class='Ref_To_Local'>overall_length</span></a> <span class='Operator'>+= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* and the comma */ 
</span>        <a href="arrayfuncs.c.html#LN1032"><span class='Ref_To_Local'>overall_length</span></a> <span class='Operator'>+= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;nitems;i++ &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * count total number of curly braces in output string 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1033"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN1034"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1035"><span class='Ref_To_Local'>k</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN1033"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN1037"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN1033"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <a href="arrayfuncs.c.html#LN1035"><span class='Ref_To_Local'>k</span></a> <span class='Operator'>*= </span><a href="arrayfuncs.c.html#LN1038"><span class='Ref_To_Local'>dims</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1033"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="arrayfuncs.c.html#LN1034"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>+= </span><a href="arrayfuncs.c.html#LN1035"><span class='Ref_To_Local'>k</span></a><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN1022"><span class='Ref_To_Local'>dims_str</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* add explicit dimensions if required */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1030"><span class='Ref_To_Local'>needdims</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1174"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>ptr</span> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN1022"><span class='Ref_To_Local'>dims_str</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1033"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN1033"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN1037"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN1033"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1174"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>, </span><span class='String'>"[%d:%d]"</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1039"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1033"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="arrayfuncs.c.html#LN1039"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1033"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN1038"><span class='Ref_To_Local'>dims</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1033"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN1174"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>+= </span>strlen<span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1174"><span class='Ref_To_Local'>ptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Operator'>*</span><a href="arrayfuncs.c.html#LN1174"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>++ = *</span><a href="arrayfuncs.c.html#LN43"><span class='Ref_to_Const'>ASSGN</span></a><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="arrayfuncs.c.html#LN1174"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="arrayfuncs.c.html#LN1020"><span class='Ref_To_Local'>retval</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1022"><span class='Ref_To_Local'>dims_str</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN1032"><span class='Ref_To_Local'>overall_length</span></a> <span class='Operator'>+ </span><span class='Number'>2</span> <span class='Operator'>* </span><a href="arrayfuncs.c.html#LN1034"><span class='Ref_To_Local'>j</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN1018"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN1020"><span class='Ref_To_Local'>retval</span></a><span class='Delimiter'>; 
</span> 
<a name="LN1188"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>APPENDSTR</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>str</span><span class='Parentheses'>)</span>  <span class='Parentheses'>(</span><a href="../../../../contrib/cube/cubeparse.y.html#LN150"><span class='Ref_to_Proto'>strcpy</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1018"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../test/isolation/specparse.y.html#LN26"><span class='Ref_to_Global_Var'>str</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1018"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+= </span>strlen<span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1018"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>))</span> 
<a name="LN1189"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>APPENDCHAR</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>ch</span><span class='Parentheses'>)</span>  <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="arrayfuncs.c.html#LN1018"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++ = </span><span class='Parentheses'>(</span>ch<span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="arrayfuncs.c.html#LN1018"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Parentheses'>)</span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1030"><span class='Ref_To_Local'>needdims</span></a><span class='Parentheses'>) 
</span>        <a href="arrayfuncs.c.html#LN1188"><span class='Ref_to_Macro'>APPENDSTR</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1022"><span class='Ref_To_Local'>dims_str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN1189"><span class='Ref_to_Macro'>APPENDCHAR</span></a><span class='Parentheses'>(</span><span class='String'>'{'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1033"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN1033"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN1037"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN1033"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <a href="arrayfuncs.c.html#LN1036"><span class='Ref_To_Local'>indx</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1033"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN1034"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN1035"><span class='Ref_To_Local'>k</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>do</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1033"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN1034"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN1033"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN1037"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN1033"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <a href="arrayfuncs.c.html#LN1189"><span class='Ref_to_Macro'>APPENDCHAR</span></a><span class='Parentheses'>(</span><span class='String'>'{'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1029"><span class='Ref_To_Local'>needquotes</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1035"><span class='Ref_To_Local'>k</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="arrayfuncs.c.html#LN1189"><span class='Ref_to_Macro'>APPENDCHAR</span></a><span class='Parentheses'>(</span><span class='String'>'"'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1019"><span class='Ref_To_Local'>tmp</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN1021"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1035"><span class='Ref_To_Local'>k</span></a><span class='Delimiter'>]; </span><span class='Operator'>*</span><a href="arrayfuncs.c.html#LN1019"><span class='Ref_To_Local'>tmp</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN1019"><span class='Ref_To_Local'>tmp</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1208"></a>                <span class='Keyword'>char</span>        <span class='Declare_Local'>ch</span> <span class='Operator'>= *</span><a href="arrayfuncs.c.html#LN1019"><span class='Ref_To_Local'>tmp</span></a><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1208"><span class='Ref_To_Local'>ch</span></a> <span class='Operator'>== </span><span class='String'>'"'</span> <span class='Operator'>|| </span><a href="arrayfuncs.c.html#LN1208"><span class='Ref_To_Local'>ch</span></a> <span class='Operator'>== </span><span class='String'>'\\'</span><span class='Parentheses'>) 
</span>                    <span class='Operator'>*</span><a href="arrayfuncs.c.html#LN1018"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++ = </span><span class='String'>'\\'</span><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><a href="arrayfuncs.c.html#LN1018"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++ = </span><a href="arrayfuncs.c.html#LN1208"><span class='Ref_To_Local'>ch</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Operator'>*</span><a href="arrayfuncs.c.html#LN1018"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN1189"><span class='Ref_to_Macro'>APPENDCHAR</span></a><span class='Parentheses'>(</span><span class='String'>'"'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="arrayfuncs.c.html#LN1188"><span class='Ref_to_Macro'>APPENDSTR</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1021"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1035"><span class='Ref_To_Local'>k</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1021"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1035"><span class='Ref_To_Local'>k</span></a><span class='Operator'>++</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1033"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN1037"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN1033"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN1033"><span class='Ref_To_Local'>i</span></a><span class='Operator'>--</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="arrayfuncs.c.html#LN1036"><span class='Ref_To_Local'>indx</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1033"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1036"><span class='Ref_To_Local'>indx</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1033"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>% </span><a href="arrayfuncs.c.html#LN1038"><span class='Ref_To_Local'>dims</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1033"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1036"><span class='Ref_To_Local'>indx</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1033"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="arrayfuncs.c.html#LN1189"><span class='Ref_to_Macro'>APPENDCHAR</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1017"><span class='Ref_To_Local'>typdelim</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
                <a href="arrayfuncs.c.html#LN1189"><span class='Ref_to_Macro'>APPENDCHAR</span></a><span class='Parentheses'>(</span><span class='String'>'}'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="arrayfuncs.c.html#LN1034"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN1033"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end do &raquo; </span> <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1034"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>!= -</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Keyword'>#undef </span><a href="arrayfuncs.c.html#LN1188"><span class='Ref_to_Macro'>APPENDSTR</span></a> 
<span class='Keyword'>#undef </span><a href="arrayfuncs.c.html#LN1189"><span class='Ref_to_Macro'>APPENDCHAR</span></a> 
 
    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1021"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1029"><span class='Ref_To_Local'>needquotes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN321"><span class='Ref_to_Macro'>PG_RETURN_CSTRING</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1020"><span class='Ref_To_Local'>retval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end array_out &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * array_recv : 
 *        converts an array from the external binary format to 
 *        its internal format. 
 * 
 * return value : 
 *        the internal representation of the input array 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1253"></a><span class='Declare_Function'>array_recv</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1255"></a>    <a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a>  <span class='Declare_Local'>buf</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1256"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>spec_element_type</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>   <span class='Comment_Multi_Line'>/* type of an array 
                                                         * element */ 
</span><a name="LN1258"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>typmod</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* typmod for array elements */ 
</span><a name="LN1259"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>element_type</span><span class='Delimiter'>; 
</span><a name="LN1260"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>typlen</span><span class='Delimiter'>; 
</span><a name="LN1261"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>typbyval</span><span class='Delimiter'>; 
</span><a name="LN1262"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>typalign</span><span class='Delimiter'>; 
</span><a name="LN1263"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typioparam</span><span class='Delimiter'>; 
</span><a name="LN1264"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN1265"></a>                <span class='Declare_Local'>nitems</span><span class='Delimiter'>; 
</span><a name="LN1266"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>dataPtr</span><span class='Delimiter'>; 
</span><a name="LN1267"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>nullsPtr</span><span class='Delimiter'>; 
</span><a name="LN1268"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>hasnulls</span><span class='Delimiter'>; 
</span><a name="LN1269"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>nbytes</span><span class='Delimiter'>; 
</span><a name="LN1270"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>dataoffset</span><span class='Delimiter'>; 
</span><a name="LN1271"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>retval</span><span class='Delimiter'>; 
</span><a name="LN1272"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ndim</span><span class='Delimiter'>, 
</span><a name="LN1273"></a>                <span class='Declare_Local'>flags</span><span class='Delimiter'>, 
</span><a name="LN1274"></a>                <span class='Declare_Local'>dim</span><span class='Delimiter'>[</span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Delimiter'>], 
</span><a name="LN1275"></a>                <span class='Declare_Local'>lBound</span><span class='Delimiter'>[</span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Delimiter'>]; 
</span><a name="LN1276"></a>    <a href="../../../include/utils/array.h.html#LN216"><span class='Ref_to_Struct'>ArrayMetaState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>my_extra</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get the array header information */ 
</span>    <a href="arrayfuncs.c.html#LN1272"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>= </span><a href="../../../include/libpq/pqformat.h.html#LN38"><span class='Ref_to_Proto'>pq_getmsgint</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1255"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1272"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span>               <span class='Comment_Single_Line'>/* we do allow zero-dimension arrays */ 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_BINARY_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid number of dimensions: %d"</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1272"><span class='Ref_To_Local'>ndim</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1272"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>&GT; </span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_PROGRAM_LIMIT_EXCEEDED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"number of array dimensions (%d) exceeds the maximum allowed (%d)"</span><span class='Delimiter'>, 
</span>                        <a href="arrayfuncs.c.html#LN1272"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN1273"><span class='Ref_To_Local'>flags</span></a> <span class='Operator'>= </span><a href="../../../include/libpq/pqformat.h.html#LN38"><span class='Ref_to_Proto'>pq_getmsgint</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1255"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1273"><span class='Ref_To_Local'>flags</span></a> <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="arrayfuncs.c.html#LN1273"><span class='Ref_To_Local'>flags</span></a> <span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_BINARY_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid array flags"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN1259"><span class='Ref_To_Local'>element_type</span></a> <span class='Operator'>= </span><a href="../../../include/libpq/pqformat.h.html#LN38"><span class='Ref_to_Proto'>pq_getmsgint</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1255"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1259"><span class='Ref_To_Local'>element_type</span></a> <span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN1256"><span class='Ref_To_Local'>spec_element_type</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* XXX Can we allow taking the input element type in any cases? */ 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"wrong element type"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1264"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN1264"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN1272"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN1264"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="arrayfuncs.c.html#LN1274"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1264"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/libpq/pqformat.h.html#LN38"><span class='Ref_to_Proto'>pq_getmsgint</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1255"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN1275"><span class='Ref_To_Local'>lBound</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1264"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/libpq/pqformat.h.html#LN38"><span class='Ref_to_Proto'>pq_getmsgint</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1255"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Check overflow of upper bound. (ArrayNItems() below checks that 
         * dim[i] &GT;= 0) 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1274"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1264"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1316"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>ub</span> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN1275"><span class='Ref_To_Local'>lBound</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1264"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN1274"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1264"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1275"><span class='Ref_To_Local'>lBound</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1264"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>&GT; </span><a href="arrayfuncs.c.html#LN1316"><span class='Ref_To_Local'>ub</span></a><span class='Parentheses'>) 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NUMERIC_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"integer out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* This checks for overflow of array dimensions */ 
</span>    <a href="arrayfuncs.c.html#LN1265"><span class='Ref_To_Local'>nitems</span></a> <span class='Operator'>= </span><a href="arrayutils.c.html#LN73"><span class='Ref_to_Func'>ArrayGetNItems</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1272"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1274"><span class='Ref_To_Local'>dim</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We arrange to look up info about element type, including its receive 
     * conversion proc, only once per series of calls, assuming the element 
     * type doesn't change underneath us. 
     */ 
</span>    <a href="arrayfuncs.c.html#LN1276"><span class='Ref_To_Local'>my_extra</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN216"><span class='Ref_to_Struct'>ArrayMetaState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_extra<span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1276"><span class='Ref_To_Local'>my_extra</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_extra <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_mcxt<span class='Delimiter'>, 
</span>                                                      <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN216"><span class='Ref_to_Struct'>ArrayMetaState</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN1276"><span class='Ref_To_Local'>my_extra</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN216"><span class='Ref_to_Struct'>ArrayMetaState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_extra<span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN1276"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN218"><span class='Ref_to_Member'>element_type</span></a> <span class='Operator'>= ~</span><a href="arrayfuncs.c.html#LN1259"><span class='Ref_To_Local'>element_type</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1276"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN218"><span class='Ref_to_Member'>element_type</span></a> <span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN1259"><span class='Ref_To_Local'>element_type</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Get info about element type, including its receive proc */ 
</span>        <a href="../../../include/utils/lsyscache.h.html#LN139"><span class='Ref_to_Proto'>get_type_io_data</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1259"><span class='Ref_To_Local'>element_type</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/lsyscache.h.html#LN33"><span class='Ref_to_EnumConst'>IOFunc_receive</span></a><span class='Delimiter'>, 
</span>                         <span class='Operator'>&</span><a href="arrayfuncs.c.html#LN1276"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN219"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN1276"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN220"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>, 
</span>                         <span class='Operator'>&</span><a href="arrayfuncs.c.html#LN1276"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN221"><span class='Ref_to_Member'>typalign</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN1276"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN222"><span class='Ref_to_Member'>typdelim</span></a><span class='Delimiter'>, 
</span>                         <span class='Operator'>&</span><a href="arrayfuncs.c.html#LN1276"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN223"><span class='Ref_to_Member'>typioparam</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN1276"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN224"><span class='Ref_to_Member'>typiofunc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1276"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN224"><span class='Ref_to_Member'>typiofunc</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_FUNCTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"no binary input function available for type %s"</span><span class='Delimiter'>, 
</span>                            <a href="format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1259"><span class='Ref_To_Local'>element_type</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>        <a href="../../../include/fmgr.h.html#LN99"><span class='Ref_to_Proto'>fmgr_info_cxt</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1276"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN224"><span class='Ref_to_Member'>typiofunc</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN1276"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN225"><span class='Ref_to_Member'>proc</span></a><span class='Delimiter'>, 
</span>                      fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_mcxt<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN1276"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN218"><span class='Ref_to_Member'>element_type</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN1259"><span class='Ref_To_Local'>element_type</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1265"><span class='Ref_To_Local'>nitems</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Return empty array ... but not till we've validated element_type */ 
</span>        <a href="../../../include/utils/array.h.html#LN245"><span class='Ref_to_Macro'>PG_RETURN_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN378"><span class='Ref_to_Proto'>construct_empty_array</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1259"><span class='Ref_To_Local'>element_type</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="arrayfuncs.c.html#LN1260"><span class='Ref_To_Local'>typlen</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN1276"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN219"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN1261"><span class='Ref_To_Local'>typbyval</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN1276"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN220"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN1262"><span class='Ref_To_Local'>typalign</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN1276"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN221"><span class='Ref_to_Member'>typalign</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN1263"><span class='Ref_To_Local'>typioparam</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN1276"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN223"><span class='Ref_to_Member'>typioparam</span></a><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN1266"><span class='Ref_To_Local'>dataPtr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1265"><span class='Ref_To_Local'>nitems</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN1267"><span class='Ref_To_Local'>nullsPtr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1265"><span class='Ref_To_Local'>nitems</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN97"><span class='Ref_to_Proto'>ReadArrayBinary</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1255"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1265"><span class='Ref_To_Local'>nitems</span></a><span class='Delimiter'>, 
</span>                    <span class='Operator'>&</span><a href="arrayfuncs.c.html#LN1276"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN225"><span class='Ref_to_Member'>proc</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1263"><span class='Ref_To_Local'>typioparam</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1258"><span class='Ref_To_Local'>typmod</span></a><span class='Delimiter'>, 
</span>                    <a href="arrayfuncs.c.html#LN1260"><span class='Ref_To_Local'>typlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1261"><span class='Ref_To_Local'>typbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1262"><span class='Ref_To_Local'>typalign</span></a><span class='Delimiter'>, 
</span>                    <a href="arrayfuncs.c.html#LN1266"><span class='Ref_To_Local'>dataPtr</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1267"><span class='Ref_To_Local'>nullsPtr</span></a><span class='Delimiter'>, 
</span>                    <span class='Operator'>&</span><a href="arrayfuncs.c.html#LN1268"><span class='Ref_To_Local'>hasnulls</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN1269"><span class='Ref_To_Local'>nbytes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1268"><span class='Ref_To_Local'>hasnulls</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="arrayfuncs.c.html#LN1270"><span class='Ref_To_Local'>dataoffset</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN292"><span class='Ref_to_Macro'>ARR_OVERHEAD_WITHNULLS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1272"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1265"><span class='Ref_To_Local'>nitems</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN1269"><span class='Ref_To_Local'>nbytes</span></a> <span class='Operator'>+= </span><a href="arrayfuncs.c.html#LN1270"><span class='Ref_To_Local'>dataoffset</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="arrayfuncs.c.html#LN1270"><span class='Ref_To_Local'>dataoffset</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* marker for no null bitmap */ 
</span>        <a href="arrayfuncs.c.html#LN1269"><span class='Ref_To_Local'>nbytes</span></a> <span class='Operator'>+= </span><a href="../../../include/utils/array.h.html#LN290"><span class='Ref_to_Macro'>ARR_OVERHEAD_NONULLS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1272"><span class='Ref_To_Local'>ndim</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="arrayfuncs.c.html#LN1271"><span class='Ref_To_Local'>retval</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1269"><span class='Ref_To_Local'>nbytes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1271"><span class='Ref_To_Local'>retval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1269"><span class='Ref_To_Local'>nbytes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN1271"><span class='Ref_To_Local'>retval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN78"><span class='Ref_to_Member'>ndim</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN1272"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN1271"><span class='Ref_To_Local'>retval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN79"><span class='Ref_to_Member'>dataoffset</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN1270"><span class='Ref_To_Local'>dataoffset</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN1271"><span class='Ref_To_Local'>retval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN80"><span class='Ref_to_Member'>elemtype</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN1259"><span class='Ref_To_Local'>element_type</span></a><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1271"><span class='Ref_To_Local'>retval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1274"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1272"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN276"><span class='Ref_to_Macro'>ARR_LBOUND</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1271"><span class='Ref_To_Local'>retval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1275"><span class='Ref_To_Local'>lBound</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1272"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/array.h.html#LN330"><span class='Ref_to_Proto'>CopyArrayEls</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1271"><span class='Ref_To_Local'>retval</span></a><span class='Delimiter'>, 
</span>                 <a href="arrayfuncs.c.html#LN1266"><span class='Ref_To_Local'>dataPtr</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1267"><span class='Ref_To_Local'>nullsPtr</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1265"><span class='Ref_To_Local'>nitems</span></a><span class='Delimiter'>, 
</span>                 <a href="arrayfuncs.c.html#LN1260"><span class='Ref_To_Local'>typlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1261"><span class='Ref_To_Local'>typbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1262"><span class='Ref_To_Local'>typalign</span></a><span class='Delimiter'>, 
</span>                 <span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1266"><span class='Ref_To_Local'>dataPtr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1267"><span class='Ref_To_Local'>nullsPtr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/array.h.html#LN245"><span class='Ref_to_Macro'>PG_RETURN_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1271"><span class='Ref_To_Local'>retval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end array_recv &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ReadArrayBinary: 
 *   collect the data elements of an array being read in binary style. 
 * 
 * Inputs: 
 *  buf: the data buffer to read from. 
 *  nitems: total number of array elements (already read). 
 *  receiveproc: type-specific receive procedure for element datatype. 
 *  typioparam, typmod: auxiliary values to pass to receiveproc. 
 *  typlen, typbyval, typalign: storage parameters of element datatype. 
 * 
 * Outputs: 
 *  values[]: filled with converted data values. 
 *  nulls[]: filled with is-null markers. 
 *  *hasnulls: set TRUE iff there are any null elements. 
 *  *nbytes: set to total size of data area needed (including alignment 
 *      padding but not including array header overhead). 
 * 
 * Note that values[] and nulls[] are allocated by the caller, and must have 
 * nitems elements. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1428"></a><span class='Declare_Function'>ReadArrayBinary</span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>buf</span><span class='Delimiter'>, 
</span><a name="LN1429"></a>                <span class='Keyword'>int </span><span class='Declare_Parameter'>nitems</span><span class='Delimiter'>, 
</span><a name="LN1430"></a>                <a href="../../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>receiveproc</span><span class='Delimiter'>, 
</span><a name="LN1431"></a>                <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typioparam</span><span class='Delimiter'>, 
</span><a name="LN1432"></a>                <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>typmod</span><span class='Delimiter'>, 
</span><a name="LN1433"></a>                <span class='Keyword'>int </span><span class='Declare_Parameter'>typlen</span><span class='Delimiter'>, 
</span><a name="LN1434"></a>                <span class='Keyword'>bool </span><span class='Declare_Parameter'>typbyval</span><span class='Delimiter'>, 
</span><a name="LN1435"></a>                <span class='Keyword'>char </span><span class='Declare_Parameter'>typalign</span><span class='Delimiter'>, 
</span><a name="LN1436"></a>                <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>values</span><span class='Delimiter'>, 
</span><a name="LN1437"></a>                <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>nulls</span><span class='Delimiter'>, 
</span><a name="LN1438"></a>                <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>hasnulls</span><span class='Delimiter'>, 
</span><a name="LN1439"></a>                <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>nbytes</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1441"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN1442"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>hasnull</span><span class='Delimiter'>; 
</span><a name="LN1443"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>totbytes</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1441"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN1441"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN1429"><span class='Ref_to_Parameter'>nitems</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN1441"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1447"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>itemlen</span><span class='Delimiter'>; 
</span><a name="LN1448"></a>        <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>elem_buf</span><span class='Delimiter'>; 
</span><a name="LN1449"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>csave</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Get and check the item length */ 
</span>        <a href="arrayfuncs.c.html#LN1447"><span class='Ref_To_Local'>itemlen</span></a> <span class='Operator'>= </span><a href="../../../include/libpq/pqformat.h.html#LN38"><span class='Ref_to_Proto'>pq_getmsgint</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1428"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1447"><span class='Ref_To_Local'>itemlen</span></a> <span class='Operator'>&LT; -</span><span class='Number'>1</span> <span class='Operator'>|| </span><a href="arrayfuncs.c.html#LN1447"><span class='Ref_To_Local'>itemlen</span></a> <span class='Operator'>&GT; </span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1428"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>- </span><a href="arrayfuncs.c.html#LN1428"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN39"><span class='Ref_to_Member'>cursor</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_BINARY_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"insufficient data left in message"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1447"><span class='Ref_To_Local'>itemlen</span></a> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* -1 length means NULL */ 
</span>            <a href="arrayfuncs.c.html#LN1436"><span class='Ref_to_Parameter'>values</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1441"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN648"><span class='Ref_to_Proto'>ReceiveFunctionCall</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1430"><span class='Ref_to_Parameter'>receiveproc</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                            <a href="arrayfuncs.c.html#LN1431"><span class='Ref_to_Parameter'>typioparam</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1432"><span class='Ref_to_Parameter'>typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN1437"><span class='Ref_to_Parameter'>nulls</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1441"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Rather than copying data around, we just set up a phony StringInfo 
         * pointing to the correct portion of the input buffer. We assume we 
         * can scribble on the input buffer so as to maintain the convention 
         * that StringInfos have a trailing null. 
         */ 
</span>        <a href="arrayfuncs.c.html#LN1448"><span class='Ref_To_Local'>elem_buf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a> <span class='Operator'>= &</span><a href="arrayfuncs.c.html#LN1428"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1428"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN39"><span class='Ref_to_Member'>cursor</span></a><span class='Delimiter'>]; 
</span>        <a href="arrayfuncs.c.html#LN1448"><span class='Ref_To_Local'>elem_buf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN38"><span class='Ref_to_Member'>maxlen</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN1447"><span class='Ref_To_Local'>itemlen</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN1448"><span class='Ref_To_Local'>elem_buf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN1447"><span class='Ref_To_Local'>itemlen</span></a><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN1448"><span class='Ref_To_Local'>elem_buf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN39"><span class='Ref_to_Member'>cursor</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <a href="arrayfuncs.c.html#LN1428"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN39"><span class='Ref_to_Member'>cursor</span></a> <span class='Operator'>+= </span><a href="arrayfuncs.c.html#LN1447"><span class='Ref_To_Local'>itemlen</span></a><span class='Delimiter'>; 
</span> 
        <a href="arrayfuncs.c.html#LN1449"><span class='Ref_To_Local'>csave</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN1428"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1428"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN39"><span class='Ref_to_Member'>cursor</span></a><span class='Delimiter'>]; 
</span>        <a href="arrayfuncs.c.html#LN1428"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1428"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN39"><span class='Ref_to_Member'>cursor</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Now call the element's receiveproc */ 
</span>        <a href="arrayfuncs.c.html#LN1436"><span class='Ref_to_Parameter'>values</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1441"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN648"><span class='Ref_to_Proto'>ReceiveFunctionCall</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1430"><span class='Ref_to_Parameter'>receiveproc</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN1448"><span class='Ref_To_Local'>elem_buf</span></a><span class='Delimiter'>, 
</span>                                        <a href="arrayfuncs.c.html#LN1431"><span class='Ref_to_Parameter'>typioparam</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1432"><span class='Ref_to_Parameter'>typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN1437"><span class='Ref_to_Parameter'>nulls</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1441"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Trouble if it didn't eat the whole buffer */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1448"><span class='Ref_To_Local'>elem_buf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN39"><span class='Ref_to_Member'>cursor</span></a> <span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN1447"><span class='Ref_To_Local'>itemlen</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_BINARY_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"improper binary format in array element %d"</span><span class='Delimiter'>, 
</span>                            <a href="arrayfuncs.c.html#LN1441"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="arrayfuncs.c.html#LN1428"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1428"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN39"><span class='Ref_to_Member'>cursor</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="arrayfuncs.c.html#LN1449"><span class='Ref_To_Local'>csave</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;nitems;i++ &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Check for nulls, compute total data space needed 
     */ 
</span>    <a href="arrayfuncs.c.html#LN1442"><span class='Ref_To_Local'>hasnull</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN1443"><span class='Ref_To_Local'>totbytes</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1441"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN1441"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN1429"><span class='Ref_to_Parameter'>nitems</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN1441"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1437"><span class='Ref_to_Parameter'>nulls</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1441"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <a href="arrayfuncs.c.html#LN1442"><span class='Ref_To_Local'>hasnull</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* let's just make sure data is not toasted */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1433"><span class='Ref_to_Parameter'>typlen</span></a> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                <a href="arrayfuncs.c.html#LN1436"><span class='Ref_to_Parameter'>values</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1441"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN204"><span class='Ref_to_Macro'>PG_DETOAST_DATUM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1436"><span class='Ref_to_Parameter'>values</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1441"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN1443"><span class='Ref_To_Local'>totbytes</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN159"><span class='Ref_to_Macro'>att_addlength_datum</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1443"><span class='Ref_To_Local'>totbytes</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1433"><span class='Ref_to_Parameter'>typlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1436"><span class='Ref_to_Parameter'>values</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1441"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN1443"><span class='Ref_To_Local'>totbytes</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN143"><span class='Ref_to_Macro'>att_align_nominal</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1443"><span class='Ref_To_Local'>totbytes</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1435"><span class='Ref_to_Parameter'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* check for overflow of total request */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/memutils.h.html#LN41"><span class='Ref_to_Macro'>AllocSizeIsValid</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1443"><span class='Ref_To_Local'>totbytes</span></a><span class='Parentheses'>))</span> 
                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_PROGRAM_LIMIT_EXCEEDED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"array size exceeds the maximum allowed (%d)"</span><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="../../../common/psprintf.c.html#LN27"><span class='Ref_to_Const'>MaxAllocSize</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Operator'>*</span><a href="arrayfuncs.c.html#LN1438"><span class='Ref_to_Parameter'>hasnulls</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN1442"><span class='Ref_To_Local'>hasnull</span></a><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="arrayfuncs.c.html#LN1439"><span class='Ref_to_Parameter'>nbytes</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN1443"><span class='Ref_To_Local'>totbytes</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ReadArrayBinary &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * array_send : 
 *        takes the internal representation of an array and returns a bytea 
 *        containing the array in its external binary format. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1533"></a><span class='Declare_Function'>array_send</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1535"></a>    <a href="../../../include/utils/array.h.html#LN157"><span class='Ref_to_Union'>AnyArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Local'>v</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN254"><span class='Ref_to_Macro'>PG_GETARG_ANY_ARRAY</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1536"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>element_type</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN314"><span class='Ref_to_Macro'>AARR_ELEMTYPE</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1535"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1537"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>typlen</span><span class='Delimiter'>; 
</span><a name="LN1538"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>typbyval</span><span class='Delimiter'>; 
</span><a name="LN1539"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>typalign</span><span class='Delimiter'>; 
</span><a name="LN1540"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nitems</span><span class='Delimiter'>, 
</span><a name="LN1541"></a>                <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN1542"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ndim</span><span class='Delimiter'>, 
</span><a name="LN1543"></a>               <span class='Operator'>*</span><span class='Declare_Local'>dim</span><span class='Delimiter'>, 
</span><a name="LN1544"></a>               <span class='Operator'>*</span><span class='Declare_Local'>lb</span><span class='Delimiter'>; 
</span><a name="LN1545"></a>    <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span><a name="LN1546"></a>    <a href="../../../include/utils/arrayaccess.h.html#LN32"><span class='Ref_to_Struct'>array_iter</span></a>  <span class='Declare_Local'>iter</span><span class='Delimiter'>; 
</span><a name="LN1547"></a>    <a href="../../../include/utils/array.h.html#LN216"><span class='Ref_to_Struct'>ArrayMetaState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>my_extra</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We arrange to look up info about element type, including its send 
     * conversion proc, only once per series of calls, assuming the element 
     * type doesn't change underneath us. 
     */ 
</span>    <a href="arrayfuncs.c.html#LN1547"><span class='Ref_To_Local'>my_extra</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN216"><span class='Ref_to_Struct'>ArrayMetaState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_extra<span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1547"><span class='Ref_To_Local'>my_extra</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_extra <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_mcxt<span class='Delimiter'>, 
</span>                                                      <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN216"><span class='Ref_to_Struct'>ArrayMetaState</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN1547"><span class='Ref_To_Local'>my_extra</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN216"><span class='Ref_to_Struct'>ArrayMetaState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_extra<span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN1547"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN218"><span class='Ref_to_Member'>element_type</span></a> <span class='Operator'>= ~</span><a href="arrayfuncs.c.html#LN1536"><span class='Ref_To_Local'>element_type</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1547"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN218"><span class='Ref_to_Member'>element_type</span></a> <span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN1536"><span class='Ref_To_Local'>element_type</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Get info about element type, including its send proc */ 
</span>        <a href="../../../include/utils/lsyscache.h.html#LN139"><span class='Ref_to_Proto'>get_type_io_data</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1536"><span class='Ref_To_Local'>element_type</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/lsyscache.h.html#LN34"><span class='Ref_to_EnumConst'>IOFunc_send</span></a><span class='Delimiter'>, 
</span>                         <span class='Operator'>&</span><a href="arrayfuncs.c.html#LN1547"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN219"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN1547"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN220"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>, 
</span>                         <span class='Operator'>&</span><a href="arrayfuncs.c.html#LN1547"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN221"><span class='Ref_to_Member'>typalign</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN1547"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN222"><span class='Ref_to_Member'>typdelim</span></a><span class='Delimiter'>, 
</span>                         <span class='Operator'>&</span><a href="arrayfuncs.c.html#LN1547"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN223"><span class='Ref_to_Member'>typioparam</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN1547"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN224"><span class='Ref_to_Member'>typiofunc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1547"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN224"><span class='Ref_to_Member'>typiofunc</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_FUNCTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"no binary output function available for type %s"</span><span class='Delimiter'>, 
</span>                            <a href="format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1536"><span class='Ref_To_Local'>element_type</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>        <a href="../../../include/fmgr.h.html#LN99"><span class='Ref_to_Proto'>fmgr_info_cxt</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1547"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN224"><span class='Ref_to_Member'>typiofunc</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN1547"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN225"><span class='Ref_to_Member'>proc</span></a><span class='Delimiter'>, 
</span>                      fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_mcxt<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN1547"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN218"><span class='Ref_to_Member'>element_type</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN1536"><span class='Ref_To_Local'>element_type</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="arrayfuncs.c.html#LN1537"><span class='Ref_To_Local'>typlen</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN1547"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN219"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN1538"><span class='Ref_To_Local'>typbyval</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN1547"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN220"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN1539"><span class='Ref_To_Local'>typalign</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN1547"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN221"><span class='Ref_to_Member'>typalign</span></a><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN1542"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN308"><span class='Ref_to_Macro'>AARR_NDIM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1535"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN1543"><span class='Ref_To_Local'>dim</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN316"><span class='Ref_to_Macro'>AARR_DIMS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1535"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN1544"><span class='Ref_To_Local'>lb</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN318"><span class='Ref_to_Macro'>AARR_LBOUND</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1535"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN1540"><span class='Ref_To_Local'>nitems</span></a> <span class='Operator'>= </span><a href="arrayutils.c.html#LN73"><span class='Ref_to_Func'>ArrayGetNItems</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1542"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1543"><span class='Ref_To_Local'>dim</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/libpq/pqformat.h.html#LN31"><span class='Ref_to_Proto'>pq_begintypsend</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN1545"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Send the array header information */ 
</span>    <a href="../../../include/libpq/pqformat.h.html#LN25"><span class='Ref_to_Proto'>pq_sendint</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN1545"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1542"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/libpq/pqformat.h.html#LN25"><span class='Ref_to_Proto'>pq_sendint</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN1545"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/array.h.html#LN310"><span class='Ref_to_Macro'>AARR_HASNULL</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1535"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Number'>1</span> <span class='Operator'>: </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/libpq/pqformat.h.html#LN25"><span class='Ref_to_Proto'>pq_sendint</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN1545"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1536"><span class='Ref_To_Local'>element_type</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1541"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN1541"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN1542"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN1541"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/libpq/pqformat.h.html#LN25"><span class='Ref_to_Proto'>pq_sendint</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN1545"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1543"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1541"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/libpq/pqformat.h.html#LN25"><span class='Ref_to_Proto'>pq_sendint</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN1545"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1544"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1541"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Send the array elements using the element's own sendproc */ 
</span>    <a href="../../../include/utils/arrayaccess.h.html#LN47"><span class='Ref_to_Func'>array_iter_setup</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN1546"><span class='Ref_To_Local'>iter</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1535"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1541"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN1541"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN1540"><span class='Ref_To_Local'>nitems</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN1541"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1605"></a>        <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>itemvalue</span><span class='Delimiter'>; 
</span><a name="LN1606"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Get source element, checking for NULL */ 
</span>        <a href="arrayfuncs.c.html#LN1605"><span class='Ref_To_Local'>itemvalue</span></a> <span class='Operator'>= </span><a href="../../../include/utils/arrayaccess.h.html#LN79"><span class='Ref_to_Func'>array_iter_next</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN1546"><span class='Ref_To_Local'>iter</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN1606"><span class='Ref_To_Local'>isnull</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1541"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, 
</span>                                    <a href="arrayfuncs.c.html#LN1537"><span class='Ref_To_Local'>typlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1538"><span class='Ref_To_Local'>typbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1539"><span class='Ref_To_Local'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1606"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* -1 length means a NULL */ 
</span>            <a href="../../../include/libpq/pqformat.h.html#LN25"><span class='Ref_to_Proto'>pq_sendint</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN1545"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span><a name="LN1619"></a>            <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>outputbytes</span><span class='Delimiter'>; 
</span> 
            <a href="arrayfuncs.c.html#LN1619"><span class='Ref_To_Local'>outputbytes</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN652"><span class='Ref_to_Proto'>SendFunctionCall</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN1547"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN225"><span class='Ref_to_Member'>proc</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1605"><span class='Ref_To_Local'>itemvalue</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/libpq/pqformat.h.html#LN25"><span class='Ref_to_Proto'>pq_sendint</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN1545"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1619"><span class='Ref_To_Local'>outputbytes</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/libpq/pqformat.h.html#LN19"><span class='Ref_to_Proto'>pq_sendbytes</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN1545"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN302"><span class='Ref_to_Macro'>VARDATA</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1619"><span class='Ref_To_Local'>outputbytes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../../include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1619"><span class='Ref_To_Local'>outputbytes</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1619"><span class='Ref_To_Local'>outputbytes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;nitems;i++ &raquo; </span> 
 
    <a href="../../../include/fmgr.h.html#LN328"><span class='Ref_to_Macro'>PG_RETURN_BYTEA_P</span></a><span class='Parentheses'>(</span><a href="../../../include/libpq/pqformat.h.html#LN32"><span class='Ref_to_Proto'>pq_endtypsend</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN1545"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end array_send &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * array_ndims : 
 *        returns the number of dimensions of the array pointed to by "v" 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1637"></a><span class='Declare_Function'>array_ndims</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1639"></a>    <a href="../../../include/utils/array.h.html#LN157"><span class='Ref_to_Union'>AnyArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Local'>v</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN254"><span class='Ref_to_Macro'>PG_GETARG_ANY_ARRAY</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Sanity check: does it look like an array at all? */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN308"><span class='Ref_to_Macro'>AARR_NDIM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1639"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="../../../include/utils/array.h.html#LN308"><span class='Ref_to_Macro'>AARR_NDIM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1639"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Parentheses'>)</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN313"><span class='Ref_to_Macro'>PG_RETURN_INT32</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN308"><span class='Ref_to_Macro'>AARR_NDIM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1639"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * array_dims : 
 *        returns the dimensions of the array pointed to by "v", as a "text" 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1653"></a><span class='Declare_Function'>array_dims</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1655"></a>    <a href="../../../include/utils/array.h.html#LN157"><span class='Ref_to_Union'>AnyArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Local'>v</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN254"><span class='Ref_to_Macro'>PG_GETARG_ANY_ARRAY</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1656"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span><a name="LN1657"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN1658"></a>    <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Local'>dimv</span><span class='Delimiter'>, 
</span><a name="LN1659"></a>               <span class='Operator'>*</span><span class='Declare_Local'>lb</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * 33 since we assume 15 digits per number + ':' +'[]' 
     * 
     * +1 for trailing null 
     */ 
</span><a name="LN1666"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>buf</span><span class='Delimiter'>[</span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a> <span class='Operator'>* </span><span class='Number'>33</span> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
    <span class='Comment_Multi_Line'>/* Sanity check: does it look like an array at all? */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN308"><span class='Ref_to_Macro'>AARR_NDIM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1655"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="../../../include/utils/array.h.html#LN308"><span class='Ref_to_Macro'>AARR_NDIM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1655"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Parentheses'>)</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN1658"><span class='Ref_To_Local'>dimv</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN316"><span class='Ref_to_Macro'>AARR_DIMS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1655"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN1659"><span class='Ref_To_Local'>lb</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN318"><span class='Ref_to_Macro'>AARR_LBOUND</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1655"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN1656"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN1666"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1657"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN1657"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="../../../include/utils/array.h.html#LN308"><span class='Ref_to_Macro'>AARR_NDIM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1655"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN1657"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1656"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><span class='String'>"[%d:%d]"</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1659"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1657"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="arrayfuncs.c.html#LN1658"><span class='Ref_To_Local'>dimv</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1657"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN1659"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1657"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN1656"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+= </span>strlen<span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1656"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/builtins.h.html#LN85"><span class='Ref_to_Proto'>cstring_to_text</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1666"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end array_dims &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * array_lower : 
 *      returns the lower dimension, of the DIM requested, for 
 *      the array pointed to by "v", as an int4 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1691"></a><span class='Declare_Function'>array_lower</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1693"></a>    <a href="../../../include/utils/array.h.html#LN157"><span class='Ref_to_Union'>AnyArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Local'>v</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN254"><span class='Ref_to_Macro'>PG_GETARG_ANY_ARRAY</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1694"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>reqdim</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1695"></a>    <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Local'>lb</span><span class='Delimiter'>; 
</span><a name="LN1696"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Sanity check: does it look like an array at all? */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN308"><span class='Ref_to_Macro'>AARR_NDIM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1693"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="../../../include/utils/array.h.html#LN308"><span class='Ref_to_Macro'>AARR_NDIM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1693"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Parentheses'>)</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Sanity check: was the requested dim valid */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1694"><span class='Ref_To_Local'>reqdim</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="arrayfuncs.c.html#LN1694"><span class='Ref_To_Local'>reqdim</span></a> <span class='Operator'>&GT; </span><a href="../../../include/utils/array.h.html#LN308"><span class='Ref_to_Macro'>AARR_NDIM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1693"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN1695"><span class='Ref_To_Local'>lb</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN318"><span class='Ref_to_Macro'>AARR_LBOUND</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1693"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN1696"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN1695"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1694"><span class='Ref_To_Local'>reqdim</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
    <a href="../../../include/fmgr.h.html#LN313"><span class='Ref_to_Macro'>PG_RETURN_INT32</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1696"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end array_lower &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * array_upper : 
 *      returns the upper dimension, of the DIM requested, for 
 *      the array pointed to by "v", as an int4 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1718"></a><span class='Declare_Function'>array_upper</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1720"></a>    <a href="../../../include/utils/array.h.html#LN157"><span class='Ref_to_Union'>AnyArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Local'>v</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN254"><span class='Ref_to_Macro'>PG_GETARG_ANY_ARRAY</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1721"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>reqdim</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1722"></a>    <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Local'>dimv</span><span class='Delimiter'>, 
</span><a name="LN1723"></a>               <span class='Operator'>*</span><span class='Declare_Local'>lb</span><span class='Delimiter'>; 
</span><a name="LN1724"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Sanity check: does it look like an array at all? */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN308"><span class='Ref_to_Macro'>AARR_NDIM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1720"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="../../../include/utils/array.h.html#LN308"><span class='Ref_to_Macro'>AARR_NDIM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1720"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Parentheses'>)</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Sanity check: was the requested dim valid */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1721"><span class='Ref_To_Local'>reqdim</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="arrayfuncs.c.html#LN1721"><span class='Ref_To_Local'>reqdim</span></a> <span class='Operator'>&GT; </span><a href="../../../include/utils/array.h.html#LN308"><span class='Ref_to_Macro'>AARR_NDIM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1720"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN1723"><span class='Ref_To_Local'>lb</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN318"><span class='Ref_to_Macro'>AARR_LBOUND</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1720"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN1722"><span class='Ref_To_Local'>dimv</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN316"><span class='Ref_to_Macro'>AARR_DIMS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1720"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN1724"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN1722"><span class='Ref_To_Local'>dimv</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1721"><span class='Ref_To_Local'>reqdim</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN1723"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1721"><span class='Ref_To_Local'>reqdim</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN313"><span class='Ref_to_Macro'>PG_RETURN_INT32</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1724"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end array_upper &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * array_length : 
 *      returns the length, of the dimension requested, for 
 *      the array pointed to by "v", as an int4 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1748"></a><span class='Declare_Function'>array_length</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1750"></a>    <a href="../../../include/utils/array.h.html#LN157"><span class='Ref_to_Union'>AnyArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Local'>v</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN254"><span class='Ref_to_Macro'>PG_GETARG_ANY_ARRAY</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1751"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>reqdim</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1752"></a>    <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Local'>dimv</span><span class='Delimiter'>; 
</span><a name="LN1753"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Sanity check: does it look like an array at all? */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN308"><span class='Ref_to_Macro'>AARR_NDIM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1750"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="../../../include/utils/array.h.html#LN308"><span class='Ref_to_Macro'>AARR_NDIM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1750"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Parentheses'>)</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Sanity check: was the requested dim valid */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1751"><span class='Ref_To_Local'>reqdim</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="arrayfuncs.c.html#LN1751"><span class='Ref_To_Local'>reqdim</span></a> <span class='Operator'>&GT; </span><a href="../../../include/utils/array.h.html#LN308"><span class='Ref_to_Macro'>AARR_NDIM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1750"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN1752"><span class='Ref_To_Local'>dimv</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN316"><span class='Ref_to_Macro'>AARR_DIMS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1750"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN1753"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN1752"><span class='Ref_To_Local'>dimv</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1751"><span class='Ref_To_Local'>reqdim</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
    <a href="../../../include/fmgr.h.html#LN313"><span class='Ref_to_Macro'>PG_RETURN_INT32</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1753"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end array_length &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * array_cardinality: 
 *      returns the total number of elements in an array 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1775"></a><span class='Declare_Function'>array_cardinality</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1777"></a>    <a href="../../../include/utils/array.h.html#LN157"><span class='Ref_to_Union'>AnyArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Local'>v</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN254"><span class='Ref_to_Macro'>PG_GETARG_ANY_ARRAY</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN313"><span class='Ref_to_Macro'>PG_RETURN_INT32</span></a><span class='Parentheses'>(</span><a href="arrayutils.c.html#LN73"><span class='Ref_to_Func'>ArrayGetNItems</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN308"><span class='Ref_to_Macro'>AARR_NDIM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1777"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/utils/array.h.html#LN316"><span class='Ref_to_Macro'>AARR_DIMS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1777"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * array_get_element : 
 *    This routine takes an array datum and a subscript array and returns 
 *    the referenced item as a Datum.  Note that for a pass-by-reference 
 *    datatype, the returned Datum is a pointer into the array object. 
 * 
 * This handles both ordinary varlena arrays and fixed-length arrays. 
 * 
 * Inputs: 
 *  arraydatum: the array object (mustn't be NULL) 
 *  nSubscripts: number of subscripts supplied 
 *  indx[]: the subscript values 
 *  arraytyplen: pg_type.typlen for the array type 
 *  elmlen: pg_type.typlen for the array's element type 
 *  elmbyval: pg_type.typbyval for the array's element type 
 *  elmalign: pg_type.typalign for the array's element type 
 * 
 * Outputs: 
 *  The return value is the element Datum. 
 *  *isNull is set to indicate whether the element is NULL. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1805"></a><span class='Declare_Function'>array_get_element</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>arraydatum</span><span class='Delimiter'>, 
</span><a name="LN1806"></a>                  <span class='Keyword'>int </span><span class='Declare_Parameter'>nSubscripts</span><span class='Delimiter'>, 
</span><a name="LN1807"></a>                  <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>indx</span><span class='Delimiter'>, 
</span><a name="LN1808"></a>                  <span class='Keyword'>int </span><span class='Declare_Parameter'>arraytyplen</span><span class='Delimiter'>, 
</span><a name="LN1809"></a>                  <span class='Keyword'>int </span><span class='Declare_Parameter'>elmlen</span><span class='Delimiter'>, 
</span><a name="LN1810"></a>                  <span class='Keyword'>bool </span><span class='Declare_Parameter'>elmbyval</span><span class='Delimiter'>, 
</span><a name="LN1811"></a>                  <span class='Keyword'>char </span><span class='Declare_Parameter'>elmalign</span><span class='Delimiter'>, 
</span><a name="LN1812"></a>                  <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>isNull</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1814"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN1815"></a>                <span class='Declare_Local'>ndim</span><span class='Delimiter'>, 
</span><a name="LN1816"></a>               <span class='Operator'>*</span><span class='Declare_Local'>dim</span><span class='Delimiter'>, 
</span><a name="LN1817"></a>               <span class='Operator'>*</span><span class='Declare_Local'>lb</span><span class='Delimiter'>, 
</span><a name="LN1818"></a>                <span class='Declare_Local'>offset</span><span class='Delimiter'>, 
</span><a name="LN1819"></a>                <span class='Declare_Local'>fixedDim</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], 
</span><a name="LN1820"></a>                <span class='Declare_Local'>fixedLb</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN1821"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>arraydataptr</span><span class='Delimiter'>, 
</span><a name="LN1822"></a>               <span class='Operator'>*</span><span class='Declare_Local'>retptr</span><span class='Delimiter'>; 
</span><a name="LN1823"></a>    <a href="../../../include/c.h.html#LN274"><span class='Ref_to_Typedef'>bits8</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>arraynullsptr</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1808"><span class='Ref_to_Parameter'>arraytyplen</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * fixed-length arrays -- these are assumed to be 1-d, 0-based 
         */ 
</span>        <a href="arrayfuncs.c.html#LN1815"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN1819"><span class='Ref_To_Local'>fixedDim</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="arrayfuncs.c.html#LN1808"><span class='Ref_to_Parameter'>arraytyplen</span></a> <span class='Operator'>/ </span><a href="arrayfuncs.c.html#LN1809"><span class='Ref_to_Parameter'>elmlen</span></a><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN1820"><span class='Ref_To_Local'>fixedLb</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN1816"><span class='Ref_To_Local'>dim</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN1819"><span class='Ref_To_Local'>fixedDim</span></a><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN1817"><span class='Ref_To_Local'>lb</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN1820"><span class='Ref_To_Local'>fixedLb</span></a><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN1821"><span class='Ref_To_Local'>arraydataptr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1805"><span class='Ref_to_Parameter'>arraydatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN1823"><span class='Ref_To_Local'>arraynullsptr</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN322"><span class='Ref_to_Macro'>VARATT_IS_EXTERNAL_EXPANDED</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1805"><span class='Ref_to_Parameter'>arraydatum</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* expanded array: let's do this in a separate function */ 
</span>        <span class='Control'>return</span> <a href="arrayfuncs.c.html#LN102"><span class='Ref_to_Proto'>array_get_element_expanded</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1805"><span class='Ref_to_Parameter'>arraydatum</span></a><span class='Delimiter'>, 
</span>                                          <a href="arrayfuncs.c.html#LN1806"><span class='Ref_to_Parameter'>nSubscripts</span></a><span class='Delimiter'>, 
</span>                                          <a href="arrayfuncs.c.html#LN1807"><span class='Ref_to_Parameter'>indx</span></a><span class='Delimiter'>, 
</span>                                          <a href="arrayfuncs.c.html#LN1808"><span class='Ref_to_Parameter'>arraytyplen</span></a><span class='Delimiter'>, 
</span>                                          <a href="arrayfuncs.c.html#LN1809"><span class='Ref_to_Parameter'>elmlen</span></a><span class='Delimiter'>, 
</span>                                          <a href="arrayfuncs.c.html#LN1810"><span class='Ref_to_Parameter'>elmbyval</span></a><span class='Delimiter'>, 
</span>                                          <a href="arrayfuncs.c.html#LN1811"><span class='Ref_to_Parameter'>elmalign</span></a><span class='Delimiter'>, 
</span>                                          <a href="arrayfuncs.c.html#LN1812"><span class='Ref_to_Parameter'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* detoast array if necessary, producing normal varlena input */ 
</span><a name="LN1853"></a>        <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>array</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN241"><span class='Ref_to_Macro'>DatumGetArrayTypeP</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1805"><span class='Ref_to_Parameter'>arraydatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="arrayfuncs.c.html#LN1815"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1853"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN1816"><span class='Ref_To_Local'>dim</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1853"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN1817"><span class='Ref_To_Local'>lb</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN276"><span class='Ref_to_Macro'>ARR_LBOUND</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1853"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN1821"><span class='Ref_To_Local'>arraydataptr</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN302"><span class='Ref_to_Macro'>ARR_DATA_PTR</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1853"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN1823"><span class='Ref_To_Local'>arraynullsptr</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN280"><span class='Ref_to_Macro'>ARR_NULLBITMAP</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1853"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Return NULL for invalid subscript 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1815"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN1806"><span class='Ref_to_Parameter'>nSubscripts</span></a> <span class='Operator'>|| </span><a href="arrayfuncs.c.html#LN1815"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="arrayfuncs.c.html#LN1815"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>&GT; </span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="arrayfuncs.c.html#LN1812"><span class='Ref_to_Parameter'>isNull</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1814"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN1814"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN1815"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN1814"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1807"><span class='Ref_to_Parameter'>indx</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1814"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN1817"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1814"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>|| </span><a href="arrayfuncs.c.html#LN1807"><span class='Ref_to_Parameter'>indx</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1814"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>&GT;= </span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1816"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1814"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN1817"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1814"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Operator'>*</span><a href="arrayfuncs.c.html#LN1812"><span class='Ref_to_Parameter'>isNull</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Calculate the element number 
     */ 
</span>    <a href="arrayfuncs.c.html#LN1818"><span class='Ref_To_Local'>offset</span></a> <span class='Operator'>= </span><a href="arrayutils.c.html#LN29"><span class='Ref_to_Func'>ArrayGetOffset</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1806"><span class='Ref_to_Parameter'>nSubscripts</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1816"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1817"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1807"><span class='Ref_to_Parameter'>indx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check for NULL array element 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN112"><span class='Ref_to_Proto'>array_get_isnull</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1823"><span class='Ref_To_Local'>arraynullsptr</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1818"><span class='Ref_To_Local'>offset</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="arrayfuncs.c.html#LN1812"><span class='Ref_to_Parameter'>isNull</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * OK, get the element 
     */ 
</span>    <span class='Operator'>*</span><a href="arrayfuncs.c.html#LN1812"><span class='Ref_to_Parameter'>isNull</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN1822"><span class='Ref_To_Local'>retptr</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN118"><span class='Ref_to_Proto'>array_seek</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1821"><span class='Ref_To_Local'>arraydataptr</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1823"><span class='Ref_To_Local'>arraynullsptr</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1818"><span class='Ref_To_Local'>offset</span></a><span class='Delimiter'>, 
</span>                        <a href="arrayfuncs.c.html#LN1809"><span class='Ref_to_Parameter'>elmlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1810"><span class='Ref_to_Parameter'>elmbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1811"><span class='Ref_to_Parameter'>elmalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="arrayfuncs.c.html#LN114"><span class='Ref_to_Proto'>ArrayCast</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1822"><span class='Ref_To_Local'>retptr</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1810"><span class='Ref_to_Parameter'>elmbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1809"><span class='Ref_to_Parameter'>elmlen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end array_get_element &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Implementation of array_get_element() for an expanded array 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1906"></a><span class='Declare_Function'>array_get_element_expanded</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>arraydatum</span><span class='Delimiter'>, 
</span><a name="LN1907"></a>                           <span class='Keyword'>int </span><span class='Declare_Parameter'>nSubscripts</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>indx</span><span class='Delimiter'>, 
</span><a name="LN1908"></a>                           <span class='Keyword'>int </span><span class='Declare_Parameter'>arraytyplen</span><span class='Delimiter'>, 
</span><a name="LN1909"></a>                           <span class='Keyword'>int </span><span class='Declare_Parameter'>elmlen</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>elmbyval</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>elmalign</span><span class='Delimiter'>, 
</span><a name="LN1910"></a>                           <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>isNull</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1912"></a>    <a href="../../../include/utils/array.h.html#LN98"><span class='Ref_to_Struct'>ExpandedArrayHeader</span></a> <span class='Operator'>*</span><span class='Declare_Local'>eah</span><span class='Delimiter'>; 
</span><a name="LN1913"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN1914"></a>                <span class='Declare_Local'>ndim</span><span class='Delimiter'>, 
</span><a name="LN1915"></a>               <span class='Operator'>*</span><span class='Declare_Local'>dim</span><span class='Delimiter'>, 
</span><a name="LN1916"></a>               <span class='Operator'>*</span><span class='Declare_Local'>lb</span><span class='Delimiter'>, 
</span><a name="LN1917"></a>                <span class='Declare_Local'>offset</span><span class='Delimiter'>; 
</span><a name="LN1918"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>dvalues</span><span class='Delimiter'>; 
</span><a name="LN1919"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>dnulls</span><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN1912"><span class='Ref_To_Local'>eah</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN98"><span class='Ref_to_Struct'>ExpandedArrayHeader</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="expandeddatum.c.html#LN27"><span class='Ref_to_Func'>DatumGetEOHP</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1906"><span class='Ref_to_Parameter'>arraydatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1912"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN104"><span class='Ref_to_Member'>ea_magic</span></a> <span class='Operator'>== </span><a href="../../../include/utils/array.h.html#LN96"><span class='Ref_to_Const'>EA_MAGIC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* sanity-check caller's info against object */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1908"><span class='Ref_to_Parameter'>arraytyplen</span></a> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1909"><span class='Ref_to_Parameter'>elmlen</span></a> <span class='Operator'>== </span><a href="arrayfuncs.c.html#LN1912"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN113"><span class='Ref_to_Member'>typlen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1909"><span class='Ref_to_Parameter'>elmbyval</span></a> <span class='Operator'>== </span><a href="arrayfuncs.c.html#LN1912"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN114"><span class='Ref_to_Member'>typbyval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1909"><span class='Ref_to_Parameter'>elmalign</span></a> <span class='Operator'>== </span><a href="arrayfuncs.c.html#LN1912"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN115"><span class='Ref_to_Member'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN1914"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN1912"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN107"><span class='Ref_to_Member'>ndims</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN1915"><span class='Ref_To_Local'>dim</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN1912"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN108"><span class='Ref_to_Member'>dims</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN1916"><span class='Ref_To_Local'>lb</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN1912"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN109"><span class='Ref_to_Member'>lbound</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Return NULL for invalid subscript 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1914"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN1907"><span class='Ref_to_Parameter'>nSubscripts</span></a> <span class='Operator'>|| </span><a href="arrayfuncs.c.html#LN1914"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="arrayfuncs.c.html#LN1914"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>&GT; </span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="arrayfuncs.c.html#LN1910"><span class='Ref_to_Parameter'>isNull</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1913"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN1913"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN1914"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN1913"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1907"><span class='Ref_to_Parameter'>indx</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1913"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN1916"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1913"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>|| </span><a href="arrayfuncs.c.html#LN1907"><span class='Ref_to_Parameter'>indx</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1913"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>&GT;= </span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1915"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1913"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN1916"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1913"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Operator'>*</span><a href="arrayfuncs.c.html#LN1910"><span class='Ref_to_Parameter'>isNull</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Calculate the element number 
     */ 
</span>    <a href="arrayfuncs.c.html#LN1917"><span class='Ref_To_Local'>offset</span></a> <span class='Operator'>= </span><a href="arrayutils.c.html#LN29"><span class='Ref_to_Func'>ArrayGetOffset</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1907"><span class='Ref_to_Parameter'>nSubscripts</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1915"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1916"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN1907"><span class='Ref_to_Parameter'>indx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Deconstruct array if we didn't already.  Note that we apply this even 
     * if the input is nominally read-only: it should be safe enough. 
     */ 
</span>    <a href="array_expanded.c.html#LN422"><span class='Ref_to_Func'>deconstruct_expanded_array</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1912"><span class='Ref_To_Local'>eah</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN1918"><span class='Ref_To_Local'>dvalues</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN1912"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN129"><span class='Ref_to_Member'>dvalues</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN1919"><span class='Ref_To_Local'>dnulls</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN1912"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN130"><span class='Ref_to_Member'>dnulls</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check for NULL array element 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN1919"><span class='Ref_To_Local'>dnulls</span></a> <span class='Operator'>&& </span><a href="arrayfuncs.c.html#LN1919"><span class='Ref_To_Local'>dnulls</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1917"><span class='Ref_To_Local'>offset</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="arrayfuncs.c.html#LN1910"><span class='Ref_to_Parameter'>isNull</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * OK, get the element.  It's OK to return a pass-by-ref value as a 
     * pointer into the expanded array, for the same reason that regular 
     * array_get_element can return a pointer into flat arrays: the value is 
     * assumed not to change for as long as the Datum reference can exist. 
     */ 
</span>    <span class='Operator'>*</span><a href="arrayfuncs.c.html#LN1910"><span class='Ref_to_Parameter'>isNull</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="arrayfuncs.c.html#LN1918"><span class='Ref_To_Local'>dvalues</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN1917"><span class='Ref_To_Local'>offset</span></a><span class='Delimiter'>]; 
}</span><span class='Auto_Annotations'> &laquo; end array_get_element_expanded &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * array_get_slice : 
 *         This routine takes an array and a range of indices (upperIndex and 
 *         lowerIndx), creates a new array structure for the referred elements 
 *         and returns a pointer to it. 
 * 
 * This handles both ordinary varlena arrays and fixed-length arrays. 
 * 
 * Inputs: 
 *  arraydatum: the array object (mustn't be NULL) 
 *  nSubscripts: number of subscripts supplied (must be same for upper/lower) 
 *  upperIndx[]: the upper subscript values 
 *  lowerIndx[]: the lower subscript values 
 *  upperProvided[]: true for provided upper subscript values 
 *  lowerProvided[]: true for provided lower subscript values 
 *  arraytyplen: pg_type.typlen for the array type 
 *  elmlen: pg_type.typlen for the array's element type 
 *  elmbyval: pg_type.typbyval for the array's element type 
 *  elmalign: pg_type.typalign for the array's element type 
 * 
 * Outputs: 
 *  The return value is the new array Datum (it's never NULL) 
 * 
 * Omitted upper and lower subscript values are replaced by the corresponding 
 * array bound. 
 * 
 * NOTE: we assume it is OK to scribble on the provided subscript arrays 
 * lowerIndx[] and upperIndx[].  These are generally just temporaries. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2014"></a><span class='Declare_Function'>array_get_slice</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>arraydatum</span><span class='Delimiter'>, 
</span><a name="LN2015"></a>                <span class='Keyword'>int </span><span class='Declare_Parameter'>nSubscripts</span><span class='Delimiter'>, 
</span><a name="LN2016"></a>                <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>upperIndx</span><span class='Delimiter'>, 
</span><a name="LN2017"></a>                <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>lowerIndx</span><span class='Delimiter'>, 
</span><a name="LN2018"></a>                <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>upperProvided</span><span class='Delimiter'>, 
</span><a name="LN2019"></a>                <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>lowerProvided</span><span class='Delimiter'>, 
</span><a name="LN2020"></a>                <span class='Keyword'>int </span><span class='Declare_Parameter'>arraytyplen</span><span class='Delimiter'>, 
</span><a name="LN2021"></a>                <span class='Keyword'>int </span><span class='Declare_Parameter'>elmlen</span><span class='Delimiter'>, 
</span><a name="LN2022"></a>                <span class='Keyword'>bool </span><span class='Declare_Parameter'>elmbyval</span><span class='Delimiter'>, 
</span><a name="LN2023"></a>                <span class='Keyword'>char </span><span class='Declare_Parameter'>elmalign</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2025"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>array</span><span class='Delimiter'>; 
</span><a name="LN2026"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>newarray</span><span class='Delimiter'>; 
</span><a name="LN2027"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN2028"></a>                <span class='Declare_Local'>ndim</span><span class='Delimiter'>, 
</span><a name="LN2029"></a>               <span class='Operator'>*</span><span class='Declare_Local'>dim</span><span class='Delimiter'>, 
</span><a name="LN2030"></a>               <span class='Operator'>*</span><span class='Declare_Local'>lb</span><span class='Delimiter'>, 
</span><a name="LN2031"></a>               <span class='Operator'>*</span><span class='Declare_Local'>newlb</span><span class='Delimiter'>; 
</span><a name="LN2032"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>fixedDim</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], 
</span><a name="LN2033"></a>                <span class='Declare_Local'>fixedLb</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN2034"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>elemtype</span><span class='Delimiter'>; 
</span><a name="LN2035"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>arraydataptr</span><span class='Delimiter'>; 
</span><a name="LN2036"></a>    <a href="../../../include/c.h.html#LN274"><span class='Ref_to_Typedef'>bits8</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>arraynullsptr</span><span class='Delimiter'>; 
</span><a name="LN2037"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>dataoffset</span><span class='Delimiter'>; 
</span><a name="LN2038"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>bytes</span><span class='Delimiter'>, 
</span><a name="LN2039"></a>                <span class='Declare_Local'>span</span><span class='Delimiter'>[</span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Delimiter'>]; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2020"><span class='Ref_to_Parameter'>arraytyplen</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * fixed-length arrays -- currently, cannot slice these because parser 
         * labels output as being of the fixed-length array type! Code below 
         * shows how we could support it if the parser were changed to label 
         * output as a suitable varlena array type. 
         */ 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"slices of fixed-length arrays not implemented"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * fixed-length arrays -- these are assumed to be 1-d, 0-based 
         * 
         * XXX where would we get the correct ELEMTYPE from? 
         */ 
</span>        <a href="arrayfuncs.c.html#LN2028"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN2032"><span class='Ref_To_Local'>fixedDim</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2020"><span class='Ref_to_Parameter'>arraytyplen</span></a> <span class='Operator'>/ </span><a href="arrayfuncs.c.html#LN2021"><span class='Ref_to_Parameter'>elmlen</span></a><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN2033"><span class='Ref_To_Local'>fixedLb</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN2029"><span class='Ref_To_Local'>dim</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2032"><span class='Ref_To_Local'>fixedDim</span></a><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN2030"><span class='Ref_To_Local'>lb</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2033"><span class='Ref_To_Local'>fixedLb</span></a><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN2034"><span class='Ref_To_Local'>elemtype</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* XXX */ 
</span>        <a href="arrayfuncs.c.html#LN2035"><span class='Ref_To_Local'>arraydataptr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2014"><span class='Ref_to_Parameter'>arraydatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN2036"><span class='Ref_To_Local'>arraynullsptr</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if arraytyplen&GT;0 &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* detoast input array if necessary */ 
</span>        <a href="arrayfuncs.c.html#LN2025"><span class='Ref_To_Local'>array</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN241"><span class='Ref_to_Macro'>DatumGetArrayTypeP</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2014"><span class='Ref_to_Parameter'>arraydatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="arrayfuncs.c.html#LN2028"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2025"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN2029"><span class='Ref_To_Local'>dim</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2025"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN2030"><span class='Ref_To_Local'>lb</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN276"><span class='Ref_to_Macro'>ARR_LBOUND</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2025"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN2034"><span class='Ref_To_Local'>elemtype</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN272"><span class='Ref_to_Macro'>ARR_ELEMTYPE</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2025"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN2035"><span class='Ref_To_Local'>arraydataptr</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN302"><span class='Ref_to_Macro'>ARR_DATA_PTR</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2025"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN2036"><span class='Ref_To_Local'>arraynullsptr</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN280"><span class='Ref_to_Macro'>ARR_NULLBITMAP</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2025"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check provided subscripts.  A slice exceeding the current array limits 
     * is silently truncated to the array limits.  If we end up with an empty 
     * slice, return an empty array. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2028"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN2015"><span class='Ref_to_Parameter'>nSubscripts</span></a> <span class='Operator'>|| </span><a href="arrayfuncs.c.html#LN2028"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="arrayfuncs.c.html#LN2028"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>&GT; </span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN378"><span class='Ref_to_Proto'>construct_empty_array</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2034"><span class='Ref_To_Local'>elemtype</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2027"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN2027"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN2015"><span class='Ref_to_Parameter'>nSubscripts</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN2027"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="arrayfuncs.c.html#LN2019"><span class='Ref_to_Parameter'>lowerProvided</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2027"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>|| </span><a href="arrayfuncs.c.html#LN2017"><span class='Ref_to_Parameter'>lowerIndx</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2027"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN2030"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2027"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <a href="arrayfuncs.c.html#LN2017"><span class='Ref_to_Parameter'>lowerIndx</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2027"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2030"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2027"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="arrayfuncs.c.html#LN2018"><span class='Ref_to_Parameter'>upperProvided</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2027"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>|| </span><a href="arrayfuncs.c.html#LN2016"><span class='Ref_to_Parameter'>upperIndx</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2027"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>&GT;= </span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2029"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2027"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN2030"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2027"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span> 
            <a href="arrayfuncs.c.html#LN2016"><span class='Ref_to_Parameter'>upperIndx</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2027"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2029"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2027"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN2030"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2027"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2017"><span class='Ref_to_Parameter'>lowerIndx</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2027"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>&GT; </span><a href="arrayfuncs.c.html#LN2016"><span class='Ref_to_Parameter'>upperIndx</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2027"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN378"><span class='Ref_to_Proto'>construct_empty_array</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2034"><span class='Ref_To_Local'>elemtype</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Comment_Multi_Line'>/* fill any missing subscript positions with full array range */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN2027"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN2028"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN2027"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="arrayfuncs.c.html#LN2017"><span class='Ref_to_Parameter'>lowerIndx</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2027"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2030"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2027"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>        <a href="arrayfuncs.c.html#LN2016"><span class='Ref_to_Parameter'>upperIndx</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2027"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2029"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2027"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN2030"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2027"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2017"><span class='Ref_to_Parameter'>lowerIndx</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2027"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>&GT; </span><a href="arrayfuncs.c.html#LN2016"><span class='Ref_to_Parameter'>upperIndx</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2027"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN378"><span class='Ref_to_Proto'>construct_empty_array</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2034"><span class='Ref_To_Local'>elemtype</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="arrayutils.c.html#LN118"><span class='Ref_to_Func'>mda_get_range</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2028"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2039"><span class='Ref_To_Local'>span</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2017"><span class='Ref_to_Parameter'>lowerIndx</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2016"><span class='Ref_to_Parameter'>upperIndx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN2038"><span class='Ref_To_Local'>bytes</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN125"><span class='Ref_to_Proto'>array_slice_size</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2035"><span class='Ref_To_Local'>arraydataptr</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2036"><span class='Ref_To_Local'>arraynullsptr</span></a><span class='Delimiter'>, 
</span>                             <a href="arrayfuncs.c.html#LN2028"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2029"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2030"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>, 
</span>                             <a href="arrayfuncs.c.html#LN2017"><span class='Ref_to_Parameter'>lowerIndx</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2016"><span class='Ref_to_Parameter'>upperIndx</span></a><span class='Delimiter'>, 
</span>                             <a href="arrayfuncs.c.html#LN2021"><span class='Ref_to_Parameter'>elmlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2022"><span class='Ref_to_Parameter'>elmbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2023"><span class='Ref_to_Parameter'>elmalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Currently, we put a null bitmap in the result if the source has one; 
     * could be smarter ... 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2036"><span class='Ref_To_Local'>arraynullsptr</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="arrayfuncs.c.html#LN2037"><span class='Ref_To_Local'>dataoffset</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN292"><span class='Ref_to_Macro'>ARR_OVERHEAD_WITHNULLS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2028"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>, </span><a href="arrayutils.c.html#LN73"><span class='Ref_to_Func'>ArrayGetNItems</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2028"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2039"><span class='Ref_To_Local'>span</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN2038"><span class='Ref_To_Local'>bytes</span></a> <span class='Operator'>+= </span><a href="arrayfuncs.c.html#LN2037"><span class='Ref_To_Local'>dataoffset</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="arrayfuncs.c.html#LN2037"><span class='Ref_To_Local'>dataoffset</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* marker for no null bitmap */ 
</span>        <a href="arrayfuncs.c.html#LN2038"><span class='Ref_To_Local'>bytes</span></a> <span class='Operator'>+= </span><a href="../../../include/utils/array.h.html#LN290"><span class='Ref_to_Macro'>ARR_OVERHEAD_NONULLS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2028"><span class='Ref_To_Local'>ndim</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="arrayfuncs.c.html#LN2026"><span class='Ref_To_Local'>newarray</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2038"><span class='Ref_To_Local'>bytes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2026"><span class='Ref_To_Local'>newarray</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2038"><span class='Ref_To_Local'>bytes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN2026"><span class='Ref_To_Local'>newarray</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN78"><span class='Ref_to_Member'>ndim</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2028"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN2026"><span class='Ref_To_Local'>newarray</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN79"><span class='Ref_to_Member'>dataoffset</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2037"><span class='Ref_To_Local'>dataoffset</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN2026"><span class='Ref_To_Local'>newarray</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN80"><span class='Ref_to_Member'>elemtype</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2034"><span class='Ref_To_Local'>elemtype</span></a><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2026"><span class='Ref_To_Local'>newarray</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2039"><span class='Ref_To_Local'>span</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2028"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Lower bounds of the new array are set to 1.  Formerly (before 7.3) we 
     * copied the given lowerIndx values ... but that seems confusing. 
     */ 
</span>    <a href="arrayfuncs.c.html#LN2031"><span class='Ref_To_Local'>newlb</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN276"><span class='Ref_to_Macro'>ARR_LBOUND</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2026"><span class='Ref_To_Local'>newarray</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2027"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN2027"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN2028"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN2027"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <a href="arrayfuncs.c.html#LN2031"><span class='Ref_To_Local'>newlb</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2027"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN129"><span class='Ref_to_Proto'>array_extract_slice</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2026"><span class='Ref_To_Local'>newarray</span></a><span class='Delimiter'>, 
</span>                        <a href="arrayfuncs.c.html#LN2028"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2029"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2030"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>, 
</span>                        <a href="arrayfuncs.c.html#LN2035"><span class='Ref_To_Local'>arraydataptr</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2036"><span class='Ref_To_Local'>arraynullsptr</span></a><span class='Delimiter'>, 
</span>                        <a href="arrayfuncs.c.html#LN2017"><span class='Ref_to_Parameter'>lowerIndx</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2016"><span class='Ref_to_Parameter'>upperIndx</span></a><span class='Delimiter'>, 
</span>                        <a href="arrayfuncs.c.html#LN2021"><span class='Ref_to_Parameter'>elmlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2022"><span class='Ref_to_Parameter'>elmbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2023"><span class='Ref_to_Parameter'>elmalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2026"><span class='Ref_To_Local'>newarray</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end array_get_slice &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * array_set_element : 
 *        This routine sets the value of one array element (specified by 
 *        a subscript array) to a new value specified by "dataValue". 
 * 
 * This handles both ordinary varlena arrays and fixed-length arrays. 
 * 
 * Inputs: 
 *  arraydatum: the initial array object (mustn't be NULL) 
 *  nSubscripts: number of subscripts supplied 
 *  indx[]: the subscript values 
 *  dataValue: the datum to be inserted at the given position 
 *  isNull: whether dataValue is NULL 
 *  arraytyplen: pg_type.typlen for the array type 
 *  elmlen: pg_type.typlen for the array's element type 
 *  elmbyval: pg_type.typbyval for the array's element type 
 *  elmalign: pg_type.typalign for the array's element type 
 * 
 * Result: 
 *        A new array is returned, just like the old except for the one 
 *        modified entry.  The original array object is not changed, 
 *        unless what is passed is a read-write reference to an expanded 
 *        array object; in that case the expanded array is updated in-place. 
 * 
 * For one-dimensional arrays only, we allow the array to be extended 
 * by assigning to a position outside the existing subscript range; any 
 * positions between the existing elements and the new one are set to NULLs. 
 * (XXX TODO: allow a corresponding behavior for multidimensional arrays) 
 * 
 * NOTE: For assignments, we throw an error for invalid subscripts etc, 
 * rather than returning a NULL as the fetch operations do. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2185"></a><span class='Declare_Function'>array_set_element</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>arraydatum</span><span class='Delimiter'>, 
</span><a name="LN2186"></a>                  <span class='Keyword'>int </span><span class='Declare_Parameter'>nSubscripts</span><span class='Delimiter'>, 
</span><a name="LN2187"></a>                  <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>indx</span><span class='Delimiter'>, 
</span><a name="LN2188"></a>                  <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>dataValue</span><span class='Delimiter'>, 
</span><a name="LN2189"></a>                  <span class='Keyword'>bool </span><span class='Declare_Parameter'>isNull</span><span class='Delimiter'>, 
</span><a name="LN2190"></a>                  <span class='Keyword'>int </span><span class='Declare_Parameter'>arraytyplen</span><span class='Delimiter'>, 
</span><a name="LN2191"></a>                  <span class='Keyword'>int </span><span class='Declare_Parameter'>elmlen</span><span class='Delimiter'>, 
</span><a name="LN2192"></a>                  <span class='Keyword'>bool </span><span class='Declare_Parameter'>elmbyval</span><span class='Delimiter'>, 
</span><a name="LN2193"></a>                  <span class='Keyword'>char </span><span class='Declare_Parameter'>elmalign</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2195"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>array</span><span class='Delimiter'>; 
</span><a name="LN2196"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>newarray</span><span class='Delimiter'>; 
</span><a name="LN2197"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN2198"></a>                <span class='Declare_Local'>ndim</span><span class='Delimiter'>, 
</span><a name="LN2199"></a>                <span class='Declare_Local'>dim</span><span class='Delimiter'>[</span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Delimiter'>], 
</span><a name="LN2200"></a>                <span class='Declare_Local'>lb</span><span class='Delimiter'>[</span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Delimiter'>], 
</span><a name="LN2201"></a>                <span class='Declare_Local'>offset</span><span class='Delimiter'>; 
</span><a name="LN2202"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>elt_ptr</span><span class='Delimiter'>; 
</span><a name="LN2203"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>newhasnulls</span><span class='Delimiter'>; 
</span><a name="LN2204"></a>    <a href="../../../include/c.h.html#LN274"><span class='Ref_to_Typedef'>bits8</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>oldnullbitmap</span><span class='Delimiter'>; 
</span><a name="LN2205"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>oldnitems</span><span class='Delimiter'>, 
</span><a name="LN2206"></a>                <span class='Declare_Local'>newnitems</span><span class='Delimiter'>, 
</span><a name="LN2207"></a>                <span class='Declare_Local'>olddatasize</span><span class='Delimiter'>, 
</span><a name="LN2208"></a>                <span class='Declare_Local'>newsize</span><span class='Delimiter'>, 
</span><a name="LN2209"></a>                <span class='Declare_Local'>olditemlen</span><span class='Delimiter'>, 
</span><a name="LN2210"></a>                <span class='Declare_Local'>newitemlen</span><span class='Delimiter'>, 
</span><a name="LN2211"></a>                <span class='Declare_Local'>overheadlen</span><span class='Delimiter'>, 
</span><a name="LN2212"></a>                <span class='Declare_Local'>oldoverheadlen</span><span class='Delimiter'>, 
</span><a name="LN2213"></a>                <span class='Declare_Local'>addedbefore</span><span class='Delimiter'>, 
</span><a name="LN2214"></a>                <span class='Declare_Local'>addedafter</span><span class='Delimiter'>, 
</span><a name="LN2215"></a>                <span class='Declare_Local'>lenbefore</span><span class='Delimiter'>, 
</span><a name="LN2216"></a>                <span class='Declare_Local'>lenafter</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2190"><span class='Ref_to_Parameter'>arraytyplen</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * fixed-length arrays -- these are assumed to be 1-d, 0-based. We 
         * cannot extend them, either. 
         */ 
</span><a name="LN2224"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>resultarray</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2186"><span class='Ref_to_Parameter'>nSubscripts</span></a> <span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ARRAY_SUBSCRIPT_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"wrong number of array subscripts"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2187"><span class='Ref_to_Parameter'>indx</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="arrayfuncs.c.html#LN2187"><span class='Ref_to_Parameter'>indx</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>* </span><a href="arrayfuncs.c.html#LN2191"><span class='Ref_to_Parameter'>elmlen</span></a> <span class='Operator'>&GT;= </span><a href="arrayfuncs.c.html#LN2190"><span class='Ref_to_Parameter'>arraytyplen</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ARRAY_SUBSCRIPT_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"array subscript out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2189"><span class='Ref_to_Parameter'>isNull</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NULL_VALUE_NOT_ALLOWED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot assign null value to an element of a fixed-length array"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="arrayfuncs.c.html#LN2224"><span class='Ref_To_Local'>resultarray</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2190"><span class='Ref_to_Parameter'>arraytyplen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2224"><span class='Ref_To_Local'>resultarray</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2185"><span class='Ref_to_Parameter'>arraydatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2190"><span class='Ref_to_Parameter'>arraytyplen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN2202"><span class='Ref_To_Local'>elt_ptr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="arrayfuncs.c.html#LN2224"><span class='Ref_To_Local'>resultarray</span></a> <span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN2187"><span class='Ref_to_Parameter'>indx</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>* </span><a href="arrayfuncs.c.html#LN2191"><span class='Ref_to_Parameter'>elmlen</span></a><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN115"><span class='Ref_to_Proto'>ArrayCastAndSet</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2188"><span class='Ref_to_Parameter'>dataValue</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2191"><span class='Ref_to_Parameter'>elmlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2192"><span class='Ref_to_Parameter'>elmbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2193"><span class='Ref_to_Parameter'>elmalign</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2202"><span class='Ref_To_Local'>elt_ptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2224"><span class='Ref_To_Local'>resultarray</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if arraytyplen&GT;0 &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2186"><span class='Ref_to_Parameter'>nSubscripts</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="arrayfuncs.c.html#LN2186"><span class='Ref_to_Parameter'>nSubscripts</span></a> <span class='Operator'>&GT; </span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ARRAY_SUBSCRIPT_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"wrong number of array subscripts"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* make sure item to be inserted is not toasted */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2191"><span class='Ref_to_Parameter'>elmlen</span></a> <span class='Operator'>== -</span><span class='Number'>1</span> <span class='Operator'>&& !</span><a href="arrayfuncs.c.html#LN2189"><span class='Ref_to_Parameter'>isNull</span></a><span class='Parentheses'>) 
</span>        <a href="arrayfuncs.c.html#LN2188"><span class='Ref_to_Parameter'>dataValue</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN204"><span class='Ref_to_Macro'>PG_DETOAST_DATUM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2188"><span class='Ref_to_Parameter'>dataValue</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN322"><span class='Ref_to_Macro'>VARATT_IS_EXTERNAL_EXPANDED</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2185"><span class='Ref_to_Parameter'>arraydatum</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* expanded array: let's do this in a separate function */ 
</span>        <span class='Control'>return</span> <a href="arrayfuncs.c.html#LN107"><span class='Ref_to_Proto'>array_set_element_expanded</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2185"><span class='Ref_to_Parameter'>arraydatum</span></a><span class='Delimiter'>, 
</span>                                          <a href="arrayfuncs.c.html#LN2186"><span class='Ref_to_Parameter'>nSubscripts</span></a><span class='Delimiter'>, 
</span>                                          <a href="arrayfuncs.c.html#LN2187"><span class='Ref_to_Parameter'>indx</span></a><span class='Delimiter'>, 
</span>                                          <a href="arrayfuncs.c.html#LN2188"><span class='Ref_to_Parameter'>dataValue</span></a><span class='Delimiter'>, 
</span>                                          <a href="arrayfuncs.c.html#LN2189"><span class='Ref_to_Parameter'>isNull</span></a><span class='Delimiter'>, 
</span>                                          <a href="arrayfuncs.c.html#LN2190"><span class='Ref_to_Parameter'>arraytyplen</span></a><span class='Delimiter'>, 
</span>                                          <a href="arrayfuncs.c.html#LN2191"><span class='Ref_to_Parameter'>elmlen</span></a><span class='Delimiter'>, 
</span>                                          <a href="arrayfuncs.c.html#LN2192"><span class='Ref_to_Parameter'>elmbyval</span></a><span class='Delimiter'>, 
</span>                                          <a href="arrayfuncs.c.html#LN2193"><span class='Ref_to_Parameter'>elmalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* detoast input array if necessary */ 
</span>    <a href="arrayfuncs.c.html#LN2195"><span class='Ref_To_Local'>array</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN241"><span class='Ref_to_Macro'>DatumGetArrayTypeP</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2185"><span class='Ref_to_Parameter'>arraydatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN2198"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2195"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * if number of dims is zero, i.e. an empty array, create an array with 
     * nSubscripts dimensions, and set the lower bounds to the supplied 
     * subscripts 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2198"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2283"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>elmtype</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN272"><span class='Ref_to_Macro'>ARR_ELEMTYPE</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2195"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2197"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN2197"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN2186"><span class='Ref_to_Parameter'>nSubscripts</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN2197"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="arrayfuncs.c.html#LN2199"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2197"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN2200"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2197"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2187"><span class='Ref_to_Parameter'>indx</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2197"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>return</span> <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN372"><span class='Ref_to_Proto'>construct_md_array</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN2188"><span class='Ref_to_Parameter'>dataValue</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN2189"><span class='Ref_to_Parameter'>isNull</span></a><span class='Delimiter'>, 
</span>                                                  <a href="arrayfuncs.c.html#LN2186"><span class='Ref_to_Parameter'>nSubscripts</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2199"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2200"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>, 
</span>                                                  <a href="arrayfuncs.c.html#LN2283"><span class='Ref_To_Local'>elmtype</span></a><span class='Delimiter'>, 
</span>                                                <a href="arrayfuncs.c.html#LN2191"><span class='Ref_to_Parameter'>elmlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2192"><span class='Ref_to_Parameter'>elmbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2193"><span class='Ref_to_Parameter'>elmalign</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2198"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN2186"><span class='Ref_to_Parameter'>nSubscripts</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ARRAY_SUBSCRIPT_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"wrong number of array subscripts"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* copy dim/lb since we may modify them */ 
</span>    memcpy<span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2199"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2195"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2198"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2200"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/array.h.html#LN276"><span class='Ref_to_Macro'>ARR_LBOUND</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2195"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2198"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN2203"><span class='Ref_To_Local'>newhasnulls</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN271"><span class='Ref_to_Macro'>ARR_HASNULL</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2195"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>) </span><span class='Operator'>|| </span><a href="arrayfuncs.c.html#LN2189"><span class='Ref_to_Parameter'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN2213"><span class='Ref_To_Local'>addedbefore</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2214"><span class='Ref_To_Local'>addedafter</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check subscripts 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2198"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2187"><span class='Ref_to_Parameter'>indx</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN2200"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="arrayfuncs.c.html#LN2213"><span class='Ref_To_Local'>addedbefore</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2200"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>- </span><a href="arrayfuncs.c.html#LN2187"><span class='Ref_to_Parameter'>indx</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span>            <a href="arrayfuncs.c.html#LN2199"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>+= </span><a href="arrayfuncs.c.html#LN2213"><span class='Ref_To_Local'>addedbefore</span></a><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN2200"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2187"><span class='Ref_to_Parameter'>indx</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2213"><span class='Ref_To_Local'>addedbefore</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                <a href="arrayfuncs.c.html#LN2203"><span class='Ref_To_Local'>newhasnulls</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* will insert nulls */ 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2187"><span class='Ref_to_Parameter'>indx</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>&GT;= </span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2199"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN2200"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="arrayfuncs.c.html#LN2214"><span class='Ref_To_Local'>addedafter</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2187"><span class='Ref_to_Parameter'>indx</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>- </span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2199"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN2200"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN2199"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>+= </span><a href="arrayfuncs.c.html#LN2214"><span class='Ref_To_Local'>addedafter</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2214"><span class='Ref_To_Local'>addedafter</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                <a href="arrayfuncs.c.html#LN2203"><span class='Ref_To_Local'>newhasnulls</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* will insert nulls */ 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * XXX currently we do not support extending multi-dimensional arrays 
         * during assignment 
         */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2197"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN2197"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN2198"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN2197"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2187"><span class='Ref_to_Parameter'>indx</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2197"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN2200"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2197"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>|| 
</span>                <a href="arrayfuncs.c.html#LN2187"><span class='Ref_to_Parameter'>indx</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2197"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>&GT;= </span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2199"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2197"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN2200"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2197"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span> 
                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ARRAY_SUBSCRIPT_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"array subscript out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Compute sizes of items and areas to copy 
     */ 
</span>    <a href="arrayfuncs.c.html#LN2206"><span class='Ref_To_Local'>newnitems</span></a> <span class='Operator'>= </span><a href="arrayutils.c.html#LN73"><span class='Ref_to_Func'>ArrayGetNItems</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2198"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2199"><span class='Ref_To_Local'>dim</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2203"><span class='Ref_To_Local'>newhasnulls</span></a><span class='Parentheses'>) 
</span>        <a href="arrayfuncs.c.html#LN2211"><span class='Ref_To_Local'>overheadlen</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN292"><span class='Ref_to_Macro'>ARR_OVERHEAD_WITHNULLS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2198"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2206"><span class='Ref_To_Local'>newnitems</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="arrayfuncs.c.html#LN2211"><span class='Ref_To_Local'>overheadlen</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN290"><span class='Ref_to_Macro'>ARR_OVERHEAD_NONULLS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2198"><span class='Ref_To_Local'>ndim</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN2205"><span class='Ref_To_Local'>oldnitems</span></a> <span class='Operator'>= </span><a href="arrayutils.c.html#LN73"><span class='Ref_to_Func'>ArrayGetNItems</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2198"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2195"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN2204"><span class='Ref_To_Local'>oldnullbitmap</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN280"><span class='Ref_to_Macro'>ARR_NULLBITMAP</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2195"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN2212"><span class='Ref_To_Local'>oldoverheadlen</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN296"><span class='Ref_to_Macro'>ARR_DATA_OFFSET</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2195"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN2207"><span class='Ref_To_Local'>olddatasize</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN269"><span class='Ref_to_Macro'>ARR_SIZE</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2195"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="arrayfuncs.c.html#LN2212"><span class='Ref_To_Local'>oldoverheadlen</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2213"><span class='Ref_To_Local'>addedbefore</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="arrayfuncs.c.html#LN2201"><span class='Ref_To_Local'>offset</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN2215"><span class='Ref_To_Local'>lenbefore</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN2209"><span class='Ref_To_Local'>olditemlen</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN2216"><span class='Ref_To_Local'>lenafter</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2207"><span class='Ref_To_Local'>olddatasize</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2214"><span class='Ref_To_Local'>addedafter</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="arrayfuncs.c.html#LN2201"><span class='Ref_To_Local'>offset</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2205"><span class='Ref_To_Local'>oldnitems</span></a><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN2215"><span class='Ref_To_Local'>lenbefore</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2207"><span class='Ref_To_Local'>olddatasize</span></a><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN2209"><span class='Ref_To_Local'>olditemlen</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN2216"><span class='Ref_To_Local'>lenafter</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="arrayfuncs.c.html#LN2201"><span class='Ref_To_Local'>offset</span></a> <span class='Operator'>= </span><a href="arrayutils.c.html#LN29"><span class='Ref_to_Func'>ArrayGetOffset</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2186"><span class='Ref_to_Parameter'>nSubscripts</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2199"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2200"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2187"><span class='Ref_to_Parameter'>indx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN2202"><span class='Ref_To_Local'>elt_ptr</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN118"><span class='Ref_to_Proto'>array_seek</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN302"><span class='Ref_to_Macro'>ARR_DATA_PTR</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2195"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2204"><span class='Ref_To_Local'>oldnullbitmap</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2201"><span class='Ref_To_Local'>offset</span></a><span class='Delimiter'>, 
</span>                             <a href="arrayfuncs.c.html#LN2191"><span class='Ref_to_Parameter'>elmlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2192"><span class='Ref_to_Parameter'>elmbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2193"><span class='Ref_to_Parameter'>elmalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN2215"><span class='Ref_To_Local'>lenbefore</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) (</span><a href="arrayfuncs.c.html#LN2202"><span class='Ref_To_Local'>elt_ptr</span></a> <span class='Operator'>- </span><a href="../../../include/utils/array.h.html#LN302"><span class='Ref_to_Macro'>ARR_DATA_PTR</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2195"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN112"><span class='Ref_to_Proto'>array_get_isnull</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2204"><span class='Ref_To_Local'>oldnullbitmap</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2201"><span class='Ref_To_Local'>offset</span></a><span class='Parentheses'>))</span> 
            <a href="arrayfuncs.c.html#LN2209"><span class='Ref_To_Local'>olditemlen</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="arrayfuncs.c.html#LN2209"><span class='Ref_To_Local'>olditemlen</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN171"><span class='Ref_to_Macro'>att_addlength_pointer</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2191"><span class='Ref_to_Parameter'>elmlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2202"><span class='Ref_To_Local'>elt_ptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN2209"><span class='Ref_To_Local'>olditemlen</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN143"><span class='Ref_to_Macro'>att_align_nominal</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2209"><span class='Ref_To_Local'>olditemlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2193"><span class='Ref_to_Parameter'>elmalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="arrayfuncs.c.html#LN2216"><span class='Ref_To_Local'>lenafter</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) (</span><a href="arrayfuncs.c.html#LN2207"><span class='Ref_To_Local'>olddatasize</span></a> <span class='Operator'>- </span><a href="arrayfuncs.c.html#LN2215"><span class='Ref_To_Local'>lenbefore</span></a> <span class='Operator'>- </span><a href="arrayfuncs.c.html#LN2209"><span class='Ref_To_Local'>olditemlen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2189"><span class='Ref_to_Parameter'>isNull</span></a><span class='Parentheses'>) 
</span>        <a href="arrayfuncs.c.html#LN2210"><span class='Ref_To_Local'>newitemlen</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="arrayfuncs.c.html#LN2210"><span class='Ref_To_Local'>newitemlen</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN159"><span class='Ref_to_Macro'>att_addlength_datum</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2191"><span class='Ref_to_Parameter'>elmlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2188"><span class='Ref_to_Parameter'>dataValue</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN2210"><span class='Ref_To_Local'>newitemlen</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN143"><span class='Ref_to_Macro'>att_align_nominal</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2210"><span class='Ref_To_Local'>newitemlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2193"><span class='Ref_to_Parameter'>elmalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="arrayfuncs.c.html#LN2208"><span class='Ref_To_Local'>newsize</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2211"><span class='Ref_To_Local'>overheadlen</span></a> <span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN2215"><span class='Ref_To_Local'>lenbefore</span></a> <span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN2210"><span class='Ref_To_Local'>newitemlen</span></a> <span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN2216"><span class='Ref_To_Local'>lenafter</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * OK, create the new array and fill in header/dimensions 
     */ 
</span>    <a href="arrayfuncs.c.html#LN2196"><span class='Ref_To_Local'>newarray</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2208"><span class='Ref_To_Local'>newsize</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2196"><span class='Ref_To_Local'>newarray</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2208"><span class='Ref_To_Local'>newsize</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN2196"><span class='Ref_To_Local'>newarray</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN78"><span class='Ref_to_Member'>ndim</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2198"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN2196"><span class='Ref_To_Local'>newarray</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN79"><span class='Ref_to_Member'>dataoffset</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2203"><span class='Ref_To_Local'>newhasnulls</span></a> <span class='Operator'>? </span><a href="arrayfuncs.c.html#LN2211"><span class='Ref_To_Local'>overheadlen</span></a> <span class='Operator'>: </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN2196"><span class='Ref_To_Local'>newarray</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN80"><span class='Ref_to_Member'>elemtype</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN272"><span class='Ref_to_Macro'>ARR_ELEMTYPE</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2195"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2196"><span class='Ref_To_Local'>newarray</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2199"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2198"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN276"><span class='Ref_to_Macro'>ARR_LBOUND</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2196"><span class='Ref_To_Local'>newarray</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2200"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2198"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Fill in data 
     */ 
</span>    memcpy<span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="arrayfuncs.c.html#LN2196"><span class='Ref_To_Local'>newarray</span></a> <span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN2211"><span class='Ref_To_Local'>overheadlen</span></a><span class='Delimiter'>, 
</span>           <span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="arrayfuncs.c.html#LN2195"><span class='Ref_To_Local'>array</span></a> <span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN2212"><span class='Ref_To_Local'>oldoverheadlen</span></a><span class='Delimiter'>, 
</span>           <a href="arrayfuncs.c.html#LN2215"><span class='Ref_To_Local'>lenbefore</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="arrayfuncs.c.html#LN2189"><span class='Ref_to_Parameter'>isNull</span></a><span class='Parentheses'>) 
</span>        <a href="arrayfuncs.c.html#LN115"><span class='Ref_to_Proto'>ArrayCastAndSet</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2188"><span class='Ref_to_Parameter'>dataValue</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2191"><span class='Ref_to_Parameter'>elmlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2192"><span class='Ref_to_Parameter'>elmbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2193"><span class='Ref_to_Parameter'>elmalign</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="arrayfuncs.c.html#LN2196"><span class='Ref_To_Local'>newarray</span></a> <span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN2211"><span class='Ref_To_Local'>overheadlen</span></a> <span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN2215"><span class='Ref_To_Local'>lenbefore</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="arrayfuncs.c.html#LN2196"><span class='Ref_To_Local'>newarray</span></a> <span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN2211"><span class='Ref_To_Local'>overheadlen</span></a> <span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN2215"><span class='Ref_To_Local'>lenbefore</span></a> <span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN2210"><span class='Ref_To_Local'>newitemlen</span></a><span class='Delimiter'>, 
</span>           <span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="arrayfuncs.c.html#LN2195"><span class='Ref_To_Local'>array</span></a> <span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN2212"><span class='Ref_To_Local'>oldoverheadlen</span></a> <span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN2215"><span class='Ref_To_Local'>lenbefore</span></a> <span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN2209"><span class='Ref_To_Local'>olditemlen</span></a><span class='Delimiter'>, 
</span>           <a href="arrayfuncs.c.html#LN2216"><span class='Ref_To_Local'>lenafter</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Fill in nulls bitmap if needed 
     * 
     * Note: it's possible we just replaced the last NULL with a non-NULL, and 
     * could get rid of the bitmap.  Seems not worth testing for though. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2203"><span class='Ref_To_Local'>newhasnulls</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2430"></a>        <a href="../../../include/c.h.html#LN274"><span class='Ref_to_Typedef'>bits8</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>newnullbitmap</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN280"><span class='Ref_to_Macro'>ARR_NULLBITMAP</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2196"><span class='Ref_To_Local'>newarray</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Zero the bitmap to take care of marking inserted positions null */ 
</span>        <a href="../../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2430"><span class='Ref_To_Local'>newnullbitmap</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2206"><span class='Ref_To_Local'>newnitems</span></a> <span class='Operator'>+ </span><span class='Number'>7</span><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Number'>8</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Fix the inserted value */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2214"><span class='Ref_To_Local'>addedafter</span></a><span class='Parentheses'>) 
</span>            <a href="arrayfuncs.c.html#LN113"><span class='Ref_to_Proto'>array_set_isnull</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2430"><span class='Ref_To_Local'>newnullbitmap</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2206"><span class='Ref_To_Local'>newnitems</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2189"><span class='Ref_to_Parameter'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="arrayfuncs.c.html#LN113"><span class='Ref_to_Proto'>array_set_isnull</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2430"><span class='Ref_To_Local'>newnullbitmap</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2201"><span class='Ref_To_Local'>offset</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2189"><span class='Ref_to_Parameter'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Fix the copied range(s) */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2213"><span class='Ref_To_Local'>addedbefore</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/array.h.html#LN365"><span class='Ref_to_Proto'>array_bitmap_copy</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2430"><span class='Ref_To_Local'>newnullbitmap</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2213"><span class='Ref_To_Local'>addedbefore</span></a><span class='Delimiter'>, 
</span>                              <a href="arrayfuncs.c.html#LN2204"><span class='Ref_To_Local'>oldnullbitmap</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                              <a href="arrayfuncs.c.html#LN2205"><span class='Ref_To_Local'>oldnitems</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../../include/utils/array.h.html#LN365"><span class='Ref_to_Proto'>array_bitmap_copy</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2430"><span class='Ref_To_Local'>newnullbitmap</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                              <a href="arrayfuncs.c.html#LN2204"><span class='Ref_To_Local'>oldnullbitmap</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                              <a href="arrayfuncs.c.html#LN2201"><span class='Ref_To_Local'>offset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2214"><span class='Ref_To_Local'>addedafter</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="../../../include/utils/array.h.html#LN365"><span class='Ref_to_Proto'>array_bitmap_copy</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2430"><span class='Ref_To_Local'>newnullbitmap</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2201"><span class='Ref_To_Local'>offset</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                  <a href="arrayfuncs.c.html#LN2204"><span class='Ref_To_Local'>oldnullbitmap</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2201"><span class='Ref_To_Local'>offset</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                  <a href="arrayfuncs.c.html#LN2205"><span class='Ref_To_Local'>oldnitems</span></a> <span class='Operator'>- </span><a href="arrayfuncs.c.html#LN2201"><span class='Ref_To_Local'>offset</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if newhasnulls &raquo; </span> 
 
    <span class='Control'>return</span> <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2196"><span class='Ref_To_Local'>newarray</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end array_set_element &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Implementation of array_set_element() for an expanded array 
 * 
 * Note: as with any operation on a read/write expanded object, we must 
 * take pains not to leave the object in a corrupt state if we fail partway 
 * through. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2467"></a><span class='Declare_Function'>array_set_element_expanded</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>arraydatum</span><span class='Delimiter'>, 
</span><a name="LN2468"></a>                           <span class='Keyword'>int </span><span class='Declare_Parameter'>nSubscripts</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>indx</span><span class='Delimiter'>, 
</span><a name="LN2469"></a>                           <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>dataValue</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isNull</span><span class='Delimiter'>, 
</span><a name="LN2470"></a>                           <span class='Keyword'>int </span><span class='Declare_Parameter'>arraytyplen</span><span class='Delimiter'>, 
</span><a name="LN2471"></a>                           <span class='Keyword'>int </span><span class='Declare_Parameter'>elmlen</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>elmbyval</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>elmalign</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2473"></a>    <a href="../../../include/utils/array.h.html#LN98"><span class='Ref_to_Struct'>ExpandedArrayHeader</span></a> <span class='Operator'>*</span><span class='Declare_Local'>eah</span><span class='Delimiter'>; 
</span><a name="LN2474"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>dvalues</span><span class='Delimiter'>; 
</span><a name="LN2475"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>dnulls</span><span class='Delimiter'>; 
</span><a name="LN2476"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN2477"></a>                <span class='Declare_Local'>ndim</span><span class='Delimiter'>, 
</span><a name="LN2478"></a>                <span class='Declare_Local'>dim</span><span class='Delimiter'>[</span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Delimiter'>], 
</span><a name="LN2479"></a>                <span class='Declare_Local'>lb</span><span class='Delimiter'>[</span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Delimiter'>], 
</span><a name="LN2480"></a>                <span class='Declare_Local'>offset</span><span class='Delimiter'>; 
</span><a name="LN2481"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>dimschanged</span><span class='Delimiter'>, 
</span><a name="LN2482"></a>                <span class='Declare_Local'>newhasnulls</span><span class='Delimiter'>; 
</span><a name="LN2483"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>addedbefore</span><span class='Delimiter'>, 
</span><a name="LN2484"></a>                <span class='Declare_Local'>addedafter</span><span class='Delimiter'>; 
</span><a name="LN2485"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>oldValue</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Convert to R/W object if not so already */ 
</span>    <a href="arrayfuncs.c.html#LN2473"><span class='Ref_To_Local'>eah</span></a> <span class='Operator'>= </span><a href="array_expanded.c.html#LN350"><span class='Ref_to_Func'>DatumGetExpandedArray</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2467"><span class='Ref_to_Parameter'>arraydatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Sanity-check caller's info against object; we don't use it otherwise */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2470"><span class='Ref_to_Parameter'>arraytyplen</span></a> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2471"><span class='Ref_to_Parameter'>elmlen</span></a> <span class='Operator'>== </span><a href="arrayfuncs.c.html#LN2473"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN113"><span class='Ref_to_Member'>typlen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2471"><span class='Ref_to_Parameter'>elmbyval</span></a> <span class='Operator'>== </span><a href="arrayfuncs.c.html#LN2473"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN114"><span class='Ref_to_Member'>typbyval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2471"><span class='Ref_to_Parameter'>elmalign</span></a> <span class='Operator'>== </span><a href="arrayfuncs.c.html#LN2473"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN115"><span class='Ref_to_Member'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Copy dimension info into local storage.  This allows us to modify the 
     * dimensions if needed, while not messing up the expanded value if we 
     * fail partway through. 
     */ 
</span>    <a href="arrayfuncs.c.html#LN2477"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2473"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN107"><span class='Ref_to_Member'>ndims</span></a><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2477"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="arrayfuncs.c.html#LN2477"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>&LT;= </span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2478"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2473"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN108"><span class='Ref_to_Member'>dims</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2477"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2479"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2473"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN109"><span class='Ref_to_Member'>lbound</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2477"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN2481"><span class='Ref_To_Local'>dimschanged</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * if number of dims is zero, i.e. an empty array, create an array with 
     * nSubscripts dimensions, and set the lower bounds to the supplied 
     * subscripts. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2477"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Allocate adequate space for new dimension info.  This is harmless 
         * if we fail later. 
         */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2468"><span class='Ref_to_Parameter'>nSubscripts</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="arrayfuncs.c.html#LN2468"><span class='Ref_to_Parameter'>nSubscripts</span></a> <span class='Operator'>&LT;= </span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN2473"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN108"><span class='Ref_to_Member'>dims</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/palloc.h.html#LN71"><span class='Ref_to_Proto'>MemoryContextAllocZero</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2473"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN101"><span class='Ref_to_Member'>hdr</span></a><span class='Operator'>.</span><a href="../../../include/utils/expandeddatum.h.html#LN106"><span class='Ref_to_Member'>eoh_context</span></a><span class='Delimiter'>, 
</span>                                                   <a href="arrayfuncs.c.html#LN2468"><span class='Ref_to_Parameter'>nSubscripts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN2473"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN109"><span class='Ref_to_Member'>lbound</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/palloc.h.html#LN71"><span class='Ref_to_Proto'>MemoryContextAllocZero</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2473"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN101"><span class='Ref_to_Member'>hdr</span></a><span class='Operator'>.</span><a href="../../../include/utils/expandeddatum.h.html#LN106"><span class='Ref_to_Member'>eoh_context</span></a><span class='Delimiter'>, 
</span>                                                  <a href="arrayfuncs.c.html#LN2468"><span class='Ref_to_Parameter'>nSubscripts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Update local copies of dimension info */ 
</span>        <a href="arrayfuncs.c.html#LN2477"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2468"><span class='Ref_to_Parameter'>nSubscripts</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2476"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN2476"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN2468"><span class='Ref_to_Parameter'>nSubscripts</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN2476"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="arrayfuncs.c.html#LN2478"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2476"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN2479"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2476"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2468"><span class='Ref_to_Parameter'>indx</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2476"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>        <span class='Delimiter'>} 
</span>        <a href="arrayfuncs.c.html#LN2481"><span class='Ref_To_Local'>dimschanged</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if ndim==0 &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2477"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN2468"><span class='Ref_to_Parameter'>nSubscripts</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ARRAY_SUBSCRIPT_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"wrong number of array subscripts"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Deconstruct array if we didn't already.  (Someday maybe add a special 
     * case path for fixed-length, no-nulls cases, where we can overwrite an 
     * element in place without ever deconstructing.  But today is not that 
     * day.) 
     */ 
</span>    <a href="array_expanded.c.html#LN422"><span class='Ref_to_Func'>deconstruct_expanded_array</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2473"><span class='Ref_To_Local'>eah</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Copy new element into array's context, if needed (we assume it's 
     * already detoasted, so no junk should be created).  If we fail further 
     * down, this memory is leaked, but that's reasonably harmless. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="arrayfuncs.c.html#LN2473"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN114"><span class='Ref_to_Member'>typbyval</span></a> <span class='Operator'>&& !</span><a href="arrayfuncs.c.html#LN2469"><span class='Ref_to_Parameter'>isNull</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2553"></a>        <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2473"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN101"><span class='Ref_to_Member'>hdr</span></a><span class='Operator'>.</span><a href="../../../include/utils/expandeddatum.h.html#LN106"><span class='Ref_to_Member'>eoh_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="arrayfuncs.c.html#LN2469"><span class='Ref_to_Parameter'>dataValue</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datum.h.html#LN30"><span class='Ref_to_Proto'>datumCopy</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2469"><span class='Ref_to_Parameter'>dataValue</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2473"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN113"><span class='Ref_to_Member'>typlen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2553"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="arrayfuncs.c.html#LN2474"><span class='Ref_To_Local'>dvalues</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2473"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN129"><span class='Ref_to_Member'>dvalues</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN2475"><span class='Ref_To_Local'>dnulls</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2473"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN130"><span class='Ref_to_Member'>dnulls</span></a><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN2482"><span class='Ref_To_Local'>newhasnulls</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="arrayfuncs.c.html#LN2475"><span class='Ref_To_Local'>dnulls</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) </span><span class='Operator'>|| </span><a href="arrayfuncs.c.html#LN2469"><span class='Ref_to_Parameter'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN2483"><span class='Ref_To_Local'>addedbefore</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2484"><span class='Ref_To_Local'>addedafter</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check subscripts (this logic matches original array_set_element) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2477"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2468"><span class='Ref_to_Parameter'>indx</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN2479"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="arrayfuncs.c.html#LN2483"><span class='Ref_To_Local'>addedbefore</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2479"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>- </span><a href="arrayfuncs.c.html#LN2468"><span class='Ref_to_Parameter'>indx</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span>            <a href="arrayfuncs.c.html#LN2478"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>+= </span><a href="arrayfuncs.c.html#LN2483"><span class='Ref_To_Local'>addedbefore</span></a><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN2479"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2468"><span class='Ref_to_Parameter'>indx</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span>            <a href="arrayfuncs.c.html#LN2481"><span class='Ref_To_Local'>dimschanged</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2483"><span class='Ref_To_Local'>addedbefore</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                <a href="arrayfuncs.c.html#LN2482"><span class='Ref_To_Local'>newhasnulls</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* will insert nulls */ 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2468"><span class='Ref_to_Parameter'>indx</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>&GT;= </span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2478"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN2479"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="arrayfuncs.c.html#LN2484"><span class='Ref_To_Local'>addedafter</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2468"><span class='Ref_to_Parameter'>indx</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>- </span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2478"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN2479"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN2478"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>+= </span><a href="arrayfuncs.c.html#LN2484"><span class='Ref_To_Local'>addedafter</span></a><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN2481"><span class='Ref_To_Local'>dimschanged</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2484"><span class='Ref_To_Local'>addedafter</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                <a href="arrayfuncs.c.html#LN2482"><span class='Ref_To_Local'>newhasnulls</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* will insert nulls */ 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if ndim==1 &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * XXX currently we do not support extending multi-dimensional arrays 
         * during assignment 
         */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2476"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN2476"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN2477"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN2476"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2468"><span class='Ref_to_Parameter'>indx</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2476"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN2479"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2476"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>|| 
</span>                <a href="arrayfuncs.c.html#LN2468"><span class='Ref_to_Parameter'>indx</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2476"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>&GT;= </span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2478"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2476"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN2479"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2476"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span> 
                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ARRAY_SUBSCRIPT_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"array subscript out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Now we can calculate linear offset of target item in array */ 
</span>    <a href="arrayfuncs.c.html#LN2480"><span class='Ref_To_Local'>offset</span></a> <span class='Operator'>= </span><a href="arrayutils.c.html#LN29"><span class='Ref_to_Func'>ArrayGetOffset</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2468"><span class='Ref_to_Parameter'>nSubscripts</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2478"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2479"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2468"><span class='Ref_to_Parameter'>indx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Physically enlarge existing dvalues/dnulls arrays if needed */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2478"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>&GT; </span><a href="arrayfuncs.c.html#LN2473"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN131"><span class='Ref_to_Member'>dvalueslen</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* We want some extra space if we're enlarging */ 
</span><a name="LN2611"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>newlen</span> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2478"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN2478"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>/ </span><span class='Number'>8</span><span class='Delimiter'>; 
</span> 
        <a href="arrayfuncs.c.html#LN2611"><span class='Ref_To_Local'>newlen</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2611"><span class='Ref_To_Local'>newlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2478"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* integer overflow guard */ 
</span>        <a href="arrayfuncs.c.html#LN2473"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN129"><span class='Ref_to_Member'>dvalues</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2474"><span class='Ref_To_Local'>dvalues</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>            <a href="../../../include/common/fe_memutils.h.html#LN36"><span class='Ref_to_Proto'>repalloc</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2474"><span class='Ref_To_Local'>dvalues</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2611"><span class='Ref_To_Local'>newlen</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2475"><span class='Ref_To_Local'>dnulls</span></a><span class='Parentheses'>) 
</span>            <a href="arrayfuncs.c.html#LN2473"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN130"><span class='Ref_to_Member'>dnulls</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2475"><span class='Ref_To_Local'>dnulls</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) 
</span>                <a href="../../../include/common/fe_memutils.h.html#LN36"><span class='Ref_to_Proto'>repalloc</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2475"><span class='Ref_To_Local'>dnulls</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2611"><span class='Ref_To_Local'>newlen</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN2473"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN131"><span class='Ref_to_Member'>dvalueslen</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2611"><span class='Ref_To_Local'>newlen</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we need a nulls bitmap and don't already have one, create it, being 
     * sure to mark all existing entries as not null. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2482"><span class='Ref_To_Local'>newhasnulls</span></a> <span class='Operator'>&& </span><a href="arrayfuncs.c.html#LN2475"><span class='Ref_To_Local'>dnulls</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="arrayfuncs.c.html#LN2473"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN130"><span class='Ref_to_Member'>dnulls</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2475"><span class='Ref_To_Local'>dnulls</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/palloc.h.html#LN71"><span class='Ref_to_Proto'>MemoryContextAllocZero</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2473"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN101"><span class='Ref_to_Member'>hdr</span></a><span class='Operator'>.</span><a href="../../../include/utils/expandeddatum.h.html#LN106"><span class='Ref_to_Member'>eoh_context</span></a><span class='Delimiter'>, 
</span>                                   <a href="arrayfuncs.c.html#LN2473"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN131"><span class='Ref_to_Member'>dvalueslen</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We now have all the needed space allocated, so we're ready to make 
     * irreversible changes.  Be very wary of allowing failure below here. 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* Flattened value will no longer represent array accurately */ 
</span>    <a href="arrayfuncs.c.html#LN2473"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN148"><span class='Ref_to_Member'>fvalue</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* And we don't know the flattened size either */ 
</span>    <a href="arrayfuncs.c.html#LN2473"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN139"><span class='Ref_to_Member'>flat_size</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Update dimensionality info if needed */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2481"><span class='Ref_To_Local'>dimschanged</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="arrayfuncs.c.html#LN2473"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN107"><span class='Ref_to_Member'>ndims</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2477"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2473"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN108"><span class='Ref_to_Member'>dims</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2478"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2477"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2473"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN109"><span class='Ref_to_Member'>lbound</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2479"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2477"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Reposition items if needed, and fill addedbefore items with nulls */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2483"><span class='Ref_To_Local'>addedbefore</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/c.h.html#LN1057"><span class='Ref_to_Macro'>memmove</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2474"><span class='Ref_To_Local'>dvalues</span></a> <span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN2483"><span class='Ref_To_Local'>addedbefore</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2474"><span class='Ref_To_Local'>dvalues</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2473"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN132"><span class='Ref_to_Member'>nelems</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2476"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN2476"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN2483"><span class='Ref_To_Local'>addedbefore</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN2476"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <a href="arrayfuncs.c.html#LN2474"><span class='Ref_To_Local'>dvalues</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2476"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2475"><span class='Ref_To_Local'>dnulls</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../include/c.h.html#LN1057"><span class='Ref_to_Macro'>memmove</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2475"><span class='Ref_To_Local'>dnulls</span></a> <span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN2483"><span class='Ref_To_Local'>addedbefore</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2475"><span class='Ref_To_Local'>dnulls</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2473"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN132"><span class='Ref_to_Member'>nelems</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2476"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN2476"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN2483"><span class='Ref_To_Local'>addedbefore</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN2476"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                <a href="arrayfuncs.c.html#LN2475"><span class='Ref_To_Local'>dnulls</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2476"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="arrayfuncs.c.html#LN2473"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN132"><span class='Ref_to_Member'>nelems</span></a> <span class='Operator'>+= </span><a href="arrayfuncs.c.html#LN2483"><span class='Ref_To_Local'>addedbefore</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* fill addedafter items with nulls */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2484"><span class='Ref_To_Local'>addedafter</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2476"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN2476"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN2484"><span class='Ref_To_Local'>addedafter</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN2476"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <a href="arrayfuncs.c.html#LN2474"><span class='Ref_To_Local'>dvalues</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2473"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN132"><span class='Ref_to_Member'>nelems</span></a> <span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN2476"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2475"><span class='Ref_To_Local'>dnulls</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2476"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN2476"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN2484"><span class='Ref_To_Local'>addedafter</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN2476"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                <a href="arrayfuncs.c.html#LN2475"><span class='Ref_To_Local'>dnulls</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2473"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN132"><span class='Ref_to_Member'>nelems</span></a> <span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN2476"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="arrayfuncs.c.html#LN2473"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN132"><span class='Ref_to_Member'>nelems</span></a> <span class='Operator'>+= </span><a href="arrayfuncs.c.html#LN2484"><span class='Ref_To_Local'>addedafter</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Grab old element value for pfree'ing, if needed. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="arrayfuncs.c.html#LN2473"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN114"><span class='Ref_to_Member'>typbyval</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2475"><span class='Ref_To_Local'>dnulls</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| !</span><a href="arrayfuncs.c.html#LN2475"><span class='Ref_To_Local'>dnulls</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2480"><span class='Ref_To_Local'>offset</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span> 
        <a href="arrayfuncs.c.html#LN2485"><span class='Ref_To_Local'>oldValue</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2474"><span class='Ref_To_Local'>dvalues</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2480"><span class='Ref_To_Local'>offset</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="arrayfuncs.c.html#LN2485"><span class='Ref_To_Local'>oldValue</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* And finally we can insert the new element. */ 
</span>    <a href="arrayfuncs.c.html#LN2474"><span class='Ref_To_Local'>dvalues</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2480"><span class='Ref_To_Local'>offset</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2469"><span class='Ref_to_Parameter'>dataValue</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2475"><span class='Ref_To_Local'>dnulls</span></a><span class='Parentheses'>) 
</span>        <a href="arrayfuncs.c.html#LN2475"><span class='Ref_To_Local'>dnulls</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2480"><span class='Ref_To_Local'>offset</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2469"><span class='Ref_to_Parameter'>isNull</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Free old element if needed; this keeps repeated element replacements 
     * from bloating the array's storage.  If the pfree somehow fails, it 
     * won't corrupt the array. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2485"><span class='Ref_To_Local'>oldValue</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Don't try to pfree a part of the original flat array */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2485"><span class='Ref_To_Local'>oldValue</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN2473"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN149"><span class='Ref_to_Member'>fstartptr</span></a> <span class='Operator'>|| </span><a href="arrayfuncs.c.html#LN2485"><span class='Ref_To_Local'>oldValue</span></a> <span class='Operator'>&GT;= </span><a href="arrayfuncs.c.html#LN2473"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN150"><span class='Ref_to_Member'>fendptr</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2485"><span class='Ref_To_Local'>oldValue</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Done, return standard TOAST pointer for object */ 
</span>    <span class='Control'>return</span> <a href="../../../include/utils/expandeddatum.h.html#LN135"><span class='Ref_to_Macro'>EOHPGetRWDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN2473"><span class='Ref_To_Local'>eah</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN101"><span class='Ref_to_Member'>hdr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end array_set_element_expanded &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * array_set_slice : 
 *        This routine sets the value of a range of array locations (specified 
 *        by upper and lower subscript values) to new values passed as 
 *        another array. 
 * 
 * This handles both ordinary varlena arrays and fixed-length arrays. 
 * 
 * Inputs: 
 *  arraydatum: the initial array object (mustn't be NULL) 
 *  nSubscripts: number of subscripts supplied (must be same for upper/lower) 
 *  upperIndx[]: the upper subscript values 
 *  lowerIndx[]: the lower subscript values 
 *  upperProvided[]: true for provided upper subscript values 
 *  lowerProvided[]: true for provided lower subscript values 
 *  srcArrayDatum: the source for the inserted values 
 *  isNull: indicates whether srcArrayDatum is NULL 
 *  arraytyplen: pg_type.typlen for the array type 
 *  elmlen: pg_type.typlen for the array's element type 
 *  elmbyval: pg_type.typbyval for the array's element type 
 *  elmalign: pg_type.typalign for the array's element type 
 * 
 * Result: 
 *        A new array is returned, just like the old except for the 
 *        modified range.  The original array object is not changed. 
 * 
 * Omitted upper and lower subscript values are replaced by the corresponding 
 * array bound. 
 * 
 * For one-dimensional arrays only, we allow the array to be extended 
 * by assigning to positions outside the existing subscript range; any 
 * positions between the existing elements and the new ones are set to NULLs. 
 * (XXX TODO: allow a corresponding behavior for multidimensional arrays) 
 * 
 * NOTE: we assume it is OK to scribble on the provided index arrays 
 * lowerIndx[] and upperIndx[].  These are generally just temporaries. 
 * 
 * NOTE: For assignments, we throw an error for silly subscripts etc, 
 * rather than returning a NULL or empty array as the fetch operations do. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2745"></a><span class='Declare_Function'>array_set_slice</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>arraydatum</span><span class='Delimiter'>, 
</span><a name="LN2746"></a>                <span class='Keyword'>int </span><span class='Declare_Parameter'>nSubscripts</span><span class='Delimiter'>, 
</span><a name="LN2747"></a>                <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>upperIndx</span><span class='Delimiter'>, 
</span><a name="LN2748"></a>                <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>lowerIndx</span><span class='Delimiter'>, 
</span><a name="LN2749"></a>                <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>upperProvided</span><span class='Delimiter'>, 
</span><a name="LN2750"></a>                <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>lowerProvided</span><span class='Delimiter'>, 
</span><a name="LN2751"></a>                <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>srcArrayDatum</span><span class='Delimiter'>, 
</span><a name="LN2752"></a>                <span class='Keyword'>bool </span><span class='Declare_Parameter'>isNull</span><span class='Delimiter'>, 
</span><a name="LN2753"></a>                <span class='Keyword'>int </span><span class='Declare_Parameter'>arraytyplen</span><span class='Delimiter'>, 
</span><a name="LN2754"></a>                <span class='Keyword'>int </span><span class='Declare_Parameter'>elmlen</span><span class='Delimiter'>, 
</span><a name="LN2755"></a>                <span class='Keyword'>bool </span><span class='Declare_Parameter'>elmbyval</span><span class='Delimiter'>, 
</span><a name="LN2756"></a>                <span class='Keyword'>char </span><span class='Declare_Parameter'>elmalign</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2758"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>array</span><span class='Delimiter'>; 
</span><a name="LN2759"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>srcArray</span><span class='Delimiter'>; 
</span><a name="LN2760"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>newarray</span><span class='Delimiter'>; 
</span><a name="LN2761"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN2762"></a>                <span class='Declare_Local'>ndim</span><span class='Delimiter'>, 
</span><a name="LN2763"></a>                <span class='Declare_Local'>dim</span><span class='Delimiter'>[</span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Delimiter'>], 
</span><a name="LN2764"></a>                <span class='Declare_Local'>lb</span><span class='Delimiter'>[</span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Delimiter'>], 
</span><a name="LN2765"></a>                <span class='Declare_Local'>span</span><span class='Delimiter'>[</span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Delimiter'>]; 
</span><a name="LN2766"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>newhasnulls</span><span class='Delimiter'>; 
</span><a name="LN2767"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nitems</span><span class='Delimiter'>, 
</span><a name="LN2768"></a>                <span class='Declare_Local'>nsrcitems</span><span class='Delimiter'>, 
</span><a name="LN2769"></a>                <span class='Declare_Local'>olddatasize</span><span class='Delimiter'>, 
</span><a name="LN2770"></a>                <span class='Declare_Local'>newsize</span><span class='Delimiter'>, 
</span><a name="LN2771"></a>                <span class='Declare_Local'>olditemsize</span><span class='Delimiter'>, 
</span><a name="LN2772"></a>                <span class='Declare_Local'>newitemsize</span><span class='Delimiter'>, 
</span><a name="LN2773"></a>                <span class='Declare_Local'>overheadlen</span><span class='Delimiter'>, 
</span><a name="LN2774"></a>                <span class='Declare_Local'>oldoverheadlen</span><span class='Delimiter'>, 
</span><a name="LN2775"></a>                <span class='Declare_Local'>addedbefore</span><span class='Delimiter'>, 
</span><a name="LN2776"></a>                <span class='Declare_Local'>addedafter</span><span class='Delimiter'>, 
</span><a name="LN2777"></a>                <span class='Declare_Local'>lenbefore</span><span class='Delimiter'>, 
</span><a name="LN2778"></a>                <span class='Declare_Local'>lenafter</span><span class='Delimiter'>, 
</span><a name="LN2779"></a>                <span class='Declare_Local'>itemsbefore</span><span class='Delimiter'>, 
</span><a name="LN2780"></a>                <span class='Declare_Local'>itemsafter</span><span class='Delimiter'>, 
</span><a name="LN2781"></a>                <span class='Declare_Local'>nolditems</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Currently, assignment from a NULL source array is a no-op */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2752"><span class='Ref_to_Parameter'>isNull</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="arrayfuncs.c.html#LN2745"><span class='Ref_to_Parameter'>arraydatum</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2753"><span class='Ref_to_Parameter'>arraytyplen</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * fixed-length arrays -- not got round to doing this... 
         */ 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"updates on slices of fixed-length arrays not implemented"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* detoast arrays if necessary */ 
</span>    <a href="arrayfuncs.c.html#LN2758"><span class='Ref_To_Local'>array</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN241"><span class='Ref_to_Macro'>DatumGetArrayTypeP</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2745"><span class='Ref_to_Parameter'>arraydatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN2759"><span class='Ref_To_Local'>srcArray</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN241"><span class='Ref_to_Macro'>DatumGetArrayTypeP</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2751"><span class='Ref_to_Parameter'>srcArrayDatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* note: we assume srcArray contains no toasted elements */ 
</span> 
    <a href="arrayfuncs.c.html#LN2762"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2758"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * if number of dims is zero, i.e. an empty array, create an array with 
     * nSubscripts dimensions, and set the upper and lower bounds to the 
     * supplied subscripts 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2762"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2812"></a>        <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>dvalues</span><span class='Delimiter'>; 
</span><a name="LN2813"></a>        <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>dnulls</span><span class='Delimiter'>; 
</span><a name="LN2814"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>nelems</span><span class='Delimiter'>; 
</span><a name="LN2815"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>elmtype</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN272"><span class='Ref_to_Macro'>ARR_ELEMTYPE</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2758"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/utils/array.h.html#LN382"><span class='Ref_to_Proto'>deconstruct_array</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2759"><span class='Ref_To_Local'>srcArray</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2815"><span class='Ref_To_Local'>elmtype</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2754"><span class='Ref_to_Parameter'>elmlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2755"><span class='Ref_to_Parameter'>elmbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2756"><span class='Ref_to_Parameter'>elmalign</span></a><span class='Delimiter'>, 
</span>                          <span class='Operator'>&</span><a href="arrayfuncs.c.html#LN2812"><span class='Ref_To_Local'>dvalues</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN2813"><span class='Ref_To_Local'>dnulls</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN2814"><span class='Ref_To_Local'>nelems</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2761"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN2761"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN2746"><span class='Ref_to_Parameter'>nSubscripts</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN2761"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="arrayfuncs.c.html#LN2749"><span class='Ref_to_Parameter'>upperProvided</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2761"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>|| !</span><a href="arrayfuncs.c.html#LN2750"><span class='Ref_to_Parameter'>lowerProvided</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2761"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ARRAY_SUBSCRIPT_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"array slice subscript must provide both boundaries"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"When assigning to a slice of an empty array value,"</span> 
                          <span class='String'>" slice boundaries must be fully specified."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <a href="arrayfuncs.c.html#LN2763"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2761"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>1</span> <span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN2747"><span class='Ref_to_Parameter'>upperIndx</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2761"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>- </span><a href="arrayfuncs.c.html#LN2748"><span class='Ref_to_Parameter'>lowerIndx</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2761"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>            <a href="arrayfuncs.c.html#LN2764"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2761"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2748"><span class='Ref_to_Parameter'>lowerIndx</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2761"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* complain if too few source items; we ignore extras, however */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2814"><span class='Ref_To_Local'>nelems</span></a> <span class='Operator'>&LT; </span><a href="arrayutils.c.html#LN73"><span class='Ref_to_Func'>ArrayGetNItems</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2746"><span class='Ref_to_Parameter'>nSubscripts</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2763"><span class='Ref_To_Local'>dim</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ARRAY_SUBSCRIPT_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"source array too small"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>return</span> <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN372"><span class='Ref_to_Proto'>construct_md_array</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2812"><span class='Ref_To_Local'>dvalues</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2813"><span class='Ref_To_Local'>dnulls</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2746"><span class='Ref_to_Parameter'>nSubscripts</span></a><span class='Delimiter'>, 
</span>                                                  <a href="arrayfuncs.c.html#LN2763"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2764"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2815"><span class='Ref_To_Local'>elmtype</span></a><span class='Delimiter'>, 
</span>                                                <a href="arrayfuncs.c.html#LN2754"><span class='Ref_to_Parameter'>elmlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2755"><span class='Ref_to_Parameter'>elmbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2756"><span class='Ref_to_Parameter'>elmalign</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if ndim==0 &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2762"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN2746"><span class='Ref_to_Parameter'>nSubscripts</span></a> <span class='Operator'>|| </span><a href="arrayfuncs.c.html#LN2762"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="arrayfuncs.c.html#LN2762"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>&GT; </span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ARRAY_SUBSCRIPT_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"wrong number of array subscripts"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* copy dim/lb since we may modify them */ 
</span>    memcpy<span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2763"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2758"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2762"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2764"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/array.h.html#LN276"><span class='Ref_to_Macro'>ARR_LBOUND</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2758"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2762"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN2766"><span class='Ref_To_Local'>newhasnulls</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN271"><span class='Ref_to_Macro'>ARR_HASNULL</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2758"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>) </span><span class='Operator'>|| </span><a href="../../../include/utils/array.h.html#LN271"><span class='Ref_to_Macro'>ARR_HASNULL</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2759"><span class='Ref_To_Local'>srcArray</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN2775"><span class='Ref_To_Local'>addedbefore</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2776"><span class='Ref_To_Local'>addedafter</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check subscripts 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2762"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2746"><span class='Ref_to_Parameter'>nSubscripts</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="arrayfuncs.c.html#LN2750"><span class='Ref_to_Parameter'>lowerProvided</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <a href="arrayfuncs.c.html#LN2748"><span class='Ref_to_Parameter'>lowerIndx</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2764"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="arrayfuncs.c.html#LN2749"><span class='Ref_to_Parameter'>upperProvided</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <a href="arrayfuncs.c.html#LN2747"><span class='Ref_to_Parameter'>upperIndx</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2763"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN2764"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2748"><span class='Ref_to_Parameter'>lowerIndx</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>&GT; </span><a href="arrayfuncs.c.html#LN2747"><span class='Ref_to_Parameter'>upperIndx</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ARRAY_SUBSCRIPT_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"upper bound cannot be less than lower bound"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2748"><span class='Ref_to_Parameter'>lowerIndx</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN2764"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2747"><span class='Ref_to_Parameter'>upperIndx</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN2764"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                <a href="arrayfuncs.c.html#LN2766"><span class='Ref_To_Local'>newhasnulls</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* will insert nulls */ 
</span>            <a href="arrayfuncs.c.html#LN2775"><span class='Ref_To_Local'>addedbefore</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2764"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>- </span><a href="arrayfuncs.c.html#LN2748"><span class='Ref_to_Parameter'>lowerIndx</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span>            <a href="arrayfuncs.c.html#LN2763"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>+= </span><a href="arrayfuncs.c.html#LN2775"><span class='Ref_To_Local'>addedbefore</span></a><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN2764"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2748"><span class='Ref_to_Parameter'>lowerIndx</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2747"><span class='Ref_to_Parameter'>upperIndx</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>&GT;= </span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2763"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN2764"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2748"><span class='Ref_to_Parameter'>lowerIndx</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>&GT; </span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2763"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN2764"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>))</span> 
                <a href="arrayfuncs.c.html#LN2766"><span class='Ref_To_Local'>newhasnulls</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* will insert nulls */ 
</span>            <a href="arrayfuncs.c.html#LN2776"><span class='Ref_To_Local'>addedafter</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2747"><span class='Ref_to_Parameter'>upperIndx</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>- </span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2763"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN2764"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN2763"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>+= </span><a href="arrayfuncs.c.html#LN2776"><span class='Ref_To_Local'>addedafter</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if ndim==1 &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * XXX currently we do not support extending multi-dimensional arrays 
         * during assignment 
         */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2761"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN2761"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN2746"><span class='Ref_to_Parameter'>nSubscripts</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN2761"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="arrayfuncs.c.html#LN2750"><span class='Ref_to_Parameter'>lowerProvided</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2761"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>                <a href="arrayfuncs.c.html#LN2748"><span class='Ref_to_Parameter'>lowerIndx</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2761"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2764"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2761"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="arrayfuncs.c.html#LN2749"><span class='Ref_to_Parameter'>upperProvided</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2761"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>                <a href="arrayfuncs.c.html#LN2747"><span class='Ref_to_Parameter'>upperIndx</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2761"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2763"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2761"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN2764"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2761"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2748"><span class='Ref_to_Parameter'>lowerIndx</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2761"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>&GT; </span><a href="arrayfuncs.c.html#LN2747"><span class='Ref_to_Parameter'>upperIndx</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2761"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ARRAY_SUBSCRIPT_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"upper bound cannot be less than lower bound"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2748"><span class='Ref_to_Parameter'>lowerIndx</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2761"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN2764"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2761"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>|| 
</span>                <a href="arrayfuncs.c.html#LN2747"><span class='Ref_to_Parameter'>upperIndx</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2761"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>&GT;= </span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2763"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2761"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN2764"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2761"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span> 
                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ARRAY_SUBSCRIPT_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"array subscript out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* fill any missing subscript positions with full array range */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN2761"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN2762"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN2761"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="arrayfuncs.c.html#LN2748"><span class='Ref_to_Parameter'>lowerIndx</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2761"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2764"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2761"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>            <a href="arrayfuncs.c.html#LN2747"><span class='Ref_to_Parameter'>upperIndx</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2761"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2763"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2761"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN2764"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2761"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2748"><span class='Ref_to_Parameter'>lowerIndx</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2761"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>&GT; </span><a href="arrayfuncs.c.html#LN2747"><span class='Ref_to_Parameter'>upperIndx</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN2761"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ARRAY_SUBSCRIPT_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"upper bound cannot be less than lower bound"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Do this mainly to check for overflow */ 
</span>    <a href="arrayfuncs.c.html#LN2767"><span class='Ref_To_Local'>nitems</span></a> <span class='Operator'>= </span><a href="arrayutils.c.html#LN73"><span class='Ref_to_Func'>ArrayGetNItems</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2762"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2763"><span class='Ref_To_Local'>dim</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Make sure source array has enough entries.  Note we ignore the shape of 
     * the source array and just read entries serially. 
     */ 
</span>    <a href="arrayutils.c.html#LN118"><span class='Ref_to_Func'>mda_get_range</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2762"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2765"><span class='Ref_To_Local'>span</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2748"><span class='Ref_to_Parameter'>lowerIndx</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2747"><span class='Ref_to_Parameter'>upperIndx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN2768"><span class='Ref_To_Local'>nsrcitems</span></a> <span class='Operator'>= </span><a href="arrayutils.c.html#LN73"><span class='Ref_to_Func'>ArrayGetNItems</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2762"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2765"><span class='Ref_To_Local'>span</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2768"><span class='Ref_To_Local'>nsrcitems</span></a> <span class='Operator'>&GT; </span><a href="arrayutils.c.html#LN73"><span class='Ref_to_Func'>ArrayGetNItems</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2759"><span class='Ref_To_Local'>srcArray</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2759"><span class='Ref_To_Local'>srcArray</span></a><span class='Parentheses'>)))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ARRAY_SUBSCRIPT_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"source array too small"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Compute space occupied by new entries, space occupied by replaced 
     * entries, and required space for new array. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2766"><span class='Ref_To_Local'>newhasnulls</span></a><span class='Parentheses'>) 
</span>        <a href="arrayfuncs.c.html#LN2773"><span class='Ref_To_Local'>overheadlen</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN292"><span class='Ref_to_Macro'>ARR_OVERHEAD_WITHNULLS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2762"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2767"><span class='Ref_To_Local'>nitems</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="arrayfuncs.c.html#LN2773"><span class='Ref_To_Local'>overheadlen</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN290"><span class='Ref_to_Macro'>ARR_OVERHEAD_NONULLS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2762"><span class='Ref_To_Local'>ndim</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN2772"><span class='Ref_To_Local'>newitemsize</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN120"><span class='Ref_to_Proto'>array_nelems_size</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN302"><span class='Ref_to_Macro'>ARR_DATA_PTR</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2759"><span class='Ref_To_Local'>srcArray</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                    <a href="../../../include/utils/array.h.html#LN280"><span class='Ref_to_Macro'>ARR_NULLBITMAP</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2759"><span class='Ref_To_Local'>srcArray</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2768"><span class='Ref_To_Local'>nsrcitems</span></a><span class='Delimiter'>, 
</span>                                    <a href="arrayfuncs.c.html#LN2754"><span class='Ref_to_Parameter'>elmlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2755"><span class='Ref_to_Parameter'>elmbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2756"><span class='Ref_to_Parameter'>elmalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN2774"><span class='Ref_To_Local'>oldoverheadlen</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN296"><span class='Ref_to_Macro'>ARR_DATA_OFFSET</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2758"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN2769"><span class='Ref_To_Local'>olddatasize</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN269"><span class='Ref_to_Macro'>ARR_SIZE</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2758"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="arrayfuncs.c.html#LN2774"><span class='Ref_To_Local'>oldoverheadlen</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2762"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * here we do not need to cope with extension of the array; it would 
         * be a lot more complicated if we had to do so... 
         */ 
</span>        <a href="arrayfuncs.c.html#LN2771"><span class='Ref_To_Local'>olditemsize</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN125"><span class='Ref_to_Proto'>array_slice_size</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN302"><span class='Ref_to_Macro'>ARR_DATA_PTR</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2758"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                       <a href="../../../include/utils/array.h.html#LN280"><span class='Ref_to_Macro'>ARR_NULLBITMAP</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2758"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                       <a href="arrayfuncs.c.html#LN2762"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2763"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2764"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>, 
</span>                                       <a href="arrayfuncs.c.html#LN2748"><span class='Ref_to_Parameter'>lowerIndx</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2747"><span class='Ref_to_Parameter'>upperIndx</span></a><span class='Delimiter'>, 
</span>                                       <a href="arrayfuncs.c.html#LN2754"><span class='Ref_to_Parameter'>elmlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2755"><span class='Ref_to_Parameter'>elmbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2756"><span class='Ref_to_Parameter'>elmalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN2777"><span class='Ref_To_Local'>lenbefore</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2778"><span class='Ref_To_Local'>lenafter</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>        <a href="arrayfuncs.c.html#LN2779"><span class='Ref_To_Local'>itemsbefore</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2780"><span class='Ref_To_Local'>itemsafter</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2781"><span class='Ref_To_Local'>nolditems</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * here we must allow for possibility of slice larger than orig array 
         * and/or not adjacent to orig array subscripts 
         */ 
</span><a name="LN2967"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>oldlb</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN276"><span class='Ref_to_Macro'>ARR_LBOUND</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2758"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span><a name="LN2968"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>oldub</span> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2967"><span class='Ref_To_Local'>oldlb</span></a> <span class='Operator'>+ </span><a href="../../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2758"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span><a name="LN2969"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>slicelb</span> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2967"><span class='Ref_To_Local'>oldlb</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2748"><span class='Ref_to_Parameter'>lowerIndx</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2970"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>sliceub</span> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2968"><span class='Ref_To_Local'>oldub</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2747"><span class='Ref_to_Parameter'>upperIndx</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2971"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>oldarraydata</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN302"><span class='Ref_to_Macro'>ARR_DATA_PTR</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2758"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2972"></a>        <a href="../../../include/c.h.html#LN274"><span class='Ref_to_Typedef'>bits8</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>oldarraybitmap</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN280"><span class='Ref_to_Macro'>ARR_NULLBITMAP</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2758"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* count/size of old array entries that will go before the slice */ 
</span>        <a href="arrayfuncs.c.html#LN2779"><span class='Ref_To_Local'>itemsbefore</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2969"><span class='Ref_To_Local'>slicelb</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2968"><span class='Ref_To_Local'>oldub</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="arrayfuncs.c.html#LN2967"><span class='Ref_To_Local'>oldlb</span></a><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN2777"><span class='Ref_To_Local'>lenbefore</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN120"><span class='Ref_to_Proto'>array_nelems_size</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2971"><span class='Ref_To_Local'>oldarraydata</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2972"><span class='Ref_To_Local'>oldarraybitmap</span></a><span class='Delimiter'>, 
</span>                                      <a href="arrayfuncs.c.html#LN2779"><span class='Ref_To_Local'>itemsbefore</span></a><span class='Delimiter'>, 
</span>                                      <a href="arrayfuncs.c.html#LN2754"><span class='Ref_to_Parameter'>elmlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2755"><span class='Ref_to_Parameter'>elmbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2756"><span class='Ref_to_Parameter'>elmalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* count/size of old array entries that will be replaced by slice */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2969"><span class='Ref_To_Local'>slicelb</span></a> <span class='Operator'>&GT; </span><a href="arrayfuncs.c.html#LN2970"><span class='Ref_To_Local'>sliceub</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="arrayfuncs.c.html#LN2781"><span class='Ref_To_Local'>nolditems</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN2771"><span class='Ref_To_Local'>olditemsize</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="arrayfuncs.c.html#LN2781"><span class='Ref_To_Local'>nolditems</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2970"><span class='Ref_To_Local'>sliceub</span></a> <span class='Operator'>- </span><a href="arrayfuncs.c.html#LN2969"><span class='Ref_To_Local'>slicelb</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN2771"><span class='Ref_To_Local'>olditemsize</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN120"><span class='Ref_to_Proto'>array_nelems_size</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2971"><span class='Ref_To_Local'>oldarraydata</span></a> <span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN2777"><span class='Ref_To_Local'>lenbefore</span></a><span class='Delimiter'>, 
</span>                                            <a href="arrayfuncs.c.html#LN2779"><span class='Ref_To_Local'>itemsbefore</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2972"><span class='Ref_To_Local'>oldarraybitmap</span></a><span class='Delimiter'>, 
</span>                                            <a href="arrayfuncs.c.html#LN2781"><span class='Ref_To_Local'>nolditems</span></a><span class='Delimiter'>, 
</span>                                            <a href="arrayfuncs.c.html#LN2754"><span class='Ref_to_Parameter'>elmlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2755"><span class='Ref_to_Parameter'>elmbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2756"><span class='Ref_to_Parameter'>elmalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* count/size of old array entries that will go after the slice */ 
</span>        <a href="arrayfuncs.c.html#LN2780"><span class='Ref_To_Local'>itemsafter</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2968"><span class='Ref_To_Local'>oldub</span></a> <span class='Operator'>+ </span><span class='Number'>1</span> <span class='Operator'>- </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2970"><span class='Ref_To_Local'>sliceub</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2967"><span class='Ref_To_Local'>oldlb</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN2778"><span class='Ref_To_Local'>lenafter</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2769"><span class='Ref_To_Local'>olddatasize</span></a> <span class='Operator'>- </span><a href="arrayfuncs.c.html#LN2777"><span class='Ref_To_Local'>lenbefore</span></a> <span class='Operator'>- </span><a href="arrayfuncs.c.html#LN2771"><span class='Ref_To_Local'>olditemsize</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <a href="arrayfuncs.c.html#LN2770"><span class='Ref_To_Local'>newsize</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2773"><span class='Ref_To_Local'>overheadlen</span></a> <span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN2769"><span class='Ref_To_Local'>olddatasize</span></a> <span class='Operator'>- </span><a href="arrayfuncs.c.html#LN2771"><span class='Ref_To_Local'>olditemsize</span></a> <span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN2772"><span class='Ref_To_Local'>newitemsize</span></a><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN2760"><span class='Ref_To_Local'>newarray</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2770"><span class='Ref_To_Local'>newsize</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2760"><span class='Ref_To_Local'>newarray</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2770"><span class='Ref_To_Local'>newsize</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN2760"><span class='Ref_To_Local'>newarray</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN78"><span class='Ref_to_Member'>ndim</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2762"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN2760"><span class='Ref_To_Local'>newarray</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN79"><span class='Ref_to_Member'>dataoffset</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN2766"><span class='Ref_To_Local'>newhasnulls</span></a> <span class='Operator'>? </span><a href="arrayfuncs.c.html#LN2773"><span class='Ref_To_Local'>overheadlen</span></a> <span class='Operator'>: </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN2760"><span class='Ref_To_Local'>newarray</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN80"><span class='Ref_to_Member'>elemtype</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN272"><span class='Ref_to_Macro'>ARR_ELEMTYPE</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2758"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2760"><span class='Ref_To_Local'>newarray</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2763"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2762"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN276"><span class='Ref_to_Macro'>ARR_LBOUND</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2760"><span class='Ref_To_Local'>newarray</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2764"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2762"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2762"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * here we do not need to cope with extension of the array; it would 
         * be a lot more complicated if we had to do so... 
         */ 
</span>        <a href="arrayfuncs.c.html#LN134"><span class='Ref_to_Proto'>array_insert_slice</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2760"><span class='Ref_To_Local'>newarray</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2758"><span class='Ref_To_Local'>array</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2759"><span class='Ref_To_Local'>srcArray</span></a><span class='Delimiter'>, 
</span>                           <a href="arrayfuncs.c.html#LN2762"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2763"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2764"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>, 
</span>                           <a href="arrayfuncs.c.html#LN2748"><span class='Ref_to_Parameter'>lowerIndx</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2747"><span class='Ref_to_Parameter'>upperIndx</span></a><span class='Delimiter'>, 
</span>                           <a href="arrayfuncs.c.html#LN2754"><span class='Ref_to_Parameter'>elmlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2755"><span class='Ref_to_Parameter'>elmbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2756"><span class='Ref_to_Parameter'>elmalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* fill in data */ 
</span>        memcpy<span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="arrayfuncs.c.html#LN2760"><span class='Ref_To_Local'>newarray</span></a> <span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN2773"><span class='Ref_To_Local'>overheadlen</span></a><span class='Delimiter'>, 
</span>               <span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="arrayfuncs.c.html#LN2758"><span class='Ref_To_Local'>array</span></a> <span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN2774"><span class='Ref_To_Local'>oldoverheadlen</span></a><span class='Delimiter'>, 
</span>               <a href="arrayfuncs.c.html#LN2777"><span class='Ref_To_Local'>lenbefore</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="arrayfuncs.c.html#LN2760"><span class='Ref_To_Local'>newarray</span></a> <span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN2773"><span class='Ref_To_Local'>overheadlen</span></a> <span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN2777"><span class='Ref_To_Local'>lenbefore</span></a><span class='Delimiter'>, 
</span>               <a href="../../../include/utils/array.h.html#LN302"><span class='Ref_to_Macro'>ARR_DATA_PTR</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2759"><span class='Ref_To_Local'>srcArray</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>               <a href="arrayfuncs.c.html#LN2772"><span class='Ref_To_Local'>newitemsize</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="arrayfuncs.c.html#LN2760"><span class='Ref_To_Local'>newarray</span></a> <span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN2773"><span class='Ref_To_Local'>overheadlen</span></a> <span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN2777"><span class='Ref_To_Local'>lenbefore</span></a> <span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN2772"><span class='Ref_To_Local'>newitemsize</span></a><span class='Delimiter'>, 
</span>               <span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="arrayfuncs.c.html#LN2758"><span class='Ref_To_Local'>array</span></a> <span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN2774"><span class='Ref_To_Local'>oldoverheadlen</span></a> <span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN2777"><span class='Ref_To_Local'>lenbefore</span></a> <span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN2771"><span class='Ref_To_Local'>olditemsize</span></a><span class='Delimiter'>, 
</span>               <a href="arrayfuncs.c.html#LN2778"><span class='Ref_To_Local'>lenafter</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* fill in nulls bitmap if needed */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2766"><span class='Ref_To_Local'>newhasnulls</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN3034"></a>            <a href="../../../include/c.h.html#LN274"><span class='Ref_to_Typedef'>bits8</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>newnullbitmap</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN280"><span class='Ref_to_Macro'>ARR_NULLBITMAP</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2760"><span class='Ref_To_Local'>newarray</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3035"></a>            <a href="../../../include/c.h.html#LN274"><span class='Ref_to_Typedef'>bits8</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>oldnullbitmap</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN280"><span class='Ref_to_Macro'>ARR_NULLBITMAP</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2758"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Zero the bitmap to handle marking inserted positions null */ 
</span>            <a href="../../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3034"><span class='Ref_To_Local'>newnullbitmap</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2767"><span class='Ref_To_Local'>nitems</span></a> <span class='Operator'>+ </span><span class='Number'>7</span><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Number'>8</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/utils/array.h.html#LN365"><span class='Ref_to_Proto'>array_bitmap_copy</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3034"><span class='Ref_To_Local'>newnullbitmap</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2775"><span class='Ref_To_Local'>addedbefore</span></a><span class='Delimiter'>, 
</span>                              <a href="arrayfuncs.c.html#LN3035"><span class='Ref_To_Local'>oldnullbitmap</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                              <a href="arrayfuncs.c.html#LN2779"><span class='Ref_To_Local'>itemsbefore</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/utils/array.h.html#LN365"><span class='Ref_to_Proto'>array_bitmap_copy</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3034"><span class='Ref_To_Local'>newnullbitmap</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2748"><span class='Ref_to_Parameter'>lowerIndx</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>- </span><a href="arrayfuncs.c.html#LN2764"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                              <a href="../../../include/utils/array.h.html#LN280"><span class='Ref_to_Macro'>ARR_NULLBITMAP</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2759"><span class='Ref_To_Local'>srcArray</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                              <a href="arrayfuncs.c.html#LN2768"><span class='Ref_To_Local'>nsrcitems</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/utils/array.h.html#LN365"><span class='Ref_to_Proto'>array_bitmap_copy</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3034"><span class='Ref_To_Local'>newnullbitmap</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2775"><span class='Ref_To_Local'>addedbefore</span></a> <span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN2779"><span class='Ref_To_Local'>itemsbefore</span></a> <span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN2781"><span class='Ref_To_Local'>nolditems</span></a><span class='Delimiter'>, 
</span>                              <a href="arrayfuncs.c.html#LN3035"><span class='Ref_To_Local'>oldnullbitmap</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN2779"><span class='Ref_To_Local'>itemsbefore</span></a> <span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN2781"><span class='Ref_To_Local'>nolditems</span></a><span class='Delimiter'>, 
</span>                              <a href="arrayfuncs.c.html#LN2780"><span class='Ref_To_Local'>itemsafter</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Control'>return</span> <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN2760"><span class='Ref_To_Local'>newarray</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end array_set_slice &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * array_ref : backwards compatibility wrapper for array_get_element 
 * 
 * This only works for detoasted/flattened varlena arrays, since the array 
 * argument is declared as "ArrayType *".  However there's enough code like 
 * that to justify preserving this API. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3062"></a><span class='Declare_Function'>array_ref</span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>array</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>nSubscripts</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>indx</span><span class='Delimiter'>, 
</span><a name="LN3063"></a>          <span class='Keyword'>int </span><span class='Declare_Parameter'>arraytyplen</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>elmlen</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>elmbyval</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>elmalign</span><span class='Delimiter'>, 
</span><a name="LN3064"></a>          <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>isNull</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="../../../include/utils/array.h.html#LN339"><span class='Ref_to_Proto'>array_get_element</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3062"><span class='Ref_to_Parameter'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3062"><span class='Ref_to_Parameter'>nSubscripts</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3062"><span class='Ref_to_Parameter'>indx</span></a><span class='Delimiter'>, 
</span>                             <a href="arrayfuncs.c.html#LN3063"><span class='Ref_to_Parameter'>arraytyplen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3063"><span class='Ref_to_Parameter'>elmlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3063"><span class='Ref_to_Parameter'>elmbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3063"><span class='Ref_to_Parameter'>elmalign</span></a><span class='Delimiter'>, 
</span>                             <a href="arrayfuncs.c.html#LN3064"><span class='Ref_to_Parameter'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * array_set : backwards compatibility wrapper for array_set_element 
 * 
 * This only works for detoasted/flattened varlena arrays, since the array 
 * argument and result are declared as "ArrayType *".  However there's enough 
 * code like that to justify preserving this API. 
 */ 
</span><a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>* 
</span><a name="LN3079"></a><span class='Declare_Function'>array_set</span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>array</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>nSubscripts</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>indx</span><span class='Delimiter'>, 
</span><a name="LN3080"></a>          <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>dataValue</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isNull</span><span class='Delimiter'>, 
</span><a name="LN3081"></a>          <span class='Keyword'>int </span><span class='Declare_Parameter'>arraytyplen</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>elmlen</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>elmbyval</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>elmalign</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="../../../include/utils/array.h.html#LN241"><span class='Ref_to_Macro'>DatumGetArrayTypeP</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN342"><span class='Ref_to_Proto'>array_set_element</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3079"><span class='Ref_to_Parameter'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                <a href="arrayfuncs.c.html#LN3079"><span class='Ref_to_Parameter'>nSubscripts</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3079"><span class='Ref_to_Parameter'>indx</span></a><span class='Delimiter'>, 
</span>                                                <a href="arrayfuncs.c.html#LN3080"><span class='Ref_to_Parameter'>dataValue</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3080"><span class='Ref_to_Parameter'>isNull</span></a><span class='Delimiter'>, 
</span>                                                <a href="arrayfuncs.c.html#LN3081"><span class='Ref_to_Parameter'>arraytyplen</span></a><span class='Delimiter'>, 
</span>                                                <a href="arrayfuncs.c.html#LN3081"><span class='Ref_to_Parameter'>elmlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3081"><span class='Ref_to_Parameter'>elmbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3081"><span class='Ref_to_Parameter'>elmalign</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * array_map() 
 * 
 * Map an array through an arbitrary function.  Return a new array with 
 * same dimensions and each source element transformed by fn().  Each 
 * source element is passed as the first argument to fn(); additional 
 * arguments to be passed to fn() can be specified by the caller. 
 * The output array can have a different element type than the input. 
 * 
 * Parameters are: 
 * * fcinfo: a function-call data structure pre-constructed by the caller 
 *   to be ready to call the desired function, with everything except the 
 *   first argument position filled in.  In particular, flinfo identifies 
 *   the function fn(), and if nargs &GT; 1 then argument positions after the 
 *   first must be preset to the additional values to be passed.  The 
 *   first argument position initially holds the input array value. 
 * * retType: OID of element type of output array.  This must be the same as, 
 *   or binary-compatible with, the result type of fn(). 
 * * amstate: workspace for array_map.  Must be zeroed by caller before 
 *   first call, and not touched after that. 
 * 
 * It is legitimate to pass a freshly-zeroed ArrayMapState on each call, 
 * but better performance can be had if the state can be preserved across 
 * a series of calls. 
 * 
 * NB: caller must assure that input array is not NULL.  NULL elements in 
 * the array are OK however. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3119"></a><span class='Declare_Function'>array_map</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN37"><span class='Ref_to_Typedef'>FunctionCallInfo</span></a> <span class='Declare_Parameter'>fcinfo</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>retType</span><span class='Delimiter'>, </span><a href="../../../include/utils/array.h.html#LN231"><span class='Ref_to_Struct'>ArrayMapState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>amstate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3121"></a>    <a href="../../../include/utils/array.h.html#LN157"><span class='Ref_to_Union'>AnyArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Local'>v</span><span class='Delimiter'>; 
</span><a name="LN3122"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN3123"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>values</span><span class='Delimiter'>; 
</span><a name="LN3124"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>nulls</span><span class='Delimiter'>; 
</span><a name="LN3125"></a>    <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Local'>dim</span><span class='Delimiter'>; 
</span><a name="LN3126"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ndim</span><span class='Delimiter'>; 
</span><a name="LN3127"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nitems</span><span class='Delimiter'>; 
</span><a name="LN3128"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN3129"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>nbytes</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN3130"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>dataoffset</span><span class='Delimiter'>; 
</span><a name="LN3131"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>hasnulls</span><span class='Delimiter'>; 
</span><a name="LN3132"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>inpType</span><span class='Delimiter'>; 
</span><a name="LN3133"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>inp_typlen</span><span class='Delimiter'>; 
</span><a name="LN3134"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>inp_typbyval</span><span class='Delimiter'>; 
</span><a name="LN3135"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>inp_typalign</span><span class='Delimiter'>; 
</span><a name="LN3136"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>typlen</span><span class='Delimiter'>; 
</span><a name="LN3137"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>typbyval</span><span class='Delimiter'>; 
</span><a name="LN3138"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>typalign</span><span class='Delimiter'>; 
</span><a name="LN3139"></a>    <a href="../../../include/utils/arrayaccess.h.html#LN32"><span class='Ref_to_Struct'>array_iter</span></a>  <span class='Declare_Local'>iter</span><span class='Delimiter'>; 
</span><a name="LN3140"></a>    <a href="../../../include/utils/array.h.html#LN216"><span class='Ref_to_Struct'>ArrayMetaState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>inp_extra</span><span class='Delimiter'>; 
</span><a name="LN3141"></a>    <a href="../../../include/utils/array.h.html#LN216"><span class='Ref_to_Struct'>ArrayMetaState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ret_extra</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get input array */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3119"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN83"><span class='Ref_to_Member'>nargs</span></a> <span class='Operator'>&LT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid nargs: %d"</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3119"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN83"><span class='Ref_to_Member'>nargs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"null input array"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN3121"><span class='Ref_To_Local'>v</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN254"><span class='Ref_to_Macro'>PG_GETARG_ANY_ARRAY</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN3132"><span class='Ref_To_Local'>inpType</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN314"><span class='Ref_to_Macro'>AARR_ELEMTYPE</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3121"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN3126"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN308"><span class='Ref_to_Macro'>AARR_NDIM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3121"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN3125"><span class='Ref_To_Local'>dim</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN316"><span class='Ref_to_Macro'>AARR_DIMS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3121"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN3127"><span class='Ref_To_Local'>nitems</span></a> <span class='Operator'>= </span><a href="arrayutils.c.html#LN73"><span class='Ref_to_Func'>ArrayGetNItems</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3126"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3125"><span class='Ref_To_Local'>dim</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check for empty array */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3127"><span class='Ref_To_Local'>nitems</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Return empty array */ 
</span>        <a href="../../../include/utils/array.h.html#LN245"><span class='Ref_to_Macro'>PG_RETURN_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN378"><span class='Ref_to_Proto'>construct_empty_array</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3119"><span class='Ref_to_Parameter'>retType</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We arrange to look up info about input and return element types only 
     * once per series of calls, assuming the element type doesn't change 
     * underneath us. 
     */ 
</span>    <a href="arrayfuncs.c.html#LN3140"><span class='Ref_To_Local'>inp_extra</span></a> <span class='Operator'>= &</span><a href="arrayfuncs.c.html#LN3119"><span class='Ref_to_Parameter'>amstate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN233"><span class='Ref_to_Member'>inp_extra</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN3141"><span class='Ref_To_Local'>ret_extra</span></a> <span class='Operator'>= &</span><a href="arrayfuncs.c.html#LN3119"><span class='Ref_to_Parameter'>amstate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN234"><span class='Ref_to_Member'>ret_extra</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3140"><span class='Ref_To_Local'>inp_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN218"><span class='Ref_to_Member'>element_type</span></a> <span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN3132"><span class='Ref_To_Local'>inpType</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/utils/lsyscache.h.html#LN136"><span class='Ref_to_Proto'>get_typlenbyvalalign</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3132"><span class='Ref_To_Local'>inpType</span></a><span class='Delimiter'>, 
</span>                             <span class='Operator'>&</span><a href="arrayfuncs.c.html#LN3140"><span class='Ref_To_Local'>inp_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN219"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>, 
</span>                             <span class='Operator'>&</span><a href="arrayfuncs.c.html#LN3140"><span class='Ref_To_Local'>inp_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN220"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>, 
</span>                             <span class='Operator'>&</span><a href="arrayfuncs.c.html#LN3140"><span class='Ref_To_Local'>inp_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN221"><span class='Ref_to_Member'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN3140"><span class='Ref_To_Local'>inp_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN218"><span class='Ref_to_Member'>element_type</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN3132"><span class='Ref_To_Local'>inpType</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="arrayfuncs.c.html#LN3133"><span class='Ref_To_Local'>inp_typlen</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN3140"><span class='Ref_To_Local'>inp_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN219"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN3134"><span class='Ref_To_Local'>inp_typbyval</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN3140"><span class='Ref_To_Local'>inp_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN220"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN3135"><span class='Ref_To_Local'>inp_typalign</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN3140"><span class='Ref_To_Local'>inp_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN221"><span class='Ref_to_Member'>typalign</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3141"><span class='Ref_To_Local'>ret_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN218"><span class='Ref_to_Member'>element_type</span></a> <span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN3119"><span class='Ref_to_Parameter'>retType</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/utils/lsyscache.h.html#LN136"><span class='Ref_to_Proto'>get_typlenbyvalalign</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3119"><span class='Ref_to_Parameter'>retType</span></a><span class='Delimiter'>, 
</span>                             <span class='Operator'>&</span><a href="arrayfuncs.c.html#LN3141"><span class='Ref_To_Local'>ret_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN219"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>, 
</span>                             <span class='Operator'>&</span><a href="arrayfuncs.c.html#LN3141"><span class='Ref_To_Local'>ret_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN220"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>, 
</span>                             <span class='Operator'>&</span><a href="arrayfuncs.c.html#LN3141"><span class='Ref_To_Local'>ret_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN221"><span class='Ref_to_Member'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN3141"><span class='Ref_To_Local'>ret_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN218"><span class='Ref_to_Member'>element_type</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN3119"><span class='Ref_to_Parameter'>retType</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="arrayfuncs.c.html#LN3136"><span class='Ref_To_Local'>typlen</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN3141"><span class='Ref_To_Local'>ret_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN219"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN3137"><span class='Ref_To_Local'>typbyval</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN3141"><span class='Ref_To_Local'>ret_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN220"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN3138"><span class='Ref_To_Local'>typalign</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN3141"><span class='Ref_To_Local'>ret_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN221"><span class='Ref_to_Member'>typalign</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Allocate temporary arrays for new values */ 
</span>    <a href="arrayfuncs.c.html#LN3123"><span class='Ref_To_Local'>values</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3127"><span class='Ref_To_Local'>nitems</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN3124"><span class='Ref_To_Local'>nulls</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3127"><span class='Ref_To_Local'>nitems</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Loop over source data */ 
</span>    <a href="../../../include/utils/arrayaccess.h.html#LN47"><span class='Ref_to_Func'>array_iter_setup</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN3139"><span class='Ref_To_Local'>iter</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3121"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN3131"><span class='Ref_To_Local'>hasnulls</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3128"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN3128"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN3127"><span class='Ref_To_Local'>nitems</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN3128"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3204"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>callit</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Get source element, checking for NULL */ 
</span>        <a href="arrayfuncs.c.html#LN3119"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN84"><span class='Ref_to_Member'>arg</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/utils/arrayaccess.h.html#LN79"><span class='Ref_to_Func'>array_iter_next</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN3139"><span class='Ref_To_Local'>iter</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN3119"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN85"><span class='Ref_to_Member'>argnull</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><a href="arrayfuncs.c.html#LN3128"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, 
</span>                                     <a href="arrayfuncs.c.html#LN3133"><span class='Ref_To_Local'>inp_typlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3134"><span class='Ref_To_Local'>inp_typbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3135"><span class='Ref_To_Local'>inp_typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Apply the given function to source elt and extra args. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3119"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN78"><span class='Ref_to_Member'>flinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN60"><span class='Ref_to_Member'>fn_strict</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN3215"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>j</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3215"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN3215"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN3119"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN83"><span class='Ref_to_Member'>nargs</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN3215"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3119"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN85"><span class='Ref_to_Member'>argnull</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN3215"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="arrayfuncs.c.html#LN3204"><span class='Ref_To_Local'>callit</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3204"><span class='Ref_To_Local'>callit</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="arrayfuncs.c.html#LN3119"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN82"><span class='Ref_to_Member'>isnull</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN3123"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN3128"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN136"><span class='Ref_to_Macro'>FunctionCallInvoke</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3119"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="arrayfuncs.c.html#LN3119"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN82"><span class='Ref_to_Member'>isnull</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <a href="arrayfuncs.c.html#LN3124"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN3128"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="arrayfuncs.c.html#LN3119"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN82"><span class='Ref_to_Member'>isnull</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3119"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN82"><span class='Ref_to_Member'>isnull</span></a><span class='Parentheses'>) 
</span>            <a href="arrayfuncs.c.html#LN3131"><span class='Ref_To_Local'>hasnulls</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Ensure data is not toasted */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3136"><span class='Ref_To_Local'>typlen</span></a> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                <a href="arrayfuncs.c.html#LN3123"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN3128"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN204"><span class='Ref_to_Macro'>PG_DETOAST_DATUM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3123"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN3128"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Update total result size */ 
</span>            <a href="arrayfuncs.c.html#LN3129"><span class='Ref_To_Local'>nbytes</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN159"><span class='Ref_to_Macro'>att_addlength_datum</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3129"><span class='Ref_To_Local'>nbytes</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3136"><span class='Ref_To_Local'>typlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3123"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN3128"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN3129"><span class='Ref_To_Local'>nbytes</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN143"><span class='Ref_to_Macro'>att_align_nominal</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3129"><span class='Ref_To_Local'>nbytes</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3138"><span class='Ref_To_Local'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* check for overflow of total request */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/memutils.h.html#LN41"><span class='Ref_to_Macro'>AllocSizeIsValid</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3129"><span class='Ref_To_Local'>nbytes</span></a><span class='Parentheses'>))</span> 
                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_PROGRAM_LIMIT_EXCEEDED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"array size exceeds the maximum allowed (%d)"</span><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="../../../common/psprintf.c.html#LN27"><span class='Ref_to_Const'>MaxAllocSize</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;nitems;i++ &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Allocate and initialize the result array */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3131"><span class='Ref_To_Local'>hasnulls</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="arrayfuncs.c.html#LN3130"><span class='Ref_To_Local'>dataoffset</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN292"><span class='Ref_to_Macro'>ARR_OVERHEAD_WITHNULLS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3126"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3127"><span class='Ref_To_Local'>nitems</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN3129"><span class='Ref_To_Local'>nbytes</span></a> <span class='Operator'>+= </span><a href="arrayfuncs.c.html#LN3130"><span class='Ref_To_Local'>dataoffset</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="arrayfuncs.c.html#LN3130"><span class='Ref_To_Local'>dataoffset</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* marker for no null bitmap */ 
</span>        <a href="arrayfuncs.c.html#LN3129"><span class='Ref_To_Local'>nbytes</span></a> <span class='Operator'>+= </span><a href="../../../include/utils/array.h.html#LN290"><span class='Ref_to_Macro'>ARR_OVERHEAD_NONULLS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3126"><span class='Ref_To_Local'>ndim</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="arrayfuncs.c.html#LN3122"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3129"><span class='Ref_To_Local'>nbytes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3122"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3129"><span class='Ref_To_Local'>nbytes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN3122"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN78"><span class='Ref_to_Member'>ndim</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN3126"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN3122"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN79"><span class='Ref_to_Member'>dataoffset</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN3130"><span class='Ref_To_Local'>dataoffset</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN3122"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN80"><span class='Ref_to_Member'>elemtype</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN3119"><span class='Ref_to_Parameter'>retType</span></a><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3122"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/utils/array.h.html#LN316"><span class='Ref_to_Macro'>AARR_DIMS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3121"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3126"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN276"><span class='Ref_to_Macro'>ARR_LBOUND</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3122"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/utils/array.h.html#LN318"><span class='Ref_to_Macro'>AARR_LBOUND</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3121"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3126"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Note: do not risk trying to pfree the results of the called function 
     */ 
</span>    <a href="../../../include/utils/array.h.html#LN330"><span class='Ref_to_Proto'>CopyArrayEls</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3122"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                 <a href="arrayfuncs.c.html#LN3123"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3124"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3127"><span class='Ref_To_Local'>nitems</span></a><span class='Delimiter'>, 
</span>                 <a href="arrayfuncs.c.html#LN3136"><span class='Ref_To_Local'>typlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3137"><span class='Ref_To_Local'>typbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3138"><span class='Ref_To_Local'>typalign</span></a><span class='Delimiter'>, 
</span>                 <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3123"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3124"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/array.h.html#LN245"><span class='Ref_to_Macro'>PG_RETURN_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3122"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end array_map &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * construct_array  --- simple method for constructing an array object 
 * 
 * elems: array of Datum items to become the array contents 
 *        (NULL element values are not supported). 
 * nelems: number of items 
 * elmtype, elmlen, elmbyval, elmalign: info for the datatype of the items 
 * 
 * A palloc'd 1-D array object is constructed and returned.  Note that 
 * elem values will be copied into the object even if pass-by-ref type. 
 * 
 * NOTE: it would be cleaner to look up the elmlen/elmbval/elmalign info 
 * from the system catalogs, given the elmtype.  However, the caller is 
 * in a better position to cache this info across multiple uses, or even 
 * to hard-wire values if the element type is hard-wired. 
 */ 
</span><a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>* 
</span><a name="LN3305"></a><span class='Declare_Function'>construct_array</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>elems</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>nelems</span><span class='Delimiter'>, 
</span><a name="LN3306"></a>                <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>elmtype</span><span class='Delimiter'>, 
</span><a name="LN3307"></a>                <span class='Keyword'>int </span><span class='Declare_Parameter'>elmlen</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>elmbyval</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>elmalign</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3309"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>dims</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN3310"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>lbs</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
    <a href="arrayfuncs.c.html#LN3309"><span class='Ref_To_Local'>dims</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="arrayfuncs.c.html#LN3305"><span class='Ref_to_Parameter'>nelems</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN3310"><span class='Ref_To_Local'>lbs</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../../include/utils/array.h.html#LN372"><span class='Ref_to_Proto'>construct_md_array</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3305"><span class='Ref_to_Parameter'>elems</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3309"><span class='Ref_To_Local'>dims</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3310"><span class='Ref_To_Local'>lbs</span></a><span class='Delimiter'>, 
</span>                              <a href="arrayfuncs.c.html#LN3306"><span class='Ref_to_Parameter'>elmtype</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3307"><span class='Ref_to_Parameter'>elmlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3307"><span class='Ref_to_Parameter'>elmbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3307"><span class='Ref_to_Parameter'>elmalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * construct_md_array   --- simple method for constructing an array object 
 *                          with arbitrary dimensions and possible NULLs 
 * 
 * elems: array of Datum items to become the array contents 
 * nulls: array of is-null flags (can be NULL if no nulls) 
 * ndims: number of dimensions 
 * dims: integer array with size of each dimension 
 * lbs: integer array with lower bound of each dimension 
 * elmtype, elmlen, elmbyval, elmalign: info for the datatype of the items 
 * 
 * A palloc'd ndims-D array object is constructed and returned.  Note that 
 * elem values will be copied into the object even if pass-by-ref type. 
 * 
 * NOTE: it would be cleaner to look up the elmlen/elmbval/elmalign info 
 * from the system catalogs, given the elmtype.  However, the caller is 
 * in a better position to cache this info across multiple uses, or even 
 * to hard-wire values if the element type is hard-wired. 
 */ 
</span><a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>* 
</span><a name="LN3339"></a><span class='Declare_Function'>construct_md_array</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>elems</span><span class='Delimiter'>, 
</span><a name="LN3340"></a>                   <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>nulls</span><span class='Delimiter'>, 
</span><a name="LN3341"></a>                   <span class='Keyword'>int </span><span class='Declare_Parameter'>ndims</span><span class='Delimiter'>, 
</span><a name="LN3342"></a>                   <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>dims</span><span class='Delimiter'>, 
</span><a name="LN3343"></a>                   <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>lbs</span><span class='Delimiter'>, 
</span><a name="LN3344"></a>                   <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>elmtype</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>elmlen</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>elmbyval</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>elmalign</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3346"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN3347"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>hasnulls</span><span class='Delimiter'>; 
</span><a name="LN3348"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>nbytes</span><span class='Delimiter'>; 
</span><a name="LN3349"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>dataoffset</span><span class='Delimiter'>; 
</span><a name="LN3350"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN3351"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nelems</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3341"><span class='Ref_to_Parameter'>ndims</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span>              <span class='Comment_Single_Line'>/* we do allow zero-dimension arrays */ 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid number of dimensions: %d"</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3341"><span class='Ref_to_Parameter'>ndims</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3341"><span class='Ref_to_Parameter'>ndims</span></a> <span class='Operator'>&GT; </span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_PROGRAM_LIMIT_EXCEEDED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"number of array dimensions (%d) exceeds the maximum allowed (%d)"</span><span class='Delimiter'>, 
</span>                        <a href="arrayfuncs.c.html#LN3341"><span class='Ref_to_Parameter'>ndims</span></a><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* fast track for empty array */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3341"><span class='Ref_to_Parameter'>ndims</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../../include/utils/array.h.html#LN378"><span class='Ref_to_Proto'>construct_empty_array</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3344"><span class='Ref_to_Parameter'>elmtype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN3351"><span class='Ref_To_Local'>nelems</span></a> <span class='Operator'>= </span><a href="arrayutils.c.html#LN73"><span class='Ref_to_Func'>ArrayGetNItems</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3341"><span class='Ref_to_Parameter'>ndims</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3342"><span class='Ref_to_Parameter'>dims</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* compute required space */ 
</span>    <a href="arrayfuncs.c.html#LN3348"><span class='Ref_To_Local'>nbytes</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN3347"><span class='Ref_To_Local'>hasnulls</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3350"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN3350"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN3351"><span class='Ref_To_Local'>nelems</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN3350"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3340"><span class='Ref_to_Parameter'>nulls</span></a> <span class='Operator'>&& </span><a href="arrayfuncs.c.html#LN3340"><span class='Ref_to_Parameter'>nulls</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN3350"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="arrayfuncs.c.html#LN3347"><span class='Ref_To_Local'>hasnulls</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* make sure data is not toasted */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3344"><span class='Ref_to_Parameter'>elmlen</span></a> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <a href="arrayfuncs.c.html#LN3339"><span class='Ref_to_Parameter'>elems</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN3350"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN204"><span class='Ref_to_Macro'>PG_DETOAST_DATUM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3339"><span class='Ref_to_Parameter'>elems</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN3350"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN3348"><span class='Ref_To_Local'>nbytes</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN159"><span class='Ref_to_Macro'>att_addlength_datum</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3348"><span class='Ref_To_Local'>nbytes</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3344"><span class='Ref_to_Parameter'>elmlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3339"><span class='Ref_to_Parameter'>elems</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN3350"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN3348"><span class='Ref_To_Local'>nbytes</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN143"><span class='Ref_to_Macro'>att_align_nominal</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3348"><span class='Ref_To_Local'>nbytes</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3344"><span class='Ref_to_Parameter'>elmalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* check for overflow of total request */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/memutils.h.html#LN41"><span class='Ref_to_Macro'>AllocSizeIsValid</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3348"><span class='Ref_To_Local'>nbytes</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_PROGRAM_LIMIT_EXCEEDED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"array size exceeds the maximum allowed (%d)"</span><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="../../../common/psprintf.c.html#LN27"><span class='Ref_to_Const'>MaxAllocSize</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Allocate and initialize result array */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3347"><span class='Ref_To_Local'>hasnulls</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="arrayfuncs.c.html#LN3349"><span class='Ref_To_Local'>dataoffset</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN292"><span class='Ref_to_Macro'>ARR_OVERHEAD_WITHNULLS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3341"><span class='Ref_to_Parameter'>ndims</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3351"><span class='Ref_To_Local'>nelems</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN3348"><span class='Ref_To_Local'>nbytes</span></a> <span class='Operator'>+= </span><a href="arrayfuncs.c.html#LN3349"><span class='Ref_To_Local'>dataoffset</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="arrayfuncs.c.html#LN3349"><span class='Ref_To_Local'>dataoffset</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* marker for no null bitmap */ 
</span>        <a href="arrayfuncs.c.html#LN3348"><span class='Ref_To_Local'>nbytes</span></a> <span class='Operator'>+= </span><a href="../../../include/utils/array.h.html#LN290"><span class='Ref_to_Macro'>ARR_OVERHEAD_NONULLS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3341"><span class='Ref_to_Parameter'>ndims</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="arrayfuncs.c.html#LN3346"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3348"><span class='Ref_To_Local'>nbytes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3346"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3348"><span class='Ref_To_Local'>nbytes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN3346"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN78"><span class='Ref_to_Member'>ndim</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN3341"><span class='Ref_to_Parameter'>ndims</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN3346"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN79"><span class='Ref_to_Member'>dataoffset</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN3349"><span class='Ref_To_Local'>dataoffset</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN3346"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN80"><span class='Ref_to_Member'>elemtype</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN3344"><span class='Ref_to_Parameter'>elmtype</span></a><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3346"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3342"><span class='Ref_to_Parameter'>dims</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3341"><span class='Ref_to_Parameter'>ndims</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN276"><span class='Ref_to_Macro'>ARR_LBOUND</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3346"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3343"><span class='Ref_to_Parameter'>lbs</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3341"><span class='Ref_to_Parameter'>ndims</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/array.h.html#LN330"><span class='Ref_to_Proto'>CopyArrayEls</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3346"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                 <a href="arrayfuncs.c.html#LN3339"><span class='Ref_to_Parameter'>elems</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3340"><span class='Ref_to_Parameter'>nulls</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3351"><span class='Ref_To_Local'>nelems</span></a><span class='Delimiter'>, 
</span>                 <a href="arrayfuncs.c.html#LN3344"><span class='Ref_to_Parameter'>elmlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3344"><span class='Ref_to_Parameter'>elmbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3344"><span class='Ref_to_Parameter'>elmalign</span></a><span class='Delimiter'>, 
</span>                 <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="arrayfuncs.c.html#LN3346"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end construct_md_array &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * construct_empty_array    --- make a zero-dimensional array of given type 
 */ 
</span><a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>* 
</span><a name="LN3423"></a><span class='Declare_Function'>construct_empty_array</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>elmtype</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3425"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN3425"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../../include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3425"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN3425"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN78"><span class='Ref_to_Member'>ndim</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN3425"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN79"><span class='Ref_to_Member'>dataoffset</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN3425"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN80"><span class='Ref_to_Member'>elemtype</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN3423"><span class='Ref_to_Parameter'>elmtype</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="arrayfuncs.c.html#LN3425"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * construct_empty_expanded_array: make an empty expanded array 
 * given only type information.  (metacache can be NULL if not needed.) 
 */ 
</span><a href="../../../include/utils/array.h.html#LN98"><span class='Ref_to_Struct'>ExpandedArrayHeader</span></a> <span class='Operator'>* 
</span><a name="LN3440"></a><span class='Declare_Function'>construct_empty_expanded_array</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>element_type</span><span class='Delimiter'>, 
</span><a name="LN3441"></a>                               <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>parentcontext</span><span class='Delimiter'>, 
</span><a name="LN3442"></a>                               <a href="../../../include/utils/array.h.html#LN216"><span class='Ref_to_Struct'>ArrayMetaState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>metacache</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3444"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>array</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN378"><span class='Ref_to_Proto'>construct_empty_array</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3440"><span class='Ref_to_Parameter'>element_type</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3445"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>d</span><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN3445"><span class='Ref_To_Local'>d</span></a> <span class='Operator'>= </span><a href="array_expanded.c.html#LN48"><span class='Ref_to_Func'>expand_array</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3444"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3441"><span class='Ref_to_Parameter'>parentcontext</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3442"><span class='Ref_to_Parameter'>metacache</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3444"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN98"><span class='Ref_to_Struct'>ExpandedArrayHeader</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="expandeddatum.c.html#LN27"><span class='Ref_to_Func'>DatumGetEOHP</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3445"><span class='Ref_To_Local'>d</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * deconstruct_array  --- simple method for extracting data from an array 
 * 
 * array: array object to examine (must not be NULL) 
 * elmtype, elmlen, elmbyval, elmalign: info for the datatype of the items 
 * elemsp: return value, set to point to palloc'd array of Datum values 
 * nullsp: return value, set to point to palloc'd array of isnull markers 
 * nelemsp: return value, set to number of extracted values 
 * 
 * The caller may pass nullsp == NULL if it does not support NULLs in the 
 * array.  Note that this produces a very uninformative error message, 
 * so do it only in cases where a NULL is really not expected. 
 * 
 * If array elements are pass-by-ref data type, the returned Datums will 
 * be pointers into the array object. 
 * 
 * NOTE: it would be cleaner to look up the elmlen/elmbval/elmalign info 
 * from the system catalogs, given the elmtype.  However, in most current 
 * uses the type is hard-wired into the caller and so we can save a lookup 
 * cycle by hard-wiring the type info as well. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN3474"></a><span class='Declare_Function'>deconstruct_array</span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>array</span><span class='Delimiter'>, 
</span><a name="LN3475"></a>                  <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>elmtype</span><span class='Delimiter'>, 
</span><a name="LN3476"></a>                  <span class='Keyword'>int </span><span class='Declare_Parameter'>elmlen</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>elmbyval</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>elmalign</span><span class='Delimiter'>, 
</span><a name="LN3477"></a>                  <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>elemsp</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>**</span><span class='Declare_Parameter'>nullsp</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>nelemsp</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3479"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>elems</span><span class='Delimiter'>; 
</span><a name="LN3480"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>nulls</span><span class='Delimiter'>; 
</span><a name="LN3481"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nelems</span><span class='Delimiter'>; 
</span><a name="LN3482"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span><a name="LN3483"></a>    <a href="../../../include/c.h.html#LN274"><span class='Ref_to_Typedef'>bits8</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>bitmap</span><span class='Delimiter'>; 
</span><a name="LN3484"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>bitmask</span><span class='Delimiter'>; 
</span><a name="LN3485"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN272"><span class='Ref_to_Macro'>ARR_ELEMTYPE</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3474"><span class='Ref_to_Parameter'>array</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="arrayfuncs.c.html#LN3475"><span class='Ref_to_Parameter'>elmtype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN3481"><span class='Ref_To_Local'>nelems</span></a> <span class='Operator'>= </span><a href="arrayutils.c.html#LN73"><span class='Ref_to_Func'>ArrayGetNItems</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3474"><span class='Ref_to_Parameter'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3474"><span class='Ref_to_Parameter'>array</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="arrayfuncs.c.html#LN3477"><span class='Ref_to_Parameter'>elemsp</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN3479"><span class='Ref_To_Local'>elems</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3481"><span class='Ref_To_Local'>nelems</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3477"><span class='Ref_to_Parameter'>nullsp</span></a><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="arrayfuncs.c.html#LN3477"><span class='Ref_to_Parameter'>nullsp</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN3480"><span class='Ref_To_Local'>nulls</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3481"><span class='Ref_To_Local'>nelems</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="arrayfuncs.c.html#LN3480"><span class='Ref_To_Local'>nulls</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="arrayfuncs.c.html#LN3477"><span class='Ref_to_Parameter'>nelemsp</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN3481"><span class='Ref_To_Local'>nelems</span></a><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN3482"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN302"><span class='Ref_to_Macro'>ARR_DATA_PTR</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3474"><span class='Ref_to_Parameter'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN3483"><span class='Ref_To_Local'>bitmap</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN280"><span class='Ref_to_Macro'>ARR_NULLBITMAP</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3474"><span class='Ref_to_Parameter'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN3484"><span class='Ref_To_Local'>bitmask</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3485"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN3485"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN3481"><span class='Ref_To_Local'>nelems</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN3485"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Get source element, checking for NULL */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3483"><span class='Ref_To_Local'>bitmap</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="arrayfuncs.c.html#LN3483"><span class='Ref_To_Local'>bitmap</span></a> <span class='Operator'>& </span><a href="arrayfuncs.c.html#LN3484"><span class='Ref_To_Local'>bitmask</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="arrayfuncs.c.html#LN3479"><span class='Ref_To_Local'>elems</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN3485"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3480"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>) 
</span>                <a href="arrayfuncs.c.html#LN3480"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN3485"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NULL_VALUE_NOT_ALLOWED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                  <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"null array element not allowed in this context"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="arrayfuncs.c.html#LN3479"><span class='Ref_To_Local'>elems</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN3485"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN43"><span class='Ref_to_Macro'>fetch_att</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3482"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3476"><span class='Ref_to_Parameter'>elmbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3476"><span class='Ref_to_Parameter'>elmlen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN3482"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN171"><span class='Ref_to_Macro'>att_addlength_pointer</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3482"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3476"><span class='Ref_to_Parameter'>elmlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3482"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN3482"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/access/tupmacs.h.html#LN143"><span class='Ref_to_Macro'>att_align_nominal</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3482"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3476"><span class='Ref_to_Parameter'>elmalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* advance bitmap pointer if any */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3483"><span class='Ref_To_Local'>bitmap</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="arrayfuncs.c.html#LN3484"><span class='Ref_To_Local'>bitmask</span></a> <span class='Operator'>&LT;&LT;= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3484"><span class='Ref_To_Local'>bitmask</span></a> <span class='Operator'>== </span><span class='Number'>0x100</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="arrayfuncs.c.html#LN3483"><span class='Ref_To_Local'>bitmap</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <a href="arrayfuncs.c.html#LN3484"><span class='Ref_To_Local'>bitmask</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;nelems;i++ &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end deconstruct_array &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * array_contains_nulls --- detect whether an array has any null elements 
 * 
 * This gives an accurate answer, whereas testing ARR_HASNULL only tells 
 * if the array *might* contain a null. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN3541"></a><span class='Declare_Function'>array_contains_nulls</span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>array</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3543"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nelems</span><span class='Delimiter'>; 
</span><a name="LN3544"></a>    <a href="../../../include/c.h.html#LN274"><span class='Ref_to_Typedef'>bits8</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>bitmap</span><span class='Delimiter'>; 
</span><a name="LN3545"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>bitmask</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Easy answer if there's no null bitmap */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/array.h.html#LN271"><span class='Ref_to_Macro'>ARR_HASNULL</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3541"><span class='Ref_to_Parameter'>array</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN3543"><span class='Ref_To_Local'>nelems</span></a> <span class='Operator'>= </span><a href="arrayutils.c.html#LN73"><span class='Ref_to_Func'>ArrayGetNItems</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3541"><span class='Ref_to_Parameter'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3541"><span class='Ref_to_Parameter'>array</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN3544"><span class='Ref_To_Local'>bitmap</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN280"><span class='Ref_to_Macro'>ARR_NULLBITMAP</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3541"><span class='Ref_to_Parameter'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* check whole bytes of the bitmap byte-at-a-time */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3543"><span class='Ref_To_Local'>nelems</span></a> <span class='Operator'>&GT;= </span><span class='Number'>8</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="arrayfuncs.c.html#LN3544"><span class='Ref_To_Local'>bitmap</span></a> <span class='Operator'>!= </span><span class='Number'>0xFF</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN3544"><span class='Ref_To_Local'>bitmap</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN3543"><span class='Ref_To_Local'>nelems</span></a> <span class='Operator'>-= </span><span class='Number'>8</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* check last partial byte */ 
</span>    <a href="arrayfuncs.c.html#LN3545"><span class='Ref_To_Local'>bitmask</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3543"><span class='Ref_To_Local'>nelems</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>((</span><span class='Operator'>*</span><a href="arrayfuncs.c.html#LN3544"><span class='Ref_To_Local'>bitmap</span></a> <span class='Operator'>& </span><a href="arrayfuncs.c.html#LN3545"><span class='Ref_To_Local'>bitmask</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN3545"><span class='Ref_To_Local'>bitmask</span></a> <span class='Operator'>&LT;&LT;= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN3543"><span class='Ref_To_Local'>nelems</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end array_contains_nulls &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * array_eq : 
 *        compares two arrays for equality 
 * result : 
 *        returns true if the arrays are equal, false otherwise. 
 * 
 * Note: we do not use array_cmp here, since equality may be meaningful in 
 * datatypes that don't have a total ordering (and hence no btree support). 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3588"></a><span class='Declare_Function'>array_eq</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3590"></a>    <a href="../../../include/utils/array.h.html#LN157"><span class='Ref_to_Union'>AnyArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Local'>array1</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN254"><span class='Ref_to_Macro'>PG_GETARG_ANY_ARRAY</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3591"></a>    <a href="../../../include/utils/array.h.html#LN157"><span class='Ref_to_Union'>AnyArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Local'>array2</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN254"><span class='Ref_to_Macro'>PG_GETARG_ANY_ARRAY</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3592"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>collation</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN162"><span class='Ref_to_Macro'>PG_GET_COLLATION</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><a name="LN3593"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ndims1</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN308"><span class='Ref_to_Macro'>AARR_NDIM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3590"><span class='Ref_To_Local'>array1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3594"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ndims2</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN308"><span class='Ref_to_Macro'>AARR_NDIM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3591"><span class='Ref_To_Local'>array2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3595"></a>    <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Local'>dims1</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN316"><span class='Ref_to_Macro'>AARR_DIMS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3590"><span class='Ref_To_Local'>array1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3596"></a>    <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Local'>dims2</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN316"><span class='Ref_to_Macro'>AARR_DIMS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3591"><span class='Ref_To_Local'>array2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3597"></a>    <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Local'>lbs1</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN318"><span class='Ref_to_Macro'>AARR_LBOUND</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3590"><span class='Ref_To_Local'>array1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3598"></a>    <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Local'>lbs2</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN318"><span class='Ref_to_Macro'>AARR_LBOUND</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3591"><span class='Ref_To_Local'>array2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3599"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>element_type</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN314"><span class='Ref_to_Macro'>AARR_ELEMTYPE</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3590"><span class='Ref_To_Local'>array1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3600"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>result</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span><a name="LN3601"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nitems</span><span class='Delimiter'>; 
</span><a name="LN3602"></a>    <a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>typentry</span><span class='Delimiter'>; 
</span><a name="LN3603"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>typlen</span><span class='Delimiter'>; 
</span><a name="LN3604"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>typbyval</span><span class='Delimiter'>; 
</span><a name="LN3605"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>typalign</span><span class='Delimiter'>; 
</span><a name="LN3606"></a>    <a href="../../../include/utils/arrayaccess.h.html#LN32"><span class='Ref_to_Struct'>array_iter</span></a>  <span class='Declare_Local'>it1</span><span class='Delimiter'>; 
</span><a name="LN3607"></a>    <a href="../../../include/utils/arrayaccess.h.html#LN32"><span class='Ref_to_Struct'>array_iter</span></a>  <span class='Declare_Local'>it2</span><span class='Delimiter'>; 
</span><a name="LN3608"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN3609"></a>    <a href="../../../include/fmgr.h.html#LN76"><span class='Ref_to_Struct'>FunctionCallInfoData</span></a> <span class='Declare_Local'>locfcinfo</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3599"><span class='Ref_To_Local'>element_type</span></a> <span class='Operator'>!= </span><a href="../../../include/utils/array.h.html#LN314"><span class='Ref_to_Macro'>AARR_ELEMTYPE</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3591"><span class='Ref_To_Local'>array2</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot compare arrays of different element types"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* fast path if the arrays do not have the same dimensionality */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3593"><span class='Ref_To_Local'>ndims1</span></a> <span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN3594"><span class='Ref_To_Local'>ndims2</span></a> <span class='Operator'>|| 
</span>        memcmp<span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3595"><span class='Ref_To_Local'>dims1</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3596"><span class='Ref_To_Local'>dims2</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3593"><span class='Ref_To_Local'>ndims1</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        memcmp<span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3597"><span class='Ref_To_Local'>lbs1</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3598"><span class='Ref_To_Local'>lbs2</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3593"><span class='Ref_To_Local'>ndims1</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="arrayfuncs.c.html#LN3600"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * We arrange to look up the equality function only once per series of 
         * calls, assuming the element type doesn't change underneath us.  The 
         * typcache is used so that we have no memory leakage when being used 
         * as an index support function. 
         */ 
</span>        <a href="arrayfuncs.c.html#LN3602"><span class='Ref_To_Local'>typentry</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_extra<span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3602"><span class='Ref_To_Local'>typentry</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| 
</span>            <a href="arrayfuncs.c.html#LN3602"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN31"><span class='Ref_to_Member'>type_id</span></a> <span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN3599"><span class='Ref_To_Local'>element_type</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="arrayfuncs.c.html#LN3602"><span class='Ref_To_Local'>typentry</span></a> <span class='Operator'>= </span><a href="../../../include/utils/typcache.h.html#LN142"><span class='Ref_to_Proto'>lookup_type_cache</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3599"><span class='Ref_To_Local'>element_type</span></a><span class='Delimiter'>, 
</span>                                         <a href="../../../include/utils/typcache.h.html#LN114"><span class='Ref_to_Const'>TYPECACHE_EQ_OPR_FINFO</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3602"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN66"><span class='Ref_to_Member'>eq_opr_finfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN58"><span class='Ref_to_Member'>fn_oid</span></a><span class='Parentheses'>))</span> 
                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_FUNCTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not identify an equality operator for type %s"</span><span class='Delimiter'>, 
</span>                       <a href="format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3599"><span class='Ref_To_Local'>element_type</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>            fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_extra <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="arrayfuncs.c.html#LN3602"><span class='Ref_To_Local'>typentry</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="arrayfuncs.c.html#LN3603"><span class='Ref_To_Local'>typlen</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN3602"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN34"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN3604"><span class='Ref_To_Local'>typbyval</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN3602"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN35"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN3605"><span class='Ref_To_Local'>typalign</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN3602"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN36"><span class='Ref_to_Member'>typalign</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * apply the operator to each pair of array elements. 
         */ 
</span>        <a href="../../../include/fmgr.h.html#LN119"><span class='Ref_to_Macro'>InitFunctionCallInfoData</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3609"><span class='Ref_To_Local'>locfcinfo</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN3602"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN66"><span class='Ref_to_Member'>eq_opr_finfo</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, 
</span>                                 <a href="arrayfuncs.c.html#LN3592"><span class='Ref_To_Local'>collation</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Loop over source data */ 
</span>        <a href="arrayfuncs.c.html#LN3601"><span class='Ref_To_Local'>nitems</span></a> <span class='Operator'>= </span><a href="arrayutils.c.html#LN73"><span class='Ref_to_Func'>ArrayGetNItems</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3593"><span class='Ref_To_Local'>ndims1</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3595"><span class='Ref_To_Local'>dims1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/arrayaccess.h.html#LN47"><span class='Ref_to_Func'>array_iter_setup</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN3606"><span class='Ref_To_Local'>it1</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3590"><span class='Ref_To_Local'>array1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/arrayaccess.h.html#LN47"><span class='Ref_to_Func'>array_iter_setup</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN3607"><span class='Ref_To_Local'>it2</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3591"><span class='Ref_To_Local'>array2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3608"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN3608"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN3601"><span class='Ref_To_Local'>nitems</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN3608"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN3659"></a>            <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>elt1</span><span class='Delimiter'>; 
</span><a name="LN3660"></a>            <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>elt2</span><span class='Delimiter'>; 
</span><a name="LN3661"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull1</span><span class='Delimiter'>; 
</span><a name="LN3662"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull2</span><span class='Delimiter'>; 
</span><a name="LN3663"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>oprresult</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Get elements, checking for NULL */ 
</span>            <a href="arrayfuncs.c.html#LN3659"><span class='Ref_To_Local'>elt1</span></a> <span class='Operator'>= </span><a href="../../../include/utils/arrayaccess.h.html#LN79"><span class='Ref_to_Func'>array_iter_next</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN3606"><span class='Ref_To_Local'>it1</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN3661"><span class='Ref_To_Local'>isnull1</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3608"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, 
</span>                                   <a href="arrayfuncs.c.html#LN3603"><span class='Ref_To_Local'>typlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3604"><span class='Ref_To_Local'>typbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3605"><span class='Ref_To_Local'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN3660"><span class='Ref_To_Local'>elt2</span></a> <span class='Operator'>= </span><a href="../../../include/utils/arrayaccess.h.html#LN79"><span class='Ref_to_Func'>array_iter_next</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN3607"><span class='Ref_To_Local'>it2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN3662"><span class='Ref_To_Local'>isnull2</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3608"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, 
</span>                                   <a href="arrayfuncs.c.html#LN3603"><span class='Ref_To_Local'>typlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3604"><span class='Ref_To_Local'>typbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3605"><span class='Ref_To_Local'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * We consider two NULLs equal; NULL and not-NULL are unequal. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3661"><span class='Ref_To_Local'>isnull1</span></a> <span class='Operator'>&& </span><a href="arrayfuncs.c.html#LN3662"><span class='Ref_To_Local'>isnull2</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3661"><span class='Ref_To_Local'>isnull1</span></a> <span class='Operator'>|| </span><a href="arrayfuncs.c.html#LN3662"><span class='Ref_To_Local'>isnull2</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="arrayfuncs.c.html#LN3600"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Apply the operator to the element pair 
             */ 
</span>            <a href="arrayfuncs.c.html#LN3609"><span class='Ref_To_Local'>locfcinfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN84"><span class='Ref_to_Member'>arg</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="arrayfuncs.c.html#LN3659"><span class='Ref_To_Local'>elt1</span></a><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN3609"><span class='Ref_To_Local'>locfcinfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN84"><span class='Ref_to_Member'>arg</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="arrayfuncs.c.html#LN3660"><span class='Ref_To_Local'>elt2</span></a><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN3609"><span class='Ref_To_Local'>locfcinfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN85"><span class='Ref_to_Member'>argnull</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN3609"><span class='Ref_To_Local'>locfcinfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN85"><span class='Ref_to_Member'>argnull</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN3609"><span class='Ref_To_Local'>locfcinfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN82"><span class='Ref_to_Member'>isnull</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN3663"><span class='Ref_To_Local'>oprresult</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN136"><span class='Ref_to_Macro'>FunctionCallInvoke</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN3609"><span class='Ref_To_Local'>locfcinfo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="arrayfuncs.c.html#LN3663"><span class='Ref_To_Local'>oprresult</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="arrayfuncs.c.html#LN3600"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;nitems;i++ &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Avoid leaking memory when handed toasted input. */ 
</span>    <a href="arrayfuncs.c.html#LN45"><span class='Ref_to_Macro'>AARR_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3590"><span class='Ref_To_Local'>array1</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN45"><span class='Ref_to_Macro'>AARR_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3591"><span class='Ref_To_Local'>array2</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3600"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end array_eq &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/*----------------------------------------------------------------------------- 
 * array-array bool operators: 
 *      Given two arrays, iterate comparison operators 
 *      over the array. Uses logic similar to text comparison 
 *      functions, except element-by-element instead of 
 *      character-by-character. 
 *---------------------------------------------------------------------------- 
 */ 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3717"></a><span class='Declare_Function'>array_ne</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3587"><span class='Ref_to_Func'>array_eq</span></a><span class='Parentheses'>(</span>fcinfo<span class='Parentheses'>)))</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3723"></a><span class='Declare_Function'>array_lt</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN139"><span class='Ref_to_Proto'>array_cmp</span></a><span class='Parentheses'>(</span>fcinfo<span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3729"></a><span class='Declare_Function'>array_gt</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN139"><span class='Ref_to_Proto'>array_cmp</span></a><span class='Parentheses'>(</span>fcinfo<span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3735"></a><span class='Declare_Function'>array_le</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN139"><span class='Ref_to_Proto'>array_cmp</span></a><span class='Parentheses'>(</span>fcinfo<span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3741"></a><span class='Declare_Function'>array_ge</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN139"><span class='Ref_to_Proto'>array_cmp</span></a><span class='Parentheses'>(</span>fcinfo<span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3747"></a><span class='Declare_Function'>btarraycmp</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/fmgr.h.html#LN313"><span class='Ref_to_Macro'>PG_RETURN_INT32</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN139"><span class='Ref_to_Proto'>array_cmp</span></a><span class='Parentheses'>(</span>fcinfo<span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * array_cmp() 
 * Internal comparison function for arrays. 
 * 
 * Returns -1, 0 or 1 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN3759"></a><span class='Declare_Function'>array_cmp</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN37"><span class='Ref_to_Typedef'>FunctionCallInfo</span></a> <span class='Declare_Parameter'>fcinfo</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3761"></a>    <a href="../../../include/utils/array.h.html#LN157"><span class='Ref_to_Union'>AnyArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Local'>array1</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN254"><span class='Ref_to_Macro'>PG_GETARG_ANY_ARRAY</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3762"></a>    <a href="../../../include/utils/array.h.html#LN157"><span class='Ref_to_Union'>AnyArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Local'>array2</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN254"><span class='Ref_to_Macro'>PG_GETARG_ANY_ARRAY</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3763"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>collation</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN162"><span class='Ref_to_Macro'>PG_GET_COLLATION</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><a name="LN3764"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ndims1</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN308"><span class='Ref_to_Macro'>AARR_NDIM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3761"><span class='Ref_To_Local'>array1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3765"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ndims2</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN308"><span class='Ref_to_Macro'>AARR_NDIM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3762"><span class='Ref_To_Local'>array2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3766"></a>    <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Local'>dims1</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN316"><span class='Ref_to_Macro'>AARR_DIMS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3761"><span class='Ref_To_Local'>array1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3767"></a>    <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Local'>dims2</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN316"><span class='Ref_to_Macro'>AARR_DIMS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3762"><span class='Ref_To_Local'>array2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3768"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nitems1</span> <span class='Operator'>= </span><a href="arrayutils.c.html#LN73"><span class='Ref_to_Func'>ArrayGetNItems</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3764"><span class='Ref_To_Local'>ndims1</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3766"><span class='Ref_To_Local'>dims1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3769"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nitems2</span> <span class='Operator'>= </span><a href="arrayutils.c.html#LN73"><span class='Ref_to_Func'>ArrayGetNItems</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3765"><span class='Ref_To_Local'>ndims2</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3767"><span class='Ref_To_Local'>dims2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3770"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>element_type</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN314"><span class='Ref_to_Macro'>AARR_ELEMTYPE</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3761"><span class='Ref_To_Local'>array1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3771"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>result</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN3772"></a>    <a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>typentry</span><span class='Delimiter'>; 
</span><a name="LN3773"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>typlen</span><span class='Delimiter'>; 
</span><a name="LN3774"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>typbyval</span><span class='Delimiter'>; 
</span><a name="LN3775"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>typalign</span><span class='Delimiter'>; 
</span><a name="LN3776"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>min_nitems</span><span class='Delimiter'>; 
</span><a name="LN3777"></a>    <a href="../../../include/utils/arrayaccess.h.html#LN32"><span class='Ref_to_Struct'>array_iter</span></a>  <span class='Declare_Local'>it1</span><span class='Delimiter'>; 
</span><a name="LN3778"></a>    <a href="../../../include/utils/arrayaccess.h.html#LN32"><span class='Ref_to_Struct'>array_iter</span></a>  <span class='Declare_Local'>it2</span><span class='Delimiter'>; 
</span><a name="LN3779"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN3780"></a>    <a href="../../../include/fmgr.h.html#LN76"><span class='Ref_to_Struct'>FunctionCallInfoData</span></a> <span class='Declare_Local'>locfcinfo</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3770"><span class='Ref_To_Local'>element_type</span></a> <span class='Operator'>!= </span><a href="../../../include/utils/array.h.html#LN314"><span class='Ref_to_Macro'>AARR_ELEMTYPE</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3762"><span class='Ref_To_Local'>array2</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot compare arrays of different element types"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We arrange to look up the comparison function only once per series of 
     * calls, assuming the element type doesn't change underneath us. The 
     * typcache is used so that we have no memory leakage when being used as 
     * an index support function. 
     */ 
</span>    <a href="arrayfuncs.c.html#LN3772"><span class='Ref_To_Local'>typentry</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="arrayfuncs.c.html#LN3759"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN78"><span class='Ref_to_Member'>flinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN63"><span class='Ref_to_Member'>fn_extra</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3772"><span class='Ref_To_Local'>typentry</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| 
</span>        <a href="arrayfuncs.c.html#LN3772"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN31"><span class='Ref_to_Member'>type_id</span></a> <span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN3770"><span class='Ref_To_Local'>element_type</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="arrayfuncs.c.html#LN3772"><span class='Ref_To_Local'>typentry</span></a> <span class='Operator'>= </span><a href="../../../include/utils/typcache.h.html#LN142"><span class='Ref_to_Proto'>lookup_type_cache</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3770"><span class='Ref_To_Local'>element_type</span></a><span class='Delimiter'>, 
</span>                                     <a href="../../../include/utils/typcache.h.html#LN115"><span class='Ref_to_Const'>TYPECACHE_CMP_PROC_FINFO</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3772"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN67"><span class='Ref_to_Member'>cmp_proc_finfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN58"><span class='Ref_to_Member'>fn_oid</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_FUNCTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>               <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not identify a comparison function for type %s"</span><span class='Delimiter'>, 
</span>                      <a href="format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3770"><span class='Ref_To_Local'>element_type</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN3759"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN78"><span class='Ref_to_Member'>flinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN63"><span class='Ref_to_Member'>fn_extra</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="arrayfuncs.c.html#LN3772"><span class='Ref_To_Local'>typentry</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="arrayfuncs.c.html#LN3773"><span class='Ref_To_Local'>typlen</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN3772"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN34"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN3774"><span class='Ref_To_Local'>typbyval</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN3772"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN35"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN3775"><span class='Ref_To_Local'>typalign</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN3772"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN36"><span class='Ref_to_Member'>typalign</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * apply the operator to each pair of array elements. 
     */ 
</span>    <a href="../../../include/fmgr.h.html#LN119"><span class='Ref_to_Macro'>InitFunctionCallInfoData</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3780"><span class='Ref_To_Local'>locfcinfo</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN3772"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN67"><span class='Ref_to_Member'>cmp_proc_finfo</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, 
</span>                             <a href="arrayfuncs.c.html#LN3763"><span class='Ref_To_Local'>collation</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Loop over source data */ 
</span>    <a href="arrayfuncs.c.html#LN3776"><span class='Ref_To_Local'>min_nitems</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3768"><span class='Ref_To_Local'>nitems1</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3769"><span class='Ref_To_Local'>nitems2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/arrayaccess.h.html#LN47"><span class='Ref_to_Func'>array_iter_setup</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN3777"><span class='Ref_To_Local'>it1</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3761"><span class='Ref_To_Local'>array1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/arrayaccess.h.html#LN47"><span class='Ref_to_Func'>array_iter_setup</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN3778"><span class='Ref_To_Local'>it2</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3762"><span class='Ref_To_Local'>array2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3779"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN3779"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN3776"><span class='Ref_To_Local'>min_nitems</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN3779"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3823"></a>        <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>elt1</span><span class='Delimiter'>; 
</span><a name="LN3824"></a>        <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>elt2</span><span class='Delimiter'>; 
</span><a name="LN3825"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull1</span><span class='Delimiter'>; 
</span><a name="LN3826"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull2</span><span class='Delimiter'>; 
</span><a name="LN3827"></a>        <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>cmpresult</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Get elements, checking for NULL */ 
</span>        <a href="arrayfuncs.c.html#LN3823"><span class='Ref_To_Local'>elt1</span></a> <span class='Operator'>= </span><a href="../../../include/utils/arrayaccess.h.html#LN79"><span class='Ref_to_Func'>array_iter_next</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN3777"><span class='Ref_To_Local'>it1</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN3825"><span class='Ref_To_Local'>isnull1</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3779"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3773"><span class='Ref_To_Local'>typlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3774"><span class='Ref_To_Local'>typbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3775"><span class='Ref_To_Local'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN3824"><span class='Ref_To_Local'>elt2</span></a> <span class='Operator'>= </span><a href="../../../include/utils/arrayaccess.h.html#LN79"><span class='Ref_to_Func'>array_iter_next</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN3778"><span class='Ref_To_Local'>it2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN3826"><span class='Ref_To_Local'>isnull2</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3779"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3773"><span class='Ref_To_Local'>typlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3774"><span class='Ref_To_Local'>typbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3775"><span class='Ref_To_Local'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We consider two NULLs equal; NULL &GT; not-NULL. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3825"><span class='Ref_To_Local'>isnull1</span></a> <span class='Operator'>&& </span><a href="arrayfuncs.c.html#LN3826"><span class='Ref_To_Local'>isnull2</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3825"><span class='Ref_To_Local'>isnull1</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* arg1 is greater than arg2 */ 
</span>            <a href="arrayfuncs.c.html#LN3771"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3826"><span class='Ref_To_Local'>isnull2</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* arg1 is less than arg2 */ 
</span>            <a href="arrayfuncs.c.html#LN3771"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Compare the pair of elements */ 
</span>        <a href="arrayfuncs.c.html#LN3780"><span class='Ref_To_Local'>locfcinfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN84"><span class='Ref_to_Member'>arg</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="arrayfuncs.c.html#LN3823"><span class='Ref_To_Local'>elt1</span></a><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN3780"><span class='Ref_To_Local'>locfcinfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN84"><span class='Ref_to_Member'>arg</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="arrayfuncs.c.html#LN3824"><span class='Ref_To_Local'>elt2</span></a><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN3780"><span class='Ref_To_Local'>locfcinfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN85"><span class='Ref_to_Member'>argnull</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN3780"><span class='Ref_To_Local'>locfcinfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN85"><span class='Ref_to_Member'>argnull</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN3780"><span class='Ref_To_Local'>locfcinfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN82"><span class='Ref_to_Member'>isnull</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN3827"><span class='Ref_To_Local'>cmpresult</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN477"><span class='Ref_to_Macro'>DatumGetInt32</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN136"><span class='Ref_to_Macro'>FunctionCallInvoke</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN3780"><span class='Ref_To_Local'>locfcinfo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3827"><span class='Ref_To_Local'>cmpresult</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* equal */ 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3827"><span class='Ref_To_Local'>cmpresult</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* arg1 is less than arg2 */ 
</span>            <a href="arrayfuncs.c.html#LN3771"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* arg1 is greater than arg2 */ 
</span>            <a href="arrayfuncs.c.html#LN3771"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;min_nitems;i++ &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * If arrays contain same data (up to end of shorter one), apply 
     * additional rules to sort by dimensionality.  The relative significance 
     * of the different bits of information is historical; mainly we just care 
     * that we don't say "equal" for arrays of different dimensionality. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3771"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3768"><span class='Ref_To_Local'>nitems1</span></a> <span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN3769"><span class='Ref_To_Local'>nitems2</span></a><span class='Parentheses'>) 
</span>            <a href="arrayfuncs.c.html#LN3771"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3768"><span class='Ref_To_Local'>nitems1</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN3769"><span class='Ref_To_Local'>nitems2</span></a><span class='Parentheses'>) </span><span class='Operator'>? -</span><span class='Number'>1</span> <span class='Operator'>: </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3764"><span class='Ref_To_Local'>ndims1</span></a> <span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN3765"><span class='Ref_To_Local'>ndims2</span></a><span class='Parentheses'>) 
</span>            <a href="arrayfuncs.c.html#LN3771"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3764"><span class='Ref_To_Local'>ndims1</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN3765"><span class='Ref_To_Local'>ndims2</span></a><span class='Parentheses'>) </span><span class='Operator'>? -</span><span class='Number'>1</span> <span class='Operator'>: </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3779"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN3779"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN3764"><span class='Ref_To_Local'>ndims1</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN3779"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3766"><span class='Ref_To_Local'>dims1</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN3779"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN3767"><span class='Ref_To_Local'>dims2</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN3779"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="arrayfuncs.c.html#LN3771"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3766"><span class='Ref_To_Local'>dims1</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN3779"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN3767"><span class='Ref_To_Local'>dims2</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN3779"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) </span><span class='Operator'>? -</span><span class='Number'>1</span> <span class='Operator'>: </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3771"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN3900"></a>                <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Local'>lbound1</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN318"><span class='Ref_to_Macro'>AARR_LBOUND</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3761"><span class='Ref_To_Local'>array1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3901"></a>                <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Local'>lbound2</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN318"><span class='Ref_to_Macro'>AARR_LBOUND</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3762"><span class='Ref_To_Local'>array2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3779"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN3779"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN3764"><span class='Ref_To_Local'>ndims1</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN3779"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3900"><span class='Ref_To_Local'>lbound1</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN3779"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN3901"><span class='Ref_To_Local'>lbound2</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN3779"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="arrayfuncs.c.html#LN3771"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3900"><span class='Ref_To_Local'>lbound1</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN3779"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN3901"><span class='Ref_To_Local'>lbound2</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN3779"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) </span><span class='Operator'>? -</span><span class='Number'>1</span> <span class='Operator'>: </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if result==0 &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Avoid leaking memory when handed toasted input. */ 
</span>    <a href="arrayfuncs.c.html#LN45"><span class='Ref_to_Macro'>AARR_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3761"><span class='Ref_To_Local'>array1</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN45"><span class='Ref_to_Macro'>AARR_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3762"><span class='Ref_To_Local'>array2</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="arrayfuncs.c.html#LN3771"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end array_cmp &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/*----------------------------------------------------------------------------- 
 * array hashing 
 *      Hash the elements and combine the results. 
 *---------------------------------------------------------------------------- 
 */ 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3930"></a><span class='Declare_Function'>hash_array</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3932"></a>    <a href="../../../include/utils/array.h.html#LN157"><span class='Ref_to_Union'>AnyArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Local'>array</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN254"><span class='Ref_to_Macro'>PG_GETARG_ANY_ARRAY</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3933"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ndims</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN308"><span class='Ref_to_Macro'>AARR_NDIM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3932"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3934"></a>    <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Local'>dims</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN316"><span class='Ref_to_Macro'>AARR_DIMS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3932"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3935"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>element_type</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN314"><span class='Ref_to_Macro'>AARR_ELEMTYPE</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3932"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3936"></a>    <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>result</span> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span><a name="LN3937"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nitems</span><span class='Delimiter'>; 
</span><a name="LN3938"></a>    <a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>typentry</span><span class='Delimiter'>; 
</span><a name="LN3939"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>typlen</span><span class='Delimiter'>; 
</span><a name="LN3940"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>typbyval</span><span class='Delimiter'>; 
</span><a name="LN3941"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>typalign</span><span class='Delimiter'>; 
</span><a name="LN3942"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN3943"></a>    <a href="../../../include/utils/arrayaccess.h.html#LN32"><span class='Ref_to_Struct'>array_iter</span></a>  <span class='Declare_Local'>iter</span><span class='Delimiter'>; 
</span><a name="LN3944"></a>    <a href="../../../include/fmgr.h.html#LN76"><span class='Ref_to_Struct'>FunctionCallInfoData</span></a> <span class='Declare_Local'>locfcinfo</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We arrange to look up the hash function only once per series of calls, 
     * assuming the element type doesn't change underneath us.  The typcache 
     * is used so that we have no memory leakage when being used as an index 
     * support function. 
     */ 
</span>    <a href="arrayfuncs.c.html#LN3938"><span class='Ref_To_Local'>typentry</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_extra<span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3938"><span class='Ref_To_Local'>typentry</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| 
</span>        <a href="arrayfuncs.c.html#LN3938"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN31"><span class='Ref_to_Member'>type_id</span></a> <span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN3935"><span class='Ref_To_Local'>element_type</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="arrayfuncs.c.html#LN3938"><span class='Ref_To_Local'>typentry</span></a> <span class='Operator'>= </span><a href="../../../include/utils/typcache.h.html#LN142"><span class='Ref_to_Proto'>lookup_type_cache</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3935"><span class='Ref_To_Local'>element_type</span></a><span class='Delimiter'>, 
</span>                                     <a href="../../../include/utils/typcache.h.html#LN116"><span class='Ref_to_Const'>TYPECACHE_HASH_PROC_FINFO</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3938"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN68"><span class='Ref_to_Member'>hash_proc_finfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN58"><span class='Ref_to_Member'>fn_oid</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_FUNCTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not identify a hash function for type %s"</span><span class='Delimiter'>, 
</span>                            <a href="format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3935"><span class='Ref_To_Local'>element_type</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>        fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_extra <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="arrayfuncs.c.html#LN3938"><span class='Ref_To_Local'>typentry</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="arrayfuncs.c.html#LN3939"><span class='Ref_To_Local'>typlen</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN3938"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN34"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN3940"><span class='Ref_To_Local'>typbyval</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN3938"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN35"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN3941"><span class='Ref_To_Local'>typalign</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN3938"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN36"><span class='Ref_to_Member'>typalign</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * apply the hash function to each array element. 
     */ 
</span>    <a href="../../../include/fmgr.h.html#LN119"><span class='Ref_to_Macro'>InitFunctionCallInfoData</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3944"><span class='Ref_To_Local'>locfcinfo</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN3938"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN68"><span class='Ref_to_Member'>hash_proc_finfo</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                             <a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Loop over source data */ 
</span>    <a href="arrayfuncs.c.html#LN3937"><span class='Ref_To_Local'>nitems</span></a> <span class='Operator'>= </span><a href="arrayutils.c.html#LN73"><span class='Ref_to_Func'>ArrayGetNItems</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3933"><span class='Ref_To_Local'>ndims</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3934"><span class='Ref_To_Local'>dims</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/arrayaccess.h.html#LN47"><span class='Ref_to_Func'>array_iter_setup</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN3943"><span class='Ref_To_Local'>iter</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3932"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3942"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN3942"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN3937"><span class='Ref_To_Local'>nitems</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN3942"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3981"></a>        <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>elt</span><span class='Delimiter'>; 
</span><a name="LN3982"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN3983"></a>        <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>elthash</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Get element, checking for NULL */ 
</span>        <a href="arrayfuncs.c.html#LN3981"><span class='Ref_To_Local'>elt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/arrayaccess.h.html#LN79"><span class='Ref_to_Func'>array_iter_next</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN3943"><span class='Ref_To_Local'>iter</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN3982"><span class='Ref_To_Local'>isnull</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3942"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3939"><span class='Ref_To_Local'>typlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3940"><span class='Ref_To_Local'>typbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN3941"><span class='Ref_To_Local'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3982"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Treat nulls as having hashvalue 0 */ 
</span>            <a href="arrayfuncs.c.html#LN3983"><span class='Ref_To_Local'>elthash</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Apply the hash function */ 
</span>            <a href="arrayfuncs.c.html#LN3944"><span class='Ref_To_Local'>locfcinfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN84"><span class='Ref_to_Member'>arg</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="arrayfuncs.c.html#LN3981"><span class='Ref_To_Local'>elt</span></a><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN3944"><span class='Ref_To_Local'>locfcinfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN85"><span class='Ref_to_Member'>argnull</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN3944"><span class='Ref_To_Local'>locfcinfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN82"><span class='Ref_to_Member'>isnull</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN3983"><span class='Ref_To_Local'>elthash</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN491"><span class='Ref_to_Macro'>DatumGetUInt32</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN136"><span class='Ref_to_Macro'>FunctionCallInvoke</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN3944"><span class='Ref_To_Local'>locfcinfo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Combine hash values of successive elements by multiplying the 
         * current value by 31 and adding on the new element's hash value. 
         * 
         * The result is a sum in which each element's hash value is 
         * multiplied by a different power of 31. This is modulo 2^32 
         * arithmetic, and the powers of 31 modulo 2^32 form a cyclic group of 
         * order 2^27. So for arrays of up to 2^27 elements, each element's 
         * hash value is multiplied by a different (odd) number, resulting in 
         * a good mixing of all the elements' hash values. 
         */ 
</span>        <a href="arrayfuncs.c.html#LN3936"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3936"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>&LT;&LT; </span><span class='Number'>5</span><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="arrayfuncs.c.html#LN3936"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN3983"><span class='Ref_To_Local'>elthash</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;nitems;i++ &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Avoid leaking memory when handed toasted input. */ 
</span>    <a href="arrayfuncs.c.html#LN45"><span class='Ref_to_Macro'>AARR_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3932"><span class='Ref_To_Local'>array</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN314"><span class='Ref_to_Macro'>PG_RETURN_UINT32</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN3936"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end hash_array &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/*----------------------------------------------------------------------------- 
 * array overlap/containment comparisons 
 *      These use the same methods of comparing array elements as array_eq. 
 *      We consider only the elements of the arrays, ignoring dimensionality. 
 *---------------------------------------------------------------------------- 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * array_contain_compare : 
 *        compares two arrays for overlap/containment 
 * 
 * When matchall is true, return true if all members of array1 are in array2. 
 * When matchall is false, return true if any members of array1 are in array2. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN4038"></a><span class='Declare_Function'>array_contain_compare</span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN157"><span class='Ref_to_Union'>AnyArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>array1</span><span class='Delimiter'>, </span><a href="../../../include/utils/array.h.html#LN157"><span class='Ref_to_Union'>AnyArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>array2</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>collation</span><span class='Delimiter'>, 
</span><a name="LN4039"></a>                      <span class='Keyword'>bool </span><span class='Declare_Parameter'>matchall</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>**</span><span class='Declare_Parameter'>fn_extra</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4041"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>result</span> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN4039"><span class='Ref_to_Parameter'>matchall</span></a><span class='Delimiter'>; 
</span><a name="LN4042"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>element_type</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN314"><span class='Ref_to_Macro'>AARR_ELEMTYPE</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4038"><span class='Ref_to_Parameter'>array1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4043"></a>    <a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>typentry</span><span class='Delimiter'>; 
</span><a name="LN4044"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nelems1</span><span class='Delimiter'>; 
</span><a name="LN4045"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>values2</span><span class='Delimiter'>; 
</span><a name="LN4046"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>nulls2</span><span class='Delimiter'>; 
</span><a name="LN4047"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nelems2</span><span class='Delimiter'>; 
</span><a name="LN4048"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>typlen</span><span class='Delimiter'>; 
</span><a name="LN4049"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>typbyval</span><span class='Delimiter'>; 
</span><a name="LN4050"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>typalign</span><span class='Delimiter'>; 
</span><a name="LN4051"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN4052"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>j</span><span class='Delimiter'>; 
</span><a name="LN4053"></a>    <a href="../../../include/utils/arrayaccess.h.html#LN32"><span class='Ref_to_Struct'>array_iter</span></a>  <span class='Declare_Local'>it1</span><span class='Delimiter'>; 
</span><a name="LN4054"></a>    <a href="../../../include/fmgr.h.html#LN76"><span class='Ref_to_Struct'>FunctionCallInfoData</span></a> <span class='Declare_Local'>locfcinfo</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4042"><span class='Ref_To_Local'>element_type</span></a> <span class='Operator'>!= </span><a href="../../../include/utils/array.h.html#LN314"><span class='Ref_to_Macro'>AARR_ELEMTYPE</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4038"><span class='Ref_to_Parameter'>array2</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot compare arrays of different element types"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We arrange to look up the equality function only once per series of 
     * calls, assuming the element type doesn't change underneath us.  The 
     * typcache is used so that we have no memory leakage when being used as 
     * an index support function. 
     */ 
</span>    <a href="arrayfuncs.c.html#LN4043"><span class='Ref_To_Local'>typentry</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="arrayfuncs.c.html#LN4039"><span class='Ref_to_Parameter'>fn_extra</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4043"><span class='Ref_To_Local'>typentry</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| 
</span>        <a href="arrayfuncs.c.html#LN4043"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN31"><span class='Ref_to_Member'>type_id</span></a> <span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN4042"><span class='Ref_To_Local'>element_type</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="arrayfuncs.c.html#LN4043"><span class='Ref_To_Local'>typentry</span></a> <span class='Operator'>= </span><a href="../../../include/utils/typcache.h.html#LN142"><span class='Ref_to_Proto'>lookup_type_cache</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4042"><span class='Ref_To_Local'>element_type</span></a><span class='Delimiter'>, 
</span>                                     <a href="../../../include/utils/typcache.h.html#LN114"><span class='Ref_to_Const'>TYPECACHE_EQ_OPR_FINFO</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4043"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN66"><span class='Ref_to_Member'>eq_opr_finfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN58"><span class='Ref_to_Member'>fn_oid</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_FUNCTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not identify an equality operator for type %s"</span><span class='Delimiter'>, 
</span>                       <a href="format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4042"><span class='Ref_To_Local'>element_type</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="arrayfuncs.c.html#LN4039"><span class='Ref_to_Parameter'>fn_extra</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="arrayfuncs.c.html#LN4043"><span class='Ref_To_Local'>typentry</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="arrayfuncs.c.html#LN4048"><span class='Ref_To_Local'>typlen</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN4043"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN34"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN4049"><span class='Ref_To_Local'>typbyval</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN4043"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN35"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN4050"><span class='Ref_To_Local'>typalign</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN4043"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN36"><span class='Ref_to_Member'>typalign</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Since we probably will need to scan array2 multiple times, it's 
     * worthwhile to use deconstruct_array on it.  We scan array1 the hard way 
     * however, since we very likely won't need to look at all of it. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/expandeddatum.h.html#LN127"><span class='Ref_to_Macro'>VARATT_IS_EXPANDED_HEADER</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4038"><span class='Ref_to_Parameter'>array2</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* This should be safe even if input is read-only */ 
</span>        <a href="array_expanded.c.html#LN422"><span class='Ref_to_Func'>deconstruct_expanded_array</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4038"><span class='Ref_to_Parameter'>array2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN160"><span class='Ref_to_Member'>xpn</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN4045"><span class='Ref_To_Local'>values2</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN4038"><span class='Ref_to_Parameter'>array2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN160"><span class='Ref_to_Member'>xpn</span></a><span class='Operator'>.</span><a href="../../../include/utils/array.h.html#LN129"><span class='Ref_to_Member'>dvalues</span></a><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN4046"><span class='Ref_To_Local'>nulls2</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN4038"><span class='Ref_to_Parameter'>array2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN160"><span class='Ref_to_Member'>xpn</span></a><span class='Operator'>.</span><a href="../../../include/utils/array.h.html#LN130"><span class='Ref_to_Member'>dnulls</span></a><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN4047"><span class='Ref_To_Local'>nelems2</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN4038"><span class='Ref_to_Parameter'>array2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN160"><span class='Ref_to_Member'>xpn</span></a><span class='Operator'>.</span><a href="../../../include/utils/array.h.html#LN132"><span class='Ref_to_Member'>nelems</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="../../../include/utils/array.h.html#LN382"><span class='Ref_to_Proto'>deconstruct_array</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4038"><span class='Ref_to_Parameter'>array2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN159"><span class='Ref_to_Member'>flt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                          <a href="arrayfuncs.c.html#LN4042"><span class='Ref_To_Local'>element_type</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4048"><span class='Ref_To_Local'>typlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4049"><span class='Ref_To_Local'>typbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4050"><span class='Ref_To_Local'>typalign</span></a><span class='Delimiter'>, 
</span>                          <span class='Operator'>&</span><a href="arrayfuncs.c.html#LN4045"><span class='Ref_To_Local'>values2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN4046"><span class='Ref_To_Local'>nulls2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN4047"><span class='Ref_To_Local'>nelems2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Apply the comparison operator to each pair of array elements. 
     */ 
</span>    <a href="../../../include/fmgr.h.html#LN119"><span class='Ref_to_Macro'>InitFunctionCallInfoData</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4054"><span class='Ref_To_Local'>locfcinfo</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN4043"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN66"><span class='Ref_to_Member'>eq_opr_finfo</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, 
</span>                             <a href="arrayfuncs.c.html#LN4038"><span class='Ref_to_Parameter'>collation</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Loop over source data */ 
</span>    <a href="arrayfuncs.c.html#LN4044"><span class='Ref_To_Local'>nelems1</span></a> <span class='Operator'>= </span><a href="arrayutils.c.html#LN73"><span class='Ref_to_Func'>ArrayGetNItems</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN308"><span class='Ref_to_Macro'>AARR_NDIM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4038"><span class='Ref_to_Parameter'>array1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/utils/array.h.html#LN316"><span class='Ref_to_Macro'>AARR_DIMS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4038"><span class='Ref_to_Parameter'>array1</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/arrayaccess.h.html#LN47"><span class='Ref_to_Func'>array_iter_setup</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN4053"><span class='Ref_To_Local'>it1</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4038"><span class='Ref_to_Parameter'>array1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4051"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN4051"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN4044"><span class='Ref_To_Local'>nelems1</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN4051"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4114"></a>        <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>elt1</span><span class='Delimiter'>; 
</span><a name="LN4115"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull1</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Get element, checking for NULL */ 
</span>        <a href="arrayfuncs.c.html#LN4114"><span class='Ref_To_Local'>elt1</span></a> <span class='Operator'>= </span><a href="../../../include/utils/arrayaccess.h.html#LN79"><span class='Ref_to_Func'>array_iter_next</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN4053"><span class='Ref_To_Local'>it1</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN4115"><span class='Ref_To_Local'>isnull1</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4051"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4048"><span class='Ref_To_Local'>typlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4049"><span class='Ref_To_Local'>typbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4050"><span class='Ref_To_Local'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We assume that the comparison operator is strict, so a NULL can't 
         * match anything.  XXX this diverges from the "NULL=NULL" behavior of 
         * array_eq, should we act like that? 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4115"><span class='Ref_To_Local'>isnull1</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4039"><span class='Ref_to_Parameter'>matchall</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="arrayfuncs.c.html#LN4041"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4052"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN4052"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN4047"><span class='Ref_To_Local'>nelems2</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN4052"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN4137"></a>            <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>elt2</span> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN4045"><span class='Ref_To_Local'>values2</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN4052"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]; 
</span><a name="LN4138"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull2</span> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN4046"><span class='Ref_To_Local'>nulls2</span></a> <span class='Operator'>? </span><a href="arrayfuncs.c.html#LN4046"><span class='Ref_To_Local'>nulls2</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN4052"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>] </span><span class='Operator'>: </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN4139"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>oprresult</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4138"><span class='Ref_To_Local'>isnull2</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* can't match */ 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Apply the operator to the element pair 
             */ 
</span>            <a href="arrayfuncs.c.html#LN4054"><span class='Ref_To_Local'>locfcinfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN84"><span class='Ref_to_Member'>arg</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="arrayfuncs.c.html#LN4114"><span class='Ref_To_Local'>elt1</span></a><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN4054"><span class='Ref_To_Local'>locfcinfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN84"><span class='Ref_to_Member'>arg</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="arrayfuncs.c.html#LN4137"><span class='Ref_To_Local'>elt2</span></a><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN4054"><span class='Ref_To_Local'>locfcinfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN85"><span class='Ref_to_Member'>argnull</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN4054"><span class='Ref_To_Local'>locfcinfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN85"><span class='Ref_to_Member'>argnull</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN4054"><span class='Ref_To_Local'>locfcinfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN82"><span class='Ref_to_Member'>isnull</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN4139"><span class='Ref_To_Local'>oprresult</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN136"><span class='Ref_to_Macro'>FunctionCallInvoke</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN4054"><span class='Ref_To_Local'>locfcinfo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4139"><span class='Ref_To_Local'>oprresult</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for j=0;j&LT;nelems2;j++ &raquo; </span> 
 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4052"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN4047"><span class='Ref_To_Local'>nelems2</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* found a match for elt1 */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="arrayfuncs.c.html#LN4039"><span class='Ref_to_Parameter'>matchall</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="arrayfuncs.c.html#LN4041"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* no match for elt1 */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4039"><span class='Ref_to_Parameter'>matchall</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="arrayfuncs.c.html#LN4041"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;nelems1;i++ &raquo; </span> 
 
    <span class='Control'>return</span> <a href="arrayfuncs.c.html#LN4041"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end array_contain_compare &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4181"></a><span class='Declare_Function'>arrayoverlap</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4183"></a>    <a href="../../../include/utils/array.h.html#LN157"><span class='Ref_to_Union'>AnyArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Local'>array1</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN254"><span class='Ref_to_Macro'>PG_GETARG_ANY_ARRAY</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4184"></a>    <a href="../../../include/utils/array.h.html#LN157"><span class='Ref_to_Union'>AnyArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Local'>array2</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN254"><span class='Ref_to_Macro'>PG_GETARG_ANY_ARRAY</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4185"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>collation</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN162"><span class='Ref_to_Macro'>PG_GET_COLLATION</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><a name="LN4186"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN4186"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN4037"><span class='Ref_to_Func'>array_contain_compare</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4183"><span class='Ref_To_Local'>array1</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4184"><span class='Ref_To_Local'>array2</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4185"><span class='Ref_To_Local'>collation</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                   <span class='Operator'>&</span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_extra<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Avoid leaking memory when handed toasted input. */ 
</span>    <a href="arrayfuncs.c.html#LN45"><span class='Ref_to_Macro'>AARR_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4183"><span class='Ref_To_Local'>array1</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN45"><span class='Ref_to_Macro'>AARR_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4184"><span class='Ref_To_Local'>array2</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4186"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4199"></a><span class='Declare_Function'>arraycontains</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4201"></a>    <a href="../../../include/utils/array.h.html#LN157"><span class='Ref_to_Union'>AnyArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Local'>array1</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN254"><span class='Ref_to_Macro'>PG_GETARG_ANY_ARRAY</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4202"></a>    <a href="../../../include/utils/array.h.html#LN157"><span class='Ref_to_Union'>AnyArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Local'>array2</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN254"><span class='Ref_to_Macro'>PG_GETARG_ANY_ARRAY</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4203"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>collation</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN162"><span class='Ref_to_Macro'>PG_GET_COLLATION</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><a name="LN4204"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN4204"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN4037"><span class='Ref_to_Func'>array_contain_compare</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4202"><span class='Ref_To_Local'>array2</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4201"><span class='Ref_To_Local'>array1</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4203"><span class='Ref_To_Local'>collation</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                   <span class='Operator'>&</span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_extra<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Avoid leaking memory when handed toasted input. */ 
</span>    <a href="arrayfuncs.c.html#LN45"><span class='Ref_to_Macro'>AARR_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4201"><span class='Ref_To_Local'>array1</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN45"><span class='Ref_to_Macro'>AARR_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4202"><span class='Ref_To_Local'>array2</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4204"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4217"></a><span class='Declare_Function'>arraycontained</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4219"></a>    <a href="../../../include/utils/array.h.html#LN157"><span class='Ref_to_Union'>AnyArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Local'>array1</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN254"><span class='Ref_to_Macro'>PG_GETARG_ANY_ARRAY</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4220"></a>    <a href="../../../include/utils/array.h.html#LN157"><span class='Ref_to_Union'>AnyArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Local'>array2</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN254"><span class='Ref_to_Macro'>PG_GETARG_ANY_ARRAY</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4221"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>collation</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN162"><span class='Ref_to_Macro'>PG_GET_COLLATION</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><a name="LN4222"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN4222"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN4037"><span class='Ref_to_Func'>array_contain_compare</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4219"><span class='Ref_To_Local'>array1</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4220"><span class='Ref_To_Local'>array2</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4221"><span class='Ref_To_Local'>collation</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                   <span class='Operator'>&</span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_extra<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Avoid leaking memory when handed toasted input. */ 
</span>    <a href="arrayfuncs.c.html#LN45"><span class='Ref_to_Macro'>AARR_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4219"><span class='Ref_To_Local'>array1</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN45"><span class='Ref_to_Macro'>AARR_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4220"><span class='Ref_To_Local'>array2</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4222"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/*----------------------------------------------------------------------------- 
 * Array iteration functions 
 *      These functions are used to iterate efficiently through arrays 
 *----------------------------------------------------------------------------- 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * array_create_iterator --- set up to iterate through an array 
 * 
 * If slice_ndim is zero, we will iterate element-by-element; the returned 
 * datums are of the array's element type. 
 * 
 * If slice_ndim is 1..ARR_NDIM(arr), we will iterate by slices: the 
 * returned datums are of the same array type as 'arr', but of size 
 * equal to the rightmost N dimensions of 'arr'. 
 * 
 * The passed-in array must remain valid for the lifetime of the iterator. 
 */ 
</span><a href="../../../include/utils/array.h.html#LN238"><span class='Ref_to_Typedef'>ArrayIterator</span></a> 
<a name="LN4254"></a><span class='Declare_Function'>array_create_iterator</span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arr</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>slice_ndim</span><span class='Delimiter'>, </span><a href="../../../include/utils/array.h.html#LN216"><span class='Ref_to_Struct'>ArrayMetaState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>mstate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4256"></a>    <a href="../../../include/utils/array.h.html#LN238"><span class='Ref_to_Typedef'>ArrayIterator</span></a> <span class='Declare_Local'>iterator</span> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN65"><span class='Ref_to_Struct'>ArrayIteratorData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Sanity-check inputs --- caller should have got this right already 
     */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN525"><span class='Ref_to_Macro'>PointerIsValid</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4254"><span class='Ref_to_Parameter'>arr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4254"><span class='Ref_to_Parameter'>slice_ndim</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="arrayfuncs.c.html#LN4254"><span class='Ref_to_Parameter'>slice_ndim</span></a> <span class='Operator'>&GT; </span><a href="../../../include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4254"><span class='Ref_to_Parameter'>arr</span></a><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid arguments to array_create_iterator"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Remember basic info about the array and its element type 
     */ 
</span>    <a href="arrayfuncs.c.html#LN4256"><span class='Ref_To_Local'>iterator</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN68"><span class='Ref_to_Member'>arr</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN4254"><span class='Ref_to_Parameter'>arr</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN4256"><span class='Ref_To_Local'>iterator</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN69"><span class='Ref_to_Member'>nullbitmap</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN280"><span class='Ref_to_Macro'>ARR_NULLBITMAP</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4254"><span class='Ref_to_Parameter'>arr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN4256"><span class='Ref_To_Local'>iterator</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN70"><span class='Ref_to_Member'>nitems</span></a> <span class='Operator'>= </span><a href="arrayutils.c.html#LN73"><span class='Ref_to_Func'>ArrayGetNItems</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4254"><span class='Ref_to_Parameter'>arr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4254"><span class='Ref_to_Parameter'>arr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4254"><span class='Ref_to_Parameter'>mstate</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4254"><span class='Ref_to_Parameter'>mstate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN218"><span class='Ref_to_Member'>element_type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/array.h.html#LN272"><span class='Ref_to_Macro'>ARR_ELEMTYPE</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4254"><span class='Ref_to_Parameter'>arr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="arrayfuncs.c.html#LN4256"><span class='Ref_To_Local'>iterator</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN71"><span class='Ref_to_Member'>typlen</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN4254"><span class='Ref_to_Parameter'>mstate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN219"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN4256"><span class='Ref_To_Local'>iterator</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN72"><span class='Ref_to_Member'>typbyval</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN4254"><span class='Ref_to_Parameter'>mstate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN220"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN4256"><span class='Ref_To_Local'>iterator</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN73"><span class='Ref_to_Member'>typalign</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN4254"><span class='Ref_to_Parameter'>mstate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN221"><span class='Ref_to_Member'>typalign</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="../../../include/utils/lsyscache.h.html#LN136"><span class='Ref_to_Proto'>get_typlenbyvalalign</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN272"><span class='Ref_to_Macro'>ARR_ELEMTYPE</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4254"><span class='Ref_to_Parameter'>arr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <span class='Operator'>&</span><a href="arrayfuncs.c.html#LN4256"><span class='Ref_To_Local'>iterator</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN71"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>, 
</span>                             <span class='Operator'>&</span><a href="arrayfuncs.c.html#LN4256"><span class='Ref_To_Local'>iterator</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN72"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>, 
</span>                             <span class='Operator'>&</span><a href="arrayfuncs.c.html#LN4256"><span class='Ref_To_Local'>iterator</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN73"><span class='Ref_to_Member'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Remember the slicing parameters. 
     */ 
</span>    <a href="arrayfuncs.c.html#LN4256"><span class='Ref_To_Local'>iterator</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN76"><span class='Ref_to_Member'>slice_ndim</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN4254"><span class='Ref_to_Parameter'>slice_ndim</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4254"><span class='Ref_to_Parameter'>slice_ndim</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Get pointers into the array's dims and lbound arrays to represent 
         * the dims/lbound arrays of a slice.  These are the same as the 
         * rightmost N dimensions of the array. 
         */ 
</span>        <a href="arrayfuncs.c.html#LN4256"><span class='Ref_To_Local'>iterator</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN78"><span class='Ref_to_Member'>slice_dims</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4254"><span class='Ref_to_Parameter'>arr</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="../../../include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4254"><span class='Ref_to_Parameter'>arr</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="arrayfuncs.c.html#LN4254"><span class='Ref_to_Parameter'>slice_ndim</span></a><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN4256"><span class='Ref_To_Local'>iterator</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN79"><span class='Ref_to_Member'>slice_lbound</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN276"><span class='Ref_to_Macro'>ARR_LBOUND</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4254"><span class='Ref_to_Parameter'>arr</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="../../../include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4254"><span class='Ref_to_Parameter'>arr</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="arrayfuncs.c.html#LN4254"><span class='Ref_to_Parameter'>slice_ndim</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Compute number of elements in a slice. 
         */ 
</span>        <a href="arrayfuncs.c.html#LN4256"><span class='Ref_To_Local'>iterator</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN77"><span class='Ref_to_Member'>slice_len</span></a> <span class='Operator'>= </span><a href="arrayutils.c.html#LN73"><span class='Ref_to_Func'>ArrayGetNItems</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4254"><span class='Ref_to_Parameter'>slice_ndim</span></a><span class='Delimiter'>, 
</span>                                             <a href="arrayfuncs.c.html#LN4256"><span class='Ref_To_Local'>iterator</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN78"><span class='Ref_to_Member'>slice_dims</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Create workspace for building sub-arrays. 
         */ 
</span>        <a href="arrayfuncs.c.html#LN4256"><span class='Ref_To_Local'>iterator</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN80"><span class='Ref_to_Member'>slice_values</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>            <a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4256"><span class='Ref_To_Local'>iterator</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN77"><span class='Ref_to_Member'>slice_len</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN4256"><span class='Ref_To_Local'>iterator</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN81"><span class='Ref_to_Member'>slice_nulls</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) 
</span>            <a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4256"><span class='Ref_To_Local'>iterator</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN77"><span class='Ref_to_Member'>slice_len</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if slice_ndim&GT;0 &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Initialize our data pointer and linear element number.  These will 
     * advance through the array during array_iterate(). 
     */ 
</span>    <a href="arrayfuncs.c.html#LN4256"><span class='Ref_To_Local'>iterator</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN84"><span class='Ref_to_Member'>data_ptr</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN302"><span class='Ref_to_Macro'>ARR_DATA_PTR</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4254"><span class='Ref_to_Parameter'>arr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN4256"><span class='Ref_To_Local'>iterator</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN85"><span class='Ref_to_Member'>current_item</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="arrayfuncs.c.html#LN4256"><span class='Ref_To_Local'>iterator</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end array_create_iterator &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Iterate through the array referenced by 'iterator'. 
 * 
 * As long as there is another element (or slice), return it into 
 * *value / *isnull, and return true.  Return false when no more data. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN4333"></a><span class='Declare_Function'>array_iterate</span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN238"><span class='Ref_to_Typedef'>ArrayIterator</span></a> <span class='Declare_Parameter'>iterator</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>value</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Done if we have reached the end of the array */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4333"><span class='Ref_to_Parameter'>iterator</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN85"><span class='Ref_to_Member'>current_item</span></a> <span class='Operator'>&GT;= </span><a href="arrayfuncs.c.html#LN4333"><span class='Ref_to_Parameter'>iterator</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN70"><span class='Ref_to_Member'>nitems</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4333"><span class='Ref_to_Parameter'>iterator</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN76"><span class='Ref_to_Member'>slice_ndim</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Scalar case: return one element. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN112"><span class='Ref_to_Proto'>array_get_isnull</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4333"><span class='Ref_to_Parameter'>iterator</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN69"><span class='Ref_to_Member'>nullbitmap</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4333"><span class='Ref_to_Parameter'>iterator</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN85"><span class='Ref_to_Member'>current_item</span></a><span class='Operator'>++</span><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Operator'>*</span><a href="arrayfuncs.c.html#LN4333"><span class='Ref_to_Parameter'>isnull</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><span class='Keyword'>value </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* non-NULL, so fetch the individual Datum to return */ 
</span><a name="LN4352"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>p</span> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN4333"><span class='Ref_to_Parameter'>iterator</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN84"><span class='Ref_to_Member'>data_ptr</span></a><span class='Delimiter'>; 
</span> 
            <span class='Operator'>*</span><a href="arrayfuncs.c.html#LN4333"><span class='Ref_to_Parameter'>isnull</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><span class='Keyword'>value </span><span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN43"><span class='Ref_to_Macro'>fetch_att</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4352"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4333"><span class='Ref_to_Parameter'>iterator</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN72"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4333"><span class='Ref_to_Parameter'>iterator</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN71"><span class='Ref_to_Member'>typlen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Move our data pointer forward to the next element */ 
</span>            <a href="arrayfuncs.c.html#LN4352"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN171"><span class='Ref_to_Macro'>att_addlength_pointer</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4352"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4333"><span class='Ref_to_Parameter'>iterator</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN71"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4352"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN4352"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/access/tupmacs.h.html#LN143"><span class='Ref_to_Macro'>att_align_nominal</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4352"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4333"><span class='Ref_to_Parameter'>iterator</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN73"><span class='Ref_to_Member'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN4333"><span class='Ref_to_Parameter'>iterator</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN84"><span class='Ref_to_Member'>data_ptr</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN4352"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if iterator-&GT;slice_ndim=... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Slice case: build and return an array of the requested size. 
         */ 
</span><a name="LN4368"></a>        <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN4369"></a>        <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>values</span> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN4333"><span class='Ref_to_Parameter'>iterator</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN80"><span class='Ref_to_Member'>slice_values</span></a><span class='Delimiter'>; 
</span><a name="LN4370"></a>        <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>nulls</span> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN4333"><span class='Ref_to_Parameter'>iterator</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN81"><span class='Ref_to_Member'>slice_nulls</span></a><span class='Delimiter'>; 
</span><a name="LN4371"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>p</span> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN4333"><span class='Ref_to_Parameter'>iterator</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN84"><span class='Ref_to_Member'>data_ptr</span></a><span class='Delimiter'>; 
</span><a name="LN4372"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4372"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN4372"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN4333"><span class='Ref_to_Parameter'>iterator</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN77"><span class='Ref_to_Member'>slice_len</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN4372"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN112"><span class='Ref_to_Proto'>array_get_isnull</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4333"><span class='Ref_to_Parameter'>iterator</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN69"><span class='Ref_to_Member'>nullbitmap</span></a><span class='Delimiter'>, 
</span>                                 <a href="arrayfuncs.c.html#LN4333"><span class='Ref_to_Parameter'>iterator</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN85"><span class='Ref_to_Member'>current_item</span></a><span class='Operator'>++</span><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="arrayfuncs.c.html#LN4370"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN4372"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="arrayfuncs.c.html#LN4369"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN4372"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="arrayfuncs.c.html#LN4370"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN4372"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <a href="arrayfuncs.c.html#LN4369"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN4372"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN43"><span class='Ref_to_Macro'>fetch_att</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4371"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4333"><span class='Ref_to_Parameter'>iterator</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN72"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4333"><span class='Ref_to_Parameter'>iterator</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN71"><span class='Ref_to_Member'>typlen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Move our data pointer forward to the next element */ 
</span>                <a href="arrayfuncs.c.html#LN4371"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN171"><span class='Ref_to_Macro'>att_addlength_pointer</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4371"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4333"><span class='Ref_to_Parameter'>iterator</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN71"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4371"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="arrayfuncs.c.html#LN4371"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/access/tupmacs.h.html#LN143"><span class='Ref_to_Macro'>att_align_nominal</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4371"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4333"><span class='Ref_to_Parameter'>iterator</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN73"><span class='Ref_to_Member'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="arrayfuncs.c.html#LN4333"><span class='Ref_to_Parameter'>iterator</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN84"><span class='Ref_to_Member'>data_ptr</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN4371"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>; 
</span> 
        <a href="arrayfuncs.c.html#LN4368"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN372"><span class='Ref_to_Proto'>construct_md_array</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4369"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, 
</span>                                    <a href="arrayfuncs.c.html#LN4370"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, 
</span>                                    <a href="arrayfuncs.c.html#LN4333"><span class='Ref_to_Parameter'>iterator</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN76"><span class='Ref_to_Member'>slice_ndim</span></a><span class='Delimiter'>, 
</span>                                    <a href="arrayfuncs.c.html#LN4333"><span class='Ref_to_Parameter'>iterator</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN78"><span class='Ref_to_Member'>slice_dims</span></a><span class='Delimiter'>, 
</span>                                    <a href="arrayfuncs.c.html#LN4333"><span class='Ref_to_Parameter'>iterator</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN79"><span class='Ref_to_Member'>slice_lbound</span></a><span class='Delimiter'>, 
</span>                                    <a href="../../../include/utils/array.h.html#LN272"><span class='Ref_to_Macro'>ARR_ELEMTYPE</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4333"><span class='Ref_to_Parameter'>iterator</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN68"><span class='Ref_to_Member'>arr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                    <a href="arrayfuncs.c.html#LN4333"><span class='Ref_to_Parameter'>iterator</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN71"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>, 
</span>                                    <a href="arrayfuncs.c.html#LN4333"><span class='Ref_to_Parameter'>iterator</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN72"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>, 
</span>                                    <a href="arrayfuncs.c.html#LN4333"><span class='Ref_to_Parameter'>iterator</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN73"><span class='Ref_to_Member'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Operator'>*</span><a href="arrayfuncs.c.html#LN4333"><span class='Ref_to_Parameter'>isnull</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><span class='Keyword'>value </span><span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4368"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end array_iterate &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Release an ArrayIterator data structure 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN4416"></a><span class='Declare_Function'>array_free_iterator</span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN238"><span class='Ref_to_Typedef'>ArrayIterator</span></a> <span class='Declare_Parameter'>iterator</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4416"><span class='Ref_to_Parameter'>iterator</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN76"><span class='Ref_to_Member'>slice_ndim</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4416"><span class='Ref_to_Parameter'>iterator</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN80"><span class='Ref_to_Member'>slice_values</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4416"><span class='Ref_to_Parameter'>iterator</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN81"><span class='Ref_to_Member'>slice_nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4416"><span class='Ref_to_Parameter'>iterator</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/***************************************************************************/ 
/******************|          Support  Routines           |*****************/ 
/***************************************************************************/ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Check whether a specific array element is NULL 
 * 
 * nullbitmap: pointer to array's null bitmap (NULL if none) 
 * offset: 0-based linear element number of array element 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN4438"></a><span class='Declare_Function'>array_get_isnull</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../../include/c.h.html#LN274"><span class='Ref_to_Typedef'>bits8</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>nullbitmap</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>offset</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4438"><span class='Ref_to_Parameter'>nullbitmap</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* assume not null */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4438"><span class='Ref_to_Parameter'>nullbitmap</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN4438"><span class='Ref_to_Parameter'>offset</span></a> <span class='Operator'>/ </span><span class='Number'>8</span><span class='Delimiter'>] </span><span class='Operator'>& </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4438"><span class='Ref_to_Parameter'>offset</span></a> <span class='Operator'>% </span><span class='Number'>8</span><span class='Parentheses'>)))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* not null */ 
</span>    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Set a specific array element's null-bitmap entry 
 * 
 * nullbitmap: pointer to array's null bitmap (mustn't be NULL) 
 * offset: 0-based linear element number of array element 
 * isNull: null status to set 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN4455"></a><span class='Declare_Function'>array_set_isnull</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN274"><span class='Ref_to_Typedef'>bits8</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>nullbitmap</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>offset</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isNull</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4457"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>bitmask</span><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN4455"><span class='Ref_to_Parameter'>nullbitmap</span></a> <span class='Operator'>+= </span><a href="arrayfuncs.c.html#LN4455"><span class='Ref_to_Parameter'>offset</span></a> <span class='Operator'>/ </span><span class='Number'>8</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN4457"><span class='Ref_To_Local'>bitmask</span></a> <span class='Operator'>= </span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4455"><span class='Ref_to_Parameter'>offset</span></a> <span class='Operator'>% </span><span class='Number'>8</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4455"><span class='Ref_to_Parameter'>isNull</span></a><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="arrayfuncs.c.html#LN4455"><span class='Ref_to_Parameter'>nullbitmap</span></a> <span class='Operator'>&= ~</span><a href="arrayfuncs.c.html#LN4457"><span class='Ref_To_Local'>bitmask</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Operator'>*</span><a href="arrayfuncs.c.html#LN4455"><span class='Ref_to_Parameter'>nullbitmap</span></a> <span class='Operator'>|= </span><a href="arrayfuncs.c.html#LN4457"><span class='Ref_To_Local'>bitmask</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Fetch array element at pointer, converted correctly to a Datum 
 * 
 * Caller must have handled case of NULL element 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4473"></a><span class='Declare_Function'>ArrayCast</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>value</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>byval</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>len</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="../../../include/access/tupmacs.h.html#LN43"><span class='Ref_to_Macro'>fetch_att</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4473"><span class='Ref_to_Parameter'>byval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4473"><span class='Ref_to_Parameter'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Copy datum to *dest and return total space used (including align padding) 
 * 
 * Caller must have handled case of NULL element 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN4484"></a><span class='Declare_Function'>ArrayCastAndSet</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>src</span><span class='Delimiter'>, 
</span><a name="LN4485"></a>                <span class='Keyword'>int </span><span class='Declare_Parameter'>typlen</span><span class='Delimiter'>, 
</span><a name="LN4486"></a>                <span class='Keyword'>bool </span><span class='Declare_Parameter'>typbyval</span><span class='Delimiter'>, 
</span><a name="LN4487"></a>                <span class='Keyword'>char </span><span class='Declare_Parameter'>typalign</span><span class='Delimiter'>, 
</span><a name="LN4488"></a>                <span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>dest</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4490"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>inc</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4485"><span class='Ref_to_Parameter'>typlen</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4486"><span class='Ref_to_Parameter'>typbyval</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/access/tupmacs.h.html#LN197"><span class='Ref_to_Macro'>store_att_byval</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4488"><span class='Ref_to_Parameter'>dest</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4484"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4485"><span class='Ref_to_Parameter'>typlen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../../include/c.h.html#LN1057"><span class='Ref_to_Macro'>memmove</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4488"><span class='Ref_to_Parameter'>dest</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4484"><span class='Ref_to_Parameter'>src</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4485"><span class='Ref_to_Parameter'>typlen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN4490"><span class='Ref_To_Local'>inc</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN143"><span class='Ref_to_Macro'>att_align_nominal</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4485"><span class='Ref_to_Parameter'>typlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4487"><span class='Ref_to_Parameter'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="arrayfuncs.c.html#LN4486"><span class='Ref_to_Parameter'>typbyval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN4490"><span class='Ref_To_Local'>inc</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN159"><span class='Ref_to_Macro'>att_addlength_datum</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4485"><span class='Ref_to_Parameter'>typlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4484"><span class='Ref_to_Parameter'>src</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/c.h.html#LN1057"><span class='Ref_to_Macro'>memmove</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4488"><span class='Ref_to_Parameter'>dest</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4484"><span class='Ref_to_Parameter'>src</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4490"><span class='Ref_To_Local'>inc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN4490"><span class='Ref_To_Local'>inc</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN143"><span class='Ref_to_Macro'>att_align_nominal</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4490"><span class='Ref_To_Local'>inc</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4487"><span class='Ref_to_Parameter'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="arrayfuncs.c.html#LN4490"><span class='Ref_To_Local'>inc</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ArrayCastAndSet &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Advance ptr over nitems array elements 
 * 
 * ptr: starting location in array 
 * offset: 0-based linear element number of first element (the one at *ptr) 
 * nullbitmap: start of array's null bitmap, or NULL if none 
 * nitems: number of array elements to advance over (&GT;= 0) 
 * typlen, typbyval, typalign: storage parameters of array element datatype 
 * 
 * It is caller's responsibility to ensure that nitems is within range 
 */ 
</span><span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN4523"></a><span class='Declare_Function'>array_seek</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>ptr</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>offset</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN274"><span class='Ref_to_Typedef'>bits8</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>nullbitmap</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>nitems</span><span class='Delimiter'>, 
</span><a name="LN4524"></a>           <span class='Keyword'>int </span><span class='Declare_Parameter'>typlen</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>typbyval</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>typalign</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4526"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>bitmask</span><span class='Delimiter'>; 
</span><a name="LN4527"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* easy if fixed-size elements and no NULLs */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4524"><span class='Ref_to_Parameter'>typlen</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& !</span><a href="arrayfuncs.c.html#LN4523"><span class='Ref_to_Parameter'>nullbitmap</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="arrayfuncs.c.html#LN4523"><span class='Ref_to_Parameter'>ptr</span></a> <span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN4523"><span class='Ref_to_Parameter'>nitems</span></a> <span class='Operator'>* </span><span class='Parentheses'>((</span><a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a><span class='Parentheses'>) </span><a href="../../../include/access/tupmacs.h.html#LN143"><span class='Ref_to_Macro'>att_align_nominal</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4524"><span class='Ref_to_Parameter'>typlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4524"><span class='Ref_to_Parameter'>typalign</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* seems worth having separate loops for NULL and no-NULLs cases */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4523"><span class='Ref_to_Parameter'>nullbitmap</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="arrayfuncs.c.html#LN4523"><span class='Ref_to_Parameter'>nullbitmap</span></a> <span class='Operator'>+= </span><a href="arrayfuncs.c.html#LN4523"><span class='Ref_to_Parameter'>offset</span></a> <span class='Operator'>/ </span><span class='Number'>8</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN4526"><span class='Ref_To_Local'>bitmask</span></a> <span class='Operator'>= </span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4523"><span class='Ref_to_Parameter'>offset</span></a> <span class='Operator'>% </span><span class='Number'>8</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4527"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN4527"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN4523"><span class='Ref_to_Parameter'>nitems</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN4527"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="arrayfuncs.c.html#LN4523"><span class='Ref_to_Parameter'>nullbitmap</span></a> <span class='Operator'>& </span><a href="arrayfuncs.c.html#LN4526"><span class='Ref_To_Local'>bitmask</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="arrayfuncs.c.html#LN4523"><span class='Ref_to_Parameter'>ptr</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN171"><span class='Ref_to_Macro'>att_addlength_pointer</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4523"><span class='Ref_to_Parameter'>ptr</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4524"><span class='Ref_to_Parameter'>typlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4523"><span class='Ref_to_Parameter'>ptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="arrayfuncs.c.html#LN4523"><span class='Ref_to_Parameter'>ptr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/access/tupmacs.h.html#LN143"><span class='Ref_to_Macro'>att_align_nominal</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4523"><span class='Ref_to_Parameter'>ptr</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4524"><span class='Ref_to_Parameter'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="arrayfuncs.c.html#LN4526"><span class='Ref_To_Local'>bitmask</span></a> <span class='Operator'>&LT;&LT;= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4526"><span class='Ref_To_Local'>bitmask</span></a> <span class='Operator'>== </span><span class='Number'>0x100</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="arrayfuncs.c.html#LN4523"><span class='Ref_to_Parameter'>nullbitmap</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <a href="arrayfuncs.c.html#LN4526"><span class='Ref_To_Local'>bitmask</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if nullbitmap &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4527"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN4527"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN4523"><span class='Ref_to_Parameter'>nitems</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN4527"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="arrayfuncs.c.html#LN4523"><span class='Ref_to_Parameter'>ptr</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN171"><span class='Ref_to_Macro'>att_addlength_pointer</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4523"><span class='Ref_to_Parameter'>ptr</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4524"><span class='Ref_to_Parameter'>typlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4523"><span class='Ref_to_Parameter'>ptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN4523"><span class='Ref_to_Parameter'>ptr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/access/tupmacs.h.html#LN143"><span class='Ref_to_Macro'>att_align_nominal</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4523"><span class='Ref_to_Parameter'>ptr</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4524"><span class='Ref_to_Parameter'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="arrayfuncs.c.html#LN4523"><span class='Ref_to_Parameter'>ptr</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end array_seek &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Compute total size of the nitems array elements starting at *ptr 
 * 
 * Parameters same as for array_seek 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN4571"></a><span class='Declare_Function'>array_nelems_size</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>ptr</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>offset</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN274"><span class='Ref_to_Typedef'>bits8</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>nullbitmap</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>nitems</span><span class='Delimiter'>, 
</span><a name="LN4572"></a>                  <span class='Keyword'>int </span><span class='Declare_Parameter'>typlen</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>typbyval</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>typalign</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="arrayfuncs.c.html#LN118"><span class='Ref_to_Proto'>array_seek</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4571"><span class='Ref_to_Parameter'>ptr</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4571"><span class='Ref_to_Parameter'>offset</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4571"><span class='Ref_to_Parameter'>nullbitmap</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4571"><span class='Ref_to_Parameter'>nitems</span></a><span class='Delimiter'>, 
</span>                      <a href="arrayfuncs.c.html#LN4572"><span class='Ref_to_Parameter'>typlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4572"><span class='Ref_to_Parameter'>typbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4572"><span class='Ref_to_Parameter'>typalign</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="arrayfuncs.c.html#LN4571"><span class='Ref_to_Parameter'>ptr</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Copy nitems array elements from srcptr to destptr 
 * 
 * destptr: starting destination location (must be enough room!) 
 * nitems: number of array elements to copy (&GT;= 0) 
 * srcptr: starting location in source array 
 * offset: 0-based linear element number of first element (the one at *srcptr) 
 * nullbitmap: start of source array's null bitmap, or NULL if none 
 * typlen, typbyval, typalign: storage parameters of array element datatype 
 * 
 * Returns number of bytes copied 
 * 
 * NB: this does not take care of setting up the destination's null bitmap! 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN4593"></a><span class='Declare_Function'>array_copy</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>destptr</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>nitems</span><span class='Delimiter'>, 
</span><a name="LN4594"></a>           <span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>srcptr</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>offset</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN274"><span class='Ref_to_Typedef'>bits8</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>nullbitmap</span><span class='Delimiter'>, 
</span><a name="LN4595"></a>           <span class='Keyword'>int </span><span class='Declare_Parameter'>typlen</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>typbyval</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>typalign</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4597"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>numbytes</span><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN4597"><span class='Ref_To_Local'>numbytes</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN120"><span class='Ref_to_Proto'>array_nelems_size</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4594"><span class='Ref_to_Parameter'>srcptr</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4594"><span class='Ref_to_Parameter'>offset</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4594"><span class='Ref_to_Parameter'>nullbitmap</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4593"><span class='Ref_to_Parameter'>nitems</span></a><span class='Delimiter'>, 
</span>                                 <a href="arrayfuncs.c.html#LN4595"><span class='Ref_to_Parameter'>typlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4595"><span class='Ref_to_Parameter'>typbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4595"><span class='Ref_to_Parameter'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4593"><span class='Ref_to_Parameter'>destptr</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4594"><span class='Ref_to_Parameter'>srcptr</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4597"><span class='Ref_To_Local'>numbytes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="arrayfuncs.c.html#LN4597"><span class='Ref_To_Local'>numbytes</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Copy nitems null-bitmap bits from source to destination 
 * 
 * destbitmap: start of destination array's null bitmap (mustn't be NULL) 
 * destoffset: 0-based linear element number of first dest element 
 * srcbitmap: start of source array's null bitmap, or NULL if none 
 * srcoffset: 0-based linear element number of first source element 
 * nitems: number of bits to copy (&GT;= 0) 
 * 
 * If srcbitmap is NULL then we assume the source is all-non-NULL and 
 * fill 1's into the destination bitmap.  Note that only the specified 
 * bits in the destination map are changed, not any before or after. 
 * 
 * Note: this could certainly be optimized using standard bitblt methods. 
 * However, it's not clear that the typical Postgres array has enough elements 
 * to make it worth worrying too much.  For the moment, KISS. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN4623"></a><span class='Declare_Function'>array_bitmap_copy</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN274"><span class='Ref_to_Typedef'>bits8</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>destbitmap</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>destoffset</span><span class='Delimiter'>, 
</span><a name="LN4624"></a>                  <span class='Keyword'>const </span><a href="../../../include/c.h.html#LN274"><span class='Ref_to_Typedef'>bits8</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>srcbitmap</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>srcoffset</span><span class='Delimiter'>, 
</span><a name="LN4625"></a>                  <span class='Keyword'>int </span><span class='Declare_Parameter'>nitems</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4627"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>destbitmask</span><span class='Delimiter'>, 
</span><a name="LN4628"></a>                <span class='Declare_Local'>destbitval</span><span class='Delimiter'>, 
</span><a name="LN4629"></a>                <span class='Declare_Local'>srcbitmask</span><span class='Delimiter'>, 
</span><a name="LN4630"></a>                <span class='Declare_Local'>srcbitval</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4623"><span class='Ref_to_Parameter'>destbitmap</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4625"><span class='Ref_to_Parameter'>nitems</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>;</span>                 <span class='Comment_Single_Line'>/* don't risk fetch off end of memory */ 
</span>    <a href="arrayfuncs.c.html#LN4623"><span class='Ref_to_Parameter'>destbitmap</span></a> <span class='Operator'>+= </span><a href="arrayfuncs.c.html#LN4623"><span class='Ref_to_Parameter'>destoffset</span></a> <span class='Operator'>/ </span><span class='Number'>8</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN4627"><span class='Ref_To_Local'>destbitmask</span></a> <span class='Operator'>= </span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4623"><span class='Ref_to_Parameter'>destoffset</span></a> <span class='Operator'>% </span><span class='Number'>8</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN4628"><span class='Ref_To_Local'>destbitval</span></a> <span class='Operator'>= *</span><a href="arrayfuncs.c.html#LN4623"><span class='Ref_to_Parameter'>destbitmap</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4624"><span class='Ref_to_Parameter'>srcbitmap</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="arrayfuncs.c.html#LN4624"><span class='Ref_to_Parameter'>srcbitmap</span></a> <span class='Operator'>+= </span><a href="arrayfuncs.c.html#LN4624"><span class='Ref_to_Parameter'>srcoffset</span></a> <span class='Operator'>/ </span><span class='Number'>8</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN4629"><span class='Ref_To_Local'>srcbitmask</span></a> <span class='Operator'>= </span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4624"><span class='Ref_to_Parameter'>srcoffset</span></a> <span class='Operator'>% </span><span class='Number'>8</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN4630"><span class='Ref_To_Local'>srcbitval</span></a> <span class='Operator'>= *</span><a href="arrayfuncs.c.html#LN4624"><span class='Ref_to_Parameter'>srcbitmap</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4625"><span class='Ref_to_Parameter'>nitems</span></a><span class='Operator'>-- &GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4630"><span class='Ref_To_Local'>srcbitval</span></a> <span class='Operator'>& </span><a href="arrayfuncs.c.html#LN4629"><span class='Ref_To_Local'>srcbitmask</span></a><span class='Parentheses'>) 
</span>                <a href="arrayfuncs.c.html#LN4628"><span class='Ref_To_Local'>destbitval</span></a> <span class='Operator'>|= </span><a href="arrayfuncs.c.html#LN4627"><span class='Ref_To_Local'>destbitmask</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="arrayfuncs.c.html#LN4628"><span class='Ref_To_Local'>destbitval</span></a> <span class='Operator'>&= ~</span><a href="arrayfuncs.c.html#LN4627"><span class='Ref_To_Local'>destbitmask</span></a><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN4627"><span class='Ref_To_Local'>destbitmask</span></a> <span class='Operator'>&LT;&LT;= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4627"><span class='Ref_To_Local'>destbitmask</span></a> <span class='Operator'>== </span><span class='Number'>0x100</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Operator'>*</span><a href="arrayfuncs.c.html#LN4623"><span class='Ref_to_Parameter'>destbitmap</span></a><span class='Operator'>++ = </span><a href="arrayfuncs.c.html#LN4628"><span class='Ref_To_Local'>destbitval</span></a><span class='Delimiter'>; 
</span>                <a href="arrayfuncs.c.html#LN4627"><span class='Ref_To_Local'>destbitmask</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4625"><span class='Ref_to_Parameter'>nitems</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <a href="arrayfuncs.c.html#LN4628"><span class='Ref_To_Local'>destbitval</span></a> <span class='Operator'>= *</span><a href="arrayfuncs.c.html#LN4623"><span class='Ref_to_Parameter'>destbitmap</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="arrayfuncs.c.html#LN4629"><span class='Ref_To_Local'>srcbitmask</span></a> <span class='Operator'>&LT;&LT;= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4629"><span class='Ref_To_Local'>srcbitmask</span></a> <span class='Operator'>== </span><span class='Number'>0x100</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="arrayfuncs.c.html#LN4624"><span class='Ref_to_Parameter'>srcbitmap</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <a href="arrayfuncs.c.html#LN4629"><span class='Ref_To_Local'>srcbitmask</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4625"><span class='Ref_to_Parameter'>nitems</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <a href="arrayfuncs.c.html#LN4630"><span class='Ref_To_Local'>srcbitval</span></a> <span class='Operator'>= *</span><a href="arrayfuncs.c.html#LN4624"><span class='Ref_to_Parameter'>srcbitmap</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while nitems--&GT;0 &raquo; </span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4627"><span class='Ref_To_Local'>destbitmask</span></a> <span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <span class='Operator'>*</span><a href="arrayfuncs.c.html#LN4623"><span class='Ref_to_Parameter'>destbitmap</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN4628"><span class='Ref_To_Local'>destbitval</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if srcbitmap &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4625"><span class='Ref_to_Parameter'>nitems</span></a><span class='Operator'>-- &GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="arrayfuncs.c.html#LN4628"><span class='Ref_To_Local'>destbitval</span></a> <span class='Operator'>|= </span><a href="arrayfuncs.c.html#LN4627"><span class='Ref_To_Local'>destbitmask</span></a><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN4627"><span class='Ref_To_Local'>destbitmask</span></a> <span class='Operator'>&LT;&LT;= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4627"><span class='Ref_To_Local'>destbitmask</span></a> <span class='Operator'>== </span><span class='Number'>0x100</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Operator'>*</span><a href="arrayfuncs.c.html#LN4623"><span class='Ref_to_Parameter'>destbitmap</span></a><span class='Operator'>++ = </span><a href="arrayfuncs.c.html#LN4628"><span class='Ref_To_Local'>destbitval</span></a><span class='Delimiter'>; 
</span>                <a href="arrayfuncs.c.html#LN4627"><span class='Ref_To_Local'>destbitmask</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4625"><span class='Ref_to_Parameter'>nitems</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <a href="arrayfuncs.c.html#LN4628"><span class='Ref_To_Local'>destbitval</span></a> <span class='Operator'>= *</span><a href="arrayfuncs.c.html#LN4623"><span class='Ref_to_Parameter'>destbitmap</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4627"><span class='Ref_To_Local'>destbitmask</span></a> <span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <span class='Operator'>*</span><a href="arrayfuncs.c.html#LN4623"><span class='Ref_to_Parameter'>destbitmap</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN4628"><span class='Ref_To_Local'>destbitval</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end array_bitmap_copy &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Compute space needed for a slice of an array 
 * 
 * We assume the caller has verified that the slice coordinates are valid. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN4694"></a><span class='Declare_Function'>array_slice_size</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>arraydataptr</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN274"><span class='Ref_to_Typedef'>bits8</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arraynullsptr</span><span class='Delimiter'>, 
</span><a name="LN4695"></a>                 <span class='Keyword'>int </span><span class='Declare_Parameter'>ndim</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>dim</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>lb</span><span class='Delimiter'>, 
</span><a name="LN4696"></a>                 <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>st</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>endp</span><span class='Delimiter'>, 
</span><a name="LN4697"></a>                 <span class='Keyword'>int </span><span class='Declare_Parameter'>typlen</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>typbyval</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>typalign</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4699"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>src_offset</span><span class='Delimiter'>, 
</span><a name="LN4700"></a>                <span class='Declare_Local'>span</span><span class='Delimiter'>[</span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Delimiter'>], 
</span><a name="LN4701"></a>                <span class='Declare_Local'>prod</span><span class='Delimiter'>[</span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Delimiter'>], 
</span><a name="LN4702"></a>                <span class='Declare_Local'>dist</span><span class='Delimiter'>[</span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Delimiter'>], 
</span><a name="LN4703"></a>                <span class='Declare_Local'>indx</span><span class='Delimiter'>[</span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Delimiter'>]; 
</span><a name="LN4704"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>ptr</span><span class='Delimiter'>; 
</span><a name="LN4705"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN4706"></a>                <span class='Declare_Local'>j</span><span class='Delimiter'>, 
</span><a name="LN4707"></a>                <span class='Declare_Local'>inc</span><span class='Delimiter'>; 
</span><a name="LN4708"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>count</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="arrayutils.c.html#LN118"><span class='Ref_to_Func'>mda_get_range</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4695"><span class='Ref_to_Parameter'>ndim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4700"><span class='Ref_To_Local'>span</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4696"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4696"><span class='Ref_to_Parameter'>endp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Pretty easy for fixed element length without nulls ... */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4697"><span class='Ref_to_Parameter'>typlen</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& !</span><a href="arrayfuncs.c.html#LN4694"><span class='Ref_to_Parameter'>arraynullsptr</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="arrayutils.c.html#LN73"><span class='Ref_to_Func'>ArrayGetNItems</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4695"><span class='Ref_to_Parameter'>ndim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4700"><span class='Ref_To_Local'>span</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="../../../include/access/tupmacs.h.html#LN143"><span class='Ref_to_Macro'>att_align_nominal</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4697"><span class='Ref_to_Parameter'>typlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4697"><span class='Ref_to_Parameter'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Else gotta do it the hard way */ 
</span>    <a href="arrayfuncs.c.html#LN4699"><span class='Ref_To_Local'>src_offset</span></a> <span class='Operator'>= </span><a href="arrayutils.c.html#LN29"><span class='Ref_to_Func'>ArrayGetOffset</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4695"><span class='Ref_to_Parameter'>ndim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4695"><span class='Ref_to_Parameter'>dim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4695"><span class='Ref_to_Parameter'>lb</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4696"><span class='Ref_to_Parameter'>st</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN4704"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN118"><span class='Ref_to_Proto'>array_seek</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4694"><span class='Ref_to_Parameter'>arraydataptr</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4694"><span class='Ref_to_Parameter'>arraynullsptr</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4699"><span class='Ref_To_Local'>src_offset</span></a><span class='Delimiter'>, 
</span>                     <a href="arrayfuncs.c.html#LN4697"><span class='Ref_to_Parameter'>typlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4697"><span class='Ref_to_Parameter'>typbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4697"><span class='Ref_to_Parameter'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayutils.c.html#LN132"><span class='Ref_to_Func'>mda_get_prod</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4695"><span class='Ref_to_Parameter'>ndim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4695"><span class='Ref_to_Parameter'>dim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4701"><span class='Ref_To_Local'>prod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayutils.c.html#LN148"><span class='Ref_to_Func'>mda_get_offset_values</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4695"><span class='Ref_to_Parameter'>ndim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4702"><span class='Ref_To_Local'>dist</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4701"><span class='Ref_To_Local'>prod</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4700"><span class='Ref_To_Local'>span</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4705"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN4705"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN4695"><span class='Ref_to_Parameter'>ndim</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN4705"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <a href="arrayfuncs.c.html#LN4703"><span class='Ref_To_Local'>indx</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN4705"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN4706"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN4695"><span class='Ref_to_Parameter'>ndim</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>do</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4702"><span class='Ref_To_Local'>dist</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN4706"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="arrayfuncs.c.html#LN4704"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN118"><span class='Ref_to_Proto'>array_seek</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4704"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4699"><span class='Ref_To_Local'>src_offset</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4694"><span class='Ref_to_Parameter'>arraynullsptr</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4702"><span class='Ref_To_Local'>dist</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN4706"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>], 
</span>                             <a href="arrayfuncs.c.html#LN4697"><span class='Ref_to_Parameter'>typlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4697"><span class='Ref_to_Parameter'>typbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4697"><span class='Ref_to_Parameter'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN4699"><span class='Ref_To_Local'>src_offset</span></a> <span class='Operator'>+= </span><a href="arrayfuncs.c.html#LN4702"><span class='Ref_To_Local'>dist</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN4706"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="arrayfuncs.c.html#LN112"><span class='Ref_to_Proto'>array_get_isnull</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4694"><span class='Ref_to_Parameter'>arraynullsptr</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4699"><span class='Ref_To_Local'>src_offset</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="arrayfuncs.c.html#LN4707"><span class='Ref_To_Local'>inc</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN171"><span class='Ref_to_Macro'>att_addlength_pointer</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4697"><span class='Ref_to_Parameter'>typlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4704"><span class='Ref_To_Local'>ptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN4707"><span class='Ref_To_Local'>inc</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN143"><span class='Ref_to_Macro'>att_align_nominal</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4707"><span class='Ref_To_Local'>inc</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4697"><span class='Ref_to_Parameter'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN4704"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>+= </span><a href="arrayfuncs.c.html#LN4707"><span class='Ref_To_Local'>inc</span></a><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN4708"><span class='Ref_To_Local'>count</span></a> <span class='Operator'>+= </span><a href="arrayfuncs.c.html#LN4707"><span class='Ref_To_Local'>inc</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="arrayfuncs.c.html#LN4699"><span class='Ref_To_Local'>src_offset</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>((</span><a href="arrayfuncs.c.html#LN4706"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><a href="arrayutils.c.html#LN173"><span class='Ref_to_Func'>mda_next_tuple</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4695"><span class='Ref_to_Parameter'>ndim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4703"><span class='Ref_To_Local'>indx</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4700"><span class='Ref_To_Local'>span</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= -</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="arrayfuncs.c.html#LN4708"><span class='Ref_To_Local'>count</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end array_slice_size &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Extract a slice of an array into consecutive elements in the destination 
 * array. 
 * 
 * We assume the caller has verified that the slice coordinates are valid, 
 * allocated enough storage for the result, and initialized the header 
 * of the new array. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN4754"></a><span class='Declare_Function'>array_extract_slice</span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>newarray</span><span class='Delimiter'>, 
</span><a name="LN4755"></a>                    <span class='Keyword'>int </span><span class='Declare_Parameter'>ndim</span><span class='Delimiter'>, 
</span><a name="LN4756"></a>                    <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>dim</span><span class='Delimiter'>, 
</span><a name="LN4757"></a>                    <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>lb</span><span class='Delimiter'>, 
</span><a name="LN4758"></a>                    <span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>arraydataptr</span><span class='Delimiter'>, 
</span><a name="LN4759"></a>                    <a href="../../../include/c.h.html#LN274"><span class='Ref_to_Typedef'>bits8</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arraynullsptr</span><span class='Delimiter'>, 
</span><a name="LN4760"></a>                    <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>st</span><span class='Delimiter'>, 
</span><a name="LN4761"></a>                    <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>endp</span><span class='Delimiter'>, 
</span><a name="LN4762"></a>                    <span class='Keyword'>int </span><span class='Declare_Parameter'>typlen</span><span class='Delimiter'>, 
</span><a name="LN4763"></a>                    <span class='Keyword'>bool </span><span class='Declare_Parameter'>typbyval</span><span class='Delimiter'>, 
</span><a name="LN4764"></a>                    <span class='Keyword'>char </span><span class='Declare_Parameter'>typalign</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4766"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>destdataptr</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN302"><span class='Ref_to_Macro'>ARR_DATA_PTR</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4754"><span class='Ref_to_Parameter'>newarray</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4767"></a>    <a href="../../../include/c.h.html#LN274"><span class='Ref_to_Typedef'>bits8</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>destnullsptr</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN280"><span class='Ref_to_Macro'>ARR_NULLBITMAP</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4754"><span class='Ref_to_Parameter'>newarray</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4768"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>srcdataptr</span><span class='Delimiter'>; 
</span><a name="LN4769"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>src_offset</span><span class='Delimiter'>, 
</span><a name="LN4770"></a>                <span class='Declare_Local'>dest_offset</span><span class='Delimiter'>, 
</span><a name="LN4771"></a>                <span class='Declare_Local'>prod</span><span class='Delimiter'>[</span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Delimiter'>], 
</span><a name="LN4772"></a>                <span class='Declare_Local'>span</span><span class='Delimiter'>[</span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Delimiter'>], 
</span><a name="LN4773"></a>                <span class='Declare_Local'>dist</span><span class='Delimiter'>[</span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Delimiter'>], 
</span><a name="LN4774"></a>                <span class='Declare_Local'>indx</span><span class='Delimiter'>[</span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Delimiter'>]; 
</span><a name="LN4775"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN4776"></a>                <span class='Declare_Local'>j</span><span class='Delimiter'>, 
</span><a name="LN4777"></a>                <span class='Declare_Local'>inc</span><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN4769"><span class='Ref_To_Local'>src_offset</span></a> <span class='Operator'>= </span><a href="arrayutils.c.html#LN29"><span class='Ref_to_Func'>ArrayGetOffset</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4755"><span class='Ref_to_Parameter'>ndim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4756"><span class='Ref_to_Parameter'>dim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4757"><span class='Ref_to_Parameter'>lb</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4760"><span class='Ref_to_Parameter'>st</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN4768"><span class='Ref_To_Local'>srcdataptr</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN118"><span class='Ref_to_Proto'>array_seek</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4758"><span class='Ref_to_Parameter'>arraydataptr</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4759"><span class='Ref_to_Parameter'>arraynullsptr</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4769"><span class='Ref_To_Local'>src_offset</span></a><span class='Delimiter'>, 
</span>                            <a href="arrayfuncs.c.html#LN4762"><span class='Ref_to_Parameter'>typlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4763"><span class='Ref_to_Parameter'>typbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4764"><span class='Ref_to_Parameter'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayutils.c.html#LN132"><span class='Ref_to_Func'>mda_get_prod</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4755"><span class='Ref_to_Parameter'>ndim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4756"><span class='Ref_to_Parameter'>dim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4771"><span class='Ref_To_Local'>prod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayutils.c.html#LN118"><span class='Ref_to_Func'>mda_get_range</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4755"><span class='Ref_to_Parameter'>ndim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4772"><span class='Ref_To_Local'>span</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4760"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4761"><span class='Ref_to_Parameter'>endp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayutils.c.html#LN148"><span class='Ref_to_Func'>mda_get_offset_values</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4755"><span class='Ref_to_Parameter'>ndim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4773"><span class='Ref_To_Local'>dist</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4771"><span class='Ref_To_Local'>prod</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4772"><span class='Ref_To_Local'>span</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4775"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN4775"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN4755"><span class='Ref_to_Parameter'>ndim</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN4775"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <a href="arrayfuncs.c.html#LN4774"><span class='Ref_To_Local'>indx</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN4775"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN4770"><span class='Ref_To_Local'>dest_offset</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN4776"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN4755"><span class='Ref_to_Parameter'>ndim</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>do</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4773"><span class='Ref_To_Local'>dist</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN4776"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* skip unwanted elements */ 
</span>            <a href="arrayfuncs.c.html#LN4768"><span class='Ref_To_Local'>srcdataptr</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN118"><span class='Ref_to_Proto'>array_seek</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4768"><span class='Ref_To_Local'>srcdataptr</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4769"><span class='Ref_To_Local'>src_offset</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4759"><span class='Ref_to_Parameter'>arraynullsptr</span></a><span class='Delimiter'>, 
</span>                                    <a href="arrayfuncs.c.html#LN4773"><span class='Ref_To_Local'>dist</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN4776"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>], 
</span>                                    <a href="arrayfuncs.c.html#LN4762"><span class='Ref_to_Parameter'>typlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4763"><span class='Ref_to_Parameter'>typbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4764"><span class='Ref_to_Parameter'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN4769"><span class='Ref_To_Local'>src_offset</span></a> <span class='Operator'>+= </span><a href="arrayfuncs.c.html#LN4773"><span class='Ref_To_Local'>dist</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN4776"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]; 
</span>        <span class='Delimiter'>} 
</span>        <a href="arrayfuncs.c.html#LN4777"><span class='Ref_To_Local'>inc</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN122"><span class='Ref_to_Proto'>array_copy</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4766"><span class='Ref_To_Local'>destdataptr</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                         <a href="arrayfuncs.c.html#LN4768"><span class='Ref_To_Local'>srcdataptr</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4769"><span class='Ref_To_Local'>src_offset</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4759"><span class='Ref_to_Parameter'>arraynullsptr</span></a><span class='Delimiter'>, 
</span>                         <a href="arrayfuncs.c.html#LN4762"><span class='Ref_to_Parameter'>typlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4763"><span class='Ref_to_Parameter'>typbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4764"><span class='Ref_to_Parameter'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4767"><span class='Ref_To_Local'>destnullsptr</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/array.h.html#LN365"><span class='Ref_to_Proto'>array_bitmap_copy</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4767"><span class='Ref_To_Local'>destnullsptr</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4770"><span class='Ref_To_Local'>dest_offset</span></a><span class='Delimiter'>, 
</span>                              <a href="arrayfuncs.c.html#LN4759"><span class='Ref_to_Parameter'>arraynullsptr</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4769"><span class='Ref_To_Local'>src_offset</span></a><span class='Delimiter'>, 
</span>                              <span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN4766"><span class='Ref_To_Local'>destdataptr</span></a> <span class='Operator'>+= </span><a href="arrayfuncs.c.html#LN4777"><span class='Ref_To_Local'>inc</span></a><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN4768"><span class='Ref_To_Local'>srcdataptr</span></a> <span class='Operator'>+= </span><a href="arrayfuncs.c.html#LN4777"><span class='Ref_To_Local'>inc</span></a><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN4769"><span class='Ref_To_Local'>src_offset</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN4770"><span class='Ref_To_Local'>dest_offset</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end do &raquo; </span> <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="arrayfuncs.c.html#LN4776"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><a href="arrayutils.c.html#LN173"><span class='Ref_to_Func'>mda_next_tuple</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4755"><span class='Ref_to_Parameter'>ndim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4774"><span class='Ref_To_Local'>indx</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4772"><span class='Ref_To_Local'>span</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= -</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end array_extract_slice &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Insert a slice into an array. 
 * 
 * ndim/dim[]/lb[] are dimensions of the original array.  A new array with 
 * those same dimensions is to be constructed.  destArray must already 
 * have been allocated and its header initialized. 
 * 
 * st[]/endp[] identify the slice to be replaced.  Elements within the slice 
 * volume are taken from consecutive elements of the srcArray; elements 
 * outside it are copied from origArray. 
 * 
 * We assume the caller has verified that the slice coordinates are valid. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN4827"></a><span class='Declare_Function'>array_insert_slice</span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>destArray</span><span class='Delimiter'>, 
</span><a name="LN4828"></a>                   <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>origArray</span><span class='Delimiter'>, 
</span><a name="LN4829"></a>                   <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>srcArray</span><span class='Delimiter'>, 
</span><a name="LN4830"></a>                   <span class='Keyword'>int </span><span class='Declare_Parameter'>ndim</span><span class='Delimiter'>, 
</span><a name="LN4831"></a>                   <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>dim</span><span class='Delimiter'>, 
</span><a name="LN4832"></a>                   <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>lb</span><span class='Delimiter'>, 
</span><a name="LN4833"></a>                   <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>st</span><span class='Delimiter'>, 
</span><a name="LN4834"></a>                   <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>endp</span><span class='Delimiter'>, 
</span><a name="LN4835"></a>                   <span class='Keyword'>int </span><span class='Declare_Parameter'>typlen</span><span class='Delimiter'>, 
</span><a name="LN4836"></a>                   <span class='Keyword'>bool </span><span class='Declare_Parameter'>typbyval</span><span class='Delimiter'>, 
</span><a name="LN4837"></a>                   <span class='Keyword'>char </span><span class='Declare_Parameter'>typalign</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4839"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>destPtr</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN302"><span class='Ref_to_Macro'>ARR_DATA_PTR</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4827"><span class='Ref_to_Parameter'>destArray</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4840"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>origPtr</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN302"><span class='Ref_to_Macro'>ARR_DATA_PTR</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4828"><span class='Ref_to_Parameter'>origArray</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4841"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>srcPtr</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN302"><span class='Ref_to_Macro'>ARR_DATA_PTR</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4829"><span class='Ref_to_Parameter'>srcArray</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4842"></a>    <a href="../../../include/c.h.html#LN274"><span class='Ref_to_Typedef'>bits8</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>destBitmap</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN280"><span class='Ref_to_Macro'>ARR_NULLBITMAP</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4827"><span class='Ref_to_Parameter'>destArray</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4843"></a>    <a href="../../../include/c.h.html#LN274"><span class='Ref_to_Typedef'>bits8</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>origBitmap</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN280"><span class='Ref_to_Macro'>ARR_NULLBITMAP</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4828"><span class='Ref_to_Parameter'>origArray</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4844"></a>    <a href="../../../include/c.h.html#LN274"><span class='Ref_to_Typedef'>bits8</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>srcBitmap</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN280"><span class='Ref_to_Macro'>ARR_NULLBITMAP</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4829"><span class='Ref_to_Parameter'>srcArray</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4845"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>orignitems</span> <span class='Operator'>= </span><a href="arrayutils.c.html#LN73"><span class='Ref_to_Func'>ArrayGetNItems</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4828"><span class='Ref_to_Parameter'>origArray</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                            <a href="../../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4828"><span class='Ref_to_Parameter'>origArray</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN4847"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>dest_offset</span><span class='Delimiter'>, 
</span><a name="LN4848"></a>                <span class='Declare_Local'>orig_offset</span><span class='Delimiter'>, 
</span><a name="LN4849"></a>                <span class='Declare_Local'>src_offset</span><span class='Delimiter'>, 
</span><a name="LN4850"></a>                <span class='Declare_Local'>prod</span><span class='Delimiter'>[</span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Delimiter'>], 
</span><a name="LN4851"></a>                <span class='Declare_Local'>span</span><span class='Delimiter'>[</span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Delimiter'>], 
</span><a name="LN4852"></a>                <span class='Declare_Local'>dist</span><span class='Delimiter'>[</span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Delimiter'>], 
</span><a name="LN4853"></a>                <span class='Declare_Local'>indx</span><span class='Delimiter'>[</span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Delimiter'>]; 
</span><a name="LN4854"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN4855"></a>                <span class='Declare_Local'>j</span><span class='Delimiter'>, 
</span><a name="LN4856"></a>                <span class='Declare_Local'>inc</span><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN4847"><span class='Ref_To_Local'>dest_offset</span></a> <span class='Operator'>= </span><a href="arrayutils.c.html#LN29"><span class='Ref_to_Func'>ArrayGetOffset</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4830"><span class='Ref_to_Parameter'>ndim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4831"><span class='Ref_to_Parameter'>dim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4832"><span class='Ref_to_Parameter'>lb</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4833"><span class='Ref_to_Parameter'>st</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* copy items before the slice start */ 
</span>    <a href="arrayfuncs.c.html#LN4856"><span class='Ref_To_Local'>inc</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN122"><span class='Ref_to_Proto'>array_copy</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4839"><span class='Ref_To_Local'>destPtr</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4847"><span class='Ref_To_Local'>dest_offset</span></a><span class='Delimiter'>, 
</span>                     <a href="arrayfuncs.c.html#LN4840"><span class='Ref_To_Local'>origPtr</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4843"><span class='Ref_To_Local'>origBitmap</span></a><span class='Delimiter'>, 
</span>                     <a href="arrayfuncs.c.html#LN4835"><span class='Ref_to_Parameter'>typlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4836"><span class='Ref_to_Parameter'>typbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4837"><span class='Ref_to_Parameter'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN4839"><span class='Ref_To_Local'>destPtr</span></a> <span class='Operator'>+= </span><a href="arrayfuncs.c.html#LN4856"><span class='Ref_To_Local'>inc</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN4840"><span class='Ref_To_Local'>origPtr</span></a> <span class='Operator'>+= </span><a href="arrayfuncs.c.html#LN4856"><span class='Ref_To_Local'>inc</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4842"><span class='Ref_To_Local'>destBitmap</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/array.h.html#LN365"><span class='Ref_to_Proto'>array_bitmap_copy</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4842"><span class='Ref_To_Local'>destBitmap</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4843"><span class='Ref_To_Local'>origBitmap</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4847"><span class='Ref_To_Local'>dest_offset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN4848"><span class='Ref_To_Local'>orig_offset</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN4847"><span class='Ref_To_Local'>dest_offset</span></a><span class='Delimiter'>; 
</span>    <a href="arrayutils.c.html#LN132"><span class='Ref_to_Func'>mda_get_prod</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4830"><span class='Ref_to_Parameter'>ndim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4831"><span class='Ref_to_Parameter'>dim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4850"><span class='Ref_To_Local'>prod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayutils.c.html#LN118"><span class='Ref_to_Func'>mda_get_range</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4830"><span class='Ref_to_Parameter'>ndim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4851"><span class='Ref_To_Local'>span</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4833"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4834"><span class='Ref_to_Parameter'>endp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayutils.c.html#LN148"><span class='Ref_to_Func'>mda_get_offset_values</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4830"><span class='Ref_to_Parameter'>ndim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4852"><span class='Ref_To_Local'>dist</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4850"><span class='Ref_To_Local'>prod</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4851"><span class='Ref_To_Local'>span</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4854"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN4854"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN4830"><span class='Ref_to_Parameter'>ndim</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN4854"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <a href="arrayfuncs.c.html#LN4853"><span class='Ref_To_Local'>indx</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN4854"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN4849"><span class='Ref_To_Local'>src_offset</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN4855"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN4830"><span class='Ref_to_Parameter'>ndim</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>do</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Copy/advance over elements between here and next part of slice */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4852"><span class='Ref_To_Local'>dist</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN4855"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="arrayfuncs.c.html#LN4856"><span class='Ref_To_Local'>inc</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN122"><span class='Ref_to_Proto'>array_copy</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4839"><span class='Ref_To_Local'>destPtr</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4852"><span class='Ref_To_Local'>dist</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN4855"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>], 
</span>                             <a href="arrayfuncs.c.html#LN4840"><span class='Ref_To_Local'>origPtr</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4848"><span class='Ref_To_Local'>orig_offset</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4843"><span class='Ref_To_Local'>origBitmap</span></a><span class='Delimiter'>, 
</span>                             <a href="arrayfuncs.c.html#LN4835"><span class='Ref_to_Parameter'>typlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4836"><span class='Ref_to_Parameter'>typbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4837"><span class='Ref_to_Parameter'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN4839"><span class='Ref_To_Local'>destPtr</span></a> <span class='Operator'>+= </span><a href="arrayfuncs.c.html#LN4856"><span class='Ref_To_Local'>inc</span></a><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN4840"><span class='Ref_To_Local'>origPtr</span></a> <span class='Operator'>+= </span><a href="arrayfuncs.c.html#LN4856"><span class='Ref_To_Local'>inc</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4842"><span class='Ref_To_Local'>destBitmap</span></a><span class='Parentheses'>) 
</span>                <a href="../../../include/utils/array.h.html#LN365"><span class='Ref_to_Proto'>array_bitmap_copy</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4842"><span class='Ref_To_Local'>destBitmap</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4847"><span class='Ref_To_Local'>dest_offset</span></a><span class='Delimiter'>, 
</span>                                  <a href="arrayfuncs.c.html#LN4843"><span class='Ref_To_Local'>origBitmap</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4848"><span class='Ref_To_Local'>orig_offset</span></a><span class='Delimiter'>, 
</span>                                  <a href="arrayfuncs.c.html#LN4852"><span class='Ref_To_Local'>dist</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN4855"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN4847"><span class='Ref_To_Local'>dest_offset</span></a> <span class='Operator'>+= </span><a href="arrayfuncs.c.html#LN4852"><span class='Ref_To_Local'>dist</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN4855"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]; 
</span>            <a href="arrayfuncs.c.html#LN4848"><span class='Ref_To_Local'>orig_offset</span></a> <span class='Operator'>+= </span><a href="arrayfuncs.c.html#LN4852"><span class='Ref_To_Local'>dist</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN4855"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* Copy new element at this slice position */ 
</span>        <a href="arrayfuncs.c.html#LN4856"><span class='Ref_To_Local'>inc</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN122"><span class='Ref_to_Proto'>array_copy</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4839"><span class='Ref_To_Local'>destPtr</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                         <a href="arrayfuncs.c.html#LN4841"><span class='Ref_To_Local'>srcPtr</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4849"><span class='Ref_To_Local'>src_offset</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4844"><span class='Ref_To_Local'>srcBitmap</span></a><span class='Delimiter'>, 
</span>                         <a href="arrayfuncs.c.html#LN4835"><span class='Ref_to_Parameter'>typlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4836"><span class='Ref_to_Parameter'>typbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4837"><span class='Ref_to_Parameter'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4842"><span class='Ref_To_Local'>destBitmap</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/array.h.html#LN365"><span class='Ref_to_Proto'>array_bitmap_copy</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4842"><span class='Ref_To_Local'>destBitmap</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4847"><span class='Ref_To_Local'>dest_offset</span></a><span class='Delimiter'>, 
</span>                              <a href="arrayfuncs.c.html#LN4844"><span class='Ref_To_Local'>srcBitmap</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4849"><span class='Ref_To_Local'>src_offset</span></a><span class='Delimiter'>, 
</span>                              <span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN4839"><span class='Ref_To_Local'>destPtr</span></a> <span class='Operator'>+= </span><a href="arrayfuncs.c.html#LN4856"><span class='Ref_To_Local'>inc</span></a><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN4841"><span class='Ref_To_Local'>srcPtr</span></a> <span class='Operator'>+= </span><a href="arrayfuncs.c.html#LN4856"><span class='Ref_To_Local'>inc</span></a><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN4847"><span class='Ref_To_Local'>dest_offset</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN4849"><span class='Ref_To_Local'>src_offset</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Advance over old element at this slice position */ 
</span>        <a href="arrayfuncs.c.html#LN4840"><span class='Ref_To_Local'>origPtr</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN118"><span class='Ref_to_Proto'>array_seek</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4840"><span class='Ref_To_Local'>origPtr</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4848"><span class='Ref_To_Local'>orig_offset</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4843"><span class='Ref_To_Local'>origBitmap</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                             <a href="arrayfuncs.c.html#LN4835"><span class='Ref_to_Parameter'>typlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4836"><span class='Ref_to_Parameter'>typbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4837"><span class='Ref_to_Parameter'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN4848"><span class='Ref_To_Local'>orig_offset</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end do &raquo; </span> <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="arrayfuncs.c.html#LN4855"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><a href="arrayutils.c.html#LN173"><span class='Ref_to_Func'>mda_next_tuple</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4830"><span class='Ref_to_Parameter'>ndim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4853"><span class='Ref_To_Local'>indx</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4851"><span class='Ref_To_Local'>span</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= -</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* don't miss any data at the end */ 
</span>    <a href="arrayfuncs.c.html#LN122"><span class='Ref_to_Proto'>array_copy</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4839"><span class='Ref_To_Local'>destPtr</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4845"><span class='Ref_To_Local'>orignitems</span></a> <span class='Operator'>- </span><a href="arrayfuncs.c.html#LN4848"><span class='Ref_To_Local'>orig_offset</span></a><span class='Delimiter'>, 
</span>               <a href="arrayfuncs.c.html#LN4840"><span class='Ref_To_Local'>origPtr</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4848"><span class='Ref_To_Local'>orig_offset</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4843"><span class='Ref_To_Local'>origBitmap</span></a><span class='Delimiter'>, 
</span>               <a href="arrayfuncs.c.html#LN4835"><span class='Ref_to_Parameter'>typlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4836"><span class='Ref_to_Parameter'>typbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4837"><span class='Ref_to_Parameter'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4842"><span class='Ref_To_Local'>destBitmap</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/array.h.html#LN365"><span class='Ref_to_Proto'>array_bitmap_copy</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4842"><span class='Ref_To_Local'>destBitmap</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4847"><span class='Ref_To_Local'>dest_offset</span></a><span class='Delimiter'>, 
</span>                          <a href="arrayfuncs.c.html#LN4843"><span class='Ref_To_Local'>origBitmap</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4848"><span class='Ref_To_Local'>orig_offset</span></a><span class='Delimiter'>, 
</span>                          <a href="arrayfuncs.c.html#LN4845"><span class='Ref_To_Local'>orignitems</span></a> <span class='Operator'>- </span><a href="arrayfuncs.c.html#LN4848"><span class='Ref_To_Local'>orig_offset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end array_insert_slice &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * initArrayResult - initialize an empty ArrayBuildState 
 * 
 *  element_type is the array element type (must be a valid array element type) 
 *  rcontext is where to keep working state 
 *  subcontext is a flag determining whether to use a separate memory context 
 * 
 * Note: there are two common schemes for using accumArrayResult(). 
 * In the older scheme, you start with a NULL ArrayBuildState pointer, and 
 * call accumArrayResult once per element.  In this scheme you end up with 
 * a NULL pointer if there were no elements, which you need to special-case. 
 * In the newer scheme, call initArrayResult and then call accumArrayResult 
 * once per element.  In this scheme you always end with a non-NULL pointer 
 * that you can pass to makeArrayResult; you get an empty array if there 
 * were no elements.  This is preferred if an empty array is what you want. 
 * 
 * It's possible to choose whether to create a separate memory context for the 
 * array build state, or whether to allocate it directly within rcontext. 
 * 
 * When there are many concurrent small states (e.g. array_agg() using hash 
 * aggregation of many small groups), using a separate memory context for each 
 * one may result in severe memory bloat. In such cases, use the same memory 
 * context to initialize all such array build states, and pass 
 * subcontext=false. 
 * 
 * In cases when the array build states have different lifetimes, using a 
 * single memory context is impractical. Instead, pass subcontext=true so that 
 * the array build states can be freed individually. 
 */ 
</span><a href="../../../include/utils/array.h.html#LN167"><span class='Ref_to_Struct'>ArrayBuildState</span></a> <span class='Operator'>* 
</span><a name="LN4950"></a><span class='Declare_Function'>initArrayResult</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>element_type</span><span class='Delimiter'>, </span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>rcontext</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>subcontext</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4952"></a>    <a href="../../../include/utils/array.h.html#LN167"><span class='Ref_to_Struct'>ArrayBuildState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>astate</span><span class='Delimiter'>; 
</span><a name="LN4953"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>arr_context</span> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN4950"><span class='Ref_to_Parameter'>rcontext</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Make a temporary context to hold all the junk */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4950"><span class='Ref_to_Parameter'>subcontext</span></a><span class='Parentheses'>) 
</span>        <a href="arrayfuncs.c.html#LN4953"><span class='Ref_To_Local'>arr_context</span></a> <span class='Operator'>= </span><a href="../../../include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4950"><span class='Ref_to_Parameter'>rcontext</span></a><span class='Delimiter'>, 
</span>                                            <span class='String'>"accumArrayResult"</span><span class='Delimiter'>, 
</span>                                            <a href="../../../include/utils/memutils.h.html#LN164"><span class='Ref_to_Const'>ALLOCSET_DEFAULT_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN4952"><span class='Ref_To_Local'>astate</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN167"><span class='Ref_to_Struct'>ArrayBuildState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4953"><span class='Ref_To_Local'>arr_context</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN167"><span class='Ref_to_Struct'>ArrayBuildState</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN4952"><span class='Ref_To_Local'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN169"><span class='Ref_to_Member'>mcontext</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN4953"><span class='Ref_To_Local'>arr_context</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN4952"><span class='Ref_To_Local'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN178"><span class='Ref_to_Member'>private_cxt</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN4950"><span class='Ref_to_Parameter'>subcontext</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN4952"><span class='Ref_To_Local'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN172"><span class='Ref_to_Member'>alen</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4950"><span class='Ref_to_Parameter'>subcontext</span></a> <span class='Operator'>? </span><span class='Number'>64</span> <span class='Operator'>: </span><span class='Number'>8</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>       <span class='Comment_Multi_Line'>/* arbitrary starting array 
                                                 * size */ 
</span>    <a href="arrayfuncs.c.html#LN4952"><span class='Ref_To_Local'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN170"><span class='Ref_to_Member'>dvalues</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4953"><span class='Ref_To_Local'>arr_context</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4952"><span class='Ref_To_Local'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN172"><span class='Ref_to_Member'>alen</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN4952"><span class='Ref_To_Local'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN171"><span class='Ref_to_Member'>dnulls</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4953"><span class='Ref_To_Local'>arr_context</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4952"><span class='Ref_To_Local'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN172"><span class='Ref_to_Member'>alen</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN4952"><span class='Ref_To_Local'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN173"><span class='Ref_to_Member'>nelems</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN4952"><span class='Ref_To_Local'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN174"><span class='Ref_to_Member'>element_type</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN4950"><span class='Ref_to_Parameter'>element_type</span></a><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/lsyscache.h.html#LN136"><span class='Ref_to_Proto'>get_typlenbyvalalign</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4950"><span class='Ref_to_Parameter'>element_type</span></a><span class='Delimiter'>, 
</span>                         <span class='Operator'>&</span><a href="arrayfuncs.c.html#LN4952"><span class='Ref_To_Local'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN175"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>, 
</span>                         <span class='Operator'>&</span><a href="arrayfuncs.c.html#LN4952"><span class='Ref_To_Local'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN176"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>, 
</span>                         <span class='Operator'>&</span><a href="arrayfuncs.c.html#LN4952"><span class='Ref_To_Local'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN177"><span class='Ref_to_Member'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="arrayfuncs.c.html#LN4952"><span class='Ref_To_Local'>astate</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end initArrayResult &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * accumArrayResult - accumulate one (more) Datum for an array result 
 * 
 *  astate is working state (can be NULL on first call) 
 *  dvalue/disnull represent the new Datum to append to the array 
 *  element_type is the Datum's type (must be a valid array element type) 
 *  rcontext is where to keep working state 
 */ 
</span><a href="../../../include/utils/array.h.html#LN167"><span class='Ref_to_Struct'>ArrayBuildState</span></a> <span class='Operator'>* 
</span><a name="LN4990"></a><span class='Declare_Function'>accumArrayResult</span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN167"><span class='Ref_to_Struct'>ArrayBuildState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>astate</span><span class='Delimiter'>, 
</span><a name="LN4991"></a>                 <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>dvalue</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>disnull</span><span class='Delimiter'>, 
</span><a name="LN4992"></a>                 <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>element_type</span><span class='Delimiter'>, 
</span><a name="LN4993"></a>                 <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>rcontext</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4995"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4990"><span class='Ref_to_Parameter'>astate</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* First time through --- initialize */ 
</span>        <a href="arrayfuncs.c.html#LN4990"><span class='Ref_to_Parameter'>astate</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN388"><span class='Ref_to_Proto'>initArrayResult</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4992"><span class='Ref_to_Parameter'>element_type</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4993"><span class='Ref_to_Parameter'>rcontext</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4990"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN174"><span class='Ref_to_Member'>element_type</span></a> <span class='Operator'>== </span><a href="arrayfuncs.c.html#LN4992"><span class='Ref_to_Parameter'>element_type</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="arrayfuncs.c.html#LN4995"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4990"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN169"><span class='Ref_to_Member'>mcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* enlarge dvalues[]/dnulls[] if needed */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4990"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN173"><span class='Ref_to_Member'>nelems</span></a> <span class='Operator'>&GT;= </span><a href="arrayfuncs.c.html#LN4990"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN172"><span class='Ref_to_Member'>alen</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="arrayfuncs.c.html#LN4990"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN172"><span class='Ref_to_Member'>alen</span></a> <span class='Operator'>*= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN4990"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN170"><span class='Ref_to_Member'>dvalues</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>            <a href="../../../include/common/fe_memutils.h.html#LN36"><span class='Ref_to_Proto'>repalloc</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4990"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN170"><span class='Ref_to_Member'>dvalues</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4990"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN172"><span class='Ref_to_Member'>alen</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN4990"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN171"><span class='Ref_to_Member'>dnulls</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) 
</span>            <a href="../../../include/common/fe_memutils.h.html#LN36"><span class='Ref_to_Proto'>repalloc</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4990"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN171"><span class='Ref_to_Member'>dnulls</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4990"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN172"><span class='Ref_to_Member'>alen</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Ensure pass-by-ref stuff is copied into mcontext; and detoast it too if 
     * it's varlena.  (You might think that detoasting is not needed here 
     * because construct_md_array can detoast the array elements later. 
     * However, we must not let construct_md_array modify the ArrayBuildState 
     * because that would mean array_agg_finalfn damages its input, which is 
     * verboten.  Also, this way frequently saves one copying step.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="arrayfuncs.c.html#LN4991"><span class='Ref_to_Parameter'>disnull</span></a> <span class='Operator'>&& !</span><a href="arrayfuncs.c.html#LN4990"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN176"><span class='Ref_to_Member'>typbyval</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4990"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN175"><span class='Ref_to_Member'>typlen</span></a> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <a href="arrayfuncs.c.html#LN4991"><span class='Ref_to_Parameter'>dvalue</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN206"><span class='Ref_to_Macro'>PG_DETOAST_DATUM_COPY</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4991"><span class='Ref_to_Parameter'>dvalue</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="arrayfuncs.c.html#LN4991"><span class='Ref_to_Parameter'>dvalue</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datum.h.html#LN30"><span class='Ref_to_Proto'>datumCopy</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4991"><span class='Ref_to_Parameter'>dvalue</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4990"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN176"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN4990"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN175"><span class='Ref_to_Member'>typlen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="arrayfuncs.c.html#LN4990"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN170"><span class='Ref_to_Member'>dvalues</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN4990"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN173"><span class='Ref_to_Member'>nelems</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="arrayfuncs.c.html#LN4991"><span class='Ref_to_Parameter'>dvalue</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN4990"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN171"><span class='Ref_to_Member'>dnulls</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN4990"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN173"><span class='Ref_to_Member'>nelems</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="arrayfuncs.c.html#LN4991"><span class='Ref_to_Parameter'>disnull</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN4990"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN173"><span class='Ref_to_Member'>nelems</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN4995"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="arrayfuncs.c.html#LN4990"><span class='Ref_to_Parameter'>astate</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end accumArrayResult &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * makeArrayResult - produce 1-D final result of accumArrayResult 
 * 
 * Note: only releases astate if it was initialized within a separate memory 
 * context (i.e. using subcontext=true when calling initArrayResult). 
 * 
 *  astate is working state (must not be NULL) 
 *  rcontext is where to construct result 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN5054"></a><span class='Declare_Function'>makeArrayResult</span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN167"><span class='Ref_to_Struct'>ArrayBuildState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>astate</span><span class='Delimiter'>, 
</span><a name="LN5055"></a>                <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>rcontext</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5057"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ndims</span><span class='Delimiter'>; 
</span><a name="LN5058"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>dims</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN5059"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>lbs</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
    <span class='Comment_Multi_Line'>/* If no elements were presented, we want to create an empty array */ 
</span>    <a href="arrayfuncs.c.html#LN5057"><span class='Ref_To_Local'>ndims</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5054"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN173"><span class='Ref_to_Member'>nelems</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Number'>1</span> <span class='Operator'>: </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN5058"><span class='Ref_To_Local'>dims</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="arrayfuncs.c.html#LN5054"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN173"><span class='Ref_to_Member'>nelems</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN5059"><span class='Ref_To_Local'>lbs</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../../include/utils/array.h.html#LN396"><span class='Ref_to_Proto'>makeMdArrayResult</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5054"><span class='Ref_to_Parameter'>astate</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5057"><span class='Ref_To_Local'>ndims</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5058"><span class='Ref_To_Local'>dims</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5059"><span class='Ref_To_Local'>lbs</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5055"><span class='Ref_to_Parameter'>rcontext</span></a><span class='Delimiter'>, 
</span>                             <a href="arrayfuncs.c.html#LN5054"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN178"><span class='Ref_to_Member'>private_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * makeMdArrayResult - produce multi-D final result of accumArrayResult 
 * 
 * beware: no check that specified dimensions match the number of values 
 * accumulated. 
 * 
 * Note: if the astate was not initialized within a separate memory context 
 * (that is, initArrayResult was called with subcontext=false), then using 
 * release=true is illegal. Instead, release astate along with the rest of its 
 * context when appropriate. 
 * 
 *  astate is working state (must not be NULL) 
 *  rcontext is where to construct result 
 *  release is true if okay to release working state 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN5086"></a><span class='Declare_Function'>makeMdArrayResult</span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN167"><span class='Ref_to_Struct'>ArrayBuildState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>astate</span><span class='Delimiter'>, 
</span><a name="LN5087"></a>                  <span class='Keyword'>int </span><span class='Declare_Parameter'>ndims</span><span class='Delimiter'>, 
</span><a name="LN5088"></a>                  <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>dims</span><span class='Delimiter'>, 
</span><a name="LN5089"></a>                  <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>lbs</span><span class='Delimiter'>, 
</span><a name="LN5090"></a>                  <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>rcontext</span><span class='Delimiter'>, 
</span><a name="LN5091"></a>                  <span class='Keyword'>bool </span><span class='Declare_Parameter'>release</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5093"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN5094"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Build the final array result in rcontext */ 
</span>    <a href="arrayfuncs.c.html#LN5094"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5090"><span class='Ref_to_Parameter'>rcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN5093"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN372"><span class='Ref_to_Proto'>construct_md_array</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5086"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN170"><span class='Ref_to_Member'>dvalues</span></a><span class='Delimiter'>, 
</span>                                <a href="arrayfuncs.c.html#LN5086"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN171"><span class='Ref_to_Member'>dnulls</span></a><span class='Delimiter'>, 
</span>                                <a href="arrayfuncs.c.html#LN5087"><span class='Ref_to_Parameter'>ndims</span></a><span class='Delimiter'>, 
</span>                                <a href="arrayfuncs.c.html#LN5088"><span class='Ref_to_Parameter'>dims</span></a><span class='Delimiter'>, 
</span>                                <a href="arrayfuncs.c.html#LN5089"><span class='Ref_to_Parameter'>lbs</span></a><span class='Delimiter'>, 
</span>                                <a href="arrayfuncs.c.html#LN5086"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN174"><span class='Ref_to_Member'>element_type</span></a><span class='Delimiter'>, 
</span>                                <a href="arrayfuncs.c.html#LN5086"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN175"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>, 
</span>                                <a href="arrayfuncs.c.html#LN5086"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN176"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>, 
</span>                                <a href="arrayfuncs.c.html#LN5086"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN177"><span class='Ref_to_Member'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5094"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Clean up all the junk */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5091"><span class='Ref_to_Parameter'>release</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5086"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN178"><span class='Ref_to_Member'>private_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/memutils.h.html#LN74"><span class='Ref_to_Proto'>MemoryContextDelete</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5086"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN169"><span class='Ref_to_Member'>mcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5093"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end makeMdArrayResult &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * The following three functions provide essentially the same API as 
 * initArrayResult/accumArrayResult/makeArrayResult, but instead of accepting 
 * inputs that are array elements, they accept inputs that are arrays and 
 * produce an output array having N+1 dimensions.  The inputs must all have 
 * identical dimensionality as well as element type. 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * initArrayResultArr - initialize an empty ArrayBuildStateArr 
 * 
 *  array_type is the array type (must be a valid varlena array type) 
 *  element_type is the type of the array's elements (lookup if InvalidOid) 
 *  rcontext is where to keep working state 
 *  subcontext is a flag determining whether to use a separate memory context 
 */ 
</span><a href="../../../include/utils/array.h.html#LN185"><span class='Ref_to_Struct'>ArrayBuildStateArr</span></a> <span class='Operator'>* 
</span><a name="LN5138"></a><span class='Declare_Function'>initArrayResultArr</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>array_type</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>element_type</span><span class='Delimiter'>, </span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>rcontext</span><span class='Delimiter'>, 
</span><a name="LN5139"></a>                   <span class='Keyword'>bool </span><span class='Declare_Parameter'>subcontext</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5141"></a>    <a href="../../../include/utils/array.h.html#LN185"><span class='Ref_to_Struct'>ArrayBuildStateArr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>astate</span><span class='Delimiter'>; 
</span><a name="LN5142"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>arr_context</span> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN5138"><span class='Ref_to_Parameter'>rcontext</span></a><span class='Delimiter'>;</span>       <span class='Comment_Multi_Line'>/* by default use the parent 
                                                 * ctx */ 
</span> 
    <span class='Comment_Multi_Line'>/* Lookup element type, unless element_type already provided */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5138"><span class='Ref_to_Parameter'>element_type</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="arrayfuncs.c.html#LN5138"><span class='Ref_to_Parameter'>element_type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN157"><span class='Ref_to_Proto'>get_element_type</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5138"><span class='Ref_to_Parameter'>array_type</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5138"><span class='Ref_to_Parameter'>element_type</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"data type %s is not an array type"</span><span class='Delimiter'>, 
</span>                            <a href="format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5138"><span class='Ref_to_Parameter'>array_type</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Make a temporary context to hold all the junk */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5139"><span class='Ref_to_Parameter'>subcontext</span></a><span class='Parentheses'>) 
</span>        <a href="arrayfuncs.c.html#LN5142"><span class='Ref_To_Local'>arr_context</span></a> <span class='Operator'>= </span><a href="../../../include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5138"><span class='Ref_to_Parameter'>rcontext</span></a><span class='Delimiter'>, 
</span>                                            <span class='String'>"accumArrayResultArr"</span><span class='Delimiter'>, 
</span>                                            <a href="../../../include/utils/memutils.h.html#LN164"><span class='Ref_to_Const'>ALLOCSET_DEFAULT_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Note we initialize all fields to zero */ 
</span>    <a href="arrayfuncs.c.html#LN5141"><span class='Ref_To_Local'>astate</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN185"><span class='Ref_to_Struct'>ArrayBuildStateArr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/palloc.h.html#LN71"><span class='Ref_to_Proto'>MemoryContextAllocZero</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5142"><span class='Ref_To_Local'>arr_context</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN185"><span class='Ref_to_Struct'>ArrayBuildStateArr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN5141"><span class='Ref_To_Local'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN187"><span class='Ref_to_Member'>mcontext</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN5142"><span class='Ref_To_Local'>arr_context</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN5141"><span class='Ref_To_Local'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN199"><span class='Ref_to_Member'>private_cxt</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN5139"><span class='Ref_to_Parameter'>subcontext</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Save relevant datatype information */ 
</span>    <a href="arrayfuncs.c.html#LN5141"><span class='Ref_To_Local'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN197"><span class='Ref_to_Member'>array_type</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN5138"><span class='Ref_to_Parameter'>array_type</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN5141"><span class='Ref_To_Local'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN198"><span class='Ref_to_Member'>element_type</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN5138"><span class='Ref_to_Parameter'>element_type</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="arrayfuncs.c.html#LN5141"><span class='Ref_To_Local'>astate</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end initArrayResultArr &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * accumArrayResultArr - accumulate one (more) sub-array for an array result 
 * 
 *  astate is working state (can be NULL on first call) 
 *  dvalue/disnull represent the new sub-array to append to the array 
 *  array_type is the array type (must be a valid varlena array type) 
 *  rcontext is where to keep working state 
 */ 
</span><a href="../../../include/utils/array.h.html#LN185"><span class='Ref_to_Struct'>ArrayBuildStateArr</span></a> <span class='Operator'>* 
</span><a name="LN5185"></a><span class='Declare_Function'>accumArrayResultArr</span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN185"><span class='Ref_to_Struct'>ArrayBuildStateArr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>astate</span><span class='Delimiter'>, 
</span><a name="LN5186"></a>                    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>dvalue</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>disnull</span><span class='Delimiter'>, 
</span><a name="LN5187"></a>                    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>array_type</span><span class='Delimiter'>, 
</span><a name="LN5188"></a>                    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>rcontext</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5190"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>arg</span><span class='Delimiter'>; 
</span><a name="LN5191"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span><a name="LN5192"></a>    <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Local'>dims</span><span class='Delimiter'>, 
</span><a name="LN5193"></a>               <span class='Operator'>*</span><span class='Declare_Local'>lbs</span><span class='Delimiter'>, 
</span><a name="LN5194"></a>                <span class='Declare_Local'>ndims</span><span class='Delimiter'>, 
</span><a name="LN5195"></a>                <span class='Declare_Local'>nitems</span><span class='Delimiter'>, 
</span><a name="LN5196"></a>                <span class='Declare_Local'>ndatabytes</span><span class='Delimiter'>; 
</span><a name="LN5197"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>data</span><span class='Delimiter'>; 
</span><a name="LN5198"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We disallow accumulating null subarrays.  Another plausible definition 
     * is to ignore them, but callers that want that can just skip calling 
     * this function. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5186"><span class='Ref_to_Parameter'>disnull</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NULL_VALUE_NOT_ALLOWED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot accumulate null arrays"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Detoast input array in caller's context */ 
</span>    <a href="arrayfuncs.c.html#LN5190"><span class='Ref_To_Local'>arg</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN241"><span class='Ref_to_Macro'>DatumGetArrayTypeP</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5186"><span class='Ref_to_Parameter'>dvalue</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5185"><span class='Ref_to_Parameter'>astate</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="arrayfuncs.c.html#LN5185"><span class='Ref_to_Parameter'>astate</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN399"><span class='Ref_to_Proto'>initArrayResultArr</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5187"><span class='Ref_to_Parameter'>array_type</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5188"><span class='Ref_to_Parameter'>rcontext</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5185"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN197"><span class='Ref_to_Member'>array_type</span></a> <span class='Operator'>== </span><a href="arrayfuncs.c.html#LN5187"><span class='Ref_to_Parameter'>array_type</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN5191"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5185"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN187"><span class='Ref_to_Member'>mcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Collect this input's dimensions */ 
</span>    <a href="arrayfuncs.c.html#LN5194"><span class='Ref_To_Local'>ndims</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5190"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN5192"><span class='Ref_To_Local'>dims</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5190"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN5193"><span class='Ref_To_Local'>lbs</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN276"><span class='Ref_to_Macro'>ARR_LBOUND</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5190"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN5197"><span class='Ref_To_Local'>data</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN302"><span class='Ref_to_Macro'>ARR_DATA_PTR</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5190"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN5195"><span class='Ref_To_Local'>nitems</span></a> <span class='Operator'>= </span><a href="arrayutils.c.html#LN73"><span class='Ref_to_Func'>ArrayGetNItems</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5194"><span class='Ref_To_Local'>ndims</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5192"><span class='Ref_To_Local'>dims</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN5196"><span class='Ref_To_Local'>ndatabytes</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN269"><span class='Ref_to_Macro'>ARR_SIZE</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5190"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="../../../include/utils/array.h.html#LN296"><span class='Ref_to_Macro'>ARR_DATA_OFFSET</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5190"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5185"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN194"><span class='Ref_to_Member'>ndims</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* First input; check/save the dimensionality info */ 
</span> 
        <span class='Comment_Multi_Line'>/* Should we allow empty inputs and just produce an empty output? */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5194"><span class='Ref_To_Local'>ndims</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ARRAY_SUBSCRIPT_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot accumulate empty arrays"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5194"><span class='Ref_To_Local'>ndims</span></a> <span class='Operator'>+ </span><span class='Number'>1</span> <span class='Operator'>&GT; </span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_PROGRAM_LIMIT_EXCEEDED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"number of array dimensions (%d) exceeds the maximum allowed (%d)"</span><span class='Delimiter'>, 
</span>                            <a href="arrayfuncs.c.html#LN5194"><span class='Ref_To_Local'>ndims</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * The output array will have n+1 dimensions, with the ones after the 
         * first matching the input's dimensions. 
         */ 
</span>        <a href="arrayfuncs.c.html#LN5185"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN194"><span class='Ref_to_Member'>ndims</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN5194"><span class='Ref_To_Local'>ndims</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN5185"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN195"><span class='Ref_to_Member'>dims</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN5185"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN195"><span class='Ref_to_Member'>dims</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], </span><a href="arrayfuncs.c.html#LN5192"><span class='Ref_To_Local'>dims</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5194"><span class='Ref_To_Local'>ndims</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN5185"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN196"><span class='Ref_to_Member'>lbs</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN5185"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN196"><span class='Ref_to_Member'>lbs</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], </span><a href="arrayfuncs.c.html#LN5193"><span class='Ref_To_Local'>lbs</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5194"><span class='Ref_To_Local'>ndims</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Allocate at least enough data space for this item */ 
</span>        <a href="arrayfuncs.c.html#LN5185"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN190"><span class='Ref_to_Member'>abytes</span></a> <span class='Operator'>= </span><span class='Number'>1024</span><span class='Delimiter'>; 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5185"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN190"><span class='Ref_to_Member'>abytes</span></a> <span class='Operator'>&LT;= </span><a href="arrayfuncs.c.html#LN5196"><span class='Ref_To_Local'>ndatabytes</span></a><span class='Parentheses'>) 
</span>            <a href="arrayfuncs.c.html#LN5185"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN190"><span class='Ref_to_Member'>abytes</span></a> <span class='Operator'>*= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN5185"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN188"><span class='Ref_to_Member'>data</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5185"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN190"><span class='Ref_to_Member'>abytes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if astate-&GT;ndims==0 &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Second or later input: must match first input's dimensionality */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5185"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN194"><span class='Ref_to_Member'>ndims</span></a> <span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN5194"><span class='Ref_To_Local'>ndims</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ARRAY_SUBSCRIPT_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>            <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot accumulate arrays of different dimensionality"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5198"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN5198"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN5194"><span class='Ref_To_Local'>ndims</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN5198"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5185"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN195"><span class='Ref_to_Member'>dims</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN5198"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN5192"><span class='Ref_To_Local'>dims</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN5198"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>|| </span><a href="arrayfuncs.c.html#LN5185"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN196"><span class='Ref_to_Member'>lbs</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN5198"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN5193"><span class='Ref_To_Local'>lbs</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN5198"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ARRAY_SUBSCRIPT_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot accumulate arrays of different dimensionality"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Enlarge data space if needed */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5185"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN191"><span class='Ref_to_Member'>nbytes</span></a> <span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN5196"><span class='Ref_To_Local'>ndatabytes</span></a> <span class='Operator'>&GT; </span><a href="arrayfuncs.c.html#LN5185"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN190"><span class='Ref_to_Member'>abytes</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="arrayfuncs.c.html#LN5185"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN190"><span class='Ref_to_Member'>abytes</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5185"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN190"><span class='Ref_to_Member'>abytes</span></a> <span class='Operator'>* </span><span class='Number'>2</span><span class='Delimiter'>, 
</span>                                 <a href="arrayfuncs.c.html#LN5185"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN191"><span class='Ref_to_Member'>nbytes</span></a> <span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN5196"><span class='Ref_To_Local'>ndatabytes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN5185"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN188"><span class='Ref_to_Member'>data</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN36"><span class='Ref_to_Proto'>repalloc</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5185"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN188"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5185"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN190"><span class='Ref_to_Member'>abytes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Copy the data portion of the sub-array.  Note we assume that the 
     * advertised data length of the sub-array is properly aligned.  We do not 
     * have to worry about detoasting elements since whatever's in the 
     * sub-array should be OK already. 
     */ 
</span>    memcpy<span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5185"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN188"><span class='Ref_to_Member'>data</span></a> <span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN5185"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN191"><span class='Ref_to_Member'>nbytes</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5197"><span class='Ref_To_Local'>data</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5196"><span class='Ref_To_Local'>ndatabytes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN5185"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN191"><span class='Ref_to_Member'>nbytes</span></a> <span class='Operator'>+= </span><a href="arrayfuncs.c.html#LN5196"><span class='Ref_To_Local'>ndatabytes</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Deal with null bitmap if needed */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5185"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN189"><span class='Ref_to_Member'>nullbitmap</span></a> <span class='Operator'>|| </span><a href="../../../include/utils/array.h.html#LN271"><span class='Ref_to_Macro'>ARR_HASNULL</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5190"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN5295"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>newnitems</span> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN5185"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN193"><span class='Ref_to_Member'>nitems</span></a> <span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN5195"><span class='Ref_To_Local'>nitems</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5185"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN189"><span class='Ref_to_Member'>nullbitmap</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * First input with nulls; we must retrospectively handle any 
             * previous inputs by marking all their items non-null. 
             */ 
</span>            <a href="arrayfuncs.c.html#LN5185"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN192"><span class='Ref_to_Member'>aitems</span></a> <span class='Operator'>= </span><span class='Number'>256</span><span class='Delimiter'>; 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5185"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN192"><span class='Ref_to_Member'>aitems</span></a> <span class='Operator'>&LT;= </span><a href="arrayfuncs.c.html#LN5295"><span class='Ref_To_Local'>newnitems</span></a><span class='Parentheses'>) 
</span>                <a href="arrayfuncs.c.html#LN5185"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN192"><span class='Ref_to_Member'>aitems</span></a> <span class='Operator'>*= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN5185"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN189"><span class='Ref_to_Member'>nullbitmap</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN274"><span class='Ref_to_Typedef'>bits8</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>((</span><a href="arrayfuncs.c.html#LN5185"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN192"><span class='Ref_to_Member'>aitems</span></a> <span class='Operator'>+ </span><span class='Number'>7</span><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Number'>8</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/utils/array.h.html#LN365"><span class='Ref_to_Proto'>array_bitmap_copy</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5185"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN189"><span class='Ref_to_Member'>nullbitmap</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                              <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                              <a href="arrayfuncs.c.html#LN5185"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN193"><span class='Ref_to_Member'>nitems</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5295"><span class='Ref_To_Local'>newnitems</span></a> <span class='Operator'>&GT; </span><a href="arrayfuncs.c.html#LN5185"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN192"><span class='Ref_to_Member'>aitems</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="arrayfuncs.c.html#LN5185"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN192"><span class='Ref_to_Member'>aitems</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5185"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN192"><span class='Ref_to_Member'>aitems</span></a> <span class='Operator'>* </span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5295"><span class='Ref_To_Local'>newnitems</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN5185"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN189"><span class='Ref_to_Member'>nullbitmap</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN274"><span class='Ref_to_Typedef'>bits8</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>                <a href="../../../include/common/fe_memutils.h.html#LN36"><span class='Ref_to_Proto'>repalloc</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5185"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN189"><span class='Ref_to_Member'>nullbitmap</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5185"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN192"><span class='Ref_to_Member'>aitems</span></a> <span class='Operator'>+ </span><span class='Number'>7</span><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Number'>8</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../../include/utils/array.h.html#LN365"><span class='Ref_to_Proto'>array_bitmap_copy</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5185"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN189"><span class='Ref_to_Member'>nullbitmap</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5185"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN193"><span class='Ref_to_Member'>nitems</span></a><span class='Delimiter'>, 
</span>                          <a href="../../../include/utils/array.h.html#LN280"><span class='Ref_to_Macro'>ARR_NULLBITMAP</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5190"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                          <a href="arrayfuncs.c.html#LN5195"><span class='Ref_To_Local'>nitems</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if astate-&GT;nullbitmap||A... &raquo; </span> 
 
    <a href="arrayfuncs.c.html#LN5185"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN193"><span class='Ref_to_Member'>nitems</span></a> <span class='Operator'>+= </span><a href="arrayfuncs.c.html#LN5195"><span class='Ref_To_Local'>nitems</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN5185"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN195"><span class='Ref_to_Member'>dims</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>+= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5191"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Release detoasted copy if any */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="../../../include/c.h.html#LN244"><span class='Ref_to_Typedef'>Pointer</span></a><span class='Parentheses'>) </span><a href="arrayfuncs.c.html#LN5190"><span class='Ref_To_Local'>arg</span></a> <span class='Operator'>!= </span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5186"><span class='Ref_to_Parameter'>dvalue</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5190"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="arrayfuncs.c.html#LN5185"><span class='Ref_to_Parameter'>astate</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end accumArrayResultArr &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * makeArrayResultArr - produce N+1-D final result of accumArrayResultArr 
 * 
 *  astate is working state (must not be NULL) 
 *  rcontext is where to construct result 
 *  release is true if okay to release working state 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN5342"></a><span class='Declare_Function'>makeArrayResultArr</span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN185"><span class='Ref_to_Struct'>ArrayBuildStateArr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>astate</span><span class='Delimiter'>, 
</span><a name="LN5343"></a>                   <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>rcontext</span><span class='Delimiter'>, 
</span><a name="LN5344"></a>                   <span class='Keyword'>bool </span><span class='Declare_Parameter'>release</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5346"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN5347"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Build the final array result in rcontext */ 
</span>    <a href="arrayfuncs.c.html#LN5347"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5343"><span class='Ref_to_Parameter'>rcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5342"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN194"><span class='Ref_to_Member'>ndims</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* No inputs, return empty array */ 
</span>        <a href="arrayfuncs.c.html#LN5346"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN378"><span class='Ref_to_Proto'>construct_empty_array</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5342"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN198"><span class='Ref_to_Member'>element_type</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN5359"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>dataoffset</span><span class='Delimiter'>, 
</span><a name="LN5360"></a>                    <span class='Declare_Local'>nbytes</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Compute required space */ 
</span>        <a href="arrayfuncs.c.html#LN5360"><span class='Ref_To_Local'>nbytes</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN5342"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN191"><span class='Ref_to_Member'>nbytes</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5342"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN189"><span class='Ref_to_Member'>nullbitmap</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="arrayfuncs.c.html#LN5359"><span class='Ref_To_Local'>dataoffset</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN292"><span class='Ref_to_Macro'>ARR_OVERHEAD_WITHNULLS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5342"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN194"><span class='Ref_to_Member'>ndims</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5342"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN193"><span class='Ref_to_Member'>nitems</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN5360"><span class='Ref_To_Local'>nbytes</span></a> <span class='Operator'>+= </span><a href="arrayfuncs.c.html#LN5359"><span class='Ref_To_Local'>dataoffset</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="arrayfuncs.c.html#LN5359"><span class='Ref_To_Local'>dataoffset</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN5360"><span class='Ref_To_Local'>nbytes</span></a> <span class='Operator'>+= </span><a href="../../../include/utils/array.h.html#LN290"><span class='Ref_to_Macro'>ARR_OVERHEAD_NONULLS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5342"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN194"><span class='Ref_to_Member'>ndims</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="arrayfuncs.c.html#LN5346"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5360"><span class='Ref_To_Local'>nbytes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5346"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5360"><span class='Ref_To_Local'>nbytes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN5346"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN78"><span class='Ref_to_Member'>ndim</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN5342"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN194"><span class='Ref_to_Member'>ndims</span></a><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN5346"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN79"><span class='Ref_to_Member'>dataoffset</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN5359"><span class='Ref_To_Local'>dataoffset</span></a><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN5346"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN80"><span class='Ref_to_Member'>elemtype</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN5342"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN198"><span class='Ref_to_Member'>element_type</span></a><span class='Delimiter'>; 
</span> 
        memcpy<span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5346"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5342"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN195"><span class='Ref_to_Member'>dims</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5342"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN194"><span class='Ref_to_Member'>ndims</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN276"><span class='Ref_to_Macro'>ARR_LBOUND</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5346"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5342"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN196"><span class='Ref_to_Member'>lbs</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5342"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN194"><span class='Ref_to_Member'>ndims</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN302"><span class='Ref_to_Macro'>ARR_DATA_PTR</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5346"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5342"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN188"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5342"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN191"><span class='Ref_to_Member'>nbytes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5342"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN189"><span class='Ref_to_Member'>nullbitmap</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/array.h.html#LN365"><span class='Ref_to_Proto'>array_bitmap_copy</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN280"><span class='Ref_to_Macro'>ARR_NULLBITMAP</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5346"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                              <a href="arrayfuncs.c.html#LN5342"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN189"><span class='Ref_to_Member'>nullbitmap</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                              <a href="arrayfuncs.c.html#LN5342"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN193"><span class='Ref_to_Member'>nitems</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5347"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Clean up all the junk */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5344"><span class='Ref_to_Parameter'>release</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5342"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN199"><span class='Ref_to_Member'>private_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/memutils.h.html#LN74"><span class='Ref_to_Proto'>MemoryContextDelete</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5342"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN187"><span class='Ref_to_Member'>mcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5346"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end makeArrayResultArr &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * The following three functions provide essentially the same API as 
 * initArrayResult/accumArrayResult/makeArrayResult, but can accept either 
 * scalar or array inputs, invoking the appropriate set of functions above. 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * initArrayResultAny - initialize an empty ArrayBuildStateAny 
 * 
 *  input_type is the input datatype (either element or array type) 
 *  rcontext is where to keep working state 
 *  subcontext is a flag determining whether to use a separate memory context 
 */ 
</span><a href="../../../include/utils/array.h.html#LN206"><span class='Ref_to_Struct'>ArrayBuildStateAny</span></a> <span class='Operator'>* 
</span><a name="LN5417"></a><span class='Declare_Function'>initArrayResultAny</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>input_type</span><span class='Delimiter'>, </span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>rcontext</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>subcontext</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5419"></a>    <a href="../../../include/utils/array.h.html#LN206"><span class='Ref_to_Struct'>ArrayBuildStateAny</span></a> <span class='Operator'>*</span><span class='Declare_Local'>astate</span><span class='Delimiter'>; 
</span><a name="LN5420"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>element_type</span> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN157"><span class='Ref_to_Proto'>get_element_type</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5417"><span class='Ref_to_Parameter'>input_type</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5420"><span class='Ref_To_Local'>element_type</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Array case */ 
</span><a name="LN5425"></a>        <a href="../../../include/utils/array.h.html#LN185"><span class='Ref_to_Struct'>ArrayBuildStateArr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>arraystate</span><span class='Delimiter'>; 
</span> 
        <a href="arrayfuncs.c.html#LN5425"><span class='Ref_To_Local'>arraystate</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN399"><span class='Ref_to_Proto'>initArrayResultArr</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5417"><span class='Ref_to_Parameter'>input_type</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5417"><span class='Ref_to_Parameter'>rcontext</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5417"><span class='Ref_to_Parameter'>subcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN5419"><span class='Ref_To_Local'>astate</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN206"><span class='Ref_to_Struct'>ArrayBuildStateAny</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5425"><span class='Ref_To_Local'>arraystate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN187"><span class='Ref_to_Member'>mcontext</span></a><span class='Delimiter'>, 
</span>                               <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN206"><span class='Ref_to_Struct'>ArrayBuildStateAny</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN5419"><span class='Ref_To_Local'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN209"><span class='Ref_to_Member'>scalarstate</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN5419"><span class='Ref_To_Local'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN210"><span class='Ref_to_Member'>arraystate</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN5425"><span class='Ref_To_Local'>arraystate</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Scalar case */ 
</span><a name="LN5437"></a>        <a href="../../../include/utils/array.h.html#LN167"><span class='Ref_to_Struct'>ArrayBuildState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>scalarstate</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Let's just check that we have a type that can be put into arrays */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/lsyscache.h.html#LN158"><span class='Ref_to_Proto'>get_array_type</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5417"><span class='Ref_to_Parameter'>input_type</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="arrayfuncs.c.html#LN5437"><span class='Ref_To_Local'>scalarstate</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN388"><span class='Ref_to_Proto'>initArrayResult</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5417"><span class='Ref_to_Parameter'>input_type</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5417"><span class='Ref_to_Parameter'>rcontext</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5417"><span class='Ref_to_Parameter'>subcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN5419"><span class='Ref_To_Local'>astate</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN206"><span class='Ref_to_Struct'>ArrayBuildStateAny</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5437"><span class='Ref_To_Local'>scalarstate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN169"><span class='Ref_to_Member'>mcontext</span></a><span class='Delimiter'>, 
</span>                               <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN206"><span class='Ref_to_Struct'>ArrayBuildStateAny</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN5419"><span class='Ref_To_Local'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN209"><span class='Ref_to_Member'>scalarstate</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN5437"><span class='Ref_To_Local'>scalarstate</span></a><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN5419"><span class='Ref_To_Local'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN210"><span class='Ref_to_Member'>arraystate</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="arrayfuncs.c.html#LN5419"><span class='Ref_To_Local'>astate</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end initArrayResultAny &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * accumArrayResultAny - accumulate one (more) input for an array result 
 * 
 *  astate is working state (can be NULL on first call) 
 *  dvalue/disnull represent the new input to append to the array 
 *  input_type is the input datatype (either element or array type) 
 *  rcontext is where to keep working state 
 */ 
</span><a href="../../../include/utils/array.h.html#LN206"><span class='Ref_to_Struct'>ArrayBuildStateAny</span></a> <span class='Operator'>* 
</span><a name="LN5462"></a><span class='Declare_Function'>accumArrayResultAny</span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN206"><span class='Ref_to_Struct'>ArrayBuildStateAny</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>astate</span><span class='Delimiter'>, 
</span><a name="LN5463"></a>                    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>dvalue</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>disnull</span><span class='Delimiter'>, 
</span><a name="LN5464"></a>                    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>input_type</span><span class='Delimiter'>, 
</span><a name="LN5465"></a>                    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>rcontext</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5462"><span class='Ref_to_Parameter'>astate</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="arrayfuncs.c.html#LN5462"><span class='Ref_to_Parameter'>astate</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN408"><span class='Ref_to_Proto'>initArrayResultAny</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5464"><span class='Ref_to_Parameter'>input_type</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5465"><span class='Ref_to_Parameter'>rcontext</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5462"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN209"><span class='Ref_to_Member'>scalarstate</span></a><span class='Parentheses'>) 
</span>        <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../../include/utils/array.h.html#LN390"><span class='Ref_to_Proto'>accumArrayResult</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5462"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN209"><span class='Ref_to_Member'>scalarstate</span></a><span class='Delimiter'>, 
</span>                                <a href="arrayfuncs.c.html#LN5463"><span class='Ref_to_Parameter'>dvalue</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5463"><span class='Ref_to_Parameter'>disnull</span></a><span class='Delimiter'>, 
</span>                                <a href="arrayfuncs.c.html#LN5464"><span class='Ref_to_Parameter'>input_type</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5465"><span class='Ref_to_Parameter'>rcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../../include/utils/array.h.html#LN401"><span class='Ref_to_Proto'>accumArrayResultArr</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5462"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN210"><span class='Ref_to_Member'>arraystate</span></a><span class='Delimiter'>, 
</span>                                   <a href="arrayfuncs.c.html#LN5463"><span class='Ref_to_Parameter'>dvalue</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5463"><span class='Ref_to_Parameter'>disnull</span></a><span class='Delimiter'>, 
</span>                                   <a href="arrayfuncs.c.html#LN5464"><span class='Ref_to_Parameter'>input_type</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5465"><span class='Ref_to_Parameter'>rcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="arrayfuncs.c.html#LN5462"><span class='Ref_to_Parameter'>astate</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end accumArrayResultAny &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * makeArrayResultAny - produce final result of accumArrayResultAny 
 * 
 *  astate is working state (must not be NULL) 
 *  rcontext is where to construct result 
 *  release is true if okay to release working state 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN5490"></a><span class='Declare_Function'>makeArrayResultAny</span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN206"><span class='Ref_to_Struct'>ArrayBuildStateAny</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>astate</span><span class='Delimiter'>, 
</span><a name="LN5491"></a>                   <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>rcontext</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>release</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5493"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5490"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN209"><span class='Ref_to_Member'>scalarstate</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Must use makeMdArrayResult to support "release" parameter */ 
</span><a name="LN5498"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>ndims</span><span class='Delimiter'>; 
</span><a name="LN5499"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>dims</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN5500"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>lbs</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
        <span class='Comment_Multi_Line'>/* If no elements were presented, we want to create an empty array */ 
</span>        <a href="arrayfuncs.c.html#LN5498"><span class='Ref_To_Local'>ndims</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5490"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN209"><span class='Ref_to_Member'>scalarstate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN173"><span class='Ref_to_Member'>nelems</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Number'>1</span> <span class='Operator'>: </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN5499"><span class='Ref_To_Local'>dims</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="arrayfuncs.c.html#LN5490"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN209"><span class='Ref_to_Member'>scalarstate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN173"><span class='Ref_to_Member'>nelems</span></a><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN5500"><span class='Ref_To_Local'>lbs</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
        <a href="arrayfuncs.c.html#LN5493"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN396"><span class='Ref_to_Proto'>makeMdArrayResult</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5490"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN209"><span class='Ref_to_Member'>scalarstate</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5498"><span class='Ref_To_Local'>ndims</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5499"><span class='Ref_To_Local'>dims</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5500"><span class='Ref_To_Local'>lbs</span></a><span class='Delimiter'>, 
</span>                                   <a href="arrayfuncs.c.html#LN5491"><span class='Ref_to_Parameter'>rcontext</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5491"><span class='Ref_to_Parameter'>release</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="arrayfuncs.c.html#LN5493"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN405"><span class='Ref_to_Proto'>makeArrayResultArr</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5490"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN210"><span class='Ref_to_Member'>arraystate</span></a><span class='Delimiter'>, 
</span>                                    <a href="arrayfuncs.c.html#LN5491"><span class='Ref_to_Parameter'>rcontext</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5491"><span class='Ref_to_Parameter'>release</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="arrayfuncs.c.html#LN5493"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end makeArrayResultAny &raquo; </span> 
 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN5520"></a><span class='Declare_Function'>array_larger</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN139"><span class='Ref_to_Proto'>array_cmp</span></a><span class='Parentheses'>(</span>fcinfo<span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../../include/fmgr.h.html#LN312"><span class='Ref_to_Macro'>PG_RETURN_DATUM</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../../include/fmgr.h.html#LN312"><span class='Ref_to_Macro'>PG_RETURN_DATUM</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN5529"></a><span class='Declare_Function'>array_smaller</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN139"><span class='Ref_to_Proto'>array_cmp</span></a><span class='Parentheses'>(</span>fcinfo<span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../../include/fmgr.h.html#LN312"><span class='Ref_to_Macro'>PG_RETURN_DATUM</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../../include/fmgr.h.html#LN312"><span class='Ref_to_Macro'>PG_RETURN_DATUM</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
 
<a name="LN5538"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>generate_subscripts_fctx</span> 
<span class='Delimiter'>{ 
</span><a name="LN5540"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Member'>lower</span><span class='Delimiter'>; 
</span><a name="LN5541"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Member'>upper</span><span class='Delimiter'>; 
</span><a name="LN5542"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>reverse</span><span class='Delimiter'>; 
</span><a name="LN5543"></a>} <span class='Declare_Typedef'>generate_subscripts_fctx</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * generate_subscripts(array anyarray, dim int [, reverse bool]) 
 *      Returns all subscripts of the array for any dimension 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN5550"></a><span class='Declare_Function'>generate_subscripts</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5552"></a>    <a href="../../../include/funcapi.h.html#LN56"><span class='Ref_to_Struct'>FuncCallContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>funcctx</span><span class='Delimiter'>; 
</span><a name="LN5553"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span><a name="LN5554"></a>    <a href="arrayfuncs.c.html#LN5538"><span class='Ref_to_Struct'>generate_subscripts_fctx</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fctx</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* stuff done only on the first call of the function */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/funcapi.h.html#LN284"><span class='Ref_to_Macro'>SRF_IS_FIRSTCALL</span></a><span class='Parentheses'>())</span> 
    <span class='Delimiter'>{ 
</span><a name="LN5559"></a>        <a href="../../../include/utils/array.h.html#LN157"><span class='Ref_to_Union'>AnyArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Local'>v</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN254"><span class='Ref_to_Macro'>PG_GETARG_ANY_ARRAY</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN5560"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>reqdim</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN5561"></a>        <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Local'>lb</span><span class='Delimiter'>, 
</span><a name="LN5562"></a>                   <span class='Operator'>*</span><span class='Declare_Local'>dimv</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* create a function context for cross-call persistence */ 
</span>        <a href="arrayfuncs.c.html#LN5552"><span class='Ref_To_Local'>funcctx</span></a> <span class='Operator'>= </span><a href="../../../include/funcapi.h.html#LN286"><span class='Ref_to_Macro'>SRF_FIRSTCALL_INIT</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Sanity check: does it look like an array at all? */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN308"><span class='Ref_to_Macro'>AARR_NDIM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5559"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="../../../include/utils/array.h.html#LN308"><span class='Ref_to_Macro'>AARR_NDIM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5559"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Parentheses'>)</span> 
            <a href="../../../include/funcapi.h.html#LN308"><span class='Ref_to_Macro'>SRF_RETURN_DONE</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5552"><span class='Ref_To_Local'>funcctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Sanity check: was the requested dim valid */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5560"><span class='Ref_To_Local'>reqdim</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="arrayfuncs.c.html#LN5560"><span class='Ref_To_Local'>reqdim</span></a> <span class='Operator'>&GT; </span><a href="../../../include/utils/array.h.html#LN308"><span class='Ref_to_Macro'>AARR_NDIM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5559"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/funcapi.h.html#LN308"><span class='Ref_to_Macro'>SRF_RETURN_DONE</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5552"><span class='Ref_To_Local'>funcctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * switch to memory context appropriate for multiple function calls 
         */ 
</span>        <a href="arrayfuncs.c.html#LN5553"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5552"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN108"><span class='Ref_to_Member'>multi_call_memory_ctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN5554"><span class='Ref_To_Local'>fctx</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5538"><span class='Ref_to_Struct'>generate_subscripts_fctx</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5538"><span class='Ref_to_Struct'>generate_subscripts_fctx</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="arrayfuncs.c.html#LN5561"><span class='Ref_To_Local'>lb</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN318"><span class='Ref_to_Macro'>AARR_LBOUND</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5559"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN5562"><span class='Ref_To_Local'>dimv</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN316"><span class='Ref_to_Macro'>AARR_DIMS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5559"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="arrayfuncs.c.html#LN5554"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN5540"><span class='Ref_to_Member'>lower</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN5561"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN5560"><span class='Ref_To_Local'>reqdim</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span>        <a href="arrayfuncs.c.html#LN5554"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN5541"><span class='Ref_to_Member'>upper</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN5562"><span class='Ref_To_Local'>dimv</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN5560"><span class='Ref_To_Local'>reqdim</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN5561"><span class='Ref_To_Local'>lb</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN5560"><span class='Ref_To_Local'>reqdim</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN5554"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN5542"><span class='Ref_to_Member'>reverse</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN167"><span class='Ref_to_Macro'>PG_NARGS</span></a><span class='Parentheses'>() </span><span class='Operator'>&LT; </span><span class='Number'>3</span><span class='Parentheses'>)</span> <span class='Operator'>? </span><span class='Boolean'>false </span><span class='Operator'>: </span><a href="../../../include/fmgr.h.html#LN238"><span class='Ref_to_Macro'>PG_GETARG_BOOL</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="arrayfuncs.c.html#LN5552"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN89"><span class='Ref_to_Member'>user_fctx</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN5554"><span class='Ref_To_Local'>fctx</span></a><span class='Delimiter'>; 
</span> 
        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5553"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if SRF_IS_FIRSTCALL() &raquo; </span> 
 
    <a href="arrayfuncs.c.html#LN5552"><span class='Ref_To_Local'>funcctx</span></a> <span class='Operator'>= </span><a href="../../../include/funcapi.h.html#LN288"><span class='Ref_to_Macro'>SRF_PERCALL_SETUP</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN5554"><span class='Ref_To_Local'>fctx</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN5552"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN89"><span class='Ref_to_Member'>user_fctx</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5554"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN5540"><span class='Ref_to_Member'>lower</span></a> <span class='Operator'>&LT;= </span><a href="arrayfuncs.c.html#LN5554"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN5541"><span class='Ref_to_Member'>upper</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="arrayfuncs.c.html#LN5554"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN5542"><span class='Ref_to_Member'>reverse</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/funcapi.h.html#LN290"><span class='Ref_to_Macro'>SRF_RETURN_NEXT</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5552"><span class='Ref_To_Local'>funcctx</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN484"><span class='Ref_to_Macro'>Int32GetDatum</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5554"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN5540"><span class='Ref_to_Member'>lower</span></a><span class='Operator'>++</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../../include/funcapi.h.html#LN290"><span class='Ref_to_Macro'>SRF_RETURN_NEXT</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5552"><span class='Ref_To_Local'>funcctx</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN484"><span class='Ref_to_Macro'>Int32GetDatum</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5554"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN5541"><span class='Ref_to_Member'>upper</span></a><span class='Operator'>--</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <span class='Comment_Multi_Line'>/* done when there are no more elements left */ 
</span>        <a href="../../../include/funcapi.h.html#LN308"><span class='Ref_to_Macro'>SRF_RETURN_DONE</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5552"><span class='Ref_To_Local'>funcctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end generate_subscripts &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * generate_subscripts_nodir 
 *      Implements the 2-argument version of generate_subscripts 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN5614"></a><span class='Declare_Function'>generate_subscripts_nodir</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* just call the other one -- it can handle both cases */ 
</span>    <span class='Control'>return</span> <a href="arrayfuncs.c.html#LN5549"><span class='Ref_to_Func'>generate_subscripts</span></a><span class='Parentheses'>(</span>fcinfo<span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * array_fill_with_lower_bounds 
 *      Create and fill array with defined lower bounds. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN5625"></a><span class='Declare_Function'>array_fill_with_lower_bounds</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5627"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>dims</span><span class='Delimiter'>; 
</span><a name="LN5628"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>lbs</span><span class='Delimiter'>; 
</span><a name="LN5629"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN5630"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>elmtype</span><span class='Delimiter'>; 
</span><a name="LN5631"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>value</span><span class='Delimiter'>; 
</span><a name="LN5632"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>|| </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NULL_VALUE_NOT_ALLOWED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>               <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"dimension array or low bound array cannot be null"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN5627"><span class='Ref_To_Local'>dims</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN5628"><span class='Ref_To_Local'>lbs</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Keyword'>value </span><span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN5632"><span class='Ref_To_Local'>isnull</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Keyword'>value </span><span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN5632"><span class='Ref_To_Local'>isnull</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="arrayfuncs.c.html#LN5630"><span class='Ref_To_Local'>elmtype</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN663"><span class='Ref_to_Proto'>get_fn_expr_argtype</span></a><span class='Parentheses'>(</span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5630"><span class='Ref_To_Local'>elmtype</span></a><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not determine data type of input"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN5629"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN142"><span class='Ref_to_Proto'>array_fill_internal</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5627"><span class='Ref_To_Local'>dims</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5628"><span class='Ref_To_Local'>lbs</span></a><span class='Delimiter'>, </span><span class='Keyword'>value</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5632"><span class='Ref_To_Local'>isnull</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5630"><span class='Ref_To_Local'>elmtype</span></a><span class='Delimiter'>, </span>fcinfo<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/array.h.html#LN245"><span class='Ref_to_Macro'>PG_RETURN_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5629"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end array_fill_with_lower_bounds &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * array_fill 
 *      Create and fill array with default lower bounds. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN5666"></a><span class='Declare_Function'>array_fill</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5668"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>dims</span><span class='Delimiter'>; 
</span><a name="LN5669"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN5670"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>elmtype</span><span class='Delimiter'>; 
</span><a name="LN5671"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>value</span><span class='Delimiter'>; 
</span><a name="LN5672"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NULL_VALUE_NOT_ALLOWED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>               <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"dimension array or low bound array cannot be null"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN5668"><span class='Ref_To_Local'>dims</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Keyword'>value </span><span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN5672"><span class='Ref_To_Local'>isnull</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Keyword'>value </span><span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN5672"><span class='Ref_To_Local'>isnull</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="arrayfuncs.c.html#LN5670"><span class='Ref_To_Local'>elmtype</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN663"><span class='Ref_to_Proto'>get_fn_expr_argtype</span></a><span class='Parentheses'>(</span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5670"><span class='Ref_To_Local'>elmtype</span></a><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not determine data type of input"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN5669"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN142"><span class='Ref_to_Proto'>array_fill_internal</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5668"><span class='Ref_To_Local'>dims</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Keyword'>value</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5672"><span class='Ref_To_Local'>isnull</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5670"><span class='Ref_To_Local'>elmtype</span></a><span class='Delimiter'>, </span>fcinfo<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/array.h.html#LN245"><span class='Ref_to_Macro'>PG_RETURN_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5669"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end array_fill &raquo; </span> 
 
<span class='Keyword'>static </span><a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>* 
</span><a name="LN5701"></a><span class='Declare_Function'>create_array_envelope</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>ndims</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>dimv</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>lbsv</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>nbytes</span><span class='Delimiter'>, 
</span><a name="LN5702"></a>                      <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>elmtype</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>dataoffset</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5704"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN5704"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5701"><span class='Ref_to_Parameter'>nbytes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5704"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5701"><span class='Ref_to_Parameter'>nbytes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN5704"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN78"><span class='Ref_to_Member'>ndim</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN5701"><span class='Ref_to_Parameter'>ndims</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN5704"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN79"><span class='Ref_to_Member'>dataoffset</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN5702"><span class='Ref_to_Parameter'>dataoffset</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN5704"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN80"><span class='Ref_to_Member'>elemtype</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN5702"><span class='Ref_to_Parameter'>elmtype</span></a><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5704"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5701"><span class='Ref_to_Parameter'>dimv</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5701"><span class='Ref_to_Parameter'>ndims</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN276"><span class='Ref_to_Macro'>ARR_LBOUND</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5704"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5701"><span class='Ref_to_Parameter'>lbsv</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5701"><span class='Ref_to_Parameter'>ndims</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="arrayfuncs.c.html#LN5704"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static </span><a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>* 
</span><a name="LN5718"></a><span class='Declare_Function'>array_fill_internal</span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>dims</span><span class='Delimiter'>, </span><a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lbs</span><span class='Delimiter'>, 
</span><a name="LN5719"></a>                    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>value</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isnull</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>elmtype</span><span class='Delimiter'>, 
</span><a name="LN5720"></a>                    <a href="../../../include/fmgr.h.html#LN37"><span class='Ref_to_Typedef'>FunctionCallInfo</span></a> <span class='Declare_Parameter'>fcinfo</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5722"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN5723"></a>    <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Local'>dimv</span><span class='Delimiter'>; 
</span><a name="LN5724"></a>    <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Local'>lbsv</span><span class='Delimiter'>; 
</span><a name="LN5725"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ndims</span><span class='Delimiter'>; 
</span><a name="LN5726"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nitems</span><span class='Delimiter'>; 
</span><a name="LN5727"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>deflbs</span><span class='Delimiter'>[</span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Delimiter'>]; 
</span><a name="LN5728"></a>    <a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>       <span class='Declare_Local'>elmlen</span><span class='Delimiter'>; 
</span><a name="LN5729"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>elmbyval</span><span class='Delimiter'>; 
</span><a name="LN5730"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>elmalign</span><span class='Delimiter'>; 
</span><a name="LN5731"></a>    <a href="../../../include/utils/array.h.html#LN216"><span class='Ref_to_Struct'>ArrayMetaState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>my_extra</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Params checks 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5718"><span class='Ref_to_Parameter'>dims</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ARRAY_SUBSCRIPT_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"wrong number of array subscripts"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Dimension array must be one dimensional."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN386"><span class='Ref_to_Proto'>array_contains_nulls</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5718"><span class='Ref_to_Parameter'>dims</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NULL_VALUE_NOT_ALLOWED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"dimension values cannot be null"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN5723"><span class='Ref_To_Local'>dimv</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/array.h.html#LN302"><span class='Ref_to_Macro'>ARR_DATA_PTR</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5718"><span class='Ref_to_Parameter'>dims</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN5725"><span class='Ref_To_Local'>ndims</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5718"><span class='Ref_to_Parameter'>dims</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> <span class='Operator'>? </span><a href="../../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5718"><span class='Ref_to_Parameter'>dims</span></a><span class='Parentheses'>)</span><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>: </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5725"><span class='Ref_To_Local'>ndims</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span>              <span class='Comment_Single_Line'>/* we do allow zero-dimension arrays */ 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid number of dimensions: %d"</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5725"><span class='Ref_To_Local'>ndims</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5725"><span class='Ref_To_Local'>ndims</span></a> <span class='Operator'>&GT; </span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_PROGRAM_LIMIT_EXCEEDED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"number of array dimensions (%d) exceeds the maximum allowed (%d)"</span><span class='Delimiter'>, 
</span>                        <a href="arrayfuncs.c.html#LN5725"><span class='Ref_To_Local'>ndims</span></a><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5718"><span class='Ref_to_Parameter'>lbs</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5718"><span class='Ref_to_Parameter'>lbs</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ARRAY_SUBSCRIPT_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"wrong number of array subscripts"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Dimension array must be one dimensional."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN386"><span class='Ref_to_Proto'>array_contains_nulls</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5718"><span class='Ref_to_Parameter'>lbs</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NULL_VALUE_NOT_ALLOWED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"dimension values cannot be null"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5725"><span class='Ref_To_Local'>ndims</span></a> <span class='Operator'>!= </span><span class='Parentheses'>((</span><a href="../../../include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5718"><span class='Ref_to_Parameter'>lbs</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> <span class='Operator'>? </span><a href="../../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5718"><span class='Ref_to_Parameter'>lbs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>: </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ARRAY_SUBSCRIPT_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"wrong number of array subscripts"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Low bound array has different size than dimensions array."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="arrayfuncs.c.html#LN5724"><span class='Ref_To_Local'>lbsv</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/array.h.html#LN302"><span class='Ref_to_Macro'>ARR_DATA_PTR</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5718"><span class='Ref_to_Parameter'>lbs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if lbs!=NULL &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN5783"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5783"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN5783"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN5783"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <a href="arrayfuncs.c.html#LN5727"><span class='Ref_To_Local'>deflbs</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN5783"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
        <a href="arrayfuncs.c.html#LN5724"><span class='Ref_To_Local'>lbsv</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN5727"><span class='Ref_To_Local'>deflbs</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="arrayfuncs.c.html#LN5726"><span class='Ref_To_Local'>nitems</span></a> <span class='Operator'>= </span><a href="arrayutils.c.html#LN73"><span class='Ref_to_Func'>ArrayGetNItems</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5725"><span class='Ref_To_Local'>ndims</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5723"><span class='Ref_To_Local'>dimv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* fast track for empty array */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5726"><span class='Ref_To_Local'>nitems</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../../include/utils/array.h.html#LN378"><span class='Ref_to_Proto'>construct_empty_array</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5719"><span class='Ref_to_Parameter'>elmtype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We arrange to look up info about element type only once per series of 
     * calls, assuming the element type doesn't change underneath us. 
     */ 
</span>    <a href="arrayfuncs.c.html#LN5731"><span class='Ref_To_Local'>my_extra</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN216"><span class='Ref_to_Struct'>ArrayMetaState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="arrayfuncs.c.html#LN5720"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN78"><span class='Ref_to_Member'>flinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN63"><span class='Ref_to_Member'>fn_extra</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5731"><span class='Ref_To_Local'>my_extra</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="arrayfuncs.c.html#LN5720"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN78"><span class='Ref_to_Member'>flinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN63"><span class='Ref_to_Member'>fn_extra</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5720"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN78"><span class='Ref_to_Member'>flinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN64"><span class='Ref_to_Member'>fn_mcxt</span></a><span class='Delimiter'>, 
</span>                                                      <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN216"><span class='Ref_to_Struct'>ArrayMetaState</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN5731"><span class='Ref_To_Local'>my_extra</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN216"><span class='Ref_to_Struct'>ArrayMetaState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="arrayfuncs.c.html#LN5720"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN78"><span class='Ref_to_Member'>flinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN63"><span class='Ref_to_Member'>fn_extra</span></a><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN5731"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN218"><span class='Ref_to_Member'>element_type</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5731"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN218"><span class='Ref_to_Member'>element_type</span></a> <span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN5719"><span class='Ref_to_Parameter'>elmtype</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Get info about element type */ 
</span>        <a href="../../../include/utils/lsyscache.h.html#LN136"><span class='Ref_to_Proto'>get_typlenbyvalalign</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5719"><span class='Ref_to_Parameter'>elmtype</span></a><span class='Delimiter'>, 
</span>                             <span class='Operator'>&</span><a href="arrayfuncs.c.html#LN5731"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN219"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>, 
</span>                             <span class='Operator'>&</span><a href="arrayfuncs.c.html#LN5731"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN220"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>, 
</span>                             <span class='Operator'>&</span><a href="arrayfuncs.c.html#LN5731"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN221"><span class='Ref_to_Member'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN5731"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN218"><span class='Ref_to_Member'>element_type</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN5719"><span class='Ref_to_Parameter'>elmtype</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="arrayfuncs.c.html#LN5728"><span class='Ref_To_Local'>elmlen</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN5731"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN219"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN5729"><span class='Ref_To_Local'>elmbyval</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN5731"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN220"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN5730"><span class='Ref_To_Local'>elmalign</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN5731"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN221"><span class='Ref_to_Member'>typalign</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* compute required space */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="arrayfuncs.c.html#LN5719"><span class='Ref_to_Parameter'>isnull</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN5827"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN5828"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span><a name="LN5829"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>nbytes</span><span class='Delimiter'>; 
</span><a name="LN5830"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>totbytes</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* make sure data is not toasted */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5728"><span class='Ref_To_Local'>elmlen</span></a> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <span class='Keyword'>value </span><span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN204"><span class='Ref_to_Macro'>PG_DETOAST_DATUM</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="arrayfuncs.c.html#LN5829"><span class='Ref_To_Local'>nbytes</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN159"><span class='Ref_to_Macro'>att_addlength_datum</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5728"><span class='Ref_To_Local'>elmlen</span></a><span class='Delimiter'>, </span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN5829"><span class='Ref_To_Local'>nbytes</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN143"><span class='Ref_to_Macro'>att_align_nominal</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5829"><span class='Ref_To_Local'>nbytes</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5730"><span class='Ref_To_Local'>elmalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5829"><span class='Ref_To_Local'>nbytes</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="arrayfuncs.c.html#LN5830"><span class='Ref_To_Local'>totbytes</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN5829"><span class='Ref_To_Local'>nbytes</span></a> <span class='Operator'>* </span><a href="arrayfuncs.c.html#LN5726"><span class='Ref_To_Local'>nitems</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* check for overflow of multiplication or total request */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5830"><span class='Ref_To_Local'>totbytes</span></a> <span class='Operator'>/ </span><a href="arrayfuncs.c.html#LN5829"><span class='Ref_To_Local'>nbytes</span></a> <span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN5726"><span class='Ref_To_Local'>nitems</span></a> <span class='Operator'>|| 
</span>            <span class='Operator'>!</span><a href="../../../include/utils/memutils.h.html#LN41"><span class='Ref_to_Macro'>AllocSizeIsValid</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5830"><span class='Ref_To_Local'>totbytes</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_PROGRAM_LIMIT_EXCEEDED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"array size exceeds the maximum allowed (%d)"</span><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="../../../common/psprintf.c.html#LN27"><span class='Ref_to_Const'>MaxAllocSize</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * This addition can't overflow, but it might cause us to go past 
         * MaxAllocSize.  We leave it to palloc to complain in that case. 
         */ 
</span>        <a href="arrayfuncs.c.html#LN5830"><span class='Ref_To_Local'>totbytes</span></a> <span class='Operator'>+= </span><a href="../../../include/utils/array.h.html#LN290"><span class='Ref_to_Macro'>ARR_OVERHEAD_NONULLS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5725"><span class='Ref_To_Local'>ndims</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="arrayfuncs.c.html#LN5722"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN140"><span class='Ref_to_Proto'>create_array_envelope</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5725"><span class='Ref_To_Local'>ndims</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5723"><span class='Ref_To_Local'>dimv</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5724"><span class='Ref_To_Local'>lbsv</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5830"><span class='Ref_To_Local'>totbytes</span></a><span class='Delimiter'>, 
</span>                                       <a href="arrayfuncs.c.html#LN5719"><span class='Ref_to_Parameter'>elmtype</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="arrayfuncs.c.html#LN5828"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN302"><span class='Ref_to_Macro'>ARR_DATA_PTR</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5722"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5827"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN5827"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN5726"><span class='Ref_To_Local'>nitems</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN5827"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <a href="arrayfuncs.c.html#LN5828"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+= </span><a href="arrayfuncs.c.html#LN115"><span class='Ref_to_Proto'>ArrayCastAndSet</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5728"><span class='Ref_To_Local'>elmlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5729"><span class='Ref_To_Local'>elmbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5730"><span class='Ref_To_Local'>elmalign</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5828"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !isnull &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN5865"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>nbytes</span><span class='Delimiter'>; 
</span><a name="LN5866"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>dataoffset</span><span class='Delimiter'>; 
</span> 
        <a href="arrayfuncs.c.html#LN5866"><span class='Ref_To_Local'>dataoffset</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN292"><span class='Ref_to_Macro'>ARR_OVERHEAD_WITHNULLS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5725"><span class='Ref_To_Local'>ndims</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5726"><span class='Ref_To_Local'>nitems</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN5865"><span class='Ref_To_Local'>nbytes</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN5866"><span class='Ref_To_Local'>dataoffset</span></a><span class='Delimiter'>; 
</span> 
        <a href="arrayfuncs.c.html#LN5722"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN140"><span class='Ref_to_Proto'>create_array_envelope</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5725"><span class='Ref_To_Local'>ndims</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5723"><span class='Ref_To_Local'>dimv</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5724"><span class='Ref_To_Local'>lbsv</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5865"><span class='Ref_To_Local'>nbytes</span></a><span class='Delimiter'>, 
</span>                                       <a href="arrayfuncs.c.html#LN5719"><span class='Ref_to_Parameter'>elmtype</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5866"><span class='Ref_To_Local'>dataoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* create_array_envelope already zeroed the bitmap, so we're done */ 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="arrayfuncs.c.html#LN5722"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end array_fill_internal &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * UNNEST 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN5885"></a><span class='Declare_Function'>array_unnest</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>typedef</span> <span class='Control'>struct</span> 
    <span class='Delimiter'>{ 
</span><a name="LN5889"></a>        <a href="../../../include/utils/arrayaccess.h.html#LN32"><span class='Ref_to_Struct'>array_iter</span></a>  <span class='Declare_Member'>iter</span><span class='Delimiter'>; 
</span><a name="LN5890"></a>        <span class='Keyword'>int</span>         <span class='Declare_Member'>nextelem</span><span class='Delimiter'>; 
</span><a name="LN5891"></a>        <span class='Keyword'>int</span>         <span class='Declare_Member'>numelems</span><span class='Delimiter'>; 
</span><a name="LN5892"></a>        <a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>       <span class='Declare_Member'>elmlen</span><span class='Delimiter'>; 
</span><a name="LN5893"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Member'>elmbyval</span><span class='Delimiter'>; 
</span><a name="LN5894"></a>        <span class='Keyword'>char</span>        <span class='Declare_Member'>elmalign</span><span class='Delimiter'>; 
</span><a name="LN5895"></a>    <span class='Delimiter'>} </span><span class='Declare_Local'>array_unnest_fctx</span><span class='Delimiter'>; 
</span> 
<a name="LN5897"></a>    <a href="../../../include/funcapi.h.html#LN56"><span class='Ref_to_Struct'>FuncCallContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>funcctx</span><span class='Delimiter'>; 
</span><a name="LN5898"></a>    <a href="arrayfuncs.c.html#LN5895"><span class='Ref_to_Typedef'>array_unnest_fctx</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fctx</span><span class='Delimiter'>; 
</span><a name="LN5899"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* stuff done only on the first call of the function */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/funcapi.h.html#LN284"><span class='Ref_to_Macro'>SRF_IS_FIRSTCALL</span></a><span class='Parentheses'>())</span> 
    <span class='Delimiter'>{ 
</span><a name="LN5904"></a>        <a href="../../../include/utils/array.h.html#LN157"><span class='Ref_to_Union'>AnyArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Local'>arr</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* create a function context for cross-call persistence */ 
</span>        <a href="arrayfuncs.c.html#LN5897"><span class='Ref_To_Local'>funcctx</span></a> <span class='Operator'>= </span><a href="../../../include/funcapi.h.html#LN286"><span class='Ref_to_Macro'>SRF_FIRSTCALL_INIT</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * switch to memory context appropriate for multiple function calls 
         */ 
</span>        <a href="arrayfuncs.c.html#LN5899"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5897"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN108"><span class='Ref_to_Member'>multi_call_memory_ctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Get the array value and detoast if needed.  We can't do this 
         * earlier because if we have to detoast, we want the detoasted copy 
         * to be in multi_call_memory_ctx, so it will go away when we're done 
         * and not before.  (If no detoast happens, we assume the originally 
         * passed array will stick around till then.) 
         */ 
</span>        <a href="arrayfuncs.c.html#LN5904"><span class='Ref_To_Local'>arr</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN254"><span class='Ref_to_Macro'>PG_GETARG_ANY_ARRAY</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* allocate memory for user context */ 
</span>        <a href="arrayfuncs.c.html#LN5898"><span class='Ref_To_Local'>fctx</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5895"><span class='Ref_to_Typedef'>array_unnest_fctx</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5895"><span class='Ref_to_Typedef'>array_unnest_fctx</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* initialize state */ 
</span>        <a href="../../../include/utils/arrayaccess.h.html#LN47"><span class='Ref_to_Func'>array_iter_setup</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN5898"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN5889"><span class='Ref_to_Member'>iter</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5904"><span class='Ref_To_Local'>arr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN5898"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN5890"><span class='Ref_to_Member'>nextelem</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN5898"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN5891"><span class='Ref_to_Member'>numelems</span></a> <span class='Operator'>= </span><a href="arrayutils.c.html#LN73"><span class='Ref_to_Func'>ArrayGetNItems</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN308"><span class='Ref_to_Macro'>AARR_NDIM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5904"><span class='Ref_To_Local'>arr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/utils/array.h.html#LN316"><span class='Ref_to_Macro'>AARR_DIMS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5904"><span class='Ref_To_Local'>arr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/expandeddatum.h.html#LN127"><span class='Ref_to_Macro'>VARATT_IS_EXPANDED_HEADER</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5904"><span class='Ref_To_Local'>arr</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* we can just grab the type data from expanded array */ 
</span>            <a href="arrayfuncs.c.html#LN5898"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN5892"><span class='Ref_to_Member'>elmlen</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN5904"><span class='Ref_To_Local'>arr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN160"><span class='Ref_to_Member'>xpn</span></a><span class='Operator'>.</span><a href="../../../include/utils/array.h.html#LN113"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN5898"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN5893"><span class='Ref_to_Member'>elmbyval</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN5904"><span class='Ref_To_Local'>arr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN160"><span class='Ref_to_Member'>xpn</span></a><span class='Operator'>.</span><a href="../../../include/utils/array.h.html#LN114"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN5898"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN5894"><span class='Ref_to_Member'>elmalign</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN5904"><span class='Ref_To_Local'>arr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN160"><span class='Ref_to_Member'>xpn</span></a><span class='Operator'>.</span><a href="../../../include/utils/array.h.html#LN115"><span class='Ref_to_Member'>typalign</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="../../../include/utils/lsyscache.h.html#LN136"><span class='Ref_to_Proto'>get_typlenbyvalalign</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN314"><span class='Ref_to_Macro'>AARR_ELEMTYPE</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5904"><span class='Ref_To_Local'>arr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <span class='Operator'>&</span><a href="arrayfuncs.c.html#LN5898"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN5892"><span class='Ref_to_Member'>elmlen</span></a><span class='Delimiter'>, 
</span>                                 <span class='Operator'>&</span><a href="arrayfuncs.c.html#LN5898"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN5893"><span class='Ref_to_Member'>elmbyval</span></a><span class='Delimiter'>, 
</span>                                 <span class='Operator'>&</span><a href="arrayfuncs.c.html#LN5898"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN5894"><span class='Ref_to_Member'>elmalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="arrayfuncs.c.html#LN5897"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN89"><span class='Ref_to_Member'>user_fctx</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN5898"><span class='Ref_To_Local'>fctx</span></a><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5899"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if SRF_IS_FIRSTCALL() &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* stuff done on every call of the function */ 
</span>    <a href="arrayfuncs.c.html#LN5897"><span class='Ref_To_Local'>funcctx</span></a> <span class='Operator'>= </span><a href="../../../include/funcapi.h.html#LN288"><span class='Ref_to_Macro'>SRF_PERCALL_SETUP</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN5898"><span class='Ref_To_Local'>fctx</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN5897"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN89"><span class='Ref_to_Member'>user_fctx</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5898"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN5890"><span class='Ref_to_Member'>nextelem</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN5898"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN5891"><span class='Ref_to_Member'>numelems</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN5954"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>offset</span> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN5898"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN5890"><span class='Ref_to_Member'>nextelem</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span><a name="LN5955"></a>        <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>elem</span><span class='Delimiter'>; 
</span> 
        <a href="arrayfuncs.c.html#LN5955"><span class='Ref_To_Local'>elem</span></a> <span class='Operator'>= </span><a href="../../../include/utils/arrayaccess.h.html#LN79"><span class='Ref_to_Func'>array_iter_next</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN5898"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN5889"><span class='Ref_to_Member'>iter</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span>fcinfo<span class='Operator'>-&GT;</span>isnull<span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5954"><span class='Ref_To_Local'>offset</span></a><span class='Delimiter'>, 
</span>                               <a href="arrayfuncs.c.html#LN5898"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN5892"><span class='Ref_to_Member'>elmlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5898"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN5893"><span class='Ref_to_Member'>elmbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5898"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="arrayfuncs.c.html#LN5894"><span class='Ref_to_Member'>elmalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/funcapi.h.html#LN290"><span class='Ref_to_Macro'>SRF_RETURN_NEXT</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5897"><span class='Ref_To_Local'>funcctx</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5955"><span class='Ref_To_Local'>elem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* do when there is no more left */ 
</span>        <a href="../../../include/funcapi.h.html#LN308"><span class='Ref_to_Macro'>SRF_RETURN_DONE</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5897"><span class='Ref_To_Local'>funcctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end array_unnest &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * array_replace/array_remove support 
 * 
 * Find all array entries matching (not distinct from) search/search_isnull, 
 * and delete them if remove is true, else replace them with 
 * replace/replace_isnull.  Comparisons are done using the specified 
 * collation.  fcinfo is passed only for caching purposes. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>* 
</span><a name="LN5979"></a><span class='Declare_Function'>array_replace_internal</span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>array</span><span class='Delimiter'>, 
</span><a name="LN5980"></a>                       <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>search</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>search_isnull</span><span class='Delimiter'>, 
</span><a name="LN5981"></a>                       <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>replace</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>replace_isnull</span><span class='Delimiter'>, 
</span><a name="LN5982"></a>                       <span class='Keyword'>bool </span><span class='Declare_Parameter'>remove</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>collation</span><span class='Delimiter'>, 
</span><a name="LN5983"></a>                       <a href="../../../include/fmgr.h.html#LN37"><span class='Ref_to_Typedef'>FunctionCallInfo</span></a> <span class='Declare_Parameter'>fcinfo</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5985"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN5986"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>element_type</span><span class='Delimiter'>; 
</span><a name="LN5987"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>values</span><span class='Delimiter'>; 
</span><a name="LN5988"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>nulls</span><span class='Delimiter'>; 
</span><a name="LN5989"></a>    <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Local'>dim</span><span class='Delimiter'>; 
</span><a name="LN5990"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ndim</span><span class='Delimiter'>; 
</span><a name="LN5991"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nitems</span><span class='Delimiter'>, 
</span><a name="LN5992"></a>                <span class='Declare_Local'>nresult</span><span class='Delimiter'>; 
</span><a name="LN5993"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN5994"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>nbytes</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN5995"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>dataoffset</span><span class='Delimiter'>; 
</span><a name="LN5996"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>hasnulls</span><span class='Delimiter'>; 
</span><a name="LN5997"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>typlen</span><span class='Delimiter'>; 
</span><a name="LN5998"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>typbyval</span><span class='Delimiter'>; 
</span><a name="LN5999"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>typalign</span><span class='Delimiter'>; 
</span><a name="LN6000"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>arraydataptr</span><span class='Delimiter'>; 
</span><a name="LN6001"></a>    <a href="../../../include/c.h.html#LN274"><span class='Ref_to_Typedef'>bits8</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>bitmap</span><span class='Delimiter'>; 
</span><a name="LN6002"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>bitmask</span><span class='Delimiter'>; 
</span><a name="LN6003"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>changed</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN6004"></a>    <a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>typentry</span><span class='Delimiter'>; 
</span><a name="LN6005"></a>    <a href="../../../include/fmgr.h.html#LN76"><span class='Ref_to_Struct'>FunctionCallInfoData</span></a> <span class='Declare_Local'>locfcinfo</span><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN5986"><span class='Ref_To_Local'>element_type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN272"><span class='Ref_to_Macro'>ARR_ELEMTYPE</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5979"><span class='Ref_to_Parameter'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN5990"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5979"><span class='Ref_to_Parameter'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN5989"><span class='Ref_To_Local'>dim</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5979"><span class='Ref_to_Parameter'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN5991"><span class='Ref_To_Local'>nitems</span></a> <span class='Operator'>= </span><a href="arrayutils.c.html#LN73"><span class='Ref_to_Func'>ArrayGetNItems</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5990"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5989"><span class='Ref_To_Local'>dim</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Return input array unmodified if it is empty */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5991"><span class='Ref_To_Local'>nitems</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="arrayfuncs.c.html#LN5979"><span class='Ref_to_Parameter'>array</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We can't remove elements from multi-dimensional arrays, since the 
     * result might not be rectangular. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5982"><span class='Ref_to_Parameter'>remove</span></a> <span class='Operator'>&& </span><a href="arrayfuncs.c.html#LN5990"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"removing elements from multidimensional arrays is not supported"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We arrange to look up the equality function only once per series of 
     * calls, assuming the element type doesn't change underneath us. 
     */ 
</span>    <a href="arrayfuncs.c.html#LN6004"><span class='Ref_To_Local'>typentry</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="arrayfuncs.c.html#LN5983"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN78"><span class='Ref_to_Member'>flinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN63"><span class='Ref_to_Member'>fn_extra</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6004"><span class='Ref_To_Local'>typentry</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| 
</span>        <a href="arrayfuncs.c.html#LN6004"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN31"><span class='Ref_to_Member'>type_id</span></a> <span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN5986"><span class='Ref_To_Local'>element_type</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="arrayfuncs.c.html#LN6004"><span class='Ref_To_Local'>typentry</span></a> <span class='Operator'>= </span><a href="../../../include/utils/typcache.h.html#LN142"><span class='Ref_to_Proto'>lookup_type_cache</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5986"><span class='Ref_To_Local'>element_type</span></a><span class='Delimiter'>, 
</span>                                     <a href="../../../include/utils/typcache.h.html#LN114"><span class='Ref_to_Const'>TYPECACHE_EQ_OPR_FINFO</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6004"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN66"><span class='Ref_to_Member'>eq_opr_finfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN58"><span class='Ref_to_Member'>fn_oid</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_FUNCTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not identify an equality operator for type %s"</span><span class='Delimiter'>, 
</span>                       <a href="format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5986"><span class='Ref_To_Local'>element_type</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN5983"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN78"><span class='Ref_to_Member'>flinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN63"><span class='Ref_to_Member'>fn_extra</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="arrayfuncs.c.html#LN6004"><span class='Ref_To_Local'>typentry</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="arrayfuncs.c.html#LN5997"><span class='Ref_To_Local'>typlen</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN6004"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN34"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN5998"><span class='Ref_To_Local'>typbyval</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN6004"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN35"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN5999"><span class='Ref_To_Local'>typalign</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN6004"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN36"><span class='Ref_to_Member'>typalign</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Detoast values if they are toasted.  The replacement value must be 
     * detoasted for insertion into the result array, while detoasting the 
     * search value only once saves cycles. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5997"><span class='Ref_To_Local'>typlen</span></a> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="arrayfuncs.c.html#LN5980"><span class='Ref_to_Parameter'>search_isnull</span></a><span class='Parentheses'>) 
</span>            <a href="arrayfuncs.c.html#LN5980"><span class='Ref_to_Parameter'>search</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN204"><span class='Ref_to_Macro'>PG_DETOAST_DATUM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5980"><span class='Ref_to_Parameter'>search</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="arrayfuncs.c.html#LN5981"><span class='Ref_to_Parameter'>replace_isnull</span></a><span class='Parentheses'>) 
</span>            <a href="arrayfuncs.c.html#LN5981"><span class='Ref_to_Parameter'>replace</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN204"><span class='Ref_to_Macro'>PG_DETOAST_DATUM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5981"><span class='Ref_to_Parameter'>replace</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Prepare to apply the comparison operator */ 
</span>    <a href="../../../include/fmgr.h.html#LN119"><span class='Ref_to_Macro'>InitFunctionCallInfoData</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6005"><span class='Ref_To_Local'>locfcinfo</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN6004"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN66"><span class='Ref_to_Member'>eq_opr_finfo</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, 
</span>                             <a href="arrayfuncs.c.html#LN5982"><span class='Ref_to_Parameter'>collation</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Allocate temporary arrays for new values */ 
</span>    <a href="arrayfuncs.c.html#LN5987"><span class='Ref_To_Local'>values</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5991"><span class='Ref_To_Local'>nitems</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN5988"><span class='Ref_To_Local'>nulls</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5991"><span class='Ref_To_Local'>nitems</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Loop over source data */ 
</span>    <a href="arrayfuncs.c.html#LN6000"><span class='Ref_To_Local'>arraydataptr</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN302"><span class='Ref_to_Macro'>ARR_DATA_PTR</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5979"><span class='Ref_to_Parameter'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN6001"><span class='Ref_To_Local'>bitmap</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN280"><span class='Ref_to_Macro'>ARR_NULLBITMAP</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5979"><span class='Ref_to_Parameter'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN6002"><span class='Ref_To_Local'>bitmask</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN5996"><span class='Ref_To_Local'>hasnulls</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN5992"><span class='Ref_To_Local'>nresult</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5993"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN5993"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN5991"><span class='Ref_To_Local'>nitems</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN5993"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN6076"></a>        <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>elt</span><span class='Delimiter'>; 
</span><a name="LN6077"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span><a name="LN6078"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>oprresult</span><span class='Delimiter'>; 
</span><a name="LN6079"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>skip</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Get source element, checking for NULL */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6001"><span class='Ref_To_Local'>bitmap</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="arrayfuncs.c.html#LN6001"><span class='Ref_To_Local'>bitmap</span></a> <span class='Operator'>& </span><a href="arrayfuncs.c.html#LN6002"><span class='Ref_To_Local'>bitmask</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="arrayfuncs.c.html#LN6077"><span class='Ref_To_Local'>isNull</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* If searching for NULL, we have a match */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5980"><span class='Ref_to_Parameter'>search_isnull</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5982"><span class='Ref_to_Parameter'>remove</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="arrayfuncs.c.html#LN6079"><span class='Ref_To_Local'>skip</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                    <a href="arrayfuncs.c.html#LN6003"><span class='Ref_To_Local'>changed</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="arrayfuncs.c.html#LN5981"><span class='Ref_to_Parameter'>replace_isnull</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="arrayfuncs.c.html#LN5987"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN5992"><span class='Ref_To_Local'>nresult</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="arrayfuncs.c.html#LN5981"><span class='Ref_to_Parameter'>replace</span></a><span class='Delimiter'>; 
</span>                    <a href="arrayfuncs.c.html#LN6077"><span class='Ref_To_Local'>isNull</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                    <a href="arrayfuncs.c.html#LN6003"><span class='Ref_To_Local'>changed</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="arrayfuncs.c.html#LN6077"><span class='Ref_To_Local'>isNull</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN6076"><span class='Ref_To_Local'>elt</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN43"><span class='Ref_to_Macro'>fetch_att</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6000"><span class='Ref_To_Local'>arraydataptr</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5998"><span class='Ref_To_Local'>typbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5997"><span class='Ref_To_Local'>typlen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN6000"><span class='Ref_To_Local'>arraydataptr</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN159"><span class='Ref_to_Macro'>att_addlength_datum</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6000"><span class='Ref_To_Local'>arraydataptr</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5997"><span class='Ref_To_Local'>typlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN6076"><span class='Ref_To_Local'>elt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN6000"><span class='Ref_To_Local'>arraydataptr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/access/tupmacs.h.html#LN143"><span class='Ref_to_Macro'>att_align_nominal</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6000"><span class='Ref_To_Local'>arraydataptr</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5999"><span class='Ref_To_Local'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5980"><span class='Ref_to_Parameter'>search_isnull</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* no match possible, keep element */ 
</span>                <a href="arrayfuncs.c.html#LN5987"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN5992"><span class='Ref_To_Local'>nresult</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="arrayfuncs.c.html#LN6076"><span class='Ref_To_Local'>elt</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * Apply the operator to the element pair 
                 */ 
</span>                <a href="arrayfuncs.c.html#LN6005"><span class='Ref_To_Local'>locfcinfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN84"><span class='Ref_to_Member'>arg</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="arrayfuncs.c.html#LN6076"><span class='Ref_To_Local'>elt</span></a><span class='Delimiter'>; 
</span>                <a href="arrayfuncs.c.html#LN6005"><span class='Ref_To_Local'>locfcinfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN84"><span class='Ref_to_Member'>arg</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="arrayfuncs.c.html#LN5980"><span class='Ref_to_Parameter'>search</span></a><span class='Delimiter'>; 
</span>                <a href="arrayfuncs.c.html#LN6005"><span class='Ref_To_Local'>locfcinfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN85"><span class='Ref_to_Member'>argnull</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <a href="arrayfuncs.c.html#LN6005"><span class='Ref_To_Local'>locfcinfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN85"><span class='Ref_to_Member'>argnull</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <a href="arrayfuncs.c.html#LN6005"><span class='Ref_To_Local'>locfcinfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN82"><span class='Ref_to_Member'>isnull</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <a href="arrayfuncs.c.html#LN6078"><span class='Ref_To_Local'>oprresult</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN136"><span class='Ref_to_Macro'>FunctionCallInvoke</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN6005"><span class='Ref_To_Local'>locfcinfo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="arrayfuncs.c.html#LN6078"><span class='Ref_To_Local'>oprresult</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* no match, keep element */ 
</span>                    <a href="arrayfuncs.c.html#LN5987"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN5992"><span class='Ref_To_Local'>nresult</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="arrayfuncs.c.html#LN6076"><span class='Ref_To_Local'>elt</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* match, so replace or delete */ 
</span>                    <a href="arrayfuncs.c.html#LN6003"><span class='Ref_To_Local'>changed</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5982"><span class='Ref_to_Parameter'>remove</span></a><span class='Parentheses'>) 
</span>                        <a href="arrayfuncs.c.html#LN6079"><span class='Ref_To_Local'>skip</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="arrayfuncs.c.html#LN5987"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN5992"><span class='Ref_To_Local'>nresult</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="arrayfuncs.c.html#LN5981"><span class='Ref_to_Parameter'>replace</span></a><span class='Delimiter'>; 
</span>                        <a href="arrayfuncs.c.html#LN6077"><span class='Ref_To_Local'>isNull</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN5981"><span class='Ref_to_Parameter'>replace_isnull</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="arrayfuncs.c.html#LN6079"><span class='Ref_To_Local'>skip</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="arrayfuncs.c.html#LN5988"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN5992"><span class='Ref_To_Local'>nresult</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="arrayfuncs.c.html#LN6077"><span class='Ref_To_Local'>isNull</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6077"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>                <a href="arrayfuncs.c.html#LN5996"><span class='Ref_To_Local'>hasnulls</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Update total result size */ 
</span>                <a href="arrayfuncs.c.html#LN5994"><span class='Ref_To_Local'>nbytes</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN159"><span class='Ref_to_Macro'>att_addlength_datum</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5994"><span class='Ref_To_Local'>nbytes</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5997"><span class='Ref_To_Local'>typlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5987"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN5992"><span class='Ref_To_Local'>nresult</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="arrayfuncs.c.html#LN5994"><span class='Ref_To_Local'>nbytes</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN143"><span class='Ref_to_Macro'>att_align_nominal</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5994"><span class='Ref_To_Local'>nbytes</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5999"><span class='Ref_To_Local'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* check for overflow of total request */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/memutils.h.html#LN41"><span class='Ref_to_Macro'>AllocSizeIsValid</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5994"><span class='Ref_To_Local'>nbytes</span></a><span class='Parentheses'>))</span> 
                    <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_PROGRAM_LIMIT_EXCEEDED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"array size exceeds the maximum allowed (%d)"</span><span class='Delimiter'>, 
</span>                               <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="../../../common/psprintf.c.html#LN27"><span class='Ref_to_Const'>MaxAllocSize</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="arrayfuncs.c.html#LN5992"><span class='Ref_To_Local'>nresult</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* advance bitmap pointer if any */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6001"><span class='Ref_To_Local'>bitmap</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="arrayfuncs.c.html#LN6002"><span class='Ref_To_Local'>bitmask</span></a> <span class='Operator'>&LT;&LT;= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6002"><span class='Ref_To_Local'>bitmask</span></a> <span class='Operator'>== </span><span class='Number'>0x100</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="arrayfuncs.c.html#LN6001"><span class='Ref_To_Local'>bitmap</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <a href="arrayfuncs.c.html#LN6002"><span class='Ref_To_Local'>bitmask</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;nitems;i++ &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * If not changed just return the original array 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="arrayfuncs.c.html#LN6003"><span class='Ref_To_Local'>changed</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5987"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5988"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="arrayfuncs.c.html#LN5979"><span class='Ref_to_Parameter'>array</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* If all elements were removed return an empty array */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5992"><span class='Ref_To_Local'>nresult</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5987"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5988"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="../../../include/utils/array.h.html#LN378"><span class='Ref_to_Proto'>construct_empty_array</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5986"><span class='Ref_To_Local'>element_type</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Allocate and initialize the result array */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5996"><span class='Ref_To_Local'>hasnulls</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="arrayfuncs.c.html#LN5995"><span class='Ref_To_Local'>dataoffset</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN292"><span class='Ref_to_Macro'>ARR_OVERHEAD_WITHNULLS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5990"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5992"><span class='Ref_To_Local'>nresult</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN5994"><span class='Ref_To_Local'>nbytes</span></a> <span class='Operator'>+= </span><a href="arrayfuncs.c.html#LN5995"><span class='Ref_To_Local'>dataoffset</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="arrayfuncs.c.html#LN5995"><span class='Ref_To_Local'>dataoffset</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* marker for no null bitmap */ 
</span>        <a href="arrayfuncs.c.html#LN5994"><span class='Ref_To_Local'>nbytes</span></a> <span class='Operator'>+= </span><a href="../../../include/utils/array.h.html#LN290"><span class='Ref_to_Macro'>ARR_OVERHEAD_NONULLS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5990"><span class='Ref_To_Local'>ndim</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="arrayfuncs.c.html#LN5985"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5994"><span class='Ref_To_Local'>nbytes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5985"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5994"><span class='Ref_To_Local'>nbytes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN5985"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN78"><span class='Ref_to_Member'>ndim</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN5990"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN5985"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN79"><span class='Ref_to_Member'>dataoffset</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN5995"><span class='Ref_To_Local'>dataoffset</span></a><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN5985"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN80"><span class='Ref_to_Member'>elemtype</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN5986"><span class='Ref_To_Local'>element_type</span></a><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5985"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5979"><span class='Ref_to_Parameter'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5990"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN276"><span class='Ref_to_Macro'>ARR_LBOUND</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5985"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/utils/array.h.html#LN276"><span class='Ref_to_Macro'>ARR_LBOUND</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5979"><span class='Ref_to_Parameter'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5990"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5982"><span class='Ref_to_Parameter'>remove</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Adjust the result length */ 
</span>        <a href="../../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5985"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="arrayfuncs.c.html#LN5992"><span class='Ref_To_Local'>nresult</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Insert data into result array */ 
</span>    <a href="../../../include/utils/array.h.html#LN330"><span class='Ref_to_Proto'>CopyArrayEls</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5985"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                 <a href="arrayfuncs.c.html#LN5987"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5988"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5992"><span class='Ref_To_Local'>nresult</span></a><span class='Delimiter'>, 
</span>                 <a href="arrayfuncs.c.html#LN5997"><span class='Ref_To_Local'>typlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5998"><span class='Ref_To_Local'>typbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN5999"><span class='Ref_To_Local'>typalign</span></a><span class='Delimiter'>, 
</span>                 <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5987"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN5988"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="arrayfuncs.c.html#LN5985"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end array_replace_internal &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Remove any occurrences of an element from an array 
 * 
 * If used on a multi-dimensional array this will raise an error. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN6237"></a><span class='Declare_Function'>array_remove</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN6239"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>array</span><span class='Delimiter'>; 
</span><a name="LN6240"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>search</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN6241"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>search_isnull</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN6239"><span class='Ref_To_Local'>array</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN6239"><span class='Ref_To_Local'>array</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN145"><span class='Ref_to_Proto'>array_replace_internal</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6239"><span class='Ref_To_Local'>array</span></a><span class='Delimiter'>, 
</span>                                   <a href="arrayfuncs.c.html#LN6240"><span class='Ref_To_Local'>search</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN6241"><span class='Ref_To_Local'>search_isnull</span></a><span class='Delimiter'>, 
</span>                                   <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                   <span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="../../../include/fmgr.h.html#LN162"><span class='Ref_to_Macro'>PG_GET_COLLATION</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                                   fcinfo<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/array.h.html#LN245"><span class='Ref_to_Macro'>PG_RETURN_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6239"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Replace any occurrences of an element in an array 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN6259"></a><span class='Declare_Function'>array_replace</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN6261"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>array</span><span class='Delimiter'>; 
</span><a name="LN6262"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>search</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN6263"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>search_isnull</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN6264"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>replace</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN6265"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>replace_isnull</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN6261"><span class='Ref_To_Local'>array</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN6261"><span class='Ref_To_Local'>array</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN145"><span class='Ref_to_Proto'>array_replace_internal</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6261"><span class='Ref_To_Local'>array</span></a><span class='Delimiter'>, 
</span>                                   <a href="arrayfuncs.c.html#LN6262"><span class='Ref_To_Local'>search</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN6263"><span class='Ref_To_Local'>search_isnull</span></a><span class='Delimiter'>, 
</span>                                   <a href="arrayfuncs.c.html#LN6264"><span class='Ref_To_Local'>replace</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN6265"><span class='Ref_To_Local'>replace_isnull</span></a><span class='Delimiter'>, 
</span>                                   <span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="../../../include/fmgr.h.html#LN162"><span class='Ref_to_Macro'>PG_GET_COLLATION</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                                   fcinfo<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/array.h.html#LN245"><span class='Ref_to_Macro'>PG_RETURN_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6261"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end array_replace &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Implements width_bucket(anyelement, anyarray). 
 * 
 * 'thresholds' is an array containing lower bound values for each bucket; 
 * these must be sorted from smallest to largest, or bogus results will be 
 * produced.  If N thresholds are supplied, the output is from 0 to N: 
 * 0 is for inputs &LT; first threshold, N is for inputs &GT;= last threshold. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN6288"></a><span class='Declare_Function'>width_bucket_array</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN6290"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>operand</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN6291"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>thresholds</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN6292"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>collation</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN162"><span class='Ref_to_Macro'>PG_GET_COLLATION</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><a name="LN6293"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>element_type</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN272"><span class='Ref_to_Macro'>ARR_ELEMTYPE</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6291"><span class='Ref_To_Local'>thresholds</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN6294"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check input */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6291"><span class='Ref_To_Local'>thresholds</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ARRAY_SUBSCRIPT_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"thresholds must be one-dimensional array"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN386"><span class='Ref_to_Proto'>array_contains_nulls</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6291"><span class='Ref_To_Local'>thresholds</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NULL_VALUE_NOT_ALLOWED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"thresholds array must not contain NULLs"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* We have a dedicated implementation for float8 data */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6293"><span class='Ref_To_Local'>element_type</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN39"><span class='Ref_to_Const'>FLOAT8OID</span></a><span class='Parentheses'>) 
</span>        <a href="arrayfuncs.c.html#LN6294"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN150"><span class='Ref_to_Proto'>width_bucket_array_float8</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6290"><span class='Ref_To_Local'>operand</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN6291"><span class='Ref_To_Local'>thresholds</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN6312"></a>        <a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>typentry</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Cache information about the input type */ 
</span>        <a href="arrayfuncs.c.html#LN6312"><span class='Ref_To_Local'>typentry</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_extra<span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6312"><span class='Ref_To_Local'>typentry</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| 
</span>            <a href="arrayfuncs.c.html#LN6312"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN31"><span class='Ref_to_Member'>type_id</span></a> <span class='Operator'>!= </span><a href="arrayfuncs.c.html#LN6293"><span class='Ref_To_Local'>element_type</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="arrayfuncs.c.html#LN6312"><span class='Ref_To_Local'>typentry</span></a> <span class='Operator'>= </span><a href="../../../include/utils/typcache.h.html#LN142"><span class='Ref_to_Proto'>lookup_type_cache</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6293"><span class='Ref_To_Local'>element_type</span></a><span class='Delimiter'>, 
</span>                                         <a href="../../../include/utils/typcache.h.html#LN115"><span class='Ref_to_Const'>TYPECACHE_CMP_PROC_FINFO</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6312"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN67"><span class='Ref_to_Member'>cmp_proc_finfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN58"><span class='Ref_to_Member'>fn_oid</span></a><span class='Parentheses'>))</span> 
                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_FUNCTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not identify a comparison function for type %s"</span><span class='Delimiter'>, 
</span>                       <a href="format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6293"><span class='Ref_To_Local'>element_type</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>            fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_extra <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="arrayfuncs.c.html#LN6312"><span class='Ref_To_Local'>typentry</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We have separate implementation paths for fixed- and variable-width 
         * types, since indexing the array is a lot cheaper in the first case. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6312"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN34"><span class='Ref_to_Member'>typlen</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="arrayfuncs.c.html#LN6294"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN151"><span class='Ref_to_Proto'>width_bucket_array_fixed</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6290"><span class='Ref_To_Local'>operand</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN6291"><span class='Ref_To_Local'>thresholds</span></a><span class='Delimiter'>, 
</span>                                              <a href="arrayfuncs.c.html#LN6292"><span class='Ref_To_Local'>collation</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN6312"><span class='Ref_To_Local'>typentry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="arrayfuncs.c.html#LN6294"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN155"><span class='Ref_to_Proto'>width_bucket_array_variable</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6290"><span class='Ref_To_Local'>operand</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN6291"><span class='Ref_To_Local'>thresholds</span></a><span class='Delimiter'>, 
</span>                                                 <a href="arrayfuncs.c.html#LN6292"><span class='Ref_To_Local'>collation</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN6312"><span class='Ref_To_Local'>typentry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Avoid leaking memory when handed toasted input. */ 
</span>    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6291"><span class='Ref_To_Local'>thresholds</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN313"><span class='Ref_to_Macro'>PG_RETURN_INT32</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6294"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end width_bucket_array &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * width_bucket_array for float8 data. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN6351"></a><span class='Declare_Function'>width_bucket_array_float8</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>operand</span><span class='Delimiter'>, </span><a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>thresholds</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN6353"></a>    <a href="../../../include/c.h.html#LN380"><span class='Ref_to_Typedef'>float8</span></a>      <span class='Declare_Local'>op</span> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN720"><span class='Ref_to_Func'>DatumGetFloat8</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6351"><span class='Ref_to_Parameter'>operand</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN6354"></a>    <a href="../../../include/c.h.html#LN380"><span class='Ref_to_Typedef'>float8</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>thresholds_data</span><span class='Delimiter'>; 
</span><a name="LN6355"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>left</span><span class='Delimiter'>; 
</span><a name="LN6356"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>right</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Since we know the array contains no NULLs, we can just index it 
     * directly. 
     */ 
</span>    <a href="arrayfuncs.c.html#LN6354"><span class='Ref_To_Local'>thresholds_data</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN380"><span class='Ref_to_Typedef'>float8</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/array.h.html#LN302"><span class='Ref_to_Macro'>ARR_DATA_PTR</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6351"><span class='Ref_to_Parameter'>thresholds</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN6355"><span class='Ref_To_Local'>left</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN6356"><span class='Ref_To_Local'>right</span></a> <span class='Operator'>= </span><a href="arrayutils.c.html#LN73"><span class='Ref_to_Func'>ArrayGetNItems</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6351"><span class='Ref_to_Parameter'>thresholds</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6351"><span class='Ref_to_Parameter'>thresholds</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the probe value is a NaN, it's greater than or equal to all possible 
     * threshold values (including other NaNs), so we need not search.  Note 
     * that this would give the same result as searching even if the array 
     * contains multiple NaNs (as long as they're correctly sorted), since the 
     * loop logic will find the rightmost of multiple equal threshold values. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/test/expected/pgtypeslib-nan_test.c.html#LN30"><span class='Ref_to_Macro'>isnan</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6353"><span class='Ref_To_Local'>op</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="arrayfuncs.c.html#LN6356"><span class='Ref_To_Local'>right</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Find the bucket */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6355"><span class='Ref_To_Local'>left</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN6356"><span class='Ref_To_Local'>right</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN6380"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>mid</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6355"><span class='Ref_To_Local'>left</span></a> <span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN6356"><span class='Ref_To_Local'>right</span></a><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Number'>2</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/test/expected/pgtypeslib-nan_test.c.html#LN30"><span class='Ref_to_Macro'>isnan</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6354"><span class='Ref_To_Local'>thresholds_data</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN6380"><span class='Ref_To_Local'>mid</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) </span><span class='Operator'>|| </span><a href="arrayfuncs.c.html#LN6353"><span class='Ref_To_Local'>op</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN6354"><span class='Ref_To_Local'>thresholds_data</span></a><span class='Delimiter'>[</span><a href="arrayfuncs.c.html#LN6380"><span class='Ref_To_Local'>mid</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span> 
            <a href="arrayfuncs.c.html#LN6356"><span class='Ref_To_Local'>right</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN6380"><span class='Ref_To_Local'>mid</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="arrayfuncs.c.html#LN6355"><span class='Ref_To_Local'>left</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN6380"><span class='Ref_To_Local'>mid</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="arrayfuncs.c.html#LN6355"><span class='Ref_To_Local'>left</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end width_bucket_array_float8 &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * width_bucket_array for generic fixed-width data types. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN6395"></a><span class='Declare_Function'>width_bucket_array_fixed</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>operand</span><span class='Delimiter'>, 
</span><a name="LN6396"></a>                         <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>thresholds</span><span class='Delimiter'>, 
</span><a name="LN6397"></a>                         <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>collation</span><span class='Delimiter'>, 
</span><a name="LN6398"></a>                         <a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typentry</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN6400"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>thresholds_data</span><span class='Delimiter'>; 
</span><a name="LN6401"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>typlen</span> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN6398"><span class='Ref_to_Parameter'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN34"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>; 
</span><a name="LN6402"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>typbyval</span> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN6398"><span class='Ref_to_Parameter'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN35"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>; 
</span><a name="LN6403"></a>    <a href="../../../include/fmgr.h.html#LN76"><span class='Ref_to_Struct'>FunctionCallInfoData</span></a> <span class='Declare_Local'>locfcinfo</span><span class='Delimiter'>; 
</span><a name="LN6404"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>left</span><span class='Delimiter'>; 
</span><a name="LN6405"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>right</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Since we know the array contains no NULLs, we can just index it 
     * directly. 
     */ 
</span>    <a href="arrayfuncs.c.html#LN6400"><span class='Ref_To_Local'>thresholds_data</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/array.h.html#LN302"><span class='Ref_to_Macro'>ARR_DATA_PTR</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6396"><span class='Ref_to_Parameter'>thresholds</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN119"><span class='Ref_to_Macro'>InitFunctionCallInfoData</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6403"><span class='Ref_To_Local'>locfcinfo</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN6398"><span class='Ref_to_Parameter'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN67"><span class='Ref_to_Member'>cmp_proc_finfo</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, 
</span>                             <a href="arrayfuncs.c.html#LN6397"><span class='Ref_to_Parameter'>collation</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Find the bucket */ 
</span>    <a href="arrayfuncs.c.html#LN6404"><span class='Ref_To_Local'>left</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN6405"><span class='Ref_To_Local'>right</span></a> <span class='Operator'>= </span><a href="arrayutils.c.html#LN73"><span class='Ref_to_Func'>ArrayGetNItems</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6396"><span class='Ref_to_Parameter'>thresholds</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6396"><span class='Ref_to_Parameter'>thresholds</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6404"><span class='Ref_To_Local'>left</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN6405"><span class='Ref_To_Local'>right</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN6421"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>mid</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6404"><span class='Ref_To_Local'>left</span></a> <span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN6405"><span class='Ref_To_Local'>right</span></a><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Number'>2</span><span class='Delimiter'>; 
</span><a name="LN6422"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>ptr</span><span class='Delimiter'>; 
</span><a name="LN6423"></a>        <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>cmpresult</span><span class='Delimiter'>; 
</span> 
        <a href="arrayfuncs.c.html#LN6422"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN6400"><span class='Ref_To_Local'>thresholds_data</span></a> <span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN6421"><span class='Ref_To_Local'>mid</span></a> <span class='Operator'>* </span><a href="arrayfuncs.c.html#LN6401"><span class='Ref_To_Local'>typlen</span></a><span class='Delimiter'>; 
</span> 
        <a href="arrayfuncs.c.html#LN6403"><span class='Ref_To_Local'>locfcinfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN84"><span class='Ref_to_Member'>arg</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="arrayfuncs.c.html#LN6395"><span class='Ref_to_Parameter'>operand</span></a><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN6403"><span class='Ref_To_Local'>locfcinfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN84"><span class='Ref_to_Member'>arg</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN43"><span class='Ref_to_Macro'>fetch_att</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6422"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN6402"><span class='Ref_To_Local'>typbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN6401"><span class='Ref_To_Local'>typlen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN6403"><span class='Ref_To_Local'>locfcinfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN85"><span class='Ref_to_Member'>argnull</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN6403"><span class='Ref_To_Local'>locfcinfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN85"><span class='Ref_to_Member'>argnull</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN6403"><span class='Ref_To_Local'>locfcinfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN82"><span class='Ref_to_Member'>isnull</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <a href="arrayfuncs.c.html#LN6423"><span class='Ref_To_Local'>cmpresult</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN477"><span class='Ref_to_Macro'>DatumGetInt32</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN136"><span class='Ref_to_Macro'>FunctionCallInvoke</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN6403"><span class='Ref_To_Local'>locfcinfo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6423"><span class='Ref_To_Local'>cmpresult</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="arrayfuncs.c.html#LN6405"><span class='Ref_To_Local'>right</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN6421"><span class='Ref_To_Local'>mid</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="arrayfuncs.c.html#LN6404"><span class='Ref_To_Local'>left</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN6421"><span class='Ref_To_Local'>mid</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while left&LT;right &raquo; </span> 
 
    <span class='Control'>return</span> <a href="arrayfuncs.c.html#LN6404"><span class='Ref_To_Local'>left</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end width_bucket_array_fixed &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * width_bucket_array for generic variable-width data types. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN6448"></a><span class='Declare_Function'>width_bucket_array_variable</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>operand</span><span class='Delimiter'>, 
</span><a name="LN6449"></a>                            <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>thresholds</span><span class='Delimiter'>, 
</span><a name="LN6450"></a>                            <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>collation</span><span class='Delimiter'>, 
</span><a name="LN6451"></a>                            <a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typentry</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN6453"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>thresholds_data</span><span class='Delimiter'>; 
</span><a name="LN6454"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>typlen</span> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN6451"><span class='Ref_to_Parameter'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN34"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>; 
</span><a name="LN6455"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>typbyval</span> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN6451"><span class='Ref_to_Parameter'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN35"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>; 
</span><a name="LN6456"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>typalign</span> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN6451"><span class='Ref_to_Parameter'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN36"><span class='Ref_to_Member'>typalign</span></a><span class='Delimiter'>; 
</span><a name="LN6457"></a>    <a href="../../../include/fmgr.h.html#LN76"><span class='Ref_to_Struct'>FunctionCallInfoData</span></a> <span class='Declare_Local'>locfcinfo</span><span class='Delimiter'>; 
</span><a name="LN6458"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>left</span><span class='Delimiter'>; 
</span><a name="LN6459"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>right</span><span class='Delimiter'>; 
</span> 
    <a href="arrayfuncs.c.html#LN6453"><span class='Ref_To_Local'>thresholds_data</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/array.h.html#LN302"><span class='Ref_to_Macro'>ARR_DATA_PTR</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6449"><span class='Ref_to_Parameter'>thresholds</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN119"><span class='Ref_to_Macro'>InitFunctionCallInfoData</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6457"><span class='Ref_To_Local'>locfcinfo</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN6451"><span class='Ref_to_Parameter'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN67"><span class='Ref_to_Member'>cmp_proc_finfo</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, 
</span>                             <a href="arrayfuncs.c.html#LN6450"><span class='Ref_to_Parameter'>collation</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Find the bucket */ 
</span>    <a href="arrayfuncs.c.html#LN6458"><span class='Ref_To_Local'>left</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="arrayfuncs.c.html#LN6459"><span class='Ref_To_Local'>right</span></a> <span class='Operator'>= </span><a href="arrayutils.c.html#LN73"><span class='Ref_to_Func'>ArrayGetNItems</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6449"><span class='Ref_to_Parameter'>thresholds</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6449"><span class='Ref_to_Parameter'>thresholds</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6458"><span class='Ref_To_Local'>left</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN6459"><span class='Ref_To_Local'>right</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN6471"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>mid</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6458"><span class='Ref_To_Local'>left</span></a> <span class='Operator'>+ </span><a href="arrayfuncs.c.html#LN6459"><span class='Ref_To_Local'>right</span></a><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Number'>2</span><span class='Delimiter'>; 
</span><a name="LN6472"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>ptr</span><span class='Delimiter'>; 
</span><a name="LN6473"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN6474"></a>        <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>cmpresult</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Locate mid'th array element by advancing from left element */ 
</span>        <a href="arrayfuncs.c.html#LN6472"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN6453"><span class='Ref_To_Local'>thresholds_data</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6473"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN6458"><span class='Ref_To_Local'>left</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN6473"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="arrayfuncs.c.html#LN6471"><span class='Ref_To_Local'>mid</span></a><span class='Delimiter'>; </span><a href="arrayfuncs.c.html#LN6473"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="arrayfuncs.c.html#LN6472"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN171"><span class='Ref_to_Macro'>att_addlength_pointer</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6472"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN6454"><span class='Ref_To_Local'>typlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN6472"><span class='Ref_To_Local'>ptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN6472"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/access/tupmacs.h.html#LN143"><span class='Ref_to_Macro'>att_align_nominal</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6472"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN6456"><span class='Ref_To_Local'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="arrayfuncs.c.html#LN6457"><span class='Ref_To_Local'>locfcinfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN84"><span class='Ref_to_Member'>arg</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="arrayfuncs.c.html#LN6448"><span class='Ref_to_Parameter'>operand</span></a><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN6457"><span class='Ref_To_Local'>locfcinfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN84"><span class='Ref_to_Member'>arg</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN43"><span class='Ref_to_Macro'>fetch_att</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6472"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN6455"><span class='Ref_To_Local'>typbyval</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN6454"><span class='Ref_To_Local'>typlen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN6457"><span class='Ref_To_Local'>locfcinfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN85"><span class='Ref_to_Member'>argnull</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN6457"><span class='Ref_To_Local'>locfcinfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN85"><span class='Ref_to_Member'>argnull</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="arrayfuncs.c.html#LN6457"><span class='Ref_To_Local'>locfcinfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN82"><span class='Ref_to_Member'>isnull</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <a href="arrayfuncs.c.html#LN6474"><span class='Ref_To_Local'>cmpresult</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN477"><span class='Ref_to_Macro'>DatumGetInt32</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN136"><span class='Ref_to_Macro'>FunctionCallInvoke</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="arrayfuncs.c.html#LN6457"><span class='Ref_To_Local'>locfcinfo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6474"><span class='Ref_To_Local'>cmpresult</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="arrayfuncs.c.html#LN6459"><span class='Ref_To_Local'>right</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN6471"><span class='Ref_To_Local'>mid</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="arrayfuncs.c.html#LN6458"><span class='Ref_To_Local'>left</span></a> <span class='Operator'>= </span><a href="arrayfuncs.c.html#LN6471"><span class='Ref_To_Local'>mid</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Move the thresholds pointer to match new "left" index, so we 
             * don't have to seek over those elements again.  This trick 
             * ensures we do only O(N) array indexing work, not O(N^2). 
             */ 
</span>            <a href="arrayfuncs.c.html#LN6472"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN171"><span class='Ref_to_Macro'>att_addlength_pointer</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6472"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN6454"><span class='Ref_To_Local'>typlen</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN6472"><span class='Ref_To_Local'>ptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="arrayfuncs.c.html#LN6453"><span class='Ref_To_Local'>thresholds_data</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/access/tupmacs.h.html#LN143"><span class='Ref_to_Macro'>att_align_nominal</span></a><span class='Parentheses'>(</span><a href="arrayfuncs.c.html#LN6472"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>, </span><a href="arrayfuncs.c.html#LN6456"><span class='Ref_To_Local'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while left&LT;right &raquo; </span> 
 
    <span class='Control'>return</span> <a href="arrayfuncs.c.html#LN6458"><span class='Ref_To_Local'>left</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end width_bucket_array_variable &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>